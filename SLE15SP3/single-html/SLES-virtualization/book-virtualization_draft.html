<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><title>SLES 15 SP3 | Virtualization Guide</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Virtualization Guide | SLES 15 SP3"/>
<meta name="description" content="How to manage virtual machines on SUSE Linux Enterprise Server"/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="15 SP3"/>
<meta name="book-title" content="Virtualization Guide"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Server 15 SP3"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Virtualization Guide"/>
<meta property="og:description" content="Learn all about virtualization and VM management"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Virtualization Guide"/>
<meta name="twitter:description" content="Learn all about virtualization and VM management"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Virtualization Guide",
  
    "description": "How to manage virtual machines on SUSE Linux Enterprise Server",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-05-29T00:00+02:00",
      
    "datePublished": "2021-06-22T00:00+02:00",
      

    "about": [
      {
        "@type": "Thing",
        "name": "Virtualization"
      }
    ],
  
    "mentions": [
      
      { "@type": "SoftwareApplication",
        "name": "SUSE Linux Enterprise Server",
        "softwareVersion": "15 SP3",
        "applicationCategory": "Operating System",
        "operatingSystem": "Linux"
      }
      
    ],
    
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/book_virtualization.xml"/></head><body class="draft single normal offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="#book-virtualization">Virtualization Guide</a></div></div><main id="_content"><nav class="side-toc placebo" id="_side-toc-overall"> </nav><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section xml:lang="en" class="book" id="book-virtualization" data-id-title="Virtualization Guide"><div class="titlepage"><div><div class="big-version-info"><span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP3</span></span></span></div><div class="title-container"><h1 class="title">Virtualization Guide</h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/book_virtualization.xml" title="Edit source document"> </a></div></div><div class="abstract"><p>This guide describes virtualization technology in
    general. It introduces libvirt—the unified interface to
    virtualization—and provides detailed information on specific
    hypervisors.</p></div><div><div class="titlepage-revhistory"><a aria-label="Revision History" hreflang="en" href="rh-book-virtualization.html" target="_blank">Revision History: Virtualization Guide</a></div></div><div class="date"><span class="imprint-label">Publication Date: </span>October 10, 2024
</div></div></div><div class="toc"><ul><li><span class="preface"><a href="#cha-kvm"><span class="title-name">Preface</span></a></span><ul><li><span class="sect1"><a href="#id-1.12.2.3"><span class="title-name">Available documentation</span></a></span></li><li><span class="sect1"><a href="#id-1.12.2.4"><span class="title-name">Improving the documentation</span></a></span></li><li><span class="sect1"><a href="#id-1.12.2.5"><span class="title-name">Documentation conventions</span></a></span></li><li><span class="sect1"><a href="#id-1.12.2.6"><span class="title-name">Support</span></a></span></li></ul></li><li><span class="part"><a href="#part-virt-intro"><span class="title-number">I </span><span class="title-name">Introduction</span></a></span><ul><li><span class="chapter"><a href="#chap-virtualization-introduction"><span class="title-number">1 </span><span class="title-name">Virtualization technology</span></a></span><ul><li><span class="sect1"><a href="#sec-virtualization-introduction-overview"><span class="title-number">1.1 </span><span class="title-name">Overview</span></a></span></li><li><span class="sect1"><a href="#sec-virtualization-introduction-benefits"><span class="title-number">1.2 </span><span class="title-name">Virtualization benefits</span></a></span></li><li><span class="sect1"><a href="#sec-virtualization-introduction-fvpv"><span class="title-number">1.3 </span><span class="title-name">Virtualization modes</span></a></span></li><li><span class="sect1"><a href="#sec-vt-io"><span class="title-number">1.4 </span><span class="title-name">I/O virtualization</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-virtualization-scenarios"><span class="title-number">2 </span><span class="title-name">Virtualization scenarios</span></a></span><ul><li><span class="sect1"><a href="#sec-virtualization-scenarios-capabilities"><span class="title-number">2.1 </span><span class="title-name">Server consolidation</span></a></span></li><li><span class="sect1"><a href="#id-1.12.3.3.4"><span class="title-number">2.2 </span><span class="title-name">Isolation</span></a></span></li><li><span class="sect1"><a href="#id-1.12.3.3.5"><span class="title-number">2.3 </span><span class="title-name">Disaster recovery</span></a></span></li><li><span class="sect1"><a href="#id-1.12.3.3.6"><span class="title-number">2.4 </span><span class="title-name">Dynamic load balancing</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-xen-basics"><span class="title-number">3 </span><span class="title-name">Introduction to Xen virtualization</span></a></span><ul><li><span class="sect1"><a href="#sec-xen-basics-components"><span class="title-number">3.1 </span><span class="title-name">Basic components</span></a></span></li><li><span class="sect1"><a href="#sec-xen-basics-arch"><span class="title-number">3.2 </span><span class="title-name">Xen virtualization architecture</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-kvm-intro"><span class="title-number">4 </span><span class="title-name">Introduction to KVM virtualization</span></a></span><ul><li><span class="sect1"><a href="#sec-kvm-intro"><span class="title-number">4.1 </span><span class="title-name">Basic components</span></a></span></li><li><span class="sect1"><a href="#sec-kvm-intro-arch"><span class="title-number">4.2 </span><span class="title-name">KVM virtualization architecture</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tools-intro"><span class="title-number">5 </span><span class="title-name">Virtualization tools</span></a></span><ul><li><span class="sect1"><a href="#sec-tools-intro-console"><span class="title-number">5.1 </span><span class="title-name">Virtualization console tools</span></a></span></li><li><span class="sect1"><a href="#sec-tools-intro-gui"><span class="title-number">5.2 </span><span class="title-name">Virtualization GUI tools</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-vt-installation"><span class="title-number">6 </span><span class="title-name">Installation of virtualization components</span></a></span><ul><li><span class="sect1"><a href="#vt-installation-system-role"><span class="title-number">6.1 </span><span class="title-name">Specifying a system role</span></a></span></li><li><span class="sect1"><a href="#vt-installation-yast"><span class="title-number">6.2 </span><span class="title-name">Running the <span class="package">yast2-vm</span> module</span></a></span></li><li><span class="sect1"><a href="#sec-vt-installation-patterns"><span class="title-number">6.3 </span><span class="title-name">Patterns</span></a></span></li><li><span class="sect1"><a href="#sec-vt-installation-ovmf"><span class="title-number">6.4 </span><span class="title-name">Installing UEFI support</span></a></span></li><li><span class="sect1"><a href="#sec-vt-installation-nested-vms"><span class="title-number">6.5 </span><span class="title-name">Enable nested virtualization in KVM</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-virt-support"><span class="title-number">7 </span><span class="title-name">Virtualization limits and support</span></a></span><ul><li><span class="sect1"><a href="#sec-architecture-support"><span class="title-number">7.1 </span><span class="title-name">Architecture support</span></a></span></li><li><span class="sect1"><a href="#virt-hypervisors-limits"><span class="title-number">7.2 </span><span class="title-name">Hypervisor limits</span></a></span></li><li><span class="sect1"><a href="#virt-support-hosts"><span class="title-number">7.3 </span><span class="title-name">Supported host environments (hypervisors)</span></a></span></li><li><span class="sect1"><a href="#virt-support-guests"><span class="title-number">7.4 </span><span class="title-name">Supported guest operating systems</span></a></span></li><li><span class="sect1"><a href="#virt-migration-support"><span class="title-number">7.5 </span><span class="title-name">Supported VM migration scenarios</span></a></span></li><li><span class="sect1"><a href="#virt-support-feature-support"><span class="title-number">7.6 </span><span class="title-name">Feature support</span></a></span></li><li><span class="sect1"><a href="#vt-support-nested"><span class="title-number">7.7 </span><span class="title-name">Nested virtualization</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-virt-libvirt"><span class="title-number">II </span><span class="title-name">Managing virtual machines with <code class="systemitem">libvirt</code></span></a></span><ul><li><span class="chapter"><a href="#cha-libvirt-overview"><span class="title-number">8 </span><span class="title-name">Starting and stopping <code class="systemitem">libvirtd</code></span></a></span></li><li><span class="chapter"><a href="#cha-libvirt-host"><span class="title-number">9 </span><span class="title-name">Preparing the VM Host Server</span></a></span><ul><li><span class="sect1"><a href="#libvirt-host-network"><span class="title-number">9.1 </span><span class="title-name">Configuring networks</span></a></span></li><li><span class="sect1"><a href="#libvirt-host-storage"><span class="title-number">9.2 </span><span class="title-name">Configuring a storage pool</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-kvm-inst"><span class="title-number">10 </span><span class="title-name">Guest installation</span></a></span><ul><li><span class="sect1"><a href="#sec-libvirt-inst-vmm"><span class="title-number">10.1 </span><span class="title-name">GUI-based guest installation</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-inst-virt-install"><span class="title-number">10.2 </span><span class="title-name">Installing from the command line with <code class="command">virt-install</code></span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-inst-advanced"><span class="title-number">10.3 </span><span class="title-name">Advanced guest installation scenarios</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-libvirt-managing"><span class="title-number">11 </span><span class="title-name">Basic VM Guest management</span></a></span><ul><li><span class="sect1"><a href="#sec-libvirt-managing-list"><span class="title-number">11.1 </span><span class="title-name">Listing VM Guests</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-managing-console"><span class="title-number">11.2 </span><span class="title-name">Accessing the VM Guest via console</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-managing-status"><span class="title-number">11.3 </span><span class="title-name">Changing a VM Guest's state: start, stop, pause</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-manage-save"><span class="title-number">11.4 </span><span class="title-name">Saving and restoring the state of a VM Guest</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-managing-snapshots"><span class="title-number">11.5 </span><span class="title-name">Creating and managing snapshots</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-managing-delete"><span class="title-number">11.6 </span><span class="title-name">Deleting a VM Guest</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-admin-migrate"><span class="title-number">11.7 </span><span class="title-name">Migrating VM Guests</span></a></span></li><li><span class="sect1"><a href="#cha-libvirt-admin-monitor"><span class="title-number">11.8 </span><span class="title-name">Monitoring</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-libvirt-connect"><span class="title-number">12 </span><span class="title-name">Connecting and authorizing</span></a></span><ul><li><span class="sect1"><a href="#sec-libvirt-connect-auth"><span class="title-number">12.1 </span><span class="title-name">Authentication</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-connect-connecting"><span class="title-number">12.2 </span><span class="title-name">Connecting to a VM Host Server</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-connect-remote"><span class="title-number">12.3 </span><span class="title-name">Configuring remote connections</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-libvirt-storage"><span class="title-number">13 </span><span class="title-name">Advanced storage topics</span></a></span><ul><li><span class="sect1"><a href="#sec-libvirt-storage-locking"><span class="title-number">13.1 </span><span class="title-name">Locking disk files and block devices with <code class="systemitem">virtlockd</code></span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-storage-resize"><span class="title-number">13.2 </span><span class="title-name">Online resizing of guest block devices</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-storage-share"><span class="title-number">13.3 </span><span class="title-name">Sharing directories between host and guests (file system pass-through)</span></a></span></li><li><span class="sect1"><a href="#libvirt-storage-rbd"><span class="title-number">13.4 </span><span class="title-name">Using RADOS block devices with <code class="systemitem">libvirt</code></span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-libvirt-config-gui"><span class="title-number">14 </span><span class="title-name">Configuring virtual machines with Virtual Machine Manager</span></a></span><ul><li><span class="sect1"><a href="#sec-libvirt-config-machine-setup"><span class="title-number">14.1 </span><span class="title-name">Machine setup</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-storage"><span class="title-number">14.2 </span><span class="title-name">Storage</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-controllers"><span class="title-number">14.3 </span><span class="title-name">Controllers</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-networking"><span class="title-number">14.4 </span><span class="title-name">Networking</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-input"><span class="title-number">14.5 </span><span class="title-name">Input devices</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-video"><span class="title-number">14.6 </span><span class="title-name">Video</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-usb-redirectors"><span class="title-number">14.7 </span><span class="title-name">USB redirectors</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-miscellaneous"><span class="title-number">14.8 </span><span class="title-name">Miscellaneous</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-cdrom"><span class="title-number">14.9 </span><span class="title-name">Adding a CD/DVD-ROM device with Virtual Machine Manager</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-floppy"><span class="title-number">14.10 </span><span class="title-name">Adding a floppy device with Virtual Machine Manager</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-cdrom-media-change"><span class="title-number">14.11 </span><span class="title-name">Ejecting and changing floppy or CD/DVD-ROM media with Virtual Machine Manager</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-pci"><span class="title-number">14.12 </span><span class="title-name">Assigning a host PCI device to a VM Guest</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-usb"><span class="title-number">14.13 </span><span class="title-name">Assigning a host USB device to a VM Guest</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-libvirt-config-virsh"><span class="title-number">15 </span><span class="title-name">Configuring virtual machines with <code class="command">virsh</code></span></a></span><ul><li><span class="sect1"><a href="#sec-libvirt-config-editing-virsh"><span class="title-number">15.1 </span><span class="title-name">Editing the VM configuration</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-machinetype-virsh"><span class="title-number">15.2 </span><span class="title-name">Changing the machine type</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-hypervisor-features-virsh"><span class="title-number">15.3 </span><span class="title-name">Configuring hypervisor features</span></a></span></li><li><span class="sect1"><a href="#libvirt-cpu-virsh"><span class="title-number">15.4 </span><span class="title-name">Configuring CPU</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-boot-menu-virsh"><span class="title-number">15.5 </span><span class="title-name">Changing boot options</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-memory-virsh"><span class="title-number">15.6 </span><span class="title-name">Configuring memory allocation</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-pci-virsh"><span class="title-number">15.7 </span><span class="title-name">Adding a PCI device</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-usb-virsh"><span class="title-number">15.8 </span><span class="title-name">Adding a USB device</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-io"><span class="title-number">15.9 </span><span class="title-name">Adding SR-IOV devices</span></a></span></li><li><span class="sect1"><a href="#libvirt-config-listing-host-devs"><span class="title-number">15.10 </span><span class="title-name">Listing attached devices</span></a></span></li><li><span class="sect1"><a href="#libvirt-config-storage-virsh"><span class="title-number">15.11 </span><span class="title-name">Configuring storage devices</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-controllers-virsh"><span class="title-number">15.12 </span><span class="title-name">Configuring controller devices</span></a></span></li><li><span class="sect1"><a href="#libvirt-video-virsh"><span class="title-number">15.13 </span><span class="title-name">Configuring video devices</span></a></span></li><li><span class="sect1"><a href="#virsh-network-devices"><span class="title-number">15.14 </span><span class="title-name">Configuring network devices</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-direct"><span class="title-number">15.15 </span><span class="title-name">Using macvtap to share VM Host Server network interfaces</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-config-disable-virtio-mellon"><span class="title-number">15.16 </span><span class="title-name">Disabling a memory balloon device</span></a></span></li><li><span class="sect1"><a href="#virsh-video-dual-head"><span class="title-number">15.17 </span><span class="title-name">Configuring multiple monitors (dual head)</span></a></span></li><li><span class="sect1"><a href="#virsh-kvm-zseries-crypto"><span class="title-number">15.18 </span><span class="title-name">Crypto adapter pass-through to KVM guests on IBM Z</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-libvirt-manage-vagrant"><span class="title-number">16 </span><span class="title-name">Managing virtual machines with Vagrant</span></a></span><ul><li><span class="sect1"><a href="#sec-libvirt-vagrant-intro"><span class="title-number">16.1 </span><span class="title-name">Introduction to Vagrant</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-vagrant-sle"><span class="title-number">16.2 </span><span class="title-name">Vagrant boxes for SUSE Linux Enterprise</span></a></span></li><li><span class="sect1"><a href="#id-1.12.4.10.5"><span class="title-number">16.3 </span><span class="title-name">Further reading</span></a></span></li></ul></li><li><span class="chapter"><a href="#xen2kvm-migration"><span class="title-number">17 </span><span class="title-name">Xen to KVM migration guide</span></a></span><ul><li><span class="sect1"><a href="#x2k-v2v"><span class="title-number">17.1 </span><span class="title-name">Migration to KVM using <code class="command">virt-v2v</code></span></a></span></li><li><span class="sect1"><a href="#id-1.12.4.11.5"><span class="title-number">17.2 </span><span class="title-name">Xen to KVM manual migration</span></a></span></li><li><span class="sect1"><a href="#id-1.12.4.11.6"><span class="title-number">17.3 </span><span class="title-name">More information</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-virt-common"><span class="title-number">III </span><span class="title-name">Hypervisor-independent features</span></a></span><ul><li><span class="chapter"><a href="#cha-cachemodes"><span class="title-number">18 </span><span class="title-name">Disk cache modes</span></a></span><ul><li><span class="sect1"><a href="#what-is-disk-cache"><span class="title-number">18.1 </span><span class="title-name">What is a disk cache?</span></a></span></li><li><span class="sect1"><a href="#how-it-works-disk-cache"><span class="title-number">18.2 </span><span class="title-name">How does a disk cache work?</span></a></span></li><li><span class="sect1"><a href="#benefits-disk-cache"><span class="title-number">18.3 </span><span class="title-name">Benefits of disk caching</span></a></span></li><li><span class="sect1"><a href="#cachemodes-descr"><span class="title-number">18.4 </span><span class="title-name">Virtual disk cache modes</span></a></span></li><li><span class="sect1"><a href="#qemu-cachemodes-data-integrity"><span class="title-number">18.5 </span><span class="title-name">Cache modes and data integrity</span></a></span></li><li><span class="sect1"><a href="#sec-cache-mode-live-migration"><span class="title-number">18.6 </span><span class="title-name">Cache modes and live migration</span></a></span></li></ul></li><li><span class="chapter"><a href="#sec-kvm-managing-clock"><span class="title-number">19 </span><span class="title-name">VM Guest clock settings</span></a></span><ul><li><span class="sect1"><a href="#sec-kvm-managing-clock-kvm"><span class="title-number">19.1 </span><span class="title-name">KVM: using <code class="systemitem">kvm_clock</code></span></a></span></li><li><span class="sect1"><a href="#sec-xen-guests-suse-time"><span class="title-number">19.2 </span><span class="title-name">Xen virtual machine clock settings</span></a></span></li></ul></li><li><span class="chapter"><a href="#chap-guestfs"><span class="title-number">20 </span><span class="title-name">libguestfs</span></a></span><ul><li><span class="sect1"><a href="#sec-guestfs-intro"><span class="title-number">20.1 </span><span class="title-name">VM Guest manipulation overview</span></a></span></li><li><span class="sect1"><a href="#sec-guestfs-package"><span class="title-number">20.2 </span><span class="title-name">Package installation</span></a></span></li><li><span class="sect1"><a href="#sec-guestfs-tools"><span class="title-number">20.3 </span><span class="title-name">Guestfs tools</span></a></span></li><li><span class="sect1"><a href="#sec-guestfs-trouble"><span class="title-number">20.4 </span><span class="title-name">Troubleshooting</span></a></span></li><li><span class="sect1"><a href="#sec-guestfs-external-doc"><span class="title-number">20.5 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-qemu-ga"><span class="title-number">21 </span><span class="title-name">QEMU guest agent</span></a></span><ul><li><span class="sect1"><a href="#cha-qemu-ga-libvirt-general"><span class="title-number">21.1 </span><span class="title-name">Running QEMU GA commands</span></a></span></li><li><span class="sect1"><a href="#cha-qemu-ga-commands"><span class="title-number">21.2 </span><span class="title-name"><code class="command">virsh</code> commands that require QEMU GA</span></a></span></li><li><span class="sect1"><a href="#cha-qemu-ga-libvirt"><span class="title-number">21.3 </span><span class="title-name">Enhancing <code class="systemitem">libvirt</code> commands</span></a></span></li><li><span class="sect1"><a href="#cha-qemu-ga-moreinfo"><span class="title-number">21.4 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#tpm"><span class="title-number">22 </span><span class="title-name">Software TPM emulator</span></a></span><ul><li><span class="sect1"><a href="#tpm-introduction"><span class="title-number">22.1 </span><span class="title-name">Introduction</span></a></span></li><li><span class="sect1"><a href="#tpm-prerequisite"><span class="title-number">22.2 </span><span class="title-name">Prerequisites</span></a></span></li><li><span class="sect1"><a href="#tpm-installation"><span class="title-number">22.3 </span><span class="title-name">Installation</span></a></span></li><li><span class="sect1"><a href="#tpm-qemu"><span class="title-number">22.4 </span><span class="title-name">Using <code class="command">swtpm</code> with QEMU</span></a></span></li><li><span class="sect1"><a href="#tpm-libvirt"><span class="title-number">22.5 </span><span class="title-name">Using swtpm with <code class="systemitem">libvirt</code></span></a></span></li><li><span class="sect1"><a href="#tpm-ovmf"><span class="title-number">22.6 </span><span class="title-name">TPM measurement with OVMF firmware</span></a></span></li><li><span class="sect1"><a href="#qemu-tpm-resources"><span class="title-number">22.7 </span><span class="title-name">Resources</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-virt-xen"><span class="title-number">IV </span><span class="title-name">Managing virtual machines with Xen</span></a></span><ul><li><span class="chapter"><a href="#cha-xen-vhost"><span class="title-number">23 </span><span class="title-name">Setting up a virtual machine host</span></a></span><ul><li><span class="sect1"><a href="#sec-xen-vhost-best"><span class="title-number">23.1 </span><span class="title-name">Best practices and suggestions</span></a></span></li><li><span class="sect1"><a href="#sec-xen-vhost-memory"><span class="title-number">23.2 </span><span class="title-name">Managing Dom0 memory</span></a></span></li><li><span class="sect1"><a href="#sec-xen-vhost-netcard"><span class="title-number">23.3 </span><span class="title-name">Network card in fully virtualized guests</span></a></span></li><li><span class="sect1"><a href="#sec-xen-vhost-start"><span class="title-number">23.4 </span><span class="title-name">Starting the virtual machine host</span></a></span></li><li><span class="sect1"><a href="#sec-xen-vhost-pciback"><span class="title-number">23.5 </span><span class="title-name">PCI Pass-Through</span></a></span></li><li><span class="sect1"><a href="#sec-xen-vhost-usbpass"><span class="title-number">23.6 </span><span class="title-name">USB pass-through</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-xen-network"><span class="title-number">24 </span><span class="title-name">Virtual networking</span></a></span><ul><li><span class="sect1"><a href="#sec-xen-vdevices"><span class="title-number">24.1 </span><span class="title-name">Network devices for guest systems</span></a></span></li><li><span class="sect1"><a href="#sec-xen-net-host-route"><span class="title-number">24.2 </span><span class="title-name">Host-based routing in Xen</span></a></span></li><li><span class="sect1"><a href="#sec-xen-net-masquerade"><span class="title-number">24.3 </span><span class="title-name">Creating a masqueraded network setup</span></a></span></li><li><span class="sect1"><a href="#sec-xen-net-special"><span class="title-number">24.4 </span><span class="title-name">Special configurations</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-xen-manage"><span class="title-number">25 </span><span class="title-name">Managing a virtualization environment</span></a></span><ul><li><span class="sect1"><a href="#sec-xen-manage-xl"><span class="title-number">25.1 </span><span class="title-name">XL—Xen management tool</span></a></span></li><li><span class="sect1"><a href="#sec-xen-manage-autostart"><span class="title-number">25.2 </span><span class="title-name">Automatic start of guest domains</span></a></span></li><li><span class="sect1"><a href="#sec-xen-manage-events"><span class="title-number">25.3 </span><span class="title-name">Event actions</span></a></span></li><li><span class="sect1"><a href="#sec-xen-manage-tsc"><span class="title-number">25.4 </span><span class="title-name">Time Stamp Counter</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-suspend"><span class="title-number">25.5 </span><span class="title-name">Saving virtual machines</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-restore"><span class="title-number">25.6 </span><span class="title-name">Restoring virtual machines</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-state"><span class="title-number">25.7 </span><span class="title-name">Virtual machine states</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-xen-vbd"><span class="title-number">26 </span><span class="title-name">Block devices in Xen</span></a></span><ul><li><span class="sect1"><a href="#sec-xen-config-disk"><span class="title-number">26.1 </span><span class="title-name">Mapping physical storage to virtual disks</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-netdisk"><span class="title-number">26.2 </span><span class="title-name">Mapping network storage to virtual disk</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-filedisk"><span class="title-number">26.3 </span><span class="title-name">File-backed virtual disks and loopback devices</span></a></span></li><li><span class="sect1"><a href="#sec-xen-block-resize"><span class="title-number">26.4 </span><span class="title-name">Resizing block devices</span></a></span></li><li><span class="sect1"><a href="#sec-xen-block-advstoragescripts"><span class="title-number">26.5 </span><span class="title-name">Scripts for managing advanced storage scenarios</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-xen-config"><span class="title-number">27 </span><span class="title-name">Virtualization: configuration options and settings</span></a></span><ul><li><span class="sect1"><a href="#sec-xen-config-vcd"><span class="title-number">27.1 </span><span class="title-name">Virtual CD readers</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-remote-access"><span class="title-number">27.2 </span><span class="title-name">Remote access methods</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-vnc"><span class="title-number">27.3 </span><span class="title-name">VNC viewer</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-keyboard"><span class="title-number">27.4 </span><span class="title-name">Virtual keyboards</span></a></span></li><li><span class="sect1"><a href="#xen-config-cpupinning"><span class="title-number">27.5 </span><span class="title-name">Dedicating CPU resources</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-hvm"><span class="title-number">27.6 </span><span class="title-name">HVM features</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-scheduling"><span class="title-number">27.7 </span><span class="title-name">Virtual CPU scheduling</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-xen-admin"><span class="title-number">28 </span><span class="title-name">Administrative tasks</span></a></span><ul><li><span class="sect1"><a href="#sec-xen-config-bootloader"><span class="title-number">28.1 </span><span class="title-name">The boot loader program</span></a></span></li><li><span class="sect1"><a href="#sec-xen-config-sparse"><span class="title-number">28.2 </span><span class="title-name">Sparse image files and disk space</span></a></span></li><li><span class="sect1"><a href="#sec-xen-manage-migrate"><span class="title-number">28.3 </span><span class="title-name">Migrating Xen VM Guest systems</span></a></span></li><li><span class="sect1"><a href="#sec-xen-monitor"><span class="title-number">28.4 </span><span class="title-name">Monitoring Xen</span></a></span></li><li><span class="sect1"><a href="#sec-xen-admin-vhostmd"><span class="title-number">28.5 </span><span class="title-name">Providing host information for VM Guest systems</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-xen-xenstore"><span class="title-number">29 </span><span class="title-name">XenStore: configuration database shared between domains</span></a></span><ul><li><span class="sect1"><a href="#sec-xenstore-intro"><span class="title-number">29.1 </span><span class="title-name">Introduction</span></a></span></li><li><span class="sect1"><a href="#sec-xenstore-fsi"><span class="title-number">29.2 </span><span class="title-name">File system interface</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-xen-ha"><span class="title-number">30 </span><span class="title-name">Xen as a high-availability virtualization host</span></a></span><ul><li><span class="sect1"><a href="#sec-xen-ha-remote-storage"><span class="title-number">30.1 </span><span class="title-name">Xen HA with remote storage</span></a></span></li><li><span class="sect1"><a href="#sec-xen-ha-local-storage"><span class="title-number">30.2 </span><span class="title-name">Xen HA with local storage</span></a></span></li><li><span class="sect1"><a href="#sec-xen-ha-private-bridge"><span class="title-number">30.3 </span><span class="title-name">Xen HA and private bridges</span></a></span></li></ul></li><li><span class="chapter"><a href="#pv-to-fv"><span class="title-number">31 </span><span class="title-name">Xen: converting a paravirtual (PV) guest into a fully virtual (FV/HVM) guest</span></a></span></li></ul></li><li><span class="part"><a href="#part-virt-qemu"><span class="title-number">V </span><span class="title-name">Managing virtual machines with QEMU</span></a></span><ul><li><span class="chapter"><a href="#cha-qemu-overview"><span class="title-number">32 </span><span class="title-name">QEMU overview</span></a></span></li><li><span class="chapter"><a href="#cha-qemu-host"><span class="title-number">33 </span><span class="title-name">Setting up a KVM VM Host Server</span></a></span><ul><li><span class="sect1"><a href="#kvm-host-cpu"><span class="title-number">33.1 </span><span class="title-name">CPU support for virtualization</span></a></span></li><li><span class="sect1"><a href="#kvm-host-soft"><span class="title-number">33.2 </span><span class="title-name">Required software</span></a></span></li><li><span class="sect1"><a href="#kvm-host-virtio"><span class="title-number">33.3 </span><span class="title-name">KVM host-specific features</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-qemu-guest-inst"><span class="title-number">34 </span><span class="title-name">Guest installation</span></a></span><ul><li><span class="sect1"><a href="#cha-qemu-guest-inst-qemu-kvm"><span class="title-number">34.1 </span><span class="title-name">Basic installation with <code class="command">qemu-system-ARCH</code></span></a></span></li><li><span class="sect1"><a href="#cha-qemu-guest-inst-qemu-img"><span class="title-number">34.2 </span><span class="title-name">Managing disk images with <code class="command">qemu-img</code></span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-qemu-running"><span class="title-number">35 </span><span class="title-name">Running virtual machines with qemu-system-ARCH</span></a></span><ul><li><span class="sect1"><a href="#cha-qemu-running-basic"><span class="title-number">35.1 </span><span class="title-name">Basic <code class="command">qemu-system-ARCH</code> invocation</span></a></span></li><li><span class="sect1"><a href="#cha-qemu-running-gen-opts"><span class="title-number">35.2 </span><span class="title-name">General <code class="command">qemu-system-ARCH</code> options</span></a></span></li><li><span class="sect1"><a href="#cha-qemu-running-devices"><span class="title-number">35.3 </span><span class="title-name">Using devices in QEMU</span></a></span></li><li><span class="sect1"><a href="#cha-qemu-running-networking"><span class="title-number">35.4 </span><span class="title-name">Networking in QEMU</span></a></span></li><li><span class="sect1"><a href="#cha-qemu-running-vnc"><span class="title-number">35.5 </span><span class="title-name">Viewing a VM Guest with VNC</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-qemu-monitor"><span class="title-number">36 </span><span class="title-name">Virtual machine administration using QEMU monitor</span></a></span><ul><li><span class="sect1"><a href="#sec-qemu-monitor-access"><span class="title-number">36.1 </span><span class="title-name">Accessing monitor console</span></a></span></li><li><span class="sect1"><a href="#sec-qemu-monitor-get"><span class="title-number">36.2 </span><span class="title-name">Getting information about the guest system</span></a></span></li><li><span class="sect1"><a href="#sec-qemu-monitor-vnc-pw"><span class="title-number">36.3 </span><span class="title-name">Changing VNC password</span></a></span></li><li><span class="sect1"><a href="#sec-qemu-monitor-manage-dev"><span class="title-number">36.4 </span><span class="title-name">Managing devices</span></a></span></li><li><span class="sect1"><a href="#sec-qemu-monitor-keyboard"><span class="title-number">36.5 </span><span class="title-name">Controlling keyboard and mouse</span></a></span></li><li><span class="sect1"><a href="#sec-qemu-monitor-memory"><span class="title-number">36.6 </span><span class="title-name">Changing available memory</span></a></span></li><li><span class="sect1"><a href="#sec-qemu-monitor-virt-memory"><span class="title-number">36.7 </span><span class="title-name">Dumping virtual machine memory</span></a></span></li><li><span class="sect1"><a href="#sec-qemu-monitor-snapshots"><span class="title-number">36.8 </span><span class="title-name">Managing virtual machine snapshots</span></a></span></li><li><span class="sect1"><a href="#sec-qemu-monitor-suspend"><span class="title-number">36.9 </span><span class="title-name">Suspending and resuming virtual machine execution</span></a></span></li><li><span class="sect1"><a href="#sec-qemu-monitor-migrate"><span class="title-number">36.10 </span><span class="title-name">Live migration</span></a></span></li><li><span class="sect1"><a href="#qemu-monitor-qmp"><span class="title-number">36.11 </span><span class="title-name">QMP - QEMU machine protocol</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-virt-troubleshoot"><span class="title-number">VI </span><span class="title-name">Troubleshooting</span></a></span><ul><li><span class="chapter"><a href="#cha-virt-help"><span class="title-number">37 </span><span class="title-name">Integrated help and package documentation</span></a></span></li><li><span class="chapter"><a href="#cha-virt-logs"><span class="title-number">38 </span><span class="title-name">Gathering system information and logs</span></a></span><ul><li><span class="sect1"><a href="#sec-logs-libvirt"><span class="title-number">38.1 </span><span class="title-name"><code class="systemitem">libvirt</code> log controls</span></a></span></li></ul></li></ul></li><li><span class="glossary"><a href="#gloss-vt-glossary"><span class="title-name">Glossary</span></a></span></li><li><span class="appendix"><a href="#app-vmdp-driver"><span class="title-number">A </span><span class="title-name">Virtual machine drivers</span></a></span></li><li><span class="appendix"><a href="#app-gpu-passthru"><span class="title-number">B </span><span class="title-name">Configuring GPU Pass-Through for NVIDIA cards</span></a></span><ul><li><span class="sect1"><a href="#gpu-passthru-intro"><span class="title-number">B.1 </span><span class="title-name">Introduction</span></a></span></li><li><span class="sect1"><a href="#gpu-passthru-prerequisites"><span class="title-number">B.2 </span><span class="title-name">Prerequisites</span></a></span></li><li><span class="sect1"><a href="#gpu-passthru-host"><span class="title-number">B.3 </span><span class="title-name">Configuring the host</span></a></span></li><li><span class="sect1"><a href="#gpu-passthru-guest"><span class="title-number">B.4 </span><span class="title-name">Configuring the guest</span></a></span></li></ul></li><li><span class="appendix"><a href="#cha-xmtoxl"><span class="title-number">C </span><span class="title-name">XM, XL toolstacks, and the <code class="systemitem">libvirt</code> framework</span></a></span><ul><li><span class="sect1"><a href="#sec-xmtoxl-intro"><span class="title-number">C.1 </span><span class="title-name">Xen toolstacks</span></a></span></li><li><span class="sect1"><a href="#xen-xen2libvirt"><span class="title-number">C.2 </span><span class="title-name">Import Xen domain configuration into <code class="systemitem">libvirt</code></span></a></span></li><li><span class="sect1"><a href="#sec-xmvsxl"><span class="title-number">C.3 </span><span class="title-name">Differences between the <code class="command">xm</code> and <code class="command">xl</code> applications</span></a></span></li><li><span class="sect1"><a href="#sec-xmtoxl-links"><span class="title-number">C.4 </span><span class="title-name">External links</span></a></span></li><li><span class="sect1"><a href="#sec-libvirt-managing-export-Xen-xm"><span class="title-number">C.5 </span><span class="title-name">Saving a Xen guest configuration in an <code class="command">xm</code> compatible format</span></a></span></li></ul></li><li><span class="appendix"><a href="#id-1.12.13"><span class="title-number">D </span><span class="title-name">GNU licenses</span></a></span><ul><li><span class="sect1"><a href="#id-1.12.13.4"><span class="title-number">D.1 </span><span class="title-name">GNU Free Documentation License</span></a></span></li></ul></li></ul></div><div class="list-of-figures"><div class="toc-title">List of Figures</div><ul><li><span class="figure"><a href="#fig-xen-basics-arch"><span class="number">3.1 </span><span class="name">Xen virtualization architecture</span></a></span></li><li><span class="figure"><a href="#fig-kvm-basics-arch"><span class="number">4.1 </span><span class="name">KVM virtualization architecture</span></a></span></li><li><span class="figure"><a href="#id-1.12.3.7.5.3"><span class="number">6.1 </span><span class="name">System Role screen</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.3.4.5.6.3.2.2.2"><span class="number">9.1 </span><span class="name">Connection details</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.3.4.5.6.3.2.4.2"><span class="number">9.2 </span><span class="name">Create virtual network</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.4"><span class="number">14.1 </span><span class="name"><span class="guimenu">Details</span> view of a VM Guest</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.9.3.3"><span class="number">14.2 </span><span class="name">Overview details</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.9.3.5"><span class="number">14.3 </span><span class="name">VM Guest title and description</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.9.4.3"><span class="number">14.4 </span><span class="name">Performance</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.9.4.5"><span class="number">14.5 </span><span class="name">Statistics charts</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.9.5.3"><span class="number">14.6 </span><span class="name">Processor view</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.9.6.3"><span class="number">14.7 </span><span class="name">Memory view</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.9.7.3"><span class="number">14.8 </span><span class="name">Boot options</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.10.3.2.2"><span class="number">14.9 </span><span class="name">Add a new storage</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.11.3.2.2"><span class="number">14.10 </span><span class="name">Add a new controller</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.12.3.2.2"><span class="number">14.11 </span><span class="name">Add a new network interface</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.13.3.2.2"><span class="number">14.12 </span><span class="name">Add a new input device</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.14.3.3.1"><span class="number">14.13 </span><span class="name">Add a new video device</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.15.3.2.2"><span class="number">14.14 </span><span class="name">Add a new USB redirector</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.20.3.3.2.2"><span class="number">14.15 </span><span class="name">Adding a PCI device</span></a></span></li><li><span class="figure"><a href="#id-1.12.4.8.21.3.3.2.2"><span class="number">14.16 </span><span class="name">Adding a USB device</span></a></span></li><li><span class="figure"><a href="#fig-caching"><span class="number">18.1 </span><span class="name">Caching mechanism</span></a></span></li><li><span class="figure"><a href="#id-1.12.6.7.4.4"><span class="number">28.1 </span><span class="name">Boot loader settings</span></a></span></li><li><span class="figure"><a href="#id-1.12.7.3.6.3.2.2"><span class="number">33.1 </span><span class="name">Installing the KVM hypervisor and tools</span></a></span></li><li><span class="figure"><a href="#id-1.12.7.3.6.3.4.2"><span class="number">33.2 </span><span class="name">Network bridge</span></a></span></li><li><span class="figure"><a href="#id-1.12.7.5.5.5.5.6"><span class="number">35.1 </span><span class="name">QEMU window with SLES as VM Guest</span></a></span></li><li><span class="figure"><a href="#id-1.12.7.5.8.11"><span class="number">35.2 </span><span class="name">QEMU VNC session</span></a></span></li><li><span class="figure"><a href="#id-1.12.7.5.8.12.7"><span class="number">35.3 </span><span class="name">Authentication dialog in Remmina</span></a></span></li></ul></div><div class="list-of-tables"><div class="toc-title">List of Tables</div><ul><li><span class="table"><a href="#id-1.12.3.8.5.6.3"><span class="number">7.1 </span><span class="name">KVM VM limits</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.5.7.2"><span class="number">7.2 </span><span class="name">Xen VM limits</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.5.7.3"><span class="number">7.3 </span><span class="name">Xen host limits</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.6.3"><span class="number">7.4 </span><span class="name">The following SUSE host environments are supported</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.3.3"><span class="number">7.5 </span><span class="name">Offline supported migrating guests from SUSE Linux Enterprise Server 12 SP3</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.3.4"><span class="number">7.6 </span><span class="name">Offline supported migrating guests from SUSE Linux Enterprise Server 12 SP4</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.3.5"><span class="number">7.7 </span><span class="name">Offline supported migrating guests from SUSE Linux Enterprise Server 12 SP5</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.3.6"><span class="number">7.8 </span><span class="name">Offline supported migrating guests from SUSE Linux Enterprise Server 15 GA</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.3.7"><span class="number">7.9 </span><span class="name">Offline supported migrating guests from SUSE Linux Enterprise Server 15 SP1</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.3.8"><span class="number">7.10 </span><span class="name">Offline supported migrating guests from SUSE Linux Enterprise Server 15 SP2</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.4.3"><span class="number">7.11 </span><span class="name">Supported live-migrating guests from SLES 12 SP3</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.4.4"><span class="number">7.12 </span><span class="name">supported live-migrating guests from SLES 12 SP4</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.4.5"><span class="number">7.13 </span><span class="name">Supported live-migrating guests from SLES 12 SP5</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.4.6"><span class="number">7.14 </span><span class="name">Supported live-migrating guests from SLES 15</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.4.7"><span class="number">7.15 </span><span class="name">Supported live-migrating guests from SLES 15 SP1</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.4.8"><span class="number">7.16 </span><span class="name">Supported live-migrating guests from SLES 15 SP2</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.8.4.9"><span class="number">7.17 </span><span class="name">Supported live-migrating guests from SLES 15 SP3</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.9.3.2"><span class="number">7.18 </span><span class="name">Feature support—host (<code class="literal">Dom0</code>)</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.9.4.2"><span class="number">7.19 </span><span class="name">Feature support—paravirtualized guest</span></a></span></li><li><span class="table"><a href="#id-1.12.3.8.9.5.2"><span class="number">7.20 </span><span class="name">Feature support—fully virtualized guest</span></a></span></li><li><span class="table"><a href="#tab-xen-remote-storage"><span class="number">30.1 </span><span class="name">Xen remote storage</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.6.3"><span class="number">C.1 </span><span class="name">Notation conventions</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.7.3"><span class="number">C.2 </span><span class="name">New global options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.8.3"><span class="number">C.3 </span><span class="name">Common options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.9.3.3"><span class="number">C.4 </span><span class="name">Domain management removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.9.4.3"><span class="number">C.5 </span><span class="name">USB devices management removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.9.5.3"><span class="number">C.6 </span><span class="name">CPU management removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.9.6.3"><span class="number">C.7 </span><span class="name">Other options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.3.4"><span class="number">C.8 </span><span class="name"><code class="command">xl</code> <code class="option">create</code> Changed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.3.5"><span class="number">C.9 </span><span class="name"><code class="command">xm</code> <code class="option">create</code> Removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.3.6"><span class="number">C.10 </span><span class="name"><code class="command">xl</code> <code class="option">create</code> Added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.4.4"><span class="number">C.11 </span><span class="name"><code class="command">xl</code> <code class="option">console</code> Added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.5.3"><span class="number">C.12 </span><span class="name"><code class="command">xm</code> <code class="option">info</code> Removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.6.4"><span class="number">C.13 </span><span class="name"><code class="command">xm</code> <code class="option">dump-core</code> Removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.7.4"><span class="number">C.14 </span><span class="name"><code class="command">xm</code> <code class="option">list</code> Removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.7.5"><span class="number">C.15 </span><span class="name"><code class="command">xl</code> <code class="option">list</code> Added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.8.3"><span class="number">C.16 </span><span class="name"><code class="command">xl</code> <code class="option">mem-*</code> Changed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.9.4"><span class="number">C.17 </span><span class="name"><code class="command">xm</code> <code class="option">migrate</code> Removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.9.5"><span class="number">C.18 </span><span class="name"><code class="command">xl</code> <code class="option">migrate</code> Added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.10.4"><span class="number">C.19 </span><span class="name"><code class="command">xm</code> <code class="option">reboot</code> Removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.10.5"><span class="number">C.20 </span><span class="name"><code class="command">xl</code> <code class="option">reboot</code> Added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.10.8"><span class="number">C.21 </span><span class="name"><code class="command">xl</code> <code class="option">save</code> Added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.10.11"><span class="number">C.22 </span><span class="name"><code class="command">xl</code> <code class="option">restore</code> Added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.10.14"><span class="number">C.23 </span><span class="name"><code class="command">xm</code> <code class="option">shutdown</code> Removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.10.15"><span class="number">C.24 </span><span class="name"><code class="command">xl</code> <code class="option">shutdown</code> Added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.10.16"><span class="number">C.25 </span><span class="name"><code class="command">xl</code> <code class="option">trigger</code> Changed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.11.4"><span class="number">C.26 </span><span class="name"><code class="command">xm</code> <code class="option">sched-credit</code> Removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.11.5"><span class="number">C.27 </span><span class="name"><code class="command">xl</code> <code class="option">sched-credit</code> Added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.11.8"><span class="number">C.28 </span><span class="name"><code class="command">xm</code> <code class="option">sched-credit2</code> Removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.11.9"><span class="number">C.29 </span><span class="name"><code class="command">xl</code> <code class="option">sched-credit2</code> Added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.11.11"><span class="number">C.30 </span><span class="name"><code class="command">xm</code> <code class="option">sched-sedf</code> removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.11.12"><span class="number">C.31 </span><span class="name"><code class="command">xl</code> <code class="option">sched-sedf</code> added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.12.4"><span class="number">C.32 </span><span class="name"><code class="command">xm</code> <code class="option">cpupool-list</code> removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.12.7"><span class="number">C.33 </span><span class="name"><code class="command">xm</code> <code class="option">cpupool-create</code> removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.13.4"><span class="number">C.34 </span><span class="name"><code class="command">xl</code> <code class="option">pci-detach</code> added options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.13.5"><span class="number">C.35 </span><span class="name"><code class="command">xm</code> <code class="option">block-list</code> removed options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.13.6"><span class="number">C.36 </span><span class="name">Other options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.14.2"><span class="number">C.37 </span><span class="name">Network options</span></a></span></li><li><span class="table"><a href="#id-1.12.12.5.10.14.3"><span class="number">C.38 </span><span class="name"><code class="command">xl</code> <code class="option">network-attach</code> removed options</span></a></span></li><li><span class="table"><a href="#table-xmtoxl-new-options"><span class="number">C.39 </span><span class="name">New options</span></a></span></li></ul></div><div class="list-of-examples"><div class="toc-title">List of Examples</div><ul><li><span class="example"><a href="#ex-libvirt-net-nat"><span class="number">9.1 </span><span class="name">NAT-based network</span></a></span></li><li><span class="example"><a href="#id-1.12.4.3.4.5.7.6.9"><span class="number">9.2 </span><span class="name">Routed network</span></a></span></li><li><span class="example"><a href="#id-1.12.4.3.4.5.7.6.10"><span class="number">9.3 </span><span class="name">Isolated network</span></a></span></li><li><span class="example"><a href="#id-1.12.4.3.4.5.7.6.11"><span class="number">9.4 </span><span class="name">Using an existing bridge on VM Host Server</span></a></span></li><li><span class="example"><a href="#id-1.12.4.4.7.4.6.2.3"><span class="number">10.1 </span><span class="name">Loading kernel and initrd from HTTP server</span></a></span></li><li><span class="example"><a href="#ex-libvirt-inst-virt-install-example"><span class="number">10.2 </span><span class="name">Example of a <code class="command">virt-install</code> command line</span></a></span></li><li><span class="example"><a href="#id-1.12.4.5.12.5.6"><span class="number">11.1 </span><span class="name">Typical output of <code class="command">kvm_stat</code></span></a></span></li><li><span class="example"><a href="#id-1.12.4.9.3.3"><span class="number">15.1 </span><span class="name">Example XML configuration file</span></a></span></li><li><span class="example"><a href="#id-1.12.6.4.4.18.4"><span class="number">25.1 </span><span class="name">Guest domain configuration file for SLED 12: <code class="filename">/etc/xen/sled12.cfg</code></span></a></span></li><li><span class="example"><a href="#ex-qemu-virtfs-host"><span class="number">33.1 </span><span class="name">Exporting host's file system with VirtFS</span></a></span></li><li><span class="example"><a href="#ex-qemu-net-usermode-resctrict"><span class="number">35.1 </span><span class="name">Restricted user-mode networking</span></a></span></li><li><span class="example"><a href="#ex-qemu-net-usermode-iprange"><span class="number">35.2 </span><span class="name">User-mode networking with custom IP range</span></a></span></li><li><span class="example"><a href="#ex-qemu-net-usermode-netboot-tftp"><span class="number">35.3 </span><span class="name">User-mode networking with network-boot and TFTP</span></a></span></li><li><span class="example"><a href="#ex-qemu-net-usermode-hostfwd"><span class="number">35.4 </span><span class="name">User-mode networking with host port forwarding</span></a></span></li><li><span class="example"><a href="#ex-running-vnc-secure-pwd"><span class="number">35.5 </span><span class="name">Password authentication</span></a></span></li><li><span class="example"><a href="#ex-running-vnc-secure-x509"><span class="number">35.6 </span><span class="name">x509 certificate authentication</span></a></span></li><li><span class="example"><a href="#ex-running-vnc-secure-pwd-x509"><span class="number">35.7 </span><span class="name">x509 certificate and password authentication</span></a></span></li><li><span class="example"><a href="#ex-running-vnc-secure-sasl"><span class="number">35.8 </span><span class="name">SASL authentication</span></a></span></li><li><span class="example"><a href="#id-1.12.12.4.10"><span class="number">C.1 </span><span class="name">Converting Xen domain configuration to <code class="systemitem">libvirt</code></span></a></span></li></ul></div><div><div xml:lang="en" class="legalnotice" id="id-1.12.1.5"><p>
  Copyright © 2006–2024

  SUSE LLC and contributors. All rights reserved.
 </p><p>
  Permission is granted to copy, distribute and/or modify this document under
  the terms of the GNU Free Documentation License, Version 1.2 or (at your
  option) version 1.3; with the Invariant Section being this copyright notice
  and license. A copy of the license version 1.2 is included in the section
  entitled <span class="quote">“<span class="quote">GNU Free Documentation License</span>”</span>.
 </p><p>
  For SUSE trademarks, see
  <a class="link" href="https://www.suse.com/company/legal/" target="_blank">https://www.suse.com/company/legal/</a>. All
  third-party trademarks are the property of their respective owners. Trademark
  symbols (®, ™ etc.) denote trademarks of SUSE and its affiliates.
  Asterisks (*) denote third-party trademarks.
 </p><p>
  All information found in this book has been compiled with utmost attention to
  detail. However, this does not guarantee complete accuracy. Neither
  SUSE LLC, its affiliates, the authors nor the translators shall be
  held liable for possible errors or the consequences thereof.
 </p></div></div><section class="preface" id="cha-kvm" data-id-title="Preface"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number"> </span><span class="title-name">Preface</span></span> <a title="Permalink" class="permalink" href="#cha-kvm">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/kvm_intro.xml" title="Edit source document"> </a></div></div></div></div></div><section xml:lang="en" class="sect1" id="id-1.12.2.3" data-id-title="Available documentation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1 </span><span class="title-name">Available documentation</span></span> <a title="Permalink" class="permalink" href="#id-1.12.2.3">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/common_intro_available_doc.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.2.3.3.1"><span class="term">Online documentation</span></dt><dd><p>
     Our documentation is available online at <a class="link" href="https://documentation.suse.com" target="_blank">https://documentation.suse.com</a>.
     Browse or download the documentation in various formats.
    </p><div id="id-1.12.2.3.3.1.2.2" data-id-title="Latest updates" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Latest updates</div><p>
      The latest updates are usually available in the English-language version of this documentation.
     </p></div></dd><dt id="id-1.12.2.3.3.2"><span class="term">SUSE Knowledgebase</span></dt><dd><p>
     If you have run into an issue, also check out the Technical Information
     Documents (TIDs) that are available online at <a class="link" href="https://www.suse.com/support/kb/" target="_blank">https://www.suse.com/support/kb/</a>.
     Search the SUSE Knowledgebase for known solutions driven by customer need.
     </p></dd><dt id="id-1.12.2.3.3.3"><span class="term">Release notes</span></dt><dd><p>
     For release notes, see
     <a class="link" href="https://www.suse.com/releasenotes/" target="_blank">https://www.suse.com/releasenotes/</a>.
    </p></dd><dt id="id-1.12.2.3.3.4"><span class="term">In your system</span></dt><dd><p>
      For offline use, the release notes are also available under
      <code class="filename">/usr/share/doc/release-notes</code> on your system.
      The documentation for individual packages is available at
      <code class="filename">/usr/share/doc/packages</code>.
    </p><p>
      Many commands are also described in their <span class="emphasis"><em>manual
      pages</em></span>. To view them, run <code class="command">man</code>, followed
      by a specific command name. If the <code class="command">man</code> command is
      not installed on your system, install it with <code class="command">sudo zypper
      install man</code>.
    </p></dd></dl></div></section><section xml:lang="en" class="sect1" id="id-1.12.2.4" data-id-title="Improving the documentation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2 </span><span class="title-name">Improving the documentation</span></span> <a title="Permalink" class="permalink" href="#id-1.12.2.4">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/common_intro_feedback.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Your feedback and contributions to this documentation are welcome.
  The following channels for giving feedback are available:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.2.4.4.1"><span class="term">Service requests and support</span></dt><dd><p>
     For services and support options available for your product, see
     <a class="link" href="https://www.suse.com/support/" target="_blank">https://www.suse.com/support/</a>.
    </p><p>
     To open a service request, you need a SUSE subscription registered at
     SUSE Customer Center.
     Go to <a class="link" href="https://scc.suse.com/support/requests" target="_blank">https://scc.suse.com/support/requests</a>, log
     in, and click <span class="guimenu">Create New</span>.
    </p></dd><dt id="id-1.12.2.4.4.2"><span class="term">Bug reports</span></dt><dd><p>
     Report issues with the documentation at <a class="link" href="https://bugzilla.suse.com/" target="_blank">https://bugzilla.suse.com/</a>.
    </p><p>
     To simplify this process, click the <span class="guimenu">Report
     an issue</span> icon next to a headline in the HTML
     version of this document. This preselects the right product and
     category in Bugzilla and adds a link to the current section.
     You can start typing your bug report right away.
    </p><p>
     A Bugzilla account is required.
    </p></dd><dt id="id-1.12.2.4.4.3"><span class="term">Contributions</span></dt><dd><p>
     To contribute to this documentation, click the <span class="guimenu">Edit source
     document</span> icon next to a headline in the HTML version of
     this document. This will take you to the source code on GitHub, where you
     can open a pull request.</p><p>
     A GitHub account is required.
    </p><div id="id-1.12.2.4.4.3.2.3" data-id-title="Edit source document only available for English" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <span class="guimenu">Edit source document</span> only available for English</div><p>
      The <span class="guimenu">Edit source document</span> icons are only available for the
      English version of each document. For all other languages, use the
      <span class="guimenu">Report an issue</span> icons instead.
     </p></div><p>
     For more information about the documentation environment used for this
     documentation, see the repository's README.
    </p></dd><dt id="id-1.12.2.4.4.4"><span class="term">Mail</span></dt><dd><p>
     You can also report errors and send feedback concerning the
     documentation to &lt;<a class="email" href="mailto:doc-team@suse.com">doc-team@suse.com</a>&gt;. Include the
     document title, the product version, and the publication date of the
     document. Additionally, include the relevant section number and title (or
     provide the URL) and provide a concise description of the problem.
    </p></dd></dl></div></section><section xml:lang="en" class="sect1" id="id-1.12.2.5" data-id-title="Documentation conventions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3 </span><span class="title-name">Documentation conventions</span></span> <a title="Permalink" class="permalink" href="#id-1.12.2.5">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/common_intro_convention.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following notices and typographic conventions are used in this
  document:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    <code class="filename">/etc/passwd</code>: Directory names and file names
   </p></li><li class="listitem"><p>
    <em class="replaceable">PLACEHOLDER</em>: Replace
    <em class="replaceable">PLACEHOLDER</em> with the actual value
   </p></li><li class="listitem"><p>
    <code class="envar">PATH</code>: An environment variable
   </p></li><li class="listitem"><p>
    <code class="command">ls</code>, <code class="option">--help</code>: Commands, options, and
    parameters
   </p></li><li class="listitem"><p>
    <code class="systemitem">user</code>: The name of a user or group
   </p></li><li class="listitem"><p>
    <span class="package">package_name</span>: The name of a software package
   </p></li><li class="listitem"><p>
    <span class="keycap">Alt</span>, <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F1</span>: A key to press or a key combination. Keys
    are shown in uppercase as on a keyboard.
   </p></li><li class="listitem"><p>
    <span class="guimenu">File</span>, <span class="guimenu">File</span> › <span class="guimenu">Save
    As</span>: menu items, buttons
   </p></li><li class="listitem"><p><strong class="arch-arrow-start">AMD/Intel</strong>
    This paragraph is only relevant for the AMD64/Intel 64 architectures. The
    arrows mark the beginning and the end of the text block.
   <strong class="arch-arrow-end"> </strong></p><p><strong class="arch-arrow-start">IBM Z, POWER</strong>
    This paragraph is only relevant for the architectures
    <code class="literal">IBM Z</code> and <code class="literal">POWER</code>. The arrows
    mark the beginning and the end of the text block.
   <strong class="arch-arrow-end"> </strong></p></li><li class="listitem"><p>
    <em class="citetitle">Chapter 1, <span class="quote">“<span class="quote">Example chapter</span>”</span></em>:
    A cross-reference to another chapter in this guide.
   </p></li><li class="listitem"><p>
    Commands that must be run with <code class="systemitem">root</code> privileges. You can also
    prefix these commands with the <code class="command">sudo</code> command to run them
    as a non-privileged user:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">command</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">command</code></pre></div></li><li class="listitem"><p>
    Commands that can be run by non-privileged users:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">command</code></pre></div></li><li class="listitem"><p>
    Commands can be split into two or multiple lines by a backslash character
    (<code class="literal">\</code>) at the end of a line. The backslash informs the shell that
    the command invocation will continue after the line's end:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">echo</code> a b \
c d</pre></div></li><li class="listitem"><p>
     A code block that shows both the command (preceded by a prompt)
     and the respective output returned by the shell:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">command</code>
output</pre></div></li><li class="listitem"><p>
    Notices
   </p><div id="id-1.12.2.5.4.15.2" data-id-title="Warning notice" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Warning notice</div><p>
     Vital information you must be aware of before proceeding. Warns you about
     security issues, potential loss of data, damage to hardware, or physical
     hazards.
    </p></div><div id="id-1.12.2.5.4.15.3" data-id-title="Important notice" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Important notice</div><p>
     Important information you should be aware of before proceeding.
    </p></div><div id="id-1.12.2.5.4.15.4" data-id-title="Note notice" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Note notice</div><p>
     Additional information, for example about differences in software
     versions.
    </p></div><div id="id-1.12.2.5.4.15.5" data-id-title="Tip notice" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Tip notice</div><p>
     Helpful information, like a guideline or a piece of practical advice.
    </p></div></li><li class="listitem"><p>
    Compact Notices
   </p><div id="id-1.12.2.5.4.16.2" class="admonition note compact"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><p>
     Additional information, for example about differences in software
     versions.
    </p></div><div id="id-1.12.2.5.4.16.3" class="admonition tip compact"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><p>
     Helpful information, like a guideline or a piece of practical advice.
    </p></div></li></ul></div></section><section xml:lang="en" class="sect1" id="id-1.12.2.6" data-id-title="Support"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4 </span><span class="title-name">Support</span></span> <a title="Permalink" class="permalink" href="#id-1.12.2.6">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Find the support statement for <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> and general information about
  technology previews below.
  For details about the product lifecycle, see
  <a class="link" href="https://www.suse.com/lifecycle" target="_blank">https://www.suse.com/lifecycle</a>.
 </p><p>
  If you are entitled to support, find details on how to collect information
  for a support ticket at
  <a class="link" href="https://documentation.suse.com/sles-15/html/SLES-all/cha-adm-support.html" target="_blank">https://documentation.suse.com/sles-15/html/SLES-all/cha-adm-support.html</a>.
 </p><section class="sect2" id="id-1.12.2.6.5" data-id-title="Support statement for SUSE Linux Enterprise Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1 </span><span class="title-name">Support statement for <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span></span> <a title="Permalink" class="permalink" href="#id-1.12.2.6.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To receive support, you need an appropriate subscription with SUSE.
   To view the specific support offers available to you, go to
   <a class="link" href="https://www.suse.com/support/" target="_blank">https://www.suse.com/support/</a> and select your product.
  </p><p>
   The support levels are defined as follows:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.2.6.5.4.1"><span class="term">L1</span></dt><dd><p>
      Problem determination, which means technical support designed to provide
      compatibility information, usage support, ongoing maintenance,
      information gathering and basic troubleshooting using available
      documentation.
     </p></dd><dt id="id-1.12.2.6.5.4.2"><span class="term">L2</span></dt><dd><p>
      Problem isolation, which means technical support designed to analyze
      data, reproduce customer problems, isolate a problem area and provide a
      resolution for problems not resolved by Level 1 or prepare for
      Level 3.
     </p></dd><dt id="id-1.12.2.6.5.4.3"><span class="term">L3</span></dt><dd><p>
      Problem resolution, which means technical support designed to resolve
      problems by engaging engineering to resolve product defects which have
      been identified by Level 2 Support.
     </p></dd></dl></div><p>
   For contracted customers and partners, <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is delivered with L3
   support for all packages, except for the following:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Technology previews.
    </p></li><li class="listitem"><p>
     Sound, graphics, fonts, and artwork.
    </p></li><li class="listitem"><p>
     Packages that require an additional customer contract.
    </p></li><li class="listitem"><p>
     Some packages shipped as part of the module <span class="emphasis"><em>Workstation
     Extension</em></span> are L2-supported only.
    </p></li><li class="listitem"><p>
     Packages with names ending in <span class="package">-devel</span> (containing header
     files and similar developer resources) will only be supported together
     with their main packages.
    </p></li></ul></div><p>
   SUSE will only support the usage of original packages.
   That is, packages that are unchanged and not recompiled.
  </p></section><section class="sect2" id="id-1.12.2.6.6" data-id-title="Technology previews"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.2 </span><span class="title-name">Technology previews</span></span> <a title="Permalink" class="permalink" href="#id-1.12.2.6.6">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Technology previews are packages, stacks, or features delivered by SUSE
   to provide glimpses into upcoming innovations.
   Technology previews are included for your convenience to give you a chance
   to test new technologies within your environment.
   We would appreciate your feedback.
   If you test a technology preview, please contact your SUSE representative
   and let them know about your experience and use cases.
   Your input is helpful for future development.
  </p><p>
   Technology previews have the following limitations:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Technology previews are still in development.
     Therefore, they may be functionally incomplete, unstable, or otherwise
     <span class="emphasis"><em>not</em></span> suitable for production use.
    </p></li><li class="listitem"><p>
     Technology previews are <span class="emphasis"><em>not</em></span> supported.
    </p></li><li class="listitem"><p>
     Technology previews may only be available for specific hardware
     architectures.
    </p></li><li class="listitem"><p>
     Details and functionality of technology previews are subject to change.
     As a result, upgrading to subsequent releases of a technology preview may
     be impossible and require a fresh installation.
    </p></li><li class="listitem"><p>
     SUSE may discover that a preview does not meet customer or market needs,
     or does not comply with enterprise standards.
     Technology previews can be removed from a product at any time.
     SUSE does not commit to providing a supported version of such
     technologies in the future.
    </p></li></ul></div><p>
   For an overview of technology previews shipped with your product, see the
   release notes at <a class="link" href="https://www.suse.com/releasenotes" target="_blank">https://www.suse.com/releasenotes</a>.
  </p></section></section></section><div class="part" id="part-virt-intro" data-id-title="Introduction"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part I </span><span class="title-name">Introduction </span></span><a title="Permalink" class="permalink" href="#part-virt-intro">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/book_virtualization.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#chap-virtualization-introduction"><span class="title-number">1 </span><span class="title-name">Virtualization technology</span></a></span></li><dd class="toc-abstract"><p>
    Virtualization is a technology that provides a way for a machine (Host) to
    run another operating system (guest virtual machines) on top of the host
    operating system.
   </p></dd><li><span class="chapter"><a href="#cha-virtualization-scenarios"><span class="title-number">2 </span><span class="title-name">Virtualization scenarios</span></a></span></li><dd class="toc-abstract"><p>
    Virtualization provides several useful capabilities to your
    organization: more efficient hardware use, support for legacy software,
    operating system isolation, live migration, disaster recovery, and 
    load balancing. 
   </p></dd><li><span class="chapter"><a href="#cha-xen-basics"><span class="title-number">3 </span><span class="title-name">Introduction to Xen virtualization</span></a></span></li><dd class="toc-abstract"><p>
  This chapter introduces and explains the components and technologies you
  need to understand to set up and manage a Xen-based virtualization
  environment.
 </p></dd><li><span class="chapter"><a href="#cha-kvm-intro"><span class="title-number">4 </span><span class="title-name">Introduction to KVM virtualization</span></a></span></li><dd class="toc-abstract"><p/></dd><li><span class="chapter"><a href="#cha-tools-intro"><span class="title-number">5 </span><span class="title-name">Virtualization tools</span></a></span></li><dd class="toc-abstract"><p>
    <code class="systemitem">libvirt</code> is a library that provides a common API for managing popular
    virtualization solutions, among them KVM and Xen. The library
    provides a normalized management API for these virtualization solutions,
    allowing a stable, cross-hypervisor interface for higher-level management
    tools. The library also provides APIs for management of virtual networks
    and storage on the VM Host Server. The configuration of each VM Guest is stored
    in an XML file.
   </p><p>
    With <code class="systemitem">libvirt</code> you can also manage your VM Guests remotely. It supports
    TLS encryption, x509 certificates and authentication with SASL. This
    enables managing VM Host Servers centrally from a single workstation,
    alleviating the need to access each VM Host Server individually.
   </p><p>
    Using the <code class="systemitem">libvirt</code>-based tools is the recommended way of managing
    VM Guests. Interoperability between <code class="systemitem">libvirt</code> and <code class="systemitem">libvirt</code>-based
    applications has been tested and is an essential part of SUSE's support
    stance.
   </p></dd><li><span class="chapter"><a href="#cha-vt-installation"><span class="title-number">6 </span><span class="title-name">Installation of virtualization components</span></a></span></li><dd class="toc-abstract"><p>
  You can install the virtualization tools required to run a VM Host Server in two ways:
 </p></dd><li><span class="chapter"><a href="#cha-virt-support"><span class="title-number">7 </span><span class="title-name">Virtualization limits and support</span></a></span></li><dd class="toc-abstract"><p>QEMU is only supported when used for virtualization together with the KVM or Xen hypervisors. The TCG accelerator is not supported, even when it is distributed within SUSE products. Users must not rely on QEMU TCG to provide guest isolation, or for any security guarantees. See also https://qemu-proj…</p></dd></ul></div><section class="chapter" id="chap-virtualization-introduction" data-id-title="Virtualization technology"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">1 </span><span class="title-name">Virtualization technology</span></span> <a title="Permalink" class="permalink" href="#chap-virtualization-introduction">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_introduction.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Virtualization is a technology that provides a way for a machine (Host) to
    run another operating system (guest virtual machines) on top of the host
    operating system.
   </p></div></div></div></div><section class="sect1" id="sec-virtualization-introduction-overview" data-id-title="Overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.1 </span><span class="title-name">Overview</span></span> <a title="Permalink" class="permalink" href="#sec-virtualization-introduction-overview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_introduction.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> includes the latest open source virtualization technologies,
   Xen and KVM. With these hypervisors, <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> can be used to
   provision, de-provision, install, monitor and manage multiple virtual
   machines (VM Guests) on a single physical system (for more information see
   <a class="xref" href="#gloss-vt-hypervisor" title="Hypervisor">Hypervisor</a>).  <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> can create virtual
   machines running both modified, highly tuned, paravirtualized operating
   systems and fully virtualized unmodified operating systems.
  </p><p>
   The primary component of the operating system that enables virtualization
   is a hypervisor (or virtual machine manager), which is a layer of software
   that runs directly on server hardware. It controls platform resources,
   sharing them among multiple VM Guests and their operating systems by
   presenting virtualized hardware interfaces to each VM Guest.
  </p><p>
   <span class="phrase">SUSE Linux Enterprise is an enterprise-class</span> Linux server operating system that
   offers two types of hypervisors: Xen and KVM.
  </p><p>
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> with Xen or KVM acts as a virtualization host server
   (<a class="xref" href="#gloss-vt-vhs" title="VHS">VHS</a>) that supports VM Guests with its own guest
   operating systems. The SUSE VM Guest architecture consists of a
   hypervisor and management components that constitute the VHS, which runs
   many application-hosting VM Guests.
  </p><p>
   In Xen, the management components run in a privileged VM Guest often
   called <a class="xref" href="#gloss-vt-dom0" title="Dom0">Dom0</a>. In KVM, where the Linux kernel
   acts as the hypervisor, the management components run directly on the VHS.
  </p></section><section class="sect1" id="sec-virtualization-introduction-benefits" data-id-title="Virtualization benefits"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.2 </span><span class="title-name">Virtualization benefits</span></span> <a title="Permalink" class="permalink" href="#sec-virtualization-introduction-benefits">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_introduction.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Virtualization brings a lot of advantages while providing the same
   service as a hardware server.
  </p><p>
   First, it reduces the cost of your infrastructure. Servers are mainly
   used to provide a service to a customer, and a virtualized operating
   system can provide the same service, with:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Less hardware: You can run several operating system on one host, so all
     hardware maintenance will be reduced.
    </p></li><li class="listitem"><p>
     Less power/cooling: Less hardware means you do not need to invest more
     in electric power, backup power, and cooling if you need more service.
    </p></li><li class="listitem"><p>
     Save space: Your data center space will be saved because you do not need
     more hardware servers (less servers than service running).
    </p></li><li class="listitem"><p>
     Less management: Using a VM Guest simplifies the administration of
     your infrastructure.
    </p></li><li class="listitem"><p>
     Agility and productivity: Virtualization provides
     <span class="emphasis"><em>migration</em></span> capabilities, <span class="emphasis"><em>live
     migration</em></span> and <span class="emphasis"><em>snapshots</em></span>. These features
     reduce downtime, and bring an easy way to move your service from one
     place to another without any service interruption.
    </p></li></ul></div></section><section class="sect1" id="sec-virtualization-introduction-fvpv" data-id-title="Virtualization modes"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.3 </span><span class="title-name">Virtualization modes</span></span> <a title="Permalink" class="permalink" href="#sec-virtualization-introduction-fvpv">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_introduction.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Guest operating systems are hosted on virtual machines in either full
   virtualization (FV) mode or paravirtual (PV) mode. Each virtualization
   mode has advantages and disadvantages.
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Full virtualization mode lets virtual machines run unmodified operating
     systems, such as Windows* Server 2003. It can use either Binary
     Translation or <a class="xref" href="#gloss-vt-hwassisted" title="hardware-assisted">hardware-assisted</a> virtualization
     technology, such as AMD* Virtualization or Intel* Virtualization
     Technology. Using hardware assistance allows for better performance on
     processors that support it.
    </p><p>
     Some guest operating systems hosted in full virtualization mode can be
     configured to use drivers from the SUSE Virtual Machine Drivers Pack
     (VMDP) instead of
     drivers originating from the operating system. Running virtual machine
     drivers improves performance dramatically on guest operating systems,
     such as Windows Server 2003. For more information, see
     <a class="xref" href="#app-vmdp-driver" title="Appendix A. Virtual machine drivers">Appendix A, <em>Virtual machine drivers</em></a>.
    </p></li><li class="listitem"><p>
     To be able to run under paravirtual mode, guest operating systems
     usually need to be modified for the virtualization environment. However,
     operating systems running in paravirtual mode have better performance
     than those running under full virtualization.
    </p><p>
     Operating systems currently modified to run in paravirtual mode are
     called <span class="emphasis"><em>paravirtualized operating systems</em></span>
     and include <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> and NetWare® 6.5 SP8.
    </p></li></ul></div></section><section class="sect1" id="sec-vt-io" data-id-title="I/O virtualization"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.4 </span><span class="title-name">I/O virtualization</span></span> <a title="Permalink" class="permalink" href="#sec-vt-io">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_io.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  VM Guests not only share CPU and memory resources of the host system, but
  also the I/O subsystem. Because software I/O virtualization techniques
  deliver less performance than bare metal, hardware solutions that deliver
  almost <span class="quote">“<span class="quote">native</span>”</span> performance have been developed recently.
  <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> supports the following I/O virtualization techniques:
 </p><div class="variablelist"><dl class="variablelist"><dt id="vt-io-fullv"><span class="term">Full virtualization</span></dt><dd><p>
     Fully Virtualized (FV) drivers emulate widely supported real devices,
     which can be used with an existing driver in the VM Guest. The guest is
     also called <span class="emphasis"><em>Hardware Virtual Machine</em></span> (HVM).
     Since the physical device on the VM Host Server may differ from the emulated
     one, the hypervisor needs to process all I/O operations before handing
     them over to the physical device. Therefore all I/O operations need to
     traverse two software layers, a process that not only significantly
     impacts I/O performance, but also consumes CPU time.
    </p></dd><dt id="vt-io-parav"><span class="term">Paravirtualization</span></dt><dd><p>
     Paravirtualization (PV) allows direct communication between the hypervisor
     and the VM Guest. With less overhead involved, performance is much better
     than with full virtualization. However, paravirtualization requires either
     the guest operating system to be modified to support the
     paravirtualization API or paravirtualized drivers. <span class="phrase">See <a class="xref" href="#sec-kvm-requires-guests-virt-drivers" title="7.4.1. Availability of paravirtualized drivers">Section 7.4.1, “Availability of paravirtualized drivers”</a>
     for a list of guest operating systems supporting
     paravirtualization.</span>
    </p></dd><dt id="vt-io-pvhvm"><span class="term">PVHVM</span></dt><dd><p>
     This type of virtualization enhances HVM (see
     <a class="xref" href="#vt-io-fullv">Full virtualization</a>) with paravirtualized (PV) drivers, and PV
     interrupt and timer handling.
    </p></dd><dt id="vt-io-vfio"><span class="term">VFIO</span></dt><dd><p>
     VFIO stands for <span class="emphasis"><em>Virtual Function I/O</em></span> and is a new
     user-level driver framework for Linux. It replaces the traditional KVM
     PCI Pass-Through device assignment. The VFIO driver exposes direct device access
     to user space in a secure memory
     (<a class="xref" href="#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a>) protected environment.
     With VFIO, a VM Guest can directly access hardware devices on the
     VM Host Server (pass-through), avoiding performance issues caused by emulation
     in performance critical paths. This method does not allow to share
     devices—each device can only be assigned to a single VM Guest. VFIO
     needs to be supported by the VM Host Server CPU, chipset and the BIOS/EFI.
    </p><p>
     Compared to the legacy KVM PCI device assignment, VFIO has the following
     advantages:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       Resource access is compatible with UEFI Secure Boot.
      </p></li><li class="listitem"><p>
       Device is isolated and its memory access protected.
      </p></li><li class="listitem"><p>
       Offers a user space device driver with more flexible device ownership
       model.
      </p></li><li class="listitem"><p>
       Is independent of KVM technology, and not bound to x86 architecture
       only.
      </p></li></ul></div><p>
     In <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> the USB and PCI pass-through methods of device assignment
     are considered deprecated and are superseded by the VFIO model.
   </p></dd><dt id="vt-io-sriov"><span class="term">SR-IOV</span></dt><dd><p>
     The latest I/O virtualization technique, Single Root I/O Virtualization
     SR-IOV combines the benefits of the aforementioned
     techniques—performance and the ability to share a device with
     several VM Guests. SR-IOV requires special I/O devices, that are capable
     of replicating resources so they appear as multiple separate devices. Each
     such <span class="quote">“<span class="quote">pseudo</span>”</span> device can be directly used by a single guest.
     However, for network cards for example the number of concurrent queues
     that can be used is limited, potentially reducing performance for the
     VM Guest compared to paravirtualized drivers. On the VM Host Server, SR-IOV
     must be supported by the I/O device, the CPU and chipset, the BIOS/EFI and
     the hypervisor—for setup instructions see
     <a class="xref" href="#sec-libvirt-config-pci" title="14.12. Assigning a host PCI device to a VM Guest">Section 14.12, “Assigning a host PCI device to a VM Guest”</a>.

    </p></dd></dl></div><div id="ann-vt-io-require" data-id-title="Requirements for VFIO and SR-IOV" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Requirements for VFIO and SR-IOV</div><p>
   To be able to use the VFIO and SR-IOV features, the VM Host Server needs to
   fulfill the following requirements:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     IOMMU needs to be enabled in the BIOS/EFI.
    </p></li><li class="listitem"><p>
     For Intel CPUs, the kernel parameter <code class="literal">intel_iommu=on</code>
     needs to be provided on the kernel command line. For more information,
     see <span class="intraxref">Book “Administration Guide”, Chapter 14 “The boot loader GRUB 2”, Section 14.3.3.2 “<span class="guimenu">Kernel Parameters</span> tab”</span>.
    </p></li><li class="listitem"><p>
     The VFIO infrastructure needs to be available. This can be achieved by
     loading the kernel module
     <code class="systemitem">vfio_pci</code>. For more information,
     see <span class="intraxref">Book “Administration Guide”, Chapter 15 “The <code class="systemitem">systemd</code> daemon”, Section 15.6.4 “Loading kernel modules”</span>.
    </p></li></ul></div></div></section></section><section class="chapter" id="cha-virtualization-scenarios" data-id-title="Virtualization scenarios"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">2 </span><span class="title-name">Virtualization scenarios</span></span> <a title="Permalink" class="permalink" href="#cha-virtualization-scenarios">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_scenarios.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Virtualization provides several useful capabilities to your
    organization: more efficient hardware use, support for legacy software,
    operating system isolation, live migration, disaster recovery, and 
    load balancing. 
   </p></div></div></div></div><section class="sect1" id="sec-virtualization-scenarios-capabilities" data-id-title="Server consolidation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.1 </span><span class="title-name">Server consolidation</span></span> <a title="Permalink" class="permalink" href="#sec-virtualization-scenarios-capabilities">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Many servers can be replaced by one big physical server, so that hardware is
   consolidated, and guest operating systems are converted to virtual machines.
   This also supports running legacy software on new hardware.
   
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Better usage of resources that were not running at 100%
    </p></li><li class="listitem"><p>
     Fewer server locations needed
    </p></li><li class="listitem"><p>
     More efficient use of computer resources: multiple workloads on the same server
    </p></li><li class="listitem"><p>
     Simplification of data center infrastructure
    </p></li><li class="listitem"><p>
     Simplifies moving workloads to other hosts, avoiding service downtime
    </p></li><li class="listitem"><p>
     Faster and agile virtual machine provisioning.
    </p></li><li class="listitem"><p>
     Multiple guest operating systems can run on a single host
    </p></li></ul></div><div id="id-1.12.3.3.3.4" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>Server consolidation requires special attention to the following points:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Maintenance windows should be carefully planned
     </p></li><li class="listitem"><p>
      Storage is key: it must be able to support migration and growing disk usage
     </p></li><li class="listitem"><p>
      You must verify that your servers can support the additional workloads
     </p></li></ul></div></div></section><section class="sect1" id="id-1.12.3.3.4" data-id-title="Isolation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.2 </span><span class="title-name">Isolation</span></span> <a title="Permalink" class="permalink" href="#id-1.12.3.3.4">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Guest operating systems are fully isolated from the host
   running them. Therefore, if there are problems inside virtual machines, the host is
   not harmed. Also, problems inside one VM do not affect other VMs. No data
   is shared between VMs.
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     UEFI Secure Boot can be used for VMs.
    </p></li><li class="listitem"><p>
     KSM should be avoided. For more details on KSM, refer to
     <a class="xref" href="#gloss-vt-acronym-ksm" title="KSM">KSM</a>.
    </p></li><li class="listitem"><p>
     Individual CPU cores can be assigned to VMs.
    </p></li><li class="listitem"><p>
     Hyper-threading (HT) should be disabled to avoid potential security issues.
    </p></li><li class="listitem"><p>
     VM should not share network, storage, or network hardware.
    </p></li><li class="listitem"><p>
     Use of advanced hypervisor features such as PCI pass-through or NUMA will
     adversely affect VM migration capabilities.
    </p></li><li class="listitem"><p>
     Use of paravirtualization and <code class="literal">virtio</code> drivers will
     generally improve VM performance and efficiency.
    </p></li></ul></div><p>
    AMD provides some specific features regarding the security of virtualization.
    
   </p></section><section class="sect1" id="id-1.12.3.3.5" data-id-title="Disaster recovery"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.3 </span><span class="title-name">Disaster recovery</span></span> <a title="Permalink" class="permalink" href="#id-1.12.3.3.5">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The hypervisor can make snapshots of VMs, enabling restoration
   to a known good state, or to any desired earlier state. Since   
   <a class="xref" href="#gloss-vt-virtualized" title="Virtualized">Virtualized</a> OSes are less dependent on
   hardware configuration than those running directly on bare metal,
   these snapshots can be restored onto different server hardware so
   long as it is running the same hypervisor.
  </p></section><section class="sect1" id="id-1.12.3.3.6" data-id-title="Dynamic load balancing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.4 </span><span class="title-name">Dynamic load balancing</span></span> <a title="Permalink" class="permalink" href="#id-1.12.3.3.6">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Live migration provides a simple way to load-balance your
   services across your infrastructure, by moving VMs from
   busy hosts to those with spare capacity, on demand.
  </p></section></section><section class="chapter" id="cha-xen-basics" data-id-title="Introduction to Xen virtualization"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">3 </span><span class="title-name">Introduction to Xen virtualization</span></span> <a title="Permalink" class="permalink" href="#cha-xen-basics">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_basics.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This chapter introduces and explains the components and technologies you
  need to understand to set up and manage a Xen-based virtualization
  environment.
 </p><section class="sect1" id="sec-xen-basics-components" data-id-title="Basic components"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.1 </span><span class="title-name">Basic components</span></span> <a title="Permalink" class="permalink" href="#sec-xen-basics-components">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_basics.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The basic components of a Xen-based virtualization environment are
   the <span class="emphasis"><em>Xen hypervisor</em></span>, the
   <span class="emphasis"><em>Dom0</em></span>, any number of other
   <span class="emphasis"><em>VM Guests</em></span>, and the tools, commands, and
   configuration files that let you manage virtualization. Collectively, the
   physical computer running all these components is called a
   <span class="emphasis"><em>VM Host Server</em></span> because together these components form a
   platform for hosting virtual machines.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.3.4.4.3.1"><span class="term">The Xen hypervisor</span></dt><dd><p>
      The Xen hypervisor, sometimes simply called a virtual machine monitor,
      is an open source software program that coordinates the low-level
      interaction between virtual machines and physical hardware.
     </p></dd><dt id="id-1.12.3.4.4.3.2"><span class="term">The Dom0</span></dt><dd><p>
      The virtual machine host environment, also called
      <span class="emphasis"><em>Dom0</em></span> or controlling domain, is composed of
      several components, such as:
     </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> provides a graphical and a command line environment to
        manage the virtual machine host components and its virtual machines.
       </p><div id="id-1.12.3.4.4.3.2.2.2.1.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
         The term <span class="quote">“<span class="quote">Dom0</span>”</span> refers to a special domain that
         provides the management environment. This may be run either in
         graphical or in command line mode.
        </p></div></li><li class="listitem"><p>
        The xl tool stack based on the xenlight library (libxl). Use it to
        manage Xen guest domains.
       </p></li><li class="listitem"><p>
        QEMU—an open source software that emulates a full computer
        system, including a processor and various peripherals. It provides the
        ability to host operating systems in both full virtualization or
        paravirtualization mode.
       </p></li></ul></div></dd><dt id="id-1.12.3.4.4.3.3"><span class="term">Xen-based virtual machines</span></dt><dd><p>
      A Xen-based virtual machine, also called a
      <em class="replaceable">VM Guest</em> or
      <em class="replaceable">DomU</em>, consists of the following components:
     </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        At least one virtual disk that contains a bootable operating system.
        The virtual disk can be based on a file, partition, volume, or other
        type of block device.
       </p></li><li class="listitem"><p>
        A configuration file for each guest domain. It is a text file
        following the syntax described in the manual page <code class="command">man 5
        xl.conf</code>.
       </p></li><li class="listitem"><p>
        Several network devices, connected to the virtual network
        provided by the controlling domain.
       </p></li></ul></div></dd><dt id="id-1.12.3.4.4.3.4"><span class="term">Management tools, commands, and configuration files</span></dt><dd><p>
      There is a combination of GUI tools, commands, and configuration files
      to help you manage and customize your virtualization environment.
     </p></dd></dl></div></section><section class="sect1" id="sec-xen-basics-arch" data-id-title="Xen virtualization architecture"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.2 </span><span class="title-name">Xen virtualization architecture</span></span> <a title="Permalink" class="permalink" href="#sec-xen-basics-arch">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_basics.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following graphic depicts a virtual machine host with four virtual
   machines. The Xen hypervisor is shown as running directly on the
   physical hardware platform. Note that the controlling domain is also a
   virtual machine, although it has several additional management tasks
   compared to all the other virtual machines.
  </p><div class="figure" id="fig-xen-basics-arch"><div class="figure-contents"><div class="mediaobject"><a href="images/xen_master_fong_a.png"><img src="images/xen_master_fong_a.png" width="100%" alt="Xen virtualization architecture" title="Xen virtualization architecture"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 3.1: </span><span class="title-name">Xen virtualization architecture </span></span><a title="Permalink" class="permalink" href="#fig-xen-basics-arch">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_basics.xml" title="Edit source document"> </a></div></div></div><p>
   On the left, the virtual machine host’s Dom0 is shown running the
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> operating system. The two virtual machines shown in the
   middle are running paravirtualized operating systems. The virtual machine
   on the right shows a fully virtual machine running an unmodified
   operating system, such as the latest version of Microsoft Windows/Server.
  </p></section></section><section class="chapter" id="cha-kvm-intro" data-id-title="Introduction to KVM virtualization"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">4 </span><span class="title-name">Introduction to KVM virtualization</span></span> <a title="Permalink" class="permalink" href="#cha-kvm-intro">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/kvm_virtualization_basics.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="sec-kvm-intro" data-id-title="Basic components"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.1 </span><span class="title-name">Basic components</span></span> <a title="Permalink" class="permalink" href="#sec-kvm-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/kvm_virtualization_basics.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   KVM is a full virtualization solution for hardware architectures that
   support hardware virtualization<span class="phrase"> (refer to <a class="xref" href="#sec-architecture-support" title="7.1. Architecture support">Section 7.1, “Architecture support”</a> for more details
   on supported architectures)</span>.
  </p><p>
   VM Guests (virtual machines), virtual storage, and virtual networks
   can be managed with QEMU tools directly, or with the
   <code class="systemitem">libvirt</code>-based stack. The QEMU tools include
   <code class="command">qemu-system-ARCH</code>, the QEMU monitor,
   <code class="command">qemu-img</code>, and <code class="command">qemu-ndb</code>. A
   <code class="systemitem">libvirt</code>-based stack includes <code class="systemitem">libvirt</code> itself, along with
   <code class="systemitem">libvirt</code>-based applications such as <code class="command">virsh</code>,
   <code class="command">virt-manager</code>, <code class="command">virt-install</code>, and
   <code class="command">virt-viewer</code>.
  </p></section><section class="sect1" id="sec-kvm-intro-arch" data-id-title="KVM virtualization architecture"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.2 </span><span class="title-name">KVM virtualization architecture</span></span> <a title="Permalink" class="permalink" href="#sec-kvm-intro-arch">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/kvm_virtualization_basics.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This full virtualization solution consists of two main components:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     A set of kernel modules
     (<code class="systemitem">kvm.ko</code>, <code class="systemitem">kvm-intel.ko</code>,
     and <code class="systemitem">kvm-amd.ko</code>) that provides the core
     virtualization infrastructure and processor-specific drivers.
    </p></li><li class="listitem"><p>
     A user space program
     (<code class="systemitem">qemu-system-ARCH</code>) that provides
     emulation for virtual devices and control mechanisms to manage VM Guests
     (virtual machines).
    </p></li></ul></div><p>
   The term KVM more properly refers to the kernel level virtualization
   functionality, but is in practice more commonly used to refer to the
   user space component.
  </p><div class="figure" id="fig-kvm-basics-arch"><div class="figure-contents"><div class="mediaobject"><a href="images/kvm_qemu.png"><img src="images/kvm_qemu.png" width="100%" alt="KVM virtualization architecture" title="KVM virtualization architecture"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 4.1: </span><span class="title-name">KVM virtualization architecture </span></span><a title="Permalink" class="permalink" href="#fig-kvm-basics-arch">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/kvm_virtualization_basics.xml" title="Edit source document"> </a></div></div></div></section></section><section class="chapter" id="cha-tools-intro" data-id-title="Virtualization tools"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">5 </span><span class="title-name">Virtualization tools</span></span> <a title="Permalink" class="permalink" href="#cha-tools-intro">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_tools.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    <code class="systemitem">libvirt</code> is a library that provides a common API for managing popular
    virtualization solutions, among them KVM and Xen. The library
    provides a normalized management API for these virtualization solutions,
    allowing a stable, cross-hypervisor interface for higher-level management
    tools. The library also provides APIs for management of virtual networks
    and storage on the VM Host Server. The configuration of each VM Guest is stored
    in an XML file.
   </p><p>
    With <code class="systemitem">libvirt</code> you can also manage your VM Guests remotely. It supports
    TLS encryption, x509 certificates and authentication with SASL. This
    enables managing VM Host Servers centrally from a single workstation,
    alleviating the need to access each VM Host Server individually.
   </p><p>
    Using the <code class="systemitem">libvirt</code>-based tools is the recommended way of managing
    VM Guests. Interoperability between <code class="systemitem">libvirt</code> and <code class="systemitem">libvirt</code>-based
    applications has been tested and is an essential part of SUSE's support
    stance.
   </p></div></div></div></div><section class="sect1" id="sec-tools-intro-console" data-id-title="Virtualization console tools"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.1 </span><span class="title-name">Virtualization console tools</span></span> <a title="Permalink" class="permalink" href="#sec-tools-intro-console">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_tools.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="systemitem">libvirt</code> includes several command line utilities to manage virtual
   machines. The most important ones are:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.3.6.3.3.1"><span class="term"><code class="command">virsh</code> (Package: <span class="package">libvirt-client</span>)</span></dt><dd><p>
      A command line tool to manage VM Guests with similar functionality
      as the Virtual Machine Manager. Allows you to change a VM Guest's status (start,
      stop, pause, etc.), to set up new guests and devices, or to edit
      existing configurations. <code class="command">virsh</code> is also useful to
      script VM Guest management operations.
     </p><p>
      <code class="command">virsh</code> takes the first argument as a
      command and further arguments as options to this command:
     </p><div class="verbatim-wrap"><pre class="screen">virsh [-c <em class="replaceable">URI</em>] <em class="replaceable">COMMAND</em> <em class="replaceable">DOMAIN-ID</em> [OPTIONS]</pre></div><p>
      Like <code class="command">zypper</code>, <code class="command">virsh</code> can also
      be called without a command. In this case it starts a shell waiting for
      your commands. This mode is useful when having to run subsequent
      commands:
     </p><div class="verbatim-wrap"><pre class="screen">~&gt; virsh -c qemu+ssh://wilber@mercury.example.com/system
Enter passphrase for key '/home/wilber/.ssh/id_rsa':
Welcome to virsh, the virtualization interactive terminal.

Type:  'help' for help with commands
       'quit' to quit

virsh # hostname
mercury.example.com</pre></div></dd><dt id="id-1.12.3.6.3.3.2"><span class="term"><code class="command">virt-install</code> (Package: <span class="package">virt-install</span>)</span></dt><dd><p>
      A command line tool for creating new VM Guests using the
      <code class="systemitem">libvirt</code> library. It supports graphical installations via VNC or
      <a class="xref" href="#gloss-vt-acronym-spice" title="SPICE">SPICE</a> protocols. Given suitable
      command line arguments, <code class="command">virt-install</code> can run
      completely unattended. This allows for easy automation of guest
      installs. <code class="command">virt-install</code> is the default installation
      tool used by the Virtual Machine Manager.
     </p></dd><dt id="id-1.12.3.6.3.3.3"><span class="term"><code class="command">remote-viewer</code> (Package: <span class="package">virt-viewer</span>)</span></dt><dd><p>
      A simple viewer of a remote desktop. It supports SPICE and VNC protocols.
     </p></dd><dt id="id-1.12.3.6.3.3.4"><span class="term"><code class="command">virt-clone</code> (Package: <span class="package">virt-install</span>)</span></dt><dd><p>
      A tool for cloning existing virtual machine images using the <code class="systemitem">libvirt</code>
      hypervisor management library.
     </p></dd><dt id="id-1.12.3.6.3.3.5"><span class="term"><code class="command">virt-host-validate</code> (Package: <span class="package">libvirt-client</span>)</span></dt><dd><p>
      A tool that validates whether the host is configured in a suitable way
      to run <code class="systemitem">libvirt</code> hypervisor drivers.
     </p></dd></dl></div></section><section class="sect1" id="sec-tools-intro-gui" data-id-title="Virtualization GUI tools"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.2 </span><span class="title-name">Virtualization GUI tools</span></span> <a title="Permalink" class="permalink" href="#sec-tools-intro-gui">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_tools.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following libvirt-based graphical tools are available on
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. All tools are provided by packages carrying the tool's name.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.3.6.4.3.1"><span class="term">Virtual Machine Manager (package: <span class="package">virt-manager</span>)</span></dt><dd><p>
      The Virtual Machine Manager is a desktop tool for managing VM Guests. It provides the
      ability to control the lifecycle of existing machines (start/shutdown,
      pause/resume, save/restore) and create new VM Guests. It allows
      managing various types of storage and virtual networks. It provides
      access to the graphical console of VM Guests with a built-in VNC viewer
      and can be used to view performance
      statistics. <code class="command">virt-manager</code> supports connecting to a
      local <code class="systemitem">libvirtd</code>, managing a local VM Host Server, or a remote <code class="systemitem">libvirtd</code>
      managing a remote VM Host Server.
     </p><div class="informalfigure"><div class="mediaobject"><a href="images/virt_virt-manager.png"><img src="images/virt_virt-manager.png" width="80%" alt="Virtual Machine Manager" title="Virtual Machine Manager"/></a></div></div><p>
      To start the Virtual Machine Manager, enter <code class="command">virt-manager</code> at the command
      prompt.
     </p><div id="id-1.12.3.6.4.3.1.2.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
       To disable automatic USB device redirection for VM Guest using spice,
       either launch <code class="command">virt-manager</code> with the
       <code class="option">--spice-disable-auto-usbredir</code> parameter or run the
       following command to persistently change the default behavior:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>dconf write /org/virt-manager/virt-manager/console/auto-redirect false</pre></div></div></dd><dt id="id-1.12.3.6.4.3.2"><span class="term"><code class="command">virt-viewer</code> (Package: <span class="package">virt-viewer</span>)</span></dt><dd><p>
      A viewer for the graphical console of a VM Guest. It uses SPICE
      (configured by default on the VM Guest) or VNC protocols and supports
      TLS and x509 certificates. VM Guests can be accessed by name, ID, or
      UUID. If the guest is not already running, the viewer can be told to
      wait until the guest starts, before attempting to connect to the
      console. <code class="command">virt-viewer</code> is not installed by default and
      is available after installing the package <code class="systemitem">virt-viewer</code>.
     </p><div class="informalfigure"><div class="mediaobject"><a href="images/virt_virt-viewer.png"><img src="images/virt_virt-viewer.png" width="80%" alt="viert-viewer" title="viert-viewer"/></a></div></div><div id="id-1.12.3.6.4.3.2.2.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
       To disable automatic USB device redirection for VM Guest using spice,
       add an empty filter using the
       <code class="option">--spice-usbredir-auto-redirect-filter=''</code> parameter.
      </p></div></dd><dt id="id-1.12.3.6.4.3.3"><span class="term"><code class="command">yast2 vm</code> (Package: <span class="package">yast2-vm</span>)</span></dt><dd><p>
      A YaST module that simplifies the installation of virtualization tools
      and can set up a network bridge:
     </p><div class="informalfigure"><div class="mediaobject"><a href="images/yast2_vm.png"><img src="images/yast2_vm.png" width="56%" alt="yast2 vm command" title="yast2 vm command"/></a></div></div></dd></dl></div></section></section><section class="chapter" id="cha-vt-installation" data-id-title="Installation of virtualization components"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">6 </span><span class="title-name">Installation of virtualization components</span></span> <a title="Permalink" class="permalink" href="#cha-vt-installation">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  You can install the virtualization tools required to run a VM Host Server in two ways:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    During the host OS installation by selecting a specific system role.
   </p></li><li class="listitem"><p>
    After the host OS is installed by running a corresponding YaST module.
   </p></li></ul></div><section class="sect1" id="vt-installation-system-role" data-id-title="Specifying a system role"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.1 </span><span class="title-name">Specifying a system role</span></span> <a title="Permalink" class="permalink" href="#vt-installation-system-role">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can install all the tools required for virtualization during the host
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> installation. During the installation steps
   (refer to <span class="intraxref">Book “Deployment Guide”, Chapter 8 “Installation steps”</span>), you will be presented with the
   <span class="guimenu">System Role</span> screen.
  </p><div class="figure" id="id-1.12.3.7.5.3"><div class="figure-contents"><div class="mediaobject"><a href="images/virt-system-roles.png"><img src="images/virt-system-roles.png" width="75%" alt="System Role screen" title="System Role screen"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 6.1: </span><span class="title-name">System Role screen </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.7.5.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_installation.xml" title="Edit source document"> </a></div></div></div><p>
   Here you can select either the <span class="guimenu">KVM Virtualization Host</span> or
   <span class="guimenu">Xen Virtualization Host</span> roles. The appropriate software
   selection and setup will be automatically performed during the OS
   installation.
  </p><div id="id-1.12.3.7.5.5" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    Both virtualization system roles will create a dedicated
    <code class="filename">/var/lib/libvirt</code> partition, and enable the firewall
    and Kdump services.
   </p></div></section><section class="sect1" id="vt-installation-yast" data-id-title="Running the yast2-vm module"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.2 </span><span class="title-name">Running the <span class="package">yast2-vm</span> module</span></span> <a title="Permalink" class="permalink" href="#vt-installation-yast">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Depending on the scope of the installation, none of the virtualization tools
   may be installed on your system. They will be automatically installed when
   configuring the hypervisor with the YaST module <span class="guimenu">Virtualization</span> › <span class="guimenu">Install Hypervisor and
   Tools</span>. In case this module is not available in YaST,
   install the package <span class="package">yast2-vm</span>.
  </p><section class="sect2" id="sec-vt-installation-kvm" data-id-title="Installing KVM"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.2.1 </span><span class="title-name">Installing KVM</span></span> <a title="Permalink" class="permalink" href="#sec-vt-installation-kvm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To install KVM and the KVM tools, proceed as follows:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Verify that the <span class="package">yast2-vm</span> package is installed. This package
      is YaST's configuration tool that simplifies the installation of hypervisors.
     </p></li><li class="step"><p>
      Start YaST and choose <span class="guimenu">Virtualization</span> › <span class="guimenu">Install Hypervisor and
      Tools</span>.
     </p></li><li class="step"><p>
      Select <span class="guimenu">KVM server</span> for a minimal installation of
      QEMU tools. Select <span class="guimenu">KVM tools</span> if a
      <code class="systemitem">libvirt</code>-based management stack is also desired. Confirm with
      <span class="guimenu">Accept</span>.
     </p></li><li class="step"><p>
      To enable normal networking for the VM Guest, using a
      network bridge is recommended. YaST offers to automatically
      configure a bridge on the VM Host Server. Agree to do so by choosing
      <span class="guimenu">Yes</span>, otherwise choose <span class="guimenu">No</span>.
     </p></li><li class="step"><p>
      After the setup has been finished, you can start setting up
      VM Guests. Rebooting the VM Host Server is not required.
     </p></li></ol></div></div></section><section class="sect2" id="sec-vt-installation-xen" data-id-title="Installing Xen"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.2.2 </span><span class="title-name">Installing Xen</span></span> <a title="Permalink" class="permalink" href="#sec-vt-installation-xen">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To install Xen and Xen tools, proceed as follows:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start YaST and choose <span class="guimenu">Virtualization</span> › <span class="guimenu">Install Hypervisor and
      Tools</span>.
     </p></li><li class="step"><p>
      Select <span class="guimenu">Xen server</span> for a minimal installation of
      Xen tools. Select <span class="guimenu">Xen tools</span> if a
      <code class="systemitem">libvirt</code>-based management stack is also desired. Confirm with
      <span class="guimenu">Accept</span>.
     </p></li><li class="step"><p>
      To enable normal networking for the VM Guest, using a
      network bridge is recommended. YaST offers to automatically
      configure a bridge on the VM Host Server. Agree to do so by choosing
      <span class="guimenu">Yes</span>, otherwise choose <span class="guimenu">No</span>.
     </p></li><li class="step"><p>
      After the setup has been finished, you need to reboot the machine with
      the <span class="emphasis"><em>Xen kernel</em></span>.
     </p><div id="id-1.12.3.7.6.4.3.4.2" data-id-title="Default boot kernel" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Default boot kernel</div><p>
       If everything works as expected, change the default boot kernel with YaST and make the Xen-enabled kernel the default.
       For more information about changing the default kernel, see <span class="intraxref">Book “Administration Guide”, Chapter 14 “The boot loader GRUB 2”, Section 14.3 “Configuring the boot loader with YaST”</span>.
      </p></div></li></ol></div></div></section></section><section class="sect1" id="sec-vt-installation-patterns" data-id-title="Patterns"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.3 </span><span class="title-name">Patterns</span></span> <a title="Permalink" class="permalink" href="#sec-vt-installation-patterns">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   It is possible using Zypper and patterns to install virtualization
   packages. Run the command <code class="command">zypper in -t pattern</code>
   <em class="replaceable">PATTERN</em>. Available patterns are:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.3.7.7.3.1"><span class="term">KVM</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        <code class="systemitem">kvm_server</code>: sets up the
        KVM VM Host Server with QEMU tools for management
       </p></li><li class="listitem"><p>
        <code class="systemitem">kvm_tools</code>: installs the
        <code class="systemitem">libvirt</code> tools for managing and monitoring VM Guests
       </p></li></ul></div></dd><dt id="id-1.12.3.7.7.3.2"><span class="term">Xen</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        <code class="systemitem">xen_server</code>: sets up the
        Xen VM Host Server with Xen tools for management
       </p></li><li class="listitem"><p>
        <code class="systemitem">xen_tools</code>: installs the
        <code class="systemitem">libvirt</code> tools for managing and monitoring VM Guests
       </p></li></ul></div></dd></dl></div></section><section class="sect1" id="sec-vt-installation-ovmf" data-id-title="Installing UEFI support"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.4 </span><span class="title-name">Installing UEFI support</span></span> <a title="Permalink" class="permalink" href="#sec-vt-installation-ovmf">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_installation.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.12.3.7.8.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    We support UEFI Secure Boot on AMD64/Intel 64 guests only.  KVM guests support
    UEFI Secure Boot by using the OVMF firmware. Xen HVM guests support booting
    from the OVMF firmware as well, but they do not support UEFI Secure Boot.
   </p></div><p>
   UEFI support is provided by <span class="emphasis"><em>OVMF</em></span> (<span class="emphasis"><em>Open
   Virtual Machine Firmware</em></span>). To enable UEFI boot, first install the
   <span class="package">qemu-ovmf-x86_64</span> or <span class="package">qemu-uefi-aarch64</span>
   package depending on the architecture of the guest.
  </p><p>
   The firmware used by virtual machines is auto-selected. The auto-selection
   is based on the JSON files in the firmware package described above. The
   <code class="systemitem">libvirt</code> QEMU driver parses those files when loading so it knows the
   capabilities of the various types of firmware. Then when the user selects
   the type of firmware and any desired features (for example, support for
   UEFI Secure Boot), <code class="systemitem">libvirt</code> will be able to find a firmware file that
   satisfies the user's requirements.
  </p><p>
   For example, to specify EFI with UEFI Secure Boot, use the following
   configuration:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;os firmware='efi'&gt;
 &lt;loader secure='yes'/&gt;
&lt;/os&gt;</pre></div><p>
   The <span class="package">qemu-ovmf-x86_64</span> package contains the following
   important UEFI firmware images. They provide UEFI Secure Boot capability for
   various VM Guests:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">rpm -ql qemu-ovmf-x86_64</code>
[...]
/usr/share/qemu/ovmf-x86_64-smm-ms-code.bin
/usr/share/qemu/ovmf-x86_64-smm-ms-vars.bin
/usr/share/qemu/ovmf-x86_64-smm-opensuse-code.bin
/usr/share/qemu/ovmf-x86_64-smm-opensuse-vars.bin
/usr/share/qemu/ovmf-x86_64-smm-suse-code.bin
/usr/share/qemu/ovmf-x86_64-smm-suse-vars.bin
[...]</pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     To use UEFI Secure Boot for SUSE Linux Enterprise guests, use the
     <code class="filename">ovmf-x86_64-smm-suse-code.bin</code> firmware.
    </p></li><li class="listitem"><p>
     To use UEFI Secure Boot for openSUSE guests, use the
     <code class="filename">ovmf-x86_64-smm-opensuse-code.bin</code> firmware.
    </p></li><li class="listitem"><p>
     To use UEFI Secure Boot for Microsoft Windows guests, use the
     <code class="filename">ovmf-x86_64-smm-ms-code.bin</code> firmware.
    </p></li></ul></div><p>
   For the AArch64 architecture, the package is named
   <span class="package">qemu-uefi-aarch32</span>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">rpm -ql qemu-uefi-aarch32</code>
[...]
/usr/share/qemu/aavmf-aarch32-code.bin
/usr/share/qemu/aavmf-aarch32-vars.bin
/usr/share/qemu/firmware
/usr/share/qemu/firmware/60-aavmf-aarch32.json
/usr/share/qemu/qemu-uefi-aarch32.bin</pre></div><p>
   The <code class="filename">*-code.bin</code> files are the UEFI firmware files. The
   <code class="filename">*-vars.bin</code> files are corresponding variable store
   images that can be used as a template for a per-VM non-volatile store.
   <code class="systemitem">libvirt</code> copies the specified <code class="literal">vars</code> template to a per-VM
   path under <code class="filename">/var/lib/libvirt/qemu/nvram/</code> when first
   creating the VM. Files without <code class="literal">code</code> or
   <code class="literal">vars</code> in the name can be used as a single UEFI image. They
   are not as useful since no UEFI variables persist across power cycles of the
   VM.
  </p><p>
   The <code class="filename">*-ms*.bin</code> files contain UEFI CA keys as found on
   real hardware. Therefore, they are configured as the default in <code class="systemitem">libvirt</code>.
   Likewise, the <code class="filename">*-suse*.bin</code> files contain preinstalled
   SUSE keys. There is also a set of files with no preinstalled keys.
  </p><p>
   For details, see <a class="xref" href="#vle-libvirt-inst-virt-install-ovmf">Using UEFI Secure Boot</a>
   and
   <a class="link" href="http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt" target="_blank">http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt</a>.
  </p></section><section class="sect1" id="sec-vt-installation-nested-vms" data-id-title="Enable nested virtualization in KVM"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.5 </span><span class="title-name">Enable nested virtualization in KVM</span></span> <a title="Permalink" class="permalink" href="#sec-vt-installation-nested-vms">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_installation.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.12.3.7.9.2" data-id-title="Technology preview" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Technology preview</div><p>
    KVM's nested virtualization is still a technology preview. It is provided
    for testing purposes and is not supported.
   </p></div><p>
   Nested guests are KVM guests run in a KVM guest. When describing nested
   guests, we will use the following virtualization layers:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.3.7.9.4.1"><span class="term">L0</span></dt><dd><p>
      A bare metal host running KVM.
     </p></dd><dt id="id-1.12.3.7.9.4.2"><span class="term">L1</span></dt><dd><p>
      A virtual machine running on L0. Because it can run another KVM, it is
      called a <span class="emphasis"><em>guest hypervisor</em></span>.
     </p></dd><dt id="id-1.12.3.7.9.4.3"><span class="term">L2</span></dt><dd><p>
      A virtual machine running on L1. It is called a <span class="emphasis"><em>nested
       guest</em></span>.
     </p></dd></dl></div><p>
   Nested virtualization has many advantages. You can benefit from it in the
   following scenarios:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Manage your own virtual machines directly with your hypervisor of choice in
     cloud environments.
    </p></li><li class="listitem"><p>
     Enable the live migration of hypervisors and their guest virtual machines
     as a single entity.
    </p></li><li class="listitem"><p>
     Use it for software development and testing.
    </p></li></ul></div><p>
   To enable nesting temporarily, remove the module and reload it with the
   <code class="option">nested</code> KVM module parameter:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     For Intel CPUs, run:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> modprobe -r kvm_intel &amp;&amp; modprobe kvm_intel nested=1</pre></div></li><li class="listitem"><p>
     For AMD CPUs, run:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> modprobe -r kvm_amd &amp;&amp; modprobe kvm_amd nested=1</pre></div></li></ul></div><p>
   To enable nesting permanently, enable the <code class="option">nested</code> KVM
   module parameter in the <code class="filename">/etc/modprobe.d/kvm_*.conf</code> file,
   depending on your CPU:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     For Intel CPUs, edit <code class="filename">/etc/modprobe.d/kvm_intel.conf</code>
     and add the following line:
    </p><div class="verbatim-wrap"><pre class="screen">options kvm_intel nested=1</pre></div></li><li class="listitem"><p>
     For AMD CPUs, edit <code class="filename">/etc/modprobe.d/kvm_amd.conf</code> and
     add the following line:
    </p><div class="verbatim-wrap"><pre class="screen">options kvm_amd nested=1</pre></div></li></ul></div><p>
   When your L0 host is capable of nesting, you will be able to start an L1
   guest in one of the following ways:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Use the <code class="option">-cpu host</code> QEMU command line option.
    </p></li><li class="listitem"><p>
     Add the <code class="literal">vmx</code> (for Intel CPUs) or the
     <code class="literal">svm</code> (for AMD CPUs) CPU feature to the
     <code class="option">-cpu</code> QEMU command line option, which enables
     virtualization for the virtual CPU.
    </p></li></ul></div><section class="sect2" id="sec-vt-installation-nested-vms-esxi" data-id-title="VMware ESX as a guest hypervisor"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.1 </span><span class="title-name">VMware ESX as a guest hypervisor</span></span> <a title="Permalink" class="permalink" href="#sec-vt-installation-nested-vms-esxi">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you use VMware ESX as a guest hypervisor on top of a KVM bare metal
    hypervisor, you may experience unstable network communication. This problem
    occurs especially between nested KVM guests and the KVM bare metal
    hypervisor or external network. The following default CPU configuration of
    the nested KVM guest is causing the problem:
   </p><div class="verbatim-wrap"><pre class="screen">&lt;cpu mode='host-model' check='partial'/&gt;</pre></div><p>
    To fix it, modify the CPU configuration as follow:
   </p><div class="verbatim-wrap"><pre class="screen">[...]
&lt;cpu mode='host-passthrough' check='none'&gt;
 &lt;cache mode='passthrough'/&gt;
&lt;/cpu&gt;
[...]</pre></div></section></section></section><section class="chapter" id="cha-virt-support" data-id-title="Virtualization limits and support"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">7 </span><span class="title-name">Virtualization limits and support</span></span> <a title="Permalink" class="permalink" href="#cha-virt-support">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.12.3.8.3" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
      QEMU is only supported when used for virtualization together with the
      KVM or Xen hypervisors. The TCG accelerator is not supported, even
      when it is distributed within SUSE products. Users must not rely on
      QEMU TCG to provide guest isolation, or for any security guarantees. See
      also
      <a class="link" href="https://qemu-project.gitlab.io/qemu/system/security.html" target="_blank">https://qemu-project.gitlab.io/qemu/system/security.html</a>.
    </p></div><section class="sect1" id="sec-architecture-support" data-id-title="Architecture support"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.1 </span><span class="title-name">Architecture support</span></span> <a title="Permalink" class="permalink" href="#sec-architecture-support">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-kvm-requires-hardware" data-id-title="KVM hardware requirements"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.1.1 </span><span class="title-name">KVM hardware requirements</span></span> <a title="Permalink" class="permalink" href="#sec-kvm-requires-hardware">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Currently, SUSE supports KVM full virtualization on AMD64/Intel 64, AArch64,
    IBM Z, and IBM LinuxONE hosts.
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      On the AMD64/Intel 64 architecture, KVM is designed around hardware
      virtualization features included in AMD* (AMD-V) and Intel* (VT-x) CPUs.
      It supports virtualization features of chipsets and PCI devices, such as
      an I/O Memory Mapping Unit (<a class="xref" href="#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a>) and
      Single Root I/O Virtualization (<a class="xref" href="#vt-io-sriov">SR-IOV</a>). You can
      test whether your CPU supports hardware virtualization with the following
      command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>egrep '(vmx|svm)' /proc/cpuinfo</pre></div><p>
      If this command returns no output, your processor either does not support
      hardware virtualization, or this feature has been disabled in the BIOS or
      firmware.
     </p><p>
      The following Web sites identify AMD64/Intel 64 processors that support
      hardware virtualization:
      <a class="link" href="http://ark.intel.com/Products/VirtualizationTechnology" target="_blank">http://ark.intel.com/Products/VirtualizationTechnology</a>
      (for Intel CPUs), and <a class="link" href="http://products.amd.com/" target="_blank">http://products.amd.com/</a> (for
      AMD CPUs).
     </p></li><li class="listitem"><p>
      On the Arm architecture, Armv8-A processors include support for
      virtualization.
     </p></li><li class="listitem"><p>
      On the Arm architecture, we only support running QEMU/KVM via the
      CPU model <code class="literal">host</code> (it is named
      <code class="literal">host-passthrough</code> in Virtual Machine Manager or <code class="systemitem">libvirt</code>).
     </p></li></ul></div><div id="id-1.12.3.8.4.2.4" data-id-title="KVM kernel modules not loading" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: KVM kernel modules not loading</div><p>
     The KVM kernel modules only load if the CPU hardware virtualization
     features are available.
    </p></div><p>
    <span class="phrase"> The general minimum hardware requirements for the
    VM Host Server are the same as outlined in
    <span class="intraxref">Book “Deployment Guide”, Chapter 2 “Installation on AMD64 and Intel 64”, Section 2.1 “Hardware requirements”</span>.</span>
     However,
    additional RAM for each virtualized guest is needed. It should at least be
    the same amount that is needed for a physical installation. It is also
    strongly recommended to have at least one processor core or hyper-thread
    for each running guest.
   </p><div id="id-1.12.3.8.4.2.6" data-id-title="AArch64" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: AArch64</div><p>
     AArch64 is a continuously evolving platform. It does not have a
     traditional standards and compliance certification program to enable
     interoperability with operating systems and hypervisors. Ask your
     vendor for the support statement on SUSE Linux Enterprise Server.
    </p></div><div id="id-1.12.3.8.4.2.7" data-id-title="POWER" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: POWER</div><p>
     Running KVM or Xen hypervisors on the POWER platform is not
     supported.
    </p></div></section><section class="sect2" id="sec-xen-requires-hardware" data-id-title="Xen hardware requirements"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.1.2 </span><span class="title-name">Xen hardware requirements</span></span> <a title="Permalink" class="permalink" href="#sec-xen-requires-hardware">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    SUSE supports Xen on AMD64/Intel 64.
   </p></section></section><section class="sect1" id="virt-hypervisors-limits" data-id-title="Hypervisor limits"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.2 </span><span class="title-name">Hypervisor limits</span></span> <a title="Permalink" class="permalink" href="#virt-hypervisors-limits">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   New features and virtualization limits for Xen and KVM are outlined in
   the <a class="link" href="https://www.suse.com/releasenotes/" target="_blank">Release
   Notes</a> for each Service Pack (SP).
  </p><p>
   Only packages that are part of the official repositories for SUSE Linux Enterprise Server are
   supported. Conversely, all optional subpackages and plug-ins (for QEMU,
   <code class="systemitem">libvirt</code>) provided at 
   <a class="link" href="https://packagehub.suse.com/" target="_blank">packagehub</a>
   are not supported.
  </p><p>
   For the maximum total virtual CPUs per host, see
   <a class="link" href="https://documentation.suse.com/sles-15/html/SLES-all/article-virtualization-best-practices.html#sec-vt-best-perf-cpu-assign" target="_blank">recommendations
   in the Virtualization Best Practices Guide regarding over-commitment of
   physical CPUs</a>. The total number of virtual CPUs should be
   proportional to the number of available physical CPUs.
  </p><div id="id-1.12.3.8.5.5" data-id-title="32-bit hypervisor" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: 32-bit hypervisor</div><p>
    With <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 11 SP2, we removed virtualization host facilities from
    32-bit editions. 32-bit guests are not affected and are fully supported
    using the provided 64-bit hypervisor.
   </p></div><section class="sect2" id="virt-kvm-limits" data-id-title="KVM limits"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.2.1 </span><span class="title-name">KVM limits</span></span> <a title="Permalink" class="permalink" href="#virt-kvm-limits">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Supported (and tested) virtualization limits of a <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>
    <span class="productnumber"><span class="phrase">15 SP3</span></span> host running Linux guests on AMD64/Intel 64. For other operating
    systems, refer to the specific vendor.
   </p><div class="table" id="id-1.12.3.8.5.6.3" data-id-title="KVM VM limits"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.1: </span><span class="title-name">KVM VM limits </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.5.6.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Maximum virtual CPUs per VM
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         288
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         Maximum memory per VM
        </p>
       </td><td>
        <p>
         6 TiB
        </p>
       </td></tr></tbody></table></div></div><div id="id-1.12.3.8.5.6.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     KVM host limits are identical to SUSE Linux Enterprise Server (see the corresponding section of
     release notes), except for:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <span class="emphasis"><em>Maximum virtual CPUs per VM</em></span>: See recommendations in
       the <em class="citetitle">Virtualization Best Practices Guide</em> regarding over-commitment of
       physical CPUs at
       <a class="link" href="https://documentation.suse.com/sles-15/html/SLES-all/article-virtualization-best-practices.html#sec-vt-best-perf-cpu-assign" target="_blank">https://documentation.suse.com/sles-15/html/SLES-all/article-virtualization-best-practices.html#sec-vt-best-perf-cpu-assign</a>.
       The total virtual CPUs should be proportional to the available physical
       CPUs.
      </p></li></ul></div></div></section><section class="sect2" id="virt-xen-limits" data-id-title="Xen limits"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.2.2 </span><span class="title-name">Xen limits</span></span> <a title="Permalink" class="permalink" href="#virt-xen-limits">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><div class="table" id="id-1.12.3.8.5.7.2" data-id-title="Xen VM limits"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.2: </span><span class="title-name">Xen VM limits </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.5.7.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Maximum virtual CPUs per VM
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         32 (general HVM recommendation), 64 (HVM Windows guest), 128 (trusted
         HVMs), or 512 (PV)
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         Maximum memory per VM
        </p>
       </td><td>
        <p>
         2 TiB (64-bit guest), 16 GiB (32-bit guest with PAE)
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.5.7.3" data-id-title="Xen host limits"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.3: </span><span class="title-name">Xen host limits </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.5.7.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Maximum total physical CPUs
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         1024
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Maximum total virtual CPUs per host
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         See recommendations in the Virtualization Best Practices Guide
         regarding over-commitment of physical CPUs in
         <a class="link" href="https://documentation.suse.com/sles-15/html/SLES-all/article-virtualization-best-practices.html#sec-vt-best-perf-cpu-assign" target="_blank">https://documentation.suse.com/sles-15/html/SLES-all/article-virtualization-best-practices.html#sec-vt-best-perf-cpu-assign</a>.
         The total virtual CPUs should be proportional to the available
         physical CPUs
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Maximum physical memory
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Recommendation is to stay below the 16 TiB address boundary.
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
          <p>
            Suspend and hibernate modes
          </p>
        </td><td>
          <p>
            Not supported.
          </p>
        </td></tr></tbody></table></div></div></section></section><section class="sect1" id="virt-support-hosts" data-id-title="Supported host environments (hypervisors)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.3 </span><span class="title-name">Supported host environments (hypervisors)</span></span> <a title="Permalink" class="permalink" href="#virt-support-hosts">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes the support status of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15 SP3</span></span>
   running as a guest operating system on top of various virtualization hosts
   (hypervisors).
  </p><div class="table" id="id-1.12.3.8.6.3" data-id-title="The following SUSE host environments are supported"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.4: </span><span class="title-name">The following SUSE host environments are supported </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.6.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        SUSE Linux Enterprise Server
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Hypervisors
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        SUSE Linux Enterprise Server 11 SP4
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Xen and KVM
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        SUSE Linux Enterprise Server 12 SP1 to SP5
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Xen and KVM
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        SUSE Linux Enterprise Server 15 GA to SP3
       </p>
      </td><td>
       <p>
        Xen and KVM
       </p>
      </td></tr></tbody></table></div></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">The following third-party host environments are supported </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.6.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
     <a class="link" href="https://xenserver.org/" target="_blank">Citrix XenServer</a>
    </p></li><li class="listitem"><p>
     <a class="link" href="https://www.windowsservercatalog.com/results.aspx?text=suse&amp;bCatID=1282&amp;avc=10&amp;ava=0&amp;OR=5" target="_blank">Microsoft
     Windows Server Catalog</a>
    </p></li><li class="listitem"><p>
     <a class="link" href="https://www.nutanix.com/products/acropolis" target="_blank">Nutanix
     Acropolis Hypervisor with AOS</a>
    </p></li><li class="listitem"><p>
     <a class="link" href="https://www.oracle.com/fr/virtualization/virtualbox/" target="_blank">Oracle
     VM Server 3.4</a>
    </p></li><li class="listitem"><p>
     <a class="link" href="https://www.oracle.com/linux/" target="_blank">Oracle Linux KVM 7,
     8</a>
    </p></li><li class="listitem"><p>
     <a class="link" href="https://www.vmware.com/products/esxi-and-esx.html" target="_blank">VMware
     ESXi 6.5, 6.7, 7.0</a>
    </p></li></ul></div><p>
   You can also search in the
   <a class="link" href="https://www.suse.com/yessearch/Search.jsp" target="_blank">SUSE YES
   certification database</a>
  </p><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">The level of support is as follows </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.6.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
     Support for SUSE host operating systems is full L3 (both for the guest and
     host) in accordance with the respective
     <a class="link" href="https://www.suse.com/lifecycle/" target="_blank">product life
     cycle</a>.
    </p></li><li class="listitem"><p>
     SUSE provides full L3 support for <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> guests within
     third-party host environments.
    </p></li><li class="listitem"><p>
     Support for the host and cooperation with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> guests must be
     provided by the host system's vendor.
    </p></li></ul></div></section><section class="sect1" id="virt-support-guests" data-id-title="Supported guest operating systems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.4 </span><span class="title-name">Supported guest operating systems</span></span> <a title="Permalink" class="permalink" href="#virt-support-guests">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section lists the support status for various guest operating systems
   virtualized on top of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15 SP3</span></span> for KVM and Xen
   hypervisors.
  </p><div id="id-1.12.3.8.7.3" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
    Microsoft Windows guests can be rebooted by <code class="systemitem">libvirt</code>/<code class="command">virsh</code> only if paravirtualized
    drivers are installed in the guest. Refer to
    <a class="link" href="https://www.suse.com/products/vmdriverpack/" target="_blank">https://www.suse.com/products/vmdriverpack/</a> for more
    details on downloading and installing PV drivers.
   </p></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">The following guest operating systems are fully supported (L3): </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.7.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
     SUSE Linux Enterprise Server 11 SP4
    </p></li><li class="listitem"><p>
     SUSE Linux Enterprise Server 12 SP3, 12 SP4, 12 SP5
    </p></li><li class="listitem"><p>
     SUSE Linux Enterprise Server 15 GA, 15 SP1, 15 SP2, 15 SP3
    </p></li><li class="listitem"><p>
     Windows Server 2008 SP2+, 2008 R2 SP1+, 2012+, 2012 R2+, 2016, 2019, 2022
    </p></li><li class="listitem"><p>
     Oracle Linux 6, 7, 8 (KVM hypervisor only)
    </p></li></ul></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">The following guest operating systems are supported as a technology preview (L2, fixes if reasonable): </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.7.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
     SLED 15 SP3
    </p></li></ul></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Red Hat and CentOS guest operating systems are fully supported (L3) if the customer has purchased SUSE Liberty Linux.  </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.7.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
       Refer to the SUSE Liberty Linux documentation at <a class="link" href="https://documentation.suse.com/liberty" target="_blank">https://documentation.suse.com/liberty</a> for the list of
       available combinations and supported releases. In other cases, they are
       supported on a limited basis (L2, fixes if reasonable).
     </p></li></ul></div><div id="id-1.12.3.8.7.7" data-id-title="RHEL PV drivers" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: RHEL PV drivers</div><p>
    Starting from RHEL 7.2, Red Hat removed Xen PV drivers.
   </p></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">The following guest operating systems are supported on a commercially reasonable basis (L2, fixes if reasonable): </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.7.8">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
          Windows 8+, 8.1+, 10+
        </p></li></ul></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">All other guest operating systems </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.7.9">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
     In other combinations, L2 support is provided but fixes are available only
     if feasible. SUSE fully supports the host OS (hypervisor). The guest OS
     issues need to be supported by the respective OS vendor. If an issue fix
     involves both the host and guest environments, the customer needs to
     approach both SUSE and the guest VM OS vendor.
    </p></li><li class="listitem"><p>
     All guest operating systems are supported both fully virtualized and
     paravirtualized. The exception is Windows systems, which are only supported
     fully virtualized (but they can use PV drivers: <a class="link" href="https://www.suse.com/products/vmdriverpack/" target="_blank">https://www.suse.com/products/vmdriverpack/</a>),
     and OES operating systems, which are supported only paravirtualized.
    </p></li><li class="listitem"><p>
     All guest operating systems are supported both in 32-bit and 64-bit
     environments, unless stated otherwise.
    </p></li></ul></div><section class="sect2" id="sec-kvm-requires-guests-virt-drivers" data-id-title="Availability of paravirtualized drivers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.4.1 </span><span class="title-name">Availability of paravirtualized drivers</span></span> <a title="Permalink" class="permalink" href="#sec-kvm-requires-guests-virt-drivers">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To improve the performance of the guest operating system, paravirtualized
    drivers are provided when available. Although they are not required, it is
    strongly recommended to use them.
   </p><p>
    Starting with SUSE Linux Enterprise Server 12 SP2, we switched to a PVops kernel. We are no longer
    using a dedicated <span class="package">kernel-xen</span> package:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The <span class="package">kernel-default+kernel-xen</span> on dom0 was replaced by
      the <span class="package">kernel-default</span> package.
     </p></li><li class="listitem"><p>
      The <span class="package">kernel-xen</span> package on PV domU was replaced by the
      <span class="package">kernel-default</span> package.
     </p></li><li class="listitem"><p>
      The <span class="package">kernel-default+xen-kmp</span> on HVM domU was replaced by
      <span class="package">kernel-default</span>.
     </p></li></ul></div><p>
    For SUSE Linux Enterprise Server 12 SP1 and older (down to 10 SP4), the paravirtualized drivers
    are included in a dedicated <span class="package">kernel-xen</span> package.
   </p><p>
    The paravirtualized drivers are available as follows:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.3.8.7.10.7.1"><span class="term">SUSE Linux Enterprise Server 12 / 12 SP1 / 12 SP2</span></dt><dd><p>
       Included in kernel
      </p></dd><dt id="id-1.12.3.8.7.10.7.2"><span class="term">SUSE Linux Enterprise Server 11 / 11 SP1 / 11 SP2 / 11 SP3 / 11 SP4</span></dt><dd><p>
       Included in kernel
      </p></dd><dt id="id-1.12.3.8.7.10.7.3"><span class="term">SUSE Linux Enterprise Server 10 SP4</span></dt><dd><p>
       Included in kernel
      </p></dd><dt id="id-1.12.3.8.7.10.7.4"><span class="term">Red Hat</span></dt><dd><p>
       Available since Red Hat Enterprise Linux 5.4. Starting from Red Hat Enterprise Linux 7.2, Red Hat removed
       the PV drivers.
      </p></dd><dt id="id-1.12.3.8.7.10.7.5"><span class="term">Windows</span></dt><dd><p>
       SUSE has developed virtio-based drivers for Windows, which are
       available in the Virtual Machine Driver Pack (VMDP). For more
       information, see
       <a class="link" href="https://www.suse.com/products/vmdriverpack/" target="_blank">https://www.suse.com/products/vmdriverpack/</a>.
      </p></dd></dl></div></section></section><section class="sect1" id="virt-migration-support" data-id-title="Supported VM migration scenarios"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.5 </span><span class="title-name">Supported VM migration scenarios</span></span> <a title="Permalink" class="permalink" href="#virt-migration-support">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> supports migrating a virtual machine from one physical host to
   another.
  </p><section class="sect2" id="virt-migration-offline" data-id-title="Offline migration scenarios"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.5.1 </span><span class="title-name">Offline migration scenarios</span></span> <a title="Permalink" class="permalink" href="#virt-migration-offline">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    SUSE supports offline migration, powering off a guest VM, then moving it
    to a host running a different SLE product, from SLE 12 to SLE 15
    SP<em class="replaceable">X</em>. The following host operating system
    combinations are fully supported (L3) for migrating guests from one host to
    another:
   </p><div class="table" id="id-1.12.3.8.8.3.3" data-id-title="Offline supported migrating guests from SUSE Linux Enterprise Server 12 SP3"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.5: </span><span class="title-name">Offline supported migrating guests from SUSE Linux Enterprise Server 12 SP3 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.3.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="4">
        <p>
         SUSE Linux Enterprise Server 12 SP3
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 12 SP3
        </p>
       </td></tr><tr><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 12 SP4
        </p>
       </td></tr><tr><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 12 SP5
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 GA
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.3.4" data-id-title="Offline supported migrating guests from SUSE Linux Enterprise Server 12 SP4"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.6: </span><span class="title-name">Offline supported migrating guests from SUSE Linux Enterprise Server 12 SP4 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.3.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="4">
        <p>
         SUSE Linux Enterprise Server 12 SP4
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 12 SP4
        </p>
       </td></tr><tr><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 12 SP5
        </p>
       </td></tr><tr><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 (KVM only)
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 SP1
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.3.5" data-id-title="Offline supported migrating guests from SUSE Linux Enterprise Server 12 SP5"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.7: </span><span class="title-name">Offline supported migrating guests from SUSE Linux Enterprise Server 12 SP5 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.3.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="3">
        <p>
         SUSE Linux Enterprise Server 12 SP5
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 12 SP5
        </p>
       </td></tr><tr><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 SP1
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 SP2
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.3.6" data-id-title="Offline supported migrating guests from SUSE Linux Enterprise Server 15 GA"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.8: </span><span class="title-name">Offline supported migrating guests from SUSE Linux Enterprise Server 15 GA </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.3.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="4">
        <p>
         SUSE Linux Enterprise Server 15 GA
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 GA
        </p>
       </td></tr><tr><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 SP1
        </p>
       </td></tr><tr><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 SP2
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 SP3
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.3.7" data-id-title="Offline supported migrating guests from SUSE Linux Enterprise Server 15 SP1"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.9: </span><span class="title-name">Offline supported migrating guests from SUSE Linux Enterprise Server 15 SP1 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.3.7">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="3">
        <p>
         SUSE Linux Enterprise Server 15 SP1
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 SP1
        </p>
       </td></tr><tr><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 SP2
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 SP3
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.3.8" data-id-title="Offline supported migrating guests from SUSE Linux Enterprise Server 15 SP2"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.10: </span><span class="title-name">Offline supported migrating guests from SUSE Linux Enterprise Server 15 SP2 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.3.8">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="2">
        <p>
         SUSE Linux Enterprise Server 15 SP2
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 SP2
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 SP3
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect2" id="virt-migration-live" data-id-title="Live migration scenarios"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.5.2 </span><span class="title-name">Live migration scenarios</span></span> <a title="Permalink" class="permalink" href="#virt-migration-live">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This section lists support status of various live migration scenarios when
    running virtualized on top of SLES. Also, refer to the supported
    <a class="link" href="https://documentation.suse.com/sles-15/html/SLES-all/cha-libvirt-managing.html#libvirt-admin-live-migration-requirements" target="_blank">live
    migration requirements</a>. The following host operating system
    combinations are fully supported (L3 in accordance with the respective
    <a class="link" href="https://www.suse.com/lifecycle" target="_blank">product life
    cycle</a>).
   </p><div class="table" id="id-1.12.3.8.8.4.3" data-id-title="Supported live-migrating guests from SLES 12 SP3"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.11: </span><span class="title-name">Supported live-migrating guests from SLES 12 SP3 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.4.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         SUSE Linux Enterprise Server 12 SP3
        </p>
       </td><td>
        <p>
         SLES 12 SP4
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.4.4" data-id-title="supported live-migrating guests from SLES 12 SP4"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.12: </span><span class="title-name">supported live-migrating guests from SLES 12 SP4 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.4.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="3">
        <p>
         SUSE Linux Enterprise Server 12 SP4
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 12 SP4
        </p>
       </td></tr><tr><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 12 SP5
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 GA (KVM only)
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.4.5" data-id-title="Supported live-migrating guests from SLES 12 SP5"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.13: </span><span class="title-name">Supported live-migrating guests from SLES 12 SP5 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.4.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="2">
        <p>
         SUSE Linux Enterprise Server 12 SP5
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 12 SP5
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 SP1
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.4.6" data-id-title="Supported live-migrating guests from SLES 15"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.14: </span><span class="title-name">Supported live-migrating guests from SLES 15 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.4.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="2">
        <p>
         SUSE Linux Enterprise Server 15 GA
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 GA
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 SP1
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.4.7" data-id-title="Supported live-migrating guests from SLES 15 SP1"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.15: </span><span class="title-name">Supported live-migrating guests from SLES 15 SP1 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.4.7">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="2">
        <p>
         SUSE Linux Enterprise Server 15 SP1
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 SP1
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 SP2
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.4.8" data-id-title="Supported live-migrating guests from SLES 15 SP2"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.16: </span><span class="title-name">Supported live-migrating guests from SLES 15 SP2 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.4.8">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="2">
        <p>
         SUSE Linux Enterprise Server 15 SP2
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 SP2
        </p>
       </td></tr><tr><td>
        <p>
         SLES 15 SP3
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.3.8.8.4.9" data-id-title="Supported live-migrating guests from SLES 15 SP3"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.17: </span><span class="title-name">Supported live-migrating guests from SLES 15 SP3 </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.8.4.9">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Host Source Product Name
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         To Host Target
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; " rowspan="2">
        <p>
         SUSE Linux Enterprise Server 15 SP3
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         SLES 15 SP3
        </p>
       </td></tr><tr><td>SLES 15 SP4 (when it is available)</td></tr></tbody></table></div></div><div id="id-1.12.3.8.8.4.10" data-id-title="Live migration" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Live migration</div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       SUSE always supports live migration of virtual machines between hosts
       running SLES with successive service pack numbers. For example, from
       SLES 15 SP2 to 15 SP3.
      </p></li><li class="listitem"><p>
       SUSE strives to support live migration of virtual machines from a host
       running a service pack under LTSS to a host running a newer service
       pack, within the same major version of SUSE Linux Enterprise Server. For example, virtual machine
       migration from a SLES 12 SP2 host to a SLES 12 SP5 host. SUSE only
       performs minimal testing of LTSS-to-newer migration scenarios and
       recommends thorough on-site testing before attempting to migrate
       critical virtual machines.
      </p></li></ul></div></div><div id="id-1.12.3.8.8.4.11" data-id-title="Xen live migration" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Xen live migration</div><p>
     Live migration between SLE 11 and SLE 12 is not supported because of the
     different tool stack, see the
     <a class="link" href="https://www.suse.com/releasenotes/x86_64/SUSE-SLES/12/#fate-317306" target="_blank">
     Release notes</a> for more details.
    </p></div></section></section><section class="sect1" id="virt-support-feature-support" data-id-title="Feature support"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.6 </span><span class="title-name">Feature support</span></span> <a title="Permalink" class="permalink" href="#virt-support-feature-support">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="virt-support-feature-support-host" data-id-title="Xen host (Dom0)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.6.1 </span><span class="title-name">Xen host (Dom0)</span></span> <a title="Permalink" class="permalink" href="#virt-support-feature-support-host">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><div class="table" id="id-1.12.3.8.9.3.2" data-id-title="Feature support—host (Dom0)"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.18: </span><span class="title-name">Feature support—host (<code class="literal">Dom0</code>) </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.9.3.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Features
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         Xen
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Network and block device hotplugging
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Physical <a class="xref" href="#gloss-vt-cpu-hotplug" title="CPU hotplugging">CPU hotplugging</a>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         No
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Virtual <a class="xref" href="#gloss-vt-cpu-hotplug" title="CPU hotplugging">CPU hotplugging</a>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Virtual <a class="xref" href="#gloss-vt-cpu-pinning" title="CPU pinning">CPU pinning</a>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Virtual <a class="xref" href="#gloss-vt-cpu-capping" title="CPU capping">CPU capping</a>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Intel* VT-x2: FlexPriority, FlexMigrate (migration constraints apply
         to dissimilar CPU architectures)
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Intel* VT-d2 (DMA remapping with interrupt filtering and queued
         invalidation)
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         AMD* IOMMU (I/O page table with guest-to-host physical address
         translation)
        </p>
       </td><td>
        <p>
         Yes
        </p>
       </td></tr></tbody></table></div></div><div id="id-1.12.3.8.9.3.3" data-id-title="Adding or removing physical CPUs at runtime is not supported" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Adding or removing physical CPUs at runtime is not supported</div><p>
     The addition or removal of physical CPUs at runtime is not supported.
     However, virtual CPUs can be added or removed for each VM Guest while
     offline.
    </p></div></section><section class="sect2" id="virt-support-feature-support-pv" data-id-title="Xen paravirtualized guest (DomU)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.6.2 </span><span class="title-name">Xen paravirtualized guest (DomU)</span></span> <a title="Permalink" class="permalink" href="#virt-support-feature-support-pv">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><div class="table" id="id-1.12.3.8.9.4.2" data-id-title="Feature support—paravirtualized guest"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.19: </span><span class="title-name">Feature support—paravirtualized guest </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.9.4.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Features
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         Xen
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Virtual network and virtual block device hotplugging
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Virtual <a class="xref" href="#gloss-vt-cpu-hotplug" title="CPU hotplugging">CPU hotplugging</a>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Virtual <a class="xref" href="#gloss-vt-cpu-overcommit" title="CPU over-commitment">CPU over-commitment</a>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Dynamic virtual memory resize
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         VM save and restore
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         VM live migration
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes (See <a class="xref" href="#libvirt-admin-live-migration-requirements" title="11.7.1. Migration requirements">Section 11.7.1, “Migration requirements”</a>)
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Advanced debugging with GDBC
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Dom0 metrics visible to VM
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Memory ballooning
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         PCI Pass-Through
        </p>
       </td><td>
        <p>
         Yes (NetWare guests are excluded)
        </p>
       </td></tr></tbody></table></div></div><p>
    For live migration, both source and target system architectures need to
    match; that is, the processors (AMD* or Intel*) must be the same. Unless
    CPU ID masking is used, such as with Intel FlexMigration, the target should
    feature the same processor revision or a more recent processor revision
    than the source. If VMs are moved among different systems, the same rules
    apply for each move. To avoid failing optimized code at runtime or
    application start-up, source and target CPUs need to expose the same
    processor extensions. Xen exposes the physical CPU extensions to the VMs
    transparently. To summarize, guests can be 32-bit or 64-bit, but the
    <a class="xref" href="#gloss-vt-vhs" title="VHS">VHS</a> must be identical.
   </p><div id="id-1.12.3.8.9.4.4" data-id-title="Intel flexMigration" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Intel flexMigration</div><p>
     For machines that support Intel FlexMigration, CPU-ID masking and faulting
     allow more flexibility in cross-CPU migration.
    </p></div></section><section class="sect2" id="virt-support-feature-support-fv" data-id-title="Fully virtualized guest"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.6.3 </span><span class="title-name">Fully virtualized guest</span></span> <a title="Permalink" class="permalink" href="#virt-support-feature-support-fv">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><div class="table" id="id-1.12.3.8.9.5.2" data-id-title="Feature support—fully virtualized guest"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 7.20: </span><span class="title-name">Feature support—fully virtualized guest </span></span><a title="Permalink" class="permalink" href="#id-1.12.3.8.9.5.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Features
        </p>
       </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Xen
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         KVM
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Virtual network and virtual block device hotplugging
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Virtual <a class="xref" href="#gloss-vt-cpu-hotplug" title="CPU hotplugging">CPU hotplugging</a>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         No
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         No
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Virtual <a class="xref" href="#gloss-vt-cpu-overcommit" title="CPU over-commitment">CPU over-commitment</a>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Dynamic virtual memory resize
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         VM save and restore
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         VM Live Migration
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Yes (See <a class="xref" href="#libvirt-admin-live-migration-requirements" title="11.7.1. Migration requirements">Section 11.7.1, “Migration requirements”</a>)
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         VM snapshot
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Advanced debugging with GDBC
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Dom0 metrics visible to VM
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         PCI Pass-Through
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Yes
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         AMD SEV
        </p>
       </td><td style="border-right: 1px solid ; ">
        <p>
         No
        </p>
       </td><td>
        <p>
         Yes (See <a class="link" href="https://documentation.suse.com/sles/15-SP3/html/SLES-amd-sev/article-amd-sev.html" target="_blank">https://documentation.suse.com/sles/15-SP3/html/SLES-amd-sev/article-amd-sev.html</a>)
        </p>
       </td></tr></tbody></table></div></div><div id="id-1.12.3.8.9.5.3" data-id-title="Windows guest" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Windows guest</div><p>
     Hotplugging of virtual network and virtual block devices, and resizing,
     shrinking, and restoring dynamic virtual memory are supported in Xen and
     KVM only if PV drivers are being used
     (<a class="link" href="https://www.suse.com/products/vmdriverpack/" target="_blank">VMDP</a>).
    </p></div><p>
    For KVM, a detailed description of supported limits, features,
    recommended settings and scenarios, and other useful information is
    maintained in <code class="filename">kvm-supported.txt</code>. This file is part of
    the KVM package and can be found in
    <code class="filename">/usr/share/doc/packages/qemu-kvm</code>.
   </p></section></section><section class="sect1" id="vt-support-nested" data-id-title="Nested virtualization"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.7 </span><span class="title-name">Nested virtualization</span></span> <a title="Permalink" class="permalink" href="#vt-support-nested">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Nested virtualization allows you to run a virtual machine inside another VM
   while still using hardware acceleration from the host. It has very bad
   performance and adds more complexity while debugging. Nested virtualization
   is mostly used for testing purposes. In SUSE Linux Enterprise Server, nested virtualization is a
   Technology Preview. It is only provided for testing purposes and is not
   supported. Bugs can be reported but they will be treated with low priority.
   Any attempt to live-migrate or to save or restore VMs in the presence of nested
   virtualization is also explicitly unsupported.
  </p></section></section></div><div class="part" id="part-virt-libvirt" data-id-title="Managing virtual machines with libvirt"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part II </span><span class="title-name">Managing virtual machines with <code class="systemitem">libvirt</code> </span></span><a title="Permalink" class="permalink" href="#part-virt-libvirt">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/book_virtualization.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-libvirt-overview"><span class="title-number">8 </span><span class="title-name">Starting and stopping <code class="systemitem">libvirtd</code></span></a></span></li><dd class="toc-abstract"><p>The communication between the virtualization solutions (KVM, Xen) and the libvirt API is managed by the libvirtd daemon. It needs to run on the VM Host Server. libvirt client applications such as virt-manager, possibly running on a remote machine, communicate with libvirtd running on the VM Host Ser…</p></dd><li><span class="chapter"><a href="#cha-libvirt-host"><span class="title-number">9 </span><span class="title-name">Preparing the VM Host Server</span></a></span></li><dd class="toc-abstract"><p>
  Before you can install guest virtual machines, you need to prepare the
  VM Host Server to provide the guests with the resources that they need for their
  operation. Specifically, you need to configure:
 </p></dd><li><span class="chapter"><a href="#cha-kvm-inst"><span class="title-number">10 </span><span class="title-name">Guest installation</span></a></span></li><dd class="toc-abstract"><p>A VM Guest consists of an image containing an operating system and data files and a configuration file describing the VM Guest's virtual hardware resources. VM Guests are hosted on and controlled by the VM Host Server. This section provides generalized instructions for installing a VM Guest. For a l…</p></dd><li><span class="chapter"><a href="#cha-libvirt-managing"><span class="title-number">11 </span><span class="title-name">Basic VM Guest management</span></a></span></li><dd class="toc-abstract"><p>
  Most management tasks, such as starting or stopping a VM Guest, can either
  be done using the graphical application Virtual Machine Manager or on the command line using
  <code class="command">virsh</code>. Connecting to the graphical console via VNC is only
  possible from a graphical user interface.
 </p></dd><li><span class="chapter"><a href="#cha-libvirt-connect"><span class="title-number">12 </span><span class="title-name">Connecting and authorizing</span></a></span></li><dd class="toc-abstract"><p>
  Managing several VM Host Servers, each hosting multiple VM Guests, quickly
  becomes difficult.  One benefit of <code class="systemitem">libvirt</code> is the ability to connect to
  several VM Host Servers at once, providing a single interface to manage all
  VM Guests and to connect to their graphical console.
 </p></dd><li><span class="chapter"><a href="#cha-libvirt-storage"><span class="title-number">13 </span><span class="title-name">Advanced storage topics</span></a></span></li><dd class="toc-abstract"><p>
  This chapter introduces advanced topics about manipulating storage from the
  perspective of the VM Host Server.
 </p></dd><li><span class="chapter"><a href="#cha-libvirt-config-gui"><span class="title-number">14 </span><span class="title-name">Configuring virtual machines with Virtual Machine Manager</span></a></span></li><dd class="toc-abstract"><p>
    Virtual Machine Manager's <span class="guimenu">Details</span> view offers in-depth information about
    the VM Guest's complete configuration and hardware equipment. Using this
    view, you can also change the guest configuration or add and modify virtual
    hardware. To access this view, open the guest's console in Virtual Machine Manager and either
    choose <span class="guimenu">View</span> › <span class="guimenu">Details</span> from the menu, or click <span class="guimenu">Show virtual hardware
    details</span> in the toolbar.
   </p></dd><li><span class="chapter"><a href="#cha-libvirt-config-virsh"><span class="title-number">15 </span><span class="title-name">Configuring virtual machines with <code class="command">virsh</code></span></a></span></li><dd class="toc-abstract"><p>
    You can use <code class="command">virsh</code> to configure virtual machines (VM) on the command line
    as an alternative to using the Virtual Machine Manager. With <code class="command">virsh</code>, you can control the
    state of a VM, edit the configuration of a VM or even migrate a VM to
    another host. The following sections describe how to manage VMs by using
    <code class="command">virsh</code>.
   </p></dd><li><span class="chapter"><a href="#cha-libvirt-manage-vagrant"><span class="title-number">16 </span><span class="title-name">Managing virtual machines with Vagrant</span></a></span></li><dd class="toc-abstract"><p>
    Vagrant is a tool that provides a unified workflow for the creation,
    deployment and management of virtual development environments.
    The following sections describe how to manage virtual machines by using
    Vagrant.
   </p></dd><li><span class="chapter"><a href="#xen2kvm-migration"><span class="title-number">17 </span><span class="title-name">Xen to KVM migration guide</span></a></span></li><dd class="toc-abstract"><p>As the KVM virtualization solution is becoming more and more popular among server administrators, many of them need a path to migrate their existing Xen based environments to KVM. As of now, there are no mature tools to automatically convert Xen VMs to KVM. There is, however, a technical solution th…</p></dd></ul></div><section class="chapter" id="cha-libvirt-overview" data-id-title="Starting and stopping libvirtd"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">8 </span><span class="title-name">Starting and stopping <code class="systemitem">libvirtd</code></span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-overview">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_overview.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The communication between the virtualization solutions (KVM, Xen)
  and the libvirt API is managed by the <code class="systemitem">libvirtd</code> daemon. It needs to run
  on the VM Host Server. libvirt client applications such as virt-manager, possibly
  running on a remote machine, communicate with <code class="systemitem">libvirtd</code> running on the
  VM Host Server, which services the request using native hypervisor APIs. Use the
  following commands to start and stop <code class="systemitem">libvirtd</code> or check its status:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start libvirtd

<code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl status libvirtd
libvirtd.service - Virtualization daemon
Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled)
Active: active (running) since Mon 2014-05-12 08:49:40 EDT; 2s ago
[...]

<code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl stop libvirtd

<code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl status libvirtd
[...]
Active: inactive (dead) since Mon 2014-05-12 08:51:11 EDT; 4s ago
[...]</pre></div><p>
  To automatically start <code class="systemitem">libvirtd</code> at boot time, either activate it using the
  YaST <span class="guimenu">Services Manager</span> module or by entering the following
  command:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable libvirtd</pre></div><div id="id-1.12.4.2.7" data-id-title="Conflicting services: libvirtd and xendomains" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Conflicting services: <code class="systemitem">libvirtd</code>
  and <code class="systemitem">xendomains</code></div><p>
   If <code class="systemitem">libvirtd</code> fails to start,
   check if the service <code class="systemitem">xendomains</code> is
   loaded:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>systemctl is-active xendomains
active</pre></div><p>
   If the command returns <code class="literal">active</code>, you need to stop
   <code class="systemitem">xendomains</code> before you can
   start the <code class="systemitem">libvirtd</code> daemon. If
   you want <code class="systemitem">libvirtd</code> to also start
   after rebooting, additionally prevent <code class="systemitem">xendomains</code> from starting automatically. Disable
   the service:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl stop xendomains
<code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl disable xendomains
<code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start libvirtd</pre></div><p>
   <code class="systemitem">xendomains</code> and <code class="systemitem">libvirtd</code> provide the same service and when used
   in parallel may interfere with one another. As an example, <code class="systemitem">xendomains</code> may attempt to start a domU already
   started by <code class="systemitem">libvirtd</code>.
  </p></div></section><section class="chapter" id="cha-libvirt-host" data-id-title="Preparing the VM Host Server"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">9 </span><span class="title-name">Preparing the VM Host Server</span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-host">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Before you can install guest virtual machines, you need to prepare the
  VM Host Server to provide the guests with the resources that they need for their
  operation. Specifically, you need to configure:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    <span class="emphasis"><em>Networking</em></span> so that guests can make use of the network
    connection provided the host.
   </p></li><li class="listitem"><p>
    A <span class="emphasis"><em>storage pool</em></span> reachable from the host so that the
    guests can store their disk images.
   </p></li></ul></div><section class="sect1" id="libvirt-host-network" data-id-title="Configuring networks"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.1 </span><span class="title-name">Configuring networks</span></span> <a title="Permalink" class="permalink" href="#libvirt-host-network">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are two common network configurations to provide a VM Guest with a
   network connection:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     A <span class="emphasis"><em>network bridge</em></span>. This is the default and recommended
     way of providing the guests with network connection.
    </p></li><li class="listitem"><p>
     A <span class="emphasis"><em>virtual network</em></span> with forwarding enabled.
    </p></li></ul></div><section class="sect2" id="libvirt-networks-bridged" data-id-title="Network bridge"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.1.1 </span><span class="title-name">Network bridge</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-bridged">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The network bridge configuration provides a Layer 2 switch for VM Guests,
    switching Layer 2 Ethernet packets between ports on the bridge based on MAC
    addresses associated with the ports. This gives the VM Guest Layer 2
    access to the VM Host Server's network. This configuration is analogous to
    connecting the VM Guest's virtual Ethernet cable into a hub that is shared
    with the host and other VM Guests running on the host. The configuration
    is often referred to as <span class="emphasis"><em>shared physical device</em></span>.
   </p><p>
    The network bridge configuration is the default configuration of
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> when configured as a KVM or Xen hypervisor. It is the
    preferred configuration when you simply want to connect VM Guests to the
    VM Host Server's LAN.
   </p><p>
    Which tool to use to create the network bridge depends on the service you
    use to manage the network connection on the VM Host Server:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      If a network connection is managed by <code class="systemitem">wicked</code>,
      use either YaST or the command line to create the network bridge.
      <code class="systemitem">wicked</code> is the default on server hosts.
     </p></li><li class="listitem"><p>
      If a network connection is managed by NetworkManager, use the NetworkManager command line tool
      <code class="command">nmcli</code> to create the network bridge.
      NetworkManager is the default on desktop and laptops.
     </p></li></ul></div><section class="sect3" id="libvirt-networks-bridged-yast" data-id-title="Managing network bridges with YaST"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.1.1.1 </span><span class="title-name">Managing network bridges with YaST</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-bridged-yast">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This section includes procedures to add or remove network bridges with
     YaST.
    </p><section class="sect4" id="libvirt-networks-bridged-yast-add" data-id-title="Adding a network bridge"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.1.1.1 </span><span class="title-name">Adding a network bridge</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-bridged-yast-add">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To add a network bridge on VM Host Server, follow these steps:
     </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Start
        <span class="guimenu">YaST</span> › <span class="guimenu">System</span> › <span class="guimenu">Network
        Settings</span>.
       </p></li><li class="step"><p>
        Activate the <span class="guimenu">Overview</span> tab and click
        <span class="guimenu">Add</span>.
       </p></li><li class="step"><p>
        Select <span class="guimenu">Bridge</span> from the <span class="guimenu">Device
        Type</span> list and enter the bridge device interface name in the
        <span class="guimenu">Configuration Name</span> entry. Click the
        <span class="guimenu">Next</span> button to proceed.
       </p></li><li class="step"><p>
        In the <span class="guimenu">Address</span> tab, specify networking details such
        as DHCP/static IP address, subnet mask or host name.
       </p><p>
        Using <span class="guimenu">Dynamic Address</span> is only useful when also
        assigning a device to a bridge that is connected to a DHCP server.
       </p><p>
        If you intend to create a virtual bridge that has no connection to a
        real network device, use <span class="guimenu">Statically assigned IP
        Address</span>. In this case, it is a good idea to use addresses
        from the private IP address ranges, for example,
        <code class="literal">192.168.0.0/16</code>, <code class="literal">172.16.0.0/12</code>, or
        <code class="literal">10.0.0.0/8</code>.
       </p><p>
        To create a bridge that should only serve as a connection between the
        different guests without connection to the host system, set the IP
        address to <code class="literal">0.0.0.0</code> and the subnet mask to
        <code class="literal">255.255.255.255</code>. The network scripts handle this
        special address as an unset IP address.
       </p></li><li class="step"><p>
        Activate the <span class="guimenu">Bridged Devices</span> tab and activate the
        network devices you want to include in the network bridge.
       </p></li><li class="step"><p>
        Click <span class="guimenu">Next</span> to return to the
        <span class="guimenu">Overview</span> tab and confirm with <span class="guimenu">OK</span>.
        The new network bridge should now be active on VM Host Server.
       </p></li></ol></div></div></section><section class="sect4" id="libvirt-networks-bridged-yast-rm" data-id-title="Deleting a network bridge"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.1.1.2 </span><span class="title-name">Deleting a network bridge</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-bridged-yast-rm">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To delete an existing network bridge, follow these steps:
     </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Start
        <span class="guimenu">YaST</span> › <span class="guimenu">System</span> › <span class="guimenu">Network
        Settings</span>.
       </p></li><li class="step"><p>
        Select the bridge device you want to delete from the list in the
        <span class="guimenu">Overview</span> tab.
       </p></li><li class="step"><p>
        Delete the bridge with <span class="guimenu">Delete</span> and confirm with
        <span class="guimenu">OK</span>.
       </p></li></ol></div></div></section></section><section class="sect3" id="libvirt-networks-bridged-add-brctl" data-id-title="Managing network bridges from the command line"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.1.1.2 </span><span class="title-name">Managing network bridges from the command line</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-bridged-add-brctl">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This section includes procedures to add or remove network bridges using
     the command line.
    </p><section class="sect4" id="libvirt-networks-bridged-add-brctl-add" data-id-title="Adding a network bridge"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.1.2.1 </span><span class="title-name">Adding a network bridge</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-bridged-add-brctl-add">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To add a new network bridge device on VM Host Server, follow these steps:
     </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Log in as <code class="systemitem">root</code> on the VM Host Server where you want to create a new
        network bridge.
       </p></li><li class="step"><p>
        Choose a name for the new
        bridge—<em class="replaceable">virbr_test</em> in our
        example—and run
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ip link add name <em class="replaceable">VIRBR_TEST</em> type bridge</pre></div></li><li class="step"><p>
        Check if the bridge was created on VM Host Server:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>bridge vlan
[...]
virbr_test  1 PVID Egress Untagged</pre></div><p>
        <code class="literal">virbr_test</code> is present, but is not associated with
        any physical network interface.
       </p></li><li class="step"><p>
        Bring the network bridge up and add a network interface to the bridge:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ip link set virbr_test up
<code class="prompt root"># </code>ip link set eth1 master virbr_test</pre></div><div id="id-1.12.4.3.4.4.7.3.3.4.3" data-id-title="Network interface must be unused" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Network interface must be unused</div><p>
         You can only assign a network interface that is not yet used by
         another network bridge.
        </p></div></li><li class="step"><p>
        Optionally, enable STP (see
        <a class="link" href="https://en.wikipedia.org/wiki/Spanning_Tree_Protocol" target="_blank">Spanning
        Tree Protocol</a>):
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>bridge link set dev virbr_test cost 4</pre></div></li></ol></div></div></section><section class="sect4" id="libvirt-networks-bridged-add-brctl-del" data-id-title="Deleting a network bridge"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.1.2.2 </span><span class="title-name">Deleting a network bridge</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-bridged-add-brctl-del">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To delete an existing network bridge device on VM Host Server from the command
      line, follow these steps:
     </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Log in as <code class="systemitem">root</code> on the VM Host Server where you want to delete an
        existing network bridge.
       </p></li><li class="step"><p>
        List existing network bridges to identify the name of the bridge to
        remove:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>bridge vlan
[...]
virbr_test  1 PVID Egress Untagged</pre></div></li><li class="step"><p>
        Delete the bridge:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ip link delete dev virbr_test</pre></div></li></ol></div></div></section></section><section class="sect3" id="libvirt-networks-bridged-add-nm" data-id-title="Adding a network bridge with nmcli"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.1.1.3 </span><span class="title-name">Adding a network bridge with <code class="command">nmcli</code></span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-bridged-add-nm">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This section includes procedures to add a network bridge with NetworkManager's
     command line tool <code class="command">nmcli</code>.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       List active network connections:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> nmcli connection show --active
NAME                   UUID                                  TYPE      DEVICE
Ethernet connection 1  84ba4c22-0cfe-46b6-87bb-909be6cb1214  ethernet  eth0</pre></div></li><li class="step"><p>
       Add a new bridge device named <code class="literal">br0</code> and verify its
       creation:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> nmcli connection add type bridge ifname br0
Connection 'bridge-br0' (36e11b95-8d5d-4a8f-9ca3-ff4180eb89f7) \
successfully added.
<code class="prompt user">&gt; </code><code class="command">sudo</code> nmcli connection show --active
NAME                   UUID                                  TYPE      DEVICE
bridge-br0             36e11b95-8d5d-4a8f-9ca3-ff4180eb89f7  bridge    br0
Ethernet connection 1  84ba4c22-0cfe-46b6-87bb-909be6cb1214  ethernet  eth0</pre></div></li><li class="step"><p>
       Optionally, you can view the bridge settings:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> nmcli -f bridge connection show bridge-br0
bridge.mac-address:                     --
bridge.stp:                             yes
bridge.priority:                        32768
bridge.forward-delay:                   15
bridge.hello-time:                      2
bridge.max-age:                         20
bridge.ageing-time:                     300
bridge.group-forward-mask:              0
bridge.multicast-snooping:              yes
bridge.vlan-filtering:                  no
bridge.vlan-default-pvid:               1
bridge.vlans:                           --</pre></div></li><li class="step"><p>
       Link the bridge device to the physical ethernet device
       <code class="literal">eth0</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> nmcli connection add type bridge-slave ifname eth0 master br0</pre></div></li><li class="step"><p>
       Disable the <code class="literal">eth0</code> interface and enable the new
       bridge:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> nmcli connection down "Ethernet connection 1"
<code class="prompt user">&gt; </code><code class="command">sudo</code> nmcli connection up bridge-br0
Connection successfully activated (master waiting for slaves) \
(D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/9)</pre></div></li></ol></div></div></section><section class="sect3" id="sec-xen-net-vlan" data-id-title="Using VLAN interfaces"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.1.1.4 </span><span class="title-name">Using VLAN interfaces</span></span> <a title="Permalink" class="permalink" href="#sec-xen-net-vlan">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Sometimes it is necessary to create a private connection either between
     two VM Host Servers or between VM Guest systems. For example, to migrate
     a VM Guest to hosts in a different network segment. Or to create a private
     bridge that only VM Guest systems may connect to (even when running on
     different VM Host Server systems). An easy way to build such connections is to
     set up VLAN networks.
    </p><p>
     VLAN interfaces are commonly set up on the VM Host Server. They either
     interconnect the different VM Host Server systems, or they may be set up as a
     physical interface to an otherwise virtual-only bridge. It is even
     possible to create a bridge with a VLAN as a physical interface that has
     no IP address in the VM Host Server. That way, the guest systems have no
     possibility to access the host over this network.
    </p><p>
     Run the YaST module
     <span class="guimenu">System</span> › <span class="guimenu">Network
     Settings</span>. Follow this procedure to set up the VLAN
     device:
    </p><div class="procedure" id="id-1.12.4.3.4.4.9.5" data-id-title="Setting up VLAN interfaces with YaST"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 9.1: </span><span class="title-name">Setting up VLAN interfaces with YaST </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.3.4.4.9.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Click <span class="guimenu">Add</span> to create a new network interface.
      </p></li><li class="step"><p>
       In the <span class="guimenu">Hardware Dialog</span>, select <span class="guimenu">Device
       Type</span> <span class="guimenu">VLAN</span>.
      </p></li><li class="step"><p>
       Change the value of <span class="guimenu">Configuration Name</span> to the ID of
       your VLAN. Note that VLAN ID <code class="literal">1</code> is commonly used for
       management purposes.
      </p></li><li class="step"><p>
       Click <span class="guimenu">Next</span>.
      </p></li><li class="step"><p>
       Select the interface that the VLAN device should connect to below
       <span class="guimenu">Real Interface for VLAN</span>. If the desired interface
       does not appear in the list, first set up this interface without an IP
       address.
      </p></li><li class="step"><p>
       Select the desired method for assigning an IP address to the VLAN
       device.
      </p></li><li class="step"><p>
       Click <span class="guimenu">Next</span> to finish the configuration.
      </p></li></ol></div></div><p>
     It is also possible to use the VLAN interface as a physical interface of a
     bridge. This makes it possible to connect several VM Host Server-only networks
     and allows live migration of VM Guest systems that are connected to such
     a network.
    </p><p>
     YaST does not always allow setting no IP address. However, this may be a
     desired feature, especially if VM Host Server-only networks should be connected.
     In this case, use the special address <code class="literal">0.0.0.0</code> with
     netmask <code class="literal">255.255.255.255</code>. The system scripts handle this
     address as no IP address set.
    </p></section></section><section class="sect2" id="libvirt-networks-virtual" data-id-title="Virtual networks"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.1.2 </span><span class="title-name">Virtual networks</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="systemitem">libvirt</code>-managed virtual networks are similar to bridged networks, but
    typically have no Layer 2 connection to the VM Host Server. Connectivity to the
    VM Host Server's physical network is accomplished with Layer 3 forwarding, which
    introduces additional packet processing on the VM Host Server as compared to a
    Layer 2 bridged network. Virtual networks also provide DHCP and DNS
    services for VM Guests. For more information on <code class="systemitem">libvirt</code> virtual
    networks, see the <em class="citetitle">Network XML format</em> documentation
    at <a class="link" href="https://libvirt.org/formatnetwork.html" target="_blank">https://libvirt.org/formatnetwork.html</a>.
   </p><p>
    A standard <code class="systemitem">libvirt</code> installation on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> already comes with a
    predefined virtual network named <code class="literal">default</code>. It provides
    DHCP and DNS services for the network, along with connectivity to the
    VM Host Server's physical network using the network address translation (NAT)
    forwarding mode. Although it is predefined, the <code class="literal">default</code>
    virtual network needs to be explicitly enabled by the administrator. For more
    information on the forwarding modes supported by <code class="systemitem">libvirt</code>, see the
    <em class="citetitle">Connectivity</em> section of the <em class="citetitle">Network XML
    format</em> documentation at
    <a class="link" href="https://libvirt.org/formatnetwork.html#elementsConnect" target="_blank">https://libvirt.org/formatnetwork.html#elementsConnect</a>.
   </p><p>
    <code class="systemitem">libvirt</code>-managed virtual networks can be used to satisfy a wide range of
    use cases, but are commonly used on VM Host Servers that have a wireless
    connection or dynamic/sporadic network connectivity, such as laptops.
    Virtual networks are also useful when the VM Host Server's network has limited IP
    addresses, allowing forwarding of packets between the virtual network and
    the VM Host Server's network. However, most server use cases are better suited
    for the network bridge configuration, where VM Guests are connected to the
    VM Host Server's LAN.
   </p><div id="id-1.12.4.3.4.5.5" data-id-title="Enabling forwarding mode" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Enabling forwarding mode</div><p>
     Enabling forwarding mode in a <code class="systemitem">libvirt</code> virtual network enables forwarding
     in the VM Host Server by setting
     <code class="filename">/proc/sys/net/ipv4/ip_forward</code> and
     <code class="filename">/proc/sys/net/ipv6/conf/all/forwarding</code> to 1, which
     essentially turns the VM Host Server into a router. Restarting the VM Host Server's
     network may reset the values and disable forwarding. To avoid this
     behavior, explicitly enable forwarding in the VM Host Server by editing the
     <code class="filename">/etc/sysctl.conf</code> file and adding:
    </p><div class="verbatim-wrap"><pre class="screen">net.ipv4.ip_forward = 1</pre></div><div class="verbatim-wrap"><pre class="screen">net.ipv6.conf.all.forwarding = 1</pre></div></div><section class="sect3" id="libvirt-networks-virtual-vmm" data-id-title="Managing virtual networks with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.1.2.1 </span><span class="title-name">Managing virtual networks with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-vmm">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can define, configure, and operate virtual networks with Virtual Machine Manager.
    </p><section class="sect4" id="libvirt-networks-virtual-vmm-define" data-id-title="Defining virtual networks"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.1.1 </span><span class="title-name">Defining virtual networks</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-vmm-define">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Start Virtual Machine Manager. In the list of available connections, right-click the name
        of the connection for which you need to configure the virtual network,
        and then select <span class="guimenu">Details</span>.
       </p></li><li class="step"><p>
        In the <span class="guimenu">Connection Details</span> window, click the
        <span class="guimenu">Virtual Networks</span> tab. You can see the list of all
        virtual networks available for the current connection. On the right,
        there are details of the selected virtual network.
       </p><div class="figure" id="id-1.12.4.3.4.5.6.3.2.2.2"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_conndetails.png"><img src="images/libvirt_vmm_conndetails.png" width="45%" alt="Connection details" title="Connection details"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 9.1: </span><span class="title-name">Connection details </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.3.4.5.6.3.2.2.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
        To add a new virtual network, click <span class="guimenu">Add</span>.
       </p></li><li class="step"><p>
        Specify a name for the new virtual network.
       </p><div class="figure" id="id-1.12.4.3.4.5.6.3.2.4.2"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_vnet_ipv4.png"><img src="images/libvirt_vmm_vnet_ipv4.png" width="45%" alt="Create virtual network" title="Create virtual network"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 9.2: </span><span class="title-name">Create virtual network </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.3.4.5.6.3.2.4.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
        Specify the networking mode.
        For the <span class="guimenu">NAT</span> and <span class="guimenu">Routed</span> types,
        you can specify to which device to forward network communications.
        While
        <span class="guimenu">NAT</span> (network address translation) remaps the virtual
        network address space and allows sharing a single IP address,
        <span class="guimenu">Routed</span> forwards packets from the virtual network to
        the VM Host Server's physical network with no translation.
       </p></li><li class="step"><p>
        If you need IPv4 networking, activate <span class="guimenu">Enable IPv4</span> and specify the IPv4 network address.
        If you need a DHCP server, activate <span class="guimenu">Enable DHCPv4</span> and specify the assignable IP address range.
       </p></li><li class="step"><p>
        If you need IPv6 networking, activate <span class="guimenu">Enable IPv6</span> and specify the IPv6 network address.
        If you need a DHCP server, activate <span class="guimenu">Enable DHCPv6</span> and specify the assignable IP address range.
       </p></li><li class="step"><p>
        If you want to specify a different domain name than the name of the virtual network,
        select <span class="guimenu">Custom</span> under <span class="guimenu">DNS domain name</span>
        and enter it here.
       </p></li><li class="step"><p>
        Click <span class="guimenu">Finish</span> to create the new virtual network. On
        the VM Host Server, a new virtual network bridge
        <code class="literal">virbr<em class="replaceable">X</em></code> is available,
        which corresponds to the newly created virtual network. You can check
        with <code class="command">bridge link</code>. <code class="systemitem">libvirt</code> automatically adds
        iptables rules to allow traffic to/from guests attached to the new
        <span class="emphasis"><em>virbr<em class="replaceable">X</em></em></span> device.
       </p></li></ol></div></div></section><section class="sect4" id="libvirt-networks-virtual-vmm-start" data-id-title="Starting virtual networks"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.1.2 </span><span class="title-name">Starting virtual networks</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-vmm-start">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To start a virtual network that is temporarily stopped, follow these
      steps:
     </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Start Virtual Machine Manager. In the list of available connections, right-click the name
        of the connection for which you need to configure the virtual network,
        and then select <span class="guimenu">Details</span>.
       </p></li><li class="step"><p>
        In the <span class="guimenu">Connection Details</span> window, click the
        <span class="guimenu">Virtual Networks</span> tab. You can see the list of all
        virtual networks available for the current connection.
       </p></li><li class="step"><p>
        To start the virtual network, click <span class="guimenu">Start</span>.
       </p></li></ol></div></div></section><section class="sect4" id="libvirt-networks-virtual-vmm-stop" data-id-title="Stopping virtual networks"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.1.3 </span><span class="title-name">Stopping virtual networks</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-vmm-stop">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To stop an active virtual network, follow these steps:
     </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Start Virtual Machine Manager. In the list of available connections, right-click the name
        of the connection for which you need to configure the virtual network,
        and then select <span class="guimenu">Details</span>.
       </p></li><li class="step"><p>
        In the <span class="guimenu">Connection Details</span> window, click the
        <span class="guimenu">Virtual Networks</span> tab. You can see the list of all
        virtual networks available for the current connection.
       </p></li><li class="step"><p>
        Select the virtual network to be stopped, then click
        <span class="guimenu">Stop</span>.
       </p></li></ol></div></div></section><section class="sect4" id="libvirt-networks-virtual-vmm-delete" data-id-title="Deleting virtual networks"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.1.4 </span><span class="title-name">Deleting virtual networks</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-vmm-delete">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To delete a virtual network from VM Host Server, follow these steps:
     </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Start Virtual Machine Manager. In the list of available connections, right-click the name
        of the connection for which you need to configure the virtual network,
        and then select <span class="guimenu">Details</span>.
       </p></li><li class="step"><p>
        In the <span class="guimenu">Connection Details</span> window, click the
        <span class="guimenu">Virtual Networks</span> tab. You can see the list of all
        virtual networks available for the current connection.
       </p></li><li class="step"><p>
        Select the virtual network to be deleted, then click
        <span class="guimenu">Delete</span>.
       </p></li></ol></div></div></section><section class="sect4" id="libvirt-networks-virtual-vmm-nsswitch" data-id-title="Obtaining IP addresses with nsswitch for NAT networks (in KVM)"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.1.5 </span><span class="title-name">Obtaining IP addresses with <code class="command">nsswitch</code> for NAT networks (in KVM)</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-vmm-nsswitch">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        On VM Host Server, install libvirt-nss, which provides NSS support for
        libvirt:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper in libvirt-nss</pre></div></li><li class="listitem"><p>
        Add <code class="literal">libvirt</code> to
        <code class="filename">/etc/nsswitch.conf</code>:
       </p><div class="verbatim-wrap"><pre class="screen">...
hosts:  files libvirt mdns_minimal [NOTFOUND=return] dns
...</pre></div></li><li class="listitem"><p>
        If NSCD is running, restart it:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart nscd</pre></div></li></ul></div><p>
      Now you can reach the guest system by name from the host.
     </p><p>
      The NSS module has limited functionality. It reads
      <code class="filename">/var/lib/libvirt/dnsmasq/*.status</code> files to find the
      host name and corresponding IP addresses in a JSON record describing each
      lease provided by <code class="command">dnsmasq</code>. Host name translation can
      only be done on those VM Host Servers using a libvirt-managed bridged network
      backed by <code class="command">dnsmasq</code>.
     </p></section></section><section class="sect3" id="libvirt-networks-virtual-virsh" data-id-title="Managing virtual networks with virsh"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.1.2.2 </span><span class="title-name">Managing virtual networks with <code class="command">virsh</code></span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-virsh">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can manage <code class="systemitem">libvirt</code>-provided virtual networks with the
     <code class="command">virsh</code> command line tool. To view all network related
     <code class="command">virsh</code> commands, run
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh help network
Networking (help keyword 'network'):
 net-autostart                  autostart a network
        net-create                     create a network from an XML file
        net-define                     define (but don't start) a network from an XML file
        net-destroy                    destroy (stop) a network
        net-dumpxml                    network information in XML
        net-edit                       edit XML configuration for a network
        net-event                      Network Events
        net-info                       network information
        net-list                       list networks
        net-name                       convert a network UUID to network name
        net-start                      start a (previously defined) inactive network
        net-undefine                   undefine an inactive network
        net-update                     update parts of an existing network's configuration
 net-uuid                       convert a network name to network UUID</pre></div><p>
     To view brief help information for a specific <code class="command">virsh</code>
     command, run <code class="command">virsh help
     <em class="replaceable">VIRSH_COMMAND</em></code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh help net-create
  NAME
    net-create - create a network from an XML file

  SYNOPSIS
    net-create &lt;file&gt;

  DESCRIPTION
    Create a network.

  OPTIONS
    [--file] &lt;string&gt;  file containing an XML network description</pre></div><section class="sect4" id="libvirt-networks-virtual-virsh-create" data-id-title="Creating a network"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.2.1 </span><span class="title-name">Creating a network</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-virsh-create">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To create a new <span class="emphasis"><em>running</em></span> virtual network, run
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh net-create <em class="replaceable">VNET_DEFINITION.xml</em></pre></div><p>
      The <em class="replaceable">VNET_DEFINITION.xml</em> XML file includes the
      definition of the virtual network that <code class="systemitem">libvirt</code> accepts.
     </p><p>
      To define a new virtual network without activating it, run
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh net-define <em class="replaceable">VNET_DEFINITION.xml</em></pre></div><p>
      The following examples illustrate definitions of different types of
      virtual networks.
     </p><div class="complex-example"><div class="example" id="ex-libvirt-net-nat" data-id-title="NAT-based network"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 9.1: </span><span class="title-name">NAT-based network </span></span><a title="Permalink" class="permalink" href="#ex-libvirt-net-nat">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
       The following configuration allows VM Guests outgoing connectivity if
       it is available on the VM Host Server. In the absence of VM Host Server networking, it
       allows guests to talk directly to each other.
      </p><div class="verbatim-wrap"><pre class="screen">&lt;network&gt;
&lt;name&gt;vnet_nated&lt;/name&gt;<span class="callout" id="vnet-xml-name">1</span>
&lt;bridge name="virbr1"/&gt;<span class="callout" id="vnet-xml-bridge">2</span>
 &lt;forward mode="nat"/&gt;<span class="callout" id="vnet-xml-forward">3</span>
 &lt;ip address="192.168.122.1" netmask="255.255.255.0"&gt;<span class="callout" id="vnet-xml-ip">4</span>
  &lt;dhcp&gt;
   &lt;range start="192.168.122.2" end="192.168.122.254"/&gt;<span class="callout" id="vnet-xml-dhcp">5</span>
   &lt;host mac="52:54:00:c7:92:da" name="host1.testing.com" \
    ip="192.168.1.101"/&gt;<span class="callout" id="vnet-xml-dhcp-host">6</span>
   &lt;host mac="52:54:00:c7:92:db" name="host2.testing.com" \
    ip="192.168.1.102"/&gt;
   &lt;host mac="52:54:00:c7:92:dc" name="host3.testing.com" \
    ip="192.168.1.103"/&gt;
  &lt;/dhcp&gt;
 &lt;/ip&gt;
&lt;/network&gt;</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#vnet-xml-name"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The name of the new virtual network.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#vnet-xml-bridge"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The name of the bridge device used to construct the virtual network.
         When defining a new network with a &lt;forward&gt; mode of <code class="literal">"nat"</code> or
         <code class="literal">"route"</code> (or an isolated network with no &lt;forward&gt; element),
         <code class="systemitem">libvirt</code> will automatically generate a unique name for the bridge
         device if none is given.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#vnet-xml-forward"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Inclusion of the &lt;forward&gt; element indicates that the virtual
         network will be connected to the physical LAN. The
         <code class="literal">mode</code> attribute specifies the forwarding method. The
         most common modes are <code class="literal">"nat"</code> (Network Address Translation, the default),
         <code class="literal">"route"</code> (direct forwarding to the physical network, no address
         translation), and <code class="literal">"bridge"</code> (network bridge configured outside of
         <code class="systemitem">libvirt</code>). If the &lt;forward&gt; element is not specified, the
         virtual network will be isolated from other networks. For a complete
         list of forwarding modes, see
         <a class="link" href="https://libvirt.org/formatnetwork.html#elementsConnect" target="_blank">https://libvirt.org/formatnetwork.html#elementsConnect</a>.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#vnet-xml-ip"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The IP address and netmask for the network bridge.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#vnet-xml-dhcp"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Enable DHCP server for the virtual network, offering IP addresses
         ranging from the specified <code class="literal">start</code> and
         <code class="literal">end</code> attributes.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#vnet-xml-dhcp-host"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The optional &lt;host&gt; elements specify hosts that will be given
         names and predefined IP addresses by the built-in DHCP server. Any
         IPv4 host element must specify the following: the MAC address of the
         host to be assigned a given name, the IP to be assigned to that host,
         and the name to be given to that host by the DHCP server. An IPv6 host
         element differs slightly from that for IPv4: there is no
         <code class="literal">mac</code> attribute since a MAC address has no defined
         meaning in IPv6. Instead, the <code class="literal">name</code> attribute is
         used to identify the host to be assigned the IPv6 address. For DHCPv6,
         the <code class="literal">name</code> is the plain name of the client host sent
         by the client to the server. Note that this method of assigning a
         specific IP address can also be used instead of the
         <code class="literal">mac</code> attribute for IPv4.
        </p></td></tr></table></div></div></div></div><div class="complex-example"><div class="example" id="id-1.12.4.3.4.5.7.6.9" data-id-title="Routed network"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 9.2: </span><span class="title-name">Routed network </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.3.4.5.7.6.9">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
       The following configuration routes traffic from the virtual network to
       the LAN without applying any NAT. The IP address range must be
       preconfigured in the routing tables of the router on the VM Host Server
       network.
      </p><div class="verbatim-wrap"><pre class="screen">&lt;network&gt;
 &lt;name&gt;vnet_routed&lt;/name&gt;
 &lt;bridge name="virbr1"/&gt;
 &lt;forward mode="route" dev="eth1"/&gt;<span class="callout" id="vnet-xml-route">1</span>
 &lt;ip address="192.168.122.1" netmask="255.255.255.0"&gt;
  &lt;dhcp&gt;
   &lt;range start="192.168.122.2" end="192.168.122.254"/&gt;
  &lt;/dhcp&gt;
 &lt;/ip&gt;
&lt;/network&gt;</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#vnet-xml-route"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The guest traffic may only go out via the
         <code class="systemitem">eth1</code> network device on the VM Host Server.
        </p></td></tr></table></div></div></div></div><div class="complex-example"><div class="example" id="id-1.12.4.3.4.5.7.6.10" data-id-title="Isolated network"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 9.3: </span><span class="title-name">Isolated network </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.3.4.5.7.6.10">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
       This configuration provides a completely isolated private network. The
       guests can talk to each other, and to VM Host Server, but cannot reach any
       other machines on the LAN, as the &lt;forward&gt; element is missing in
       the XML description.
      </p><div class="verbatim-wrap"><pre class="screen">&lt;network&gt;
 &lt;name&gt;vnet_isolated&lt;/name&gt;
 &lt;bridge name="virbr3"/&gt;
 &lt;ip address="192.168.152.1" netmask="255.255.255.0"&gt;
  &lt;dhcp&gt;
   &lt;range start="192.168.152.2" end="192.168.152.254"/&gt;
  &lt;/dhcp&gt;
 &lt;/ip&gt;
 &lt;/network&gt;</pre></div></div></div></div><div class="complex-example"><div class="example" id="id-1.12.4.3.4.5.7.6.11" data-id-title="Using an existing bridge on VM Host Server"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 9.4: </span><span class="title-name">Using an existing bridge on VM Host Server </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.3.4.5.7.6.11">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
       This configuration shows how to use an existing VM Host Server's network
       bridge <code class="literal">br0</code>. VM Guests are directly connected to the
       physical network. Their IP addresses will all be on the subnet of the
       physical network, and there will be no restrictions on incoming or
       outgoing connections.
      </p><div class="verbatim-wrap"><pre class="screen">&lt;network&gt;
        &lt;name&gt;host-bridge&lt;/name&gt;
        &lt;forward mode="bridge"/&gt;
        &lt;bridge name="br0"/&gt;
&lt;/network&gt;</pre></div></div></div></div></section><section class="sect4" id="libvirt-networks-virtual-virsh-list" data-id-title="Listing networks"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.2.2 </span><span class="title-name">Listing networks</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-virsh-list">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To list all virtual networks available to <code class="systemitem">libvirt</code>, run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh net-list --all

 Name                 State      Autostart     Persistent
----------------------------------------------------------
 crowbar              active     yes           yes
 vnet_nated           active     yes           yes
 vnet_routed          active     yes           yes
 vnet_isolated        inactive   yes           yes</pre></div><p>
      To list available domains, run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh list
 Id    Name                           State
----------------------------------------------------
 1     nated_sles12sp3                running
 ...</pre></div><p>
      To get a list of interfaces of a running domain, run <code class="option">domifaddr
      <em class="replaceable">DOMAIN</em></code>, or optionally specify the
      interface to limit the output to this interface. By default, it
      additionally outputs their IP and MAC addresses:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh domifaddr nated_sles12sp3 --interface vnet0 --source lease
 Name       MAC address          Protocol     Address
-------------------------------------------------------------------------------
 vnet0      52:54:00:9e:0d:2b    ipv6         fd00:dead:beef:55::140/64
 -          -                    ipv4         192.168.100.168/24</pre></div><p>
      To print brief information of all virtual interfaces associated with the
      specified domain, run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh domiflist nated_sles12sp3
Interface  Type       Source       Model       MAC
---------------------------------------------------------
vnet0      network    vnet_nated   virtio      52:54:00:9e:0d:2b</pre></div></section><section class="sect4" id="libvirt-networks-virtual-virsh-info" data-id-title="Getting details about a network"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.2.3 </span><span class="title-name">Getting details about a network</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-virsh-info">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To get detailed information about a network, run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh net-info vnet_routed
Name:           vnet_routed
UUID:           756b48ff-d0c6-4c0a-804c-86c4c832a498
Active:         yes
Persistent:     yes
Autostart:      yes
Bridge:         virbr5</pre></div></section><section class="sect4" id="libvirt-networks-virtual-virsh-start" data-id-title="Starting a network"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.2.4 </span><span class="title-name">Starting a network</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-virsh-start">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To start an inactive network that was already defined, find its name (or
      unique identifier, UUID) with:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh net-list --inactive
 Name                 State      Autostart     Persistent
----------------------------------------------------------
 vnet_isolated        inactive   yes           yes</pre></div><p>
      Then run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh net-start vnet_isolated
Network vnet_isolated started</pre></div></section><section class="sect4" id="libvirt-networks-virtual-virsh-stop" data-id-title="Stopping a network"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.2.5 </span><span class="title-name">Stopping a network</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-virsh-stop">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To stop an active network, find its name (or unique identifier, UUID)
      with:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh net-list --inactive
 Name                 State      Autostart     Persistent
----------------------------------------------------------
 vnet_isolated        active     yes           yes</pre></div><p>
      Then run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh net-destroy vnet_isolated
Network vnet_isolated destroyed</pre></div></section><section class="sect4" id="libvirt-networks-virtual-virsh-undefine" data-id-title="Removing a network"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.1.2.2.6 </span><span class="title-name">Removing a network</span></span> <a title="Permalink" class="permalink" href="#libvirt-networks-virtual-virsh-undefine">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To remove the definition of an inactive network from VM Host Server
      permanently, run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh net-undefine vnet_isolated
Network vnet_isolated has been undefined</pre></div></section></section></section></section><section class="sect1" id="libvirt-host-storage" data-id-title="Configuring a storage pool"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.2 </span><span class="title-name">Configuring a storage pool</span></span> <a title="Permalink" class="permalink" href="#libvirt-host-storage">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When managing a VM Guest on the VM Host Server itself, you can access the
   complete file system of the VM Host Server to attach or create virtual hard disks
   or to attach existing images to the VM Guest. However, this is not possible
   when managing VM Guests from a remote host. For this reason, <code class="systemitem">libvirt</code>
   supports so called <span class="quote">“<span class="quote">Storage Pools</span>”</span>, which can be accessed from
   remote machines.
  </p><div id="id-1.12.4.3.5.3" data-id-title="CD/DVD ISO images" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: CD/DVD ISO images</div><p>
    To be able to access CD/DVD ISO images on the VM Host Server from remote clients, they
    also need to be placed in a storage pool.
   </p></div><p>
   <code class="systemitem">libvirt</code> knows two different types of storage: volumes and pools.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.3.5.5.1"><span class="term">Storage volume</span></dt><dd><p>
      A storage volume is a storage device that can be assigned to a
      guest—a virtual disk or a CD/DVD/floppy image. Physically, it can
      be a block device—for example, a partition or a logical
      volume—or a file on the VM Host Server.
     </p></dd><dt id="id-1.12.4.3.5.5.2"><span class="term">Storage pool</span></dt><dd><p>
      A storage pool is a storage resource on the VM Host Server that can be used for
      storing volumes, similar to network storage for a desktop machine.
      Physically it can be one of the following types:
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.3.5.5.2.2.2.1"><span class="term">File system directory (<span class="guimenu">dir</span>)</span></dt><dd><p>
         A directory for hosting image files. The files can be either one of
         the supported disk formats (raw or qcow2), or ISO images.
        </p></dd><dt id="id-1.12.4.3.5.5.2.2.2.2"><span class="term">Physical disk device (<span class="guimenu">disk</span>)</span></dt><dd><p>
         Use a complete physical disk as storage. A partition is created for
         each volume that is added to the pool.
        </p></dd><dt id="id-1.12.4.3.5.5.2.2.2.3"><span class="term">Pre-formatted block device (<span class="guimenu">fs</span>)</span></dt><dd><p>
         Specify a partition to be used in the same way as a file system
         directory pool (a directory for hosting image files). The only
         difference to using a file system directory is that <code class="systemitem">libvirt</code> takes
         care of mounting the device.
        </p></dd><dt id="id-1.12.4.3.5.5.2.2.2.4"><span class="term">iSCSI target (iscsi)</span></dt><dd><p>
         Set up a pool on an iSCSI target. You need to have been logged in to
         the volume once before to use it with <code class="systemitem">libvirt</code>. Use the YaST
         <span class="guimenu">iSCSI Initiator</span> to detect and log in to a
         volume<span class="phrase">, see <span class="intraxref">Book “Storage Administration Guide”</span> for
         details</span>. Volume creation on iSCSI pools is not supported;
         instead, each existing Logical Unit Number (LUN) represents a volume.
         Each volume/LUN also needs a valid (empty) partition table or disk
         label before you can use it. If missing, use <code class="command">fdisk</code>
         to add it:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> fdisk -cu /dev/disk/by-path/ip-192.168.2.100:3260-iscsi-iqn.2010-10.com.example:[...]-lun-2
Device contains neither a valid DOS partition table, nor Sun, SGI
or OSF disklabel
Building a new DOS disklabel with disk identifier 0xc15cdc4e.
Changes will remain in memory only, until you decide to write them.
After that, of course, the previous content won't be recoverable.

Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.</pre></div></dd><dt id="id-1.12.4.3.5.5.2.2.2.5"><span class="term">LVM volume group (logical)</span></dt><dd><p>
         Use an LVM volume group as a pool. You can either use a predefined
         volume group, or create a group by specifying the devices to use.
         Storage volumes are created as partitions on the volume.
        </p><div id="id-1.12.4.3.5.5.2.2.2.5.2.2" data-id-title="Deleting the LVM-based pool" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Deleting the LVM-based pool</div><p>
          When the LVM-based pool is deleted in the Storage Manager, the volume
          group is deleted as well. This results in a non-recoverable loss of
          all data stored on the pool!
         </p></div></dd><dt id="id-1.12.4.3.5.5.2.2.2.6"><span class="term">Multipath devices (<span class="guimenu">mpath</span>)</span></dt><dd><p>
         At the moment, multipathing support is limited to assigning existing
         devices to the guests. Volume creation or configuring multipathing
         from within <code class="systemitem">libvirt</code> is not supported.
        </p></dd><dt id="id-1.12.4.3.5.5.2.2.2.7"><span class="term">Network exported directory (<span class="guimenu">netfs</span>)</span></dt><dd><p>
         Specify a network directory to be used in the same way as a file
         system directory pool (a directory for hosting image files). The only
         difference to using a file system directory is that <code class="systemitem">libvirt</code> takes
         care of mounting the directory. The supported protocol is NFS.
        </p></dd><dt id="id-1.12.4.3.5.5.2.2.2.8"><span class="term">SCSI host adapter (<span class="guimenu">scsi</span>)</span></dt><dd><p>
         Use an SCSI host adapter in almost the same way as an iSCSI target. We
         recommend to use a device name from
         <code class="filename">/dev/disk/by-*</code> rather than
         <code class="filename">/dev/sd<em class="replaceable">X</em></code>. The latter
         can change (for example, when adding or removing hard disks). Volume
         creation on iSCSI pools is not supported. Instead, each existing LUN
         (Logical Unit Number) represents a volume.
        </p></dd></dl></div></dd></dl></div><div id="id-1.12.4.3.5.6" data-id-title="Security considerations" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Security considerations</div><p>
    To avoid data loss or data corruption, do not attempt to use resources such
    as LVM volume groups, iSCSI targets, etc., that are also used to build
    storage pools on the VM Host Server. There is no need to connect to these
    resources from the VM Host Server or to mount them on the
    VM Host Server—<code class="systemitem">libvirt</code> takes care of this.
   </p><p>
    Do not mount partitions on the VM Host Server by label. Under certain
    circumstances it is possible that a partition is labeled from within a
    VM Guest with a name already existing on the VM Host Server.
   </p></div><section class="sect2" id="sec-libvirt-storage-virsh" data-id-title="Managing storage with virsh"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.2.1 </span><span class="title-name">Managing storage with <code class="command">virsh</code></span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Managing storage from the command line is also possible by using
    <code class="command">virsh</code>. However, creating storage pools is currently not
    supported by SUSE. Therefore, this section is restricted to documenting
    functions such as starting, stopping, and deleting pools, and volume management.
   </p><p>
    A list of all <code class="command">virsh</code> subcommands for managing pools and
    volumes is available by running <code class="command">virsh help pool</code> and
    <code class="command">virsh help volume</code>, respectively.
   </p><section class="sect3" id="sec-libvirt-storage-virsh-list-pools" data-id-title="Listing pools and volumes"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.2.1.1 </span><span class="title-name">Listing pools and volumes</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-virsh-list-pools">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     List all pools currently active by executing the following command. To
     also list inactive pools, add the option <code class="option">--all</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh pool-list --details</pre></div><p>
     Details about a specific pool can be obtained with the
     <code class="literal">pool-info</code> subcommand:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh pool-info <em class="replaceable">POOL</em></pre></div><p>
     By default, volumes can only be listed per pool. To list all volumes from a
     pool, enter the following command.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh vol-list --details <em class="replaceable">POOL</em></pre></div><p>
     At the moment <code class="command">virsh</code> offers no tools to show whether a
     volume is used by a guest or not. The following procedure describes a way
     to list volumes from all pools that are currently used by a VM Guest.
    </p><div class="procedure" id="pro-libvirt-storage-virsh-list-vols" data-id-title="Listing all storage volumes currently used on a VM Host Server"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 9.2: </span><span class="title-name">Listing all storage volumes currently used on a VM Host Server </span></span><a title="Permalink" class="permalink" href="#pro-libvirt-storage-virsh-list-vols">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Create an XSLT style sheet by saving the following content to a file,
       for example, ~/libvirt/guest_storage_list.xsl:
      </p><div class="verbatim-wrap"><pre class="screen">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:output method="text"/&gt;
  &lt;xsl:template match="text()"/&gt;
  &lt;xsl:strip-space elements="*"/&gt;
  &lt;xsl:template match="disk"&gt;
    &lt;xsl:text&gt;  &lt;/xsl:text&gt;
    &lt;xsl:value-of select="(source/@file|source/@dev|source/@dir)[1]"/&gt;
    &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre></div></li><li class="step"><p>
       Run the following commands in a shell. It is assumed that the guest's
       XML definitions are all stored in the default location
       (<code class="filename">/etc/libvirt/qemu</code>). <code class="command">xsltproc</code> is
       provided by the package
       <code class="systemitem">libxslt</code>.
      </p><div class="verbatim-wrap"><pre class="screen">SSHEET="$HOME/libvirt/guest_storage_list.xsl"
cd /etc/libvirt/qemu
for FILE in *.xml; do
  basename $FILE .xml
  xsltproc $SSHEET $FILE
done</pre></div></li></ol></div></div></section><section class="sect3" id="sec-libvirt-storage-virsh-start-pools" data-id-title="Starting, stopping, and deleting pools"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.2.1.2 </span><span class="title-name">Starting, stopping, and deleting pools</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-virsh-start-pools">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use the <code class="command">virsh</code> pool subcommands to start, stop, or delete
     a pool. Replace <em class="replaceable">POOL</em> with the pool's name or
     its UUID in the following examples:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.3.5.7.5.3.1"><span class="term">Stopping a pool</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh pool-destroy <em class="replaceable">POOL</em></pre></div><div id="id-1.12.4.3.5.7.5.3.1.2.2" data-id-title="A pools state does not affect attached volumes" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: A pool's state does not affect attached volumes</div><p>
         Volumes from a pool attached to VM Guests are always available,
         regardless of the pool's state (<span class="guimenu">Active</span> (stopped) or
         <span class="guimenu">Inactive</span> (started)). The state of the pool solely
         affects the ability to attach volumes to a VM Guest via remote
         management.
        </p></div></dd><dt id="id-1.12.4.3.5.7.5.3.2"><span class="term">Deleting a pool</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh pool-delete <em class="replaceable">POOL</em></pre></div><div id="id-1.12.4.3.5.7.5.3.2.2.2" data-id-title="Deleting storage pools" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Deleting storage pools</div><p>
         See <a class="xref" href="#deleting-storage-pools" title="Warning: Deleting storage pools">Warning: Deleting storage pools</a>
        </p></div></dd><dt id="id-1.12.4.3.5.7.5.3.3"><span class="term">Starting a pool</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh pool-start <em class="replaceable">POOL</em></pre></div></dd><dt id="id-1.12.4.3.5.7.5.3.4"><span class="term">Enable autostarting a pool</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh pool-autostart <em class="replaceable">POOL</em></pre></div><p>
        Only pools that are marked to autostart will automatically be started
        if the VM Host Server reboots.
       </p></dd><dt id="id-1.12.4.3.5.7.5.3.5"><span class="term">Disable autostarting a pool</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh pool-autostart <em class="replaceable">POOL</em> --disable</pre></div></dd></dl></div></section><section class="sect3" id="sec-libvirt-storage-virsh-add-volumes" data-id-title="Adding volumes to a storage pool"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.2.1.3 </span><span class="title-name">Adding volumes to a storage pool</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-virsh-add-volumes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">virsh</code> offers two ways to add volumes to storage pools:
     either from an XML definition with <code class="literal">vol-create</code> and
     <code class="literal">vol-create-from</code> or via command line arguments with
     <code class="literal">vol-create-as</code>. The first two methods are currently not
     supported by SUSE, therefore this section focuses on the subcommand
     <code class="literal">vol-create-as</code>.
    </p><p>
     To add a volume to an existing pool, enter the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh vol-create-as <em class="replaceable">POOL</em><span class="callout" id="co-vol-create-as-pool">1</span><em class="replaceable">NAME</em><span class="callout" id="co-vol-create-as-name">2</span> 12G --format<span class="callout" id="co-vol-create-as-capacity">3</span><em class="replaceable">raw|qcow2</em><span class="callout" id="co-vol-create-as-format">4</span> --allocation 4G<span class="callout" id="co-vol-create-as-alloc">5</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vol-create-as-pool"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Name of the pool to which the volume should be added
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vol-create-as-name"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Name of the volume
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vol-create-as-capacity"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Size of the image, in this example 12 gigabytes. Use the suffixes k, M,
       G, T for kilobyte, megabyte, gigabyte, and terabyte, respectively.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vol-create-as-format"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Format of the volume. SUSE currently supports <code class="literal">raw</code>
       and <code class="literal">qcow2</code>.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vol-create-as-alloc"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Optional parameter. By default, <code class="command">virsh</code> creates a sparse
       image file that grows on demand. Specify the amount of space that should
       be allocated with this parameter (4 gigabytes in this example). Use the
       suffixes k, M, G, T for kilobyte, megabyte, gigabyte, and terabyte,
       respectively.
      </p><p>
       When not specifying this parameter, a sparse image file with no
       allocation will be generated. To create a non-sparse volume, specify the
       whole image size with this parameter (would be <code class="literal">12G</code> in
       this example).
      </p></td></tr></table></div><section class="sect4" id="sec-libvirt-storage-virsh-add-volumes-clone" data-id-title="Cloning existing volumes"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.2.1.3.1 </span><span class="title-name">Cloning existing volumes</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-virsh-add-volumes-clone">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Another way to add volumes to a pool is to clone an existing volume. The
      new instance is always created in the same pool as the original.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh vol-clone <em class="replaceable">NAME_EXISTING_VOLUME</em><span class="callout" id="co-vol-clone-existing">1</span><em class="replaceable">NAME_NEW_VOLUME</em><span class="callout" id="co-vol-clone-new">2</span> --pool <em class="replaceable">POOL</em><span class="callout" id="co-vol-clone-pool">3</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vol-clone-existing"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Name of the existing volume that should be cloned
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vol-clone-new"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Name of the new volume
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vol-clone-pool"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Optional parameter. <code class="systemitem">libvirt</code> tries to locate the existing volume
        automatically. If that fails, specify this parameter.
       </p></td></tr></table></div></section></section><section class="sect3" id="sec-libvirt-storage-virsh-del-volumes" data-id-title="Deleting volumes from a storage pool"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.2.1.4 </span><span class="title-name">Deleting volumes from a storage pool</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-virsh-del-volumes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To permanently delete a volume from a pool, use the subcommand
     <code class="literal">vol-delete</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh vol-delete <em class="replaceable">NAME</em> --pool <em class="replaceable">POOL</em></pre></div><p>
     <code class="option">--pool</code> is optional. <code class="systemitem">libvirt</code> tries to locate the volume
     automatically. If that fails, specify this parameter.
    </p><div id="id-1.12.4.3.5.7.7.5" data-id-title="No checks upon volume deletion" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: No checks upon volume deletion</div><p>
      A volume will be deleted in any case, regardless of whether it is
      currently used in an active or inactive VM Guest. There is no way to
      recover a deleted volume.
     </p><p>
      Whether a volume is used by a VM Guest can only be detected by using by
      the method described in
      <a class="xref" href="#pro-libvirt-storage-virsh-list-vols" title="Listing all storage volumes currently used on a VM Host Server">Procedure 9.2, “Listing all storage volumes currently used on a VM Host Server”</a>.
     </p></div></section><section class="sect3" id="libvirt-storage-virsh-attach-volumes" data-id-title="Attaching volumes to a VM Guest"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.2.1.5 </span><span class="title-name">Attaching volumes to a VM Guest</span></span> <a title="Permalink" class="permalink" href="#libvirt-storage-virsh-attach-volumes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     After you create a volume as described in
     <a class="xref" href="#sec-libvirt-storage-virsh-add-volumes" title="9.2.1.3. Adding volumes to a storage pool">Section 9.2.1.3, “Adding volumes to a storage pool”</a>, you can
     attach it to a virtual machine and use it as a hard disk:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh attach-disk <em class="replaceable">DOMAIN</em> <em class="replaceable">SOURCE_IMAGE_FILE</em> <em class="replaceable">TARGET_DISK_DEVICE</em></pre></div><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh attach-disk sles12sp3 /virt/images/example_disk.qcow2 sda2</pre></div><p>
     To check if the new disk is attached, inspect the result of the
     <code class="command">virsh dumpxml</code> command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh dumpxml sles12sp3
[...]
&lt;disk type='file' device='disk'&gt;
 &lt;driver name='qemu' type='raw'/&gt;
 &lt;source file='/virt/images/example_disk.qcow2'/&gt;
 &lt;backingStore/&gt;
 &lt;target dev='sda2' bus='scsi'/&gt;
 &lt;alias name='scsi0-0-0'/&gt;
 &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
&lt;/disk&gt;
[...]</pre></div><section class="sect4" id="id-1.12.4.3.5.7.8.8" data-id-title="Hotplug or persistent change"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.2.1.5.1 </span><span class="title-name">Hotplug or persistent change</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.3.5.7.8.8">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      You can attach disks to both active and inactive domains. The attachment
      is controlled by the <code class="option">--live</code> and
      <code class="option">--config</code> options:
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.3.5.7.8.8.3.1"><span class="term"><code class="option">--live</code></span></dt><dd><p>
         Hotplugs the disk to an active domain. The attachment is not saved in
         the domain configuration. Using <code class="option">--live</code> on an inactive
         domain is an error.
        </p></dd><dt id="id-1.12.4.3.5.7.8.8.3.2"><span class="term"><code class="option">--config</code></span></dt><dd><p>
         Changes the domain configuration persistently. The attached disk is
         then available after the next domain start.
        </p></dd><dt id="id-1.12.4.3.5.7.8.8.3.3"><span class="term"><code class="option">--live</code><code class="option">--config</code></span></dt><dd><p>
         Hotplugs the disk and adds it to the persistent domain configuration.
        </p></dd></dl></div><div id="id-1.12.4.3.5.7.8.8.4" data-id-title="virsh attach-device" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: <code class="command">virsh attach-device</code></div><p>
       <code class="command">virsh attach-device</code> is the more generic form of
       <code class="command">virsh attach-disk</code>. You can use it to attach other
       types of devices to a domain.
      </p></div></section></section><section class="sect3" id="libvirt-storage-virsh-detach-volumes" data-id-title="Detaching volumes from a VM Guest"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.2.1.6 </span><span class="title-name">Detaching volumes from a VM Guest</span></span> <a title="Permalink" class="permalink" href="#libvirt-storage-virsh-detach-volumes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To detach a disk from a domain, use <code class="command">virsh detach-disk</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh detach-disk <em class="replaceable">DOMAIN</em> <em class="replaceable">TARGET_DISK_DEVICE</em></pre></div><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh detach-disk sles12sp3 sda2</pre></div><p>
     You can control the attachment with the <code class="option">--live</code> and
     <code class="option">--config</code> options as described in
     <a class="xref" href="#libvirt-storage-virsh-attach-volumes" title="9.2.1.5. Attaching volumes to a VM Guest">Section 9.2.1.5, “Attaching volumes to a VM Guest”</a>.
    </p></section></section><section class="sect2" id="sec-libvirt-storage-vmm" data-id-title="Managing storage with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.2.2 </span><span class="title-name">Managing storage with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-vmm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The Virtual Machine Manager provides a graphical interface—the Storage Manager—to
    manage storage volumes and pools. To access it, either right-click a
    connection and choose <span class="guimenu">Details</span>, or highlight a connection
    and choose <span class="guimenu">Edit</span> › <span class="guimenu">Connection
    Details</span>. Select the <span class="guimenu">Storage</span> tab.
   </p><div class="informalfigure"><div class="mediaobject"><a href="images/virt_virt-manager_storage.png"><img src="images/virt_virt-manager_storage.png" width="60%" alt="Virtual Machine Manager storage manager" title="Virtual Machine Manager storage manager"/></a></div></div><section class="sect3" id="sec-libvirt-storage-vmm-addpool" data-id-title="Adding a storage pool"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.2.2.1 </span><span class="title-name">Adding a storage pool</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-vmm-addpool">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To add a storage pool, proceed as follows:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Click <span class="guimenu">Add</span> in the bottom left corner. The dialog
       <span class="guimenu">Add a New Storage Pool</span> appears.
      </p></li><li class="step"><p>
       Provide a <span class="guimenu">Name</span> for the pool (consisting of
       only alphanumeric characters and <code class="literal">_</code>, <code class="literal">-</code> or <code class="literal">.</code>) and select a
       <span class="guimenu">Type</span>.
      </p><div class="informalfigure"><div class="mediaobject"><a href="images/virt_virt-manager_storage_add.png"><img src="images/virt_virt-manager_storage_add.png" width="60%" alt="Add new storage pool" title="Add new storage pool"/></a></div></div></li><li class="step"><p>
       Specify the required details below.
       They depend on the type of pool you are creating.
      </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.3.5.8.4.3.3.2.1"><span class="term"><span class="bold"><strong>Type</strong></span> <span class="guimenu">dir</span></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            <span class="guimenu">Target Path</span>: Specify an existing directory.
           </p></li></ul></div></dd><dt id="id-1.12.4.3.5.8.4.3.3.2.2"><span class="term"><span class="bold"><strong>Type</strong></span> <span class="guimenu">disk</span></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            <span class="guimenu">Format</span>: Format of the device's partition table.
            Using <span class="guimenu">auto</span> should usually work. If not, get the
            required format by running the command <code class="command">parted</code>
            <code class="option">-l</code> on the VM Host Server.
           </p></li><li class="listitem"><p>
            <span class="guimenu">Source Path</span>: Path to the device. It is
            recommended to use a device name from
            <code class="filename">/dev/disk/by-*</code> rather than the simple
            <code class="filename">/dev/sd<em class="replaceable">X</em></code>, since the
            latter can change (for example, when adding or removing hard
            disks). You need to specify the path that resembles the whole disk,
            not a partition on the disk (if existing).
           </p></li></ul></div></dd><dt id="id-1.12.4.3.5.8.4.3.3.2.3"><span class="term"><span class="bold"><strong>Type</strong></span> <span class="guimenu">fs</span></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            <span class="guimenu">Target Path</span>: Mount point on the VM Host Server file
            system.
           </p></li><li class="listitem"><p>
            <span class="guimenu">Format: </span> File system format of the device. The
            default value <code class="literal">auto</code> should work.
           </p></li><li class="listitem"><p>
            <span class="guimenu">Source Path</span>: Path to the device file. It is
            recommended to use a device name from
            <code class="filename">/dev/disk/by-*</code> rather than
            <code class="filename">/dev/sd<em class="replaceable">X</em></code>, because
            the latter can change (for example, when adding or removing hard
            disks).
           </p></li></ul></div></dd><dt id="id-1.12.4.3.5.8.4.3.3.2.4"><span class="term"><span class="bold"><strong>Type</strong></span> <span class="guimenu">iscsi</span></span></dt><dd><p>
          Get the necessary data by running the following command on the
          VM Host Server:
         </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> iscsiadm --mode node</pre></div><p>
          It will return a list of iSCSI volumes with the following format. The
          elements in bold text are required:
         </p><div class="verbatim-wrap"><pre class="screen"><span class="bold"><strong>IP_ADDRESS</strong></span>:PORT,TPGT <span class="bold"><strong>TARGET_NAME_(IQN)</strong></span></pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            <span class="guimenu">Target Path</span>: The directory containing the device
            file. Use <code class="literal">/dev/disk/by-path</code> (default) or
            <code class="literal">/dev/disk/by-id</code>.
           </p></li><li class="listitem"><p>
            <span class="guimenu">Host Name</span>: Host name or IP address of the iSCSI
            server.
           </p></li><li class="listitem"><p>
            <span class="guimenu">Source IQN</span>: The iSCSI target name (iSCSI Qualified Name).
           </p></li><li class="listitem"><p>
            <span class="guimenu">Initiator IQN</span>: The iSCSI initiator name.
           </p></li></ul></div></dd><dt id="id-1.12.4.3.5.8.4.3.3.2.5"><span class="term"><span class="bold"><strong>Type</strong></span> <span class="guimenu">logical</span></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            <span class="guimenu">Volgroup Name</span>: Specify the device path of an existing volume group.
           </p></li></ul></div></dd><dt id="id-1.12.4.3.5.8.4.3.3.2.6"><span class="term"><span class="bold"><strong>Type</strong></span> <span class="guimenu">mpath</span></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            <span class="guimenu">Target Path</span>: Support for multipathing is
            currently limited to making all multipath devices available.
            Therefore, specify an arbitrary string here that will then be
            ignored. The path is required, otherwise the XML parser will fail.
           </p></li></ul></div></dd><dt id="id-1.12.4.3.5.8.4.3.3.2.7"><span class="term"><span class="bold"><strong>Type</strong></span> <span class="guimenu">netfs</span></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            <span class="guimenu">Target Path</span>: Mount point on the VM Host Server file
            system.
           </p></li><li class="listitem"><p>
            <span class="guimenu">Host Name</span>: IP address or host name of the server
            exporting the network file system.
           </p></li><li class="listitem"><p>
            <span class="guimenu">Source Path</span>: Directory on the server that is
            being exported.
           </p></li></ul></div></dd><dt id="id-1.12.4.3.5.8.4.3.3.2.8"><span class="term"><span class="bold"><strong>Type</strong></span> <span class="guimenu">rbd</span></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            <span class="guimenu">Host Name</span>: Host name of the server with an exported RADOS block device.
           </p></li><li class="listitem"><p>
            <span class="guimenu">Source Name</span>: Name of the RADOS block device on the server.
           </p></li></ul></div></dd><dt id="id-1.12.4.3.5.8.4.3.3.2.9"><span class="term"><span class="bold"><strong>Type</strong></span> <span class="guimenu">scsi</span></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            <span class="guimenu">Target Path</span>: The directory containing the device
            file. Use <code class="literal">/dev/disk/by-path</code> (default) or
            <code class="literal">/dev/disk/by-id</code>.
           </p></li><li class="listitem"><p>
            <span class="guimenu">Source Path</span>: Name of the SCSI adapter.
           </p></li></ul></div></dd><dt id="id-1.12.4.3.5.8.4.3.3.2.10"><span class="term"><span class="bold"><strong>Type:</strong></span> <span class="guimenu">zfs</span></span></dt><dd><p>
           <span class="guimenu">Source Name</span>: Name of the ZFS pool.
          </p></dd></dl></div><div id="id-1.12.4.3.5.8.4.3.3.3" data-id-title="File browsing" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: File browsing</div><p>
        Using the file browser by clicking <span class="guimenu">Browse</span> is not
        possible when operating remotely.
       </p></div></li><li class="step"><p>
       Click <span class="guimenu">Finish</span> to add the storage pool.
      </p></li></ol></div></div></section><section class="sect3" id="sec-libvirt-storage-vmm-manage" data-id-title="Managing storage pools"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.2.2.2 </span><span class="title-name">Managing storage pools</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-vmm-manage">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Virtual Machine Manager's Storage Manager lets you create or delete volumes in a pool. You
     may also temporarily deactivate or permanently delete existing storage
     pools. Changing the basic configuration of a pool is currently not
     supported by SUSE.
    </p><section class="sect4" id="sec-libvirt-storage-vmm-manage-pool" data-id-title="Starting, stopping, and deleting pools"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.2.2.2.1 </span><span class="title-name">Starting, stopping, and deleting pools</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-vmm-manage-pool">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      The purpose of storage pools is to provide block devices located on the
      VM Host Server that can be added to a VM Guest when managing it from remote.
      To make a pool temporarily inaccessible from remote, click
      <span class="guimenu">Stop</span> in the bottom left corner of the Storage Manager.
      Stopped pools are marked with <span class="guimenu">State: Inactive</span> and are
      grayed out in the list pane. By default, a newly created pool will be
      automatically started <span class="guimenu">On Boot</span> of the VM Host Server.
     </p><p>
      To start an inactive pool and make it available from remote again, click
      <span class="guimenu">Start</span> in the bottom left corner of the Storage
      Manager.
     </p><div id="id-1.12.4.3.5.8.5.3.4" data-id-title="A pools state does not affect attached volumes" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: A pool's state does not affect attached volumes</div><p>
       Volumes from a pool attached to VM Guests are always available,
       regardless of the pool's state (<span class="guimenu">Active</span> (stopped) or
       <span class="guimenu">Inactive</span> (started)). The state of the pool solely
       affects the ability to attach volumes to a VM Guest via remote
       management.
      </p></div><p>
      To permanently make a pool inaccessible, click <span class="guimenu">Delete</span>
      in the bottom left corner of the Storage Manager. You can only delete
      inactive pools. Deleting a pool does not physically erase its contents on
      VM Host Server—it only deletes the pool configuration. However, you need
      to be extra careful when deleting pools, especially when deleting LVM
      volume group-based tools:
     </p><div id="deleting-storage-pools" data-id-title="Deleting storage pools" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Deleting storage pools</div><p>
       Deleting storage pools based on <span class="emphasis"><em>local</em></span> file system
       directories, local partitions or disks has no effect on the availability
       of volumes from these pools currently attached to VM Guests.
      </p><p>
       Volumes located in pools of type iSCSI, SCSI, LVM group or Network
       Exported Directory will become inaccessible from the VM Guest if the
       pool is deleted. Although the volumes themselves will not be deleted,
       the VM Host Server will no longer have access to the resources.
      </p><p>
       Volumes on iSCSI/SCSI targets or Network Exported Directory will become
       accessible again when creating an adequate new pool or when
       mounting/accessing these resources directly from the host system.
      </p><p>
       When deleting an LVM group-based storage pool, the LVM group definition
       will be erased and the LVM group will no longer exist on the host
       system. The configuration is not recoverable and all volumes from this
       pool are lost.
      </p></div></section><section class="sect4" id="sec-libvirt-storage-vmm-manage-volume-add" data-id-title="Adding volumes to a storage pool"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.2.2.2.2 </span><span class="title-name">Adding volumes to a storage pool</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-vmm-manage-volume-add">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Virtual Machine Manager lets you create volumes in all storage pools, except in pools of
      types Multipath, iSCSI, or SCSI. A volume in these pools is equivalent to
      a LUN and cannot be changed from within <code class="systemitem">libvirt</code>.
     </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        A new volume can either be created using the Storage Manager or while
        adding a new storage device to a VM Guest. In either case, select a
        storage pool from the left panel, then click <span class="guimenu">Create new
        volume</span>.
       </p></li><li class="step"><p>
        Specify a <span class="guimenu">Name</span> for the image and choose an image
        format.
       </p><p>
        SUSE currently only supports <code class="literal">raw</code> or
        <code class="literal">qcow2</code> images. The latter option is not available on
        LVM group-based pools.
       </p><p>
        Next to <span class="guimenu">Max Capacity</span>, specify the maximum size that
        the disk image is allowed to reach. Unless you are working with a
        <code class="literal">qcow2</code> image, you can also set an amount for 
        <span class="guimenu">Allocation</span> that should be allocated initially. If
        the two values differ, a sparse image file will be created, which grows
        on demand.
       </p><p>
        For <code class="literal">qcow2</code> images, you can use a <span class="guimenu">Backing
        Store</span> (also called <span class="quote">“<span class="quote">backing file</span>”</span>), which
        constitutes a base image. The newly created <code class="literal">qcow2</code>
        image will then only record the changes that are made to the base
        image.
       </p></li><li class="step"><p>
        Start the volume creation by clicking <span class="guimenu">Finish</span>.
       </p></li></ol></div></div></section><section class="sect4" id="sec-libvirt-storage-vmm-manage-volume-delete" data-id-title="Deleting volumes from a storage pool"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">9.2.2.2.3 </span><span class="title-name">Deleting volumes from a storage pool</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-vmm-manage-volume-delete">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_host.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Deleting a volume can only be done from the Storage Manager, by selecting
      a volume and clicking <span class="guimenu">Delete Volume</span>. Confirm with
      <span class="guimenu">Yes</span>.
     </p><div id="id-1.12.4.3.5.8.5.5.3" data-id-title="Volumes can be deleted even while in use" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Volumes can be deleted even while in use</div><p>
       Volumes can be deleted even if they are currently used in an active or
       inactive VM Guest. There is no way to recover a deleted volume.
      </p><p>
       Whether a volume is used by a VM Guest is indicated in the
       <span class="guimenu">Used By</span> column in the Storage Manager.
      </p></div></section></section></section></section></section><section class="chapter" id="cha-kvm-inst" data-id-title="Guest installation"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">10 </span><span class="title-name">Guest installation</span></span> <a title="Permalink" class="permalink" href="#cha-kvm-inst">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  A VM Guest consists of an image containing an operating system and data
  files and a configuration file describing the VM Guest's virtual hardware
  resources. VM Guests are hosted on and controlled by the VM Host Server. This
  section provides generalized instructions for installing a VM Guest. <span class="phrase">For a list of supported VM Guests refer to <a class="xref" href="#cha-virt-support" title="Chapter 7. Virtualization limits and support">Chapter 7, <em>Virtualization limits and support</em></a>.</span>
 </p><p>
  Virtual machines have few if any requirements above those required to run the
  operating system. If the operating system has not been optimized for the
  virtual machine host environment, it can only run on
  <a class="xref" href="#gloss-vt-hwassisted" title="hardware-assisted">hardware-assisted</a> virtualization computer hardware, in
  full virtualization mode, and requires specific device drivers to be loaded.
  The hardware that is presented to the VM Guest depends on the configuration
  of the host.
 </p><p>
  You should be aware of any licensing issues related to running a single
  licensed copy of an operating system on multiple virtual machines. Consult
  the operating system license agreement for more information.
 </p><section class="sect1" id="sec-libvirt-inst-vmm" data-id-title="GUI-based guest installation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.1 </span><span class="title-name">GUI-based guest installation</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-inst-vmm">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <span class="guimenu">New VM</span> wizard helps you through the steps required to create a virtual machine and install its operating system.
   To start it, open the Virtual Machine Manager and select <span class="guimenu">File</span> › <span class="guimenu">New Virtual Machine</span>.
   Alternatively, start YaST and select <span class="guimenu">Virtualization</span> › <span class="guimenu">Create Virtual Machines</span>.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Start the <span class="guimenu">New VM</span> wizard either from YaST or Virtual Machine Manager.
    </p></li><li class="step"><p>
     Choose an installation source—either a locally available media or a
     network installation source. If you want to set up your VM Guest from an
     existing image, choose <span class="guimenu">import existing disk image</span>.
    </p><p>
     On a VM Host Server running the Xen hypervisor, you can choose whether to
     install a paravirtualized or a fully virtualized guest. The respective
     option is available under <span class="guimenu">Architecture Options</span>.
     Depending on this choice, not all installation options may be available.
    </p></li><li class="step"><p>
     Depending on your choice in the previous step, you need to provide the
     following data:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.4.6.3.3.2.1"><span class="term"><span class="guimenu">Local install media (ISO image or CDROM)</span>
      </span></dt><dd><p>
        Specify the path on the VM Host Server to an ISO image containing the
        installation data. If it is available as a volume in a libvirt storage
        pool, you can also select it using <span class="guimenu">Browse</span>. For more
        information, see <a class="xref" href="#cha-libvirt-storage" title="Chapter 13. Advanced storage topics">Chapter 13, <em>Advanced storage topics</em></a>.
       </p><p>
        Alternatively, choose a physical CD-ROM or DVD inserted in the optical
        drive of the VM Host Server.
       </p></dd><dt id="id-1.12.4.4.6.3.3.2.2"><span class="term"><span class="guimenu">Network install (HTTP, HTTPS, or FTP)</span>
      </span></dt><dd><p>
        Provide the <span class="guimenu">URL</span> pointing to the installation source.
        Valid URL prefixes are, for example, <code class="literal">ftp://</code>, <code class="literal">http://</code>, and <code class="literal">https://</code>.
       </p><p>
        Under <span class="guimenu">URL Options</span>, provide a path to an
        auto-installation file (AutoYaST or Kickstart, for example) and kernel
        parameters. Having provided a URL, the operating system should be
        automatically detected correctly. If this is not the case, deselect
        <span class="guimenu">Automatically Detect Operating System Based on
        Install-Media</span> and manually select the <span class="guimenu">OS
        Type</span> and <span class="guimenu">Version</span>.
       </p></dd><dt id="id-1.12.4.4.6.3.3.2.3"><span class="term"><span class="guimenu">Import existing disk image</span>
      </span></dt><dd><p>
        To set up the VM Guest from an existing image, you need to specify the
        path on the VM Host Server to the image. If it is available as a volume in a
        libvirt storage pool, you can also select it using
        <span class="guimenu">Browse</span>. For more information, see
        <a class="xref" href="#cha-libvirt-storage" title="Chapter 13. Advanced storage topics">Chapter 13, <em>Advanced storage topics</em></a>.
       </p></dd><dt id="id-1.12.4.4.6.3.3.2.4"><span class="term"><span class="guimenu">Manual install</span></span></dt><dd><p>
        This installation method is suitable if you want to create a virtual
        machine, manually configure its components, and install its OS later.
        To adjust the VM to a specific product version, start typing its
        name—for example, <code class="literal">sles</code>—and select the
        desired version when a match appears.
       </p></dd></dl></div></li><li class="step"><p>
     Choose the memory size and number of CPUs for the new virtual machine.
    </p></li><li class="step"><p>
     This step is omitted when <span class="guimenu">Import an Existing Image</span> is
     chosen in the first step.
    </p><p>
     Set up a virtual hard disk for the VM Guest. Either create a new disk
     image or choose an existing one from a storage pool (for more information,
     see <a class="xref" href="#cha-libvirt-storage" title="Chapter 13. Advanced storage topics">Chapter 13, <em>Advanced storage topics</em></a>). If you choose to create a
     disk, a <code class="literal">qcow2</code> image will be created. By default, it is
     stored under <code class="filename">/var/lib/libvirt/images</code>.
    </p><p>
     Setting up a disk is optional. If you are running a live system directly
     from CD or DVD, for example, you can omit this step by deactivating
     <span class="guimenu">Enable Storage for this Virtual Machine</span>.
    </p></li><li class="step"><p>
     On the last screen of the wizard, specify the name for the virtual
     machine. To be offered the possibility to review and make changes to the
     virtualized hardware selection, activate <span class="guimenu">Customize configuration
     before install</span>. Specify the network device under
     <span class="guimenu">Network Selection</span>. When using <span class="guimenu">Bridge
     device</span>, the first bridge found on the host is pre-filled. To use
     a different bridge, manually update the text box with its name.
    </p><p>
     Click <span class="guimenu">Finish</span>.
    </p></li><li class="step"><p><span class="step-optional">(Optional)</span> 
     If you kept the defaults in the previous step, the installation will now
     start. If you selected <span class="guimenu">Customize configuration before
     install</span>, a VM Guest configuration dialog opens. For more
     information about configuring VM Guests, see
     <a class="xref" href="#cha-libvirt-config-gui" title="Chapter 14. Configuring virtual machines with Virtual Machine Manager">Chapter 14, <em>Configuring virtual machines with Virtual Machine Manager</em></a>.
    </p><p>
     When you are done configuring, click <span class="guimenu">Begin
     Installation</span>.
    </p></li></ol></div></div><div id="tip-libvirt-inst-vmm-sticky" data-id-title="Passing key combinations to virtual machines" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Passing key combinations to virtual machines</div><p>
    The installation starts in a Virtual Machine Manager console window. Some key combinations,
    such as <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F1</span>, are recognized by the VM Host Server but are not
    passed to the virtual machine. To bypass the VM Host Server, Virtual Machine Manager provides the
    <span class="quote">“<span class="quote">sticky key</span>”</span> functionality. Pressing
    <span class="keycap">Ctrl</span>, <span class="keycap">Alt</span>, or
    <span class="keycap">Shift</span> three times makes the key sticky, then you can
    press the remaining keys to pass the combination to the virtual machine.
   </p><p>
    For example, to pass <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F2</span> to a Linux virtual
    machine, press <span class="keycap">Ctrl</span> three times, then press
    <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F2</span>. You
    can also press <span class="keycap">Alt</span> three times, then press <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">F2</span>.
   </p><p>
    The sticky key functionality is available in the Virtual Machine Manager during and after
    installing a VM Guest.
   </p></div><section class="sect2" id="tip-libvirt-inst-vmm-pxe" data-id-title="Configuring the virtual machine for PXE boot"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.1.1 </span><span class="title-name">Configuring the virtual machine for PXE boot</span></span> <a title="Permalink" class="permalink" href="#tip-libvirt-inst-vmm-pxe">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    PXE boot enables your virtual machine to boot the installation media from
    the network, instead of from a physical medium or an installation disk image.
    <span class="phrase">Refer to <span class="intraxref">Book “Deployment Guide”, Chapter 17 “Preparing network boot environment”</span> for
    more details about setting up a PXE boot environment.</span>
   </p><p>
    To let your VM boot from a PXE server, follow these steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start the installation wizard as described in
      <a class="xref" href="#sec-libvirt-inst-vmm" title="10.1. GUI-based guest installation">Section 10.1, “GUI-based guest installation”</a>.
     </p></li><li class="step"><p>
      Select the <span class="guimenu">Manual Install</span> method.
     </p></li><li class="step"><p>
      Proceed to the last step of the wizard and activate <span class="guimenu">Customize
      configuration before install</span>. Confirm with
      <span class="guimenu">Finish</span>.
     </p></li><li class="step"><p>
      On the <span class="guimenu">Customize</span> screen, select <span class="guimenu">Boot
      Options</span>.
     </p></li><li class="step"><p>
      Inspect <span class="guimenu">Boot device order</span> and activate the box next to
      <span class="guimenu">Enable boot menu</span>.
     </p></li><li class="step"><p>
      Under <span class="guimenu">Enable boot menu</span>, activate <span class="guimenu">Network
      PXE</span> and confirm with <span class="guimenu">Apply</span>.
     </p></li><li class="step"><p>
      Start the installation by clicking <span class="guimenu">Begin Installation</span>.
      If a PXE server is properly configured, the PXE menu screen will appear.
     </p></li></ol></div></div></section></section><section class="sect1" id="sec-libvirt-inst-virt-install" data-id-title="Installing from the command line with virt-install"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.2 </span><span class="title-name">Installing from the command line with <code class="command">virt-install</code></span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-inst-virt-install">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">virt-install</code> is a command line tool that helps you create
   new virtual machines using the <code class="systemitem">libvirt</code> library. It is useful if you cannot
   use the graphical user interface, or need to automatize the process of
   creating virtual machines.
  </p><p>
   <code class="command">virt-install</code> is a complex script with a lot of command
   line switches. The following are required. For more information, see the man
   page of <code class="command">virt-install</code> (1).
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.4.7.4.1"><span class="term">General options</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        <code class="option">--name <em class="replaceable">VM_GUEST_NAME</em></code>:
        Specify the name of the new virtual machine. The name must be unique
        across all guests known to the hypervisor on the same connection. It is
        used to create and name the guest’s configuration file and you can
        access the guest with this name from <code class="command">virsh</code>.
        Alphanumeric and <code class="literal">_-.:+</code> characters are allowed.
       </p></li><li class="listitem"><p>
        <code class="option">--memory <em class="replaceable">REQUIRED_MEMORY</em></code>:
        Specify the amount of memory to allocate for the new virtual machine in
        megabytes.
       </p></li><li class="listitem"><p>
        <code class="option">--vcpus <em class="replaceable">NUMBER_OF_CPUS</em></code>:
        Specify the number of virtual CPUs. For best performance, the number of
        virtual processors should be less than or equal to the number of
        physical processors.
       </p></li></ul></div></dd><dt id="id-1.12.4.4.7.4.2"><span class="term">Virtualization type</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        <code class="option">--paravirt</code>: Set up a paravirtualized guest. This is
        the default if the VM Host Server supports paravirtualization and full
        virtualization.
       </p></li><li class="listitem"><p>
        <code class="option">--hvm</code>: Set up a fully virtualized guest.
       </p></li><li class="listitem"><p>
        <code class="option">--virt-type <em class="replaceable">HYPERVISOR</em></code>:
        Specify the hypervisor. Supported values are <code class="literal">kvm</code> or
        <code class="literal">xen</code>.
       </p></li></ul></div></dd><dt id="id-1.12.4.4.7.4.3"><span class="term">Guest storage</span></dt><dd><p>
      Specify one of <code class="option">--disk</code>, <code class="option">--filesystem</code> or
      <code class="option">--nodisks</code> the type of the storage for the new virtual
      machine. For example, <code class="option">--disk size=10</code> creates 10 GB disk
      in the default image location for the hypervisor and uses it for the
      VM Guest. <code class="option">--filesystem
      <em class="replaceable">/export/path/on/vmhost</em></code> specifies the
      directory on the VM Host Server to be exported to the guest. And
      <code class="option">--nodisks</code> sets up a VM Guest without a local storage
      (good for Live CDs).
     </p></dd><dt id="id-1.12.4.4.7.4.4"><span class="term">Installation method</span></dt><dd><p>
      Specify the installation method using one of <code class="option">--location</code>,
      <code class="option">--cdrom</code>, <code class="option">--pxe</code>,
      <code class="option">--import</code>, or <code class="option">--boot </code>.
     </p></dd><dt id="id-1.12.4.4.7.4.5"><span class="term">Accessing the installation</span></dt><dd><p>
      Use the <code class="option">--graphics <em class="replaceable">VALUE</em></code>
      option to specify how to access the installation. <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> supports
      the values <code class="literal">vnc</code> or <code class="literal">none</code>.
     </p><p>
      If using VNC, <code class="command">virt-install</code> tries to launch
      <code class="command">virt-viewer</code>. If it is not installed or cannot be run,
      connect to the VM Guest manually with you preferred viewer. To
      explicitly prevent <code class="command">virt-install</code> from launching the
      viewer use <code class="option">--noautoconsole</code>. To define a password for
      accessing the VNC session, use the following syntax: <code class="option">--graphics
      vnc,password=<em class="replaceable">PASSWORD</em></code>.
     </p><p>
      In case you are using <code class="option">--graphics none</code>, you can access
      the VM Guest through operating system supported services, such as SSH or
      VNC. Refer to the operating system installation manual on how to set up
      these services in the installation system.
     </p></dd><dt id="id-1.12.4.4.7.4.6"><span class="term">Passing kernel and initrd files</span></dt><dd><p>
      It is possible to directly specify the Kernel and Initrd of the
      installer, for example from a network source.
      <span class="phrase">To set up a network source, see
      <span class="intraxref">Book “Deployment Guide”, Chapter 16 “Setting up a network installation source”, Section 16.4 “Setting up an HTTP repository manually”</span>.</span>
     </p><p>
      To pass additional boot parameters, use the
      <code class="option">--extra-args</code> option. This can be used to specify
      a network configuration. For details, see <span class="intraxref">Book “Deployment Guide”, Chapter 7 “Boot parameters”</span>.
     </p><div class="example" id="id-1.12.4.4.7.4.6.2.3" data-id-title="Loading kernel and initrd from HTTP server"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 10.1: </span><span class="title-name">Loading kernel and initrd from HTTP server </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.4.7.4.6.2.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_guest_installation.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">virt-install</code> --location "http://example.tld/REPOSITORY/DVD1/" \
--extra-args="textmode=1" --name "SLES15" --memory 2048 --virt-type kvm\
--connect qemu:///system --disk size=10 --graphics vnc \
--network network=vnet_nated</pre></div></div></div></dd><dt id="id-1.12.4.4.7.4.7"><span class="term">Enabling the console</span></dt><dd><p>
      By default, the console is not enabled for new virtual machines installed
      using <code class="command">virt-install</code>. To enable it, use
      <code class="option">--extra-args="console=ttyS0 textmode=1"</code> as in the
      following example:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-install --virt-type kvm --name sles12 --memory 1024 \
 --disk /var/lib/libvirt/images/disk1.qcow2 --os-variant sles12
 --extra-args="console=ttyS0 textmode=1" --graphics none</pre></div><p>
      After the installation finishes, the
      <code class="filename">/etc/default/grub</code> file in the VM image will be
      updated with the <code class="option">console=ttyS0</code> option on the
      <code class="literal">GRUB_CMDLINE_LINUX_DEFAULT</code> line.
     </p></dd><dt id="vle-libvirt-inst-virt-install-ovmf"><span class="term">Using UEFI Secure Boot</span></dt><dd><p>
      Install OVMF as described in <a class="xref" href="#sec-vt-installation-ovmf" title="6.4. Installing UEFI support">Section 6.4, “Installing UEFI support”</a>. Then add the
      <code class="option">--boot uefi</code> option to the
      <code class="command">virt-install</code> command.
     </p><p>
      UEFI Secure Boot will be used automatically when setting up a new VM
      with OVMF. To use specific firmware, use <code class="option">--boot
      loader=<em class="replaceable">PATH_TO_FIRMWARE</em></code>.
      </p><p>
       For example, for the AArch64 architecture:
      </p><div class="verbatim-wrap"><pre class="screen">--boot loader=/usr/share/qemu/qemu-uefi-aarch32.bin</pre></div><p>
       And for the AMD64/Intel 64; architecture:
      </p><div class="verbatim-wrap"><pre class="screen">--boot loader=/usr/share/qemu/ovmf-x86_64-opensuse.bin</pre></div></dd></dl></div><div class="complex-example"><div class="example" id="ex-libvirt-inst-virt-install-example" data-id-title="Example of a virt-install command line"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 10.2: </span><span class="title-name">Example of a <code class="command">virt-install</code> command line </span></span><a title="Permalink" class="permalink" href="#ex-libvirt-inst-virt-install-example">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_guest_installation.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
    The following command line example creates a new SUSE Linux Enterprise 15 SP2 virtual machine
    with a virtio accelerated disk and network card. It creates a new 10 GB
    qcow2 disk image as a storage, the source installation media being the host
    CD-ROM drive. It will use VNC graphics, and it will auto-launch the
    graphical client.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.4.7.5.3.1"><span class="term">KVM</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-install --connect qemu:///system --virt-type kvm \
--name sle15sp2 --memory 1024 --disk size=10 --cdrom /dev/cdrom --graphics vnc \
--os-variant sle15sp2</pre></div></dd><dt id="id-1.12.4.4.7.5.3.2"><span class="term">Xen</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-install --connect xen:// --virt-type xen --hvm \
--name sle15sp2 --memory 1024 --disk size=10 --cdrom /dev/cdrom --graphics vnc \
--os-variant sle15sp2</pre></div></dd></dl></div></div></div></div></section><section class="sect1" id="sec-libvirt-inst-advanced" data-id-title="Advanced guest installation scenarios"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.3 </span><span class="title-name">Advanced guest installation scenarios</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-inst-advanced">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section provides instructions for operations exceeding the scope of a
   normal installation, such as memory ballooning and installing add-on
   products.
  </p><section class="sect2" id="libvirt-advanced-balloon" data-id-title="Memory ballooning with Windows guests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.3.1 </span><span class="title-name">Memory ballooning with Windows guests</span></span> <a title="Permalink" class="permalink" href="#libvirt-advanced-balloon">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Memory ballooning is a method to change the amount of memory used by
    VM Guest at runtime. Both the KVM and Xen hypervisors provide this
    method, but it needs to be supported by the guest as well.
   </p><p>
    While openSUSE and SLE-based guests support memory ballooning, Windows
    guests need the
    <a class="link" href="https://www.suse.com/products/vmdriverpack/" target="_blank">Virtual
    Machine Driver Pack (VMDP)</a> to provide ballooning. To set the maximum
    memory greater than the initial memory configured for Windows guests,
    follow these steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Install the Windows guest with the maximum memory equal or less than the
      initial value.
     </p></li><li class="step"><p>
      Install the Virtual Machine Driver Pack in the Windows guest to provide
      required drivers.
     </p></li><li class="step"><p>
      Shut down the Windows guest.
     </p></li><li class="step"><p>
      Reset the maximum memory of the Windows guest to the required value.
     </p></li><li class="step"><p>
      Start the Windows guest again.
     </p></li></ol></div></div></section><section class="sect2" id="cha-kvm-inst-virtman-advanced-addons" data-id-title="Including add-on products in the installation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.3.2 </span><span class="title-name">Including add-on products in the installation</span></span> <a title="Permalink" class="permalink" href="#cha-kvm-inst-virtman-advanced-addons">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Some operating systems such as <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> offer to include add-on
    products in the installation process. If the add-on product installation
    source is provided via SUSE Customer Center, no special VM Guest configuration is needed.
    If it is provided via CD/DVD or ISO image, it is necessary to provide the
    VM Guest installation system with both the standard installation medium
    image and the image of the add-on product.
   </p><p>
    If you are using the GUI-based installation, select <span class="guimenu">Customize
     Configuration Before Install</span> in the last step of the wizard and
    add the add-on product ISO image via <span class="guimenu">Add
      Hardware</span> › <span class="guimenu">Storage</span>. Specify the
    path to the image and set the <span class="guimenu">Device Type</span> to
    <span class="guimenu">CD-ROM</span>.
   </p><p>
    If you are installing from the command line, you need to set up the virtual
    CD/DVD drives with the <code class="option">--disk</code> parameter rather than with
    <code class="option">--cdrom</code>. The device that is specified first is used for
    booting. The following example will install SUSE Linux Enterprise Server 15 together
    with SUSE Enterprise Storage extension:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-install \
 --name sles15+storage \
 --memory 2048 --disk size=10 \
 --disk /path/to/SLE-15-SP3-Full-<em class="replaceable">ARCH</em>-GM-media1.iso-x86_64-GM-DVD1.iso,device=cdrom \
 --disk /path/to/SUSE-Enterprise-Storage-<em class="replaceable">VERSION</em>-DVD-<em class="replaceable">ARCH</em>-Media1.iso,device=cdrom \
 --graphics vnc --os-variant sle15</pre></div></section></section></section><section class="chapter" id="cha-libvirt-managing" data-id-title="Basic VM Guest management"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">11 </span><span class="title-name">Basic VM Guest management</span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-managing">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Most management tasks, such as starting or stopping a VM Guest, can either
  be done using the graphical application Virtual Machine Manager or on the command line using
  <code class="command">virsh</code>. Connecting to the graphical console via VNC is only
  possible from a graphical user interface.
 </p><div id="id-1.12.4.5.4" data-id-title="Managing VM Guests on a remote VM Host Server" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Managing VM Guests on a remote VM Host Server</div><p>
   If started on a VM Host Server, the <code class="systemitem">libvirt</code> tools Virtual Machine Manager,
   <code class="command">virsh</code>, and <code class="command">virt-viewer</code> can be used to
   manage VM Guests on the host. However, it is also possible to manage
   VM Guests on a remote VM Host Server. This requires configuring remote access for
   <code class="systemitem">libvirt</code> on the host. For instructions, see
   <a class="xref" href="#cha-libvirt-connect" title="Chapter 12. Connecting and authorizing">Chapter 12, <em>Connecting and authorizing</em></a>.
  </p><p>
   To connect to such a remote host with Virtual Machine Manager, you need to set up a connection
   as explained in <a class="xref" href="#sec-libvirt-connect-connecting-vmm" title="12.2.2. Managing connections with Virtual Machine Manager">Section 12.2.2, “Managing connections with Virtual Machine Manager”</a>. If
   connecting to a remote host using <code class="command">virsh</code> or
   <code class="command">virt-viewer</code>, you need to specify a connection URI with
   the parameter <code class="option">-c</code> (for example, <code class="command">virsh -c
   qemu+tls://saturn.example.com/system</code> or <code class="command">virsh -c
   xen+ssh://</code>). The form of connection URI depends on the connection
   type and the hypervisor—see
   <a class="xref" href="#sec-libvirt-connect-connecting" title="12.2. Connecting to a VM Host Server">Section 12.2, “Connecting to a VM Host Server”</a> for details.
  </p><p>
   Examples in this chapter are all listed without a connection URI.
  </p></div><section class="sect1" id="sec-libvirt-managing-list" data-id-title="Listing VM Guests"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.1 </span><span class="title-name">Listing VM Guests</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-list">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The VM Guest listing shows all VM Guests managed by <code class="systemitem">libvirt</code> on a
   VM Host Server.
  </p><section class="sect2" id="sec-libvirt-managing-list-vmm" data-id-title="Listing VM Guests with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.1.1 </span><span class="title-name">Listing VM Guests with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-list-vmm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The main window of the Virtual Machine Manager lists all VM Guests for each VM Host Server it is
    connected to. Each VM Guest entry contains the machine's name, its status
    (<span class="guimenu">Running</span>, <span class="guimenu">Paused</span>, or
    <span class="guimenu">Shutoff</span>) displayed as an icon and literally, and a CPU
    usage bar.
   </p></section><section class="sect2" id="sec-libvirt-managing-list-virsh" data-id-title="Listing VM Guests with virsh"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.1.2 </span><span class="title-name">Listing VM Guests with <code class="command">virsh</code></span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-list-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use the command <code class="command">virsh</code> <code class="option">list</code> to get a
    list of VM Guests:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.5.5.4.3.1"><span class="term">List all running guests
     </span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh list</pre></div></dd><dt id="id-1.12.4.5.5.4.3.2"><span class="term">List all running and inactive guests</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh list --all</pre></div></dd></dl></div><p>
    For more information and further options, see <code class="command">virsh help
    list</code> or <code class="command">man 1 virsh</code>.
   </p></section></section><section class="sect1" id="sec-libvirt-managing-console" data-id-title="Accessing the VM Guest via console"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.2 </span><span class="title-name">Accessing the VM Guest via console</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-console">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   VM Guests can be accessed via a VNC connection (graphical console) or, if
   supported by the guest operating system, via a serial console.
  </p><section class="sect2" id="sec-libvirt-managing-console-vnc" data-id-title="Opening a graphical console"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.2.1 </span><span class="title-name">Opening a graphical console</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-console-vnc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Opening a graphical console to a VM Guest lets you interact with the
    machine like a physical host via a VNC connection. If accessing the VNC
    server requires authentication, you are prompted to enter a user name (if
    applicable) and a password.
   </p><p>
    When you click into the VNC console, the cursor is <span class="quote">“<span class="quote">grabbed</span>”</span>
    and cannot be used outside the console anymore. To release it, press
    <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">Ctrl</span>.
   </p><div id="id-1.12.4.5.6.3.4" data-id-title="Seamless (absolute) cursor movement" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Seamless (absolute) cursor movement</div><p>
     To prevent the console from grabbing the cursor and to enable seamless
     cursor movement, add a tablet input device to the VM Guest. See
     <a class="xref" href="#sec-libvirt-config-input" title="14.5. Input devices">Section 14.5, “Input devices”</a> for more information.
    </p></div><p>
    Certain key combinations such as <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">Del</span> are
    interpreted by the host system and are not passed to the VM Guest. To pass
    such key combinations to a VM Guest, open the <span class="guimenu">Send Key</span>
    menu from the VNC window and choose the desired key combination entry. The
    <span class="guimenu">Send Key</span> menu is only available when using Virtual Machine Manager and
    <code class="command">virt-viewer</code>. With Virtual Machine Manager, you can alternatively use the
    <span class="quote">“<span class="quote">sticky key</span>”</span> feature as explained in
    <a class="xref" href="#tip-libvirt-inst-vmm-sticky" title="Tip: Passing key combinations to virtual machines">Tip: Passing key combinations to virtual machines</a>.
   </p><div id="id-1.12.4.5.6.3.6" data-id-title="Supported VNC viewers" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Supported VNC viewers</div><p>
     Principally all VNC viewers can connect to the console of a VM Guest.
     However, if you are using SASL authentication and/or TLS/SSL connection to
     access the guest, the options are limited. Common VNC viewers such as
     <code class="command">tightvnc</code> or <code class="command">tigervnc</code> support neither
     SASL authentication nor TLS/SSL. The only supported alternative to Virtual Machine Manager
     and <code class="command">virt-viewer</code> is Remmina (refer to
     <span class="intraxref">Book “Administration Guide”, Chapter 10 “Remote graphical sessions with VNC”, Section 10.2 “Remmina: the remote desktop client”</span>).
    </p></div><section class="sect3" id="sec-libvirt-managing-console-vnc-vmm" data-id-title="Opening a graphical console with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.2.1.1 </span><span class="title-name">Opening a graphical console with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-console-vnc-vmm">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       In the Virtual Machine Manager, right-click a VM Guest entry.
      </p></li><li class="step"><p>
       Choose <span class="guimenu">Open</span> from the pop-up menu.
      </p></li></ol></div></div></section><section class="sect3" id="sec-libvirt-managing-vnc-viewer" data-id-title="Opening a graphical console with virt-viewer"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.2.1.2 </span><span class="title-name">Opening a graphical console with <code class="command">virt-viewer</code></span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-vnc-viewer">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">virt-viewer</code> is a simple VNC viewer with added
     functionality for displaying VM Guest consoles. For example, it can be
     started in <span class="quote">“<span class="quote">wait</span>”</span> mode, where it waits for a VM Guest to
     start before it connects. It also supports automatically reconnecting to a
     VM Guest that is rebooted.
    </p><p>
     <code class="command">virt-viewer</code> addresses VM Guests by name, by ID or by
     UUID. Use <code class="command">virsh</code> <code class="option">list --all</code> to get this
     data.
    </p><p>
     To connect to a guest that is running or paused, use either the ID, UUID,
     or name. VM Guests that are shut off do not have an ID—you can only
     connect to them by UUID or name.
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.5.6.3.8.5.1"><span class="term">Connect to guest with the ID <code class="literal">8</code>
      </span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-viewer 8</pre></div></dd><dt id="id-1.12.4.5.6.3.8.5.2"><span class="term">Connect to the inactive guest named <code class="literal">sles12</code>; the
      connection window will open once the guest starts</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-viewer --wait sles12</pre></div><p>
        With the <code class="option">--wait</code> option, the connection will be upheld
        even if the VM Guest is not running at the moment. When the guest
        starts, the viewer will be launched.
       </p></dd></dl></div><p>
     For more information, see <code class="command">virt-viewer</code>
     <code class="option">--help</code> or <code class="command">man 1 virt-viewer</code>.
    </p><div id="id-1.12.4.5.6.3.8.7" data-id-title="Password input on remote connections with SSH" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Password input on remote connections with SSH</div><p>
      When using <code class="command">virt-viewer</code> to open a connection to a
      remote host via SSH, the SSH password needs to be entered twice. The
      first time for authenticating with <code class="systemitem">libvirt</code>, the second time for
      authenticating with the VNC server. The second password needs to be
      provided on the command line where virt-viewer was started.
     </p></div></section></section><section class="sect2" id="sec-libvirt-managing-console-serial" data-id-title="Opening a serial console"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.2.2 </span><span class="title-name">Opening a serial console</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-console-serial">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Accessing the graphical console of a virtual machine requires a graphical
    environment on the client accessing the VM Guest. As an alternative,
    virtual machines managed with libvirt can also be accessed from the shell
    via the serial console and <code class="command">virsh</code>. To open a serial
    console to a VM Guest named <span class="quote">“<span class="quote">sles12</span>”</span>, run the following
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh console sles12</pre></div><p>
    <code class="command">virsh console</code> takes two optional flags:
    <code class="option">--safe</code> ensures exclusive access to the console,
    <code class="option">--force</code> disconnects any existing sessions before
    connecting. Both features need to be supported by the guest operating
    system.
   </p><p>
    Being able to connect to a VM Guest via serial console requires that the
    guest operating system supports serial console access and is properly
    supported. Refer to the guest operating system manual for more information.
   </p><div id="id-1.12.4.5.6.4.6" data-id-title="Enabling serial console access for SUSE Linux Enterprise and openSUSE guests" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Enabling serial console access for SUSE Linux Enterprise and openSUSE guests</div><p>
     Serial console access in SUSE Linux Enterprise and openSUSE is disabled by default. To
     enable it, proceed as follows:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.5.6.4.6.3.1"><span class="term">SLES 12 and up/openSUSE</span></dt><dd><p>
        Launch the YaST Boot Loader module and switch to the <span class="guimenu">Kernel
        Parameters</span> tab. Add <code class="literal">console=ttyS0</code> to the
        field <span class="guimenu">Optional Kernel Command Line Parameter</span>.
       </p></dd><dt id="id-1.12.4.5.6.4.6.3.2"><span class="term">SLES 11</span></dt><dd><p>
        Launch the YaST Boot Loader module and select the boot entry for
        which to activate serial console access. Choose <span class="guimenu">Edit</span>
        and add <code class="literal">console=ttyS0</code> to the field <span class="guimenu">Optional
        Kernel Command Line Parameter</span>. Additionally, edit
        <code class="filename">/etc/inittab</code> and uncomment the line with the
        following content:
       </p><div class="verbatim-wrap"><pre class="screen">#S0:12345:respawn:/sbin/agetty -L 9600 ttyS0 vt102</pre></div></dd></dl></div></div></section></section><section class="sect1" id="sec-libvirt-managing-status" data-id-title="Changing a VM Guests state: start, stop, pause"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.3 </span><span class="title-name">Changing a VM Guest's state: start, stop, pause</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-status">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Starting, stopping or pausing a VM Guest can be done with either Virtual Machine Manager or
   <code class="command">virsh</code>. You can also configure a VM Guest to be
   automatically started when booting the VM Host Server.
  </p><p>
   When shutting down a VM Guest, you may either shut it down gracefully, or
   force the shutdown. The latter is equivalent to pulling the power plug on a
   physical host and is only recommended if there are no alternatives. Forcing
   a shutdown may cause file system corruption and loss of data on the
   VM Guest.
  </p><div id="id-1.12.4.5.7.4" data-id-title="Graceful shutdown" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Graceful shutdown</div><p>
    To be able to perform a graceful shutdown, the VM Guest must be configured
    to support <a class="xref" href="#gloss-vt-acpi" title="ACPI">ACPI</a>. If you have created the guest
    with the Virtual Machine Manager, ACPI should be available in the VM Guest.
   </p><p>
    Depending on the guest operating system, availability of ACPI may not be
    sufficient to perform a graceful shutdown. It is strongly recommended to
    test shutting down and rebooting a guest before using it in production.
    openSUSE or SUSE Linux Enterprise Desktop, for example, can require Polkit authorization for
    shutdown and reboot. Make sure this policy is turned off on all VM Guests.
   </p><p>
    If ACPI was enabled during a Windows XP/Windows Server 2003 guest
    installation, turning it on in the VM Guest configuration only is not
    sufficient. For more information, see:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <a class="link" href="https://support.microsoft.com/en-us/kb/314088" target="_blank">https://support.microsoft.com/en-us/kb/314088</a>
     </p></li><li class="listitem"><p>
      <a class="link" href="https://support.microsoft.com/en-us/kb/309283" target="_blank">https://support.microsoft.com/en-us/kb/309283</a>
     </p></li></ul></div><p>
    Regardless of the VM Guest's configuration, a graceful shutdown is always
    possible from within the guest operating system.
   </p></div><section class="sect2" id="sec-libvirt-managing-status-vmm" data-id-title="Changing a VM Guests state with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.3.1 </span><span class="title-name">Changing a VM Guest's state with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-status-vmm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Changing a VM Guest's state can be done either from Virtual Machine Manager's main window,
    or from a VNC window.
   </p><div class="procedure" id="id-1.12.4.5.7.5.3" data-id-title="State change from the Virtual Machine Manager window"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 11.1: </span><span class="title-name">State change from the Virtual Machine Manager window </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.5.7.5.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Right-click a VM Guest entry.
     </p></li><li class="step"><p>
      Choose <span class="guimenu">Run</span>, <span class="guimenu">Pause</span>, or one of the
      <span class="guimenu">Shutdown options</span> from the pop-up menu.
     </p></li></ol></div></div><div class="procedure" id="id-1.12.4.5.7.5.4" data-id-title="State change from the VNC window"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 11.2: </span><span class="title-name">State change from the VNC window </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.5.7.5.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Open a VNC Window as described in
      <a class="xref" href="#sec-libvirt-managing-console-vnc-vmm" title="11.2.1.1. Opening a graphical console with Virtual Machine Manager">Section 11.2.1.1, “Opening a graphical console with Virtual Machine Manager”</a>.
     </p></li><li class="step"><p>
      Choose <span class="guimenu">Run</span>, <span class="guimenu">Pause</span>, or one of the
      <span class="guimenu">Shut Down</span> options either from the toolbar or from the
      <span class="guimenu">Virtual Machine</span> menu.
     </p></li></ol></div></div><section class="sect3" id="sec-libvirt-managing-status-vmm-autostart" data-id-title="Automatically starting a VM Guest"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.3.1.1 </span><span class="title-name">Automatically starting a VM Guest</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-status-vmm-autostart">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can automatically start a guest when the VM Host Server boots. This feature
     is not enabled by default and needs to be enabled for each VM Guest
     individually. There is no way to activate it globally.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Double-click the VM Guest entry in Virtual Machine Manager to open its console.
      </p></li><li class="step"><p>
       Choose <span class="guimenu">View</span> › <span class="guimenu">Details</span> to open the VM Guest
       configuration window.
      </p></li><li class="step"><p>
       Choose <span class="guimenu">Boot Options</span> and check <span class="guimenu">Start virtual
       machine on host boot up</span>.
      </p></li><li class="step"><p>
       Save the new configuration with <span class="guimenu">Apply</span>.
      </p></li></ol></div></div></section></section><section class="sect2" id="sec-libvirt-managing-status-virsh" data-id-title="Changing a VM Guests state with virsh"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.3.2 </span><span class="title-name">Changing a VM Guest's state with <code class="command">virsh</code></span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-status-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    In the following examples, the state of a VM Guest named
    <span class="quote">“<span class="quote">sles12</span>”</span> is changed.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.5.7.6.3.1"><span class="term">Start</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh start sles12</pre></div></dd><dt id="id-1.12.4.5.7.6.3.2"><span class="term">Pause</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh suspend sles12</pre></div></dd><dt id="id-1.12.4.5.7.6.3.3"><span class="term">Resume (a suspended  VM Guest)</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh resume sles12</pre></div></dd><dt id="id-1.12.4.5.7.6.3.4"><span class="term">Reboot</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh reboot sles12</pre></div></dd><dt id="id-1.12.4.5.7.6.3.5"><span class="term">Graceful shutdown</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh shutdown sles12</pre></div></dd><dt id="id-1.12.4.5.7.6.3.6"><span class="term">Force shutdown</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh destroy sles12</pre></div></dd><dt id="id-1.12.4.5.7.6.3.7"><span class="term">Turn on automatic start</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh autostart sles12</pre></div></dd><dt id="id-1.12.4.5.7.6.3.8"><span class="term">Turn off automatic start</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh autostart --disable sles12</pre></div></dd></dl></div></section></section><section class="sect1" id="sec-libvirt-manage-save" data-id-title="Saving and restoring the state of a VM Guest"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.4 </span><span class="title-name">Saving and restoring the state of a VM Guest</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-manage-save">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Saving a VM Guest preserves the exact state of the guest’s memory. The
   operation is similar to <span class="emphasis"><em>hibernating</em></span> a computer. A saved
   VM Guest can be quickly restored to its previously saved running condition.
  </p><p>
   When saved, the VM Guest is paused, its current memory state is saved to
   disk, and then the guest is stopped. The operation does not make a copy of
   any portion of the VM Guest’s virtual disk. The amount of time taken to
   save the virtual machine depends on the amount of memory allocated. When
   saved, a VM Guest’s memory is returned to the pool of memory available on
   the VM Host Server.
  </p><p>
   The restore operation loads a VM Guest’s previously saved memory state
   file and starts it. The guest is not booted but instead resumed at the point
   where it was previously saved. The operation is similar to coming out of
   hibernation.
  </p><p>
   The VM Guest is saved to a state file. Make sure there is enough space on
   the partition you are going to save to. For an estimation of the file size
   in megabytes to be expected, issue the following command on the guest:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>free -mh | awk '/^Mem:/ {print $3}'</pre></div><div id="adm-vm-restore" data-id-title="Always restore saved guests" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Always restore saved guests</div><p>
    After using the save operation, do not boot or start the saved VM Guest.
    Doing so would cause the machine's virtual disk and the saved memory state
    to get out of synchronization. This can result in critical errors when
    restoring the guest.
   </p><p>
    To be able to work with a saved VM Guest again, use the restore operation.
    If you used <code class="command">virsh</code> to save a VM Guest, you cannot
    restore it using Virtual Machine Manager. In this case, make sure to restore using
    <code class="command">virsh</code>.
   </p></div><div id="id-1.12.4.5.8.8" data-id-title="Synchronize VM Guests time after restoring it" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Synchronize VM Guest's time after restoring it</div><p>
    If you restore the VM Guest after a long pause (hours) since
    it was saved, its time synchronization service—for example,
    <code class="systemitem">chronyd</code>—may refuse to synchronize its time. In this case,
    manually synchronize VM Guest's time. For example, for KVM hosts,
    you can use the QEMU guest agent and instruct the guest with the
    <code class="command">guest-set-time</code>. Refer to <a class="xref" href="#cha-qemu-ga" title="Chapter 21. QEMU guest agent">Chapter 21, <em>QEMU guest agent</em></a>
    for more details.
   </p></div><div id="id-1.12.4.5.8.9" data-id-title="Only for VM Guests with disk types raw, qcow2" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Only for VM Guests with disk types <code class="literal">raw</code>, <code class="literal">qcow2</code></div><p>
    Saving and restoring VM Guests is only possible if the VM Guest is using
    a virtual disk of the type <code class="literal">raw</code>
    (<code class="filename">.img</code>), or <span class="emphasis"><em>qcow2</em></span>.
   </p></div><section class="sect2" id="sec-libvirt-manage-save-vmm" data-id-title="Saving/restoring with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.4.1 </span><span class="title-name">Saving/restoring with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-manage-save-vmm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure" id="id-1.12.4.5.8.10.2" data-id-title="Saving a VM Guest"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 11.3: </span><span class="title-name">Saving a VM Guest </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.5.8.10.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Open a VNC connection window to a VM Guest. Make sure the guest is
      running.
     </p></li><li class="step"><p>
      Choose <span class="guimenu">Virtual Machine</span> › <span class="guimenu">Shutdown</span> › <span class="guimenu">Save</span>.
     </p></li></ol></div></div><div class="procedure" id="id-1.12.4.5.8.10.3" data-id-title="Restoring a VM Guest"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 11.4: </span><span class="title-name">Restoring a VM Guest </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.5.8.10.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Open a VNC connection window to a VM Guest. Make sure the guest is not
      running.
     </p></li><li class="step"><p>
      Choose <span class="guimenu">Virtual Machine</span> › <span class="guimenu">Restore</span>.
     </p><p>
      If the VM Guest was previously saved using Virtual Machine Manager, you will not be
      offered an option to <span class="guimenu">Run</span> the guest. However, note the
      caveats on machines saved with <code class="command">virsh</code> outlined in
      <a class="xref" href="#adm-vm-restore" title="Warning: Always restore saved guests">Warning: Always restore saved guests</a>.
     </p></li></ol></div></div></section><section class="sect2" id="sec-libvirt-manage-save-virsh" data-id-title="Saving and restoring with virsh"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.4.2 </span><span class="title-name">Saving and restoring with <code class="command">virsh</code></span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-manage-save-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Save a running VM Guest with the command <code class="command">virsh</code>
    <code class="option">save</code> and specify the file which it is saved to.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.5.8.11.3.1"><span class="term">Save the guest named <code class="literal">opensuse13</code>
     </span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh save opensuse13 /virtual/saves/opensuse13.vmsav</pre></div></dd><dt id="id-1.12.4.5.8.11.3.2"><span class="term">Save the guest with the ID <code class="literal">37</code>
     </span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh save 37 /virtual/saves/opensuse13.vmsave</pre></div></dd></dl></div><p>
    To restore a VM Guest, use <code class="command">virsh</code>
    <code class="option">restore</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh restore /virtual/saves/opensuse13.vmsave</pre></div></section></section><section class="sect1" id="sec-libvirt-managing-snapshots" data-id-title="Creating and managing snapshots"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.5 </span><span class="title-name">Creating and managing snapshots</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-snapshots">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   VM Guest snapshots are snapshots of the complete virtual machine including
   the state of CPU, RAM, devices, and the content of all writable disks. To
   use virtual machine snapshots, all the attached hard disks need to use the
   qcow2 disk image format, and at least one of them needs to be writable.
  </p><p>
   Snapshots let you restore the state of the machine at a particular point in
   time. This is useful when undoing a faulty configuration or the installation
   of a lot of packages. After starting a snapshot that was created while the
   VM Guest was shut off, you will need to boot it. Any changes written to the
   disk after that point in time will be lost when starting the snapshot.
  </p><div id="id-1.12.4.5.9.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    Snapshots are supported on KVM VM Host Servers only.
   </p></div><section class="sect2" id="libvirt-snapshots-terminology" data-id-title="Terminology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.5.1 </span><span class="title-name">Terminology</span></span> <a title="Permalink" class="permalink" href="#libvirt-snapshots-terminology">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There are several specific terms used to describe the types of snapshots:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.5.9.5.3.1"><span class="term">Internal snapshots</span></dt><dd><p>
       Snapshots that are saved into the qcow2 file of the original VM Guest.
       The file holds both the saved state of the snapshot and the changes made
       since the snapshot was taken. The main advantage of internal snapshots
       is that they are all stored in one file and therefore it is easy to copy
       or move them across multiple machines.
      </p></dd><dt id="id-1.12.4.5.9.5.3.2"><span class="term">External snapshots</span></dt><dd><p>
       When creating an external snapshot, the original qcow2 file is saved and
       made read-only, while a new qcow2 file is created to hold the changes.
       The original file is sometimes called a 'backing' or 'base' file, while
       the new file with all the changes is called an 'overlay' or 'derived'
       file. External snapshots are useful when performing backups of VM Guests.
       However, external snapshots are not supported by Virtual Machine Manager, and
       cannot be deleted by <code class="command">virsh</code> directly.
       For more information on external snapshots in QEMU, refer
       to <a class="xref" href="#cha-qemu-guest-inst-qemu-img-effect" title="34.2.4. Manipulate disk images effectively">Section 34.2.4, “Manipulate disk images effectively”</a>.
      </p></dd><dt id="id-1.12.4.5.9.5.3.3"><span class="term">Live snapshots</span></dt><dd><p>
       Snapshots created when the original VM Guest is running. Internal live
       snapshots support saving the devices, and memory and disk states, while
       external live snapshots with <code class="command">virsh</code> support saving
       either the memory state, or the disk state, or both.
      </p></dd><dt id="id-1.12.4.5.9.5.3.4"><span class="term">Offline snapshots</span></dt><dd><p>
       Snapshots created from a VM Guest that is shut off. This ensures data
       integrity as all the guest's processes are stopped and no memory is in
       use.
      </p></dd></dl></div></section><section class="sect2" id="sec-libvirt-managing-snapshots-vmm" data-id-title="Creating and managing snapshots with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.5.2 </span><span class="title-name">Creating and managing snapshots with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-snapshots-vmm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.12.4.5.9.6.2" data-id-title="Internal snapshots only" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Internal snapshots only</div><p>
     Virtual Machine Manager supports only internal snapshots, either live or offline.
    </p></div><p>
    To open the snapshot management view in Virtual Machine Manager, open the VNC window as
    described in <a class="xref" href="#sec-libvirt-managing-console-vnc-vmm" title="11.2.1.1. Opening a graphical console with Virtual Machine Manager">Section 11.2.1.1, “Opening a graphical console with Virtual Machine Manager”</a>. Now
    either choose <span class="guimenu">View</span> › <span class="guimenu">Snapshots</span> or click <span class="guimenu">Manage VM
    Snapshots</span> in the toolbar.
   </p><div class="informalfigure"><div class="mediaobject"><a href="images/virt_vmm_snapshots_list.png"><img src="images/virt_vmm_snapshots_list.png" width="75%" alt="Virtual Machine Manager snapshot list" title="Virtual Machine Manager snapshot list"/></a></div></div><p>
    The list of existing snapshots for the chosen VM Guest is displayed in the
    left-hand part of the window. The snapshot that was last started is marked
    with a green tick. The right-hand part of the window shows details of the
    snapshot currently marked in the list. These details include the snapshot's
    title and time stamp, the state of the VM Guest at the time the snapshot
    was taken and a description. Snapshots of running guests also include a
    screenshot. The <span class="guimenu">Description</span> can be changed directly from
    this view. Other snapshot data cannot be changed.
   </p><section class="sect3" id="sec-libvirt-managing-snapshots-vmm-add" data-id-title="Creating a snapshot"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.5.2.1 </span><span class="title-name">Creating a snapshot</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-snapshots-vmm-add">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To take a new snapshot of a VM Guest, proceed as follows:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Optionally, shut down the VM Guest if you want to create an offline
       snapshot.
      </p></li><li class="step"><p>
       Click <span class="guimenu">Add</span> in the bottom left corner of the VNC
       window.
      </p><p>
       The window <span class="guimenu">Create Snapshot</span> opens.
      </p></li><li class="step"><p>
       Provide a <span class="guimenu">Name</span> and, optionally, a description. The
       name cannot be changed after the snapshot has been taken. To be able to
       identify the snapshot later easily, use a <span class="quote">“<span class="quote">speaking name</span>”</span>.
      </p></li><li class="step"><p>
       Confirm with <span class="guimenu">Finish</span>.
      </p></li></ol></div></div></section><section class="sect3" id="sec-libvirt-managing-snapshots-vmm-delete" data-id-title="Deleting a snapshot"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.5.2.2 </span><span class="title-name">Deleting a snapshot</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-snapshots-vmm-delete">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To delete a snapshot of a VM Guest, proceed as follows:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Click <span class="guimenu">Delete</span> in the bottom left corner of the VNC
       window.
      </p></li><li class="step"><p>
       Confirm the deletion with <span class="guimenu">Yes</span>.
      </p></li></ol></div></div></section><section class="sect3" id="sec-libvirt-managing-snapshots-vmm-start" data-id-title="Starting a snapshot"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.5.2.3 </span><span class="title-name">Starting a snapshot</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-snapshots-vmm-start">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To start a snapshot, proceed as follows:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Click <span class="guimenu">Run</span> in the bottom left corner of the VNC
       window.
      </p></li><li class="step"><p>
       Confirm the start with <span class="guimenu">Yes</span>.
      </p></li></ol></div></div></section></section><section class="sect2" id="sec-libvirt-managing-snapshots-virsh" data-id-title="Creating and managing snapshots with virsh"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.5.3 </span><span class="title-name">Creating and managing snapshots with <code class="command">virsh</code></span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-snapshots-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To list all existing snapshots for a domain
    (<em class="replaceable">admin_server</em> in the following), run the
    <code class="literal">snapshot-list</code> command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-list --domain sle-ha-node1
 Name                 Creation Time             State
------------------------------------------------------------
 sleha_12_sp2_b2_two_node_cluster 2016-06-06 15:04:31 +0200 shutoff
 sleha_12_sp2_b3_two_node_cluster 2016-07-04 14:01:41 +0200 shutoff
 sleha_12_sp2_b4_two_node_cluster 2016-07-14 10:44:51 +0200 shutoff
 sleha_12_sp2_rc3_two_node_cluster 2016-10-10 09:40:12 +0200 shutoff
 sleha_12_sp2_gmc_two_node_cluster 2016-10-24 17:00:14 +0200 shutoff
 sleha_12_sp3_gm_two_node_cluster 2017-08-02 12:19:37 +0200 shutoff
 sleha_12_sp3_rc1_two_node_cluster 2017-06-13 13:34:19 +0200 shutoff
 sleha_12_sp3_rc2_two_node_cluster 2017-06-30 11:51:24 +0200 shutoff
 sleha_15_b6_two_node_cluster 2018-02-07 15:08:09 +0100 shutoff
 sleha_15_rc1_one-node 2018-03-09 16:32:38 +0100 shutoff</pre></div><p>
    The snapshot that was last started is shown with the
    <code class="literal">snapshot-current command:</code>
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-current --domain admin_server
Basic installation incl. SMT for CLOUD4</pre></div><p>
    Details about a particular snapshot can be obtained by running the
    <code class="literal">snapshot-info</code> command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-info --domain admin_server \
   -name  "Basic installation incl. SMT for CLOUD4"
Name:           Basic installation incl. SMT for CLOUD4
Domain:         admin_server
Current:        yes
State:          shutoff
Location:       internal
Parent:         Basic installation incl. SMT for CLOUD3-HA
Children:       0
Descendants:    0
Metadata:       yes</pre></div><section class="sect3" id="sec-libvirt-managing-snapshots-virsh-add" data-id-title="Creating internal snapshots"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.5.3.1 </span><span class="title-name">Creating internal snapshots</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-snapshots-virsh-add">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To take an internal snapshot of a VM Guest, either a live or offline, use
     the <code class="literal">snapshot-create-as</code> command as follows:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-create-as --domain admin_server<span class="callout" id="virsh-snapshot-add-domain">1</span> --name "Snapshot 1"<span class="callout" id="virsh-snapshot-add-name">2</span> \
--description "First snapshot"<span class="callout" id="virsh-snapshot-add-description">3</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#virsh-snapshot-add-domain"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Domain name. Mandatory.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#virsh-snapshot-add-name"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Name of the snapshot. It is recommended to use a <span class="quote">“<span class="quote">speaking
       name</span>”</span>, since that makes it easier to identify the snapshot.
       Mandatory.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#virsh-snapshot-add-description"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Description for the snapshot. Optional.
      </p></td></tr></table></div></section><section class="sect3" id="sec-libvirt-managing-snapshots-virsh-add-ext" data-id-title="Creating external snapshots"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.5.3.2 </span><span class="title-name">Creating external snapshots</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-snapshots-virsh-add-ext">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     With <code class="command">virsh</code>, you can take external snapshots of the
     guest's memory state, disk state, or both.
    </p><p>
     To take both live and offline external snapshots of the guest's disk,
     specify the <code class="option">--disk-only</code> option:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-create-as --domain admin_server --name \
 "Offline external snapshot" --disk-only</pre></div><p>
     You can specify the <code class="option">--diskspec</code> option to control how the
     external files are created:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-create-as --domain admin_server --name \
 "Offline external snapshot" \
 --disk-only --diskspec vda,snapshot=external,file=/path/to/snapshot_file</pre></div><p>
     To take a live external snapshot of the guest's memory, specify the
     <code class="option">--live</code> and <code class="option">--memspec</code> options:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-create-as --domain admin_server --name \
 "Offline external snapshot" --live \
 --memspec snapshot=external,file=/path/to/snapshot_file</pre></div><p>
     To take a live external snapshot of both the guest's disk and memory
     states, combine the <code class="option">--live</code>, <code class="option">--diskspec</code>,
     and <code class="option">--memspec</code> options:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-create-as --domain admin_server --name \
 "Offline external snapshot" --live \
 --memspec snapshot=external,file=/path/to/snapshot_file
 --diskspec vda,snapshot=external,file=/path/to/snapshot_file</pre></div><p>
     Refer to the <em class="citetitle">SNAPSHOT COMMANDS</em> section in
     <code class="command">man 1 virsh</code> for more details.
    </p></section><section class="sect3" id="sec-libvirt-managing-snapshots-virsh-delete" data-id-title="Deleting a snapshot"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.5.3.3 </span><span class="title-name">Deleting a snapshot</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-snapshots-virsh-delete">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     External snapshots cannot be deleted with <code class="command">virsh</code>.
     To delete an internal snapshot of a VM Guest and restore the disk space
     it occupies, use the <code class="literal">snapshot-delete</code> command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-delete --domain admin_server --snapshotname "Snapshot 2"</pre></div></section><section class="sect3" id="sec-libvirt-managing-snapshots-virsh-start" data-id-title="Starting a snapshot"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.5.3.4 </span><span class="title-name">Starting a snapshot</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-snapshots-virsh-start">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To start a snapshot, use the <code class="literal">snapshot-revert</code> command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-revert --domain admin_server --snapshotname "Snapshot 1"</pre></div><p>
     To start the current snapshot (the one the VM Guest was started off), it
     is sufficient to use <code class="option">--current</code> rather than specifying the
     snapshot name:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh snapshot-revert --domain admin_server --current</pre></div></section></section></section><section class="sect1" id="sec-libvirt-managing-delete" data-id-title="Deleting a VM Guest"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.6 </span><span class="title-name">Deleting a VM Guest</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-delete">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   By default, deleting a VM Guest using <code class="command">virsh</code> removes only
   its XML configuration. Since attached storage is not deleted by default, you
   can reuse it with another VM Guest. With Virtual Machine Manager, you can also delete a
   guest's storage files as well—this will completely erase the guest.
  </p><section class="sect2" id="sec-libvirt-managing-delete-vmm" data-id-title="Deleting a VM Guest with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.6.1 </span><span class="title-name">Deleting a VM Guest with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-delete-vmm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      In the Virtual Machine Manager, right-click a VM Guest entry.
     </p></li><li class="step"><p>
      From the context menu, choose <span class="guimenu">Delete</span>.
     </p></li><li class="step"><p>
      A confirmation window opens. Clicking <span class="guimenu">Delete</span> will
      permanently erase the VM Guest. The deletion is not recoverable.
     </p><p>
      You can also permanently delete the guest's virtual disk by activating
      <span class="guimenu">Delete Associated Storage Files</span>. The deletion is not
      recoverable either.
     </p></li></ol></div></div></section><section class="sect2" id="sec-libvirt-managing-delete-virsh" data-id-title="Deleting a VM Guest with virsh"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.6.2 </span><span class="title-name">Deleting a VM Guest with <code class="command">virsh</code></span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-delete-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To delete a VM Guest, it needs to be shut down first. It is not possible
    to delete a running guest. For information on shutting down, see
    <a class="xref" href="#sec-libvirt-managing-status" title="11.3. Changing a VM Guest's state: start, stop, pause">Section 11.3, “Changing a VM Guest's state: start, stop, pause”</a>.
   </p><p>
    To delete a VM Guest with <code class="command">virsh</code>, run
    <code class="command">virsh</code> <code class="option">undefine</code>
    <em class="replaceable">VM_NAME</em>.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh undefine sles12</pre></div><p>
    There is no option to automatically delete the attached storage files. If
    they are managed by libvirt, delete them as described in
    <a class="xref" href="#sec-libvirt-storage-virsh-del-volumes" title="9.2.1.4. Deleting volumes from a storage pool">Section 9.2.1.4, “Deleting volumes from a storage pool”</a>.
   </p></section></section><section class="sect1" id="sec-libvirt-admin-migrate" data-id-title="Migrating VM Guests"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.7 </span><span class="title-name">Migrating VM Guests</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-admin-migrate">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   One of the major advantages of virtualization is that VM Guests are
   portable. When a VM Host Server needs to go down for maintenance, or when the host
   gets overloaded, the guests can easily be moved to another VM Host Server. KVM
   and Xen even support <span class="quote">“<span class="quote">live</span>”</span> migrations during which the
   VM Guest is constantly available.
  </p><section class="sect2" id="libvirt-admin-live-migration-requirements" data-id-title="Migration requirements"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.7.1 </span><span class="title-name">Migration requirements</span></span> <a title="Permalink" class="permalink" href="#libvirt-admin-live-migration-requirements">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To successfully migrate a VM Guest to another VM Host Server, the following
    requirements need to be met:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      It is recommended that the source and destination systems have the same
      architecture.
     </p></li><li class="listitem"><p>
      Storage devices must be accessible from both machines (for example, via
      NFS or iSCSI) and must be configured as a storage pool on both machines.
      For more information, see <a class="xref" href="#cha-libvirt-storage" title="Chapter 13. Advanced storage topics">Chapter 13, <em>Advanced storage topics</em></a>.
     </p><p>
      This is also true for CD-ROM or floppy images that are connected during
      the move. However, you can disconnect them prior to the move as described
      in <a class="xref" href="#sec-libvirt-config-cdrom-media-change" title="14.11. Ejecting and changing floppy or CD/DVD-ROM media with Virtual Machine Manager">Section 14.11, “Ejecting and changing floppy or CD/DVD-ROM media with Virtual Machine Manager”</a>.
     </p></li><li class="listitem"><p>
      <code class="systemitem">libvirtd</code> needs to run on both VM Host Servers and you must be able to open a
      remote <code class="systemitem">libvirt</code> connection between the target and the source host (or
      vice versa). Refer to <a class="xref" href="#sec-libvirt-connect-remote" title="12.3. Configuring remote connections">Section 12.3, “Configuring remote connections”</a> for
      details.
     </p></li><li class="listitem"><p>
      If a firewall is running on the target host, ports need to be opened to
      allow the migration. If you do not specify a port during the migration
      process, <code class="systemitem">libvirt</code> chooses one from the range 49152:49215. Make sure that
      either this range (recommended) or a dedicated port of your choice is
      opened in the firewall on the <span class="emphasis"><em>target host</em></span>.
     </p></li><li class="listitem"><p>
      Host and target machine should be in the same subnet on the network,
      otherwise networking will not work after the migration.
     </p></li><li class="listitem"><p>
      All VM Host Servers participating in migration must have the same UID for
      the qemu user and the same GIDs for the kvm, qemu, and libvirt groups.
     </p></li><li class="listitem"><p>
      No running or paused VM Guest with the same name must exist on the
      target host. If a shut down machine with the same name exists, its
      configuration will be overwritten.
     </p></li><li class="listitem"><p>
      All CPU models except <span class="emphasis"><em>host cpu</em></span> model are supported
      when migrating VM Guests.
     </p></li><li class="listitem"><p>
      <a class="xref" href="#gloss-vt-acronym-sata" title="SATA">SATA</a> disk device type is not
      migratable.
     </p></li><li class="listitem"><p>
      File system pass-through feature is incompatible with migration.
     </p></li><li class="listitem"><p>
      The VM Host Server and VM Guest need to have proper timekeeping installed. See
      <a class="xref" href="#sec-kvm-managing-clock" title="Chapter 19. VM Guest clock settings">Chapter 19, <em>VM Guest clock settings</em></a>.
     </p></li><li class="listitem"><p>
      No physical devices can be passed from host to guest. Live migration is
      currently not supported when using devices with PCI pass-through or
      <a class="xref" href="#vt-io-sriov">SR-IOV</a>. If live migration needs to be supported,
      you need to use software virtualization (paravirtualization or full
      virtualization).
     </p></li><li class="listitem"><p>
      Cache mode setting is an important setting for migration. See:
      <a class="xref" href="#sec-cache-mode-live-migration" title="18.6. Cache modes and live migration">Section 18.6, “Cache modes and live migration”</a>.
     </p></li><li class="listitem"><p>
      Backward migration (for example, from SLES 15 SP2 to 15 SP1) is not
      supported.
     </p></li><li class="listitem"><p>
      SUSE strives to support live migration of VM Guests from a VM Host Server
      running a service pack under LTSS to a VM Host Server running a newer service
      pack, within the same SLES major version. For example, VM Guest
      migration from an SLES 12 SP2 host to an SLES 12 SP5 host. SUSE only
      performs minimal testing of LTSS-to-newer migration scenarios and
      recommends thorough on-site testing before attempting to migrate critical
      VM Guests.
     </p></li><li class="listitem"><p>
      The image directory should be located in the same path on both hosts.
     </p></li><li class="listitem"><p>
      All hosts should be on the same level of microcode (especially the spectre
      microcode updates). This can be achieved by installing the latest updates
      of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> on all hosts.
     </p></li></ul></div></section><section class="sect2" id="sec-libvirt-admin-migrate-virtmanager" data-id-title="Migrating with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.7.2 </span><span class="title-name">Migrating with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-admin-migrate-virtmanager">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When using the Virtual Machine Manager to migrate VM Guests, it does not matter on which
    machine it is started. You can start Virtual Machine Manager on the source or the target host
    or even on a third host. In the latter case you need to be able to open
    remote connections to both the target and the source host.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start Virtual Machine Manager and establish a connection to the target or the source host.
      If the Virtual Machine Manager was started neither on the target nor the source host,
      connections to both hosts need to be opened.
     </p></li><li class="step"><p>
      Right-click the VM Guest that you want to migrate and choose
      <span class="guimenu">Migrate</span>. Make sure the guest is running or
      paused—it is not possible to migrate guests that are shut down.
     </p><div id="id-1.12.4.5.11.4.3.2.2" data-id-title="Increasing the speed of the migration" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Increasing the speed of the migration</div><p>
       To increase the speed of the migration somewhat, pause the VM Guest.
       This is the equivalent of the former so-called <span class="quote">“<span class="quote">offline
       migration</span>”</span> option of Virtual Machine Manager.
      </p></div></li><li class="step"><p>
      Choose a <span class="guimenu">New Host</span> for the VM Guest. If the desired
      target host does not show up, make sure that you are connected to the
      host.
     </p><p>
      To change the default options for connecting to the remote host, under
      <span class="guimenu">Connection</span>, set the <span class="guimenu">Mode</span>, and the
      target host's <span class="guimenu">Address</span> (IP address or host name) and
      <span class="guimenu">Port</span>. If you specify a <span class="guimenu">Port</span>, you
      must also specify an <span class="guimenu">Address</span>.
     </p><p>
      Under <span class="guimenu">Advanced options</span>, choose whether the move should
      be permanent (default) or temporary, using <span class="guimenu">Temporary
      move</span>.
     </p><p>
      Additionally, there is the option <span class="guimenu">Allow unsafe</span>, which
      allows migrating without disabling the cache of the VM Host Server. This can
      speed up the migration but only works when the current configuration
      allows for a consistent view of the VM Guest storage without using
      <code class="literal">cache="none"</code>/<code class="literal">0_DIRECT</code>.
     </p><div id="id-1.12.4.5.11.4.3.3.5" data-id-title="Bandwidth option" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Bandwidth option</div><p>
       In recent versions of Virtual Machine Manager, the option of setting a bandwidth for the
       migration has been removed. To set a specific bandwidth, use
       <code class="command">virsh</code> instead.
      </p></div></li><li class="step"><p>
      To perform the migration, click <span class="guimenu">Migrate</span>.
     </p><p>
      When the migration is complete, the <span class="guimenu">Migrate</span> window
      closes and the VM Guest is now listed on the new host in the Virtual Machine Manager
      window. The original VM Guest will still be available on the target host
      (in shut down state).
     </p></li></ol></div></div></section><section class="sect2" id="sec-libvirt-admin-migrate-virsh" data-id-title="Migrating with virsh"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.7.3 </span><span class="title-name">Migrating with <code class="command">virsh</code></span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-admin-migrate-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To migrate a VM Guest with <code class="command">virsh</code>
    <code class="option">migrate</code>, you need to have direct or remote shell access to
    the VM Host Server, because the command needs to be run on the host. The
    migration command looks like this:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh migrate [OPTIONS] <em class="replaceable">VM_ID_or_NAME</em> <em class="replaceable">CONNECTION_URI</em> [--migrateuri tcp://<em class="replaceable">REMOTE_HOST:PORT</em>]</pre></div><p>
    The most important options are listed below. See <code class="command">virsh help
    migrate</code> for a full list.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.5.11.5.5.1"><span class="term"><code class="option">--live</code>
     </span></dt><dd><p>
       Does a live migration. If not specified, the guest will be paused during
       the migration (<span class="quote">“<span class="quote">offline migration</span>”</span>).
      </p></dd><dt id="id-1.12.4.5.11.5.5.2"><span class="term"><code class="option">--suspend</code>
     </span></dt><dd><p>
       Does an offline migration and does not restart the VM Guest on the
       target host.
      </p></dd><dt id="id-1.12.4.5.11.5.5.3"><span class="term"><code class="option">--persistent</code>
     </span></dt><dd><p>
       By default a migrated VM Guest will be migrated temporarily, so its
       configuration is automatically deleted on the target host if it is shut
       down. Use this switch to make the migration persistent.
      </p></dd><dt id="id-1.12.4.5.11.5.5.4"><span class="term"><code class="option">--undefinesource</code>
     </span></dt><dd><p>
       When specified, the VM Guest definition on the source host will be
       deleted after a successful migration (however, virtual disks attached to
       this guest will <span class="emphasis"><em>not</em></span> be deleted).
      </p></dd><dt id="id-1.12.4.5.11.5.5.5"><span class="term"><code class="option">--parallel --parallel-connections <em class="replaceable">NUM_OF_CONNECTIONS</em></code></span></dt><dd><p>
       Parallel migration can be used to increase migration data throughput in
       cases where a single migration thread is not capable of saturating the
       network link between source and destination hosts. On hosts with 40 GB
       network interfaces, it may require four migration threads to saturate the
       link. With parallel migration, the time required to migrate large memory
       VMs can be significantly reduced.
      </p></dd></dl></div><p>
    The following examples use mercury.example.com as the source system and jupiter.example.com as
    the target system; the VM Guest's name is <code class="literal">opensuse131</code>
    with Id <code class="literal">37</code>.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.5.11.5.7.1"><span class="term">Offline migration with default parameters</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh migrate 37 qemu+ssh://tux@jupiter.example.com/system</pre></div></dd><dt id="id-1.12.4.5.11.5.7.2"><span class="term">Transient live migration with default parameters</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh migrate --live opensuse131 qemu+ssh://tux@jupiter.example.com/system</pre></div></dd><dt id="id-1.12.4.5.11.5.7.3"><span class="term">Persistent live migration; delete VM definition on source</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh migrate --live --persistent --undefinesource 37 \
qemu+tls://tux@jupiter.example.com/system</pre></div></dd><dt id="id-1.12.4.5.11.5.7.4"><span class="term">Offline migration using port 49152</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh migrate opensuse131 qemu+ssh://tux@jupiter.example.com/system \
--migrateuri tcp://@jupiter.example.com:49152</pre></div></dd></dl></div><div id="id-1.12.4.5.11.5.8" data-id-title="Transient compared to persistent migrations" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Transient compared to persistent migrations</div><p>
     By default <code class="command">virsh migrate</code> creates a temporary
     (transient) copy of the VM Guest on the target host. A shut down version
     of the original guest description remains on the source host. A transient
     copy will be deleted from the server after it is shut down.
    </p><p>
     To create a permanent copy of a guest on the target host, use the switch
     <code class="option">--persistent</code>. A shut down version of the original guest
     description remains on the source host, too. Use the option
     <code class="option">--undefinesource</code> together with
     <code class="option">--persistent</code> for a <span class="quote">“<span class="quote">real</span>”</span> move where a
     permanent copy is created on the target host and the version on the source
     host is deleted.
    </p><p>
     It is not recommended to use <code class="option">--undefinesource</code> without the
     <code class="option">--persistent</code> option, since this will result in the loss
     of both VM Guest definitions when the guest is shut down on the target
     host.
    </p></div></section><section class="sect2" id="sec-libvirt-migrate-stepbstep" data-id-title="Step-by-step example"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.7.4 </span><span class="title-name">Step-by-step example</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-migrate-stepbstep">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect3" id="sec-migrate-stepbstep-export" data-id-title="Exporting the storage"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.7.4.1 </span><span class="title-name">Exporting the storage</span></span> <a title="Permalink" class="permalink" href="#sec-migrate-stepbstep-export">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     First you need to export the storage, to share the Guest image between
     host. This can be done by an NFS server. In the following example we want
     to share the <code class="filename">/volume1/VM</code> directory for all machines
     that are on the network 10.0.1.0/24. We will use a SUSE Linux Enterprise NFS server. As
     root user, edit the <code class="filename">/etc/exports</code> file and add:
    </p><div class="verbatim-wrap"><pre class="screen">/volume1/VM 10.0.1.0/24  (rw,sync,no_root_squash)</pre></div><p>
     You need to restart the NFS server:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart nfsserver
<code class="prompt user">&gt; </code><code class="command">sudo</code> exportfs
/volume1/VM      10.0.1.0/24</pre></div></section><section class="sect3" id="sec-migrate-stepbstep-pool" data-id-title="Defining the pool on the target hosts"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.7.4.2 </span><span class="title-name">Defining the pool on the target hosts</span></span> <a title="Permalink" class="permalink" href="#sec-migrate-stepbstep-pool">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     On each host where you want to migrate the VM Guest, the pool must be
     defined to be able to access the volume (that contains the Guest image).
     Our NFS server IP address is 10.0.1.99, its share is the
     <code class="filename">/volume1/VM</code> directory, and we want to get it mounted
     in the <code class="filename">/var/lib/libvirt/images/VM</code> directory. The pool
     name will be <span class="emphasis"><em>VM</em></span>. To define this pool, create a
     <code class="filename">VM.xml</code> file with the following content:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;pool type='netfs'&gt;
  &lt;name&gt;VM&lt;/name&gt;
  &lt;source&gt;
    &lt;host name='10.0.1.99'/&gt;
    &lt;dir path='/volume1/VM'/&gt;
    &lt;format type='auto'/&gt;
  &lt;/source&gt;
  &lt;target&gt;
    &lt;path&gt;/var/lib/libvirt/images/VM&lt;/path&gt;
    &lt;permissions&gt;
      &lt;mode&gt;0755&lt;/mode&gt;
      &lt;owner&gt;-1&lt;/owner&gt;
      &lt;group&gt;-1&lt;/group&gt;
    &lt;/permissions&gt;
  &lt;/target&gt;
  &lt;/pool&gt;</pre></div><p>
     Then load it into <code class="systemitem">libvirt</code> using the <code class="command">pool-define</code>
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh pool-define VM.xml</pre></div><p>
     An alternative way to define this pool is to use the
     <code class="command">virsh</code> command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh pool-define-as VM --type netfs --source-host 10.0.1.99 \
     --source-path /volume1/VM --target /var/lib/libvirt/images/VM
Pool VM created</pre></div><p>
     The following commands assume that you are in the interactive shell of
     <code class="command">virsh</code> which can also be reached by using the command
     <code class="command">virsh</code> without any arguments. Then the pool can be set
     to start automatically at host boot (autostart option):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">virsh # </code>pool-autostart VM
Pool VM marked as autostarted</pre></div><p>
     If you want to disable the autostart:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">virsh # </code>pool-autostart VM --disable
Pool VM unmarked as autostarted</pre></div><p>
     Check if the pool is present:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">virsh # </code>pool-list --all
 Name                 State      Autostart
-------------------------------------------
 default              active     yes
 VM                   active     yes

<code class="prompt user">virsh # </code>pool-info VM
Name:           VM
UUID:           42efe1b3-7eaa-4e24-a06a-ba7c9ee29741
State:          running
Persistent:     yes
Autostart:      yes
Capacity:       2,68 TiB
Allocation:     2,38 TiB
Available:      306,05 GiB</pre></div><div id="id-1.12.4.5.11.6.4.14" data-id-title="Pool needs to exist on all target hosts" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Pool needs to exist on all target hosts</div><p>
      Remember: this pool must be defined on each host where you want to be
      able to migrate your VM Guest.
     </p></div></section><section class="sect3" id="sec-migrate-stepbstep-volume" data-id-title="Creating the volume"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.7.4.3 </span><span class="title-name">Creating the volume</span></span> <a title="Permalink" class="permalink" href="#sec-migrate-stepbstep-volume">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The pool has been defined—now we need a volume which will contain
     the disk image:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">virsh # </code>vol-create-as VM sled12.qcow2 8G --format qcow2
Vol sled12.qcow2 created</pre></div><p>
     The volume names shown will be used later to install the guest with
     virt-install.
    </p></section><section class="sect3" id="sec-migrate-stepbstep-guest" data-id-title="Creating the VM Guest"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.7.4.4 </span><span class="title-name">Creating the VM Guest</span></span> <a title="Permalink" class="permalink" href="#sec-migrate-stepbstep-guest">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Let's create a <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> VM Guest with the
     <code class="command">virt-install</code> command. The <span class="emphasis"><em>VM</em></span> pool
     will be specified with the <code class="command">--disk</code> option,
     <span class="emphasis"><em>cache=none</em></span> is recommended if you do not want to use
     the <code class="command">--unsafe</code> option while doing the migration.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virt-install --connect qemu:///system --virt-type kvm --name \
   sled12 --memory 1024 --disk vol=VM/sled12.qcow2,cache=none --cdrom \
   /mnt/install/ISO/SLE-12-Desktop-DVD-x86_64-Build0327-Media1.iso --graphics \
   vnc --os-variant sled12
Starting install...
Creating domain...</pre></div></section><section class="sect3" id="sec-migrate-stepbstep-migrate" data-id-title="Migrate the VM Guest"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">11.7.4.5 </span><span class="title-name">Migrate the VM Guest</span></span> <a title="Permalink" class="permalink" href="#sec-migrate-stepbstep-migrate">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Everything is ready to do the migration now. Run the
     <code class="command">migrate</code> command on the VM Host Server that is currently
     hosting the VM Guest, and choose the destination.
    </p><div class="verbatim-wrap"><pre class="screen">virsh # migrate --live sled12 --verbose qemu+ssh://<em class="replaceable">IP/Hostname</em>/system
Password:
Migration: [ 12 %]</pre></div></section></section></section><section class="sect1" id="cha-libvirt-admin-monitor" data-id-title="Monitoring"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.8 </span><span class="title-name">Monitoring</span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-admin-monitor">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="cha-libvirt-admin-monitor-virt-manager" data-id-title="Monitoring with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.8.1 </span><span class="title-name">Monitoring with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-admin-monitor-virt-manager">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    After starting Virtual Machine Manager and connecting to the VM Host Server, a CPU usage graph of
    all the running guests is displayed.
   </p><p>
    It is also possible to get information about disk and network usage with
    this tool, however, you must first activate this in
    <span class="guimenu">Preferences</span>:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Run <code class="command">virt-manager</code>.
     </p></li><li class="step"><p>
      Select <span class="guimenu">Edit</span> › <span class="guimenu">Preferences</span>.
     </p></li><li class="step"><p>
      Change the tab from <span class="guimenu">General</span> to
      <span class="guimenu">Polling</span>.
     </p></li><li class="step"><p>
      Activate the check boxes for the kind of activity you want to see:
      <span class="guimenu">Poll Disk I/O</span>, <span class="guimenu">Poll Network I/O</span>,
      and <span class="guimenu">Poll Memory stats</span>.
     </p></li><li class="step"><p>
      If desired, also change the update interval using <span class="guimenu">Update status
      every n seconds</span>.
     </p></li><li class="step"><p>
      Close the <span class="guimenu">Preferences</span> dialog.
     </p></li><li class="step"><p>
      Activate the graphs that should be displayed under <span class="guimenu">View</span> › <span class="guimenu">Graph</span>.
     </p></li></ol></div></div><p>
    Afterward, the disk and network statistics are also displayed in the main
    window of the Virtual Machine Manager.
   </p><p>
    More precise data is available from the VNC window. Open a VNC window as
    described in <a class="xref" href="#sec-libvirt-managing-console-vnc" title="11.2.1. Opening a graphical console">Section 11.2.1, “Opening a graphical console”</a>. Choose
    <span class="guimenu">Details</span> from the toolbar or the <span class="guimenu">View</span>
    menu. The statistics are displayed from the <span class="guimenu">Performance</span>
    entry of the left-hand tree menu.
   </p></section><section class="sect2" id="cha-libvirt-admin-monitor-virt-top" data-id-title="Monitoring with virt-top"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.8.2 </span><span class="title-name">Monitoring with <code class="command">virt-top</code></span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-admin-monitor-virt-top">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">virt-top</code> is a command line tool similar to the
    well-known process monitoring tool <code class="command">top</code>.
    <code class="command">virt-top</code> uses libvirt and therefore is capable of
    showing statistics for VM Guests running on different hypervisors. It is
    recommended to use <code class="command">virt-top</code> instead of
    hypervisor-specific tools like <code class="command">xentop</code>.
   </p><p>
    By default <code class="command">virt-top</code> shows statistics for all running
    VM Guests. Among the data that is displayed is the percentage of memory
    used (<code class="literal">%MEM</code>) and CPU (<code class="literal">%CPU</code>) and the
    uptime of the guest (<code class="literal">TIME</code>). The data is updated
    regularly (every three seconds by default). The following shows the output
    on a VM Host Server with seven VM Guests, four of them inactive:
   </p><div class="verbatim-wrap"><pre class="screen">virt-top 13:40:19 - x86_64 8/8CPU 1283MHz 16067MB 7.6% 0.5%
7 domains, 3 active, 3 running, 0 sleeping, 0 paused, 4 inactive D:0 O:0 X:0
CPU: 6.1%  Mem: 3072 MB (3072 MB by guests)

   ID S RDRQ WRRQ RXBY TXBY %CPU %MEM    TIME   NAME
    7 R  123    1  18K  196  5.8  6.0   0:24.35 sled12_sp1
    6 R    1    0  18K    0  0.2  6.0   0:42.51 sles12_sp1
    5 R    0    0  18K    0  0.1  6.0  85:45.67 opensuse_leap
    -                                           (Ubuntu_1410)
    -                                           (debian_780)
    -                                           (fedora_21)
    -                                           (sles11sp3)</pre></div><p>
    By default the output is sorted by ID. Use the following key combinations
    to change the sort field:
   </p><table style="border: 0; " class="simplelist"><tr><td><span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">P</span>: CPU
     usage
    </td></tr><tr><td><span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">M</span>:
     Total memory allocated by the guest
    </td></tr><tr><td><span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">T</span>: Time
    </td></tr><tr><td><span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">I</span>: ID
    </td></tr></table><p>
    To use any other field for sorting, press <span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">F</span> and select a
    field from the list. To toggle the sort order, use <span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">R</span>.
   </p><p>
    <code class="command">virt-top</code> also supports different views on the VM Guests
    data, which can be changed on-the-fly by pressing the following keys:
   </p><table style="border: 0; " class="simplelist"><tr><td><span class="keycap">0</span>: default view</td></tr><tr><td><span class="keycap">1</span>: show physical CPUs</td></tr><tr><td><span class="keycap">2</span>: show network interfaces</td></tr><tr><td><span class="keycap">3</span>: show virtual disks</td></tr></table><p>
    <code class="command">virt-top</code> supports more hot keys to change the view of
    the data and many command line switches that affect the behavior of the
    program. For more information, see <code class="command">man 1 virt-top</code>.
   </p></section><section class="sect2" id="cha-libvirt-admin-monitor-kvm-stat" data-id-title="Monitoring with kvm_stat"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.8.3 </span><span class="title-name">Monitoring with <code class="command">kvm_stat</code></span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-admin-monitor-kvm-stat">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">kvm_stat</code> can be used to trace KVM performance events.
    It monitors <code class="filename">/sys/kernel/debug/kvm</code>, so it needs the
    debugfs to be mounted. On <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> it should be mounted by default. In
    case it is not mounted, use the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mount -t debugfs none /sys/kernel/debug</pre></div><p>
    <code class="command">kvm_stat</code> can be used in three different modes:
   </p><div class="verbatim-wrap"><pre class="screen">kvm_stat                    # update in 1 second intervals
kvm_stat -1                 # 1 second snapshot
kvm_stat -l &gt; kvmstats.log  # update in 1 second intervals in log format
                            # can be imported to a spreadsheet</pre></div><div class="example" id="id-1.12.4.5.12.5.6" data-id-title="Typical output of kvm_stat"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 11.1: </span><span class="title-name">Typical output of <code class="command">kvm_stat</code> </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.5.12.5.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_managing.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">kvm statistics

 efer_reload                  0       0
 exits                 11378946  218130
 fpu_reload               62144     152
 halt_exits              414866     100
 halt_wakeup             260358      50
 host_state_reload       539650     249
 hypercalls                   0       0
 insn_emulation         6227331  173067
 insn_emulation_fail          0       0
 invlpg                  227281      47
 io_exits                113148      18
 irq_exits               168474     127
 irq_injections          482804     123
 irq_window               51270      18
 largepages                   0       0
 mmio_exits                6925       0
 mmu_cache_miss           71820      19
 mmu_flooded              35420       9
 mmu_pde_zapped           64763      20
 mmu_pte_updated              0       0
 mmu_pte_write           213782      29
 mmu_recycled                 0       0
 mmu_shadow_zapped       128690      17
 mmu_unsync                  46      -1
 nmi_injections               0       0
 nmi_window                   0       0
 pf_fixed               1553821     857
 pf_guest               1018832     562
 remote_tlb_flush        174007      37
 request_irq                  0       0
 signal_exits                 0       0
 tlb_flush               394182     148</pre></div></div></div><p>
    See
    <a class="link" href="http://clalance.blogspot.com/2009/01/kvm-performance-tools.html" target="_blank">http://clalance.blogspot.com/2009/01/kvm-performance-tools.html</a>
    for further information on how to interpret these values.
   </p></section></section></section><section class="chapter" id="cha-libvirt-connect" data-id-title="Connecting and authorizing"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">12 </span><span class="title-name">Connecting and authorizing</span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-connect">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Managing several VM Host Servers, each hosting multiple VM Guests, quickly
  becomes difficult.  One benefit of <code class="systemitem">libvirt</code> is the ability to connect to
  several VM Host Servers at once, providing a single interface to manage all
  VM Guests and to connect to their graphical console.
 </p><p>
  To ensure only authorized users can connect, <code class="systemitem">libvirt</code> offers
  several connection types (via TLS, SSH, Unix sockets, and TCP) that can be
  combined with different authorization mechanisms (socket, Polkit, SASL
  and Kerberos).
 </p><section class="sect1" id="sec-libvirt-connect-auth" data-id-title="Authentication"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.1 </span><span class="title-name">Authentication</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-auth">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The power to manage VM Guests and to access their graphical console
   is something that should be restricted to a well defined circle
   of persons. To achieve this goal, you can use the following
   authentication techniques on the VM Host Server:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Access control for Unix sockets with permissions and group ownership.
     This method is available for <code class="systemitem">libvirtd</code> connections only.
    </p></li><li class="listitem"><p>
     Access control for Unix sockets with Polkit. This method is available
     for local <code class="systemitem">libvirtd</code> connections only.
    </p></li><li class="listitem"><p>
     User name and password authentication with SASL (Simple Authentication
     and Security Layer). This method is available for both, <code class="systemitem">libvirtd</code>
     and VNC connections. Using SASL does not require real user accounts on
     the server, since it uses its own database to store user names and
     passwords. Connections authenticated with SASL are encrypted.
    </p></li><li class="listitem"><p>
     Kerberos authentication. This method, available for <code class="systemitem">libvirtd</code>
     connections only, is not covered in this manual. Refer to
     <a class="link" href="https://libvirt.org/auth.html#ACL_server_kerberos" target="_blank">https://libvirt.org/auth.html#ACL_server_kerberos</a>
     for details.
    </p></li><li class="listitem"><p>
     Single password authentication. This method is available for VNC
     connections only.
    </p></li></ul></div><div id="id-1.12.4.6.5.4" data-id-title="Authentication for libvirtd and VNC need to be configured separately" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Authentication for <code class="systemitem">libvirtd</code> and VNC need to be configured separately</div><p>
    Access to the VM Guest's management functions (via <code class="systemitem">libvirtd</code>) on
    the one hand, and to its graphical console on the other hand, always
    needs to be configured separately. When restricting access to the
    management tools, these restrictions do <span class="emphasis"><em>not</em></span>
    automatically apply to VNC connections!
   </p></div><p>
   When accessing VM Guests from remote via TLS/SSL connections, access
   can be indirectly controlled on each client by restricting read
   permissions to the certificate's key file to a certain group. See
   <a class="xref" href="#sec-libvirt-connect-remote-tls-security" title="12.3.2.5. Restricting access (security considerations)">Section 12.3.2.5, “Restricting access (security considerations)”</a> for details.
  </p><section class="sect2" id="sec-libvirt-connect-auth-libvirt" data-id-title="libvirtd authentication"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.1.1 </span><span class="title-name"><code class="systemitem">libvirtd</code> authentication</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-auth-libvirt">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="systemitem">libvirtd</code> authentication is configured in
    <code class="filename">/etc/libvirt/libvirtd.conf</code>. The configuration made
    here applies to all <code class="systemitem">libvirt</code> tools such as the Virtual Machine Manager or
    <code class="command">virsh</code>.
   </p><p>
    <code class="systemitem">libvirt</code> offers two sockets: a read-only socket for monitoring
    purposes and a read-write socket to be used for management operations.
    Access to both sockets can be configured independently. By default, both
    sockets are owned by <code class="literal">root.root</code>. Default access
    permissions on the read-write socket are restricted to the user
    <code class="systemitem">root</code> (<code class="literal">0700</code>) and fully open on the read-only
    socket (<code class="literal">0777</code>).
   </p><p>
    In the following instructions, you will learn how to configure access
    permissions for the read-write socket. The same instructions also apply
    to the read-only socket. All configuration steps need to be carried out
    on the VM Host Server.
   </p><div id="id-1.12.4.6.5.6.5" data-id-title="Default authentication settings on SUSE Linux Enterprise Server" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Default authentication settings on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></div><p>
     The default authentication method on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is access control
     for Unix sockets. Only the user <code class="systemitem">root</code> may authenticate. When
     accessing the <code class="systemitem">libvirt</code> tools as a non-root user directly on the
     VM Host Server, you need to provide the <code class="systemitem">root</code> password through
     Polkit once. You are then granted access for the current and for future
     sessions.
    </p><p>
     Alternatively, you can configure <code class="systemitem">libvirt</code> to allow
     <span class="quote">“<span class="quote">system</span>”</span> access to non-privileged users. See
     <a class="xref" href="#sec-libvirt-connect-connecting-dac" title="12.2.1. “system” access for non-privileged users">Section 12.2.1, “<span class="quote">“<span class="quote">system</span>”</span> access for non-privileged users”</a> for details.
    </p></div><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">Recommended authorization methods </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.6.5.6.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.12.4.6.5.6.6.2"><span class="term">Local connections</span></dt><dd><table style="border: 0; " class="simplelist"><tr><td><a class="xref" href="#sec-libvirt-connect-auth-libvirt-pk" title="12.1.1.2. Local access control for Unix sockets with Polkit">Section 12.1.1.2, “Local access control for Unix sockets with Polkit”</a>
       </td></tr><tr><td><a class="xref" href="#sec-libvirt-connect-auth-libvirt-traditional" title="12.1.1.1. Access control for Unix sockets with permissions and group ownership">Section 12.1.1.1, “Access control for Unix sockets with permissions and group ownership”</a>
       </td></tr></table></dd><dt id="id-1.12.4.6.5.6.6.3"><span class="term">Remote tunnel over SSH</span></dt><dd><table style="border: 0; " class="simplelist"><tr><td><a class="xref" href="#sec-libvirt-connect-auth-libvirt-traditional" title="12.1.1.1. Access control for Unix sockets with permissions and group ownership">Section 12.1.1.1, “Access control for Unix sockets with permissions and group ownership”</a>
       </td></tr></table></dd><dt id="id-1.12.4.6.5.6.6.4"><span class="term">Remote TLS/SSL connection</span></dt><dd><table style="border: 0; " class="simplelist"><tr><td><a class="xref" href="#sec-libvirt-connect-auth-libvirt-sasl" title="12.1.1.3. User name and password authentication with SASL">Section 12.1.1.3, “User name and password authentication with SASL”</a>
       </td></tr><tr><td>none (access controlled on the client side by restricting
        access to the certificates)</td></tr></table></dd></dl></div><section class="sect3" id="sec-libvirt-connect-auth-libvirt-traditional" data-id-title="Access control for Unix sockets with permissions and group ownership"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.1.1.1 </span><span class="title-name">Access control for Unix sockets with permissions and group ownership</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-auth-libvirt-traditional">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To grant access for non-<code class="systemitem">root</code> accounts, configure the
     sockets to be owned and accessible by a certain group
     (<code class="systemitem">libvirt</code> in the following
     example). This authentication method can be used for local and remote
     SSH connections.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       In case it does not exist, create the group that should own the
       socket:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> groupadd libvirt</pre></div><div id="id-1.12.4.6.5.6.7.3.1.3" data-id-title="Group needs to exist" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Group needs to exist</div><p>
        The group must exist prior to restarting <code class="systemitem">libvirtd</code>. If not, the
        restart will fail.
       </p></div></li><li class="step"><p>
       Add the desired users to the group:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> usermod --append --groups libvirt tux</pre></div></li><li class="step"><p>
       Change the configuration in
       <code class="filename">/etc/libvirt/libvirtd.conf</code> as follows:
      </p><div class="verbatim-wrap"><pre class="screen">unix_sock_group = "libvirt"<span class="callout" id="co-libvirt-connect-ssh-group">1</span>
unix_sock_rw_perms = "0770"<span class="callout" id="co-libvirt-connect-ssh-perms">2</span>
auth_unix_rw = "none"<span class="callout" id="co-libvirt-connect-ssh-enable">3</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-libvirt-connect-ssh-group"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Group ownership will be set to group <code class="literal">libvirt</code>.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-libvirt-connect-ssh-perms"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Sets the access permissions for the socket
         (<code class="literal">srwxrwx---</code>).
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-libvirt-connect-ssh-enable"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Disables other authentication methods (Polkit or SASL). Access is
         solely controlled by the socket permissions.
        </p></td></tr></table></div></li><li class="step"><p>
       Restart <code class="systemitem">libvirtd</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start libvirtd</pre></div></li></ol></div></div></section><section class="sect3" id="sec-libvirt-connect-auth-libvirt-pk" data-id-title="Local access control for Unix sockets with Polkit"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.1.1.2 </span><span class="title-name">Local access control for Unix sockets with Polkit</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-auth-libvirt-pk">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Access control for Unix sockets with Polkit is the default
     authentication method on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> for non-remote connections.
     Therefore, no <code class="systemitem">libvirt</code> configuration changes are needed. With
     Polkit authorization enabled, permissions on both sockets default to
     <code class="literal">0777</code> and each application trying to access a socket
     needs to authenticate via Polkit.
    </p><div id="id-1.12.4.6.5.6.8.3" data-id-title="Polkit authentication for local connections only" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Polkit authentication for local connections only</div><p>
      Authentication with Polkit can only be used for local connections on
      the VM Host Server itself, since Polkit does not handle remote
      authentication.

     </p></div><p>
     Two policies for accessing <code class="systemitem">libvirt</code>'s sockets exist:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <span class="emphasis"><em>org.libvirt.unix.monitor</em></span>: accessing the
       read-only socket
      </p></li><li class="listitem"><p>
       <span class="emphasis"><em>org.libvirt.unix.manage</em></span>: accessing the
       read-write socket
      </p></li></ul></div><p>
     By default, the policy for accessing the read-write socket is to
     authenticate with the <code class="systemitem">root</code> password once and grant the
     privilege for the current and for future sessions.
    </p><p>
     To grant users access to a socket without having to provide
     the <code class="systemitem">root</code> password, you need to create a rule in
     <code class="filename">/etc/polkit-1/rules.d</code>. Create the file
     <code class="filename">/etc/polkit-1/rules.d/10-grant-libvirt</code> with the
     following content to grant access to the read-write socket to all
     members of the group
     <code class="systemitem">libvirt</code>:
    </p><div class="verbatim-wrap"><pre class="screen">polkit.addRule(function(action, subject) {
  if (action.id == "org.libvirt.unix.manage" &amp;&amp; subject.isInGroup("libvirt")) {
    return polkit.Result.YES;
  }
});</pre></div></section><section class="sect3" id="sec-libvirt-connect-auth-libvirt-sasl" data-id-title="User name and password authentication with SASL"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.1.1.3 </span><span class="title-name">User name and password authentication with SASL</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-auth-libvirt-sasl">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     SASL provides user name and password authentication and data
     encryption (digest-md5, by default). Since SASL maintains its own user
     database, the users do not need to exist on the VM Host Server. SASL is
     required by TCP connections and on top of TLS/SSL connections.
    </p><div id="id-1.12.4.6.5.6.9.3" data-id-title="Plain TCP and SASL with digest-md5 encryption" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Plain TCP and SASL with digest-md5 encryption</div><p>
      Using digest-md5 encryption on an otherwise not encrypted TCP connection
      does not provide enough security for production environments. It is
      recommended to only use it in testing environments.
     </p></div><div id="id-1.12.4.6.5.6.9.4" data-id-title="SASL authentication on top of TLS/SSL" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: SASL authentication on top of TLS/SSL</div><p>
      Access from remote TLS/SSL connections can be indirectly controlled on
      the <span class="emphasis"><em>client side</em></span> by restricting access to the
      certificate's key file. However, this might prove error-prone when
      dealing with many clients. Using SASL with TLS adds
      security by additionally controlling access on the server side.
     </p></div><p>
     To configure SASL authentication, proceed as follows:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Change the configuration in
       <code class="filename">/etc/libvirt/libvirtd.conf</code> as follows:
      </p><ol type="a" class="substeps"><li class="step"><p>
         To enable SASL for TCP connections:
        </p><div class="verbatim-wrap"><pre class="screen">auth_tcp = "sasl"</pre></div></li><li class="step"><p>
         To enable SASL for TLS/SSL connections:
        </p><div class="verbatim-wrap"><pre class="screen">auth_tls = "sasl"</pre></div></li></ol></li><li class="step"><p>
       Restart <code class="systemitem">libvirtd</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart libvirtd</pre></div></li><li class="step"><p>
       The libvirt SASL configuration file is located at
       <code class="filename">/etc/sasl2/libvirtd.conf</code>. Normally, there is no
       need to change the defaults. However, if using SASL on top of TLS,
       you may turn off session encryption to avoid additional overhead (TLS
       connections are already encrypted) by commenting the line setting the
       <code class="literal">mech_list</code> parameter. Only do this for TLS/SASL, for
       TCP connections this parameter must be set to digest-md5.
      </p><div class="verbatim-wrap"><pre class="screen">#mech_list: digest-md5</pre></div></li><li class="step"><p>
       By default, no SASL users are configured, so no logins are possible.
       Use the following commands to manage users:
      </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.6.5.6.9.6.4.2.1"><span class="term">Add the user <code class="systemitem">tux</code></span></dt><dd><div class="verbatim-wrap"><pre class="screen">saslpasswd2 -a libvirt tux</pre></div></dd><dt id="id-1.12.4.6.5.6.9.6.4.2.2"><span class="term">Delete the user <code class="systemitem">tux</code></span></dt><dd><div class="verbatim-wrap"><pre class="screen">saslpasswd2 -a libvirt -d tux</pre></div></dd><dt id="id-1.12.4.6.5.6.9.6.4.2.3"><span class="term">List existing users</span></dt><dd><div class="verbatim-wrap"><pre class="screen">sasldblistusers2 -f /etc/libvirt/passwd.db</pre></div></dd></dl></div></li></ol></div></div><div id="id-1.12.4.6.5.6.9.7" data-id-title="virsh and SASL authentication" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: <code class="command">virsh</code> and SASL authentication</div><p>
      When using SASL authentication, you will be prompted for a user name
      and password every time you issue a <code class="command">virsh</code> command.
      Avoid this by using <code class="command">virsh</code> in shell mode.
     </p></div></section></section><section class="sect2" id="sec-libvirt-connect-auth-vnc" data-id-title="VNC authentication"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.1.2 </span><span class="title-name">VNC authentication</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-auth-vnc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Since access to the graphical console of a VM Guest is not
    controlled by <code class="systemitem">libvirt</code>, but rather by the specific hypervisor, it is
    always necessary to additionally configure VNC authentication. The main
    configuration file is
    <code class="filename">/etc/libvirt/&lt;hypervisor&gt;.conf</code>. This
    section describes the QEMU/KVM hypervisor, so the target
    configuration file is <code class="filename">/etc/libvirt/qemu.conf</code>.
   </p><div id="id-1.12.4.6.5.7.3" data-id-title="VNC authentication for Xen" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: VNC authentication for Xen</div><p>
     In contrast with KVM, Xen does not yet offer VNC authentication more
     sophisticated than setting a password on a per-VM basis. See the
     <code class="literal">&lt;graphics type='vnc'...</code> <code class="systemitem">libvirt</code> configuration
     option below.
    </p></div><p>
    Two authentication types are available: SASL and single-password
    authentication. If you are using SASL for <code class="systemitem">libvirt</code> authentication,
    it is strongly recommended to use it for VNC authentication as
    well—it is possible to share the same database.
   </p><p>
    A third method to restrict access to the VM Guest is to enable the
    use of TLS encryption on the VNC server. This requires the VNC clients
    to have access to x509 client certificates. By restricting access to
    these certificates, access can indirectly be controlled on the client
    side. Refer to
    <a class="xref" href="#sec-libvirt-connect-remote-tls-vnc-client" title="12.3.2.4.2. VNC over TLS/SSL: client configuration">Section 12.3.2.4.2, “VNC over TLS/SSL: client configuration”</a> for details.
   </p><section class="sect3" id="sec-libvirt-connect-auth-vnc-tls" data-id-title="User name and password authentication with SASL"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.1.2.1 </span><span class="title-name">User name and password authentication with SASL</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-auth-vnc-tls">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     SASL provides user name and password authentication and data
     encryption. Since SASL maintains its own user database, the users do
     not need to exist on the VM Host Server. As with SASL authentication for
     <code class="systemitem">libvirt</code>, you may use SASL on top of TLS/SSL connections. Refer to
     <a class="xref" href="#sec-libvirt-connect-remote-tls-vnc-client" title="12.3.2.4.2. VNC over TLS/SSL: client configuration">Section 12.3.2.4.2, “VNC over TLS/SSL: client configuration”</a> for details
     on configuring these connections.
    </p><p>
     To configure SASL authentication for VNC, proceed as follows:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Create a SASL configuration file. It is recommended to use the
       existing <code class="systemitem">libvirt</code> file. If you have already configured SASL for
       <code class="systemitem">libvirt</code> and are planning to use the same settings including the
       same user name and password database, a simple link is suitable:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ln -s /etc/sasl2/libvirt.conf /etc/sasl2/qemu.conf</pre></div><p>
       If are setting up SASL for VNC only or you are planning to use a
       different configuration than for <code class="systemitem">libvirt</code>, copy the existing file
       to use as a template:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> cp /etc/sasl2/libvirt.conf /etc/sasl2/qemu.conf</pre></div><p>
       Then edit it according to your needs.
      </p></li><li class="step"><p>
       Change the configuration in
       <code class="filename">/etc/libvirt/qemu.conf</code> as follows:
      </p><div class="verbatim-wrap"><pre class="screen">vnc_listen = "0.0.0.0"
vnc_sasl = 1
sasldb_path: /etc/libvirt/qemu_passwd.db</pre></div><p>
       The first parameter enables VNC to listen on all public interfaces
       (rather than to the local host only), and the second parameter
       enables SASL authentication.
      </p></li><li class="step"><p>
       By default, no SASL users are configured, so no logins are possible.
       Use the following commands to manage users:
      </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.6.5.7.6.4.3.2.1"><span class="term">Add the user <code class="systemitem">tux</code></span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>saslpasswd2 -f /etc/libvirt/qemu_passwd.db -a qemu tux</pre></div></dd><dt id="id-1.12.4.6.5.7.6.4.3.2.2"><span class="term">Delete the user <code class="systemitem">tux</code></span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>saslpasswd2 -f /etc/libvirt/qemu_passwd.db -a qemu -d tux</pre></div></dd><dt id="id-1.12.4.6.5.7.6.4.3.2.3"><span class="term">List existing users</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>sasldblistusers2 -f /etc/libvirt/qemu_passwd.db</pre></div></dd></dl></div></li><li class="step"><p>
       Restart <code class="systemitem">libvirtd</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart libvirtd</pre></div></li><li class="step"><p>
       Restart all VM Guests that have been running prior to changing
       the configuration. VM Guests that have not been restarted will
       not use SASL authentication for VNC connects.
      </p></li></ol></div></div><div id="id-1.12.4.6.5.7.6.5" data-id-title="Supported VNC viewers" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Supported VNC viewers</div><p>
      SASL authentication is currently supported by Virtual Machine Manager and
      <code class="command">virt-viewer</code>.
      Both of these viewers also support TLS/SSL connections.
     </p></div></section><section class="sect3" id="sec-libvirt-connect-auth-vnc-pw" data-id-title="Single password authentication"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.1.2.2 </span><span class="title-name">Single password authentication</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-auth-vnc-pw">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Access to the VNC server may also be controlled by setting a VNC
     password. You can either set a global password for all VM Guests or
     set individual passwords for each guest. The latter requires to edit
     the VM Guest's configuration files.
    </p><div id="id-1.12.4.6.5.7.7.3" data-id-title="Always set a global password" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Always set a global password</div><p>
      If you are using single password authentication, it is good practice
      to set a global password even if setting passwords for each
      VM Guest. This will always leave your virtual machines protected
      with a <span class="quote">“<span class="quote">fallback</span>”</span> password if you forget to set a
      per-machine password. The global password will only be used if no
      other password is set for the machine.
     </p></div><div class="procedure" id="id-1.12.4.6.5.7.7.4" data-id-title="Setting a global VNC password"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 12.1: </span><span class="title-name">Setting a global VNC password </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.6.5.7.7.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Change the configuration in
       <code class="filename">/etc/libvirt/qemu.conf</code> as follows:
      </p><div class="verbatim-wrap"><pre class="screen">vnc_listen = "0.0.0.0"
vnc_password = "<em class="replaceable">PASSWORD</em>"</pre></div><p>
       The first parameter enables VNC to listen on all public interfaces
       (rather than to the local host only), and the second parameter sets
       the password. The maximum length of the password is eight characters.
      </p></li><li class="step"><p>
       Restart <code class="systemitem">libvirtd</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart libvirtd</pre></div></li><li class="step"><p>
       Restart all VM Guests that have been running prior to changing
       the configuration. VM Guests that have not been restarted will
       not use password authentication for VNC connects.
      </p></li></ol></div></div><div class="procedure" id="id-1.12.4.6.5.7.7.5" data-id-title="Setting a VM Guest specific VNC password"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 12.2: </span><span class="title-name">Setting a VM Guest specific VNC password </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.6.5.7.7.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Change the configuration in
       <code class="filename">/etc/libvirt/qemu.conf</code> as follows to enable VNC
       to listen on all public interfaces (rather than to the local host
       only).
      </p><div class="verbatim-wrap"><pre class="screen">vnc_listen = "0.0.0.0"</pre></div></li><li class="step"><p>
       Open the VM Guest's XML configuration file in an editor. Replace
       <em class="replaceable">VM_NAME</em> in the following example with the
       name of the VM Guest. The editor that is used defaults to
       <code class="envar">$EDITOR</code>. If that variable is not set,
       <code class="command">vi</code> is used.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh edit <em class="replaceable">VM_NAME</em></pre></div></li><li class="step"><p>
       Search for the element <code class="literal">&lt;graphics&gt;</code> with
       the attribute <code class="literal">type='vnc'</code>, for example:
      </p><div class="verbatim-wrap"><pre class="screen">&lt;graphics type='vnc' port='-1' autoport='yes'/&gt;</pre></div></li><li class="step"><p>
       Add the <code class="literal">passwd=<em class="replaceable">PASSWORD</em></code>
       attribute, save the file and exit the editor. The maximum length of
       the password is eight characters.
      </p><div class="verbatim-wrap"><pre class="screen">&lt;graphics type='vnc' port='-1' autoport='yes' passwd='PASSWORD'/&gt;</pre></div></li><li class="step"><p>
       Restart <code class="systemitem">libvirtd</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart libvirtd</pre></div></li><li class="step"><p>
       Restart all VM Guests that have been running prior to changing
       the configuration. VM Guests that have not been restarted will
       not use password authentication for VNC connects.
      </p></li></ol></div></div><div id="id-1.12.4.6.5.7.7.6" data-id-title="Security of the VNC protocol" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Security of the VNC protocol</div><p>
      The VNC protocol is not considered to be safe. Although the password is
      sent encrypted, it might be vulnerable when an attacker can sniff both the
      encrypted password and the encryption key. Therefore, it is recommended to
      use VNC with TLS/SSL or tunneled over SSH.
      <code class="command">virt-viewer</code>, Virtual Machine Manager and Remmina (refer to <span class="intraxref">Book “Administration Guide”, Chapter 10 “Remote graphical sessions with VNC”, Section 10.2 “Remmina: the remote desktop client”</span>) support both methods.
     </p></div></section></section></section><section class="sect1" id="sec-libvirt-connect-connecting" data-id-title="Connecting to a VM Host Server"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.2 </span><span class="title-name">Connecting to a VM Host Server</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-connecting">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To connect to a hypervisor with <code class="systemitem">libvirt</code>, you need to
   specify a uniform resource identifier (URI). This URI is needed with
   <code class="command">virsh</code> and <code class="command">virt-viewer</code> (except when
   working as <code class="systemitem">root</code> on the VM Host Server) and is optional for the
   Virtual Machine Manager. Although the latter can be called with a connection parameter
   (for example, <code class="command">virt-manager -c qemu:///system</code>), it also
   offers a graphical interface to create connection URIs. See
   <a class="xref" href="#sec-libvirt-connect-connecting-vmm" title="12.2.2. Managing connections with Virtual Machine Manager">Section 12.2.2, “Managing connections with Virtual Machine Manager”</a> for details.
  </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">HYPERVISOR</em><span class="callout" id="co-libvirt-connect-hyperv">1</span><em class="replaceable">+PROTOCOL</em><span class="callout" id="co-libvirt-connect-protocol">2</span>://<em class="replaceable">USER@REMOTE</em><span class="callout" id="co-libvirt-connect-remote">3</span>/<em class="replaceable">CONNECTION_TYPE</em><span class="callout" id="co-libvirt-connect-type">4</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-libvirt-connect-hyperv"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Specify the hypervisor. <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> currently supports the
     following hypervisors: <code class="option">test</code> (dummy for testing),
     <code class="option">qemu</code> (KVM), and <code class="option">xen</code> (Xen).
     This parameter is mandatory.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-libvirt-connect-protocol"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     When connecting to a remote host, specify the protocol here. It can be
     one of: <code class="option">ssh</code> (connection via SSH tunnel),
     <code class="option">tcp</code> (TCP connection with SASL/Kerberos
     authentication), <code class="option">tls</code> (TLS/SSL encrypted connection
     with authentication via x509 certificates).
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-libvirt-connect-remote"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     When connecting to a remote host, specify the user name and the remote host
     name. If no user name is specified, the user name that has called the
     command (<code class="envar">$USER</code>) is used. See below for more
     information. For TLS connections, the host name needs to be specified
     exactly as in the x509 certificate.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-libvirt-connect-type"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     When connecting to the <code class="literal">QEMU/KVM</code>
     hypervisor, two connection types are accepted: <code class="option">system</code>
     for full access rights, or <code class="option">session</code> for restricted
     access. Since <code class="option">session</code> access is not supported on
     <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, this documentation focuses on <code class="option">system</code>
     access.
    </p></td></tr></table></div><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">Example hypervisor connection URIs </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.6.6.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.12.4.6.6.5.2"><span class="term"><code class="option">test:///default</code>
    </span></dt><dd><p>
      Connect to the local dummy hypervisor. Useful for testing.
     </p></dd><dt id="id-1.12.4.6.6.5.3"><span class="term"><code class="option">qemu:///system</code> or <code class="option">xen:///system</code>
    </span></dt><dd><p>
      Connect to the QEMU/Xen hypervisor on the local host having
      full access (type system).
     </p></dd><dt id="id-1.12.4.6.6.5.4"><span class="term"><code class="option">qemu+ssh://tux@mercury.example.com/system</code> or
    <code class="option">xen+ssh://tux@mercury.example.com/system</code>
    </span></dt><dd><p>
      Connect to the QEMU/Xen hypervisor on the remote host
      mercury.example.com. The connection is established via an SSH tunnel.
     </p></dd><dt id="id-1.12.4.6.6.5.5"><span class="term"><code class="option">qemu+tls://saturn.example.com/system</code> or <code class="option">xen+tls://saturn.example.com/system</code>
    </span></dt><dd><p>
      Connect to the QEMU/Xen hypervisor on the remote host
      mercury.example.com. The connection is established using TLS/SSL.
     </p></dd></dl></div><p>
   For more details and examples, refer to the <code class="systemitem">libvirt</code> documentation at
   <a class="link" href="https://libvirt.org/uri.html" target="_blank">https://libvirt.org/uri.html</a>.
  </p><div id="id-1.12.4.6.6.7" data-id-title="User names in URIs" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: User names in URIs</div><p>
    A user name needs to be specified when using Unix socket authentication
    (regardless of whether using the user/password authentication scheme or
    Polkit). This applies to all SSH and local connections.
   </p><p>
    There is no need to specify a user name when using SASL authentication
    (for TCP or TLS connections) or when doing no additional server-side
    authentication for TLS connections. With SASL the user name will not be
    evaluated—you will be prompted for an SASL user/password
    combination in any case.
   </p></div><section class="sect2" id="sec-libvirt-connect-connecting-dac" data-id-title="system access for non-privileged users"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.2.1 </span><span class="title-name"><span class="quote">“<span class="quote">system</span>”</span> access for non-privileged users</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-connecting-dac">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As mentioned above, a connection to the QEMU hypervisor can be
    established using two different protocols: <code class="literal">session</code>
    and <code class="literal">system</code>. A <span class="quote">“<span class="quote">session</span>”</span> connection is
    spawned with the same privileges as the client program. Such a
    connection is intended for desktop virtualization, since it is
    restricted (for example no USB/PCI device assignments, no virtual
    network setup, limited remote access to <code class="systemitem">libvirtd</code>).
   </p><p>
    The <span class="quote">“<span class="quote">system</span>”</span> connection intended for server virtualization
    has no functional restrictions but is, by default, only accessible by
    <code class="systemitem">root</code>. However, with the addition of the DAC (Discretionary
    Access Control) driver to <code class="systemitem">libvirt</code> it is now possible to grant
    non-privileged users <span class="quote">“<span class="quote">system</span>”</span> access. To grant
    <span class="quote">“<span class="quote">system</span>”</span> access to the user <code class="systemitem">tux</code>, proceed as
    follows:
   </p><div class="procedure" id="id-1.12.4.6.6.8.4" data-id-title="Granting system access to a regular user"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 12.3: </span><span class="title-name">Granting <span class="quote">“<span class="quote">system</span>”</span> access to a regular user </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.6.6.8.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Enable access via Unix sockets as described in <a class="xref" href="#sec-libvirt-connect-auth-libvirt-traditional" title="12.1.1.1. Access control for Unix sockets with permissions and group ownership">Section 12.1.1.1, “Access control for Unix sockets with permissions and group ownership”</a>. In that
      example access to libvirt is granted to all members of the group
      <code class="systemitem">libvirt</code> and <code class="systemitem">tux</code>
      made a member of this group. This ensures that <code class="systemitem">tux</code> can connect
      using <code class="command">virsh</code> or Virtual Machine Manager.
     </p></li><li class="step"><p>
      Edit <code class="filename">/etc/libvirt/qemu.conf</code> and change the
      configuration as follows:
     </p><div class="verbatim-wrap"><pre class="screen">user = "tux"
group = "libvirt"
dynamic_ownership = 1</pre></div><p>
      This ensures that the VM Guests are started by <code class="systemitem">tux</code> and that
      resources bound to the guest (for example virtual disks) can be accessed
      and modified by <code class="systemitem">tux</code>.
     </p></li><li class="step"><p>
      Make <code class="systemitem">tux</code> a member of the group <code class="systemitem">kvm</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> usermod --append --groups kvm tux</pre></div><p>
      This step is needed to grant access to <code class="filename">/dev/kvm</code>,
      which is required to start VM Guests.
     </p></li><li class="step"><p>
      Restart <code class="systemitem">libvirtd</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart libvirtd</pre></div></li></ol></div></div></section><section class="sect2" id="sec-libvirt-connect-connecting-vmm" data-id-title="Managing connections with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.2.2 </span><span class="title-name">Managing connections with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-connecting-vmm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The Virtual Machine Manager uses a <code class="literal">Connection</code> for every VM Host Server
    it manages. Each connection contains all VM Guests on the respective
    host. By default, a connection to the local host is already configured
    and connected.
   </p><p>
    All configured connections are displayed in the Virtual Machine Manager main window.
    Active connections are marked with a small triangle, which you can click
    to fold or unfold the list of VM Guests for this
    connection.
   </p><p>
    Inactive connections are listed gray and are marked with <code class="literal">Not
    Connected</code>. Either double-click or right-click it and choose
    <span class="guimenu">Connect</span> from the context menu. You can also
    <span class="guimenu">Delete</span> an existing connection from this menu.
   </p><div id="id-1.12.4.6.6.9.5" data-id-title="Editing existing connections" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Editing existing connections</div><p>
     It is not possible to edit an existing connection. To change a
     connection, create a new one with the desired parameters and delete the
     <span class="quote">“<span class="quote">old</span>”</span> one.
    </p></div><p>
    To add a new connection in the Virtual Machine Manager, proceed as follows:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Choose <span class="guimenu">File</span> › <span class="guimenu">Add
      Connection</span>
     </p></li><li class="step"><p>
      Choose the host's <span class="guimenu">Hypervisor</span>
      (<span class="guimenu">Xen</span> or <span class="guimenu">QEMU/KVM</span>)
     </p></li><li class="step"><p><span class="step-optional">(Optional)</span> 
      To set up a remote connection, choose <span class="guimenu">Connect to remote host</span>.
      For more information, see
      <a class="xref" href="#sec-libvirt-connect-remote" title="12.3. Configuring remote connections">Section 12.3, “Configuring remote connections”</a>.
     </p><p>
      In case of a remote connection, specify the
      <span class="guimenu">Hostname</span> of the remote machine in the format
      <code class="literal"><em class="replaceable">USERNAME</em>@<em class="replaceable">REMOTE _HOST</em></code>.
     </p><div id="id-1.12.4.6.6.9.7.3.3" data-id-title="Specifying a user name" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Specifying a user name</div><p>
       There is no need to specify a user name for TCP and TLS connections: In
       these cases, it will not be evaluated. However, in the case of SSH
       connections, specifying a user name is necessary when you want to
       connect as a user other than
       <code class="systemitem">root</code>.
      </p></div></li><li class="step"><p>
      If you do not want the connection to be automatically started when
      starting the Virtual Machine Manager, deactivate <span class="guimenu">Autoconnect</span>.
     </p></li><li class="step"><p>
      Finish the configuration by clicking <span class="guimenu">Connect</span>.
     </p></li></ol></div></div></section></section><section class="sect1" id="sec-libvirt-connect-remote" data-id-title="Configuring remote connections"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.3 </span><span class="title-name">Configuring remote connections</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A major benefit of <code class="systemitem">libvirt</code> is the ability to manage VM Guests on
   different remote hosts from a central location. This section gives
   detailed instructions on how to configure server and client to allow
   remote connections.
  </p><section class="sect2" id="sec-libvirt-connect-remote-ssh" data-id-title="Remote tunnel over SSH (qemu+ssh or xen+ssh)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.3.1 </span><span class="title-name">Remote tunnel over SSH (<code class="literal">qemu+ssh</code> or <code class="literal">xen+ssh</code>)</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-ssh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Enabling a remote connection that is tunneled over SSH on the
    VM Host Server only requires the ability to accept SSH connections. Make
    sure the SSH daemon is started (<code class="command">systemctl status
    sshd</code>) and that the ports for service
    <code class="systemitem">SSH</code> are opened in the firewall.
   </p><p>
    User authentication for SSH connections can be done using traditional
    file user/group ownership and permissions as described in
    <a class="xref" href="#sec-libvirt-connect-auth-libvirt-traditional" title="12.1.1.1. Access control for Unix sockets with permissions and group ownership">Section 12.1.1.1, “Access control for Unix sockets with permissions and group ownership”</a>.
    Connecting as user tux
    (<code class="literal">qemu+ssh://tuxsIVname;/system</code> or
    <code class="literal">xen+ssh://tuxsIVname;/system</code>) works out
    of the box and does not require additional configuration on the
    <code class="systemitem">libvirt</code> side.
   </p><p>
    When connecting via SSH
    <code class="literal">qemu+ssh://<em class="replaceable">USER</em>@<em class="replaceable">SYSTEM</em></code>
    or
    <code class="literal">xen+ssh://<em class="replaceable">USER</em>@<em class="replaceable">SYSTEM</em></code>
    you need to provide the password for <em class="replaceable">USER</em>.
    This can be avoided by copying your public key to
    <code class="filename">~<em class="replaceable">USER</em>/.ssh/authorized_keys</code>
    on the VM Host Server as explained in
    <span class="intraxref">Book “Security and Hardening Guide”, Chapter 22 “Securing network operations with OpenSSH”, Section 22.6 “Public key authentication”</span>. Using
    <code class="command">gnome-keyring</code> on the
    machine from which you are connecting adds even more
    convenience. For more information, see
    <span class="intraxref">Book “Security and Hardening Guide”, Chapter 22 “Securing network operations with OpenSSH”, Section 22.9 “Automated public key logins with gnome-keyring”</span>.
   </p></section><section class="sect2" id="sec-libvirt-connect-remote-tls" data-id-title="Remote TLS/SSL connection with x509 certificate (qemu+tls or xen+tls)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.3.2 </span><span class="title-name">Remote TLS/SSL connection with x509 certificate (<code class="literal">qemu+tls</code> or <code class="literal">xen+tls</code>)</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Using TCP connections with TLS/SSL encryption and authentication via
    x509 certificates is much more complicated to set up than SSH, but it is
    a lot more scalable. Use this method if you need to manage several
    VM Host Servers with a varying number of administrators.
   </p><section class="sect3" id="sec-libvirt-connect-remote-tls-concept" data-id-title="Basic concept"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.3.2.1 </span><span class="title-name">Basic concept</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-concept">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     TLS (Transport Layer Security) encrypts the communication between two
     computers by using certificates. The computer starting the connection
     is always considered the <span class="quote">“<span class="quote">client</span>”</span>, using a <span class="quote">“<span class="quote">client
     certificate</span>”</span>, while the receiving computer is always considered
     the <span class="quote">“<span class="quote">server</span>”</span>, using a <span class="quote">“<span class="quote">server certificate</span>”</span>.
     This scenario applies, for example, if you manage your VM Host Servers
     from a central desktop.
    </p><p>
     If connections are initiated from both computers, each needs to have a
     client <span class="emphasis"><em>and</em></span> a server certificate. This is the case,
     for example, if you migrate a VM Guest from one host to another.
    </p><p>
     Each x509 certificate has a matching private key file. Only the
     combination of certificate and private key file can identify
     itself correctly. To assure that a certificate was issued by
     the assumed owner, it is signed and issued by a central certificate
     called certificate authority (CA). Both the client and the server
     certificates must be issued by the same CA.
    </p><div id="id-1.12.4.6.7.4.3.5" data-id-title="User authentication" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: User authentication</div><p>
      Using a remote TLS/SSL connection only ensures that two computers are
      allowed to communicate in a certain direction. Restricting access to
      certain users can indirectly be achieved on the client side by
      restricting access to the certificates. For more information, see
      <a class="xref" href="#sec-libvirt-connect-remote-tls-security" title="12.3.2.5. Restricting access (security considerations)">Section 12.3.2.5, “Restricting access (security considerations)”</a>.
     </p><p>
      <code class="systemitem">libvirt</code> also supports user authentication on the server with
      SASL. For more information, see
      <a class="xref" href="#sec-libvirt-connect-remote-tls-sasl" title="12.3.2.6. Central user authentication with SASL for TLS sockets">Section 12.3.2.6, “Central user authentication with SASL for TLS sockets”</a>.
     </p></div></section><section class="sect3" id="sec-libvirt-connect-remote-tls-server" data-id-title="Configuring the VM Host Server"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.3.2.2 </span><span class="title-name">Configuring the VM Host Server</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-server">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The VM Host Server is the machine receiving connections. Therefore, the
     <span class="emphasis"><em>server</em></span> certificates need to be installed. The CA
     certificate needs to be installed, too. When the certificates are
     in place, TLS support can be turned on for <code class="systemitem">libvirt</code>.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Create the server certificate and export it together with the
       respective CA certificate.
      </p></li><li class="step"><p>
       Create the following directories on the VM Host Server:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mkdir -p /etc/pki/CA/ /etc/pki/libvirt/private/</pre></div><p>
       Install the certificates as follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> /etc/pki/CA/cacert.pem
<code class="prompt user">&gt; </code><code class="command">sudo</code> /etc/pki/libvirt/servercert.pem
<code class="prompt user">&gt; </code><code class="command">sudo</code> /etc/pki/libvirt/private/serverkey.pem</pre></div><div id="id-1.12.4.6.7.4.4.3.2.5" data-id-title="Restrict access to certificates" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Restrict access to certificates</div><p>
        Make sure to restrict access to certificates as explained in
        <a class="xref" href="#sec-libvirt-connect-remote-tls-security" title="12.3.2.5. Restricting access (security considerations)">Section 12.3.2.5, “Restricting access (security considerations)”</a>.
       </p></div></li><li class="step"><p>
       Enable TLS support by enabling the relevant socket and restarting
       <code class="systemitem">libvirtd</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl stop libvirtd.service
<code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable --now libvirtd-tls.socket
<code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start libvirtd.service</pre></div></li><li class="step"><p>
       By default, <code class="systemitem">libvirt</code> uses the TCP port 16514 for accepting secure
       TLS connections. Open this port in the firewall.
      </p></li></ol></div></div><div id="id-1.12.4.6.7.4.4.4" data-id-title="Restarting libvirtd with TLS enabled" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Restarting <code class="systemitem">libvirtd</code> with TLS enabled</div><p>
      If you enable TLS for <code class="systemitem">libvirt</code>, the server certificates need to be
      in place, otherwise restarting <code class="systemitem">libvirtd</code> will fail. You also need
      to restart <code class="systemitem">libvirtd</code> in case you change the certificates.
     </p></div></section><section class="sect3" id="sec-libvirt-connect-remote-tls-client" data-id-title="Configuring the client and testing the setup"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.3.2.3 </span><span class="title-name">Configuring the client and testing the setup</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-client">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The client is the machine initiating connections. Therefore the
     <span class="emphasis"><em>client</em></span> certificates need to be installed. The CA
     certificate needs to be installed, too.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Create the client certificate and export it together with the
       respective CA certificate.
      </p></li><li class="step"><p>
       Create the following directories on the client:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mkdir -p /etc/pki/CA/ /etc/pki/libvirt/private/</pre></div><p>
       Install the certificates as follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> /etc/pki/CA/cacert.pem
<code class="prompt user">&gt; </code><code class="command">sudo</code> /etc/pki/libvirt/clientcert.pem
<code class="prompt user">&gt; </code><code class="command">sudo</code> /etc/pki/libvirt/private/clientkey.pem</pre></div><div id="id-1.12.4.6.7.4.5.3.2.5" data-id-title="Restrict access to certificates" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Restrict access to certificates</div><p>
        Make sure to restrict access to certificates as explained in
        <a class="xref" href="#sec-libvirt-connect-remote-tls-security" title="12.3.2.5. Restricting access (security considerations)">Section 12.3.2.5, “Restricting access (security considerations)”</a>.
       </p></div></li><li class="step"><p>
       Test the client/server setup by issuing the following command.
       Replace <em class="replaceable">mercury.example.com</em> with the name of
       your VM Host Server. Specify the same fully qualified host name as used
       when creating the server certificate.
      </p><div class="verbatim-wrap"><pre class="screen">#QEMU/KVM
virsh -c qemu+tls://<em class="replaceable">mercury.example.com</em>/system list --all

#Xen
virsh -c xen+tls://<em class="replaceable">mercury.example.com</em>/system list --all</pre></div><p>
       If your setup is correct, you will see a list of all VM Guests
       registered with <code class="systemitem">libvirt</code> on the VM Host Server.
      </p></li></ol></div></div></section><section class="sect3" id="sec-libvirt-connect-remote-tls-vnc" data-id-title="Enabling VNC for TLS/SSL connections"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.3.2.4 </span><span class="title-name">Enabling VNC for TLS/SSL connections</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-vnc">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Currently, VNC communication over TLS is only supported by a few tools.
     Common VNC viewers such as <code class="command">tightvnc</code> or
     <code class="command">tigervnc</code> do not support TLS/SSL. The only supported
     alternative to Virtual Machine Manager and <code class="command">virt-viewer</code> is
     <code class="command">remmina</code> (refer to <span class="intraxref">Book “Administration Guide”, Chapter 10 “Remote graphical sessions with VNC”, Section 10.2 “Remmina: the remote desktop client”</span>).
    </p><section class="sect4" id="sec-libvirt-connect-remote-tls-vnc-server" data-id-title="VNC over TLS/SSL: VM Host Server configuration"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">12.3.2.4.1 </span><span class="title-name">VNC over TLS/SSL: VM Host Server configuration</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-vnc-server">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To access the graphical console via VNC over TLS/SSL, you
      need to configure the VM Host Server as follows:
     </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Open ports for the service
        <code class="systemitem">VNC</code> in your firewall.
       </p></li><li class="step"><p>
        Create a directory <code class="filename">/etc/pki/libvirt-vnc</code> and
        link the certificates into this directory as follows:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mkdir -p /etc/pki/libvirt-vnc &amp;&amp; cd /etc/pki/libvirt-vnc
<code class="prompt user">&gt; </code><code class="command">sudo</code> ln -s /etc/pki/CA/cacert.pem ca-cert.pem
<code class="prompt user">&gt; </code><code class="command">sudo</code> ln -s /etc/pki/libvirt/servercert.pem server-cert.pem
<code class="prompt user">&gt; </code><code class="command">sudo</code> ln -s /etc/pki/libvirt/private/serverkey.pem server-key.pem</pre></div></li><li class="step"><p>
        Edit <code class="filename">/etc/libvirt/qemu.conf</code> and set the
        following parameters:
       </p><div class="verbatim-wrap"><pre class="screen">vnc_listen = "0.0.0.0"
        vnc_tls = 1
        vnc_tls_x509_verify = 1</pre></div></li><li class="step"><p>
        Restart the <code class="systemitem">libvirtd</code>:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart libvirtd</pre></div><div id="id-1.12.4.6.7.4.6.3.3.4.3" data-id-title="VM Guests need to be restarted" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: VM Guests need to be restarted</div><p>
         The VNC TLS setting is only set when starting a VM Guest.
         Therefore, you need to restart all machines that have been running
         prior to making the configuration change.
        </p></div></li></ol></div></div></section><section class="sect4" id="sec-libvirt-connect-remote-tls-vnc-client" data-id-title="VNC over TLS/SSL: client configuration"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">12.3.2.4.2 </span><span class="title-name">VNC over TLS/SSL: client configuration</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-vnc-client">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      The only action needed on the client side is to place the x509 client
      certificates in a location recognized by the client of choice.
      Unfortunately, Virtual Machine Manager and <code class="command">virt-viewer</code> expect the
      certificates in a different location. Virtual Machine Manager can either read from a
      system-wide location applying to all users, or from a per-user location.
      Remmina (refer to <span class="intraxref">Book “Administration Guide”, Chapter 10 “Remote graphical sessions with VNC”, Section 10.2 “Remmina: the remote desktop client”</span>) asks for the location of
      certificates when initializing the connection to the remote VNC session.
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.6.7.4.6.4.3.1"><span class="term"><span class="bold"><strong>
         Virtual Machine Manager (<code class="command">virt-manager</code>)
        </strong></span>
       </span></dt><dd><p>
         To connect to the remote host, Virtual Machine Manager requires the setup explained in
         <a class="xref" href="#sec-libvirt-connect-remote-tls-client" title="12.3.2.3. Configuring the client and testing the setup">Section 12.3.2.3, “Configuring the client and testing the setup”</a>. To be able
         to connect via VNC, the client certificates also need to be placed in
         the following locations:
        </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.6.7.4.6.4.3.1.2.2.1"><span class="term">System-wide location</span></dt><dd><table style="border: 0; " class="simplelist"><tr><td><code class="filename">/etc/pki/CA/cacert.pem</code>
            </td></tr><tr><td><code class="filename">/etc/pki/libvirt-vnc/clientcert.pem</code>
            </td></tr><tr><td><code class="filename">/etc/pki/libvirt-vnc/private/clientkey.pem</code>
            </td></tr></table></dd><dt id="id-1.12.4.6.7.4.6.4.3.1.2.2.2"><span class="term">Per-user location</span></dt><dd><table style="border: 0; " class="simplelist"><tr><td><code class="filename">/etc/pki/CA/cacert.pem</code>
            </td></tr><tr><td><code class="filename">~/.pki/libvirt-vnc/clientcert.pem</code>
            </td></tr><tr><td><code class="filename">~/.pki/libvirt-vnc/private/clientkey.pem</code>
            </td></tr></table></dd></dl></div></dd><dt id="id-1.12.4.6.7.4.6.4.3.2"><span class="term"><span class="bold"><strong><code class="command">virt-viewer</code></strong></span>
       </span></dt><dd><p>
         <code class="command">virt-viewer</code> only accepts certificates from a
         system-wide location:
        </p><table style="border: 0; " class="simplelist"><tr><td><code class="filename">/etc/pki/CA/cacert.pem</code>
         </td></tr><tr><td><code class="filename">/etc/pki/libvirt-vnc/clientcert.pem</code>
         </td></tr><tr><td><code class="filename">/etc/pki/libvirt-vnc/private/clientkey.pem</code>
         </td></tr></table></dd></dl></div><div id="id-1.12.4.6.7.4.6.4.4" data-id-title="Restrict access to certificates" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Restrict access to certificates</div><p>
       Make sure to restrict access to certificates as explained in
       <a class="xref" href="#sec-libvirt-connect-remote-tls-security" title="12.3.2.5. Restricting access (security considerations)">Section 12.3.2.5, “Restricting access (security considerations)”</a>.
      </p></div></section></section><section class="sect3" id="sec-libvirt-connect-remote-tls-security" data-id-title="Restricting access (security considerations)"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.3.2.5 </span><span class="title-name">Restricting access (security considerations)</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-security">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Each x509 certificate consists of two pieces: the public certificate
     and a private key. A client can only authenticate using both pieces.
     Therefore, any user that has read access to the client certificate and
     its private key can access your VM Host Server. On the other hand, an
     arbitrary machine equipped with the full server certificate can pretend
     to be the VM Host Server. Since this is probably not desirable, access to
     at least the private key files needs to be restricted as much as
     possible. The easiest way to control access to a key file is to use
     access permissions.
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.6.7.4.7.3.1"><span class="term"><span class="bold"><strong>Server certificates</strong></span>
      </span></dt><dd><p>
        Server certificates need to be readable for QEMU processes. On
        <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> QEMU, processes started from <code class="systemitem">libvirt</code> tools
        are owned by <code class="systemitem">root</code>, so it is sufficient if the <code class="systemitem">root</code> can
        read the certificates:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>chmod 700 /etc/pki/libvirt/private/
<code class="prompt user">&gt; </code>chmod 600 /etc/pki/libvirt/private/serverkey.pem</pre></div><p>
        If you change the ownership for QEMU processes in
        <code class="filename">/etc/libvirt/qemu.conf</code>, you also need to adjust
        the ownership of the key file.
       </p></dd><dt id="id-1.12.4.6.7.4.7.3.2"><span class="term"><span class="bold"><strong>System-wide client certificates</strong></span>
      </span></dt><dd><p>
        To control access to a key file that is available system-wide,
        restrict read access to a certain group, so that only members of
        that group can read the key file. In the following example, a group
        <code class="systemitem">libvirt</code> is created, and
        group ownership of the <code class="filename">clientkey.pem</code> file and
        its parent directory is set to
        <code class="systemitem">libvirt</code>. Afterward, the
        access permissions are restricted to owner and group. Finally the
        user <code class="systemitem">tux</code> is added to the group
        <code class="systemitem">libvirt</code>, and thus can
        access the key file.
       </p><div class="verbatim-wrap"><pre class="screen">CERTPATH="/etc/pki/libvirt/"
# create group libvirt
groupadd libvirt
# change ownership to user root and group libvirt
chown root.libvirt $CERTPATH/private $CERTPATH/clientkey.pem
# restrict permissions
chmod 750 $CERTPATH/private
chmod 640 $CERTPATH/private/clientkey.pem
# add user tux to group libvirt
usermod --append --groups libvirt tux</pre></div></dd><dt id="id-1.12.4.6.7.4.7.3.3"><span class="term"><span class="bold"><strong>Per-user certificates</strong></span>
      </span></dt><dd><p>
        User-specific client certificates for accessing the graphical
        console of a VM Guest via VNC need to be placed in the user's
        home directory in <code class="filename">~/.pki</code>. Contrary to SSH, for
        example, the VNC viewer using these certificates do not check the
        access permissions of the private key file. Therefore, it is solely
        the user's responsibility to make sure the key file is not readable
        by others.
       </p></dd></dl></div><section class="sect4" id="sec-libvirt-connect-remote-tls-server-restrict" data-id-title="Restricting access from the server side"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">12.3.2.5.1 </span><span class="title-name">Restricting access from the server side</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-server-restrict">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      By default, every client that is equipped with appropriate client
      certificates may connect to a VM Host Server accepting TLS connections.
      Therefore, it is possible to use additional server-side authentication
      with SASL as described in
      <a class="xref" href="#sec-libvirt-connect-auth-libvirt-sasl" title="12.1.1.3. User name and password authentication with SASL">Section 12.1.1.3, “User name and password authentication with SASL”</a>.
     </p><p>
      It is also possible to restrict access with a whitelist of DNs
      (distinguished names), so only clients with a certificate matching a
      DN from the list can connect.
     </p><p>
      Add a list of allowed DNs to <code class="literal">tls_allowed_dn_list</code> in
      <code class="filename">/etc/libvirt/libvirtd.conf</code>. This list may contain
      wild cards. Do not specify an empty list, since that would result in
      refusing all connections.
     </p><div class="verbatim-wrap"><pre class="screen">tls_allowed_dn_list = [
   "C=US,L=Provo,O=SUSE Linux Products GmbH,OU=*,CN=venus.example.com,EMAIL=*",
   "C=DE,L=Nuremberg,O=SUSE Linux Products GmbH,OU=Documentation,CN=*"]</pre></div><p>
      Get the distinguished name of a certificate with the following
      command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>certtool -i --infile /etc/pki/libvirt/clientcert.pem | grep "Subject:"</pre></div><p>
      Restart <code class="systemitem">libvirtd</code> after having changed the configuration:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart libvirtd</pre></div></section></section><section class="sect3" id="sec-libvirt-connect-remote-tls-sasl" data-id-title="Central user authentication with SASL for TLS sockets"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.3.2.6 </span><span class="title-name">Central user authentication with SASL for TLS sockets</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-sasl">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     A direct user authentication via TLS is not possible—this is
     handled indirectly on each client via the read permissions for the
     certificates as explained in
     <a class="xref" href="#sec-libvirt-connect-remote-tls-security" title="12.3.2.5. Restricting access (security considerations)">Section 12.3.2.5, “Restricting access (security considerations)”</a>. However, if
     a central, server-based user authentication is needed, <code class="systemitem">libvirt</code>
     also allows to use SASL (Simple Authentication and Security Layer) on
     top of TLS for direct user authentication. See
     <a class="xref" href="#sec-libvirt-connect-auth-libvirt-sasl" title="12.1.1.3. User name and password authentication with SASL">Section 12.1.1.3, “User name and password authentication with SASL”</a> for
     configuration details.
    </p></section><section class="sect3" id="sec-libvirt-connect-remote-tls-troubleshoot" data-id-title="Troubleshooting"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">12.3.2.7 </span><span class="title-name">Troubleshooting</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-troubleshoot">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect4" id="sec-libvirt-connect-remote-tls-troubleshoot-no-connect" data-id-title="Virtual Machine Manager/virsh cannot connect to server"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">12.3.2.7.1 </span><span class="title-name">Virtual Machine Manager/<code class="command">virsh</code> cannot connect to server</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-troubleshoot-no-connect">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Check the following in the given order:
     </p><table style="border: 0; " class="simplelist"><tr><td>Is it a firewall issue (TCP port 16514 needs to be open on the
       server)?</td></tr><tr><td>Is the client certificate (certificate and key) readable by the
       user that has started
       Virtual Machine Manager/<code class="command">virsh</code>?
      </td></tr><tr><td>Has the same full qualified host name as in the server
       certificate been specified with the connection?</td></tr><tr><td>Is TLS enabled on the server (<code class="literal">listen_tls =
        1</code>)?</td></tr><tr><td>Has <code class="systemitem">libvirtd</code> been
       restarted on the server?</td></tr></table></section><section class="sect4" id="sec-libvirt-connect-remote-tls-troubleshoot-vnc" data-id-title="VNC connection fails"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">12.3.2.7.2 </span><span class="title-name">VNC connection fails</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-connect-remote-tls-troubleshoot-vnc">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_connect.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Ensure that you can connect to the remote server using Virtual Machine Manager. If
      so, check whether the virtual machine on the server has been started
      with TLS support. The virtual machine's name in the following example
      is <code class="literal">sles</code>.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ps ax | grep qemu | grep "\-name sles" | awk -F" -vnc " '{ print FS $2 }'</pre></div><p>
      If the output does not begin with a string similar to the following,
      the machine has not been started with TLS support and must be
      restarted.
     </p><div class="verbatim-wrap"><pre class="screen"> -vnc 0.0.0.0:0,tls,x509verify=/etc/pki/libvirt</pre></div></section></section></section></section></section><section class="chapter" id="cha-libvirt-storage" data-id-title="Advanced storage topics"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">13 </span><span class="title-name">Advanced storage topics</span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-storage">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This chapter introduces advanced topics about manipulating storage from the
  perspective of the VM Host Server.
 </p><section class="sect1" id="sec-libvirt-storage-locking" data-id-title="Locking disk files and block devices with virtlockd"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.1 </span><span class="title-name">Locking disk files and block devices with <code class="systemitem">virtlockd</code></span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-locking">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Locking block devices and disk files prevents concurrent writes to these
   resources from different VM Guests. It provides protection against starting
   the same VM Guest twice, or adding the same disk to two different virtual
   machines. This will reduce the risk of a virtual machine's disk image
   becoming corrupted because of a wrong configuration.
  </p><p>
   The locking is controlled by a daemon called
   <code class="systemitem">virtlockd</code>. Since it operates
   independently from the <code class="systemitem">libvirtd</code> daemon, locks will endure a crash or a
   restart of <code class="systemitem">libvirtd</code>. Locks will even persist in the case of an update of
   the <code class="systemitem">virtlockd</code> itself, since it can
   re-execute itself. This ensures that VM Guests do <span class="emphasis"><em>not</em></span>
   need to be restarted upon a
   <code class="systemitem">virtlockd</code> update.
   <code class="systemitem">virtlockd</code> is supported for KVM,
   QEMU, and Xen.
  </p><section class="sect2" id="sec-libvirt-storage-locking-enable" data-id-title="Enable locking"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.1.1 </span><span class="title-name">Enable locking</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-locking-enable">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Locking virtual disks is not enabled by default on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. To enable
    and automatically start it upon rebooting, perform the following steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Edit <code class="filename">/etc/libvirt/qemu.conf</code> and set
     </p><div class="verbatim-wrap"><pre class="screen">lock_manager = "lockd"</pre></div></li><li class="step"><p>
      Start the <code class="systemitem">virtlockd</code> daemon with
      the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start virtlockd</pre></div></li><li class="step"><p>
      Restart the <code class="systemitem">libvirtd</code> daemon with:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart libvirtd</pre></div></li><li class="step"><p>
      Make sure <code class="systemitem">virtlockd</code> is
      automatically started when booting the system:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable virtlockd</pre></div></li></ol></div></div></section><section class="sect2" id="sec-libvirt-storage-locking-configure" data-id-title="Configure locking"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.1.2 </span><span class="title-name">Configure locking</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-locking-configure">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    By default <code class="systemitem">virtlockd</code> is configured
    to automatically lock all disks configured for your VM Guests. The default
    setting uses a "direct" lockspace, where the locks are acquired against the
    actual file paths associated with the VM Guest &lt;disk&gt; devices. For
    example, <code class="literal">flock(2)</code> will be called directly on
    <code class="filename">/var/lib/libvirt/images/my-server/disk0.raw</code> when the
    VM Guest contains the following &lt;disk&gt; device:
   </p><div class="verbatim-wrap"><pre class="screen">&lt;disk type='file' device='disk'&gt;
 &lt;driver name='qemu' type='raw'/&gt;
 &lt;source file='/var/lib/libvirt/images/my-server/disk0.raw'/&gt;
 &lt;target dev='vda' bus='virtio'/&gt;
&lt;/disk&gt;</pre></div><p>
    The <code class="systemitem">virtlockd</code> configuration can be
    changed by editing the file
    <code class="filename">/etc/libvirt/qemu-lockd.conf</code>. It also contains
    detailed comments with further information. Make sure to activate
    configuration changes by reloading
    <code class="systemitem">virtlockd</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl reload virtlockd</pre></div><section class="sect3" id="sec-libvirt-storage-locking-configure-shared-fs" data-id-title="Enabling an indirect lockspace"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">13.1.2.1 </span><span class="title-name">Enabling an indirect lockspace</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-locking-configure-shared-fs">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The default configuration of
     <code class="systemitem">virtlockd</code> uses a
     <span class="quote">“<span class="quote">direct</span>”</span> lockspace. This means that the locks are acquired
     against the actual file paths associated with the &lt;disk&gt; devices.
    </p><p>
     If the disk file paths are not accessible to all hosts,
     <code class="systemitem">virtlockd</code> can be configured to
     allow an <span class="quote">“<span class="quote">indirect</span>”</span> lockspace. This means that a hash of the
     disk file path is used to create a file in the indirect lockspace
     directory. The locks are then held on these hash files instead of the
     actual disk file paths. Indirect lockspace is also useful if the file
     system containing the disk files does not support
     <code class="literal">fcntl()</code> locks. An indirect lockspace is specified with
     the <code class="option">file_lockspace_dir</code> setting:
    </p><div class="verbatim-wrap"><pre class="screen">file_lockspace_dir = "<em class="replaceable">/MY_LOCKSPACE_DIRECTORY</em>"</pre></div></section><section class="sect3" id="sec-libvirt-storage-locking-configure-lvm-iscsi" data-id-title="Enable locking on LVM or iSCSI volumes"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">13.1.2.2 </span><span class="title-name">Enable locking on LVM or iSCSI volumes</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-locking-configure-lvm-iscsi">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     When wanting to lock virtual disks placed on LVM or iSCSI volumes shared
     by several hosts, locking needs to be done by UUID rather than by path
     (which is used by default). Furthermore, the lockspace directory needs to
     be placed on a shared file system accessible by all hosts sharing the
     volume. Set the following options for LVM and/or iSCSI:
    </p><div class="verbatim-wrap"><pre class="screen">lvm_lockspace_dir = "<em class="replaceable">/MY_LOCKSPACE_DIRECTORY</em>"
iscsi_lockspace_dir = "<em class="replaceable">/MY_LOCKSPACE_DIRECTORY</em>"</pre></div></section></section></section><section class="sect1" id="sec-libvirt-storage-resize" data-id-title="Online resizing of guest block devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.2 </span><span class="title-name">Online resizing of guest block devices</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-resize">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Sometimes you need to change—extend or shrink—the size of the
   block device used by your guest system. For example, when the disk space
   originally allocated is no longer enough, it is time to increase its size.
   If the guest disk resides on a <span class="emphasis"><em>logical volume</em></span>, you can
   resize it while the guest system is running. This is a big advantage over an
   offline disk resizing (see the <code class="command">virt-resize</code> command from
   the <a class="xref" href="#sec-guestfs-tools" title="20.3. Guestfs tools">Section 20.3, “Guestfs tools”</a> package) as the service provided by
   the guest is not interrupted by the resizing process. To resize a VM Guest
   disk, follow these steps:
  </p><div class="procedure" id="id-1.12.4.7.5.3" data-id-title="Online resizing of guest disk"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 13.1: </span><span class="title-name">Online resizing of guest disk </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.7.5.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Inside the guest system, check the current size of the disk (for example
     <code class="filename">/dev/vda</code>).
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>fdisk -l /dev/vda
Disk /dev/sda: 160.0 GB, 160041885696 bytes, 312581808 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes</pre></div></li><li class="step"><p>
     On the host, resize the logical volume holding the
     <code class="filename">/dev/vda</code> disk of the guest to the required size, for
     example 200 GB.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>lvresize -L 200G /dev/mapper/vg00-home
Extending logical volume home to 200 GiB
Logical volume home successfully resized</pre></div></li><li class="step"><p>
     On the host, resize the block device related to the disk
     <code class="filename">/dev/mapper/vg00-home</code> of the guest. Note that you can
     find the <em class="replaceable">DOMAIN_ID</em> with <code class="command">virsh
     list</code>.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh blockresize  --path /dev/vg00/home --size 200G <em class="replaceable">DOMAIN_ID</em>
Block device '/dev/vg00/home' is resized</pre></div></li><li class="step"><p>
     Check that the new disk size is accepted by the guest.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>fdisk -l /dev/vda
Disk /dev/sda: 200.0 GB, 200052357120 bytes, 390727260 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes</pre></div></li></ol></div></div></section><section class="sect1" id="sec-libvirt-storage-share" data-id-title="Sharing directories between host and guests (file system pass-through)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.3 </span><span class="title-name">Sharing directories between host and guests (file system pass-through)</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-storage-share">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   libvirt allows to share directories between host and guests using QEMU's
   file system pass-through (also called VirtFS) feature. Such a directory can
   be also be accessed by several VM Guests at once and therefore be used to
   exchange files between VM Guests.
  </p><div id="id-1.12.4.7.6.3" data-id-title="Windows guests and file system pass-through" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Windows guests and file system pass-through</div><p>
    Note that sharing directories between VM Host Server and Windows guests via File
    System Pass-Through does not work, because Windows lacks the drivers
    required to mount the shared directory.
   </p></div><p>
   To make a shared directory available on a VM Guest, proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Open the guest's console in Virtual Machine Manager and either choose
     <span class="guimenu">View</span> › <span class="guimenu">Details</span> from the menu or click
     <span class="guimenu">Show virtual hardware details</span> in the toolbar. Choose
     <span class="guimenu">Add Hardware</span> › <span class="guimenu">Filesystem</span> to open the <span class="guimenu">Filesystem Passthrough</span>
     dialog.
    </p></li><li class="step"><p>
     <span class="guimenu">Driver</span> allows you to choose between a
     <span class="guimenu">Handle</span> or <span class="guimenu">Path</span> base driver. The
     default setting is <span class="guimenu">Path</span>. <span class="guimenu">Mode</span> lets
     you choose the security model, which influences the way file permissions
     are set on the host. Three options are available:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.7.6.5.2.2.1"><span class="term"><span class="guimenu">Passthrough</span> (default)</span></dt><dd><p>
        Files on the file system are directly created with the client-user's
        credentials. This is very similar to what NFSv3 is using.
       </p></dd><dt id="id-1.12.4.7.6.5.2.2.2"><span class="term"><span class="guimenu">Squash</span></span></dt><dd><p>
        Same as <span class="guimenu">Passthrough</span>, but failure of privileged
        operations like <code class="command">chown</code> are ignored. This is required
        when KVM is not run with
        <code class="systemitem">root</code> privileges.
       </p></dd><dt id="id-1.12.4.7.6.5.2.2.3"><span class="term"><span class="guimenu">Mapped</span></span></dt><dd><p>
        Files are created with the file server's credentials
        (<code class="literal">qemu.qemu</code>). The user credentials and the
        client-user's credentials are saved in extended attributes. This model
        is recommended when host and guest domains should be kept completely
        isolated.
       </p></dd></dl></div></li><li class="step"><p>
     Specify the path to the directory on the VM Host Server with <span class="guimenu">Source
     Path</span>. Enter a string at <span class="guimenu">Target Path</span> that will
     be used as a tag to mount the shared directory. Note that the string of
     this field is a tag only, not a path on the VM Guest.
    </p></li><li class="step"><p>
     <span class="guimenu">Apply</span> the setting. If the VM Guest is currently
     running, you need to shut it down to apply the new setting (rebooting the
     guest is not sufficient).
    </p></li><li class="step"><p>
     Boot the VM Guest. To mount the shared directory, enter the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mount -t 9p -o trans=virtio,version=9p2000.L,rw <em class="replaceable">TAG</em> /<em class="replaceable">MOUNT_POINT</em></pre></div><p>
     To make the shared directory permanently available, add the following line
     to the <code class="filename">/etc/fstab</code> file:
    </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">TAG</em>   /<em class="replaceable">MOUNT_POINT</em>    9p  trans=virtio,version=9p2000.L,rw    0   0</pre></div></li></ol></div></div></section><section class="sect1" id="libvirt-storage-rbd" data-id-title="Using RADOS block devices with libvirt"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.4 </span><span class="title-name">Using RADOS block devices with <code class="systemitem">libvirt</code></span></span> <a title="Permalink" class="permalink" href="#libvirt-storage-rbd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   RADOS Block Devices (RBD) store data in a Ceph cluster. They allow
   snapshotting, replication, and data consistency. You can use an RBD from
   your <code class="systemitem">libvirt</code>-managed VM Guests similarly to how you use other block
   devices.
  </p><p>
   For more details, refer to the SUSE Enterprise Storage <em class="citetitle">Administration Guide</em>, chapter
   <em class="citetitle">Using libvirt with Ceph</em>. The SUSE Enterprise Storage documentation is
   available from <a class="link" href="https://documentation.suse.com/ses/" target="_blank">https://documentation.suse.com/ses/</a>.
  </p></section></section><section class="chapter" id="cha-libvirt-config-gui" data-id-title="Configuring virtual machines with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">14 </span><span class="title-name">Configuring virtual machines with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-config-gui">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Virtual Machine Manager's <span class="guimenu">Details</span> view offers in-depth information about
    the VM Guest's complete configuration and hardware equipment. Using this
    view, you can also change the guest configuration or add and modify virtual
    hardware. To access this view, open the guest's console in Virtual Machine Manager and either
    choose <span class="guimenu">View</span> › <span class="guimenu">Details</span> from the menu, or click <span class="guimenu">Show virtual hardware
    details</span> in the toolbar.
   </p></div></div></div></div><div class="figure" id="id-1.12.4.8.4"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_details.png"><img src="images/libvirt_vmm_details.png" width="75%" alt="Details view of a VM Guest" title="Details view of a VM Guest"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.1: </span><span class="title-name"><span class="guimenu">Details</span> view of a VM Guest </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div><p>
  The left panel of the window lists VM Guest overview and already installed
  hardware. After clicking an item in the list, you can access its detailed
  settings in the details view. You can change the hardware parameters to match
  your needs, then click <span class="guimenu">Apply</span> to confirm them. Some changes
  take effect immediately, while others need a reboot of the machine—and
  <code class="systemitem">virt-manager</code> warns you about that fact.
 </p><p>
  To remove installed hardware from a VM Guest, select the appropriate list
  entry in the left panel and then click <span class="guimenu">Remove</span> in the
  bottom right of the window.
 </p><p>
  To add new hardware, click <span class="guimenu">Add Hardware</span> below the left
  panel, then select the type of the hardware you want to add in the
  <span class="guimenu">Add New Virtual Hardware</span> window. Modify its parameters and
  confirm with <span class="guimenu">Finish</span>.
 </p><p>
  The following sections describe configuration options for the specific
  hardware type <span class="emphasis"><em>being added</em></span>. They do not focus on
  modifying an existing piece of hardware as the options are identical.
 </p><section class="sect1" id="sec-libvirt-config-machine-setup" data-id-title="Machine setup"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.1 </span><span class="title-name">Machine setup</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-machine-setup">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes the setup of the virtualized processor and memory
   hardware. These components are vital to a VM Guest, therefore you cannot
   remove them. It also shows how to view the overview and performance
   information, and how to change boot parameters.
  </p><section class="sect2" id="id-1.12.4.8.9.3" data-id-title="Overview"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.1.1 </span><span class="title-name">Overview</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.8.9.3">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="guimenu">Overview</span> shows basic details about VM Guest and the
    hypervisor.
   </p><div class="figure" id="id-1.12.4.8.9.3.3"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_overview.png"><img src="images/libvirt_vmm_overview.png" width="70%" alt="Overview details" title="Overview details"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.2: </span><span class="title-name">Overview details </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.9.3.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div><p>
    <span class="guimenu">Name</span>, <span class="guimenu">Title</span>, and
    <span class="guimenu">Description</span> are editable and help you identify VM Guest
    in the <span class="guimenu">Virtual Machine Manager</span> list of machines.
   </p><div class="figure" id="id-1.12.4.8.9.3.5"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_desc.png"><img src="images/libvirt_vmm_desc.png" width="40%" alt="VM Guest title and description" title="VM Guest title and description"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.3: </span><span class="title-name">VM Guest title and description </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.9.3.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div><p>
    <span class="guimenu">UUID</span> shows the universally unique identifier of the
    virtual machine, while <span class="guimenu">Status</span> shows its current
    status—<span class="guimenu">Running</span>, <span class="guimenu">Paused</span>, or
    <span class="guimenu">Shutoff</span>.
   </p><p>
    The <span class="guimenu">Hypervisor Details</span> section shows the hypervisor
    type, CPU architecture, used emulator, and chipset type. None of the
    hypervisor parameters can be changed.
   </p></section><section class="sect2" id="id-1.12.4.8.9.4" data-id-title="Performance"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.1.2 </span><span class="title-name">Performance</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.8.9.4">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="guimenu">Performance</span> shows regularly updated charts of CPU and
    memory usage, and disk and network I/O.
   </p><div class="figure" id="id-1.12.4.8.9.4.3"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_performance.png"><img src="images/libvirt_vmm_performance.png" width="70%" alt="Performance" title="Performance"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.4: </span><span class="title-name">Performance </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.9.4.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div><div id="id-1.12.4.8.9.4.4" data-id-title="Enabling disabled charts" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Enabling disabled charts</div><p>
     Not all the charts in the <span class="guimenu">Graph</span> view are enabled by
     default. To enable these charts, go to
     <span class="guimenu">File</span> › <span class="guimenu">View
     Manager</span>, then select
     <span class="guimenu">Edit</span> › <span class="guimenu">Preferences</span> › <span class="guimenu">Polling</span>, and check the charts that you
     want to see regularly updated.
    </p></div><div class="figure" id="id-1.12.4.8.9.4.5"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_polling_charts.png"><img src="images/libvirt_vmm_polling_charts.png" width="40%" alt="Statistics charts" title="Statistics charts"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.5: </span><span class="title-name">Statistics charts </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.9.4.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></section><section class="sect2" id="id-1.12.4.8.9.5" data-id-title="Processor"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.1.3 </span><span class="title-name">Processor</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.8.9.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="guimenu">CPU</span> includes detailed information about VM Guest
    processor configuration.
   </p><div class="figure" id="id-1.12.4.8.9.5.3"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_processor.png"><img src="images/libvirt_vmm_processor.png" width="70%" alt="Processor view" title="Processor view"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.6: </span><span class="title-name">Processor view </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.9.5.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div><p>
    In the <span class="guimenu">CPUs</span> section, you can configure the number
    of virtual CPUs allocated to the VM Guest.
    <span class="guimenu">Logical host CPUs</span> shows the number of
    online and usable CPUs on the VM Host Server.
   </p><p>
    The <span class="guimenu">Configuration</span> section lets you configure the CPU
    model and topology.
   </p><p>
    When activated, the <span class="guimenu">Copy host CPU configuration</span> option
    uses the host CPU model for VM Guest. You can see the details of the host CPU model in the output of the <code class="command">virsh capabilities</code> command. When deactivated, the CPU model
    needs to be specified from the models available in the drop-down box.
   </p><p>
    The host CPU model generally provides a good trade-off between CPU features
    and ability to migrate the VM Guest. <code class="systemitem">libvirt</code> does not model every aspect
    of each CPU, so the VM Guest CPU will not match the VM Host Server CPU exactly.
    But the ABI provided to the VM Guest is reproducible and during migration
    the complete CPU model definition is transferred to the destination VM Host Server,
    ensuring the migrated VM Guest will see the exact same CPU model on the
    destination.
   </p><p>
    The <code class="literal">host-passthrough</code> model provides the VM Guest with a CPU that is exactly
    the same as the VM Host Server CPU. This can be useful when the VM Guest workload
    requires CPU features not available in <code class="systemitem">libvirt</code>'s simplified <code class="literal">host-model</code> CPU.
    The host-passthrough model is also required in some cases, for example, when running
    VM Guests with more than 4TB of memory. The <code class="literal">host-passthrough</code> model comes
    with the disadvantage of reduced migration capability. A VM Guest with
    <code class="literal">host-passthrough</code> model CPU can only be migrated to a VM Host Server with identical
    hardware.
   </p><p>
    For more information on <code class="systemitem">libvirt</code>'s CPU model and topology options, see
    the <em class="citetitle">CPU model and topology</em> documentation
    at <a class="link" href="https://libvirt.org/formatdomain.html#cpu-model-and-topology" target="_blank">https://libvirt.org/formatdomain.html#cpu-model-and-topology</a>.
   </p><p>
    After you activate <span class="guimenu">Manually set CPU topology</span>, you can
    specify a custom number of sockets, cores and threads for the CPU.
   </p></section><section class="sect2" id="id-1.12.4.8.9.6" data-id-title="Memory"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.1.4 </span><span class="title-name">Memory</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.8.9.6">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="guimenu">Memory</span> contains information about the memory that is
    available to VM Guest.
   </p><div class="figure" id="id-1.12.4.8.9.6.3"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_memory.png"><img src="images/libvirt_vmm_memory.png" width="70%" alt="Memory view" title="Memory view"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.7: </span><span class="title-name">Memory view </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.9.6.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.8.9.6.4.1"><span class="term"><span class="guimenu">Total host memory</span>
     </span></dt><dd><p>
       Total amount of memory installed on VM Host Server.
      </p></dd><dt id="id-1.12.4.8.9.6.4.2"><span class="term"><span class="guimenu">Current allocation</span>
     </span></dt><dd><p>
       The amount of memory currently available to VM Guest. You can hotplug
       more memory by increasing this value up to the value of <span class="guimenu">Maximum
       allocation</span>.
      </p></dd><dt id="id-1.12.4.8.9.6.4.3"><span class="term"><span class="guimenu">Maximum allocation</span>
     </span></dt><dd><p>
       The maximum value to which you can hotplug the currently available
       memory. Any change to this value will take effect after the next
       VM Guest reboot.
      </p></dd></dl></div><div id="id-1.12.4.8.9.6.5" data-id-title="Large memory VM Guests" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Large memory VM Guests</div><p>
      VM Guests with memory requirements of 4TB or more currently need to
      use the <code class="literal">host-passthrough</code> CPU model.
    </p></div></section><section class="sect2" id="id-1.12.4.8.9.7" data-id-title="Boot options"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.1.5 </span><span class="title-name">Boot options</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.8.9.7">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="guimenu">Boot Options</span> introduces options affecting the VM Guest
    boot process.
   </p><div class="figure" id="id-1.12.4.8.9.7.3"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_boot.png"><img src="images/libvirt_vmm_boot.png" width="70%" alt="Boot options" title="Boot options"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.8: </span><span class="title-name">Boot options </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.9.7.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div><p>
    In the <span class="guimenu">Autostart</span> section, you can specify whether the
    virtual machine should automatically start during the VM Host Server boot phase.
   </p><p>
    In the <span class="guimenu">Boot device order</span>, activate the devices that will
    be used for booting VM Guest. You can change their order with the up and
    down arrow buttons on the right side of the list. To choose from a list of
    bootable devices on VM Guest start, activate <span class="guimenu">Enable boot
    menu</span>.
   </p><p>
    To boot a different kernel than the one on the boot device, activate
    <span class="guimenu">Enable direct kernel boot</span> and specify the paths to the
    alternative kernel and initrd placed on the VM Host Server file system. You can
    also specify kernel arguments that will be passed to the loaded kernel.
   </p></section></section><section class="sect1" id="sec-libvirt-config-storage" data-id-title="Storage"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.2 </span><span class="title-name">Storage</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-storage">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section gives you a detailed description of configuration options for
   storage devices. It includes both hard disks and removable media, such as
   USB or CD-ROM drives.
  </p><div class="procedure" id="id-1.12.4.8.10.3" data-id-title="Adding a new storage device"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 14.1: </span><span class="title-name">Adding a new storage device </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.10.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Below the left panel, click <span class="guimenu">Add Hardware</span> to open the
     <span class="guimenu">Add New Virtual Hardware</span> window. There, select
     <span class="guimenu">Storage</span>.
    </p><div class="figure" id="id-1.12.4.8.10.3.2.2"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_storage1.png"><img src="images/libvirt_vmm_storage1.png" width="70%" alt="Add a new storage" title="Add a new storage"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.9: </span><span class="title-name">Add a new storage </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.10.3.2.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
     To create a <code class="literal">qcow2</code> disk image in the default location,
     activate <span class="guimenu">Create a disk image for the virtual machine</span>
     and specify its size in gigabytes.
    </p><p>
     To gain more control over the disk image creation, activate
     <span class="guimenu">Select or create custom storage</span> and click
     <span class="guimenu">Manage</span> to manage storage pools and images. The window
     <span class="guimenu">Choose Storage Volume</span> opens which has almost identical
     functionality as the <span class="guimenu">Storage</span> tab described in
     <a class="xref" href="#sec-libvirt-storage-vmm" title="9.2.2. Managing storage with Virtual Machine Manager">Section 9.2.2, “Managing storage with Virtual Machine Manager”</a>.
    </p><div id="id-1.12.4.8.10.3.3.3" data-id-title="Supported storage formats" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Supported storage formats</div><p>
      SUSE only supports the following storage formats:
      <code class="literal">raw</code> and <code class="literal">qcow2</code>.
     </p></div></li><li class="step"><p>
     After you manage to create and specify the disk image file, specify the
     <span class="guimenu">Device type</span>. It can be one of the following options:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <span class="guimenu">Disk device</span>
      </p></li><li class="listitem"><p>
       <span class="guimenu">CDROM device</span>: Does not allow using <span class="guimenu">Create a
       disk image for the virtual machine</span>.
      </p></li><li class="listitem"><p>
       <span class="guimenu">Floppy device</span>: Does not allow using <span class="guimenu">Create a
       disk image for the virtual machine</span>.
      </p></li><li class="listitem"><p>
       <span class="guimenu">LUN Passthrough</span>: Required to use an existing SCSI
       storage directly without adding it into a storage pool.
      </p></li></ul></div></li><li class="step"><p>
     Select the <span class="guimenu">Bus type</span> for your device. The list of
     available options depends on the device type you selected in the previous
     step. The types based on <span class="guimenu">VirtIO</span> use paravirtualized
     drivers.
    </p></li><li class="step"><p>
     In the <span class="guimenu">Advanced options</span> section, select the preferred
     <span class="guimenu">Cache mode</span>. For more information on cache modes, see
     <a class="xref" href="#cha-cachemodes" title="Chapter 18. Disk cache modes">Chapter 18, <em>Disk cache modes</em></a>.
    </p></li><li class="step"><p>
     Confirm your settings with <span class="guimenu">Finish</span>. A new storage device
     appears in the left panel.
    </p></li></ol></div></div></section><section class="sect1" id="sec-libvirt-config-controllers" data-id-title="Controllers"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.3 </span><span class="title-name">Controllers</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-controllers">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section focuses on adding and configuring new controllers.
  </p><div class="procedure" id="id-1.12.4.8.11.3" data-id-title="Adding a new controller"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 14.2: </span><span class="title-name">Adding a new controller </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.11.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Below the left panel, click <span class="guimenu">Add Hardware</span> to open the
     <span class="guimenu">Add New Virtual Hardware</span> window. There, select
     <span class="guimenu">Controller</span>.
    </p><div class="figure" id="id-1.12.4.8.11.3.2.2"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_controller.png"><img src="images/libvirt_vmm_controller.png" width="70%" alt="Add a new controller" title="Add a new controller"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.10: </span><span class="title-name">Add a new controller </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.11.3.2.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
     Select the type of the controller. You can choose from
     <span class="guimenu">IDE</span>, <span class="guimenu">Floppy</span>,
     <span class="guimenu">SCSI</span>, <span class="guimenu">SATA</span>, <span class="guimenu">VirtIO
     Serial</span> (paravirtualized), <span class="guimenu">USB</span>, or
     <span class="guimenu">CCID</span> (smart card devices).
    </p></li><li class="step"><p>
     Optionally, in the case of a USB or SCSI controller, select a controller
     model.
    </p></li><li class="step"><p>
     Confirm your settings with <span class="guimenu">Finish</span>. A new controller
     appears in the left panel.
    </p></li></ol></div></div></section><section class="sect1" id="sec-libvirt-config-networking" data-id-title="Networking"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.4 </span><span class="title-name">Networking</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-networking">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes how to add and configure new network devices.
  </p><div class="procedure" id="id-1.12.4.8.12.3" data-id-title="Adding a new network device"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 14.3: </span><span class="title-name">Adding a new network device </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.12.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Below the left panel, click <span class="guimenu">Add Hardware</span> to open the
     <span class="guimenu">Add New Virtual Hardware</span> window. There, select
     <span class="guimenu">Network</span>.
    </p><div class="figure" id="id-1.12.4.8.12.3.2.2"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_network.png"><img src="images/libvirt_vmm_network.png" width="70%" alt="Add a new network interface" title="Add a new network interface"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.11: </span><span class="title-name">Add a new network interface </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.12.3.2.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
     From the <span class="guimenu">Network source</span> list, select the source for the
     network connection. The list includes VM Host Server's available physical
     network interfaces, network bridges, or network bonds. You can also assign
     the VM Guest to an already defined virtual network. See
     <a class="xref" href="#libvirt-host-network" title="9.1. Configuring networks">Section 9.1, “Configuring networks”</a> for more information on setting up
     virtual networks with Virtual Machine Manager.
    </p></li><li class="step"><p>
     Specify a <span class="guimenu">MAC address</span> for the network device. While
     Virtual Machine Manager pre-fills a random value for your convenience, it is recommended to
     supply a MAC address appropriate for your network environment to avoid
     network conflicts.
    </p></li><li class="step"><p>
     Select a device model from the list. You can either leave the
     <span class="guimenu">Hypervisor default</span>, or specify one of
     <span class="guimenu">e1000</span>, <span class="guimenu">rtl8139</span>, or
     <span class="guimenu">virtio</span> models. Note that <span class="emphasis"><em>virtio</em></span>
     uses paravirtualized drivers.
    </p></li><li class="step"><p>
     Confirm your settings with <span class="guimenu">Finish</span>. A new network device
     appears in the left panel.
    </p></li></ol></div></div></section><section class="sect1" id="sec-libvirt-config-input" data-id-title="Input devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.5 </span><span class="title-name">Input devices</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-input">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section focuses on adding and configuring new input devices such as
   mouse, keyboard, or tablet.
  </p><div class="procedure" id="proc-libvirt-config-input" data-id-title="Adding a new input device"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 14.4: </span><span class="title-name">Adding a new input device </span></span><a title="Permalink" class="permalink" href="#proc-libvirt-config-input">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Below the left panel, click <span class="guimenu">Add Hardware</span> to open the
     <span class="guimenu">Add New Virtual Hardware</span> window. There, select
     <span class="guimenu">Input</span>.
    </p><div class="figure" id="id-1.12.4.8.13.3.2.2"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_input.png"><img src="images/libvirt_vmm_input.png" width="70%" alt="Add a new input device" title="Add a new input device"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.12: </span><span class="title-name">Add a new input device </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.13.3.2.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
     Select a device type from the list.
    </p></li><li class="step"><p>
     Confirm your settings with <span class="guimenu">Finish</span>. A new input device
     appears in the left panel.
    </p></li></ol></div></div><div id="tip-libvirt-config-tablet" data-id-title="Enabling seamless and synchronized mouse pointer movement" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Enabling seamless and synchronized mouse pointer movement</div><p>
    When you click within a VM Guest's console with the mouse, the pointer is
    captured by the console window and cannot be used outside the console
    unless it is explicitly released (by pressing <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">Ctrl</span>). To
    prevent the console from grabbing the key and to enable seamless pointer
    movement between host and guest instead, follow the instructions in
    <a class="xref" href="#proc-libvirt-config-input" title="Adding a new input device">Procedure 14.4, “Adding a new input device”</a> to add an
    <span class="guimenu">EvTouch USB Graphics Tablet</span> to the VM Guest.
   </p><p>
    Adding a tablet has the additional advantage of synchronizing the mouse
    pointer movement between VM Host Server and VM Guest when using a graphical
    environment on the guest. With no tablet configured on the guest, you
    will often see two pointers with one dragging behind the other.
   </p></div></section><section class="sect1" id="sec-libvirt-config-video" data-id-title="Video"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.6 </span><span class="title-name">Video</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-video">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes how to add and configure new video devices.
  </p><div class="procedure" id="id-1.12.4.8.14.3" data-id-title="Adding a video device"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 14.5: </span><span class="title-name">Adding a video device </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.14.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Below the left panel, click <span class="guimenu">Add Hardware</span> to open the
     <span class="guimenu">Add New Virtual Hardware</span> window. There, select
     <span class="guimenu">Video</span>.
    </p></li><li class="step"><div class="figure" id="id-1.12.4.8.14.3.3.1"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_video.png"><img src="images/libvirt_vmm_video.png" width="70%" alt="Add a new video device" title="Add a new video device"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.13: </span><span class="title-name">Add a new video device </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.14.3.3.1">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
     Select a model from the list. You can choose from:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       Cirrus
      </p></li><li class="listitem"><p>
       QXL
      </p></li><li class="listitem"><p>
       VGA
      </p></li><li class="listitem"><p>
       Virtio
      </p></li><li class="listitem"><p>
       VMVGA
      </p></li><li class="listitem"><p>
       Xen
      </p></li></ul></div><div id="id-1.12.4.8.14.3.4.3" data-id-title="Secondary video devices" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Secondary video devices</div><p>
      Only <span class="guimenu">QXL</span> and <span class="guimenu">Virtio</span> can be added as
      secondary video devices.
     </p></div></li><li class="step"><p>
     Confirm your settings with <span class="guimenu">Finish</span>. A new video device
     appears in the left panel.
    </p></li></ol></div></div></section><section class="sect1" id="sec-libvirt-config-usb-redirectors" data-id-title="USB redirectors"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.7 </span><span class="title-name">USB redirectors</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-usb-redirectors">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   USB devices that are connected to the client machine can be redirected to
   the VM Guest by using <span class="guimenu">USB Redirectors</span>.
  </p><div class="procedure" id="id-1.12.4.8.15.3" data-id-title="Adding a USB redirector"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 14.6: </span><span class="title-name">Adding a USB redirector </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.15.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Below the left panel, click <span class="guimenu">Add Hardware</span> to open the
     <span class="guimenu">Add New Virtual Hardware</span> window. There, select
     <span class="guimenu">USB Redirection</span>.
    </p><div class="figure" id="id-1.12.4.8.15.3.2.2"><div class="figure-contents"><div class="mediaobject"><a href="images/libvirt_vmm_usb_redirector.png"><img src="images/libvirt_vmm_usb_redirector.png" width="70%" alt="Add a new USB redirector" title="Add a new USB redirector"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.14: </span><span class="title-name">Add a new USB redirector </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.15.3.2.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
     Select a device type from the list. Depending on your configuration, you
     can either select a <span class="guimenu">Spice channel</span> or a
     <span class="guimenu">TCP</span> redirector.
    </p></li><li class="step"><p>
     Confirm your settings with <span class="guimenu">Finish</span>. A new USB redirector
     appears in the left panel.
    </p></li></ol></div></div></section><section class="sect1" id="sec-libvirt-config-miscellaneous" data-id-title="Miscellaneous"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.8 </span><span class="title-name">Miscellaneous</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-miscellaneous">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.8.16.2.1"><span class="term">Smartcard</span></dt><dd><p>
      Smartcard functionality can be added via the <span class="guimenu">Smartcard</span>
      element. A physical USB smartcard reader can then be passed through to
      the VM Guest.
     </p></dd><dt id="id-1.12.4.8.16.2.2"><span class="term">Watchdog</span></dt><dd><p>
      Virtual watchdog devices are also supported. They can be created via the
      <span class="guimenu">Watchdog</span> element. The model as well as the action of
      the device can be specified.
     </p><div id="id-1.12.4.8.16.2.2.2.2" data-id-title="Requirements for virtual watchdog devices" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Requirements for virtual watchdog devices</div><p>
       QA virtual watchdog devices require a specific driver and daemon
       to be installed in the VM Guest. Otherwise the virtual watchdog device does
       not work.
      </p></div></dd><dt id="id-1.12.4.8.16.2.3"><span class="term">TPM</span></dt><dd><p>
      You can use the Host TPM device in the VM Guest by adding TPM
      functionality via the <span class="guimenu">TPM</span> element.
     </p><div id="id-1.12.4.8.16.2.3.2.2" data-id-title="Virtual TPMs" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Virtual TPMs</div><p>
       The Host TPM can only be used in one VM Guest at a
       time.
      </p></div></dd></dl></div></section><section class="sect1" id="sec-libvirt-config-cdrom" data-id-title="Adding a CD/DVD-ROM device with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.9 </span><span class="title-name">Adding a CD/DVD-ROM device with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-cdrom">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   KVM supports CD or DVD-ROMs in VM Guest either by directly accessing a
   physical drive on the VM Host Server or by accessing ISO images. To create an ISO
   image from an existing CD or DVD, use <code class="command">dd</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/<em class="replaceable">CD_DVD_DEVICE</em> of=my_distro.iso bs=2048</pre></div><p>
   To add a CD/DVD-ROM device to your VM Guest, proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Double-click a VM Guest entry in the Virtual Machine Manager to open its console and switch
     to the <span class="guimenu">Details</span> view with <span class="guimenu">View</span> › <span class="guimenu">Details</span>.
    </p></li><li class="step"><p>
     Click <span class="guimenu">Add Hardware</span> and choose
     <span class="guimenu">Storage</span> in the pop-up window.
    </p></li><li class="step"><p>
     Change the <span class="guimenu">Device Type</span> to <span class="guimenu">IDE CDROM</span>.
    </p></li><li class="step"><p>
     Select <span class="guimenu">Select or create custom storage</span>.
    </p><ol type="a" class="substeps"><li class="step"><p>
       To assign the device to a physical medium, enter the path to the
       VM Host Server's CD/DVD-ROM device (for example,
       <code class="filename">/dev/cdrom</code>) next to <span class="guimenu">Manage</span>.
       Alternatively, use <span class="guimenu">Manage</span> to open a file browser and
       then click <span class="guimenu">Browse Local</span> to select the device.
       Assigning the device to a physical medium is only possible when the
       Virtual Machine Manager was started on the VM Host Server.
      </p></li><li class="step"><p>
       To assign the device to an existing image, click
       <span class="guimenu">Manage</span> to choose an image from a storage pool. If the
       Virtual Machine Manager was started on the VM Host Server, alternatively choose an image from
       another location on the file system by clicking <span class="guimenu">Browse
       Local</span>. Select an image and close the file browser with
       <span class="guimenu">Choose Volume</span>.
      </p></li></ol></li><li class="step"><p>
     Save the new virtualized device with <span class="guimenu">Finish</span>.
    </p></li><li class="step"><p>
     Reboot the VM Guest to make the new device available. For more
     information, see <a class="xref" href="#sec-libvirt-config-cdrom-media-change" title="14.11. Ejecting and changing floppy or CD/DVD-ROM media with Virtual Machine Manager">Section 14.11, “Ejecting and changing floppy or CD/DVD-ROM media with Virtual Machine Manager”</a>.
    </p></li></ol></div></div></section><section class="sect1" id="sec-libvirt-config-floppy" data-id-title="Adding a floppy device with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.10 </span><span class="title-name">Adding a floppy device with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-floppy">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Currently KVM only supports the use of floppy disk images—using a
   physical floppy drive is not supported. Create a floppy disk image from an
   existing floppy using <code class="command">dd</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/fd0 of=/var/lib/libvirt/images/floppy.img</pre></div><p>
   To create an empty floppy disk image use one of the following commands:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.8.18.5.1"><span class="term">Raw image</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/zero of=/var/lib/libvirt/images/floppy.img bs=512 count=2880</pre></div></dd><dt id="id-1.12.4.8.18.5.2"><span class="term">FAT formatted image</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mkfs.msdos -C /var/lib/libvirt/images/floppy.img 1440</pre></div></dd></dl></div><p>
   To add a floppy device to your VM Guest, proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Double-click a VM Guest entry in the Virtual Machine Manager to open its console and switch
     to the <span class="guimenu">Details</span> view with <span class="guimenu">View</span> › <span class="guimenu">Details</span>.
    </p></li><li class="step"><p>
     Click <span class="guimenu">Add Hardware</span> and choose
     <span class="guimenu">Storage</span> in the pop-up window.
    </p></li><li class="step"><p>
     Change the <span class="guimenu">Device Type</span> to <span class="guimenu">Floppy
     Disk</span>.
    </p></li><li class="step"><p>
     Choose <span class="guimenu">Select or create custom storage</span> and click
     <span class="guimenu">Manage</span> to choose an existing image from a storage pool.
     If Virtual Machine Manager was started on the VM Host Server, alternatively choose an image from
     another location on the file system by clicking <span class="guimenu">Browse
     Local</span>. Select an image and close the file browser with
     <span class="guimenu">Choose Volume</span>.
    </p></li><li class="step"><p>
     Save the new virtualized device with <span class="guimenu">Finish</span>.
    </p></li><li class="step"><p>
     Reboot the VM Guest to make the new device available. For more
     information, see <a class="xref" href="#sec-libvirt-config-cdrom-media-change" title="14.11. Ejecting and changing floppy or CD/DVD-ROM media with Virtual Machine Manager">Section 14.11, “Ejecting and changing floppy or CD/DVD-ROM media with Virtual Machine Manager”</a>.
    </p></li></ol></div></div></section><section class="sect1" id="sec-libvirt-config-cdrom-media-change" data-id-title="Ejecting and changing floppy or CD/DVD-ROM media with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.11 </span><span class="title-name">Ejecting and changing floppy or CD/DVD-ROM media with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-cdrom-media-change">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Whether you are using the VM Host Server's physical CD/DVD-ROM device or an
   ISO/floppy image: Before you can change the media or image of an existing
   device in the VM Guest, you first need to <code class="literal">disconnect</code> the
   media from the guest.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Double-click a VM Guest entry in the Virtual Machine Manager to open its console and switch
     to the <span class="guimenu">Details</span> view with <span class="guimenu">View</span> › <span class="guimenu">Details</span>.
    </p></li><li class="step"><p>
     Choose the Floppy or CD/DVD-ROM device and <span class="quote">“<span class="quote">eject</span>”</span> the medium
     by clicking <span class="guimenu">Disconnect</span>.
    </p></li><li class="step"><p>
     To <span class="quote">“<span class="quote">insert</span>”</span> a new medium, click <span class="guimenu">Connect</span>.
    </p><ol type="a" class="substeps"><li class="step"><p>
       If using the VM Host Server's physical CD/DVD-ROM device, first change the
       media in the device (this may require unmounting it on the VM Host Server
       before it can be ejected). Then choose <span class="guimenu">CD-ROM or DVD</span>
       and select the device from the drop-down box.
      </p></li><li class="step"><p>
       If you are using an ISO image, choose <span class="guimenu">ISO image
       Location</span> and select an image by clicking
       <span class="guimenu">Manage</span>. When connecting from a remote host, you may
       only choose images from existing storage pools.
      </p></li></ol></li><li class="step"><p>
     Click <span class="guimenu">OK</span> to finish. The new media can now be accessed
     in the VM Guest.
    </p></li></ol></div></div></section><section class="sect1" id="sec-libvirt-config-pci" data-id-title="Assigning a host PCI device to a VM Guest"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.12 </span><span class="title-name">Assigning a host PCI device to a VM Guest</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-pci">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can directly assign host-PCI devices to guests (PCI pass-through). When
   the PCI device is assigned to one VM Guest, it cannot be used on the host
   or by another VM Guest unless it is re-assigned. A prerequisite for this
   feature is a VM Host Server configuration as described in
   <a class="xref" href="#ann-vt-io-require" title="Important: Requirements for VFIO and SR-IOV">Important: Requirements for VFIO and SR-IOV</a>.
  </p><section class="sect2" id="sec-libvirt-config-pci-vmm" data-id-title="Adding a PCI device with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.12.1 </span><span class="title-name">Adding a PCI device with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-pci-vmm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following procedure describes how to assign a PCI device from the host
    machine to a VM Guest using Virtual Machine Manager:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Double-click a VM Guest entry in the Virtual Machine Manager to open its console and
      switch to the <span class="guimenu">Details</span> view with <span class="guimenu">View</span> › <span class="guimenu">Details</span>.
     </p></li><li class="step"><p>
      Click <span class="guimenu">Add Hardware</span> and choose the <span class="guimenu">PCI Host
      Device</span> category in the left panel. A list of available PCI
      devices appears in the right part of the window.
     </p><div class="figure" id="id-1.12.4.8.20.3.3.2.2"><div class="figure-contents"><div class="mediaobject"><a href="images/virt_add_pcidevice.png"><img src="images/virt_add_pcidevice.png" width="75%" alt="Adding a PCI device" title="Adding a PCI device"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.15: </span><span class="title-name">Adding a PCI device </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.20.3.3.2.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
      From the list of available PCI devices, choose the one you want to pass
      to the guest. Confirm with <span class="guimenu">Finish</span>.
     </p></li></ol></div></div><div id="id-1.12.4.8.20.3.4" data-id-title="SLES 11 SP4 KVM guests" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: SLES 11 SP4 KVM guests</div><p>
    On a newer QEMU machine type (pc-i440fx-2.0 or higher) with SLES 11
    SP4 KVM guests, the <code class="systemitem">acpiphp</code>
    module is not loaded by default in the guest. This module must be loaded to
    enable hotplugging of disk and network devices. To load the module manually,
    use the command <code class="command">modprobe acpiphp</code>. It is also possible to
    autoload the module by adding <code class="literal">install acpiphp /bin/true</code>
    to the <code class="filename">/etc/modprobe.conf.local</code> file.
    </p></div><div id="id-1.12.4.8.20.3.5" data-id-title="KVM guests using QEMU Q35 machine type" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: KVM guests using QEMU Q35 machine type</div><p>
    KVM guests using the QEMU Q35 machine type have a PCI topology that
    includes a <code class="literal">pcie-root</code> controller and seven
    <code class="literal">pcie-root-port</code> controllers. The
    <code class="literal">pcie-root</code> controller does not support hotplugging. Each
    <code class="literal">pcie-root-port</code> controller supports hotplugging a single
    PCIe device. PCI controllers cannot be hotplugged, so plan accordingly and
    add more <code class="literal">pcie-root-port</code>s if more than seven PCIe
    devices will be hotplugged. A <code class="literal">pcie-to-pci-bridge</code>
    controller can be added to support hotplugging legacy PCI devices.
    See <a class="link" href="https://libvirt.org/pci-hotplug.html" target="_blank">https://libvirt.org/pci-hotplug.html</a> for more
    information about PCI topology between QEMU machine types.
    </p></div></section></section><section class="sect1" id="sec-libvirt-config-usb" data-id-title="Assigning a host USB device to a VM Guest"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.13 </span><span class="title-name">Assigning a host USB device to a VM Guest</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-usb">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Analogous to assigning host PCI devices (see
   <a class="xref" href="#sec-libvirt-config-pci" title="14.12. Assigning a host PCI device to a VM Guest">Section 14.12, “Assigning a host PCI device to a VM Guest”</a>), you can directly assign host
   USB devices to guests. When the USB device is assigned to one VM Guest, it
   cannot be used on the host or by another VM Guest unless it is re-assigned.
  </p><section class="sect2" id="sec-libvirt-config-usb-vmm" data-id-title="Adding a USB device with Virtual Machine Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.13.1 </span><span class="title-name">Adding a USB device with Virtual Machine Manager</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-usb-vmm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To assign a host USB device to VM Guest using Virtual Machine Manager, follow these steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Double-click a VM Guest entry in the Virtual Machine Manager to open its console and
      switch to the <span class="guimenu">Details</span> view with <span class="guimenu">View</span> › <span class="guimenu">Details</span>.
     </p></li><li class="step"><p>
      Click <span class="guimenu">Add Hardware</span> and choose the <span class="guimenu">USB Host
      Device</span> category in the left panel. A list of available USB
      devices appears in the right part of the window.
     </p><div class="figure" id="id-1.12.4.8.21.3.3.2.2"><div class="figure-contents"><div class="mediaobject"><a href="images/virt_add_usbdevice.png"><img src="images/virt_add_usbdevice.png" width="75%" alt="Adding a USB device" title="Adding a USB device"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 14.16: </span><span class="title-name">Adding a USB device </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.8.21.3.3.2.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_gui.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
      From the list of available USB devices, choose the one you want to pass
      to the guest. Confirm with <span class="guimenu">Finish</span>. The new USB device
      appears in the left pane of the <span class="guimenu">Details</span> view.
     </p><div id="id-1.12.4.8.21.3.3.3.2" data-id-title="USB device removal" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: USB device removal</div><p>
       To remove the host USB device assignment, click it in the left pane of
       the <span class="guimenu">Details</span> view and confirm with
       <span class="guimenu">Remove</span>.
      </p></div></li></ol></div></div></section></section></section><section class="chapter" id="cha-libvirt-config-virsh" data-id-title="Configuring virtual machines with virsh"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">15 </span><span class="title-name">Configuring virtual machines with <code class="command">virsh</code></span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-config-virsh">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    You can use <code class="command">virsh</code> to configure virtual machines (VM) on the command line
    as an alternative to using the Virtual Machine Manager. With <code class="command">virsh</code>, you can control the
    state of a VM, edit the configuration of a VM or even migrate a VM to
    another host. The following sections describe how to manage VMs by using
    <code class="command">virsh</code>.
   </p></div></div></div></div><section class="sect1" id="sec-libvirt-config-editing-virsh" data-id-title="Editing the VM configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.1 </span><span class="title-name">Editing the VM configuration</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-editing-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The configuration of a VM is stored in an XML file in
   <code class="filename">/etc/libvirt/qemu/</code> and looks like this:
  </p><div class="example" id="id-1.12.4.9.3.3" data-id-title="Example XML configuration file"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 15.1: </span><span class="title-name">Example XML configuration file </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.9.3.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">&lt;domain type='kvm'&gt;
  &lt;name&gt;sles15&lt;/name&gt;
  &lt;uuid&gt;ab953e2f-9d16-4955-bb43-1178230ee625&lt;/uuid&gt;
  &lt;memory unit='KiB'&gt;2097152&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;2097152&lt;/currentMemory&gt;
  &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch='x86_64' machine='pc-i440fx-2.11'&gt;hvm&lt;/type&gt;
  &lt;/os&gt;
  &lt;features&gt;...&lt;/features&gt;
  &lt;cpu mode='custom' match='exact' check='partial'&gt;
    &lt;model fallback='allow'&gt;Skylake-Client-IBRS&lt;/model&gt;
  &lt;/cpu&gt;
  &lt;clock&gt;...&lt;/clock&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
  &lt;pm&gt;
    &lt;suspend-to-mem enabled='no'/&gt;
    &lt;suspend-to-disk enabled='no'/&gt;
  &lt;/pm&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-system-x86_64&lt;/emulator&gt;
    &lt;disk type='file' device='disk'&gt;...&lt;/disk&gt;
  &lt;/devices&gt;
  ...
&lt;/domain&gt;</pre></div></div></div><p>
   If you want to edit the configuration of a VM Guest, check if it is
   offline:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh list --inactive</code></pre></div><p>
   If your VM Guest is in this list, you can safely edit its configuration:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh edit <em class="replaceable">NAME_OF_VM_GUEST</em></code></pre></div><p>
   Before saving the changes, <code class="command">virsh</code> validates your input against a RelaxNG
   schema.
  </p></section><section class="sect1" id="sec-libvirt-config-machinetype-virsh" data-id-title="Changing the machine type"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.2 </span><span class="title-name">Changing the machine type</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-machinetype-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When installing with the <code class="command">virt-install</code> tool, the machine
   type for a VM Guest is <span class="emphasis"><em>pc-i440fx</em></span> by default. The
   machine type is stored in the VM Guest's configuration file in the
   <code class="sgmltag-element">type</code> element:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;type arch='x86_64' machine='pc-i440fx-2.3'&gt;hvm&lt;/type&gt;</pre></div><p>
   As an example, the following procedure shows how to change this value to the
   machine type <code class="literal">q35</code>. The value <code class="literal">q35</code> is an
   Intel* chipset and includes <a class="xref" href="#gloss-vt-acronym-pcie" title="PCIe">PCIe</a>,
   supports up to 12 USB ports, and has support for
   <a class="xref" href="#gloss-vt-acronym-sata" title="SATA">SATA</a> and
   <a class="xref" href="#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a>.
   
  </p><div class="procedure" id="id-1.12.4.9.4.5" data-id-title="Changing machine type"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 15.1: </span><span class="title-name">Changing machine type </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.9.4.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Check whether your VM Guest is inactive:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh list --inactive</code>
Id    Name                           State
----------------------------------------------------
-     sles15                         shut off</pre></div></li><li class="step"><p>
     Edit the configuration for this VM Guest:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh edit sles15</code></pre></div></li><li class="step"><p>
     Replace the value of the <code class="sgmltag-attribute">machine</code> attribute
     with <code class="sgmltag-attvalue">pc-q35-2.0</code> :
    </p><div class="verbatim-wrap"><pre class="screen">&lt;type arch='x86_64' machine='pc-q35-2.0'&gt;hvm&lt;/type&gt;</pre></div></li><li class="step"><p>
     Restart the VM Guest:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh start sles15</code></pre></div></li><li class="step"><p>
     Check if the machine type has changed. Log in to the VM Guest and run the
     following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dmidecode | grep Product</code>
Product Name: Standard PC (Q35 + ICH9, 2009)</pre></div></li></ol></div></div><div id="id-1.12.4.9.4.6" data-id-title="Machine type update recommendations" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Machine type update recommendations</div><p>
    Whenever the QEMU version on the host system is upgraded (for example, when
    upgrading the VM Host Server to a new service pack), upgrade the machine type of
    the VM Guests to the latest available version. To check, use the command
    <code class="command">qemu-system-x86_64 -M help</code> on the VM Host Server.
   </p><p>
    The default machine type <code class="literal">pc-i440fx</code>, for example, is
    regularly updated. If your VM Guest still runs with a machine type of
    <code class="literal">pc-i440fx-1.<em class="replaceable">X</em></code>, we strongly
    recommend an update to
    <code class="literal">pc-i440fx-2.<em class="replaceable">X</em></code>. This allows
    taking advantage of the most recent updates and corrections in machine
    definitions, and ensures better future compatibility.
   </p></div></section><section class="sect1" id="sec-libvirt-hypervisor-features-virsh" data-id-title="Configuring hypervisor features"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.3 </span><span class="title-name">Configuring hypervisor features</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-hypervisor-features-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">libvirt</code> automatically enables a default set of hypervisor
   features that are sufficient in most circumstances, but also allows enabling
   and disabling features as needed. As an example, Xen does not support
   enabling PCI pass-through by default. It must be enabled with the
   <code class="literal">passthrough</code> setting. Hypervisor features can be
   configured with <code class="command">virsh</code>. Look for the <code class="sgmltag-element">&lt;features&gt;</code> element in
   the VM Guest's configuration file and adjust the various features as
   required. Continuing with the Xen pass-through example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh edit sle15sp1
 &lt;features&gt;
    &lt;xen&gt;
      &lt;passthrough/&gt;
    &lt;/xen&gt;
 &lt;/features&gt;</pre></div><p>
   Save your changes and restart the VM Guest.
  </p><p>
   See the <em class="citetitle">Hypervisor features</em> section of the libvirt
   <em class="citetitle">Domain XML format</em> manual at
   <a class="link" href="https://libvirt.org/formatdomain.html#elementsFeatures" target="_blank">https://libvirt.org/formatdomain.html#elementsFeatures</a>
   for more information.
  </p></section><section class="sect1" id="libvirt-cpu-virsh" data-id-title="Configuring CPU"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.4 </span><span class="title-name">Configuring CPU</span></span> <a title="Permalink" class="permalink" href="#libvirt-cpu-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Many aspects of the virtual CPUs presented to VM Guests are configurable
   with <code class="command">virsh</code>. The number of current and maximum CPUs allocated to a VM Guest
   can be changed, as well as the model of the CPU and its feature set. The
   following subsections describe how to change the common CPU settings of a
   VM Guest.
  </p><section class="sect2" id="sec-libvirt-cpu-num-virsh" data-id-title="Configuring the number of CPUs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.4.1 </span><span class="title-name">Configuring the number of CPUs</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-cpu-num-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The number of allocated CPUs is stored in the VM Guest's XML configuration
    file in <code class="filename">/etc/libvirt/qemu/</code> in the
    <code class="sgmltag-attribute">vcpu</code> element:
   </p><div class="verbatim-wrap"><pre class="screen">&lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;</pre></div><p>
    In this example, the VM Guest has only one allocated CPU. The following
    procedure shows how to change the number of allocated CPUs for the
    VM Guest:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Check whether your VM Guest is inactive:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh list --inactive</code>
Id    Name                           State
----------------------------------------------------
-     sles15                         shut off</pre></div></li><li class="step"><p>
      Edit the configuration for an existing VM Guest:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh edit sles15</code></pre></div></li><li class="step"><p>
      Change the number of allocated CPUs:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;</pre></div></li><li class="step"><p>
      Restart the VM Guest:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh start sles15</code></pre></div></li><li class="step"><p>
      Check if the number of CPUs in the VM has changed.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh vcpuinfo sled15</code>
VCPU:           0
CPU:            N/A
State:          N/A
CPU time        N/A
CPU Affinity:   yy

VCPU:           1
CPU:            N/A
State:          N/A
CPU time        N/A
CPU Affinity:   yy</pre></div></li></ol></div></div><p>
    You can also change the number of CPUs while the VM Guest is running.
    CPUs can be hotplugged until the maximum number configured at VM Guest
    start is reached. Likewise they can be hot-unplugged until the lower
    limit of 1 is reached. The following example demonstrates changing the
    active CPU count from 2 to pre-defined maximum of 4.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Check the current live vcpu count:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh vcpucount sles15 | grep live</code>
maximum      live           4
current      live           2</pre></div></li><li class="step"><p>
      Change the current, or active, number of CPUs to 4:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh setvcpus sles15 --count 4 --live</code></pre></div></li><li class="step"><p>
      Check that the current live vcpu count is now 4:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh vcpucount sles15 | grep live</code>
maximum      live           4
current      live           4</pre></div></li></ol></div></div><div id="id-1.12.4.9.6.3.8" data-id-title="Exceeding 255 CPUs" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Exceeding 255 CPUs</div><p>
      With KVM it is possible to define a VM Guest with more than 255
      CPUs, however additional configuration is necessary to start and
      run the VM Guest. The <code class="literal">ioapic</code> feature needs to be tuned and an IOMMU
      device needs to be added to the VM Guest. Below is an example
      configuration for 288 CPUs.
     </p><div class="verbatim-wrap"><pre class="screen">&lt;domain&gt;
 &lt;vcpu placement='static'&gt;288&lt;/vcpu&gt;
 &lt;features&gt;
  &lt;ioapic driver='qemu'/&gt;
 &lt;/features&gt;
 &lt;devices&gt;
  &lt;iommu model='intel'&gt;
   &lt;driver intremap='on' eim='on'/&gt;
  &lt;/iommu&gt;
 &lt;/devices&gt;
&lt;/domain&gt;</pre></div></div></section><section class="sect2" id="sec-libvirt-cpu-model-virsh" data-id-title="Configuring the CPU model"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.4.2 </span><span class="title-name">Configuring the CPU model</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-cpu-model-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The CPU model exposed to a VM Guest can often influence the workload
    running within it. The default CPU model is derived from a CPU mode
    known as <code class="literal">host-model</code>.
   </p><div class="verbatim-wrap"><pre class="screen">&lt;cpu mode='host-model'/&gt;</pre></div><p>
    When starting a VM Guest with CPU mode <code class="literal">host-model</code>, <code class="systemitem">libvirt</code> will
    copy its model of the host CPU into the VM Guest definition. The host
    CPU model and features copied to the VM Guest definition can be
    observed in the output of the <code class="command">virsh capabilities</code>.
   </p><p>
    Another interesting CPU mode is <code class="literal">host-passthrough</code>.
   </p><div class="verbatim-wrap"><pre class="screen">&lt;cpu mode='host-passthrough'/&gt;</pre></div><p>
    When starting a VM Guest with CPU mode <code class="literal">host-passthrough</code>, it is presented
    with a CPU that is exactly the same as the VM Host Server CPU. This can be
    useful when the VM Guest workload requires CPU features not available in
    <code class="systemitem">libvirt</code>'s simplified <code class="literal">host-model</code> CPU. The <code class="literal">host-passthrough</code> CPU mode is
    also required in some cases, for example, when running VM Guests with more than
    4TB of memory. The <code class="literal">host-passthrough</code> CPU mode comes with the disadvantage of
    reduced migration flexibility. A VM Guest with <code class="literal">host-passthrough</code> CPU mode
    can only be migrated to a VM Host Server with identical hardware.
   </p><p>
    When using the <code class="literal">host-passthrough</code> CPU mode, it is still possible to
    disable undesirable features. The following configuration will present
    the VM Guest with a CPU that is exactly the same as the host CPU but
    with the <code class="literal">vmx</code> feature disabled.
   </p><div class="verbatim-wrap"><pre class="screen">&lt;cpu mode='host-passthrough'&gt;
  &lt;feature policy='disable' name='vmx'/&gt;
  &lt;/cpu&gt;</pre></div><p>
    The <code class="literal">custom</code> CPU mode is another common mode used to define a normalized
    CPU that can be migrated throughout dissimilar hosts in a cluster. For
    example in a cluster with hosts containing Nehalem, IvyBridge, and
    SandyBridge CPUs, the VM Guest can be configured with a <code class="literal">custom</code> CPU
    mode that contains a Nehalem CPU model.
   </p><div class="verbatim-wrap"><pre class="screen">&lt;cpu mode='custom' match='exact'&gt;
  &lt;model fallback='allow'&gt;Nehalem&lt;/model&gt;
  &lt;feature policy='require' name='vme'/&gt;
  &lt;feature policy='require' name='ds'/&gt;
  &lt;feature policy='require' name='acpi'/&gt;
  &lt;feature policy='require' name='ss'/&gt;
  &lt;feature policy='require' name='ht'/&gt;
  &lt;feature policy='require' name='tm'/&gt;
  &lt;feature policy='require' name='pbe'/&gt;
  &lt;feature policy='require' name='dtes64'/&gt;
  &lt;feature policy='require' name='monitor'/&gt;
  &lt;feature policy='require' name='ds_cpl'/&gt;
  &lt;feature policy='require' name='vmx'/&gt;
  &lt;feature policy='require' name='est'/&gt;
  &lt;feature policy='require' name='tm2'/&gt;
  &lt;feature policy='require' name='xtpr'/&gt;
  &lt;feature policy='require' name='pdcm'/&gt;
  &lt;feature policy='require' name='dca'/&gt;
  &lt;feature policy='require' name='rdtscp'/&gt;
  &lt;feature policy='require' name='invtsc'/&gt;
  &lt;/cpu&gt;</pre></div><p>
    For more information on <code class="systemitem">libvirt</code>'s CPU model and topology options, see
    the <em class="citetitle">CPU model and topology</em> documentation
    at <a class="link" href="https://libvirt.org/formatdomain.html#cpu-model-and-topology" target="_blank">https://libvirt.org/formatdomain.html#cpu-model-and-topology</a>.
   </p></section></section><section class="sect1" id="sec-libvirt-config-boot-menu-virsh" data-id-title="Changing boot options"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.5 </span><span class="title-name">Changing boot options</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-boot-menu-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The boot menu of the VM Guest can be found in the <code class="sgmltag-element">os</code> element and
   usually looks like this:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;os&gt;
  &lt;type&gt;hvm&lt;/type&gt;
  &lt;loader&gt;readonly='yes' secure='no' type='rom'/&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
  &lt;nvram template='/usr/share/OVMF/OVMF_VARS.fd'/&gt;/var/lib/libvirt/nvram/guest_VARS.fd&lt;/nvram&gt;
  &lt;boot dev='hd'/&gt;
  &lt;boot dev='cdrom'/&gt;
  &lt;bootmenu enable='yes' timeout='3000'/&gt;
  &lt;smbios mode='sysinfo'/&gt;
  &lt;bios useserial='yes' rebootTimeout='0'/&gt;
  &lt;/os&gt;</pre></div><p>
   In this example, two devices are available, <code class="sgmltag-attvalue">hd</code>
   and <code class="sgmltag-attvalue">cdrom</code> . The configuration also reflects the
   actual boot order, so the <code class="sgmltag-attvalue">cdrom</code> comes before the
   <code class="sgmltag-attvalue">hd</code> .
  </p><section class="sect2" id="sec-libvirt-config-bootorder-virsh" data-id-title="Changing boot order"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.5.1 </span><span class="title-name">Changing boot order</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-bootorder-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The VM Guest's boot order is represented through the order of devices in
    the XML configuration file. As the devices are interchangeable, it is
    possible to change the boot order of the VM Guest.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Open the VM Guest's XML configuration.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh edit sles15</code></pre></div></li><li class="step"><p>
      Change the sequence of the bootable devices.
     </p><div class="verbatim-wrap"><pre class="screen">...
&lt;boot dev='cdrom'/&gt;
&lt;boot dev='hd'/&gt;
...</pre></div></li><li class="step"><p>
      Check if the boot order was changed successfully by looking at the boot
      menu in the BIOS of the VM Guest.
     </p></li></ol></div></div></section><section class="sect2" id="sec-libvirt-config-directkernel-virsh" data-id-title="Using direct kernel boot"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.5.2 </span><span class="title-name">Using direct kernel boot</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-directkernel-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Direct Kernel Boot allows you to boot from a kernel and initrd stored on
    the host. Set the path to both files in the <code class="sgmltag-element">kernel</code> and
    <code class="sgmltag-element">initrd</code> elements:
   </p><div class="verbatim-wrap"><pre class="screen">&lt;os&gt;
    ...
  &lt;kernel&gt;/root/f8-i386-vmlinuz&lt;/kernel&gt;
  &lt;initrd&gt;/root/f8-i386-initrd&lt;/initrd&gt;
    ...
&lt;os&gt;</pre></div><p>
    To enable Direct Kernel Boot:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Open the VM Guest's XML configuration:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh edit sles15</code></pre></div></li><li class="step"><p>
      Inside the <code class="sgmltag-element">os</code> element, add a <code class="sgmltag-element">kernel</code> element and the
      path to the kernel file on the host:
     </p><div class="verbatim-wrap"><pre class="screen">...
&lt;kernel&gt;/root/f8-i386-vmlinuz&lt;/kernel&gt;
...</pre></div></li><li class="step"><p>
      Add an <code class="sgmltag-element">initrd</code> element and the path to the initrd file on the
      host:
     </p><div class="verbatim-wrap"><pre class="screen">...
&lt;initrd&gt;/root/f8-i386-initrd&lt;/initrd&gt;
...</pre></div></li><li class="step"><p>
      Start your VM to boot from the new kernel:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh start sles15</code></pre></div></li></ol></div></div></section></section><section class="sect1" id="sec-libvirt-config-memory-virsh" data-id-title="Configuring memory allocation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.6 </span><span class="title-name">Configuring memory allocation</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-memory-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The amount of memory allocated for the VM Guest can also be configured with
   <code class="command">virsh</code>. It is stored in the <code class="sgmltag-element">memory</code> element and defines the
   maximum allocation of memory for the VM Guest at boot time. The optional
   <code class="sgmltag-element">currentMemory</code> element defines the actual memory allocated to
   the VM Guest. <code class="sgmltag-element">currentMemory</code> can be less than <code class="sgmltag-element">memory</code>,
   allowing for increasing (or <span class="emphasis"><em>ballooning</em></span>) the memory while the VM Guest is
   running. If <code class="sgmltag-element">currentMemory</code> is omitted, it defaults to the same
   value as the <code class="sgmltag-element">memory</code> element.
  </p><p>
   You can adjust memory settings by editing the VM Guest configuration,
   but be aware that changes do not take place until the next boot. The
   following steps demonstrate changing a VM Guest to boot with 4G of
   memory, but allow later expansion to 8G:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Open the VM Guest's XML configuration:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh edit sles15</code></pre></div></li><li class="step"><p>
     Search for the <code class="sgmltag-element">memory</code> element and set to 8G:
    </p><div class="verbatim-wrap"><pre class="screen">...
&lt;memory unit='KiB'&gt;8388608&lt;/memory&gt;
...</pre></div></li><li class="step"><p>
     If the <code class="sgmltag-element">currentMemory</code> element does not exist, add it below
     the <code class="sgmltag-element">memory</code> element, or change its value to 4G:
    </p><div class="verbatim-wrap"><pre class="screen">[...]
&lt;memory unit='KiB'&gt;8388608&lt;/memory&gt;
&lt;currentMemory unit='KiB'&gt;4194304&lt;/currentMemory&gt;
[...]</pre></div></li></ol></div></div><p>
   Changing the memory allocation while the VM Guest is running can be done
   with the <code class="command">setmem</code> subcommand. The following example shows increasing the
   memory allocation to 8G:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Check VM Guest existing memory settings:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh dominfo sles15 | grep memory</code>
Max memory:     8388608 KiB
Used memory:    4194608 KiB</pre></div></li><li class="step"><p>
     Change the used memory to 8G:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh setmem sles15 8388608</code></pre></div></li><li class="step"><p>
     Check the updated memory settings:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh dominfo sles15 | grep memory</code>
Max memory:     8388608 KiB
Used memory:    8388608 KiB</pre></div></li></ol></div></div><div id="id-1.12.4.9.8.7" data-id-title="Large memory VM Guests" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Large memory VM Guests</div><p>
    VM Guests with memory requirements of 4TB or more must currently
    use the <code class="literal">host-passthrough</code> CPU model.
   </p></div></section><section class="sect1" id="sec-libvirt-config-pci-virsh" data-id-title="Adding a PCI device"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.7 </span><span class="title-name">Adding a PCI device</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-pci-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To assign a PCI device to VM Guest with <code class="command">virsh</code>, follow these steps:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Identify the host PCI device to assign to the VM Guest. In the following
     example, we are assigning a DEC network card to the guest:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">lspci -nn</code>
[...]
<span class="bold"><strong>03:07.0</strong></span> Ethernet controller [0200]: Digital Equipment Corporation DECchip \
21140 [FasterNet] [1011:0009] (rev 22)
[...]</pre></div><p>
     Write down the device ID (<code class="literal">03:07.0</code> in this case).
    </p></li><li class="step"><p>
     Gather detailed information about the device using <code class="command">virsh
     nodedev-dumpxml <em class="replaceable">ID</em></code>. To get the
     <em class="replaceable">ID</em>, replace the colon and the period in the
     device ID (<code class="literal">03:07.0</code>) with underscores. Prefix the result
     with <span class="quote">“<span class="quote">pci_0000_</span>”</span>: <code class="literal">pci_0000_03_07_0</code>.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh nodedev-dumpxml pci_0000_03_07_0</code>
&lt;device&gt;
  &lt;name&gt;pci_0000_03_07_0&lt;/name&gt;
  &lt;path&gt;/sys/devices/pci0000:00/0000:00:14.4/0000:03:07.0&lt;/path&gt;
  &lt;parent&gt;pci_0000_00_14_4&lt;/parent&gt;
  &lt;driver&gt;
    &lt;name&gt;tulip&lt;/name&gt;
  &lt;/driver&gt;
  &lt;capability type='pci'&gt;
    <span class="bold"><strong>&lt;domain&gt;0&lt;/domain&gt;
    &lt;bus&gt;3&lt;/bus&gt;
    &lt;slot&gt;7&lt;/slot&gt;
    &lt;function&gt;0&lt;/function&gt;</strong></span>
    &lt;product id='0x0009'&gt;DECchip 21140 [FasterNet]&lt;/product&gt;
    &lt;vendor id='0x1011'&gt;Digital Equipment Corporation&lt;/vendor&gt;
    &lt;numa node='0'/&gt;
  &lt;/capability&gt;
&lt;/device&gt;</pre></div><p>
     Write down the values for domain, bus, and function (see the previous XML
     code printed in bold).
    </p></li><li class="step"><p>
     Detach the device from the host system prior to attaching it to the
     VM Guest:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh nodedev-detach pci_0000_03_07_0</code>
  Device pci_0000_03_07_0 detached</pre></div><div id="id-1.12.4.9.9.3.3.3" data-id-title="Multi-function PCI devices" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Multi-function PCI devices</div><p>
      When using a multi-function PCI device that does not support FLR
      (function level reset) or PM (power management) reset, you need to detach
      all its functions from the VM Host Server. The whole device must be reset for
      security reasons. <code class="systemitem">libvirt</code> will refuse to assign
      the device if one of its functions is still in use by the VM Host Server or
      another VM Guest.
     </p></div></li><li class="step"><p>
     Convert the domain, bus, slot, and function value from decimal to
     hexadecimal. In our example, domain = 0, bus = 3, slot = 7, and function =
     0. Ensure that the values are inserted in the right order:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">printf "&lt;address domain='0x%x' bus='0x%x' slot='0x%x' function='0x%x'/&gt;\n" 0 3 7 0</code></pre></div><p>
     This results in:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;address domain='0x0' bus='0x3' slot='0x7' function='0x0'/&gt;</pre></div></li><li class="step"><p>
     Run <code class="command">virsh edit</code> on your domain, and add the following
     device entry in the <code class="literal">&lt;devices&gt;</code> section using the
     result from the previous step:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;hostdev mode='subsystem' type='pci' managed='yes'&gt;
  &lt;source&gt;
    &lt;address domain='0x0' bus='0x03' slot='0x07' function='0x0'/&gt;
  &lt;/source&gt;
&lt;/hostdev&gt;</pre></div><div id="tip-libvirt-config-pci-virsh-managed" data-id-title="managed compared to unmanaged" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: <code class="literal">managed</code> compared to <code class="literal">unmanaged</code></div><p>
      <code class="systemitem">libvirt</code> recognizes two modes for handling PCI
      devices: they can be either <code class="literal">managed</code> or
      <code class="literal">unmanaged</code>. In the managed case,
      <code class="systemitem">libvirt</code> handles all details of unbinding the
      device from the existing driver if needed, resetting the device, binding
      it to <code class="systemitem">vfio-pci</code> before starting the domain, etc.
      When the domain is terminated or the device is removed from the domain,
      <code class="systemitem">libvirt</code> unbinds from
      <code class="systemitem">vfio-pci</code> and rebinds to the original driver in
      the case of a managed device. If the device is unmanaged, the user must
      ensure all of these management aspects of the device are done before
      assigning it to a domain, and after the device is no longer used by the
      domain.
     </p></div><p>
     In the example above, the <code class="literal">managed='yes'</code> option means
     that the device is managed. To switch the device mode to unmanaged, set
     <code class="literal">managed='no'</code> in the listing above. If you do so, you
     need to take care of the related driver with the <code class="command">virsh
     nodedev-detach</code> and <code class="command">virsh nodedev-reattach</code>
     commands. Prior to starting the VM Guest you need to detach the device
     from the host by running <code class="command">virsh nodedev-detach
     pci_0000_03_07_0</code>. In case the VM Guest is not running, you can
     make the device available for the host by running <code class="command">virsh
     nodedev-reattach pci_0000_03_07_0</code>.
    </p></li><li class="step"><p>
     Shut down the VM Guest and disable SELinux if it is running on the host.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">setsebool -P virt_use_sysfs 1</code></pre></div></li><li class="step"><p>
     Start your VM Guest to make the assigned PCI device available:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh start sles15</code></pre></div></li></ol></div></div><div id="id-1.12.4.9.9.4" data-id-title="SLES11 SP4 KVM guests" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: SLES11 SP4 KVM guests</div><p>
    On a newer QEMU machine type (pc-i440fx-2.0 or higher) with SLES11 SP4
    KVM guests, the <code class="systemitem">acpiphp</code> module
    is not loaded by default in the guest. This module must be loaded to enable
    hotplugging of disk and network devices. To load the module manually, use
    the command <code class="command">modprobe acpiphp</code>. It is also possible to
    autoload the module by adding <code class="literal">install acpiphp /bin/true</code>
    to the <code class="filename">/etc/modprobe.conf.local</code> file.
   </p></div><div id="id-1.12.4.9.9.5" data-id-title="KVM guests using QEMU Q35 machine type" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: KVM guests using QEMU Q35 machine type</div><p>
    KVM guests using the QEMU Q35 machine type have a PCI topology that
    includes a <code class="literal">pcie-root</code> controller and seven
    <code class="literal">pcie-root-port</code> controllers. The
    <code class="literal">pcie-root</code> controller does not support hotplugging. Each
    <code class="literal">pcie-root-port</code> controller supports hotplugging a single
    PCIe device. PCI controllers cannot be hotplugged, so plan accordingly and
    add more <code class="literal">pcie-root-port</code>s if more than seven PCIe devices
    will be hotplugged. A <code class="literal">pcie-to-pci-bridge</code> controller can
    be added to support hotplugging legacy PCI devices. See
    <a class="link" href="https://libvirt.org/pci-hotplug.html" target="_blank">https://libvirt.org/pci-hotplug.html</a> for more
    information about PCI topology between QEMU machine types.
   </p></div><section class="sect2" id="tip-libvirt-config-zpci" data-id-title="PCI Pass-Through for IBM Z"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.7.1 </span><span class="title-name">PCI Pass-Through for IBM Z</span></span> <a title="Permalink" class="permalink" href="#tip-libvirt-config-zpci">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    In order to support IBM Z, QEMU extended PCI representation by
    allowing to configure extra attributes. Two more
    attributes—<code class="option">uid</code> and <code class="option">fid</code>—were
    added to the <code class="literal">&lt;zpci/&gt;</code> <code class="systemitem">libvirt</code> specification.
    <code class="option">uid</code> represents user-defined identifier, while
    <code class="option">fid</code> represents PCI function identifier. These attributes
    are optional and if you do not specify them, they are automatically
    generated with non-conflicting values.
   </p><p>
    To include zPCI attribute in your domain specification, use the following
    example definition:
   </p><div class="verbatim-wrap"><pre class="screen">&lt;controller type='pci' index='0' model='pci-root'/&gt;
&lt;controller type='pci' index='1' model='pci-bridge'&gt;
  &lt;model name='pci-bridge'/&gt;
  &lt;target chassisNr='1'/&gt;
  &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x0'&gt;
    &lt;zpci uid='0x0001' fid='0x00000000'/&gt;
  &lt;/address&gt;
&lt;/controller&gt;
&lt;interface type='bridge'&gt;
  &lt;source bridge='virbr0'/&gt;
  &lt;model type='virtio'/&gt;
  &lt;address type='pci' domain='0x0000' bus='0x01' slot='0x01' function='0x0'&gt;
    &lt;zpci uid='0x0007' fid='0x00000003'/&gt;
  &lt;/address&gt;
&lt;/interface&gt;</pre></div></section></section><section class="sect1" id="sec-libvirt-config-usb-virsh" data-id-title="Adding a USB device"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.8 </span><span class="title-name">Adding a USB device</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-usb-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To assign a USB device to VM Guest using <code class="command">virsh</code>, follow these steps:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Identify the host USB device to assign to the VM Guest:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">lsusb</code>
[...]
Bus 001 Device 003: ID <span class="bold"><strong>0557:2221</strong></span> ATEN International Co., Ltd Winbond Hermon
[...]</pre></div><p>
     Write down the vendor and product IDs. In our example, the vendor ID is
     <code class="literal">0557</code> and the product ID is <code class="literal">2221</code>.
    </p></li><li class="step"><p>
     Run <code class="command">virsh edit</code> on your domain, and add the following
     device entry in the <code class="literal">&lt;devices&gt;</code> section using the
     values from the previous step:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;hostdev mode='subsystem' type='usb'&gt;
  &lt;source startupPolicy='optional'&gt;
   <span class="bold"><strong>&lt;vendor id='0557'/&gt;
   &lt;product id='2221'/&gt;</strong></span>
  &lt;/source&gt;
&lt;/hostdev&gt;</pre></div><div id="id-1.12.4.9.10.3.2.3" data-id-title="Vendor/product or devices address" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Vendor/product or device's address</div><p>
      Instead of defining the host device with
      <code class="sgmltag-emptytag">&lt;vendor/&gt;</code> and
      <code class="sgmltag-emptytag">&lt;product/&gt;</code> IDs, you can use the
      <code class="sgmltag-emptytag">&lt;address/&gt;</code> element as described for host PCI
      devices in <a class="xref" href="#sec-libvirt-config-pci-virsh" title="15.7. Adding a PCI device">Section 15.7, “Adding a PCI device”</a>.
     </p></div></li><li class="step"><p>
     Shut down the VM Guest and disable SELinux if it is running on the host:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">setsebool -P virt_use_sysfs 1</code></pre></div></li><li class="step"><p>
     Start your VM Guest to make the assigned PCI device available:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh start sles15</code></pre></div></li></ol></div></div></section><section class="sect1" id="sec-libvirt-config-io" data-id-title="Adding SR-IOV devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.9 </span><span class="title-name">Adding SR-IOV devices</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-io">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Single Root I/O Virtualization (<a class="xref" href="#vt-io-sriov">SR-IOV</a>) capable
   <a class="xref" href="#gloss-vt-acronym-pcie" title="PCIe">PCIe</a> devices can replicate their
   resources, so they appear to be multiple devices. Each of these
   <span class="quote">“<span class="quote">pseudo-devices</span>”</span> can be assigned to a VM Guest.
  </p><p>
   <a class="xref" href="#vt-io-sriov">SR-IOV</a> is an industry specification that was created
   by the Peripheral Component Interconnect Special Interest Group (PCI-SIG)
   consortium. It introduces physical functions (PF) and virtual functions
   (VF). PFs are full <a class="xref" href="#gloss-vt-acronym-pcie" title="PCIe">PCIe</a> functions used to
   manage and configure the device. PFs also can move data. VFs lack the
   configuration and management part—they only can move data and a reduced set
   of configuration functions. As VFs do not have all
   <a class="xref" href="#gloss-vt-acronym-pcie" title="PCIe">PCIe</a> functions, the host operating system
   or the <a class="xref" href="#gloss-vt-hypervisor" title="Hypervisor">Hypervisor</a> must support
   <a class="xref" href="#vt-io-sriov">SR-IOV</a> to be able to access and initialize VFs. The
   theoretical maximum for VFs is 256 per device (consequently the maximum for
   a dual-port Ethernet card would be 512). In practice this maximum is much
   lower, since each VF consumes resources.
  </p><section class="sect2" id="sec-libvirt-config-io-requirements" data-id-title="Requirements"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.9.1 </span><span class="title-name">Requirements</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-io-requirements">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following requirements must be met to use
    <a class="xref" href="#vt-io-sriov">SR-IOV</a>:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      An <a class="xref" href="#vt-io-sriov">SR-IOV</a>-capable network card (as of
      <span class="productname"><span class="phrase">SUSE Linux Enterprise
      Server</span></span>
      <span class="productnumber"><span class="phrase">15</span></span>,
      only network cards support <a class="xref" href="#vt-io-sriov">SR-IOV</a>)
     </p></li><li class="listitem"><p>
      An AMD64/Intel 64 host supporting hardware virtualization (AMD-V or Intel
      VT-x)<span class="phrase">, see
      <a class="xref" href="#sec-kvm-requires-hardware" title="7.1.1. KVM hardware requirements">Section 7.1.1, “KVM hardware requirements”</a> for more information</span>
     </p></li><li class="listitem"><p>
      A chipset that supports device assignment (AMD-Vi or Intel
      <a class="xref" href="#gloss-vt-acronym-vtd" title="VT-d">VT-d</a>)
     </p></li><li class="listitem"><p>
      <code class="systemitem">libvirt</code> 0.9.10 or better
     </p></li><li class="listitem"><p>
      <a class="xref" href="#vt-io-sriov">SR-IOV</a> drivers must be loaded and configured on
      the host system
     </p></li><li class="listitem"><p>
      A host configuration that meets the requirements listed at
      <a class="xref" href="#ann-vt-io-require" title="Important: Requirements for VFIO and SR-IOV">Important: Requirements for VFIO and SR-IOV</a>
     </p></li><li class="listitem"><p>
      A list of the PCI addresses of the VF(s) that will be assigned to
      VM Guests
     </p></li></ul></div><div id="id-1.12.4.9.11.4.4" data-id-title="Checking if a device is SR-IOV-capable" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Checking if a device is SR-IOV-capable</div><p>
     The information whether a device is SR-IOV-capable can be obtained from
     its PCI descriptor by running <code class="command">lspci</code>. A device that
     supports <a class="xref" href="#vt-io-sriov">SR-IOV</a> reports a capability similar to the
     following:
    </p><div class="verbatim-wrap"><pre class="screen">Capabilities: [160 v1] Single Root I/O Virtualization (<a class="xref" href="#vt-io-sriov">SR-IOV</a>)</pre></div></div><div id="id-1.12.4.9.11.4.5" data-id-title="Adding an SR-IOV device at VM Guest creation" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Adding an SR-IOV device at VM Guest creation</div><p>
     Before adding an SR-IOV device to a VM Guest when initially setting it
     up, the VM Host Server already needs to be configured as described in
     <a class="xref" href="#sec-libvirt-config-io-config" title="15.9.2. Loading and configuring the SR-IOV host drivers">Section 15.9.2, “Loading and configuring the SR-IOV host drivers”</a>.
    </p></div></section><section class="sect2" id="sec-libvirt-config-io-config" data-id-title="Loading and configuring the SR-IOV host drivers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.9.2 </span><span class="title-name">Loading and configuring the SR-IOV host drivers</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-io-config">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To access and initialize VFs, an SR-IOV-capable driver needs to be loaded
    on the host system.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Before loading the driver, make sure the card is properly detected by
      running <code class="command">lspci</code>. The following example shows the
      <code class="command">lspci</code> output for the dual-port Intel 82576NS network
      card:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">/sbin/lspci | grep 82576</code>
01:00.0 Ethernet controller: Intel Corporation 82576NS Gigabit Network Connection (rev 01)
01:00.1 Ethernet controller: Intel Corporation 82576NS Gigabit Network Connection (rev 01)
04:00.0 Ethernet controller: Intel Corporation 82576NS Gigabit Network Connection (rev 01)
04:00.1 Ethernet controller: Intel Corporation 82576NS Gigabit Network Connection (rev 01)</pre></div><p>
      In case the card is not detected, it is likely that the hardware
      virtualization support in the BIOS/EFI has not been enabled. To check if
      hardware virtualization support is enabled, look at the settings in the
      host's BIOS.
     </p></li><li class="step"><p>
      Check whether the <a class="xref" href="#vt-io-sriov">SR-IOV</a> driver is already loaded
      by running <code class="command">lsmod</code>. In the following example a check for
      the igb driver (for the Intel 82576NS network card) returns a result.
      That means the driver is already loaded. If the command returns nothing,
      the driver is not loaded.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">/sbin/lsmod | egrep "^igb "</code>
igb                   185649  0</pre></div></li><li class="step"><p>
      Skip the following step if the driver is already loaded. If the
      <a class="xref" href="#vt-io-sriov">SR-IOV</a> driver is not yet loaded, the
      non-<a class="xref" href="#vt-io-sriov">SR-IOV</a> driver needs to be removed first,
      before loading the new driver. Use <code class="command">rmmod</code> to unload a
      driver. The following example unloads the
      non-<a class="xref" href="#vt-io-sriov">SR-IOV</a> driver for the Intel 82576NS network
      card:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">/sbin/rmmod igbvf</code></pre></div></li><li class="step"><p>
      Load the <a class="xref" href="#vt-io-sriov">SR-IOV</a> driver subsequently using the
      <code class="command">modprobe</code> command—the VF parameter
      (<code class="literal">max_vfs</code>) is mandatory:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">/sbin/modprobe igb max_vfs=8</code></pre></div></li></ol></div></div><p>
    As an alternative, you can also load the driver via SYSFS:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Find the PCI ID of the physical NIC by listing Ethernet devices:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">lspci | grep Eth</code>
06:00.0 Ethernet controller: Emulex Corporation OneConnect NIC (Skyhawk) (rev 10)
06:00.1 Ethernet controller: Emulex Corporation OneConnect NIC (Skyhawk) (rev 10)</pre></div></li><li class="step"><p>
      To enable VFs, echo the number of desired VFs to load to the
      <code class="literal">sriov_numvfs</code> parameter:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">echo 1 &gt; /sys/bus/pci/devices/0000:06:00.1/sriov_numvfs</code></pre></div></li><li class="step"><p>
      Verify that the VF NIC was loaded:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">lspci | grep Eth</code>
06:00.0 Ethernet controller: Emulex Corporation OneConnect NIC (Skyhawk) (rev 10)
06:00.1 Ethernet controller: Emulex Corporation OneConnect NIC (Skyhawk) (rev 10)
06:08.0 Ethernet controller: Emulex Corporation OneConnect NIC (Skyhawk) (rev 10)</pre></div></li><li class="step"><p>
      Obtain the maximum number of VFs available:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">lspci -vvv -s 06:00.1 | grep 'Initial VFs'</code>
                       Initial VFs: 32, Total VFs: 32, Number of VFs: 0,
Function Dependency Link: 01</pre></div></li><li class="step"><p>
      Create a <code class="filename">/etc/systemd/system/before.service</code> file
      which loads VF via SYSFS on boot:
     </p><div class="verbatim-wrap"><pre class="screen">[Unit]
Before=
[Service]
Type=oneshot
RemainAfterExit=true
ExecStart=/bin/bash -c "echo 1 &gt; /sys/bus/pci/devices/0000:06:00.1/sriov_numvfs"
# beware, executable is run directly, not through a shell, check the man pages
# systemd.service and systemd.unit for full syntax
[Install]
# target in which to start the service
WantedBy=multi-user.target
#WantedBy=graphical.target</pre></div></li><li class="step"><p>
      Prior to starting the VM, it is required to create another service file
      (<code class="filename">after-local.service</code>) pointing to the
      <code class="filename">/etc/init.d/after.local</code> script that detaches the
      NIC. Otherwise the VM would fail to start:
     </p><div class="verbatim-wrap"><pre class="screen">[Unit]
Description=/etc/init.d/after.local Compatibility
After=libvirtd.service
Requires=libvirtd.service
[Service]
Type=oneshot
ExecStart=/etc/init.d/after.local
RemainAfterExit=true

[Install]
WantedBy=multi-user.target</pre></div></li><li class="step"><p>
      Copy it to <code class="filename">/etc/systemd/system</code>.
     </p><div class="verbatim-wrap"><pre class="screen">#! /bin/sh
# ...
virsh nodedev-detach pci_0000_06_08_0</pre></div><p>
      Save it as <code class="filename">/etc/init.d/after.local</code>.
     </p></li><li class="step"><p>
      Reboot the machine and check if the SR-IOV driver is loaded by re-running
      the <code class="command">lspci</code> command from the first step of this
      procedure. If the SR-IOV driver was loaded successfully you should see
      additional lines for the VFs:
     </p><div class="verbatim-wrap"><pre class="screen">01:00.0 Ethernet controller: Intel Corporation 82576NS Gigabit Network Connection (rev 01)
01:00.1 Ethernet controller: Intel Corporation 82576NS Gigabit Network Connection (rev 01)
01:10.0 Ethernet controller: Intel Corporation 82576 Virtual Function (rev 01)
01:10.1 Ethernet controller: Intel Corporation 82576 Virtual Function (rev 01)
01:10.2 Ethernet controller: Intel Corporation 82576 Virtual Function (rev 01)
[...]
04:00.0 Ethernet controller: Intel Corporation 82576NS Gigabit Network Connection (rev 01)
04:00.1 Ethernet controller: Intel Corporation 82576NS Gigabit Network Connection (rev 01)
04:10.0 Ethernet controller: Intel Corporation 82576 Virtual Function (rev 01)
04:10.1 Ethernet controller: Intel Corporation 82576 Virtual Function (rev 01)
04:10.2 Ethernet controller: Intel Corporation 82576 Virtual Function (rev 01)
[...]</pre></div></li></ol></div></div></section><section class="sect2" id="sec-libvirt-config-io-attach" data-id-title="Adding a VF network device to a VM Guest"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.9.3 </span><span class="title-name">Adding a VF network device to a VM Guest</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-io-attach">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When the <a class="xref" href="#vt-io-sriov">SR-IOV</a> hardware is properly set up on the
    VM Host Server, you can add VFs to VM Guests. To do so, you need to collect some
    data first.
   </p><div class="procedure" id="id-1.12.4.9.11.6.3" data-id-title="Adding a VF network device to an existing VM Guest"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 15.2: </span><span class="title-name">Adding a VF network device to an existing VM Guest </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.9.11.6.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
     The following procedure uses example data. Make sure to replace it by
     appropriate data from your setup.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Use the <code class="command">virsh nodedev-list</code> command to get the PCI
      address of the VF you want to assign and its corresponding PF. Numerical
      values from the <code class="command">lspci</code> output shown in
      <a class="xref" href="#sec-libvirt-config-io-config" title="15.9.2. Loading and configuring the SR-IOV host drivers">Section 15.9.2, “Loading and configuring the SR-IOV host drivers”</a> (for example
      <code class="literal">01:00.0</code> or <code class="literal">04:00.1</code>) are transformed
      by adding the prefix "pci_0000_" and by replacing colons and dots with
      underscores. So a PCI ID listed as "04:00.0" by <code class="command">lspci</code>
      is listed as "pci_0000_04_00_0" by virsh. The following example lists the
      PCI IDs for the second port of the Intel 82576NS network card:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh nodedev-list | grep 0000_04_</code>
<span class="bold"><strong>pci_0000_04_00_0</strong></span>
<span class="bold"><strong>pci_0000_04_00_1</strong></span>
pci_0000_04_10_0
pci_0000_04_10_1
pci_0000_04_10_2
pci_0000_04_10_3
pci_0000_04_10_4
pci_0000_04_10_5
pci_0000_04_10_6
pci_0000_04_10_7
pci_0000_04_11_0
pci_0000_04_11_1
pci_0000_04_11_2
pci_0000_04_11_3
pci_0000_04_11_4
pci_0000_04_11_5</pre></div><p>
      The first two entries represent the <span class="bold"><strong>PFs</strong></span>,
      whereas the other entries represent the VFs.
     </p></li><li class="step"><p>
      Run the following <code class="command">virsh nodedev-dumpxml</code> command on the
      PCI ID of the VF you want to add:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh nodedev-dumpxml pci_0000_04_10_0</code>
&lt;device&gt;
  &lt;name&gt;pci_0000_04_10_0&lt;/name&gt;
  &lt;parent&gt;pci_0000_00_02_0&lt;/parent&gt;
  &lt;capability type='pci'&gt;
    <span class="bold"><strong>&lt;domain&gt;0&lt;/domain&gt;
    &lt;bus&gt;4&lt;/bus&gt;
    &lt;slot&gt;16&lt;/slot&gt;
    &lt;function&gt;0&lt;/function&gt;</strong></span>
    &lt;product id='0x10ca'&gt;82576 Virtual Function&lt;/product&gt;
    &lt;vendor id='0x8086'&gt;Intel Corporation&lt;/vendor&gt;
    &lt;capability type='phys_function'&gt;
      &lt;address domain='0x0000' bus='0x04' slot='0x00' function='0x0'/&gt;
    &lt;/capability&gt;
  &lt;/capability&gt;
&lt;/device&gt;</pre></div><p>
      The following data is needed for the next step:
     </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        <code class="literal">&lt;domain&gt;0&lt;/domain&gt;</code>
       </p></li><li class="listitem"><p>
        <code class="literal">&lt;bus&gt;4&lt;/bus&gt;</code>
       </p></li><li class="listitem"><p>
        <code class="literal">&lt;slot&gt;16&lt;/slot&gt;</code>
       </p></li><li class="listitem"><p>
        <code class="literal">&lt;function&gt;0&lt;/function&gt;</code>
       </p></li></ul></div></li><li class="step"><p>
      Create a temporary XML file (for example
      <code class="filename">/tmp/vf-interface.xml</code> containing the data necessary
      to add a VF network device to an existing VM Guest. The minimal content
      of the file needs to look like the following:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;interface type='hostdev'&gt;<span class="callout" id="sriov-iface">1</span>
 &lt;source&gt;
  &lt;address type='pci' domain='0' bus='11' slot='16' function='0'2/&gt;<span class="callout" id="sriov-data">2</span>
 &lt;/source&gt;
&lt;/interface&gt;</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#sriov-iface"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        VFs do not get a fixed MAC address; it changes every time the host
        reboots. When adding network devices the <span class="quote">“<span class="quote">traditional</span>”</span> way
        with <code class="sgmltag-attribute">hostdev</code>, it would require to
        reconfigure the VM Guest's network device after each reboot of the
        host, because of the MAC address change. To avoid this kind of problem,
        <code class="systemitem">libvirt</code> introduced the <code class="sgmltag-attvalue">hostdev</code> value,
        which sets up network-specific data <span class="emphasis"><em>before</em></span>
        assigning the device.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#sriov-data"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Specify the data you acquired in the previous step here.
       </p></td></tr></table></div></li><li class="step"><p>
      In case a device is already attached to the host, it cannot be attached
      to a VM Guest. To make it available for guests, detach it from the host
      first:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh nodedev-detach pci_0000_04_10_0</code></pre></div></li><li class="step"><p>
      Add the VF interface to an existing VM Guest:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh attach-device <em class="replaceable">GUEST</em> /tmp/vf-interface.xml --<em class="replaceable">OPTION</em></code></pre></div><p>
      <em class="replaceable">GUEST</em> needs to be replaced by the domain name,
      ID or UUID of the VM Guest. --<em class="replaceable">OPTION</em> can be
      one of the following:
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.9.11.6.3.7.4.1"><span class="term"><code class="option">--persistent</code></span></dt><dd><p>
         This option will always add the device to the domain's persistent XML.
         In addition, if the domain is running, it will be hotplugged.
        </p></dd><dt id="id-1.12.4.9.11.6.3.7.4.2"><span class="term"><code class="option">--config</code></span></dt><dd><p>
         This option will only affect the persistent XML, even if the domain is
         running. The device will only show up in the VM Guest on next boot.
        </p></dd><dt id="id-1.12.4.9.11.6.3.7.4.3"><span class="term"><code class="option">--live</code></span></dt><dd><p>
         This option will only affect a running domain. If the domain is
         inactive, the operation will fail. The device is not persisted in the
         XML and will not be available in the VM Guest on next boot.
        </p></dd><dt id="id-1.12.4.9.11.6.3.7.4.4"><span class="term"><code class="option">--current</code></span></dt><dd><p>
         This option affects the current state of the domain. If the domain is
         inactive, the device is added to the persistent XML and will be
         available on next boot. If the domain is active, the device is
         hotplugged but not added to the persistent XML.
        </p></dd></dl></div></li><li class="step"><p>
      To detach a VF interface, use the <code class="command">virsh detach-device</code>
      command, which also takes the options listed above.
     </p></li></ol></div></div></section><section class="sect2" id="libvirt-config-io-pool" data-id-title="Dynamic allocation of VFs from a pool"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.9.4 </span><span class="title-name">Dynamic allocation of VFs from a pool</span></span> <a title="Permalink" class="permalink" href="#libvirt-config-io-pool">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you define the PCI address of a VF into a VM Guest's configuration
    statically as described in <a class="xref" href="#sec-libvirt-config-io-attach" title="15.9.3. Adding a VF network device to a VM Guest">Section 15.9.3, “Adding a VF network device to a VM Guest”</a>,
    it is hard to migrate such guest to another host. The host must have
    identical hardware in the same location on the PCI bus, or the VM Guest
    configuration must be modified prior to each start.
   </p><p>
    Another approach is to create a <code class="systemitem">libvirt</code> network with a device pool that
    contains all the VFs of an <a class="xref" href="#vt-io-sriov">SR-IOV</a> device. The
    VM Guest then references this network, and each time it is started, a
    single VF is dynamically allocated to it. When the VM Guest is stopped,
    the VF is returned to the pool, available for another guest.
   </p><section class="sect3" id="libvirt-config-io-pool-host" data-id-title="Defining network with pool of VFs on VM Host Server"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.9.4.1 </span><span class="title-name">Defining network with pool of VFs on VM Host Server</span></span> <a title="Permalink" class="permalink" href="#libvirt-config-io-pool-host">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The following example of network definition creates a pool of all VFs for
     the <a class="xref" href="#vt-io-sriov">SR-IOV</a> device with its physical function (PF)
     at the network interface <code class="literal">eth0</code> on the host:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;network&gt;
  &lt;name&gt;passthrough&lt;/name&gt;
    &lt;forward mode='hostdev' managed='yes'&gt;
      &lt;pf dev='eth0'/&gt;
    &lt;/forward&gt;
  &lt;/network&gt;</pre></div><p>
     To use this network on the host, save the above code to a file, for
     example <code class="filename">/tmp/passthrough.xml</code>, and execute the
     following commands. Remember to replace <code class="literal">eth0</code> with the
     real network interface name of your <a class="xref" href="#vt-io-sriov">SR-IOV</a> device's
     PF:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh net-define /tmp/passthrough.xml</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh net-autostart passthrough</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh net-start passthrough</code></pre></div></section><section class="sect3" id="libvirt-config-io-pool-guest" data-id-title="Configuring VM Guests to use VF from the pool"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.9.4.2 </span><span class="title-name">Configuring VM Guests to use VF from the pool</span></span> <a title="Permalink" class="permalink" href="#libvirt-config-io-pool-guest">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The following example of VM Guest device interface definition uses a VF
     of the <a class="xref" href="#vt-io-sriov">SR-IOV</a> device from the pool created in
     <a class="xref" href="#libvirt-config-io-pool-host" title="15.9.4.1. Defining network with pool of VFs on VM Host Server">Section 15.9.4.1, “Defining network with pool of VFs on VM Host Server”</a>. <code class="systemitem">libvirt</code> automatically
     derives the list of all VFs associated with that PF the first time the
     guest is started.
    </p><div class="verbatim-wrap"><pre class="screen">&lt;interface type='network'&gt;
  &lt;source network='passthrough'&gt;
&lt;/interface&gt;</pre></div><p>
     After the first VM Guest starts that uses the network with the pool of
     VFs, verify the list of associated VFs. Do so by running <code class="command">virsh
     net-dumpxml passthrough</code> on the host.
    </p><div class="verbatim-wrap"><pre class="screen">&lt;network connections='1'&gt;
  &lt;name&gt;passthrough&lt;/name&gt;
  &lt;uuid&gt;a6a26429-d483-d4ed-3465-4436ac786437&lt;/uuid&gt;
  &lt;forward mode='hostdev' managed='yes'&gt;
    &lt;pf dev='eth0'/&gt;
    &lt;address type='pci' domain='0x0000' bus='0x02' slot='0x10' function='0x1'/&gt;
    &lt;address type='pci' domain='0x0000' bus='0x02' slot='0x10' function='0x3'/&gt;
    &lt;address type='pci' domain='0x0000' bus='0x02' slot='0x10' function='0x5'/&gt;
    &lt;address type='pci' domain='0x0000' bus='0x02' slot='0x10' function='0x7'/&gt;
    &lt;address type='pci' domain='0x0000' bus='0x02' slot='0x11' function='0x1'/&gt;
    &lt;address type='pci' domain='0x0000' bus='0x02' slot='0x11' function='0x3'/&gt;
    &lt;address type='pci' domain='0x0000' bus='0x02' slot='0x11' function='0x5'/&gt;
  &lt;/forward&gt;
  &lt;/network&gt;</pre></div></section></section></section><section class="sect1" id="libvirt-config-listing-host-devs" data-id-title="Listing attached devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.10 </span><span class="title-name">Listing attached devices</span></span> <a title="Permalink" class="permalink" href="#libvirt-config-listing-host-devs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Although there is no mechanism in <code class="command">virsh</code> to list all VM Host Server's devices
   that have already been attached to its VM Guests, you can list all devices
   attached to a specific VM Guest by running the following command:
  </p><div class="verbatim-wrap"><pre class="screen">virsh dumpxml <em class="replaceable">VMGUEST_NAME</em> | xpath -e /domain/devices/hostdev</pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh dumpxml sles12 | -e xpath /domain/devices/hostdev
Found 2 nodes:
-- NODE --
&lt;hostdev mode="subsystem" type="pci" managed="yes"&gt;
  &lt;driver name="xen" /&gt;
  &lt;source&gt;
    &lt;address domain="0x0000" bus="0x0a" slot="0x10" function="0x1" /&gt;
  &lt;/source&gt;
  &lt;address type="pci" domain="0x0000" bus="0x00" slot="0x0a" function="0x0" /&gt;
  &lt;/hostdev&gt;
-- NODE --
&lt;hostdev mode="subsystem" type="pci" managed="yes"&gt;
  &lt;driver name="xen" /&gt;
  &lt;source&gt;
    &lt;address domain="0x0000" bus="0x0a" slot="0x10" function="0x2" /&gt;
  &lt;/source&gt;
  &lt;address type="pci" domain="0x0000" bus="0x00" slot="0x0b" function="0x0" /&gt;
&lt;/hostdev&gt;</pre></div><div id="libvirt-config-listing-host-devs-sriov" data-id-title="Listing SR-IOV devices attached via interface type=hostdev" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Listing SR-IOV devices attached via <code class="literal">&lt;interface type='hostdev'&gt;</code></div><p>
    For SR-IOV devices that are attached to the VM Host Server by means of
    <code class="literal">&lt;interface type='hostdev'&gt;</code>, you need to use a
    different XPath query:
   </p><div class="verbatim-wrap"><pre class="screen">virsh dumpxml <em class="replaceable">VMGUEST_NAME</em> | xpath -e /domain/devices/interface/@type</pre></div></div></section><section class="sect1" id="libvirt-config-storage-virsh" data-id-title="Configuring storage devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.11 </span><span class="title-name">Configuring storage devices</span></span> <a title="Permalink" class="permalink" href="#libvirt-config-storage-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Storage devices are defined within the <code class="sgmltag-element">disk</code> element. The usual
   <code class="sgmltag-element">disk</code> element supports several attributes. The following two
   attributes are the most important:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     The <code class="sgmltag-attribute">type</code> attribute describes the source of
     the virtual disk device. Valid values are <code class="sgmltag-attvalue">file</code>
     , <code class="sgmltag-attvalue">block</code> , <code class="sgmltag-attvalue">dir</code> ,
     <code class="sgmltag-attvalue">network</code> , or
     <code class="sgmltag-attvalue">volume</code> .
    </p></li><li class="listitem"><p>
     The <code class="sgmltag-attribute">device</code> attribute indicates how the disk
     is exposed to the VM Guest OS. As an example, possible values can include
     <code class="sgmltag-attvalue">floppy</code> ,
     <code class="sgmltag-attvalue">disk</code> , <code class="sgmltag-attvalue">cdrom</code> , and
     others.
    </p></li></ul></div><p>
   The following child elements are the most important:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="sgmltag-element">driver</code> contains the driver and the bus. These are used by the
     VM Guest to work with the new disk device.
    </p></li><li class="listitem"><p>
     The <code class="sgmltag-element">target</code> element contains the device name under which the new
     disk is shown in the VM Guest. It also contains the optional bus
     attribute, which defines the type of bus on which the new disk should
     operate.
    </p></li></ul></div><p>
   The following procedure shows how to add storage devices to the VM Guest:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Edit the configuration for an existing VM Guest:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh edit sles15</code></pre></div></li><li class="step"><p>
     Add a <code class="sgmltag-element">disk</code> element inside the <code class="sgmltag-element">disk</code> element together
     with the attributes <code class="sgmltag-attvalue">type</code> and
     <code class="sgmltag-attvalue">device</code>:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;disk type='file' device='disk'&gt;</pre></div></li><li class="step"><p>
     Specify a <code class="sgmltag-element">driver</code> element and use the default values:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;driver name='qemu' type='qcow2'/&gt;</pre></div></li><li class="step"><p>
     Create a disk image, which will be used as a source for the new virtual
     disk device:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">qemu-img create -f qcow2 /var/lib/libvirt/images/sles15.qcow2 32G</code></pre></div></li><li class="step"><p>
     Add the path for the disk source:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;source file='/var/lib/libvirt/images/sles15.qcow2'/&gt;</pre></div></li><li class="step"><p>
     Define the target device name in the VM Guest and the bus on which the
     disk should work:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;target dev='vda' bus='virtio'/&gt;</pre></div></li><li class="step"><p>
     Restart your VM:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh start sles15</code></pre></div></li></ol></div></div><p>
   Your new storage device should be available in the VM Guest OS.
  </p></section><section class="sect1" id="sec-libvirt-config-controllers-virsh" data-id-title="Configuring controller devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.12 </span><span class="title-name">Configuring controller devices</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-controllers-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">libvirt</code> generally manages controllers automatically based
   on the type of virtual devices used by the VM Guest. If the VM Guest
   contains PCI and SCSI devices, PCI and SCSI controllers will be created and
   managed automatically. <code class="command">libvirt</code> will also model
   controllers that are hypervisor-specific, for example, a
   <code class="literal">virtio-serial</code> controller for KVM VM Guests or a
   <code class="literal">xenbus</code> controller for Xen VM Guests. Although the
   default controllers and their configuration are generally fine, there may be
   use cases where controllers or their attributes need to be adjusted
   manually. For example, a virtio-serial controller may need more ports, or a
   xenbus controller may need more memory or more virtual interrupts.
  </p><p>
   The xenbus controller is unique in that it serves as the controller for all
   Xen paravirtual devices. If a VM Guest has many disk and/or network
   devices, the controller may need more memory. Xen's
   <code class="literal">max_grant_frames</code> attribute sets how many grant frames, or
   blocks of shared memory, are allocated to the <code class="literal">xenbus</code>
   controller for each VM Guest.
  </p><p>
   The default of 32 is enough in most circumstances, but a VM Guest with a
   large number of I/O devices and an I/O-intensive workload may experience
   performance issues because of grant frame exhaustion. The
   <code class="command">xen-diag</code> can be used to check the current and maximum
   <code class="literal">max_grant_frames</code> values for dom0 and your VM Guests. The
   VM Guests must be running:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh list
 Id   Name             State
--------------------------------
 0    Domain-0         running
 3    sle15sp1         running

 <code class="prompt user">&gt; </code><code class="command">sudo</code> xen-diag gnttab_query_size 0
domid=0: nr_frames=1, max_nr_frames=256

<code class="prompt user">&gt; </code><code class="command">sudo</code> xen-diag gnttab_query_size 3
domid=3: nr_frames=3, max_nr_frames=32</pre></div><p>
   The <code class="literal">sle15sp1</code> guest is using only three frames out of 32.
   If you are seeing performance issues, and log entries that point to
   insufficient frames, increase the value with <code class="command">virsh</code>. Look for the
   <code class="literal">&lt;controller type='xenbus'&gt;</code> line in the guest's
   configuration file, and add the <code class="literal">maxGrantFrames</code> control
   element:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh edit sle15sp1
 &lt;controller type='xenbus' index='0' maxGrantFrames='40'/&gt;</pre></div><p>
   Save your changes and restart the guest. Now it should show your change:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xen-diag gnttab_query_size 3
domid=3: nr_frames=3, max_nr_frames=40</pre></div><p>
   Similar to maxGrantFrames, the xenbus controller also supports
   <code class="option">maxEventChannels</code>. Event channels are like paravirtual
   interrupts, and in conjunction with grant frames, form a data transfer
   mechanism for paravirtual drivers. They are also used for inter-processor
   interrupts. VM Guests with a large number of vCPUs and/or many paravirtual
   devices may need to increase the maximum default value of 1023.
   maxEventChannels can be changed similarly to maxGrantFrames:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh edit sle15sp1
 &lt;controller type='xenbus' index='0' maxGrantFrames='128' maxEventChannels='2047'/&gt;</pre></div><p>
   See the <em class="citetitle">Controllers</em> section of the libvirt
   <em class="citetitle">Domain XML format</em> manual at
   <a class="link" href="https://libvirt.org/formatdomain.html#elementsControllers" target="_blank">https://libvirt.org/formatdomain.html#elementsControllers</a>
   for more information.
  </p></section><section class="sect1" id="libvirt-video-virsh" data-id-title="Configuring video devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.13 </span><span class="title-name">Configuring video devices</span></span> <a title="Permalink" class="permalink" href="#libvirt-video-virsh">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When using the Virtual Machine Manager, only the Video device model can be
   defined. The amount of allocated VRAM or 2D/3D acceleration can only be
   changed in the XML configuration.
  </p><section class="sect2" id="libvirt-video-vram-virsh" data-id-title="Changing the amount of allocated VRAM"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.13.1 </span><span class="title-name">Changing the amount of allocated VRAM</span></span> <a title="Permalink" class="permalink" href="#libvirt-video-vram-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Edit the configuration for an existing VM Guest:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh edit sles15</code></pre></div></li><li class="step"><p>
      Change the size of the allocated VRAM:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;video&gt;
&lt;model type='vga' vram='65535' heads='1'&gt;
...
&lt;/model&gt;
&lt;/video&gt;</pre></div></li><li class="step"><p>
      Check if the amount of VRAM in the VM has changed by looking at the
      amount in the Virtual Machine Manager.
     </p></li></ol></div></div></section><section class="sect2" id="libvirt-video-accel-virsh" data-id-title="Changing the state of 2D/3D acceleration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.13.2 </span><span class="title-name">Changing the state of 2D/3D acceleration</span></span> <a title="Permalink" class="permalink" href="#libvirt-video-accel-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Edit the configuration for an existing VM Guest:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">virsh edit sles15</code></pre></div></li><li class="step"><p>
      To enable/disable 2D/3D acceleration, change the value of
      <code class="literal">accel3d</code> and <code class="literal">accel2d</code> accordingly:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;video&gt;
&lt;acceleration accel3d='yes' accel2d='no'&gt;
...
&lt;/model&gt;
&lt;/video&gt;</pre></div></li></ol></div></div><div id="id-1.12.4.9.15.4.3" data-id-title="Enabling 2D/3D acceleration" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Enabling 2D/3D acceleration</div><p>
     Only <code class="literal">vbox</code> video devices are capable of 2D/3D
     acceleration. You cannot enable it on other video devices.
    </p></div></section></section><section class="sect1" id="virsh-network-devices" data-id-title="Configuring network devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.14 </span><span class="title-name">Configuring network devices</span></span> <a title="Permalink" class="permalink" href="#virsh-network-devices">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes how to configure specific aspects of virtual network
   devices by using <code class="command">virsh</code>.
  </p><p>
   Find more details about <code class="systemitem">libvirt</code> network interface specification in
   <a class="link" href="https://libvirt.org/formatdomain.html#elementsDriverBackendOptions" target="_blank">https://libvirt.org/formatdomain.html#elementsDriverBackendOptions</a>.
  </p><section class="sect2" id="virsh-multiqueue" data-id-title="Scaling network performance with multiqueue virtio-net"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.14.1 </span><span class="title-name">Scaling network performance with multiqueue virtio-net</span></span> <a title="Permalink" class="permalink" href="#virsh-multiqueue">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The multiqueue virtio-net feature scales the network performance by
    allowing the VM Guest's virtual CPUs to transfer packets in parallel.
    Refer to <a class="xref" href="#kvm-qemu-multiqueue" title="33.3.3. Scaling network performance with multiqueue virtio-net">Section 33.3.3, “Scaling network performance with multiqueue virtio-net”</a> for more general
    information.
   </p><p>
    To enable multiqueue virtio-net for a specific VM Guest, edit its XML
    configuration as described in
    <a class="xref" href="#sec-libvirt-config-editing-virsh" title="15.1. Editing the VM configuration">Section 15.1, “Editing the VM configuration”</a> and modify its network
    interface as follows:
   </p><div class="verbatim-wrap"><pre class="screen">&lt;interface type='network'&gt;
 [...]
 &lt;model type='virtio'/&gt;
 &lt;driver name='vhost' queues='<em class="replaceable">NUMBER_OF_QUEUES</em>'/&gt;
&lt;/interface&gt;</pre></div></section></section><section class="sect1" id="sec-libvirt-config-direct" data-id-title="Using macvtap to share VM Host Server network interfaces"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.15 </span><span class="title-name">Using macvtap to share VM Host Server network interfaces</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-direct">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Macvtap provides direct attachment of a VM Guest virtual interface to a
   host network interface. The macvtap-based interface extends the VM Host Server
   network interface and has its own MAC address on the same Ethernet segment.
   Typically, this is used to make both the VM Guest and the VM Host Server show up
   directly on the switch that the VM Host Server is connected to.
  </p><div id="id-1.12.4.9.17.3" data-id-title="Macvtap cannot be used with a Linux bridge" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Macvtap cannot be used with a Linux bridge</div><p>
    Macvtap cannot be used with network interfaces already connected to a Linux
    bridge. Before attempting to create the macvtap interface, remove the
    interface from the bridge.
   </p></div><div id="id-1.12.4.9.17.4" data-id-title="VM Guest to VM Host Server communication with macvtap" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: VM Guest to VM Host Server communication with macvtap</div><p>
    When using macvtap, a VM Guest can communicate with other VM Guests, and
    with other external hosts on the network. But it cannot communicate with
    the VM Host Server on which the VM Guest runs. This is the defined behavior of
    macvtap, because of the way the VM Host Server's physical Ethernet is attached to
    the macvtap bridge. Traffic from the VM Guest into that bridge that is
    forwarded to the physical interface cannot be bounced back up to the
    VM Host Server's IP stack. Similarly, traffic from the VM Host Server's IP stack that
    is sent to the physical interface cannot be bounced back up to the macvtap
    bridge for forwarding to the VM Guest.
   </p></div><p>
   Virtual network interfaces based on macvtap are supported by libvirt by
   specifying an interface type of <code class="literal">direct</code>. For example:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;interface type='direct'&gt;
   &lt;mac address='aa:bb:cc:dd:ee:ff'/&gt;
   &lt;source dev='eth0' mode='bridge'/&gt;
   &lt;model type='virtio'/&gt;
   &lt;/interface&gt;</pre></div><p>
   The operation mode of the macvtap device can be controlled with the
   <code class="literal">mode</code> attribute. The following list show its possible
   values and a description for each:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="literal">vepa</code>: All VM Guest packets are sent to an external
     bridge. Packets whose destination is a VM Guest on the same VM Host Server as
     where the packet originates from are sent back to the VM Host Server by the VEPA
     capable bridge (today's bridges are typically not VEPA capable).
    </p></li><li class="listitem"><p>
     <code class="literal">bridge</code>: Packets whose destination is on the same
     VM Host Server as where they originate from are directly delivered to the target
     macvtap device. Both origin and destination devices need to be in
     <code class="literal">bridge</code> mode for direct delivery. If either one of them
     is in <code class="literal">vepa</code> mode, a VEPA capable bridge is required.
    </p></li><li class="listitem"><p>
     <code class="literal">private</code>: All packets are sent to the external bridge
     and will only be delivered to a target VM Guest on the same VM Host Server if
     they are sent through an external router or gateway and that device sends
     them back to the VM Host Server. This procedure is followed if either the source
     or destination device is in private mode.
    </p></li><li class="listitem"><p>
     <code class="literal">passthrough</code>: A special mode that gives more power to
     the network interface. All packets will be forwarded to the interface,
     allowing virtio VM Guests to change the MAC address or set promiscuous
     mode to bridge the interface or create VLAN interfaces on top of it. Note
     that a network interface is not shareable in
     <code class="literal">passthrough</code> mode. Assigning an interface to a VM Guest
     will disconnect it from the VM Host Server. For this reason SR-IOV virtual
     functions are often assigned to the VM Guest in
     <code class="literal">passthrough</code> mode.
    </p></li></ul></div></section><section class="sect1" id="sec-libvirt-config-disable-virtio-mellon" data-id-title="Disabling a memory balloon device"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.16 </span><span class="title-name">Disabling a memory balloon device</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-config-disable-virtio-mellon">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Memory Balloon has become a default option for KVM. The device will be added
   to the VM Guest explicitly, so you do not need to add this element in the
   VM Guest's XML configuration. However, if you want to disable Memory
   Balloon in the VM Guest for any reason, you need to set
   <code class="literal">model='none'</code> as shown below:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;devices&gt;
   &lt;memballoon model='none'/&gt;
&lt;/device&gt;</pre></div></section><section class="sect1" id="virsh-video-dual-head" data-id-title="Configuring multiple monitors (dual head)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.17 </span><span class="title-name">Configuring multiple monitors (dual head)</span></span> <a title="Permalink" class="permalink" href="#virsh-video-dual-head">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="systemitem">libvirt</code> supports a dual head configuration to display the video output of
   the VM Guest on multiple monitors.
  </p><div id="id-1.12.4.9.19.3" data-id-title="No support for Xen" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: No support for Xen</div><p>
    The Xen hypervisor does not support dual head configuration.
   </p></div><div class="procedure" id="id-1.12.4.9.19.4" data-id-title="Configuring dual head"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 15.3: </span><span class="title-name">Configuring dual head </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.9.19.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     While the virtual machine is running, verify that the
     <span class="package">xf86-video-qxl</span> package is installed in the VM Guest:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>rpm -q xf86-video-qxl</pre></div></li><li class="step"><p>
     Shut down the VM Guest and start editing its configuration XML as
     described in <a class="xref" href="#sec-libvirt-config-editing-virsh" title="15.1. Editing the VM configuration">Section 15.1, “Editing the VM configuration”</a>.
    </p></li><li class="step"><p>
     Verify that the model of the virtual graphics card is 'qxl':
    </p><div class="verbatim-wrap"><pre class="screen">&lt;video&gt;
 &lt;model type='qxl' ... /&gt;</pre></div></li><li class="step"><p>
     Increase the <code class="option">heads</code> parameter in the graphics card model
     specification from the default <code class="literal">1</code> to
     <code class="literal">2</code>, for example:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;video&gt;
 &lt;model type='qxl' ram='65536' vram='65536' vgamem='16384' heads='2' primary='yes'/&gt;
 &lt;alias name='video0'/&gt;
 &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x0'/&gt;
&lt;/video&gt;</pre></div></li><li class="step"><p>
     Configure the virtual machine to use the Spice display instead of VNC:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;graphics type='spice' port='5916' autoport='yes' listen='0.0.0.0'&gt;
 &lt;listen type='address' address='0.0.0.0'/&gt;
&lt;/graphics&gt;</pre></div></li><li class="step"><p>
     Start the virtual machine and connect to its display with
     <code class="command">virt-viewer</code>, for example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-viewer --connect qemu+ssh://<em class="replaceable">USER@VM_HOST</em>/system</pre></div></li><li class="step"><p>
     From the list of VMs, select the one whose configuration you have modified
     and confirm with <span class="guimenu">Connect</span>.
    </p></li><li class="step"><p>
     After the graphical subsystem (Xorg) loads in the VM Guest, select
     <span class="guimenu">View</span> › <span class="guimenu">Displays</span> › <span class="guimenu">Display
     2</span> to open a new window with the second monitor's
     output.
    </p></li></ol></div></div></section><section class="sect1" id="virsh-kvm-zseries-crypto" data-id-title="Crypto adapter pass-through to KVM guests on IBM Z"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.18 </span><span class="title-name">Crypto adapter pass-through to KVM guests on IBM Z</span></span> <a title="Permalink" class="permalink" href="#virsh-kvm-zseries-crypto">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="virsh-kvm-zseries-crypto-intro" data-id-title="Introduction"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.18.1 </span><span class="title-name">Introduction</span></span> <a title="Permalink" class="permalink" href="#virsh-kvm-zseries-crypto-intro">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    IBM Z machines include cryptographic hardware with useful functions
    such as random number generation, digital signature generation, or
    encryption. KVM allows dedicating these crypto adapters to guests as
    pass-through devices. The means that the hypervisor cannot observe
    communications between the guest and the device.
   </p></section><section class="sect2" id="virsh-kvm-zseries-crypto-cover" data-id-title="What is covered"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.18.2 </span><span class="title-name">What is covered</span></span> <a title="Permalink" class="permalink" href="#virsh-kvm-zseries-crypto-cover">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You will learn how to dedicate a crypto adapter and domains on a IBM Z
    host to a KVM guest. The procedure includes the following basic steps:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Mask the crypto adapter and domains from the default driver on the host.
     </p></li><li class="listitem"><p>
      Load the <code class="literal">vfio-ap</code> driver.
     </p></li><li class="listitem"><p>
      Assign the crypto adapter and domains to the <code class="literal">vfio-ap</code>
      driver.
     </p></li><li class="listitem"><p>
      Configure the guest to use the crypto adapter.
     </p></li></ul></div></section><section class="sect2" id="virsh-kvm-zseries-crypto-reqs" data-id-title="Requirements"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.18.3 </span><span class="title-name">Requirements</span></span> <a title="Permalink" class="permalink" href="#virsh-kvm-zseries-crypto-reqs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      You need to have the QEMU / <code class="systemitem">libvirt</code> virtualization environment
      correctly installed and functional.
     </p></li><li class="listitem"><p>
      The <code class="literal">vfio_ap</code> and <code class="literal">vfio_mdev</code> modules
      for the running kernel need to be available on the host operating system.
     </p></li></ul></div></section><section class="sect2" id="virsh-kvm-zseries-crypto-proc" data-id-title="Dedicate a crypto adapter to a KVM host"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.18.4 </span><span class="title-name">Dedicate a crypto adapter to a KVM host</span></span> <a title="Permalink" class="permalink" href="#virsh-kvm-zseries-crypto-proc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Verify that the <code class="literal">vfio_ap</code> and
      <code class="literal">vfio_mdev</code> kernel modules are loaded on the host:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>lsmod | grep vfio_</pre></div><p>
      If any of them is not listed, load it manually, for example:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> modprobe vfio_mdev</pre></div></li><li class="step"><p>
      Create a new MDEV device on the host and verify that it was added:
     </p><div class="verbatim-wrap"><pre class="screen">uuid=$(uuidgen)
$ echo ${uuid} | sudo tee /sys/devices/vfio_ap/matrix/mdev_supported_types/vfio_ap-passthrough/create
dmesg | tail
[...]
[272197.818811] iommu: Adding device 24f952b3-03d1-4df2-9967-0d5f7d63d5f2 to group 0
[272197.818815] vfio_mdev 24f952b3-03d1-4df2-9967-0d5f7d63d5f2: MDEV: group_id = 0</pre></div></li><li class="step"><p>
      Identify the device on the host's logical partition that you intend to
      dedicate to a KVM guest:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ls -l /sys/bus/ap/devices/
[...]
lrwxrwxrwx 1 root root 0 Nov 23 03:29 00.0016 -&gt; ../../../devices/ap/card00/00.0016/
lrwxrwxrwx 1 root root 0 Nov 23 03:29 card00 -&gt; ../../../devices/ap/card00/</pre></div><p>
      In this example, it is card <code class="literal">0</code> queue
      <code class="literal">16</code>. To match the Hardware Management Console (HMC)
      configuration, you need to convert from <code class="literal">16</code> hexadecimal
      to <code class="literal">22</code> decimal.
     </p></li><li class="step"><p>
      Mask the adapter from the <code class="literal">zcrypt</code> use:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>lszcrypt
CARD.DOMAIN TYPE MODE STATUS REQUEST_CNT
-------------------------------------------------
00 CEX5C CCA-Coproc online 5
00.0016 CEX5C CCA-Coproc online 5</pre></div><p>
      Mask the adapter:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /sys/bus/ap/apmask
0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
echo -0x0 | sudo tee /sys/bus/ap/apmask
0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</pre></div><p>
      Mask the domain:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /sys/bus/ap/aqmask
0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
echo -0x0 | sudo tee /sys/bus/ap/aqmask
0xfffffdffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</pre></div></li><li class="step"><p>
      Assign adapter 0 and domain 16 (22 decimal) to
      <code class="literal">vfio-ap</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> echo +0x0 &gt; /sys/devices/vfio_ap/matrix/${uuid}/assign_adapter
<code class="prompt user">&gt; </code>echo +0x16 | sudo tee /sys/devices/vfio_ap/matrix/${uuid}/assign_domain
<code class="prompt user">&gt; </code>echo +0x16 | sudo tee /sys/devices/vfio_ap/matrix/${uuid}/assign_control_domain</pre></div></li><li class="step"><p>
      Verify the matrix that you have configured:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /sys/devices/vfio_ap/matrix/${uuid}/matrix
00.0016</pre></div></li><li class="step"><p>
      Either create a new VM (refer to <a class="xref" href="#cha-kvm-inst" title="Chapter 10. Guest installation">Chapter 10, <em>Guest installation</em></a>) and wait
      until it is initialized, or use an existing VM. In both cases, make sure
      the VM is shut down.
     </p></li><li class="step"><p>
      Change its configuration to use the MDEV device:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh edit <em class="replaceable">VM_NAME</em>
[...]
&lt;hostdev mode='subsystem' type='mdev' model='vfio-ap'&gt;
 &lt;source&gt;
  &lt;address uuid='24f952b3-03d1-4df2-9967-0d5f7d63d5f2'/&gt;
 &lt;/source&gt;
&lt;/hostdev&gt;
[...]</pre></div></li><li class="step"><p>
      Restart the VM:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh reboot <em class="replaceable">VM_NAME</em></pre></div></li><li class="step"><p>
      Log in to the guest and verify that the adapter is present:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>lszcrypt
CARD.DOMAIN TYPE MODE STATUS REQUEST_CNT
-------------------------------------------------
00 CEX5C CCA-Coproc online 1
00.0016 CEX5C CCA-Coproc online 1</pre></div></li></ol></div></div></section><section class="sect2" id="virsh-kvm-zseries-crypto-moreinfo" data-id-title="Further reading"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.18.5 </span><span class="title-name">Further reading</span></span> <a title="Permalink" class="permalink" href="#virsh-kvm-zseries-crypto-moreinfo">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_configuration_virsh.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The installation of virtualization components is detailed in
      <a class="xref" href="#cha-vt-installation" title="Chapter 6. Installation of virtualization components">Chapter 6, <em>Installation of virtualization components</em></a>.
     </p></li><li class="listitem"><p>
      The <code class="literal">vfio_ap</code> architecture is detailed in
      <a class="link" href="https://www.kernel.org/doc/Documentation/s390/vfio-ap.txt" target="_blank">https://www.kernel.org/doc/Documentation/s390/vfio-ap.txt</a>.
     </p></li><li class="listitem"><p>
      A general outline together with a detailed procedure is described in
      <a class="link" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1787405" target="_blank">https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1787405</a>.
     </p></li><li class="listitem"><p>
      The architecture of VFIO Mediated devices (MDEVs) is detailed in
      <a class="link" href="https://www.kernel.org/doc/html/latest/driver-api/vfio-mediated-device.html" target="_blank">https://www.kernel.org/doc/html/latest/driver-api/vfio-mediated-device.html</a>.
     </p></li></ul></div></section></section></section><section class="chapter" id="cha-libvirt-manage-vagrant" data-id-title="Managing virtual machines with Vagrant"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">16 </span><span class="title-name">Managing virtual machines with Vagrant</span></span> <a title="Permalink" class="permalink" href="#cha-libvirt-manage-vagrant">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_management_vagrant.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Vagrant is a tool that provides a unified workflow for the creation,
    deployment and management of virtual development environments.
    The following sections describe how to manage virtual machines by using
    Vagrant.
   </p></div></div></div></div><section class="sect1" id="sec-libvirt-vagrant-intro" data-id-title="Introduction to Vagrant"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">16.1 </span><span class="title-name">Introduction to Vagrant</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-vagrant-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_management_vagrant.xml" title="Edit source document"> </a></div></div></div></div></div><p>Vagrant provides an abstraction layer for various virtualization
   providers via a simple configuration file that allows developers and
   operators to quickly spin up a virtual machine (VM) running Linux or any
   other operating system.
  </p><section class="sect2" id="sec-libvirt-vagrant-concept" data-id-title="Vagrant concepts"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">16.1.1 </span><span class="title-name">Vagrant concepts</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-vagrant-concept">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_management_vagrant.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Vagrant uses <code class="literal">providers</code>, <code class="literal">provisioners</code>,
    <code class="literal">boxes</code>, and <code class="literal">Vagrantfiles</code> as building
    blocks of the virtual machines.
   </p><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">Vagrant terminology </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.10.3.3.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_management_vagrant.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.12.4.10.3.3.3.2"><span class="term">Provider</span></dt><dd><p>
       Services to set up and create virtual environments. Vagrant ships with
       support for VirtualBox and Microsoft Hyper-V virtualization. Other services
       such as <code class="systemitem">libvirt</code>, VMware or AWS are supported via plug-ins.
      </p></dd><dt id="id-1.12.4.10.3.3.3.3"><span class="term">Provisioner</span></dt><dd><p>
       Tools to customize the configuration of virtual environments. Vagrant
       has built built-in providers for uploading files, synchronizing directories or
       executing shell commands, but also supports configuration management
       systems such as Ansible, CFEngine, Chef, Puppet, and Salt.
      </p></dd><dt id="id-1.12.4.10.3.3.3.4"><span class="term">Vagrantfile</span></dt><dd><p>
       Configuration file and file name (<code class="filename">Vagrantfile</code>) for virtual
       environments. It contains machine and software requirements and all
       necessary steps in order to create a development-ready box.
      </p></dd><dt id="id-1.12.4.10.3.3.3.5"><span class="term">Box</span></dt><dd><p>
       Format and an extension (<code class="filename">*.box</code>) for virtual
       environments. Boxes can be downloaded from the
       <a class="link" href="https://vagrantcloud.com/" target="_blank">Vagrant Cloud</a> and
       copied from one machine to another in order to replicate an
       environment.
      </p><p>
       SUSE provides official Vagrant Boxes for SUSE Linux Enterprise using the
       VirtualBox and <code class="systemitem">libvirt</code>  providers. SUSE Linux Enterprise Server boxes are available for the
       AMD64/Intel 64 and AArch64 architectures.
      </p></dd></dl></div></section><section class="sect2" id="sec-libvirt-vagrant-example" data-id-title="Vagrant example"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">16.1.2 </span><span class="title-name">Vagrant example</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-vagrant-example">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_management_vagrant.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A new VM can be launched with Vagrant via the following set of commands.
    This example uses the official Vagrant box for openSUSE Tumbleweed which
    is available from the <a class="link" href="https://vagrantcloud.com/" target="_blank">Vagrant
    Cloud</a>.
   </p><div class="procedure" id="id-1.12.4.10.3.4.3" data-id-title="Creating a Vagrant environment with openSUSE Tumbleweed"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 16.1: </span><span class="title-name">Creating a Vagrant environment with openSUSE Tumbleweed </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.10.3.4.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_management_vagrant.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Download the Vagrant box for openSUSE Tumbleweed:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="command">vagrant</code> <code class="option">init opensuse/Tumbleweed.x86_64</code></pre></div><p>
      This also registers the box with Vagrant and creates the <code class="filename">Vagrantfile</code>.
     </p></li><li class="step"><p><span class="step-optional">(Optional)</span> 
      Edit the <code class="filename">Vagrantfile</code> to customize the environment.
     </p></li><li class="step"><p>
     Start the box:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="command">vagrant</code> <code class="option">up</code></pre></div></li><li class="step"><p>
      Access the box through <code class="command">ssh</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="command">vagrant</code> <code class="option">ssh</code></pre></div></li></ol></div></div></section></section><section class="sect1" id="sec-libvirt-vagrant-sle" data-id-title="Vagrant boxes for SUSE Linux Enterprise"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">16.2 </span><span class="title-name">Vagrant boxes for SUSE Linux Enterprise</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-vagrant-sle">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_management_vagrant.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Starting with SUSE Linux Enterprise 15 SP2, SUSE provides official Vagrant boxes for
   SUSE Linux Enterprise using the  VirtualBox and <code class="systemitem">libvirt</code> providers. SUSE Linux Enterprise Server boxes are
   available for the AMD64/Intel 64 and AArch64 architectures, SUSE Linux Enterprise Desktop only for
   AMD64/Intel 64.
  </p><p>
   These boxes come with the bare minimum of packages to reduce their size
   and are not registered, thus users need to register the boxes prior to
   further provisioning.
  </p><p>
   The boxes are only available for direct download from
   <a class="link" href="https://download.suse.com" target="_blank">https://download.suse.com</a>. Therefore, a downloaded
   box must be manually registered with Vagrant as follows:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="command">vagrant</code> <code class="option">box add --name <em class="replaceable">SLES-15-SP3</em> \
   <em class="replaceable">/path/to/</em>SLES15-SP3-Vagrant.x86_64-15.3-libvirt-*.vagrant.libvirt.box</code></pre></div><p>
   The box is then available under the name <code class="literal">SLES-15-SP3</code> and
   can be used like other Vagrant boxes:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="command">vagrant</code> <code class="option">init <em class="replaceable">SLES-15-SP3</em></code>
<code class="command">vagrant</code> <code class="option">up</code>
<code class="command">vagrant</code> <code class="option">ssh</code></pre></div></section><section class="sect1" id="id-1.12.4.10.5" data-id-title="Further reading"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">16.3 </span><span class="title-name">Further reading</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.10.5">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/libvirt_management_vagrant.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For more information about Vagrant and its configuration, refer to the
   official documentation at <a class="link" href="https://docs.vagrantup.com/" target="_blank">https://docs.vagrantup.com/</a>.
  </p></section></section><section class="chapter" id="xen2kvm-migration" data-id-title="Xen to KVM migration guide"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">17 </span><span class="title-name">Xen to KVM migration guide</span></span> <a title="Permalink" class="permalink" href="#xen2kvm-migration">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  As the KVM virtualization solution is becoming more and more popular among
  server administrators, many of them need a path to migrate their existing
  Xen based environments to KVM. As of now, there are no mature tools to
  automatically convert Xen VMs to KVM. There is, however, a technical
  solution that helps convert Xen virtual machines to KVM. The following
  information and procedures help you to perform such a migration.
 </p><div id="id-1.12.4.11.3" data-id-title="Migration procedure not supported" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Migration procedure not supported</div><p>
   The migration procedure described in this document is not fully supported by
   SUSE. We provide it as a guidance only.
  </p></div><section class="sect1" id="x2k-v2v" data-id-title="Migration to KVM using virt-v2v"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.1 </span><span class="title-name">Migration to KVM using <code class="command">virt-v2v</code></span></span> <a title="Permalink" class="permalink" href="#x2k-v2v">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section contains information to help you import virtual machines from
   foreign hypervisors (such as Xen) to KVM managed by <code class="systemitem">libvirt</code>.
  </p><div id="id-1.12.4.11.4.3" data-id-title="Microsoft Windows guests" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Microsoft Windows guests</div><p>
    This section is focused on converting Linux guests. Converting Microsoft
    Windows guests using <code class="command">virt-v2v</code> is the same as converting
    Linux guests, except with regard to handling the Virtual Machine Driver Pack
    (VMDP). Additional details on converting Windows guests with the VMDP can
    be found separately at
    <a class="link" href="https://documentation.suse.com/sle-vmdp/" target="_blank">Virtual
    Machine Driver Pack documentation</a>.
   </p></div><section class="sect2" id="x2k-v2v-intro" data-id-title="Introduction to virt-v2v"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.1.1 </span><span class="title-name">Introduction to <code class="command">virt-v2v</code></span></span> <a title="Permalink" class="permalink" href="#x2k-v2v-intro">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">virt-v2v</code> is a command line tool to convert VM Guests
    from a foreign hypervisor to run on KVM managed by <code class="systemitem">libvirt</code>. It enables
    paravirtualized virtio drivers in the converted virtual machine if
    possible. A list of supported operating systems and hypervisors follows:
   </p><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Supported guest operating systems </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.11.4.4.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
      SUSE Linux Enterprise Server
     </p></li><li class="listitem"><p>
      openSUSE
     </p></li><li class="listitem"><p>
      Red Hat Enterprise Linux
     </p></li><li class="listitem"><p>
      Fedora
     </p></li><li class="listitem"><p>
      Microsoft Windows Server 2003 and 2008
     </p></li></ul></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Supported source hypervisor </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.11.4.4.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
      Xen
     </p></li></ul></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Supported target hypervisor </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.11.4.4.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
      KVM (managed by <code class="systemitem">libvirt</code>)
     </p></li></ul></div></section><section class="sect2" id="x2k-v2v-install" data-id-title="Installing virt-v2v"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.1.2 </span><span class="title-name">Installing <code class="command">virt-v2v</code></span></span> <a title="Permalink" class="permalink" href="#x2k-v2v-install">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The installation of <code class="command">virt-v2v</code> is simple:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper install virt-v2v</pre></div><p>
    Remember that <code class="command">virt-v2v</code> requires <code class="systemitem">root</code> privileges,
    so you need to run it either as <code class="systemitem">root</code>, or via <code class="command">sudo</code>.
   </p></section><section class="sect2" id="x2k-v2v-prepare" data-id-title="Preparing the virtual machine"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.1.3 </span><span class="title-name">Preparing the virtual machine</span></span> <a title="Permalink" class="permalink" href="#x2k-v2v-prepare">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.12.4.11.4.6.2" data-id-title="Conditions for skipping this step" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Conditions for skipping this step</div><p>
     If running <code class="command">virt-v2v</code> on SLES 12 SP1 or earlier, this
     step can be safely skipped. This step can also be ignored if the virtual
     machine is fully virtualized or if it runs on SLES 12 SP2 or later.
    </p></div><p>
    The Xen virtual machine must have the default kernel installed. To ensure
    this, run <code class="command">zypper in kernel-default</code> on the virtual
    machine.
   </p></section><section class="sect2" id="x2k-v2v-convert" data-id-title="Converting virtual machines to run under KVM managed by libvirt"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.1.4 </span><span class="title-name">Converting virtual machines to run under KVM managed by <code class="systemitem">libvirt</code></span></span> <a title="Permalink" class="permalink" href="#x2k-v2v-convert">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">virt-v2v</code> converts virtual machines from the Xen
    hypervisor to run under KVM managed by <code class="systemitem">libvirt</code>. To learn more about
    <code class="systemitem">libvirt</code> and <code class="command">virsh</code>, see
    <a class="xref" href="#part-virt-libvirt" title="Part II. Managing virtual machines with libvirt">Part II, “Managing virtual machines with <code class="systemitem">libvirt</code>”</a>. Additionally, all
    <code class="command">virt-v2v</code> command line options are explained in the
    <code class="command">virt-v2v</code> manual page (<code class="command">man 1
    virt-v2v</code>).
   </p><p>
    Before converting a virtual machine, make sure to complete the following
    steps:
   </p><div class="procedure" id="id-1.12.4.11.4.7.4" data-id-title="Preparing the environment for the conversion"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 17.1: </span><span class="title-name">Preparing the environment for the conversion </span></span><a title="Permalink" class="permalink" href="#id-1.12.4.11.4.7.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Create a new local storage pool.
     </p><p>
      <code class="command">virt-v2v</code> copies the storage of the source virtual
      machine to a local storage pool managed by <code class="systemitem">libvirt</code> (the original disk
      image remains unchanged). You can create the pool either with Virtual Machine Manager or
      <code class="command">virsh</code>. For more information, see
      <a class="xref" href="#sec-libvirt-storage-vmm" title="9.2.2. Managing storage with Virtual Machine Manager">Section 9.2.2, “Managing storage with Virtual Machine Manager”</a> and
      <a class="xref" href="#sec-libvirt-storage-virsh" title="9.2.1. Managing storage with virsh">Section 9.2.1, “Managing storage with <code class="command">virsh</code>”</a>.
     </p></li><li class="step"><p>
      Prepare the local network interface.
     </p><p>
      Check that the converted virtual machine can use a local network
      interface on the VM Host Server. It is usually a network bridge. If it is not
      defined yet, create it with
      <span class="guimenu">YaST</span> › <span class="guimenu">System</span> › <span class="guimenu">Network
      Settings</span> › <span class="guimenu">Add</span> › <span class="guimenu">Bridge</span>.
     </p><div id="id-1.12.4.11.4.7.4.3.3" data-id-title="Mappings of network devices" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Mappings of network devices</div><p>
       Network devices on the source Xen host can be mapped during the
       conversion process to corresponding network devices on the KVM target
       host. For example, the Xen bridge <code class="literal">br0</code> can be mapped
       to the default KVM network device. Sample mappings can be found in
       <code class="filename">/etc/virt-v2v.conf</code>. To enable these mappings,
       modify the XML rule as necessary and ensure the section is not commented
       out with <code class="literal">&lt;!--</code> and <code class="literal">--&gt;</code>
       markers. For example:
      </p><div class="verbatim-wrap"><pre class="screen"> &lt;network type='bridge' name='br0'&gt;
   &lt;network type='network' name='default'/&gt;
 &lt;/network&gt;</pre></div></div><div id="id-1.12.4.11.4.7.4.3.4" data-id-title="No network bridge" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: No network bridge</div><p>
       If there is no network bridge available, Virtual Machine Manager can optionally create it.
      </p></div></li></ol></div></div><p>
    <code class="command">virt-v2v</code> has the following basic command syntax:
   </p><div class="verbatim-wrap"><pre class="screen">virt-v2v -i <em class="replaceable">INPUT_METHOD</em> -os <em class="replaceable">STORAGE_POOL</em> <em class="replaceable">SOURCE_VM</em></pre></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.11.4.7.7.1"><span class="term">input_method</span></dt><dd><p>
       There are two input methods: <code class="literal">libvirt</code> or
       <code class="literal">libvirtxml</code>. See the
       <em class="replaceable">SOURCE_VM</em> parameter for more information.
      </p></dd><dt id="id-1.12.4.11.4.7.7.2"><span class="term">storage_pool</span></dt><dd><p>
       The storage pool you already prepared for the target virtual machine.
      </p></dd><dt id="id-1.12.4.11.4.7.7.3"><span class="term">source_vm</span></dt><dd><p>
       The source virtual machine to convert. It depends on the
       <em class="replaceable">INPUT_METHOD</em> parameter: For
       <code class="literal">libvirt</code>, specify the name of a libvirt domain. For
       <code class="literal">libvirtxml</code>, specify the path to an XML file
       containing a libvirt domain specification.
      </p></dd></dl></div><div id="id-1.12.4.11.4.7.8" data-id-title="Conversion time" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Conversion time</div><p>
     Conversion of a virtual machine takes a lot of system resources, mainly
     for copying the whole disk image for a virtual machine. Converting a
     single virtual machine typically takes up to 10 minutes, although virtual
     machines using very large disk images can take much longer.
    </p></div><section class="sect3" id="x2k-v2v-convert-xml" data-id-title="Conversion based on the libvirt XML description file"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">17.1.4.1 </span><span class="title-name">Conversion based on the <code class="systemitem">libvirt</code> XML description file</span></span> <a title="Permalink" class="permalink" href="#x2k-v2v-convert-xml">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This section describes how to convert a local Xen virtual machine using
     the <code class="systemitem">libvirt</code> XML configuration file. This method is suitable if the host
     is already running the KVM hypervisor. Make sure that the <code class="systemitem">libvirt</code> XML
     file of the source virtual machine, and the <code class="systemitem">libvirt</code> storage pool
     referenced from it are available on the local host.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Obtain the <code class="systemitem">libvirt</code> XML description of the source virtual machine.
      </p><div id="id-1.12.4.11.4.7.9.3.1.2" data-id-title="Obtaining the XML files" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Obtaining the XML files</div><p>
        To obtain the <code class="systemitem">libvirt</code> XML files of the source virtual machine, you
        must run the host OS under the Xen kernel. If you already rebooted
        the host to the KVM-enabled environment, reboot back to the Xen
        kernel, dump the <code class="systemitem">libvirt</code> XML file, and then reboot back to the KVM
        environment.
       </p></div><p>
       First identify the source virtual machine under virsh:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh list
 Id    Name                           State
----------------------------------------------------
[...]
  2     sles12_xen                     running
[...]</pre></div><p>
       <code class="literal">sles12_xen</code> is the source virtual machine to convert.
       Now export its XML and save it to <code class="filename">sles12_xen.xml</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh dumpxml sles12_xen &gt; sles12_xen.xml</pre></div></li><li class="step"><p>
       Verify that all disk image paths are correct from the KVM host's
       perspective. This is not a problem when converting on one machine, but
       might require manual changes when converting using an XML dump from
       another host.
      </p><div class="verbatim-wrap"><pre class="screen">&lt;source file='/var/lib/libvirt/images/XenPool/SLES.qcow2'/&gt;</pre></div><div id="id-1.12.4.11.4.7.9.3.2.3" data-id-title="Copying images" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Copying images</div><p>
        To avoid copying an image twice, manually copy the disk image(s)
        directly to the <code class="systemitem">libvirt</code> storage pool. Update the source file entries
        in the XML description file. The <code class="command">virt-v2v</code> process
        will detect the existing disks and convert them in place.
       </p></div></li><li class="step"><p>
       Run <code class="command">virt-v2v</code> to convert to KVM virtual machine:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virt-v2v sles12_xen.xml<span class="callout" id="v2v-xml">1</span> \
-i <em class="replaceable">LIBVIRTXML</em><span class="callout" id="v2v-method">2</span> \
-os <em class="replaceable">remote_host.example.com:/exported_dir</em><span class="callout" id="v2v-pool">3</span> \
--bridge <em class="replaceable">br0</em><span class="callout" id="v2v-bridge">4</span> \
-on <em class="replaceable">sles12_kvm</em><span class="callout" id="v2v-name">5</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-xml"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The XML description of the source Xen-based virtual machine.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-method"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         <code class="command">virt-v2v</code> will read the information about the source
         virtual machine from a <code class="systemitem">libvirt</code> XML file.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-pool"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Storage pool where the target virtual machine disk image will be
         placed. In this example, the image will be placed on an NFS share
         <code class="filename">/exported_dir</code> on the
         <code class="literal">remote_host.example.com</code> server.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-bridge"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The target KVM-based virtual machine will use the network bridge
         <code class="literal">br0</code> on the host.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-name"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The target virtual machine will be renamed to
         <code class="literal">sles12_kvm</code> to prevent name collision with the
         existing virtual machine of the same name.
        </p></td></tr></table></div></li></ol></div></div></section><section class="sect3" id="x2k-v2v-convert-domain" data-id-title="Conversion based on the libvirt domain name"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">17.1.4.2 </span><span class="title-name">Conversion based on the <code class="systemitem">libvirt</code> domain name</span></span> <a title="Permalink" class="permalink" href="#x2k-v2v-convert-domain">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This method is useful if you are still running <code class="systemitem">libvirt</code> under Xen, and
     plan to reboot to the KVM hypervisor later.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Find the <code class="systemitem">libvirt</code> domain name of the virtual machine you want to
       convert.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh list
 Id    Name                           State
----------------------------------------------------
[...]
  2     sles12_xen                     running
[...]</pre></div><p>
       <code class="literal">sles12_xen</code> is the source virtual machine to convert.
      </p></li><li class="step"><p>
       Run <code class="command">virt-v2v</code> to convert to KVM virtual machine:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virt-v2v sles12_xen<span class="callout" id="v2v-domain">1</span> \
-i <em class="replaceable">libvirt</em><span class="callout" id="v2v-method1">2</span> \
-os <em class="replaceable">storage_pool</em><span class="callout" id="v2v-pool1">3</span> \
--network <em class="replaceable">eth0</em><span class="callout" id="v2v-net">4</span> \
-of qcow2<span class="callout" id="v2v-qcow">5</span> \
-oa sparce<span class="callout" id="v2v-sparse">6</span> \
-on <em class="replaceable">sles12_kvm</em></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-domain"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The domain name of the Xen-based virtual machine.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-method1"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         <code class="command">virt-v2v</code> will read the information about the source
         virtual machine directly from the active <code class="systemitem">libvirt</code> connection.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-pool1"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The target disk image will be placed in a local <code class="systemitem">libvirt</code> storage
         pool.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-net"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         All guest bridges (or networks) will be connected to a locally managed
         network.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-qcow"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Format for the disk image of the target virtual machine. Supported
         options are <code class="option">raw</code> or <code class="option">qcow2</code>.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#v2v-sparse"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Whether the converted guest disk space will be <code class="option">sparse</code>
         or <code class="option">preallocated</code>.
        </p></td></tr></table></div></li></ol></div></div></section><section class="sect3" id="x2k-v2v-convert-remote" data-id-title="Converting a remote Xen virtual machine"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">17.1.4.3 </span><span class="title-name">Converting a remote Xen virtual machine</span></span> <a title="Permalink" class="permalink" href="#x2k-v2v-convert-remote">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This method is useful if you need to convert a Xen virtual machine
     running on a remote host. As <code class="command">virt-v2v</code> connects to the
     remote host via <code class="command">ssh</code>, ensure the SSH service is running
     on the host.
    </p><div id="id-1.12.4.11.4.7.11.3" data-id-title="Passwordless SSH access" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Passwordless SSH access</div><p>
      Starting with SLES 12 SP2, <code class="command">virt-v2v</code> requires a
      passwordless SSH connection to the remote host. This means a connection
      using an SSH key added to the ssh-agent. See <code class="command">man
      ssh-keygen</code> and <code class="command">man ssh-add</code> for more details
      on this. More information is also available at <span class="intraxref">Book “Security and Hardening Guide”, Chapter 22 “Securing network operations with OpenSSH”</span>.
     </p></div><p>
     To connect to a remote <code class="systemitem">libvirt</code> connection, construct a valid connection
     URI relevant for your remote host. In the following example, the remote
     host name is <code class="literal">remote_host.example.com</code>, and the user name
     for the connection is <code class="systemitem">root</code>. The connection URI then looks as
     follows:
    </p><div class="verbatim-wrap"><pre class="screen">xen+ssh://root@remote_host.example.com/</pre></div><p>
     For more information on <code class="systemitem">libvirt</code> connection URIs, see
     <a class="link" href="https://libvirt.org/uri.html" target="_blank">https://libvirt.org/uri.html</a>.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Find the <code class="systemitem">libvirt</code> domain name of the remote virtual machine you want to
       convert.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh -c xen+ssh://root@remote_host.example.com/ list
 Id    Name                           State
----------------------------------------------------
  1     sles12_xen                     running
[...]</pre></div><p>
       <code class="literal">sles12_xen</code> is the source virtual machine to convert.
      </p></li><li class="step"><p>
       The <code class="command">virt-v2v</code> command for the remote connection looks
       like this:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virt-v2v sles12_xen \
-i <em class="replaceable">libvirt</em> \
-ic <em class="replaceable">xen+ssh://root@remote_host.example.com/</em> \
-os <em class="replaceable">local_storage_pool</em> \
--bridge <em class="replaceable">br0</em></pre></div></li></ol></div></div></section></section><section class="sect2" id="x2k-v2v-run" data-id-title="Running converted virtual machines"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.1.5 </span><span class="title-name">Running converted virtual machines</span></span> <a title="Permalink" class="permalink" href="#x2k-v2v-run">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    After <code class="command">virt-v2v</code> completes successfully, a new <code class="systemitem">libvirt</code>
    domain will be created with the name specified with the
    <code class="option">-on</code> option. If you did not specify <code class="option">-on</code>,
    the same name as the source virtual machine will be used. The new guest can
    be managed with standard <code class="systemitem">libvirt</code> tools, such as <code class="command">virsh</code>
    or Virtual Machine Manager.
   </p><div id="id-1.12.4.11.4.8.3" data-id-title="Rebooting the machine" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Rebooting the machine</div><p>
     If you completed the conversion under Xen as described in
     <a class="xref" href="#x2k-v2v-convert-domain" title="17.1.4.2. Conversion based on the libvirt domain name">Section 17.1.4.2, “Conversion based on the <code class="systemitem">libvirt</code> domain name”</a>, you may need to reboot the
     host machine and boot with the non-Xen kernel.
    </p></div></section></section><section class="sect1" id="id-1.12.4.11.5" data-id-title="Xen to KVM manual migration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.2 </span><span class="title-name">Xen to KVM manual migration</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="id-1.12.4.11.5.3" data-id-title="General outline"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.2.1 </span><span class="title-name">General outline</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5.3">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The preferred solution to manage virtual machines is based on <code class="systemitem">libvirt</code>;
    for more information, see <a class="link" href="https://libvirt.org/" target="_blank">https://libvirt.org/</a>. It
    has several advantages over the manual way of defining and running virtual
    machines—<code class="systemitem">libvirt</code> is cross-platform, supports many hypervisors, has
    secure remote management, has virtual networking, and, most of all,
    provides a unified abstract layer to manage virtual machines. Therefore the
    main focus of this article is on the <code class="systemitem">libvirt</code> solution.
   </p><p>
    Generally, the Xen to KVM migration consists of the following basic
    steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Make a backup copy of the original Xen VM Guest.
     </p></li><li class="step"><p>
      OPTIONAL: Apply changes specific to paravirtualized guests.
     </p></li><li class="step"><p>
      Obtain information about the original Xen VM Guest and update it to
      KVM equivalents.
     </p></li><li class="step"><p>
      Shut down the guest on the Xen host, and run the new one under the
      KVM hypervisor.
     </p></li></ol></div></div><div id="id-1.12.4.11.5.3.5" data-id-title="No live migration" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: No live migration</div><p>
     The Xen to KVM migration cannot be done live while the source
     VM Guest is running. Before running the new KVM-ready VM Guest, you
     are advised to shut down the original Xen VM Guest.
    </p></div></section><section class="sect2" id="id-1.12.4.11.5.4" data-id-title="Back up the Xen VM Guest"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.2.2 </span><span class="title-name">Back up the Xen VM Guest</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5.4">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To back up your Xen VM Guest, follow these steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Identify the relevant Xen guest you want to migrate, and remember its
      ID/name.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh list --all
Id Name                 State
----------------------------------
 0 Domain-0             running
 1 SLES11SP3            running
[...]</pre></div></li><li class="step"><p>
      Shut down the guest. You can do this either by shutting down the guest
      OS, or with <code class="command">virsh</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh shutdown SLES11SP3</pre></div></li><li class="step"><p>
      Back up its configuration to an XML file.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh dumpxml SLES11SP3 &gt; sles11sp3.xml</pre></div></li><li class="step"><p>
      Back up its disk image file. Use the <code class="command">cp</code> or
      <code class="command">rsync</code> commands to create the backup copy. Remember
      that it is always a good idea to check the copy with the
      <code class="command">md5sum</code> command.
     </p></li><li class="step"><p>
      After the image file is backed up, you can start the guest again with
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh start SLES11SP3</pre></div></li></ol></div></div></section><section class="sect2" id="id-1.12.4.11.5.5" data-id-title="Changes specific to paravirtualized guests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.2.3 </span><span class="title-name">Changes specific to paravirtualized guests</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Apply the following changes if you are migrating a paravirtualized Xen
    guest. You can do it either on the running guest, or on the stopped guest
    using <code class="literal">guestfs-tools</code>.

   </p><div id="id-1.12.4.11.5.5.3" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
     After applying the changes described in this section, the image file
     related to the migrated VM Guest will not be usable under Xen anymore.
    </p></div><section class="sect3" id="id-1.12.4.11.5.5.4" data-id-title="Install the default kernel"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">17.2.3.1 </span><span class="title-name">Install the default kernel</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5.5.4">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.12.4.11.5.5.4.2" data-id-title="No booting" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: No booting</div><p>
      After you install the default kernel, do not try to boot the Xen
      guest with it, as the system will not boot.
     </p></div><p>
     Before cloning the Xen guest disk image for use under the KVM
     hypervisor, make sure it is bootable <span class="emphasis"><em>without</em></span> the
     Xen hypervisor. This is very important for paravirtualized Xen guests
     as they usually contain a special Xen kernel, and often do not have a
     complete GRUB 2 boot loader installed.
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       For SLES 11, update the <code class="filename">/etc/sysconfig/kernel</code>
       file. Change the <code class="literal">INITRD_MODULES</code> parameter by removing
       all Xen drivers and replacing them with virtio drivers. Replace
      </p><div class="verbatim-wrap"><pre class="screen">INITRD_MODULES="xenblk xennet"</pre></div><p>
       with
      </p><div class="verbatim-wrap"><pre class="screen">INITRD_MODULES="virtio_blk virtio_pci virtio_net virtio_balloon"</pre></div><p>
       For SLES 12, search for <code class="literal">xenblk xennet</code> in
       <code class="filename">/etc/dracut.conf.d/*.conf</code> and replace them with
       <code class="literal">virtio_blk virtio_pci virtio_net virtio_balloon</code>
      </p></li><li class="listitem"><p>
       Paravirtualized Xen guests run a specific Xen kernel. To run the
       guest under KVM, you need to install the default kernel.
      </p><div id="id-1.12.4.11.5.5.4.4.2.2" data-id-title="Default kernel is already installed" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Default kernel is already installed</div><p>
        You do not need to install the default kernel for a fully virtualized
        guest, as it is already installed.
       </p></div><p>
       Enter <code class="command">rpm -q kernel-default</code> on the Xen guest to
       find out whether the default kernel is installed. If not, install it with
       <code class="command">zypper in kernel-default</code>.
      </p><p>
       The kernel we are going to use to boot the guest under KVM must have
       <span class="emphasis"><em>virtio</em></span> (paravirtualized) drivers available. Run the
       following command to find out. Do not forget to replace
       <code class="literal">5.3.18-8</code> with your kernel version:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> sudo find /lib/modules/5.3.18-8-default/kernel/drivers/ -name virtio*
/lib/modules/5.3.18-8-default/kernel/drivers/block/virtio_blk.ko
/lib/modules/5.3.18-8-default/kernel/drivers/char/hw_random/virtio-rng.ko
/lib/modules/5.3.18-8-default/kernel/drivers/char/virtio_console.ko
/lib/modules/5.3.18-8-default/kernel/drivers/crypto/virtio
...</pre></div></li><li class="listitem"><p>
       Update <code class="filename">/etc/fstab</code>. Change any storage devices from
       <code class="literal">xvda</code> to <code class="literal">vda</code>.
      </p></li><li class="listitem"><p>
       Update the boot loader configuration. Enter <code class="command">rpm -q
       grub2</code> on the Xen guest to find out whether GRUB 2 is already
       installed. If not, install it with <code class="command">zypper in grub2</code>.
      </p><p>
       Now make the newly installed default kernel the default for booting the
       OS. Also remove/update the kernel command line options that may refer to
       Xen-specific devices. You can do it either with YaST
       (<span class="guimenu">System</span> › <span class="guimenu">Boot
       Loader</span>), or manually:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Find the preferred Linux boot menu entry by listing them all:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /boot/grub2/grub.cfg | grep 'menuentry '</pre></div><p>
         Remember the order number (counted from zero) of the one you newly
         installed.
        </p></li><li class="listitem"><p>
         Set it as the default boot menu entry:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> grub2-set-default <em class="replaceable">N</em></pre></div><p>
         Replace <em class="replaceable">N</em> with the number of the boot menu
         entry you previously discovered.
        </p></li><li class="listitem"><p>
         Open <code class="filename">/etc/default/grub</code>for editing, and look for
         the <code class="option">GRUB_CMDLINE_LINUX_DEFAULT</code> and
         <code class="option">GRUB_CMDLINE_LINUX_RECOVERY</code> options. Remove or update
         any reference to Xen-specific devices. In the following example, you
         can replace
        </p><div class="verbatim-wrap"><pre class="screen">root=/dev/xvda1 disk=/dev/xvda console=xvc</pre></div><p>
         with
        </p><div class="verbatim-wrap"><pre class="screen">root=/dev/vda1 disk=/dev/vda</pre></div><p>
         Note that you need to remove all references to
         <code class="literal">xvc</code>-type consoles (such as
         <code class="literal">xvc0</code>).
        </p></li></ul></div></li><li class="listitem"><p>
       Update <code class="filename">device.map</code> in either the
       <code class="filename">/boot/grub2</code> or <code class="filename">/boot/grub2-efi</code>
       directory, whichever that VM uses. Change any storage devices from
       <code class="literal">xvda</code> to <code class="literal">vda</code>.
      </p></li><li class="listitem"><p>
       To import new default settings, run
      </p><div class="verbatim-wrap"><pre class="screen">grub2-mkconfig -o /boot/grub2/grub.cfg</pre></div></li></ol></div></section><section class="sect3" id="id-1.12.4.11.5.5.5" data-id-title="Update the guest for boot under KVM"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">17.2.3.2 </span><span class="title-name">Update the guest for boot under KVM</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5.5.5">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       Update the system to use the default serial console. List the configured
       consoles, and remove symbolic links to <code class="literal">xvc?</code> ones.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ls -l /etc/systemd/system/getty.target.wants/
getty@tty1.service -&gt; /usr/lib/systemd/system/getty@.service
getty@xvc0.service -&gt; /usr/lib/systemd/system/getty@xvc0.service
getty@xvc1.service -&gt; /usr/lib/systemd/system/getty@xvc1.service

# rm /etc/systemd/system/getty.target.wants/getty@xvc?.service</pre></div></li><li class="listitem"><p>
       Update the <code class="filename">/etc/securetty</code> file. Replace
       <code class="literal">xvc0</code> with <code class="literal">ttyS0</code>.
      </p></li></ol></div></section></section><section class="sect2" id="id-1.12.4.11.5.6" data-id-title="Update the Xen VM Guest configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.2.4 </span><span class="title-name">Update the Xen VM Guest configuration</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5.6">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This section describes how to export the configuration of the original
    Xen VM Guest, and what particular changes to apply to it so it can be
    imported as a KVM guest into <code class="systemitem">libvirt</code>.
   </p><section class="sect3" id="id-1.12.4.11.5.6.3" data-id-title="Export the Xen VM Guest configuration"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">17.2.4.1 </span><span class="title-name">Export the Xen VM Guest configuration</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5.6.3">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     First export the configuration of the guest and save it to a file. For
     example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh dumpxml SLES11SP3
&lt;domain type='xen'&gt;
  &lt;name&gt;SLES11SP3&lt;/name&gt;
  &lt;uuid&gt;fa9ea4d7-8f95-30c0-bce9-9e58ffcabeb2&lt;/uuid&gt;
  &lt;memory&gt;524288&lt;/memory&gt;
  &lt;currentMemory&gt;524288&lt;/currentMemory&gt;
  &lt;vcpu&gt;1&lt;/vcpu&gt;
  &lt;bootloader&gt;/usr/bin/pygrub&lt;/bootloader&gt;
  &lt;os&gt;
    &lt;type&gt;linux&lt;/type&gt;
  &lt;/os&gt;
  &lt;clock offset='utc'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/lib/xen/bin/qemu-dm&lt;/emulator&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='file'/&gt;
      &lt;source file='/var/lib/libvirt/images/SLES_11_SP2_JeOS.x86_64-0.0.2_para.raw'/&gt;
      &lt;target dev='xvda' bus='xen'/&gt;
    &lt;/disk&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='00:16:3e:2d:91:c3'/&gt;
      &lt;source bridge='br0'/&gt;
      &lt;script path='vif-bridge'/&gt;
    &lt;/interface&gt;
    &lt;console type='pty'&gt;
      &lt;target type='xen' port='0'/&gt;
    &lt;/console&gt;
    &lt;input type='mouse' bus='xen'/&gt;
    &lt;graphics type='vnc' port='-1' autoport='yes' keymap='en-us'/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre></div><p>
     You can find detailed information on the libvirt XML format for VM Guest
     description at <a class="link" href="https://libvirt.org/formatdomain.html" target="_blank">https://libvirt.org/formatdomain.html</a>.
    </p></section><section class="sect3" id="id-1.12.4.11.5.6.4" data-id-title="General changes to the guest configuration"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">17.2.4.2 </span><span class="title-name">General changes to the guest configuration</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5.6.4">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You need to make a few general changes to the exported Xen guest XML
     configuration to run it under the KVM hypervisor. The following applies
     to both fully virtualized and paravirtualized guests. Note that not all of
     the following XML elements need to be in your specific configuration.
    </p><div id="id-1.12.4.11.5.6.4.3" data-id-title="Conventions used" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Conventions used</div><p>
      To refer to a node in the XML configuration file, an XPath syntax will be
      used throughout this document. For example, to refer to a
      <code class="literal">&lt;name&gt;</code> inside the
      <code class="literal">&lt;domain&gt;</code> tag
     </p><div class="verbatim-wrap"><pre class="screen">&lt;domain&gt;
  &lt;name&gt;sles11sp3&lt;/name&gt;
&lt;/domain&gt;</pre></div><p>
      an XPath equivalent <code class="literal">/domain/name</code> will be used.
     </p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       Change the <code class="literal">type</code> attribute of the
       <code class="literal">/domain</code> element from <code class="literal">xen</code>to
       <code class="literal">kvm</code>.
      </p></li><li class="listitem"><p>
       Remove the <code class="literal">/domain/bootloader</code> element section.
      </p></li><li class="listitem"><p>
       Remove the <code class="literal">/domain/bootloader_args</code> element section.
      </p></li><li class="listitem"><p>
       Change the <code class="literal">/domain/os/type</code> element value from
       <code class="literal">linux</code> to <code class="literal">hvm</code>.
      </p></li><li class="listitem"><p>
       Add <code class="literal">&lt;boot dev="hd"/&gt;</code> under the
       <code class="literal">/domain/os</code> element.
      </p></li><li class="listitem"><p>
       Add the <code class="literal">arch</code> attribute to the
       <code class="literal">/domain/os/type</code> element. Acceptable values are
       <code class="literal">arch=”x86_64”</code> or
       <code class="literal">arch=”i686”</code>
      </p></li><li class="listitem"><p>
       Change the <code class="literal">/domain/devices/emulator</code> element from
       <code class="literal">/usr/lib/xen/bin/qemu-dm'</code> to
       <code class="literal">/usr/bin/qemu-kvm</code>.
      </p></li><li class="listitem"><p>
       For each disk associated with the paravirtualized (PV) guest, change the
       following:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Change the <code class="literal">name</code> attribute of the
         <code class="literal">/domain/devices/disk/driver</code> element from
         <code class="literal">file</code> to <code class="literal">qemu</code>, and add a
         <code class="literal">type</code> attribute for the disk type. For example,
         valid options include <code class="literal">raw</code> and
         <code class="literal">qcow2</code>.
        </p></li><li class="listitem"><p>
         Change the <code class="literal">dev</code> attribute of the
         <code class="literal">/domain/devices/disk/target</code> element from
         <code class="literal">xvda</code> to <code class="literal">vda</code>.
        </p></li><li class="listitem"><p>
         Change the <code class="literal">bus</code> attribute of the
         <code class="literal">/domain/devices/disk/target</code> element from
         <code class="literal">xen</code> to <code class="literal">virtio</code>.
        </p></li></ul></div></li><li class="listitem"><p>
       For each network interface card, make the following changes:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         If there is a <code class="literal">model</code> defined in
         <code class="literal">/domain/devices/interface</code>, change its
         <code class="literal">type</code> attribute value to <code class="literal">virtio</code>
        </p><div class="verbatim-wrap"><pre class="screen">&lt;model type=”virtio”&gt;</pre></div></li><li class="listitem"><p>
         Delete all <code class="literal">/domain/devices/interface/script</code>
         sections.
        </p></li><li class="listitem"><p>
         Delete all <code class="literal">/domain/devices/interface/target</code>
         elements if the <code class="literal">dev</code> attribute starts with
         <code class="literal">vif</code> or <code class="literal">vnet</code> or
         <code class="literal">veth</code>. If using a custom network then change the
         <code class="literal">dev</code> value to that target.
        </p></li></ul></div></li><li class="listitem"><p>
       Remove the <code class="literal">/domain/devices/console</code> element section if
       it exists.
      </p></li><li class="listitem"><p>
       Remove the <code class="literal">/domain/devices/serial</code> element section if
       it exists.
      </p></li><li class="listitem"><p>
       Change the <code class="literal">bus</code> attribute on the
       <code class="literal">/domain/devices/input</code> element from
       <code class="literal">xen</code> to <code class="literal">ps2</code>.
      </p></li><li class="listitem"><p>
       Add the following element for memory ballooning features under the
       <code class="literal">/domain/devices</code> element.
      </p><div class="verbatim-wrap"><pre class="screen">&lt;memballoon model="virtio"/&gt;</pre></div></li></ol></div><div id="id-1.12.4.11.5.6.4.5" data-id-title="Device name" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Device name</div><p>
      <code class="literal">&lt;target dev='hda' bus='ide'/&gt;</code> controls the
      device under which the disk is exposed to the guest OS. The
      <code class="literal">dev</code> attribute indicates the "logical" device name. The
      actual device name specified is not guaranteed to map to the device name
      in the guest OS. Therefore you may need to change the disk mapping on the
      boot loader command line. For example, if the boot loader expects a root
      disk to be <code class="literal">hda2</code> but KVM still sees it as
      <code class="literal">sda2</code>, change the boot loader command line from
     </p><div class="verbatim-wrap"><pre class="screen">[...] root=/dev/hda2 resume=/dev/hda1 [...]</pre></div><p>
      to
     </p><div class="verbatim-wrap"><pre class="screen">[...] root=/dev/sda2 resume=/dev/sda1 [...]</pre></div><p>
      In the case of paravirtualized <code class="literal">xvda</code> devices, change it
      to
     </p><div class="verbatim-wrap"><pre class="screen">[...] root=/dev/vda2 resume=/dev/vda1 [...]</pre></div><p>
      Otherwise the VM Guest will refuse to boot in the KVM environment.
     </p></div></section><section class="sect3" id="id-1.12.4.11.5.6.5" data-id-title="The target KVM guest configuration"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">17.2.4.3 </span><span class="title-name">The target KVM guest configuration</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5.6.5">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     After having applied all the modifications mentioned above, you end up
     with the following configuration for your KVM guest:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;domain type='kvm'&gt;
  &lt;name&gt;SLES11SP3&lt;/name&gt;
  &lt;uuid&gt;fa9ea4d7-8f95-30c0-bce9-9e58ffcabeb2&lt;/uuid&gt;
  &lt;memory&gt;524288&lt;/memory&gt;
  &lt;currentMemory&gt;524288&lt;/currentMemory&gt;
  &lt;vcpu cpuset='0-3'&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type arch=”x86_64”&gt;hvm&lt;/type&gt;
    &lt;boot dev="hd"/&gt;
  &lt;/os&gt;
  &lt;clock offset='utc'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt;
    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type="raw"/&gt;
      &lt;source file='/var/lib/libvirt/images/SLES_11_SP2_JeOS.x86_64-0.0.2_para.raw'/&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
    &lt;/disk&gt;
    &lt;interface type='bridge'&gt;
      &lt;mac address='00:16:3e:2d:91:c3'/&gt;
      &lt;source bridge='br0'/&gt;
    &lt;/interface&gt;
    &lt;input type='mouse' bus='usb'/&gt;
    &lt;graphics type='vnc' port='5900' autoport='yes' keymap='en-us'/&gt;
    &lt;memballoon model="virtio"/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;</pre></div><p>
     Save the configuration to a file in your home directory, as
     <code class="filename">SLES11SP3.xml</code>, for example. After you import it, it will be
     copied to the default <code class="filename">/etc/libvirt/qemu</code> folder.
    </p></section></section><section class="sect2" id="id-1.12.4.11.5.7" data-id-title="Migrate the VM Guest"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.2.5 </span><span class="title-name">Migrate the VM Guest</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.5.7">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    After you updated the VM Guest configuration, and applied necessary
    changes to the guest OS, shut down the original Xen guest, and run its
    clone under the KVM hypervisor.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Shut down the guest on the Xen host by running <code class="command">shutdown -h
      now</code> as <code class="systemitem">root</code> from the console.
     </p></li><li class="step"><p>
      Copy the disk files associated with the VM Guest if needed. A default
      configuration will require the Xen disk files to be copied from
      <code class="filename">/var/lib/xen/images</code> to
      <code class="filename">/var/lib/kvm/images</code>. The
      <code class="filename">/var/lib/kvm/images</code> directory may need to be created
      (as <code class="systemitem">root</code>) if you have not previously created a VM Guest.
     </p></li><li class="step"><p>
      Create the new domain, and register it with <code class="systemitem">libvirt</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh define SLES11SP3.xml
 Domain SLES11SP3 defined from SLES11SP3.xml</pre></div></li><li class="step"><p>
      Verify that the new guest is seen in the KVM configuration:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh list –all</pre></div></li><li class="step"><p>
      After the domain is created, you can start it:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh start SLES11SP3
 Domain SLES11SP3 started</pre></div></li></ol></div></div></section></section><section class="sect1" id="id-1.12.4.11.6" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.3 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#id-1.12.4.11.6">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen2kvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For more information on libvirt, see
   <a class="link" href="https://libvirt.org" target="_blank">https://libvirt.org</a>.
  </p><p>
   You can find more details on the <code class="systemitem">libvirt</code> XML format at
   <a class="link" href="https://libvirt.org/formatdomain.html" target="_blank">https://libvirt.org/formatdomain.html</a>.
  </p><p>
   For more information on virtualization with Xen and KVM, see the
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> documentation at
   <a class="link" href="https://documentation.suse.com/" target="_blank">https://documentation.suse.com/</a>.
  </p></section></section></div><div class="part" id="part-virt-common" data-id-title="Hypervisor-independent features"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part III </span><span class="title-name">Hypervisor-independent features </span></span><a title="Permalink" class="permalink" href="#part-virt-common">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/book_virtualization.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-cachemodes"><span class="title-number">18 </span><span class="title-name">Disk cache modes</span></a></span></li><dd class="toc-abstract"><p/></dd><li><span class="chapter"><a href="#sec-kvm-managing-clock"><span class="title-number">19 </span><span class="title-name">VM Guest clock settings</span></a></span></li><dd class="toc-abstract"><p>
    Keeping the correct time in a VM Guest is one of the more difficult
    aspects of virtualization. Keeping the correct time is especially important
    for network applications and is also a prerequisite to do a live migration
    of a VM Guest.
   </p></dd><li><span class="chapter"><a href="#chap-guestfs"><span class="title-number">20 </span><span class="title-name">libguestfs</span></a></span></li><dd class="toc-abstract"><p>
          <a class="xref" href="#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a>s consist of disk images and definition
    files. Manually accessing and manipulating these guest components
    (outside of normal hypervisor processes) is possible, but inherently
    dangerous and risks compromising data integrity. libguestfs is a C
    library and a corresponding set of tools designed for safely accessing and
    modifying <a class="xref" href="#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a> disk images—outside of normal
    hypervisor processes, but without the risk normally associated with
    manual editing.
   </p></dd><li><span class="chapter"><a href="#cha-qemu-ga"><span class="title-number">21 </span><span class="title-name">QEMU guest agent</span></a></span></li><dd class="toc-abstract"><p>
  The QEMU guest agent (GA) runs inside the VM Guest and allows the VM Host Server
  to run commands in the guest operating system via <code class="systemitem">libvirt</code>. It supports
  many functions—for example, getting details about guest file systems,
  freezing and thawing file systems, or suspending or rebooting a guest.
 </p></dd><li><span class="chapter"><a href="#tpm"><span class="title-number">22 </span><span class="title-name">Software TPM emulator</span></a></span></li><dd class="toc-abstract"><p>The Trusted Platform Module (TPM) is a cryptoprocessor that secures hardware using cryptographic keys. For developers who use the TPM to develop security features, a software TPM emulator is a convenient solution. Compared to a hardware TPM device, the emulator has no limit on the number of guests t…</p></dd></ul></div><section class="chapter" id="cha-cachemodes" data-id-title="Disk cache modes"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">18 </span><span class="title-name">Disk cache modes</span></span> <a title="Permalink" class="permalink" href="#cha-cachemodes">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_cachemodes.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="what-is-disk-cache" data-id-title="What is a disk cache?"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.1 </span><span class="title-name">What is a disk cache?</span></span> <a title="Permalink" class="permalink" href="#what-is-disk-cache">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_cachemodes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A disk cache is a memory used to speed up the process of storing and
   accessing data from the hard disk. Physical hard disks have their cache
   integrated as a standard feature. For virtual disks, the cache uses
   VM Host Server's memory and you can fine-tune its behavior, for example, by
   setting its type.
  </p></section><section class="sect1" id="how-it-works-disk-cache" data-id-title="How does a disk cache work?"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.2 </span><span class="title-name">How does a disk cache work?</span></span> <a title="Permalink" class="permalink" href="#how-it-works-disk-cache">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_cachemodes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Normally, a disk cache stores the most recent and frequently used programs
   and data. When a user or program requests data, the operating system first
   checks the disk cache. If the data is there, the operating system quickly
   delivers the data to the program instead of re-reading the data from the
   disk.
  </p><div class="figure" id="fig-caching"><div class="figure-contents"><div class="mediaobject"><a href="images/virt-disk-cache.png"><img src="images/virt-disk-cache.png" alt="Caching mechanism" title="Caching mechanism"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 18.1: </span><span class="title-name">Caching mechanism </span></span><a title="Permalink" class="permalink" href="#fig-caching">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_cachemodes.xml" title="Edit source document"> </a></div></div></div></section><section class="sect1" id="benefits-disk-cache" data-id-title="Benefits of disk caching"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.3 </span><span class="title-name">Benefits of disk caching</span></span> <a title="Permalink" class="permalink" href="#benefits-disk-cache">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_cachemodes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Caching of virtual disk devices affects the overall performance of guest
   machines. You can improve the performance by optimizing the combination of
   cache mode, disk image format, and storage subsystem.
  </p></section><section class="sect1" id="cachemodes-descr" data-id-title="Virtual disk cache modes"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.4 </span><span class="title-name">Virtual disk cache modes</span></span> <a title="Permalink" class="permalink" href="#cachemodes-descr">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_cachemodes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you do not specify a cache mode, <code class="literal">writeback</code> is used by
   default. Each guest disk can use a one of the following cache modes:
  </p><div class="variablelist"><dl class="variablelist"><dt id="cache-writeback"><span class="term">writeback</span></dt><dd><p>
      <code class="literal">writeback</code> uses the host page cache. Writes are
      reported to the guest as completed when they are placed in the host
      cache. Cache management handles commitment to the storage device. The
      guest's virtual storage adapter is informed of the
      <span class="emphasis"><em>writeback</em></span> cache and therefore expected to send flush
      commands as needed to manage data integrity.
     </p></dd><dt id="cache-writethrough"><span class="term">writethrough</span></dt><dd><p>
      Writes are reported as completed only when the data has been committed to
      the storage device. The guest's virtual storage adapter is informed that
      there is no <span class="emphasis"><em>writeback</em></span> cache, so the guest do not
      need to send flush commands to manage data integrity.
     </p></dd><dt id="cache-none"><span class="term">none</span></dt><dd><p>
      The host cache is bypassed, and reads and writes happen directly between
      the hypervisor and the storage device. Because the actual storage device
      may report a write as completed when the data is still placed in its
      write queue only, the guest's virtual storage adapter is informed that
      there is a <span class="emphasis"><em>writeback</em></span> cache. This mode is equivalent
      to direct access to the host's disk.
     </p></dd><dt id="cache-unsafe"><span class="term">unsafe</span></dt><dd><p>
      Similar to the <span class="emphasis"><em>writeback</em></span> mode, except all flush
      commands from the guests are ignored. Using this mode implies that the
      user prioritizes performance gain over the risk of data loss in case of a
      host failure. This mode can be useful during guest installation, but not
      for production workloads.
     </p></dd><dt id="cache-directsync"><span class="term">directsync</span></dt><dd><p>
      Writes are reported as completed only when the data has been committed to
      the storage device and the host cache is bypassed. Similar to
      <span class="emphasis"><em>writethrough</em></span>, this mode can be useful for guests
      that do not send flushes when needed.
     </p></dd></dl></div></section><section class="sect1" id="qemu-cachemodes-data-integrity" data-id-title="Cache modes and data integrity"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.5 </span><span class="title-name">Cache modes and data integrity</span></span> <a title="Permalink" class="permalink" href="#qemu-cachemodes-data-integrity">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_cachemodes.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.5.2.8.2.1"><span class="term">writethrough, none, directsync</span></dt><dd><p>
      These modes are considered to be safest when the guest operating system
      uses flushes as needed. For unsafe or unstable guests, use
      <span class="emphasis"><em>writethough</em></span> or <span class="emphasis"><em>directsync</em></span>.
     </p></dd><dt id="id-1.12.5.2.8.2.2"><span class="term">writeback</span></dt><dd><p>
      This mode informs the guest of the presence of a write cache, and it
      relies on the guest to send flush commands as needed to maintain data
      integrity within its disk image. This mode exposes the guest to data loss
      in the case of a host failure due to a gap between the moment a write is
      reported as completed and the time the write being committed to the
      storage device.
     </p></dd><dt id="id-1.12.5.2.8.2.3"><span class="term">unsafe</span></dt><dd><p>
      This mode is similar to <span class="emphasis"><em>writeback</em></span> caching, except
      the guest flush commands are ignored. This means a higher risk of data
      loss due to host failure.
     </p></dd></dl></div></section><section class="sect1" id="sec-cache-mode-live-migration" data-id-title="Cache modes and live migration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.6 </span><span class="title-name">Cache modes and live migration</span></span> <a title="Permalink" class="permalink" href="#sec-cache-mode-live-migration">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_cachemodes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The caching of storage data restricts the configurations that support live
   migration. Currently, only <code class="literal">raw</code> and
   <code class="literal">qcow2</code> image formats can be used for live migration. If a
   clustered file system is used, all cache modes support live migration.
   Otherwise the only cache mode that supports live migration on read/write
   shared storage is <code class="literal">none</code>.
  </p><p>
   The <code class="systemitem">libvirt</code> management layer includes checks for migration compatibility
   based on several factors. If the guest storage is hosted on a clustered file
   system, is read-only, or is marked shareable, then the cache mode is ignored
   when determining if migration can be allowed. Otherwise <code class="systemitem">libvirt</code> will not
   allow migration unless the cache mode is set to <code class="literal">none</code>.
   However, this restriction can be overridden with the <span class="quote">“<span class="quote">--unsafe</span>”</span>
   option to the migration APIs, which is also supported by
   <code class="command">virsh</code>. For example
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh migrate --live --unsafe</pre></div><div id="id-1.12.5.2.9.5" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    The cache mode <code class="literal">none</code> is required for the AIO mode setting
    <code class="literal">native</code>. If another cache mode is used, the AIO mode is
    silently switched back to the default <code class="literal">threads</code>.
   </p></div></section></section><section class="chapter" id="sec-kvm-managing-clock" data-id-title="VM Guest clock settings"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">19 </span><span class="title-name">VM Guest clock settings</span></span> <a title="Permalink" class="permalink" href="#sec-kvm-managing-clock">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_clocksettings.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Keeping the correct time in a VM Guest is one of the more difficult
    aspects of virtualization. Keeping the correct time is especially important
    for network applications and is also a prerequisite to do a live migration
    of a VM Guest.
   </p></div></div></div></div><div id="id-1.12.5.3.3" data-id-title="Timekeeping on the VM Host Server" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Timekeeping on the VM Host Server</div><p>
   It is strongly recommended to ensure the VM Host Server keeps the correct time as
   well, for example, by using NTP (see <span class="intraxref">Book “Administration Guide”, Chapter 30 “Time synchronization with NTP”</span> for more
   information).
  </p></div><section class="sect1" id="sec-kvm-managing-clock-kvm" data-id-title="KVM: using kvm_clock"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.1 </span><span class="title-name">KVM: using <code class="systemitem">kvm_clock</code></span></span> <a title="Permalink" class="permalink" href="#sec-kvm-managing-clock-kvm">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_clocksettings.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   KVM provides a paravirtualized clock which is supported via the
   <code class="systemitem">kvm_clock</code> driver. It is strongly recommended to use
   <code class="systemitem">kvm_clock</code>.
  </p><p>
   Use the following command inside a VM Guest running Linux to check whether
   the driver <code class="systemitem">kvm_clock</code> has been loaded:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dmesg | grep kvm-clock
[    0.000000] kvm-clock: cpu 0, msr 0:7d3a81, boot clock
[    0.000000] kvm-clock: cpu 0, msr 0:1206a81, primary cpu clock
[    0.012000] kvm-clock: cpu 1, msr 0:1306a81, secondary cpu clock
[    0.160082] Switching to clocksource kvm-clock</pre></div><p>
   To check which clock source is currently used, run the following command in
   the VM Guest. It should output <code class="literal">kvm-clock</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /sys/devices/system/clocksource/clocksource0/current_clocksource</pre></div><div id="id-1.12.5.3.4.7" data-id-title="kvm-clock and NTP" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: <code class="literal">kvm-clock</code> and NTP</div><p>
    When using <code class="literal">kvm-clock</code>, it is recommended to use NTP in
    the VM Guest, as well. Using NTP on the VM Host Server is also recommended.
   </p></div><section class="sect2" id="sec-kvm-managing-clock-other" data-id-title="Other timekeeping methods"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.1.1 </span><span class="title-name">Other timekeeping methods</span></span> <a title="Permalink" class="permalink" href="#sec-kvm-managing-clock-other">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_clocksettings.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The paravirtualized <code class="literal">kvm-clock</code> is currently not for
    Windows* operating systems. For Windows*, use the <code class="literal">Windows Time
    Service Tools</code> for time synchronization.
   </p></section></section><section class="sect1" id="sec-xen-guests-suse-time" data-id-title="Xen virtual machine clock settings"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.2 </span><span class="title-name">Xen virtual machine clock settings</span></span> <a title="Permalink" class="permalink" href="#sec-xen-guests-suse-time">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_clocksettings.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   With Xen 4, the independent wallclock setting
   <code class="filename">/proc/sys/xen/independent_wallclock</code> used for time
   synchronization between Xen host and guest was removed. A new
   configuration option <code class="option">tsc_mode</code> was introduced. It specifies
   a method of using the <span class="emphasis"><em>time stamp counter</em></span> to
   synchronize the guest time with the Xen server. Its default value '0'
   handles the vast majority of hardware and software environments.
  </p><p>
   For more details on <code class="option">tsc_mode</code>, see the
   <code class="literal">xen-tscmode</code> manual page (<code class="command">man 7
   xen-tscmode</code>).
  </p></section></section><section xml:lang="en" class="chapter" id="chap-guestfs" data-id-title="libguestfs"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">20 </span><span class="title-name">libguestfs</span></span> <a title="Permalink" class="permalink" href="#chap-guestfs">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
          <a class="xref" href="#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a>s consist of disk images and definition
    files. Manually accessing and manipulating these guest components
    (outside of normal hypervisor processes) is possible, but inherently
    dangerous and risks compromising data integrity. libguestfs is a C
    library and a corresponding set of tools designed for safely accessing and
    modifying <a class="xref" href="#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a> disk images—outside of normal
    hypervisor processes, but without the risk normally associated with
    manual editing.
   </p></div></div></div></div><div id="id-1.12.5.4.3" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
     Using libguestfs tools is fully supported on the AMD64/Intel 64 architecture
     only.
    </p></div><section class="sect1" id="sec-guestfs-intro" data-id-title="VM Guest manipulation overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.1 </span><span class="title-name">VM Guest manipulation overview</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-guestfs-intro-risk" data-id-title="VM Guest manipulation risk"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.1.1 </span><span class="title-name">VM Guest manipulation risk</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-intro-risk">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As disk images and definition files are simply another type of file in a
    Linux environment, it is possible to use many tools to access,
    edit and write to these files. When used correctly, such tools can be an
    important part of guest administration. However, even correct usage of
    these tools is not without risk. Risks that should be considered when
    manually manipulating guest disk images include:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <span class="emphasis"><em>Data Corruption</em></span>: Concurrently accessing images,
      by the host machine or another node in a cluster, can cause changes to
      be lost or data corruption to occur if virtualization protection
      layers are bypassed.
     </p></li><li class="listitem"><p>
      <span class="emphasis"><em>Security</em></span>: Mounting disk images as loop devices
      requires root access. While an image is loop mounted, other users and
      processes can potentially access the disk contents.
     </p></li><li class="listitem"><p>
      <span class="emphasis"><em>Administrator Error</em></span>: Bypassing virtualization
      layers correctly requires advanced understanding of virtual components
      and tools. Failing to isolate the images or failing to clean up
      properly after changes have been made can lead to further problems
      once back in virtualization control.
     </p></li></ul></div></section><section class="sect2" id="sec-guestfs-intro-design" data-id-title="libguestfs design"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.1.2 </span><span class="title-name">libguestfs design</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-intro-design">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    libguestfs C library has been designed to safely and securely create,
    access and modify virtual machine (VM Guest) disk images. It also
    provides additional language bindings: for
    <a class="link" href="https://libguestfs.org/guestfs-perl.3.html" target="_blank">Perl</a>,
    <a class="link" href="https://libguestfs.org/guestfs-python.3.html" target="_blank">Python</a>,
    PHP (only for 64-bit machines), and
    <a class="link" href="https://libguestfs.org/guestfs-ruby.3.html" target="_blank">
    Ruby</a>. libguestfs can access VM Guest disk images without
    needing root and with multiple layers of defense against rogue disk
    images.
   </p><p>
    libguestfs provides many tools designed for accessing and
    modifying VM Guest disk images and contents. These tools provide
    such capabilities as: viewing and editing files inside guests, scripting
    changes to VM Guests, monitoring disk used/free statistics, creating
    guests, doing V2V or P2V migrations, performing backups, cloning VM Guests,
    formatting disks, and resizing disks.
   </p><div id="id-1.12.5.4.4.4.4" data-id-title="Best practices" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Best practices</div><p>
     You must not use libguestfs tools on live virtual machines. Doing so
     will probably result in disk corruption in the VM Guest. libguestfs
     tools try to stop you from doing this, but cannot catch all cases.
    </p><p>
     However most command have the <code class="option">--ro</code> (read-only) option.
     With this option, you can attach a command to a live virtual machine.
     The results might be strange or inconsistent at times but you will not
     risk disk corruption.
    </p></div></section></section><section class="sect1" id="sec-guestfs-package" data-id-title="Package installation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.2 </span><span class="title-name">Package installation</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-package">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   libguestfs is shipped through 4 packages:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="systemitem">libguestfs0</code>: which provides
     the main C library
    </p></li><li class="listitem"><p>
     <code class="systemitem">guestfs-data</code>: which contains
     the appliance files used when launching images (stored in
     <code class="filename">/usr/lib64/guestfs</code>)
    </p></li><li class="listitem"><p>
     <code class="systemitem">guestfs-tools</code>: the core guestfs
     tools, man pages, and the <code class="filename">/etc/libguestfs-tools.conf</code>
     configuration file.
    </p></li><li class="listitem"><p>
     <code class="systemitem">guestfs-winsupport</code>: provides
     support for Windows file guests in the guestfs tools. This package only
     needs to be installed to handle Windows guests, for example when
     converting a Windows guest to KVM.
    </p></li></ul></div><p>
   To install guestfs tools on your system run:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper in guestfs-tools</pre></div></section><section class="sect1" id="sec-guestfs-tools" data-id-title="Guestfs tools"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.3 </span><span class="title-name">Guestfs tools</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-guestfs-tools-intro" data-id-title="Modifying virtual machines"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.1 </span><span class="title-name">Modifying virtual machines</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-intro">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The set of tools found within the guestfs-tools package is used for
    accessing and modifying virtual machine disk images. This functionality
    is provided through a familiar shell interface with built-in safeguards
    which ensure image integrity. Guestfs tools shells expose all
    capabilities of the guestfs API, and create an appliance on the fly
    using the packages installed on the machine and the files found in
    <code class="filename">/usr/lib64/guestfs</code>.
   </p></section><section class="sect2" id="sec-guestfs-tools-supportedfs" data-id-title="Supported file systems and disk images"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.2 </span><span class="title-name">Supported file systems and disk images</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-supportedfs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Guestfs tools support various file systems including:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Ext2, Ext3, Ext4
     </p></li><li class="listitem"><p>
      Xfs
     </p></li><li class="listitem"><p>
      Btrfs
     </p></li></ul></div><p>
    Multiple disk image formats are also supported:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      raw
     </p></li><li class="listitem"><p>
      qcow2
     </p></li></ul></div><div id="id-1.12.5.4.6.4.6" data-id-title="Unsupported file systems" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Unsupported file systems</div><p>
     Guestfs may also support Windows* file systems (VFAT, NTFS), BSD* and
     Apple* file systems, and other disk image formats (VMDK, VHDX...).
     However, these file systems and disk image formats are unsupported on
     <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>.
    </p></div></section><section class="sect2" id="sec-guestfs-tools-virt-rescue" data-id-title="virt-rescue"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.3 </span><span class="title-name"><code class="command">virt-rescue</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-virt-rescue">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">virt-rescue</code> is similar to a rescue CD, but for
    virtual machines, and without the need for a CD. virt-rescue presents
    users with a rescue shell and some simple recovery tools which can be
    used to examine and correct problems within a virtual machine or disk
    image.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-rescue -a sles.qcow2
Welcome to virt-rescue, the libguestfs rescue shell.

Note: The contents of / are the rescue appliance.
You need to mount the guest's partitions under /sysroot
before you can examine them. A helper script for that exists:
mount-rootfs-and-do-chroot.sh /dev/sda2

&gt;&lt;rescue&gt;
[   67.194384] EXT4-fs (sda1): mounting ext3 file system
using the ext4 subsystem
[   67.199292] EXT4-fs (sda1): mounted filesystem with ordered data
mode. Opts: (null)
mount: /dev/sda1 mounted on /sysroot.
mount: /dev bound on /sysroot/dev.
mount: /dev/pts bound on /sysroot/dev/pts.
mount: /proc bound on /sysroot/proc.
mount: /sys bound on /sysroot/sys.
Directory: /root
Thu Jun  5 13:20:51 UTC 2014
(none):~ #</pre></div><p>
    You are now running the VM Guest in rescue mode:
   </p><div class="verbatim-wrap"><pre class="screen">(none):~ # cat /etc/fstab
devpts  /dev/pts          devpts  mode=0620,gid=5 0 0
proc    /proc             proc    defaults        0 0
sysfs   /sys              sysfs   noauto          0 0
debugfs /sys/kernel/debug debugfs noauto          0 0
usbfs   /proc/bus/usb     usbfs   noauto          0 0
tmpfs   /run              tmpfs   noauto          0 0
/dev/disk/by-id/ata-QEMU_HARDDISK_QM00001-part1 / ext3 defaults 1 1</pre></div></section><section class="sect2" id="sec-guestfs-tools-virt-resize" data-id-title="virt-resize"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.4 </span><span class="title-name"><code class="command">virt-resize</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-virt-resize">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">virt-resize</code> is used to resize a virtual machine disk,
    making it larger or smaller overall, and resizing or deleting any
    partitions contained within.
   </p><div class="procedure" id="pro-guestfs-tools-virt-resize" data-id-title="Expanding a disk"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 20.1: </span><span class="title-name">Expanding a disk </span></span><a title="Permalink" class="permalink" href="#pro-guestfs-tools-virt-resize">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
     Full step-by-step example: How to expand a virtual machine disk
    </p><ol class="procedure" type="1"><li class="step"><p>
      First, with virtual machine powered off, determine the size of the
      partitions available on this virtual machine:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-filesystems --long --parts --blkdevs -h -a sles.qcow2
Name       Type       MBR  Size  Parent
/dev/sda1  partition  83   16G   /dev/sda
/dev/sda   device     -    16G   -</pre></div></li><li class="step"><p>
      <code class="command">virt-resize</code> cannot do in-place disk
      modifications—there must be sufficient space to store the
      resized output disk. Use the <code class="command">truncate</code> command to
      create a file of suitable size:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>truncate -s 32G outdisk.img</pre></div></li><li class="step"><p>
      Use <code class="command">virt-resize</code> to resize the disk image.
      <code class="command">virt-resize</code> requires two mandatory parameters for
      the input and output images:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-resize --expand /dev/sda1 sles.qcow2 outdisk.img
Examining sles.qcow2 ...
**********
Summary of changes:

/dev/sda1: This partition will be resized from 16,0G to 32,0G.  The
    filesystem ext3 on /dev/sda1 will be expanded using the 'resize2fs'
    method.

**********
Setting up initial partition table on outdisk.img ...
Copying /dev/sda1 ...
◐ 84%
⟦▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒════════⟧ 00:03
Expanding /dev/sda1 using the 'resize2fs' method ...

Resize operation completed with no errors.  Before deleting the old
disk, carefully check that the resized disk boots and works correctly.</pre></div></li><li class="step"><p>
      Confirm the image was resized properly:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-filesystems --long --parts --blkdevs -h -a outdisk.img
Name       Type       MBR  Size  Parent
/dev/sda1  partition  83   32G   /dev/sda
/dev/sda   device     -    32G   -</pre></div></li><li class="step"><p>
      Bring up the VM Guest using the new disk image and confirm correct
      operation before deleting the old image.
     </p></li></ol></div></div></section><section class="sect2" id="sec-guestfs-tools-others" data-id-title="Other virt-* tools"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.5 </span><span class="title-name">Other virt-* tools</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-others">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There are guestfs tools to simplify administrative
    tasks—such as viewing and editing files, or obtaining
    information on the virtual machine.
   </p><section class="sect3" id="sec-guestfs-tools-others-filesystem" data-id-title="virt-filesystems"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.5.1 </span><span class="title-name"><code class="command">virt-filesystems</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-others-filesystem">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This tool is used to report information regarding file systems,
     partitions, and logical volumes in a disk image or virtual machine.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-filesystems -l -a sles.qcow2
Name       Type        VFS   Label  Size         Parent
/dev/sda1  filesystem  ext3  -      17178820608  -</pre></div></section><section class="sect3" id="sec-guestfs-tools-others-ls" data-id-title="virt-ls"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.5.2 </span><span class="title-name"><code class="command">virt-ls</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-others-ls">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">virt-ls</code> lists file names, file sizes, checksums,
     extended attributes and more from a virtual machine or disk image.
     Multiple directory names can be given, in which case the output from
     each is concatenated. To list directories from a libvirt guest, use the
     <code class="option">-d</code> option to specify the name of the guest. For a disk
     image, use the <code class="option">-a</code> option.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-ls -h -lR -a sles.qcow2 /var/log/
d 0755        776 /var/log
- 0640          0 /var/log/NetworkManager
- 0644        23K /var/log/Xorg.0.log
- 0644        23K /var/log/Xorg.0.log.old
d 0700        482 /var/log/YaST2
- 0644        512 /var/log/YaST2/_dev_vda
- 0644         59 /var/log/YaST2/arch.info
- 0644        473 /var/log/YaST2/config_diff_2017_05_03.log
- 0644       5.1K /var/log/YaST2/curl_log
- 0644       1.5K /var/log/YaST2/disk_vda.info
- 0644       1.4K /var/log/YaST2/disk_vda.info-1
[...]</pre></div></section><section class="sect3" id="sec-guestfs-tools-others-cat" data-id-title="virt-cat"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.5.3 </span><span class="title-name"><code class="command">virt-cat</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-others-cat">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">virt-cat</code> is a command line tool to display the
     contents of a file that exists in the named virtual machine (or disk
     image). Multiple file names can be given, in which case they are
     concatenated together. Each file name must be a full path, starting at
     the root directory (starting with '/').
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-cat -a sles.qcow2 /etc/fstab
devpts /dev/pts devpts mode=0620,gid=5 0 0
proc   /proc    proc   defaults        0 0</pre></div></section><section class="sect3" id="sec-guestfs-tools-others-df" data-id-title="virt-df"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.5.4 </span><span class="title-name"><code class="command">virt-df</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-others-df">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">virt-df</code> is a command line tool to display free space on
     virtual machine file systems. Unlike other tools, it not only displays the
     size of disk allocated to a virtual machine, but can look inside disk
     images to show how much space is actually being used.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-df -a sles.qcow2
Filesystem                           1K-blocks       Used  Available  Use%
sles.qcow2:/dev/sda1                  16381864     520564   15022492  4%</pre></div></section><section class="sect3" id="sec-guestfs-tools-others-edit" data-id-title="virt-edit"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.5.5 </span><span class="title-name"><code class="command">virt-edit</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-others-edit">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">virt-edit</code> is a command line tool capable of editing
     files that reside in the named virtual machine (or disk image).
    </p></section><section class="sect3" id="sec-guestfs-tools-others-tar" data-id-title="virt-tar-in/out"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.5.6 </span><span class="title-name"><code class="command">virt-tar-in/out</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-others-tar">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">virt-tar-in</code> unpacks an uncompressed TAR archive into a
     virtual machine disk image or named libvirt domain.
     <code class="command">virt-tar-out</code> packs a virtual machine disk image
     directory into a TAR archive.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-tar-out -a sles.qcow2 /home homes.tar</pre></div></section><section class="sect3" id="sec-guestfs-tools-others-copy" data-id-title="virt-copy-in/out"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.5.7 </span><span class="title-name"><code class="command">virt-copy-in/out</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-others-copy">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">virt-copy-in</code> copies files and directories from the
     local disk into a virtual machine disk image or named libvirt domain.
     <code class="command">virt-copy-out</code> copies files and directories out of a
     virtual machine disk image or named libvirt domain.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-copy-in -a sles.qcow2 data.tar /tmp/
virt-ls -a sles.qcow2 /tmp/
.ICE-unix
.X11-unix
data.tar</pre></div></section><section class="sect3" id="sec-guestfs-tools-others-log" data-id-title="virt-log"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">20.3.5.8 </span><span class="title-name"><code class="command">virt-log</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-tools-others-log">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">virt-log</code> shows the log files of the named libvirt
     domain, virtual machine or disk image. If the package
     <span class="package">guestfs-winsupport</span> is installed
     it can also show the event log of a Windows virtual machine disk image.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-log -a windows8.qcow2
&lt;?xml version="1.0" encoding="utf-8" standalone="yes" ?&gt;
&lt;Events&gt;
&lt;Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event"&gt;&lt;System&gt;&lt;Provider Name="EventLog"&gt;&lt;/Provider&gt;
&lt;EventID Qualifiers="32768"&gt;6011&lt;/EventID&gt;
&lt;Level&gt;4&lt;/Level&gt;
&lt;Task&gt;0&lt;/Task&gt;
&lt;Keywords&gt;0x0080000000000000&lt;/Keywords&gt;
&lt;TimeCreated SystemTime="2014-09-12 05:47:21"&gt;&lt;/TimeCreated&gt;
&lt;EventRecordID&gt;1&lt;/EventRecordID&gt;
&lt;Channel&gt;System&lt;/Channel&gt;
&lt;Computer&gt;windows-uj49s6b&lt;/Computer&gt;
&lt;Security UserID=""&gt;&lt;/Security&gt;
&lt;/System&gt;
&lt;EventData&gt;&lt;Data&gt;&lt;string&gt;WINDOWS-UJ49S6B&lt;/string&gt;
&lt;string&gt;WIN-KG190623QG4&lt;/string&gt;
&lt;/Data&gt;
&lt;Binary&gt;&lt;/Binary&gt;
&lt;/EventData&gt;
&lt;/Event&gt;

...</pre></div></section></section><section class="sect2" id="sec-guestfs-guestfish" data-id-title="guestfish"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.6 </span><span class="title-name"><code class="command">guestfish</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-guestfish">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">guestfish</code> is a shell and command line tool for
    examining and modifying virtual machine file systems. It uses libguestfs
    and exposes all of the functionality of the guestfs API.
   </p><p>
    Examples of usage:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>guestfish -a disk.img &lt;&lt;EOF
run
list-filesystems
EOF</pre></div><div class="verbatim-wrap"><pre class="screen">guestfish

Welcome to guestfish, the guest filesystem shell for
editing virtual machine filesystems and disk images.

Type: 'help' for help on commands
      'man' to read the manual
      'quit' to quit the shell

&gt;&lt;fs&gt; add sles.qcow2
&gt;&lt;fs&gt; run
&gt;&lt;fs&gt; list-filesystems
/dev/sda1: ext3
&gt;&lt;fs&gt; mount /dev/sda1 /
 cat /etc/fstab
devpts  /dev/pts          devpts  mode=0620,gid=5 0 0
proc    /proc             proc    defaults        0 0
sysfs   /sys              sysfs   noauto          0 0
debugfs /sys/kernel/debug debugfs noauto          0 0
usbfs   /proc/bus/usb     usbfs   noauto          0 0
tmpfs   /run              tmpfs   noauto          0 0
/dev/disk/by-id/ata-QEMU_HARDDISK_QM00001-part1 / ext3 defaults 1 1</pre></div></section><section class="sect2" id="sec-guestfs-p2v" data-id-title="Converting a physical machine into a KVM guest"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.7 </span><span class="title-name">Converting a physical machine into a KVM guest</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-p2v">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Libguestfs provides tools to help converting Xen virtual machines or
    physical machines into KVM guests. <span class="phrase">The Xen to KVM
    conversion scenario is covered by the <a class="xref" href="#xen2kvm-migration" title="Chapter 17. Xen to KVM migration guide">Chapter 17, <em>Xen to KVM migration guide</em></a>.</span> The following section will
    cover a special use case: converting a bare metal machine into a KVM one.
   </p><p>
      Converting a physical machine into a KVM one is not yet supported
      in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>.  This feature is released as a technology
      preview only.
   </p><p>
    Converting a physical machine requires collecting information about
    it and transmitting this to a conversion server. This is achieved by
    running a live system prepared with <code class="command">virt-p2v</code> and
    <code class="command">kiwi</code> tools on the machine.
   </p><div class="procedure" id="pro-guestfs-p2v-kiwi" data-id-title="Using virt-p2v"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 20.2: </span><span class="title-name">Using virt-p2v </span></span><a title="Permalink" class="permalink" href="#pro-guestfs-p2v-kiwi">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Install the needed packages with the command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper in virt-p2v kiwi-desc-isoboot</pre></div><div id="id-1.12.5.4.6.9.5.2.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
       These steps will document how to create an ISO image to create a
       bootable DVD.  Alternatively, you can create a PXE boot image
       instead; for more information about building PXE images with
       KIWI NG, see <code class="command">man virt-p2v-make-kiwi</code>.
      </p></div></li><li class="step"><p>
      Create a KIWI NG configuration:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-p2v-make-kiwi -o <em class="replaceable">/tmp/p2v.kiwi</em></pre></div><p>
      The <code class="option">-o</code> defines where to create the KIWI NG configuration.
     </p></li><li class="step"><p>
      Edit the <code class="filename">config.xml</code> file in the generated
      configuration if needed.  For example, in
      <code class="filename">config.xml</code> adjust the keyboard layout of the
      live system.
     </p></li><li class="step"><p>
      Build the ISO image with <code class="command">kiwi</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>kiwi --build <em class="replaceable">/tmp/p2v.kiwi</em><span class="callout" id="p2v-config">1</span> \
     -d <em class="replaceable">/tmp/build</em><span class="callout" id="p2v-target">2</span> \
     --ignore-repos \
     --add-repo <em class="replaceable">http://URL/TO/SLE/REPOSITORIES</em><span class="callout" id="p2v-repo">3</span> \
     --type iso</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#p2v-config"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        The directory where the KIWI NG configuration was generated in the
        previous step.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#p2v-target"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        The directory where KIWI NG will place the generated ISO image and other
        intermediary build results.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#p2v-repo"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        The URLs to the package repositories as found with
        <code class="command">zypper lr -d</code>.
       </p><p>
        Use one <code class="option">--add-repo</code> parameter per repository.
       </p></td></tr></table></div></li><li class="step"><p>
      Burn the ISO on a DVD or a USB stick.  With such a medium, boot
      the machine to be converted.
     </p></li><li class="step"><p>
      After the system is started, you will be asked for the connection
      details of the <span class="emphasis"><em>conversion server</em></span>. This server
      is a machine with the <code class="systemitem">virt-v2v</code> package installed.
     </p><p>
      If the network setup is more complex than a DHCP client, click the
      <span class="guimenu">Configure network</span> button to open the YaST
      network configuration dialog.
     </p><p>
      Click the <span class="guimenu">Test connection</span> button to allow
      moving to the next page of the wizard.
     </p></li><li class="step"><p>
      Select the disks and network interfaces to be converted and define
      the VM data like the amount of allocated CPUs, memory and the
      Virtual Machine name.
     </p><div id="id-1.12.5.4.6.9.5.8.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
       If not defined, the created disk image format will be <span class="emphasis"><em>raw</em></span>
       by default. This can be changed by entering the desired format in the
       <span class="guimenu">Output format</span> field.
      </p></div><p>
      There are two possibilities to generate the virtual machine:
      either using the <span class="emphasis"><em>local</em></span> or the
      <span class="emphasis"><em>libvirt</em></span> output. The first one will place the
      Virtual Machine disk image and configuration in the path defined
      in the <span class="guimenu">Output storage</span> field. These can then be
      used to define a new libvirt-handled guest using
      <code class="command">virsh</code>. The second method will create a new
      libvirt-handled guest with the disk image placed in the pool
      defined in the <span class="guimenu">Output storage</span> field.
     </p><p>
      Click <span class="guimenu">Start conversion</span> to start it.
     </p></li></ol></div></div></section></section><section class="sect1" id="sec-guestfs-trouble" data-id-title="Troubleshooting"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.4 </span><span class="title-name">Troubleshooting</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-trouble">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-guestfs-trouble-btrfs" data-id-title="Btrfs-related problems"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.4.1 </span><span class="title-name">Btrfs-related problems</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-trouble-btrfs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When using the guestfs tools on an image with Btrfs root partition (the
    default with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>) the following error message may be displayed:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-ls -a /path/to/sles12sp2.qcow2 /
virt-ls: multi-boot operating systems are not supported

If using guestfish '-i' option, remove this option and instead
use the commands 'run' followed by 'list-filesystems'.
You can then mount file systems you want by hand using the
'mount' or 'mount-ro' command.

If using guestmount '-i', remove this option and choose the
filesystem(s) you want to see by manually adding '-m' option(s).
Use 'virt-filesystems' to see what file systems are available.

If using other virt tools, multi-boot operating systems won't work
with these tools.  Use the guestfish equivalent commands
(see the virt tool manual page).</pre></div><p>
    This is usually caused by the presence of snapshots in the guests. In this
    case guestfs does not know which snapshot to bootstrap. To force the
    use of a snapshot, use the <code class="option">-m</code> parameter as follows:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-ls -m /dev/sda2:/:subvol=@/.snapshots/2/snapshot -a /path/to/sles12sp2.qcow2 /</pre></div></section><section class="sect2" id="sec-guestfs-trouble-env" data-id-title="Environment"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.4.2 </span><span class="title-name">Environment</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-trouble-env">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When troubleshooting problems within a libguestfs appliance, the
    environment variable <span class="emphasis"><em>LIBGUESTFS_DEBUG=1</em></span> can be used
    to enable debug messages. To output each command/API call in a format
    that is similar to guestfish commands, use the environment variable
    <span class="emphasis"><em>LIBGUESTFS_TRACE=1</em></span>.
   </p></section><section class="sect2" id="sec-guestfs-trouble-tools" data-id-title="libguestfs-test-tool"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.4.3 </span><span class="title-name"><code class="command">libguestfs-test-tool</code></span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-trouble-tools">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">libguestfs-test-tool</code> is a test program that checks if
    basic libguestfs functionality is working. It will print a large amount
    of diagnostic messages and details of the guestfs environment, then
    create a test image and try to start it. If it runs to completion
    successfully, the following message should be seen near the end:
   </p><div class="verbatim-wrap"><pre class="screen">===== TEST FINISHED OK =====</pre></div></section></section><section class="sect1" id="sec-guestfs-external-doc" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.5 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-guestfs-external-doc">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_guestfs.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <a class="link" href="https://libguestfs.org" target="_blank">libguestfs.org</a>
    </p></li><li class="listitem"><p>
     <a class="link" href="https://libguestfs.org/guestfs-faq.1.html" target="_blank">libguestfs
     FAQ</a>
    </p></li></ul></div></section></section><section class="chapter" id="cha-qemu-ga" data-id-title="QEMU guest agent"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">21 </span><span class="title-name">QEMU guest agent</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-ga">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_ga.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The QEMU guest agent (GA) runs inside the VM Guest and allows the VM Host Server
  to run commands in the guest operating system via <code class="systemitem">libvirt</code>. It supports
  many functions—for example, getting details about guest file systems,
  freezing and thawing file systems, or suspending or rebooting a guest.
 </p><p>
  QEMU GA is included in the <span class="package">qemu-guest-agent</span> package and
  is installed, configured, and activated by default on KVM virtual machines.
 </p><p>
  QEMU GA is installed in Xen virtual machines, but it is not activated by
  default. Although it is possible to use QEMU GA with Xen virtual machines,
  there is no integration with libvirt as described below for KVM virtual
  machines. To use QEMU GA with Xen a channel device must be added to the
  VM Guest configuration. The channel device includes a Unix domain socket path
  on the VM Host Server for communicating with QEMU GA.
 </p><div class="verbatim-wrap"><pre class="screen">&lt;channel type='unix'&gt;
  &lt;source mode='bind' path='/example/path'/&gt;
  &lt;target type='xen' name='org.qemu.guest_agent.0'/&gt;
&lt;/channel&gt;</pre></div><section class="sect1" id="cha-qemu-ga-libvirt-general" data-id-title="Running QEMU GA commands"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">21.1 </span><span class="title-name">Running QEMU GA commands</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-ga-libvirt-general">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_ga.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   QEMU GA includes many native commands that do not have direct <code class="systemitem">libvirt</code>
   counterparts. Refer to <a class="xref" href="#cha-qemu-ga-moreinfo" title="21.4. More information">Section 21.4, “More information”</a> to find the
   complete list. You can run all of the QEMU GA commands by using
   <code class="systemitem">libvirt</code>'s general purpose command <code class="command">qemu-agent-command</code>:
  </p><div class="verbatim-wrap"><pre class="screen">virsh qemu-agent-command <em class="replaceable">DOMAIN_NAME</em> '{"execute":"<em class="replaceable">QEMU_GA_COMMAND</em>"}'</pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh qemu-agent-command sle15sp2 '{"execute":"guest-info"}' --pretty
{
"return": {
  "version": "4.2.0",
  "supported_commands": [
    {
      "enabled": true,
      "name": "guest-get-osinfo",
      "success-response": true
    },
[...]</pre></div></section><section class="sect1" id="cha-qemu-ga-commands" data-id-title="virsh commands that require QEMU GA"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">21.2 </span><span class="title-name"><code class="command">virsh</code> commands that require QEMU GA</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-ga-commands">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_ga.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Several <code class="command">virsh</code> commands require QEMU GA for their functionality. Here are
   some of them:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.5.5.7.3.1"><span class="term"><code class="command">virsh guestinfo</code></span></dt><dd><p>
      Prints information about the guest from the guest's point of view.
     </p></dd><dt id="id-1.12.5.5.7.3.2"><span class="term"><code class="command">virsh guestvcpus</code></span></dt><dd><p>
      Queries or changes the state of virtual CPUs from the guest's point of view.
     </p></dd><dt id="id-1.12.5.5.7.3.3"><span class="term"><code class="command">virsh set-user-password</code></span></dt><dd><p>
      Sets the password for a user account in the guest.
     </p></dd><dt id="id-1.12.5.5.7.3.4"><span class="term"><code class="command">virsh domfsinfo</code></span></dt><dd><p>
      Shows a list of mounted file systems within the running domain.
     </p></dd><dt id="id-1.12.5.5.7.3.5"><span class="term"><code class="command">virsh dompmsuspend</code></span></dt><dd><p>
      Suspends a running guest.
     </p></dd></dl></div></section><section class="sect1" id="cha-qemu-ga-libvirt" data-id-title="Enhancing libvirt commands"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">21.3 </span><span class="title-name">Enhancing <code class="systemitem">libvirt</code> commands</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-ga-libvirt">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_ga.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If QEMU GA is enabled inside the guest, a number of <code class="command">virsh</code> subcommands
   have enhanced functionality when run in the <span class="emphasis"><em>agent</em></span> mode.
   The following list includes only some examples of them. For a complete list,
   see the <code class="command">virsh</code> manual page and search for the <code class="literal">agent</code>
   string.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.5.5.8.3.1"><span class="term"><code class="command">virsh shutdown --mode agent</code> and <code class="command">virsh reboot --mode agent</code></span></dt><dd><p>
      This method of shutting down or rebooting leaves the guest clean for its next run,
      similar to the ACPI method.
     </p></dd><dt id="id-1.12.5.5.8.3.2"><span class="term"><code class="command">virsh domfsfreeze</code> and <code class="command">virsh domfsthaw</code></span></dt><dd><p>
      Instructs the guest to make its file system quiescent—to flush all I/O
      operations in the cache and leave volumes in a consistent state, so that
      no checks will be needed when they are remounted.
     </p></dd><dt id="id-1.12.5.5.8.3.3"><span class="term"><code class="command">virsh setvcpus --guest</code></span></dt><dd><p>
      Changes the number of CPUs assigned to a guest.
     </p></dd><dt id="id-1.12.5.5.8.3.4"><span class="term"><code class="command">virsh domifaddr --source agent</code></span></dt><dd><p>
      Queries the QEMU GA for the guest's IP address.
     </p></dd><dt id="id-1.12.5.5.8.3.5"><span class="term"><code class="command">virsh vcpucount --guest</code></span></dt><dd><p>
      Prints information about the virtual CPU counts from the perspective of
      the guest.
     </p></dd></dl></div></section><section class="sect1" id="cha-qemu-ga-moreinfo" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">21.4 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-ga-moreinfo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_ga.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     A complete list of commands supported by the QEMU GA is at
     <a class="link" href="https://www.qemu.org/docs/master/interop/qemu-ga-ref.html" target="_blank">https://www.qemu.org/docs/master/interop/qemu-ga-ref.html</a>.
    </p></li><li class="listitem"><p>
     The <code class="command">virsh</code> manual page (<code class="command">man 1 virsh</code>) includes
     descriptions of the commands that support the QEMU GA interface.
    </p></li></ul></div></section></section><section class="chapter" id="tpm" data-id-title="Software TPM emulator"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">22 </span><span class="title-name">Software TPM emulator</span></span> <a title="Permalink" class="permalink" href="#tpm">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_tpm.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="tpm-introduction" data-id-title="Introduction"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.1 </span><span class="title-name">Introduction</span></span> <a title="Permalink" class="permalink" href="#tpm-introduction">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_tpm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The Trusted Platform Module (TPM) is a cryptoprocessor that secures hardware
   using cryptographic keys. For developers who use the TPM to develop security
   features, a software TPM emulator is a convenient solution. Compared to a
   hardware TPM device, the emulator has no limit on the number of guests that
   can access it. Also, it is simple to switch between TPM versions 1.2 and
   2.0. QEMU supports the software TPM emulator that is included in the
   <span class="package">swtpm</span> package.
  </p></section><section class="sect1" id="tpm-prerequisite" data-id-title="Prerequisites"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.2 </span><span class="title-name">Prerequisites</span></span> <a title="Permalink" class="permalink" href="#tpm-prerequisite">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_tpm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Before you can install and use the software TPM emulator, you need to
   install the <code class="systemitem">libvirt</code> virtualization environment. Refer to
   <a class="xref" href="#vt-installation-yast" title="6.2. Running the yast2-vm module">Section 6.2, “Running the <span class="package">yast2-vm</span> module”</a> and install one of the provided
   virtualization solutions.
  </p></section><section class="sect1" id="tpm-installation" data-id-title="Installation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.3 </span><span class="title-name">Installation</span></span> <a title="Permalink" class="permalink" href="#tpm-installation">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_tpm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To use the software TPM emulator, install the <span class="package">swtpm</span>
   package:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper install swtpm</pre></div></section><section class="sect1" id="tpm-qemu" data-id-title="Using swtpm with QEMU"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.4 </span><span class="title-name">Using <code class="command">swtpm</code> with QEMU</span></span> <a title="Permalink" class="permalink" href="#tpm-qemu">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_tpm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">swtpm</code> provides three types of interface:
   <code class="literal">socket</code>, <code class="literal">chardev</code>, and
   <code class="literal">cuse</code>. This procedure focuses on the
   <span class="emphasis"><em>socket</em></span> interface.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Create a directory <code class="filename">mytpm0</code> inside the VM
     directory to store the TPM states—for example,
     <code class="filename">/var/lib/libvirt/qemu/sle15sp3</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mkdir /var/lib/libvirt/qemu/sle15sp3/mytpm0</pre></div></li><li class="step"><p>
     Start <code class="command">swtmp</code>. It will create a socket file that QEMU can use—for example,
     <code class="filename">/var/lib/libvirt/qemu/sle15sp3</code>:
    </p><div class="verbatim-wrap"><pre class="screen"> <code class="prompt user">&gt; </code><code class="command">sudo</code> swtpm socket
  --tpmstate dir=/var/lib/libvirt/qemu/sle15sp3/mytpm0 \
  --ctrl type=unixio,path=/var/lib/libvirt/qemu/sle15sp3/mytpm0/swtpm-sock \
  --log level=20</pre></div><div id="id-1.12.5.6.6.3.2.3" data-id-title="TPM version 2.0" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: TPM version 2.0</div><p>
      By default, <code class="command">swtpm</code> starts a TPM version 1.2 emulator
      and stores its states in the <code class="filename">tpm-00.permall</code>
      directory. To create a TPM 2.0 instance, run:
     </p><div class="verbatim-wrap"><pre class="screen"> <code class="prompt user">&gt; </code><code class="command">sudo</code> swtpm socket
  --tpm2
  --tpmstate dir=/var/lib/libvirt/qemu/sle15sp3/mytpm0 \
  --ctrl type=unixio,path=/var/lib/libvirt/qemu/sle15sp3/mytpm0/swtpm-sock \
  --log level=20</pre></div><p>
      TPM 2.0 states will be stored in the <code class="filename">tpm2-00.permall</code>
      directory.
     </p></div></li><li class="step"><p>
     Add the following command line parameters to the <code class="command">qemu-system-<em class="replaceable">ARCH</em></code> command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-system-x86_64 \
[...]
-chardev socket,id=chrtpm,path=/var/lib/libvirt/qemu/sle15sp3/mytpm0/swtpm-sock \
-tpmdev emulator,id=tpm0,chardev=chrtpm \
-device tpm-tis,tpmdev=tpm0</pre></div></li><li class="step"><p>
     Verify that the TPM device is available in the guest by running the
     following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>tpm_version
TPM 1.2 Version Info:
Chip Version:        1.2.18.158
Spec Level:          2
Errata Revision:     3
TPM Vendor ID:       IBM
TPM Version:         01010000
Manufacturer Info:   49424d00</pre></div></li></ol></div></div></section><section class="sect1" id="tpm-libvirt" data-id-title="Using swtpm with libvirt"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.5 </span><span class="title-name">Using swtpm with <code class="systemitem">libvirt</code></span></span> <a title="Permalink" class="permalink" href="#tpm-libvirt">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_tpm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To use swtpm with <code class="systemitem">libvirt</code>, add the following TPM device to the guest XML
   specification:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;devices&gt;
 &lt;tpm model='tpm-tis'&gt;
  &lt;backend type='emulator' version='2.0'/&gt;
 &lt;/tpm&gt;
&lt;/devices&gt;</pre></div><p>
   <code class="systemitem">libvirt</code> will start swtpm for the guest automatically; you do not need to
   start it manually in advance. The corresponding <code class="filename">permall</code>
   file will be created in
   <code class="filename">/var/lib/libvirt/swtpm/<em class="replaceable">VM_UUID</em></code>.
  </p></section><section class="sect1" id="tpm-ovmf" data-id-title="TPM measurement with OVMF firmware"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.6 </span><span class="title-name">TPM measurement with OVMF firmware</span></span> <a title="Permalink" class="permalink" href="#tpm-ovmf">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_tpm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the guest uses the Open Virtual Machine Firmware (OVMF), it will measure
   components with TPM. You can find the event log in
   <code class="filename">/sys/kernel/security/tpm0/binary_bios_measurements</code>.
  </p></section><section class="sect1" id="qemu-tpm-resources" data-id-title="Resources"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.7 </span><span class="title-name">Resources</span></span> <a title="Permalink" class="permalink" href="#qemu-tpm-resources">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_qemu_tpm.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Wikipedia offers a thorough description of the TPM at the page
     <a class="link" href="https://en.wikipedia.org/wiki/Trusted_Platform_Module" target="_blank">https://en.wikipedia.org/wiki/Trusted_Platform_Module</a>.
    </p></li><li class="listitem"><p>
     Configuring a specific virtualization environment on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is
     described in <a class="xref" href="#cha-vt-installation" title="Chapter 6. Installation of virtualization components">Chapter 6, <em>Installation of virtualization components</em></a>.
    </p></li><li class="listitem"><p>
     Details on the use of <span class="package">swtpm</span> are on its manual page
     (<code class="command">man 8 swtpm</code>).
    </p></li><li class="listitem"><p>
     A detailed <code class="systemitem">libvirt</code> specification of TPM is at
     <a class="link" href="https://libvirt.org/formatdomain.html#elementsTpm" target="_blank">https://libvirt.org/formatdomain.html#elementsTpm</a>
    </p></li><li class="listitem"><p>
     A description of enabling UEFI firmware by using OVMF is at
     <a class="xref" href="#sec-vt-installation-ovmf" title="6.4. Installing UEFI support">Section 6.4, “Installing UEFI support”</a>.
    </p></li></ul></div></section></section></div><div class="part" id="part-virt-xen" data-id-title="Managing virtual machines with Xen"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part IV </span><span class="title-name">Managing virtual machines with Xen </span></span><a title="Permalink" class="permalink" href="#part-virt-xen">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/book_virtualization.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-xen-vhost"><span class="title-number">23 </span><span class="title-name">Setting up a virtual machine host</span></a></span></li><dd class="toc-abstract"><p>
  This section documents how to set up and use <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15 SP3</span></span> as
  a virtual machine host.
 </p></dd><li><span class="chapter"><a href="#cha-xen-network"><span class="title-number">24 </span><span class="title-name">Virtual networking</span></a></span></li><dd class="toc-abstract"><p>A VM Guest system needs some means to communicate either with other VM Guest systems or with a local network. The network interface to the VM Guest system is made of a split device driver, which means that any virtual Ethernet device has a corresponding network interface in Dom0. This interface is s…</p></dd><li><span class="chapter"><a href="#cha-xen-manage"><span class="title-number">25 </span><span class="title-name">Managing a virtualization environment</span></a></span></li><dd class="toc-abstract"><p>
  Apart from using the recommended <code class="systemitem">libvirt</code> library
  (<a class="xref" href="#part-virt-libvirt" title="Part II. Managing virtual machines with libvirt">Part II, “Managing virtual machines with <code class="systemitem">libvirt</code>”</a>), you can manage Xen guest
  domains with the <code class="command">xl</code> tool from the command line.
 </p></dd><li><span class="chapter"><a href="#cha-xen-vbd"><span class="title-number">26 </span><span class="title-name">Block devices in Xen</span></a></span></li><dd class="toc-abstract"><p/></dd><li><span class="chapter"><a href="#cha-xen-config"><span class="title-number">27 </span><span class="title-name">Virtualization: configuration options and settings</span></a></span></li><dd class="toc-abstract"><p>
  The documentation in this section, describes advanced management tasks and
  configuration options that might help technology innovators implement
  leading-edge virtualization solutions. It is provided as a courtesy and
  does not imply that all documented options and tasks are supported by
  Novell, Inc.
 </p></dd><li><span class="chapter"><a href="#cha-xen-admin"><span class="title-number">28 </span><span class="title-name">Administrative tasks</span></a></span></li><dd class="toc-abstract"><p/></dd><li><span class="chapter"><a href="#cha-xen-xenstore"><span class="title-number">29 </span><span class="title-name">XenStore: configuration database shared between domains</span></a></span></li><dd class="toc-abstract"><p>
  This section introduces basic information about XenStore, its role in
  the Xen environment, the directory structure of files used by
  XenStore, and the description of XenStore's commands.
 </p></dd><li><span class="chapter"><a href="#cha-xen-ha"><span class="title-number">30 </span><span class="title-name">Xen as a high-availability virtualization host</span></a></span></li><dd class="toc-abstract"><p>
  Setting up two Xen hosts as a failover system has several advantages
  compared to a setup where every server runs on dedicated hardware.
 </p></dd><li><span class="chapter"><a href="#pv-to-fv"><span class="title-number">31 </span><span class="title-name">Xen: converting a paravirtual (PV) guest into a fully virtual (FV/HVM) guest</span></a></span></li><dd class="toc-abstract"><p>
  This chapter explains how to convert a Xen paravirtual machine into a Xen
  fully virtualized machine.
 </p></dd></ul></div><section class="chapter" id="cha-xen-vhost" data-id-title="Setting up a virtual machine host"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">23 </span><span class="title-name">Setting up a virtual machine host</span></span> <a title="Permalink" class="permalink" href="#cha-xen-vhost">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This section documents how to set up and use <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15 SP3</span></span> as
  a virtual machine host.
 </p><p>
  Usually, the hardware requirements for the Dom0 are the same as those for
  the <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> operating system. Additional CPU, disk, memory, and network
  resources should be added to accommodate the resource demands of all planned
  VM Guest systems.
 </p><div id="id-1.12.6.2.5" data-id-title="Resources" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Resources</div><p>
   Remember that VM Guest systems, like physical machines, perform better when
   they run on faster processors and have access to more system memory.
  </p></div><p>
  The virtual machine host requires several software packages and their
  dependencies to be installed. To install all necessary packages, run YaST
  <span class="guimenu">Software Management</span>, select
  <span class="guimenu">View</span> › <span class="guimenu">Patterns</span>
  and choose <span class="guimenu">Xen Virtual Machine Host Server</span> for
  installation. The installation can also be performed with YaST using the
  module <span class="guimenu">Virtualization</span> › <span class="guimenu">Install
  Hypervisor and Tools</span>.
 </p><p>
  After the Xen software is installed, restart the computer and, on the boot
  screen, choose the newly added option with the Xen kernel.
 </p><p>
  Updates are available through your update channel. To be sure to have the
  latest updates installed, run YaST <span class="guimenu">Online Update</span> after
  the installation has finished.
 </p><section class="sect1" id="sec-xen-vhost-best" data-id-title="Best practices and suggestions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.1 </span><span class="title-name">Best practices and suggestions</span></span> <a title="Permalink" class="permalink" href="#sec-xen-vhost-best">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When installing and configuring the <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> operating system on the
   host, be aware of the following best practices and suggestions:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     If the host should always run as Xen host, run YaST <span class="guimenu">System</span> › <span class="guimenu">Boot Loader</span> and
     activate the Xen boot entry as default boot section.
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       In YaST, click <span class="guimenu">System &gt; Boot Loader</span>.
      </p></li><li class="listitem"><p>
       Change the default boot to the <span class="guimenu">Xen</span> label, then
       click <span class="guimenu">Set as Default</span>.
      </p></li><li class="listitem"><p>
       Click <span class="guimenu">Finish</span>.
      </p></li></ul></div></li><li class="listitem"><p>
     For best performance, only the applications and processes required for
     virtualization should be installed on the virtual machine host.
    </p></li><li class="listitem"><p>
     If you intend to use a watchdog device attached to the Xen host, use
     only one at a time. It is recommended to use a driver with actual hardware
     integration over a generic software one.
    </p></li></ul></div><div id="id-1.12.6.2.9.4" data-id-title="Hardware monitoring" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Hardware monitoring</div><p>
        The Dom0 kernel is running virtualized, so tools like
        <code class="command">irqbalance</code> or <code class="command">lscpu</code> do not
        reflect the real hardware characteristics.
      </p></div><div id="id-1.12.6.2.9.5" data-id-title="Trusted boot not supported by Xen" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Trusted boot not supported by Xen</div><p>
        Trusted boot (Tboot) is not supported by Xen. To ensure that the Xen
        host boots correctly, verify that the <span class="guimenu">Enable Trusted Boot
        Support</span> option is deactivated in the GRUB 2 configuration
        dialog.
      </p></div></section><section class="sect1" id="sec-xen-vhost-memory" data-id-title="Managing Dom0 memory"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.2 </span><span class="title-name">Managing Dom0 memory</span></span> <a title="Permalink" class="permalink" href="#sec-xen-vhost-memory">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In previous versions of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, the default memory allocation scheme of a
   Xen host was to allocate all host physical memory to Dom0 and enable
   auto-ballooning. Memory was automatically ballooned from Dom0 when
   additional domains were started. This behavior has always been error prone
   and disabling it was strongly encouraged. Starting with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>
   <span class="phrase">15 SP1</span>,
   auto-ballooning has been disabled by default and Dom0 is given 10% of host
   physical memory + 1 GB. For example, on a host with 32 GB of physical memory,
   4.2 GB of memory is allocated for Dom0.
  </p><p>
   The use of the <code class="option">dom0_mem</code> Xen command line option in
   <code class="filename">/etc/default/grub</code> is still supported and encouraged.
   You can restore the old behavior by setting <code class="option">dom0_mem</code> to the
   host physical memory size and enabling the <code class="option">autoballoon</code>
   setting in <code class="filename">/etc/xen/xl.conf</code>.
  </p><div id="id-1.12.6.2.10.4" data-id-title="Insufficient memory for Dom0" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Insufficient memory for Dom0</div><p>
        The amount of memory reserved for Dom0 is a function of the number of
        VM Guests running on the host since Dom0 provides back-end network
        and disk I/O services for each VM Guest. Other workloads running in
        Dom0 should also be considered when calculating Dom0 memory
        allocation. Memory sizing of Dom0 should be determined like any other
        virtual machine.
      </p></div><section class="sect2" id="sec-xen-vhost-maxmem" data-id-title="Setting Dom0 memory allocation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.2.1 </span><span class="title-name">Setting Dom0 memory allocation</span></span> <a title="Permalink" class="permalink" href="#sec-xen-vhost-maxmem">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Determine memory allocation required for Dom0.
     </p></li><li class="step"><p>
      At Dom0, type <code class="command">xl info</code> to view the amount of memory
      that is available on the machine. Dom0's current memory allocation can
      be determined with the <code class="command">xl list</code> command.
     </p></li><li class="step"><p>
      Edit <code class="filename">/etc/default/grub</code> and adjust the
      <code class="option">GRUB_CMDLINE_XEN</code> option so that it includes
      <code class="literal">dom0_mem=<em class="replaceable">MEM_AMOUNT</em></code>.
      Replace <em class="replaceable">MEM_AMOUNT</em> with the maximum amount of
      memory to allocate to Dom0. Add <code class="command">K</code>,
      <code class="command">M</code>, or <code class="command">G</code>, to specify the size unit.
      For example:
     </p><div class="verbatim-wrap"><pre class="screen">GRUB_CMDLINE_XEN="dom0_mem=2G"</pre></div></li><li class="step"><p>
      Restart the computer to apply the changes.
     </p></li></ol></div></div><div id="id-1.12.6.2.10.5.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     Refer to <span class="intraxref">Book “Administration Guide”, Chapter 14 “The boot loader GRUB 2”, Section 14.2.2 “The file <code class="filename">/etc/default/grub</code>”</span> for more details
     about Xen-related boot configuration options.
    </p></div><div id="id-1.12.6.2.10.5.4" data-id-title="Xen Dom0 memory" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Xen Dom0 memory</div><p>
     When using the XL tool stack and the <code class="command">dom0_mem=</code> option
     for the Xen hypervisor in GRUB 2 you need to disable xl
     <span class="emphasis"><em>autoballoon</em></span> in <code class="filename">etc/xen/xl.conf</code>.
     Otherwise launching VMs will fail with errors about not being able to
     balloon down Dom0. So add <span class="emphasis"><em>autoballoon=0</em></span> to
     <code class="filename">xl.conf</code> if you have the <code class="command">dom0_mem=</code>
     option specified for Xen. Also see
     <a class="link" href="http://wiki.xen.org/wiki/Xen_Best_Practices#Xen_dom0_dedicated_memory_and_preventing_dom0_memory_ballooning" target="_blank">Xen
     dom0 memory</a>
    </p></div></section></section><section class="sect1" id="sec-xen-vhost-netcard" data-id-title="Network card in fully virtualized guests"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.3 </span><span class="title-name">Network card in fully virtualized guests</span></span> <a title="Permalink" class="permalink" href="#sec-xen-vhost-netcard">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In a fully virtualized guest, the default network card is an emulated
   Realtek network card. However, it also possible to use the split network
   driver to run the communication between Dom0 and a VM Guest. By default,
   both interfaces are presented to the VM Guest, because the drivers of some
   operating systems require both to be present.
  </p><p>
   When using <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, only the paravirtualized network cards are
   available for the VM Guest by default. The following network options are
   available:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.2.11.4.1"><span class="term">emulated</span></dt><dd><p>
      To use an emulated network interface like an emulated Realtek card,
      specify <code class="literal">type=ioemu</code> in the <code class="literal">vif</code>
      device section of the domain xl configuration. An example configuration
      would look like:
     </p><div class="verbatim-wrap"><pre class="screen">vif = [ 'type=ioemu,mac=00:16:3e:5f:48:e4,bridge=br0' ]</pre></div><p>
            Find more details about the xl configuration in the
            <code class="filename">xl.conf</code> man page <code class="command">man 5
            xl.conf</code>.
          </p></dd><dt id="id-1.12.6.2.11.4.2"><span class="term">paravirtualized</span></dt><dd><p>
            When you specify <code class="literal">type=vif</code> and do not specify a
            model or type, the paravirtualized network interface is used:
          </p><div class="verbatim-wrap"><pre class="screen">vif = [ 'type=vif,mac=00:16:3e:5f:48:e4,bridge=br0,backen=0' ]</pre></div></dd><dt id="id-1.12.6.2.11.4.3"><span class="term">emulated and paravirtualized</span></dt><dd><p>
      If the administrator should be offered both options, simply specify both
      type and model. The xl configuration would look like:
     </p><div class="verbatim-wrap"><pre class="screen">vif = [ 'type=ioemu,mac=00:16:3e:5f:48:e4,model=rtl8139,bridge=br0' ]</pre></div><p>
      In this case, one of the network interfaces should be disabled on the
      VM Guest.
     </p></dd></dl></div></section><section class="sect1" id="sec-xen-vhost-start" data-id-title="Starting the virtual machine host"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.4 </span><span class="title-name">Starting the virtual machine host</span></span> <a title="Permalink" class="permalink" href="#sec-xen-vhost-start">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If virtualization software is correctly installed, the computer boots to
   display the GRUB 2 boot loader with a <span class="guimenu">Xen</span> option on the
   menu. Select this option to start the virtual machine host.
  </p><div id="id-1.12.6.2.12.3" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning</div><p>
      When booting a Xen system, you might observe error messages in the /var/log/messages log file or <code class="systemitem">systemd</code> journal of dom0 similar to following:
    </p><div class="verbatim-wrap"><pre class="screen">isst_if_mbox_pci: probe of 0000:ff:1e.1 failed with error -5
isst_if_pci: probe of 0000:fe:00.1 failed with error -5</pre></div><p>
      Ignore them as they are harmless and are caused by the fact that the ISST
      driver does not provide any power or frequency scaling feature for virtual
      machines.
    </p></div><div id="id-1.12.6.2.12.4" data-id-title="Xen and Kdump" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Xen and Kdump</div><p>
        In Xen, the hypervisor manages the memory resource. If you need to
        reserve system memory for a recovery kernel in Dom0, this memory needs
        to be reserved by the hypervisor. Thus, it is necessary to add
         <code class="option">crashkernel=size</code> to the
        <code class="varname">GRUB_CMDLINE_XEN_DEFAULT</code> variable in the
        <code class="filename">/etc/dfault/grub</code> file, save it and run the
        following command:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> grub2-mkconfig -o /boot/grub2/grub.cfg</pre></div><p>
        For more information on the crashkernel parameter, see
        <span class="intraxref">Book “System Analysis and Tuning Guide”, Chapter 20 “Kexec and Kdump”, Section 20.4 “Calculating <code class="option">crashkernel</code> allocation size”</span>.
      </p></div><p>
   If the <span class="guimenu">Xen</span> option is not on the GRUB 2 menu, review the
   steps for installation and verify that the GRUB 2 boot loader has been
   updated. If the installation has been done without selecting the Xen
   pattern, run the YaST <span class="guimenu">Software Management</span>, select the
   filter <span class="guimenu">Patterns</span> and choose <span class="guimenu">Xen Virtual Machine
   Host Server</span> for installation.
  </p><p>
   After booting the hypervisor, the Dom0 virtual machine starts and displays
   its graphical desktop environment. If you did not install a graphical
   desktop, the command line environment appears.
  </p><div id="id-1.12.6.2.12.7" data-id-title="Graphics problems" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Graphics problems</div><p>
        Sometimes it may happen that the graphics system does not work
        properly. In this case, add <code class="literal">vga=ask</code> to the boot
        parameters. To activate permanent settings, use
        <code class="literal">vga=mode-0x???</code> where <code class="literal">???</code> is
        calculated as <code class="literal">0x100</code> + VESA mode from
        <a class="link" href="https://en.wikipedia.org/wiki/VESA_BIOS_Extensions" target="_blank">https://en.wikipedia.org/wiki/VESA_BIOS_Extensions</a>,
        for example, <code class="literal">vga=mode-0x361</code>.
      </p></div><p>
   Before starting to install virtual guests, make sure that the system time is
   correct. To do this, configure NTP (Network Time Protocol) on the
   controlling domain:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     In YaST select <span class="guimenu">Network Services</span> › <span class="guimenu">NTP Configuration</span>.
    </p></li><li class="step"><p>
     Select the option to automatically start the NTP daemon during boot.
     Provide the IP address of an existing NTP time server, then click
     <span class="guimenu">Finish</span>.
    </p></li></ol></div></div><div id="id-1.12.6.2.12.10" data-id-title="Time services on virtual guests" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Time services on virtual guests</div><p>
    Hardware clocks commonly are not very precise. All modern operating systems
    try to correct the system time compared to the hardware time by means of an
    additional time source. To get the correct time on all VM Guest systems,
    also activate the network time services on each respective guest or make
    sure that the guest uses the system time of the host. For more about
    <code class="literal">Independent Wallclocks</code> in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> see
    <a class="xref" href="#sec-xen-guests-suse-time" title="19.2. Xen virtual machine clock settings">Section 19.2, “Xen virtual machine clock settings”</a>.
   </p></div><p>
   For more information about managing virtual machines, see
   <a class="xref" href="#cha-xen-manage" title="Chapter 25. Managing a virtualization environment">Chapter 25, <em>Managing a virtualization environment</em></a>.
  </p></section><section class="sect1" id="sec-xen-vhost-pciback" data-id-title="PCI Pass-Through"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.5 </span><span class="title-name">PCI Pass-Through</span></span> <a title="Permalink" class="permalink" href="#sec-xen-vhost-pciback">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To take full advantage of VM Guest systems, it is sometimes necessary to
   assign specific PCI devices to a dedicated domain. When using fully
   virtualized guests, this functionality is only available if the chipset of
   the system supports this feature, and if it is activated from the BIOS.
  </p><p>
   This feature is available from both AMD* and Intel*. For AMD machines, the
   feature is called <a class="xref" href="#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a>; in Intel speak,
   this is <a class="xref" href="#gloss-vt-acronym-vtd" title="VT-d">VT-d</a>. Note that Intel-VT
   technology is not sufficient to use this feature for fully virtualized
   guests. To make sure that your computer supports this feature, ask your
   supplier specifically to deliver a system that supports PCI Pass-Through.
  </p><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Limitations </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.2.13.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
          Certain graphics drivers use highly optimized ways to access DMA. This
          is not supported, and thus using graphics cards may be difficult.
        </p></li><li class="listitem"><p>
          When accessing PCI devices behind a
          <a class="xref" href="#gloss-vt-acronym-pcie" title="PCIe">PCIe</a> bridge, all the PCI devices
          must be assigned to a single guest. This limitation does not apply to
          <a class="xref" href="#gloss-vt-acronym-pcie" title="PCIe">PCIe</a> devices.
        </p></li><li class="listitem"><p>
          Guests with dedicated PCI devices cannot be migrated live to a
          different host.
        </p></li></ul></div><p>
   The configuration of PCI Pass-Through is twofold. First, the hypervisor must be
   informed at boot time that a PCI device should be available for reassigning.
   Second, the PCI device must be assigned to the VM Guest.
  </p><section class="sect2" id="config-hypervisor-pciback" data-id-title="Configuring the hypervisor for PCI Pass-Through"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.5.1 </span><span class="title-name">Configuring the hypervisor for PCI Pass-Through</span></span> <a title="Permalink" class="permalink" href="#config-hypervisor-pciback">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Select a device to reassign to a VM Guest. To do this, run
      <code class="command">lspci -k</code>, and read the device number and the name of
      the original module that is assigned to the device:
     </p><div class="verbatim-wrap"><pre class="screen">06:01.0 Ethernet controller: Intel Corporation Ethernet Connection I217-LM (rev 05)
        Subsystem: Dell Device 0617
        Kernel driver in use: e1000e
        Kernel modules: e1000e</pre></div><p>
      In this case, the PCI number is <code class="literal">(06:01.0)</code> and the
      dependent kernel module is <code class="literal">e1000e</code>.
     </p></li><li class="step"><p>
      Specify a module dependency to ensure that
      <code class="systemitem">xen_pciback</code> is the first module to control the
      device. Add the file named
      <code class="filename">/etc/modprobe.d/50-e1000e.conf</code> with the following
      content:
     </p><div class="verbatim-wrap"><pre class="screen">install e1000e /sbin/modprobe xen_pciback ; /sbin/modprobe \
 --first-time --ignore-install e1000e</pre></div></li><li class="step"><p>
      Instruct the <code class="systemitem">xen_pciback</code> module to control the
      device using the 'hide' option. Edit or create
      <code class="filename">/etc/modprobe.d/50-xen-pciback.conf</code> with the
      following content:
     </p><div class="verbatim-wrap"><pre class="screen">options xen_pciback hide=(06:01.0)</pre></div></li><li class="step"><p>
      Reboot the system.
     </p></li><li class="step"><p>
      Check if the device is in the list of assignable devices with the command
     </p><div class="verbatim-wrap"><pre class="screen">xl pci-assignable-list</pre></div></li></ol></div></div><section class="sect3" id="config-hypervisor-pciback-xl" data-id-title="Dynamic assignment with xl"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.5.1.1 </span><span class="title-name">Dynamic assignment with xl</span></span> <a title="Permalink" class="permalink" href="#config-hypervisor-pciback-xl">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To avoid restarting the host system, you can use dynamic assignment with
     xl to use PCI Pass-Through.
    </p><p>
     Begin by making sure that dom0 has the pciback module loaded:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> modprobe pciback</pre></div><p>
     Then make a device assignable by using <code class="command">xl
     pci-assignable-add</code>. For example, to make the device
     <span class="emphasis"><em>06:01.0</em></span> available for guests, run the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl pci-assignable-add 06:01.0</pre></div></section></section><section class="sect2" id="config-hypervisor-pciback-guests" data-id-title="Assigning PCI devices to VM Guest systems"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.5.2 </span><span class="title-name">Assigning PCI devices to VM Guest systems</span></span> <a title="Permalink" class="permalink" href="#config-hypervisor-pciback-guests">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There are several possibilities to dedicate a PCI device to a VM Guest:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.2.13.7.3.1"><span class="term">Adding the device while installing:</span></dt><dd><p>
       During installation, add the <code class="literal">pci</code> line to the
       configuration file:
      </p><div class="verbatim-wrap"><pre class="screen">pci=['06:01.0']</pre></div></dd><dt id="id-1.12.6.2.13.7.3.2"><span class="term">Hotplugging PCI devices to VM Guest systems</span></dt><dd><p>
       The command <code class="literal">xl</code> can be used to add or remove PCI
       devices on the fly. To add the device with number
       <code class="literal">06:01.0</code> to a guest with name
       <code class="literal">sles12</code> use:
      </p><div class="verbatim-wrap"><pre class="screen">xl pci-attach sles12 06:01.0</pre></div></dd><dt id="id-1.12.6.2.13.7.3.3"><span class="term">Adding the PCI device to Xend</span></dt><dd><p>
       To add the device to the guest permanently, add the following snippet to
       the guest configuration file:
      </p><div class="verbatim-wrap"><pre class="screen">pci = [ '06:01.0,power_mgmt=1,permissive=1' ]</pre></div></dd></dl></div><p>
    After assigning the PCI device to the VM Guest, the guest system must care
    for the configuration and device drivers for this device.
   </p></section><section class="sect2" id="config-hypervisor-vgaback" data-id-title="VGA Pass-Through"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.5.3 </span><span class="title-name">VGA Pass-Through</span></span> <a title="Permalink" class="permalink" href="#config-hypervisor-vgaback">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        Xen 4.0 and newer supports VGA graphics adapter pass-through on fully
        virtualized VM Guests. The guest can take full control of the graphics
        adapter with high-performance full 3D and video acceleration.
      </p><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Limitations </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.2.13.8.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
            VGA Pass-Through functionality is similar to PCI Pass-Through and as such also
            requires <a class="xref" href="#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a> (or Intel VT-d)
            support from the mainboard chipset and BIOS.
          </p></li><li class="listitem"><p>
            Only the primary graphics adapter (the one that is used when you
            power on the computer) can be used with VGA Pass-Through.
          </p></li><li class="listitem"><p>
            VGA Pass-Through is supported only for fully virtualized guests.
            Paravirtual guests (PV) are not supported.
          </p></li><li class="listitem"><p>
            The graphics card cannot be shared between multiple VM Guests
            using VGA Pass-Through—you can dedicate it to one guest only.
          </p></li></ul></div><p>
        To enable VGA Pass-Through, add the following settings to your fully
        virtualized guest configuration file:
      </p><div class="verbatim-wrap"><pre class="screen">gfx_passthru=1
pci=['yy:zz.n']</pre></div><p>
    where <code class="literal">yy:zz.n</code> is the PCI controller ID of the VGA
    graphics adapter as found with <code class="command">lspci -v</code> on Dom0.
   </p></section><section class="sect2" id="sec-xen-vm-known" data-id-title="Troubleshooting"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.5.4 </span><span class="title-name">Troubleshooting</span></span> <a title="Permalink" class="permalink" href="#sec-xen-vm-known">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    In some circumstances, problems may occur during the installation of the
    VM Guest. This section describes some known problems and their solutions.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.2.13.9.3.1"><span class="term">During boot, the system hangs</span></dt><dd><p>
       The software I/O translation buffer allocates a large chunk of low
       memory early in the bootstrap process. If the requests for memory exceed
       the size of the buffer it usually results in a hung boot process. To
       check if this is the case, switch to console 10 and check the output
       there for a message similar to
      </p><div class="verbatim-wrap"><pre class="screen">kernel: PCI-DMA: Out of SW-IOMMU space for 32768 bytes at device 000:01:02.0</pre></div><p>
              In this case, you need to increase the size of the
              <code class="literal">swiotlb</code>. Add
              <code class="literal">swiotlb=<em class="replaceable">VALUE</em></code>
              (where <em class="replaceable">VALUE</em> is specified as the
              number of slab entries) on the command line of Dom0. The number
              can be adjusted up or down to find the optimal size for the
              machine.
            </p></dd></dl></div><div id="id-1.12.6.2.13.9.4" data-id-title="swiotlb a PV guest" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: swiotlb a PV guest</div><p>
          The <code class="literal">swiotlb=force</code> kernel parameter is required for
          DMA access to work for PCI devices on a PV guest. For more
          information about IOMMU and the <code class="literal">swiotlb</code> option see
          the file <code class="filename">boot-options.txt</code> from the package
          <code class="systemitem">kernel-source</code>.
        </p></div></section><section class="sect2" id="sec-xen-vm-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.5.5 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-xen-vm-info">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There are several resources on the Internet that provide interesting
    information about PCI Pass-Through:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <a class="link" href="https://wiki.xenproject.org/wiki/VTd_HowTo" target="_blank">https://wiki.xenproject.org/wiki/VTd_HowTo</a>
     </p></li><li class="listitem"><p>
      <a class="link" href="http://software.intel.com/en-us/articles/intel-virtualization-technology-for-directed-io-vt-d-enhancing-intel-platforms-for-efficient-virtualization-of-io-devices/" target="_blank">http://software.intel.com/en-us/articles/intel-virtualization-technology-for-directed-io-vt-d-enhancing-intel-platforms-for-efficient-virtualization-of-io-devices/</a>
     </p></li><li class="listitem"><p>
      <a class="link" href="http://support.amd.com/TechDocs/48882_IOMMU.pdf" target="_blank">http://support.amd.com/TechDocs/48882_IOMMU.pdf</a>
     </p></li></ul></div></section></section><section class="sect1" id="sec-xen-vhost-usbpass" data-id-title="USB pass-through"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.6 </span><span class="title-name">USB pass-through</span></span> <a title="Permalink" class="permalink" href="#sec-xen-vhost-usbpass">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are two methods for passing through individual host USB devices to a
   guest. The first is via an emulated USB device controller, the second is
   using PVUSB.
  </p><section class="sect2" id="xen-usb-identify" data-id-title="Identify the USB device"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.6.1 </span><span class="title-name">Identify the USB device</span></span> <a title="Permalink" class="permalink" href="#xen-usb-identify">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Before you can pass through a USB device to the VM Guest, you need to
    identify it on the VM Host Server. Use the <code class="command">lsusb</code> command to
    list the USB devices on the host system:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>lsusb
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 003: ID 0461:4d15 Primax Electronics, Ltd Dell Optical Mouse
Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub</pre></div><p>
    To pass through the Dell mouse, for example, specify either the device tag
    in the form <code class="literal">vendor_id:device_id</code> (0461:4d15) or the bus
    address in the form <code class="literal">bus.device</code> (2.3). Remember to remove
    leading zeros, otherwise <code class="command">xl</code> would interpret the numbers
    as octal values.
   </p></section><section class="sect2" id="xen-usb-emulated" data-id-title="Emulated USB device"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.6.2 </span><span class="title-name">Emulated USB device</span></span> <a title="Permalink" class="permalink" href="#xen-usb-emulated">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    In emulated USB, the device model (QEMU) presents an emulated USB
    controller to the guest. The USB device is then controlled from Dom0
    while USB commands are translated between the VM Guest and the host USB
    device. This method is only available to fully virtualized domains (HVM).
   </p><p>
    Enable the emulated USB hub with the <code class="option">usb=1</code> option. Then
    specify devices among the list of devices in the configuration file along with
    other emulated devices by using <code class="literal">host:USBID</code>. For example:
   </p><div class="verbatim-wrap"><pre class="screen">usb=1
usbdevice=['tablet','host:2.3','host:0424:460']</pre></div></section><section class="sect2" id="xen-usb-pv" data-id-title="Paravirtualized PVUSB"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.6.3 </span><span class="title-name">Paravirtualized PVUSB</span></span> <a title="Permalink" class="permalink" href="#xen-usb-pv">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    PVUSB is a new high performance method for USB Pass-Through from dom0 to
    the virtualized guests. With PVUSB, there are two ways to add USB devices
    to a guest:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      via the configuration file at domain creation time
     </p></li><li class="listitem"><p>
      via hotplug while the VM is running
     </p></li></ul></div><p>
    PVUSB uses paravirtualized front- and back-end interfaces. PVUSB supports
    USB 1.1 and USB 2.0, and it works for both PV and HVM guests. To use PVUSB,
    you need usbfront in your guest OS, and usbback in dom0 or usb back-end in
    qemu. On <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, the USB back-end comes with qemu.

   </p><p>
    As of Xen 4.7, <code class="command">xl</code> PVUSB support and hotplug support is
    introduced.
   </p><p>
    In the configuration file, specify USB controllers and USB host devices
    with <code class="literal">usbctrl</code> and <code class="literal">usbdev</code>. For example,
    in case of HVM guests:
   </p><div class="verbatim-wrap"><pre class="screen">usbctrl=['type=qusb,version=2,ports=4', 'type=qusb,version=1,ports=4', ]
usbdev=['hostbus=2, hostaddr=1, controller=0,port=1', ]</pre></div><div id="id-1.12.6.2.14.5.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     It is important to specify <code class="literal">type=qusb</code> for the controller
     of HVM guests.
    </p></div><p>
    To manage hotpluggin PVUSB devices, use the
    <code class="literal">usbctrl-attach</code>, <code class="literal">usbctrl-detach</code>,
    <code class="literal">usb-list</code>, <code class="literal">usbdev-attach</code> and
    <code class="literal">usb-detach</code> subcommands. For example:
   </p><p>
    Create a USB controller which is version USB 1.1 and has 8 ports:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>xl usbctrl-attach test_vm version=1 ports=8 type=qusb</pre></div><p>
    Find the first available controller:port in the domain, and attach USB
    device whose busnum:devnum is 2:3 to it; you can also specify
    <code class="literal">controller</code> and <code class="literal">port</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>xl usbdev-attach test_vm hostbus=2 hostaddr=3</pre></div><p>
    Show all USB controllers and USB devices in the domain:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>xl usb-list test_vm
Devid  Type   BE  state usb-ver ports
0      qusb   0   1     1       8
  Port 1: Bus 002 Device 003
  Port 2:
  Port 3:
  Port 4:
  Port 5:
  Port 6:
  Port 7:
  Port 8:</pre></div><p>
    Detach the USB device under controller 0 port 1:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>xl usbdev-detach test_vm 0 1</pre></div><p>
    Remove the USB controller with the indicated <code class="literal">dev_id</code>, and
    all USB devices under it:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>xl usbctrl-detach test_vm dev_id</pre></div><p>
    For more information, see
    <a class="link" href="https://wiki.xenproject.org/wiki/Xen_USB_Passthrough" target="_blank">https://wiki.xenproject.org/wiki/Xen_USB_Passthrough</a>.
   </p></section></section></section><section class="chapter" id="cha-xen-network" data-id-title="Virtual networking"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">24 </span><span class="title-name">Virtual networking</span></span> <a title="Permalink" class="permalink" href="#cha-xen-network">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_host_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  A VM Guest system needs some means to communicate either with other
  VM Guest systems or with a local network. The network interface to the
  VM Guest system is made of a split device driver, which means that any
  virtual Ethernet device has a corresponding network interface in
  Dom0. This interface is set up to access a virtual network that is
  run in Dom0. The bridged virtual network is fully integrated into the
  system configuration of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> and can be configured with
  YaST.
 </p><p>
  When installing a Xen VM Host Server, a bridged network configuration
  will be proposed during normal network configuration. The user can choose
  to change the configuration during the installation and customize it to
  the local needs.
 </p><p>
  If desired, Xen VM Host Server can be installed after performing a
  default Physical Server installation using the <code class="systemitem">Install
  Hypervisor and Tools</code> module in YaST. This module will
  prepare the system for hosting virtual machines, including invocation of
  the default bridge networking proposal.
 </p><p>
  In case the necessary packages for a Xen VM Host Server are installed
  manually with <code class="systemitem">rpm</code> or
  <code class="systemitem">zypper</code>, the remaining system configuration needs to
  be done by the administrator manually or with YaST.
 </p><p>
  The network scripts that are provided by Xen are not used by default
  in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. They are only delivered for reference but disabled.
  The network configuration that is used in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is done by
  means of the YaST system configuration similar to the configuration
  of network interfaces in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>.
 </p><p>
  For more general information about managing network bridges, see <a class="xref" href="#libvirt-networks-bridged" title="9.1.1. Network bridge">Section 9.1.1, “Network bridge”</a>.
 </p><section class="sect1" id="sec-xen-vdevices" data-id-title="Network devices for guest systems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.1 </span><span class="title-name">Network devices for guest systems</span></span> <a title="Permalink" class="permalink" href="#sec-xen-vdevices">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_host_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The Xen hypervisor can provide different types of network
   interfaces to the VM Guest systems. The preferred network device
   should be a paravirtualized network interface. This yields the highest
   transfer rates with the lowest system requirements. Up to eight network
   interfaces may be provided for each VM Guest.
  </p><p>
   Systems that are not aware of paravirtualized hardware may not have this
   option. To connect systems to a network that can only run fully
   virtualized, several emulated network interfaces are available. The
   following emulations are at your disposal:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Realtek 8139 (PCI). This is the default emulated network card.
    </p></li><li class="listitem"><p>
     AMD PCnet32 (PCI)
    </p></li><li class="listitem"><p>
     NE2000 (PCI)
    </p></li><li class="listitem"><p>
     NE2000 (ISA)
    </p></li><li class="listitem"><p>
     Intel e100 (PCI)
    </p></li><li class="listitem"><p>
     Intel e1000 and its variants e1000-82540em, e1000-82544gc, e1000-82545em (PCI)
    </p></li></ul></div><p>
   All these network interfaces are software interfaces. Because every
   network interface must have a unique MAC address, an address range has
   been assigned to Xensource that can be used by these interfaces.
  </p><div id="id-1.12.6.3.9.6" data-id-title="Virtual network interfaces and MAC addresses" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Virtual network interfaces and MAC addresses</div><p>
    The default configuration of MAC addresses in virtualized environments
    creates a random MAC address that looks like 00:16:3E:xx:xx:xx.
    Normally, the amount of available MAC addresses should be big enough to
    get only unique addresses. However, if you have a very big installation,
    or to make sure that no problems arise from random MAC
    address assignment, you can also manually assign these addresses.
   </p></div><p>
   For debugging or system management purposes, it may be useful to know
   which virtual interface in Dom0 is connected to which Ethernet
   device in a running guest. This information may be read from the device
   naming in Dom0. All virtual devices follow the rule
   <code class="literal">vif&lt;domain
   number&gt;.&lt;interface_number&gt;</code>.
  </p><p>
   For example, if you want to know the device name for the third interface
   (eth2) of the VM Guest with id 5, the device in Dom0 would be
   <code class="literal">vif5.2</code>. To obtain a list of all available interfaces,
   run the command <code class="command">ip a</code>.
  </p><p>
   The device naming does not contain any information about which bridge
   this interface is connected to. However, this information is available in
   Dom0. To get an overview about which interface is connected to which
   bridge, run the command <code class="command">bridge link</code>. The output may
   look as follows:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> bridge link
2: eth0 state DOWN : &lt;NO-CARRIER,BROADCAST,MULTICAST,SLAVE,UP&gt; mtu 1500 master br0
3: eth1 state UP : &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 master br1</pre></div><p>
   In this example, there are three configured bridges:
   <code class="literal">br0</code>, <code class="literal">br1</code> and
   <code class="literal">br2</code>. Currently, <code class="literal">br0</code> and
   <code class="literal">br1</code> each have a real Ethernet device added:
   <code class="literal">eth0</code> and <code class="literal">eth1</code>, respectively.
  </p></section><section class="sect1" id="sec-xen-net-host-route" data-id-title="Host-based routing in Xen"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.2 </span><span class="title-name">Host-based routing in Xen</span></span> <a title="Permalink" class="permalink" href="#sec-xen-net-host-route">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_host_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Xen can be set up to use host-based routing in the controlling
   Dom0. Unfortunately, this is not yet well supported from YaST
   and requires quite an amount of manual editing of configuration files.
   Thus, this is a task that requires an advanced administrator.
  </p><p>
   The following configuration will only work when using fixed IP addresses.
   Using DHCP is not practicable with this procedure, because the IP address
   must be known to both, the VM Guest and the VM Host Server system.
  </p><p>
   The easiest way to create a routed guest is to change the networking from
   a bridged to a routed network. As a requirement to the following
   procedures, a VM Guest with a bridged network setup must be
   installed. For example, the VM Host Server is named earth with the IP
   192.168.1.20, and the VM Guest has the name alice with the
   IP 192.168.1.21.
  </p><div class="procedure" id="proc-xen-network-route-ipv4" data-id-title="Configuring a routed IPv4 VM Guest"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 24.1: </span><span class="title-name">Configuring a routed IPv4 VM Guest </span></span><a title="Permalink" class="permalink" href="#proc-xen-network-route-ipv4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_host_network.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Make sure that alice is shut down. Use
     <code class="systemitem">xl</code> commands to shut down and check.
    </p></li><li class="step"><p>
     Prepare the network configuration on the VM Host Server earth:
    </p><ol type="a" class="substeps"><li class="step"><p>
       Create a hotplug interface that will be used to route the traffic. To
       accomplish this, create a file named
       <code class="filename">/etc/sysconfig/network/ifcfg-alice.0</code>
       with the following content:
      </p><div class="verbatim-wrap"><pre class="screen">NAME="Xen guest alice"
BOOTPROTO="static"
STARTMODE="hotplug"</pre></div></li><li class="step"><p>
       Ensure that IP forwarding is enabled:
      </p><ol type="i" class="substeps"><li class="step"><p>
         In YaST, go to <span class="guimenu">Network
           Settings</span> › <span class="guimenu">Routing</span>.
        </p></li><li class="step"><p>
         Enter the <span class="guimenu">Routing</span> tab and activate <span class="guimenu">Enable
          IPv4 Forwarding</span> and <span class="guimenu">Enable IPv6
          Forwarding</span> options.
        </p></li><li class="step"><p>
         Confirm the setting and quit YaST.
        </p></li></ol></li><li class="step"><p>
       Apply the following configuration to <code class="systemitem">firewalld</code>:
       </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Add alice.0 to the devices in the public zone:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> firewall-cmd --zone=public --add-interface=alice.0</pre></div></li><li class="listitem"><p>
         Tell the firewall which address should be forwarded:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> firewall-cmd --zone=public \
--add-forward-port=port=80:proto=tcp:toport=80:toaddr="192.168.1.21/32,0/0"</pre></div></li><li class="listitem"><p>
         Make the runtime configuration changes permanent:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> firewall-cmd --runtime-to-permanent</pre></div></li></ul></div></li><li class="step"><p>
       Add a static route to the interface of alice. To accomplish
       this, add the following line to the end of
       <code class="filename">/etc/sysconfig/network/routes</code>:
      </p><div class="verbatim-wrap"><pre class="screen">192.168.1.21  -  -  alice.0</pre></div></li><li class="step"><p>
       To make sure that the switches and routers that the VM Host Server is
       connected to know about the routed interface, activate
       <code class="literal">proxy_arp</code> on earth. Add the following lines
       to <code class="filename">/etc/sysctl.conf</code>:
      </p><div class="verbatim-wrap"><pre class="screen">net.ipv4.conf.default.proxy_arp = 1
net.ipv4.conf.all.proxy_arp = 1</pre></div></li><li class="step"><p>
       Activate all changes with the commands:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart systemd-sysctl wicked</pre></div></li></ol></li><li class="step"><p>
     Proceed with configuring the Xen configuration of the VM Guest by
     changing the vif interface configuration for alice as described in
     <a class="xref" href="#sec-xen-manage-xl" title="25.1. XL—Xen management tool">Section 25.1, “XL—Xen management tool”</a>. Make the following changes to the
     text file you generate during the process:
    </p><ol type="a" class="substeps"><li class="step"><p>
       Remove the snippet
      </p><div class="verbatim-wrap"><pre class="screen">bridge=br0</pre></div></li><li class="step"><p>
       And add the following one:
      </p><div class="verbatim-wrap"><pre class="screen">vifname=vifalice.0</pre></div><p>
       or
      </p><div class="verbatim-wrap"><pre class="screen">vifname=vifalice.0=emu</pre></div><p>
       for a fully virtualized domain.
      </p></li><li class="step"><p>
       Change the script that is used to set up the interface to the
       following:
      </p><div class="verbatim-wrap"><pre class="screen">script=/etc/xen/scripts/vif-route-ifup</pre></div></li><li class="step"><p>
       Activate the new configuration and start the VM Guest.
      </p></li></ol></li><li class="step"><p>
     The remaining configuration tasks must be accomplished from inside the
     VM Guest.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Open a console to the VM Guest with <code class="command">xl console</code>
       <em class="replaceable">DOMAIN</em> and log in.
      </p></li><li class="step"><p>
       Check that the guest IP is set to 192.168.1.21.
      </p></li><li class="step"><p>
       Provide VM Guest with a host route and a default gateway to the
       VM Host Server. Do this by adding the following lines to
       <code class="filename">/etc/sysconfig/network/routes</code>:
      </p><div class="verbatim-wrap"><pre class="screen">192.168.1.20 - - eth0
default 192.168.1.20 - -</pre></div></li></ol></li><li class="step"><p>
     Finally, test the network connection from the VM Guest to the world
     outside and from the network to your VM Guest.
    </p></li></ol></div></div></section><section class="sect1" id="sec-xen-net-masquerade" data-id-title="Creating a masqueraded network setup"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.3 </span><span class="title-name">Creating a masqueraded network setup</span></span> <a title="Permalink" class="permalink" href="#sec-xen-net-masquerade">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_host_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Creating a masqueraded network setup is quite similar to the routed
   setup. However, there is no proxy_arp needed, and some firewall rules are
   different. To create a masqueraded network to a guest dolly
   with the IP address 192.168.100.1 where the host has its external
   interface on <code class="literal">br0</code>, proceed as follows. For easier
   configuration, only the already installed guest is modified to use a
   masqueraded network:
  </p><div class="procedure" id="id-1.12.6.3.11.3" data-id-title="Configuring a masqueraded IPv4 VM guest"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 24.2: </span><span class="title-name">Configuring a masqueraded IPv4 VM guest </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.3.11.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_host_network.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Shut down the VM Guest system with <code class="command">xl shutdown</code>
     <em class="replaceable">DOMAIN</em>.
    </p></li><li class="step"><p>
     Prepare the network configuration on the VM Host Server:
    </p><ol type="a" class="substeps"><li class="step"><p>
       Create a hotplug interface that will be used to route the traffic. To
       accomplish this, create a file named
       <code class="filename">/etc/sysconfig/network/ifcfg-dolly.0</code>
       with the following content:
      </p><div class="verbatim-wrap"><pre class="screen">NAME="Xen guest dolly"
BOOTPROTO="static"
STARTMODE="hotplug"</pre></div></li><li class="step"><p>
       Edit the file
       <code class="filename">/etc/sysconfig/SuSEfirewall2</code> and add
       the following configurations:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Add dolly.0 to the devices in FW_DEV_DMZ:
        </p><div class="verbatim-wrap"><pre class="screen">FW_DEV_DMZ="dolly.0"</pre></div></li><li class="listitem"><p>
         Switch on the routing in the firewall:
        </p><div class="verbatim-wrap"><pre class="screen">FW_ROUTE="yes"</pre></div></li><li class="listitem"><p>
         Switch on masquerading in the firewall:
        </p><div class="verbatim-wrap"><pre class="screen">FW_MASQUERADE="yes"</pre></div></li><li class="listitem"><p>
         Tell the firewall which network should be masqueraded:
        </p><div class="verbatim-wrap"><pre class="screen">FW_MASQ_NETS="192.168.100.1/32"</pre></div></li><li class="listitem"><p>
         Remove the networks from the masquerading exceptions:
        </p><div class="verbatim-wrap"><pre class="screen">FW_NOMASQ_NETS=""</pre></div></li><li class="listitem"><p>
         Finally, restart the firewall with the command:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart SuSEfirewall2</pre></div></li></ul></div></li><li class="step"><p>
       Add a static route to the interface of dolly. To
       accomplish this, add the following line to the end of
       <code class="filename">/etc/sysconfig/network/routes</code>:
      </p><div class="verbatim-wrap"><pre class="screen">192.168.100.1 - - dolly.0</pre></div></li><li class="step"><p>
       Activate all changes with the command:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart wicked</pre></div></li></ol></li><li class="step"><p>
     Proceed with configuring the Xen configuration of the
     VM Guest.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Change the vif interface configuration for dolly as
       described in <a class="xref" href="#sec-xen-manage-xl" title="25.1. XL—Xen management tool">Section 25.1, “XL—Xen management tool”</a>.
      </p></li><li class="step"><p>
       Remove the entry:
      </p><div class="verbatim-wrap"><pre class="screen">bridge=br0</pre></div></li><li class="step"><p>
       And add the following one:
      </p><div class="verbatim-wrap"><pre class="screen">vifname=vifdolly.0</pre></div></li><li class="step"><p>
       Change the script that is used to set up the interface to the
       following:
      </p><div class="verbatim-wrap"><pre class="screen">script=/etc/xen/scripts/vif-route-ifup</pre></div></li><li class="step"><p>
       Activate the new configuration and start the VM Guest.
      </p></li></ol></li><li class="step"><p>
     The remaining configuration tasks need to be accomplished from inside
     the VM Guest.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Open a console to the VM Guest with <code class="command">xl console</code>
       <em class="replaceable">DOMAIN</em> and log in.
      </p></li><li class="step"><p>
       Check whether the guest IP is set to 192.168.100.1.
      </p></li><li class="step"><p>
       Provide VM Guest with a host route and a default gateway to the
       VM Host Server. Do this by adding the following lines to
       <code class="filename">/etc/sysconfig/network/routes</code>:
      </p><div class="verbatim-wrap"><pre class="screen">192.168.1.20 - - eth0
default 192.168.1.20 - -</pre></div></li></ol></li><li class="step"><p>
     Finally, test the network connection from the VM Guest to the
     outside world.
    </p></li></ol></div></div></section><section class="sect1" id="sec-xen-net-special" data-id-title="Special configurations"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.4 </span><span class="title-name">Special configurations</span></span> <a title="Permalink" class="permalink" href="#sec-xen-net-special">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_host_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are many network configuration possibilities available to Xen.
   The following configurations are not activated by default:
  </p><section class="sect2" id="sec-xen-net-throttle" data-id-title="Bandwidth throttling in virtual networks"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.4.1 </span><span class="title-name">Bandwidth throttling in virtual networks</span></span> <a title="Permalink" class="permalink" href="#sec-xen-net-throttle">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_host_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    With Xen, you may limit the network transfer rate a virtual guest
    may use to access a bridge. To configure this, you need to modify
    the VM Guest configuration as described in
    <a class="xref" href="#sec-xen-manage-xl" title="25.1. XL—Xen management tool">Section 25.1, “XL—Xen management tool”</a>.
   </p><p>
    In the configuration file, first search for the device that is connected
    to the virtual bridge. The configuration looks like the following:
   </p><div class="verbatim-wrap"><pre class="screen">vif = [ 'mac=00:16:3e:4f:94:a9,bridge=br0' ]</pre></div><p>
    To add a maximum transfer rate, add a parameter
    <code class="systemitem">rate</code> to this configuration as in:
   </p><div class="verbatim-wrap"><pre class="screen">vif = [ 'mac=00:16:3e:4f:94:a9,bridge=br0,rate=100Mb/s' ]</pre></div><p>
    Note that the rate is either <code class="literal">Mb/s</code> (megabits per
    second) or <code class="literal">MB/s</code> (megabytes per second). In the above
    example, the maximum transfer rate of the virtual interface is 100
    megabits. By default, there is no limitation to the bandwidth of a guest
    to the virtual bridge.
   </p><p>
    It is even possible to fine-tune the behavior by specifying the time
    window that is used to define the granularity of the credit
    replenishment:
   </p><div class="verbatim-wrap"><pre class="screen">vif = [ 'mac=00:16:3e:4f:94:a9,bridge=br0,rate=100Mb/s@20ms' ]</pre></div></section><section class="sect2" id="sec-xen-net-monitor" data-id-title="Monitoring the network traffic"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.4.2 </span><span class="title-name">Monitoring the network traffic</span></span> <a title="Permalink" class="permalink" href="#sec-xen-net-monitor">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_host_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To monitor the traffic on a specific interface, the little application
    <code class="systemitem">iftop</code> is a nice program that displays the
    current network traffic in a terminal.
   </p><p>
    When running a Xen VM Host Server, you need to define the interface
    that is monitored. The interface that Dom0 uses to get access to
    the physical network is the bridge device, for example
    <code class="systemitem">br0</code>. This, however, may vary on your system. To
    monitor all traffic to the physical interface, run a terminal as
    <code class="systemitem">root</code> and use the command:
   </p><div class="verbatim-wrap"><pre class="screen">iftop -i br0</pre></div><p>
    To monitor the network traffic of a special network interface of a
    specific VM Guest, supply the correct virtual interface. For
    example, to monitor the first Ethernet device of the domain with id 5,
    use the command:
   </p><div class="verbatim-wrap"><pre class="screen">ftop -i vif5.0</pre></div><p>
    To quit <code class="command">iftop</code>, press the key <span class="keycap">Q</span>. More
    options and possibilities are available in the manual page <code class="command">man
    8 iftop</code>.
   </p></section></section></section><section class="chapter" id="cha-xen-manage" data-id-title="Managing a virtualization environment"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">25 </span><span class="title-name">Managing a virtualization environment</span></span> <a title="Permalink" class="permalink" href="#cha-xen-manage">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Apart from using the recommended <code class="systemitem">libvirt</code> library
  (<a class="xref" href="#part-virt-libvirt" title="Part II. Managing virtual machines with libvirt">Part II, “Managing virtual machines with <code class="systemitem">libvirt</code>”</a>), you can manage Xen guest
  domains with the <code class="command">xl</code> tool from the command line.
 </p><section class="sect1" id="sec-xen-manage-xl" data-id-title="XL—Xen management tool"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">25.1 </span><span class="title-name">XL—Xen management tool</span></span> <a title="Permalink" class="permalink" href="#sec-xen-manage-xl">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="command">xl</code> program is a tool for managing Xen guest
   domains. It is part of the <span class="package">xen-tools</span> package.
   <code class="command">xl</code> is based on the LibXenlight library, and can be
   used for general domain management, such as domain creation, listing,
   pausing, or shutting down. Usually you need to be <code class="systemitem">root</code> to
   execute <code class="command">xl</code> commands.
  </p><div id="id-1.12.6.4.4.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    <code class="command">xl</code> can only manage running guest domains specified by
    their configuration file. If a guest domain is not running, you cannot
    manage it with <code class="command">xl</code>.
   </p></div><div id="id-1.12.6.4.4.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    To allow users to continue to have managed guest domains in the way the
    obsolete <code class="command">xm</code> command allowed, we now recommend using
    <code class="systemitem">libvirt</code>'s <code class="command">virsh</code> and
    <code class="command">virt-manager</code> tools. For more information, see
    <a class="xref" href="#part-virt-libvirt" title="Part II. Managing virtual machines with libvirt">Part II, “Managing virtual machines with <code class="systemitem">libvirt</code>”</a>.
   </p></div><p>
   <code class="command">xl</code> operations rely upon
   <code class="systemitem">xenstored</code> and
   <code class="systemitem">xenconsoled</code> services. Make sure you start
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>systemctl start xencommons</pre></div><p>
   at boot time to initialize all the daemons required by
   <code class="command">xl</code>.
  </p><div id="id-1.12.6.4.4.8" data-id-title="Set up a xenbr0 network bridge in the host domain" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Set up a <code class="literal">xenbr0</code> network bridge in the host domain</div><p>
    In the most common network configuration, you need to set up a bridge in
    the host domain named <code class="literal">xenbr0</code> to have a
    working network for the guest domains.
   </p></div><p>
   The basic structure of every <code class="command">xl</code> command is:
  </p><div class="verbatim-wrap"><pre class="screen">xl &lt;subcommand&gt; [options] domain_id</pre></div><p>
   where &lt;subcommand&gt; is the xl command to run, domain_id is the ID
   number assigned to a domain or the name of the virtual machine, and
   <code class="command">OPTIONS</code> indicates subcommand-specific options.
  </p><p>
   For a complete list of the available <code class="command">xl</code> subcommands,
   run <code class="command">xl help</code>. For each command, there is a more
   detailed help available that is obtained with the extra parameter
   <code class="systemitem">--help</code>. More information about the respective
   subcommands is available in the manual page of <code class="command">xl</code>.
  </p><p>
   For example, the <code class="command">xl list --help</code> displays all options
   that are available to the list command. As an example, the <code class="command">xl
   list</code> command displays the status of all virtual machines.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl list
Name                                 ID    Mem VCPUs        State   Time(s)
Domain-0                              0    457     2       r-----   2712.9
sles12                                7    512     1       -b----     16.3
opensuse                                   512     1                  12.9</pre></div><p>
   The <span class="guimenu">State</span> information indicates if a machine is
   running, and in which state it is. The most common flags are
   <code class="literal">r</code> (running) and <code class="literal">b</code> (blocked) where
   blocked means it is either waiting for IO, or sleeping because there is
   nothing to do. For more details about the state flags, see <code class="command">man 1
   xl</code>.
  </p><p>
   Other useful <code class="command">xl</code> commands include:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="command">xl create</code> creates a virtual machine from a given
     configuration file.
    </p></li><li class="listitem"><p>
     <code class="command">xl reboot </code>reboots a virtual machine.
    </p></li><li class="listitem"><p>
     <code class="command">xl destroy</code> immediately terminates a virtual machine.
    </p></li><li class="listitem"><p>
     <code class="command">xl block-list</code> displays all virtual block devices
     attached to a virtual machine.
    </p></li></ul></div><section class="sect2" id="sec-xen-manage-xl-cfg-file" data-id-title="Guest domain configuration file"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">25.1.1 </span><span class="title-name">Guest domain configuration file</span></span> <a title="Permalink" class="permalink" href="#sec-xen-manage-xl-cfg-file">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When operating domains, <code class="command">xl</code> requires a domain
    configuration file for each domain. The default directory to store such
    configuration files is <code class="filename">/etc/xen/</code>.
   </p><p>
    A domain configuration file is a plain text file. It consists of
    several
    <em class="replaceable">KEY</em>=<em class="replaceable">VALUE</em>
    pairs. Some keys are mandatory, some are general and apply to any
    guest, and some apply only to a specific guest type (para or fully
    virtualized). A value can either be a <code class="literal">"string"</code>
    surrounded by single or double quotes, a number, a boolean value, or
    a list of several values enclosed in brackets <code class="literal">[ value1,
    value2, ... ]</code>.
   </p><div class="example" id="id-1.12.6.4.4.18.4" data-id-title="Guest domain configuration file for SLED 12: /etc/xen/sled12.cfg"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 25.1: </span><span class="title-name">Guest domain configuration file for SLED 12: <code class="filename">/etc/xen/sled12.cfg</code> </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.4.4.18.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">name= "sled12"
builder = "hvm"
vncviewer = 1
memory = 512
disk = [ '/var/lib/xen/images/sled12.raw,,hda', '/dev/cdrom,,hdc,cdrom' ]
vif = [ 'mac=00:16:3e:5f:48:e4,model=rtl8139,bridge=br0' ]
boot = "n"</pre></div></div></div><p>
    To start such domain, run <code class="command">xl create
    /etc/xen/sled12.cfg</code>.
   </p></section></section><section class="sect1" id="sec-xen-manage-autostart" data-id-title="Automatic start of guest domains"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">25.2 </span><span class="title-name">Automatic start of guest domains</span></span> <a title="Permalink" class="permalink" href="#sec-xen-manage-autostart">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To make a guest domain start automatically after the host system boots,
   follow these steps:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Create the domain configuration file if it does not exist, and save it
     in the <code class="filename">/etc/xen/</code> directory, for example
     <code class="filename">/etc/xen/domain_name.cfg</code>.
    </p></li><li class="step"><p>
     Make a symbolic link of the guest domain configuration file in the
     <code class="filename">auto/</code> subdirectory.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ln -s /etc/xen/domain_name.cfg /etc/xen/auto/domain_name.cfg</pre></div></li><li class="step"><p>
     On the next system boot, the guest domain defined in
     <code class="filename">domain_name.cfg</code> will be started.
    </p></li></ol></div></div></section><section class="sect1" id="sec-xen-manage-events" data-id-title="Event actions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">25.3 </span><span class="title-name">Event actions</span></span> <a title="Permalink" class="permalink" href="#sec-xen-manage-events">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In the guest domain configuration file, you can define actions to be
   performed on a predefined set of events. For example, to tell the domain
   to restart itself after it is powered off, include the following line in
   its configuration file:
  </p><div class="verbatim-wrap"><pre class="screen">on_poweroff="restart"</pre></div><p>
   A list of predefined events for a guest domain follows:
  </p><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">List of events </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.4.6.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.12.6.4.6.5.2"><span class="term">on_poweroff</span></dt><dd><p>
      Specifies what should be done with the domain if it shuts itself down.
     </p></dd><dt id="id-1.12.6.4.6.5.3"><span class="term">on_reboot</span></dt><dd><p>
      Action to take if the domain shuts down with a reason code requesting
      a reboot.
     </p></dd><dt id="id-1.12.6.4.6.5.4"><span class="term">on_watchdog</span></dt><dd><p>
      Action to take if the domain shuts down because of a Xen watchdog
      timeout.
     </p></dd><dt id="id-1.12.6.4.6.5.5"><span class="term">on_crash</span></dt><dd><p>
      Action to take if the domain crashes.
     </p></dd></dl></div><p>
   For these events, you can define one of the following actions:
  </p><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">List of related actions </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.4.6.7">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.12.6.4.6.7.2"><span class="term">destroy</span></dt><dd><p>
      Destroy the domain.
     </p></dd><dt id="id-1.12.6.4.6.7.3"><span class="term">restart</span></dt><dd><p>
      Destroy the domain and immediately create a new domain with the same
      configuration.
     </p></dd><dt id="id-1.12.6.4.6.7.4"><span class="term">rename-restart</span></dt><dd><p>
      Rename the domain that terminated, and then immediately create a new
      domain with the same configuration as the original.
     </p></dd><dt id="id-1.12.6.4.6.7.5"><span class="term">preserve</span></dt><dd><p>
      Keep the domain. It can be examined, and later destroyed with
      <code class="command">xl destroy</code>.
     </p></dd><dt id="id-1.12.6.4.6.7.6"><span class="term">coredump-destroy</span></dt><dd><p>
      Write a core dump of the domain to
      <code class="filename">/var/xen/dump/NAME</code> and then destroy the domain.
     </p></dd><dt id="id-1.12.6.4.6.7.7"><span class="term">coredump-restart</span></dt><dd><p>
      Write a core dump of the domain to
      <code class="filename">/var/xen/dump/NAME</code> and then restart the domain.
     </p></dd></dl></div></section><section class="sect1" id="sec-xen-manage-tsc" data-id-title="Time Stamp Counter"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">25.4 </span><span class="title-name">Time Stamp Counter</span></span> <a title="Permalink" class="permalink" href="#sec-xen-manage-tsc">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The Time Stamp Counter (TSC) may be specified for each domain in the guest
   domain configuration file (for more information, see <a class="xref" href="#sec-xen-manage-xl-cfg-file" title="25.1.1. Guest domain configuration file">Section 25.1.1, “Guest domain configuration file”</a>).
  </p><p>
   With the <code class="literal">tsc_mode</code> setting, you specify whether
   rdtsc instructions are executed <span class="quote">“<span class="quote">natively</span>”</span> (fast, but
   TSC-sensitive applications may sometimes run incorrectly) or emulated
   (always run correctly, but performance may suffer).
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.4.7.4.1"><span class="term"><code class="literal">tsc_mode=0</code> (default)</span></dt><dd><p>
      Use this to ensure correctness while providing the best performance
      possible—for more information, see <a class="link" href="https://xenbits.xen.org/docs/4.3-testing/misc/tscmode.txt" target="_blank">https://xenbits.xen.org/docs/4.3-testing/misc/tscmode.txt</a>.
     </p></dd><dt id="id-1.12.6.4.7.4.2"><span class="term"><code class="literal">tsc_mode=1</code> (always emulate)</span></dt><dd><p>
      Use this when TSC-sensitive apps are running and worst-case
      performance degradation is known and acceptable.
     </p></dd><dt id="id-1.12.6.4.7.4.3"><span class="term"><code class="literal">tsc_mode=2</code> (never emulate)</span></dt><dd><p>
      Use this when all applications running in
      this VM are TSC-resilient and highest performance is required.
     </p></dd><dt id="id-1.12.6.4.7.4.4"><span class="term"><code class="literal">tsc_mode=3</code> (PVRDTSCP)</span></dt><dd><p>
      High-TSC-frequency applications may be paravirtualized (modified)
      to obtain both correctness and highest performance—any
      unmodified applications must be TSC-resilient.
     </p></dd></dl></div><p>
   For background information, see <a class="link" href="https://xenbits.xen.org/docs/4.3-testing/misc/tscmode.txt" target="_blank">https://xenbits.xen.org/docs/4.3-testing/misc/tscmode.txt</a>.
  </p></section><section class="sect1" id="sec-xen-config-suspend" data-id-title="Saving virtual machines"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">25.5 </span><span class="title-name">Saving virtual machines</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-suspend">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure" id="id-1.12.6.4.8.2" data-id-title="Save a virtual machine’s current state"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 25.1: </span><span class="title-name">Save a virtual machine’s current state </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.4.8.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Make sure the virtual machine to be saved is running.
    </p></li><li class="step"><p>
     In the host environment, enter
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl save <em class="replaceable">ID</em> <em class="replaceable">STATE-FILE</em></pre></div><p>
     where <em class="replaceable">ID</em> is the virtual machine ID you want
     to save, and <em class="replaceable">STATE-FILE</em> is the name you
     specify for the memory state file. By default, the domain will no
     longer be running after you create its snapshot. Use
     <code class="option">-c</code> to keep it running even after you create the
     snapshot.
    </p></li></ol></div></div></section><section class="sect1" id="sec-xen-config-restore" data-id-title="Restoring virtual machines"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">25.6 </span><span class="title-name">Restoring virtual machines</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-restore">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure" id="id-1.12.6.4.9.2" data-id-title="Restore a virtual machine’s current state"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 25.2: </span><span class="title-name">Restore a virtual machine’s current state </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.4.9.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Make sure the virtual machine to be restored has not been started since
     you ran the save operation.
    </p></li><li class="step"><p>
     In the host environment, enter
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl restore <em class="replaceable">STATE-FILE</em></pre></div><p>
     where <em class="replaceable">STATE-FILE</em> is the previously saved
     memory state file. By default, the domain will be running after it is
     restored. To pause it after the restore, use <code class="option">-p</code>.
    </p></li></ol></div></div></section><section class="sect1" id="sec-xen-config-state" data-id-title="Virtual machine states"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">25.7 </span><span class="title-name">Virtual machine states</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-state">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_virtualization_manage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A virtual machine’s state can be displayed by viewing the results of
   the <code class="command">xl list</code> command, which abbreviates the state using
   a single character.
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="command">r</code> - running - The virtual machine is currently
     running and consuming allocated resources.
    </p></li><li class="listitem"><p>
     <code class="command">b</code> - blocked - The virtual machine’s processor is
     not running and not able to run. It is either waiting for I/O or has
     stopped working.
    </p></li><li class="listitem"><p>
     <code class="command">p</code> - paused - The virtual machine is paused. It does
     not interact with the hypervisor but still maintains its allocated
     resources, such as memory.
    </p></li><li class="listitem"><p>
     <code class="command">s</code> - shutdown - The guest operating system is in the
     process of being shut down, rebooted, or suspended, and the virtual
     machine is being stopped.
    </p></li><li class="listitem"><p>
     <code class="command">c</code> - crashed - The virtual machine has crashed and is
     not running.
    </p></li><li class="listitem"><p>
     <code class="command">d</code> - dying - The virtual machine is in the process of
     shutting down or crashing.
    </p></li></ul></div></section></section><section class="chapter" id="cha-xen-vbd" data-id-title="Block devices in Xen"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">26 </span><span class="title-name">Block devices in Xen</span></span> <a title="Permalink" class="permalink" href="#cha-xen-vbd">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_block_devices.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="sec-xen-config-disk" data-id-title="Mapping physical storage to virtual disks"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">26.1 </span><span class="title-name">Mapping physical storage to virtual disks</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-disk">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_block_devices.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The disk(s) specification for a Xen domain in the domain configuration
   file is as straightforward as the following example:
  </p><div class="verbatim-wrap"><pre class="screen">disk = [ 'format=raw,vdev=hdc,access=ro,devtype=cdrom,target=/root/image.iso' ]</pre></div><p>
   It defines a disk block device based on the
   <code class="filename">/root/image.iso</code> disk image file. The disk will be seen
   as <code class="literal">hdc</code> by the guest, with read-only
   (<code class="literal">ro</code>) access. The type of the device is
   <code class="literal">cdrom</code> with <code class="literal">raw</code> format.
  </p><p>
   The following example defines an identical device, but using simplified
   positional syntax:
  </p><div class="verbatim-wrap"><pre class="screen">disk = [ '/root/image.iso,raw,hdc,ro,cdrom' ]</pre></div><p>
   You can include more disk definitions in the same line, each one separated
   by a comma. If a parameter is not specified, then its default value is
   taken:
  </p><div class="verbatim-wrap"><pre class="screen">disk = [ '/root/image.iso,raw,hdc,ro,cdrom','/dev/vg/guest-volume,,hda','...' ]</pre></div><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">List of parameters </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.5.4.9">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_block_devices.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.12.6.5.4.9.2"><span class="term">target</span></dt><dd><p>
      Source block device or disk image file path.
     </p></dd><dt id="id-1.12.6.5.4.9.3"><span class="term">format</span></dt><dd><p>
      The format of the image file. Default is <code class="literal">raw</code>.
     </p></dd><dt id="id-1.12.6.5.4.9.4"><span class="term">vdev</span></dt><dd><p>
      Virtual device as seen by the guest. Supported values are hd[x], xvd[x],
      sd[x] etc. See
      <code class="filename">/usr/share/doc/packages/xen/misc/vbd-interface.txt</code>
      for more details. This parameter is mandatory.
     </p></dd><dt id="id-1.12.6.5.4.9.5"><span class="term">access</span></dt><dd><p>
      Whether the block device is provided to the guest in read-only or
      read-write mode. Supported values are <code class="literal">ro</code> or
      <code class="literal">r</code> for read-only, and <code class="literal">rw</code> or
      <code class="literal">w</code> for read/write access. Default is
      <code class="literal">ro</code> for <code class="literal">devtype=cdrom</code>, and
      <code class="literal">rw</code> for other device types.
     </p></dd><dt id="id-1.12.6.5.4.9.6"><span class="term">devtype</span></dt><dd><p>
      Qualifies virtual device type. Supported value is
      <code class="literal">cdrom</code>.
     </p></dd><dt id="id-1.12.6.5.4.9.7"><span class="term">backendtype</span></dt><dd><p>
      The back-end implementation to use. Supported values are
      <code class="literal">phy</code>, <code class="literal">tap</code>, and
      <code class="literal">qdisk</code>. Normally this option should not be specified as
      the back-end type is automatically determined.
     </p></dd><dt id="id-1.12.6.5.4.9.8"><span class="term">script</span></dt><dd><p>
      Specifies that <code class="literal">target</code> is not a normal host path, but
      rather information to be interpreted by the executable program. The
      specified script file is looked for in
      <code class="filename">/etc/xen/scripts</code> if it does not point to an absolute
      path. These scripts are normally called
      <code class="literal">block-&lt;script_name&gt;</code>.
     </p></dd></dl></div><p>
   For more information about specifying virtual disks, see
   <code class="filename">/usr/share/doc/packages/xen/misc/xl-disk-configuration.txt</code>.
  </p></section><section class="sect1" id="sec-xen-config-netdisk" data-id-title="Mapping network storage to virtual disk"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">26.2 </span><span class="title-name">Mapping network storage to virtual disk</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-netdisk">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_block_devices.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Similar to mapping a local disk image (see
   <a class="xref" href="#sec-xen-config-disk" title="26.1. Mapping physical storage to virtual disks">Section 26.1, “Mapping physical storage to virtual disks”</a>), you can map a network disk as a
   virtual disk as well.
  </p><p>
   The following example shows mapping of an RBD (RADOS Block Device) disk with
   multiple Ceph monitors and cephx authentication enabled:
  </p><div class="verbatim-wrap"><pre class="screen">disk = [ 'vdev=hdc, backendtype=qdisk, \
target=rbd:libvirt-pool/new-libvirt-image:\
id=libvirt:key=AQDsPWtW8JoXJBAAyLPQe7MhCC+JPkI3QuhaAw==:auth_supported=cephx;none:\
mon_host=137.65.135.205\\:6789;137.65.135.206\\:6789;137.65.135.207\\:6789' ]</pre></div><p>
   Following is an example of an NBD (Network Block Device) disk mapping:
  </p><div class="verbatim-wrap"><pre class="screen">disk = [ 'vdev=hdc, backendtype=qdisk, target=nbd:151.155.144.82:5555' ]</pre></div></section><section class="sect1" id="sec-xen-config-filedisk" data-id-title="File-backed virtual disks and loopback devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">26.3 </span><span class="title-name">File-backed virtual disks and loopback devices</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-filedisk">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_block_devices.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When a virtual machine is running, each of its file-backed virtual disks
   consumes a loopback device on the host. By default, the host allows up to 64
   loopback devices to be consumed.
  </p><p>
   To simultaneously run more file-backed virtual disks on a host, you can
   increase the number of available loopback devices by adding the following
   option to the host’s <code class="filename">/etc/modprobe.conf.local</code> file.
  </p><div class="verbatim-wrap"><pre class="screen">options loop max_loop=x</pre></div><p>
   where <code class="command">x</code> is the maximum number of loopback devices to
   create.
  </p><p>
   Changes take effect after the module is reloaded.
  </p><div id="id-1.12.6.5.6.7" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    Enter <code class="command">rmmod loop</code> and <code class="command">modprobe loop</code> to
    unload and reload the module. In case <code class="command">rmmod</code> does not
    work, unmount all existing loop devices or reboot the computer.
   </p></div></section><section class="sect1" id="sec-xen-block-resize" data-id-title="Resizing block devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">26.4 </span><span class="title-name">Resizing block devices</span></span> <a title="Permalink" class="permalink" href="#sec-xen-block-resize">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_block_devices.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   While it is always possible to add new block devices to a VM Guest system,
   it is sometimes more desirable to increase the size of an existing block
   device. In case such a system modification is already planned during
   deployment of the VM Guest, some basic considerations should be done:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Use a block device that may be increased in size. LVM devices and file
     system images are commonly used.
    </p></li><li class="listitem"><p>
     Do not partition the device inside the VM Guest, but use the main device
     directly to apply the file system. For example, use
     <code class="filename">/dev/xvdb</code> directly instead of adding partitions to
     <code class="filename">/dev/xvdb</code>.
    </p></li><li class="listitem"><p>
     Make sure that the file system to be used can be resized. Sometimes, for
     example with Ext3, some features must be switched off to be able to resize
     the file system. A file system that can be resized online and mounted is
     <code class="literal">XFS</code>. Use the command <code class="command">xfs_growfs</code> to
     resize that file system after the underlying block device has been
     increased in size. For more information about <code class="literal">XFS</code>, see
     <code class="command">man 8 xfs_growfs</code>.
    </p></li></ul></div><p>
   When resizing an LVM device that is assigned to a VM Guest, the new size is
   automatically known to the VM Guest. No further action is needed to inform
   the VM Guest about the new size of the block device.
  </p><p>
   When using file system images, a loop device is used to attach the image
   file to the guest. For more information about resizing that image and
   refreshing the size information for the VM Guest, see
   <a class="xref" href="#sec-xen-config-sparse" title="28.2. Sparse image files and disk space">Section 28.2, “Sparse image files and disk space”</a>.
  </p></section><section class="sect1" id="sec-xen-block-advstoragescripts" data-id-title="Scripts for managing advanced storage scenarios"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">26.5 </span><span class="title-name">Scripts for managing advanced storage scenarios</span></span> <a title="Permalink" class="permalink" href="#sec-xen-block-advstoragescripts">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_block_devices.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are scripts that can help with managing advanced storage scenarios
   such as disk environments provided by
   <code class="command">dmmd</code> (<span class="quote">“<span class="quote">device mapper—multi
   disk</span>”</span>) including LVM environments built upon a software RAID set, or
   a software RAID set built upon an LVM environment. These scripts are part of
   the <span class="package">xen-tools</span> package. After installation, they can be
   found in <code class="filename">/etc/xen/scripts</code>:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="command">block-dmmd</code>
    </p></li><li class="listitem"><p>
     <code class="command">block-drbd-probe</code>
    </p></li><li class="listitem"><p>
     <code class="command">block-npiv</code>
    </p></li></ul></div><p>
   The scripts allow for external commands to perform some action, or
   series of actions of the block devices prior to serving them up to a
   guest.
  </p><p>
   These scripts could formerly only be used with <code class="command">xl</code>
   or <code class="command">libxl</code> using the disk configuration syntax
   <code class="literal">script=</code>.  They can now be used with libvirt by
   specifying the base name of the block script in the
   <code class="literal">&lt;source&gt;</code> element of the disk. For example:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;source dev='dmmd:md;/dev/md0;lvm;/dev/vgxen/lv-vm01'/&gt;</pre></div></section></section><section class="chapter" id="cha-xen-config" data-id-title="Virtualization: configuration options and settings"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">27 </span><span class="title-name">Virtualization: configuration options and settings</span></span> <a title="Permalink" class="permalink" href="#cha-xen-config">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The documentation in this section, describes advanced management tasks and
  configuration options that might help technology innovators implement
  leading-edge virtualization solutions. It is provided as a courtesy and
  does not imply that all documented options and tasks are supported by
  Novell, Inc.
 </p><section class="sect1" id="sec-xen-config-vcd" data-id-title="Virtual CD readers"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.1 </span><span class="title-name">Virtual CD readers</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-vcd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Virtual CD readers can be set up when a virtual machine is created or
   added to an existing virtual machine. A virtual CD reader can be based on
   a physical CD/DVD, or based on an ISO image. Virtual CD readers work
   differently depending on whether they are paravirtual or fully virtual.
  </p><section class="sect2" id="sec-xen-config-vcd-para" data-id-title="Virtual CD readers on paravirtual machines"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.1.1 </span><span class="title-name">Virtual CD readers on paravirtual machines</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-vcd-para">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A paravirtual machine can have up to 100 block devices composed of
    virtual CD readers and virtual disks. On paravirtual machines, virtual
    CD readers present the CD as a virtual disk with read-only access.
    Virtual CD readers cannot be used to write data to a CD.
   </p><p>
    After you have finished accessing a CD on a paravirtual machine, it is
    recommended that you remove the virtual CD reader from the virtual
    machine.
   </p><p>
    Paravirtualized guests can use the device type
    <code class="literal">devtype=cdrom</code>. This partly emulates the behavior of a
    real CD reader, and allows CDs to be changed. It is even possible to use
    the eject command to open the tray of the CD reader.
   </p></section><section class="sect2" id="sec-xen-config-vcd-full" data-id-title="Virtual CD readers on fully virtual machines"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.1.2 </span><span class="title-name">Virtual CD readers on fully virtual machines</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-vcd-full">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A fully virtual machine can have up to four block devices composed of
    virtual CD readers and virtual disks. A virtual CD reader on a fully
    virtual machine interacts with an inserted CD in the way you would
    expect a physical CD reader to interact.
   </p><p>
    When a CD is inserted in the physical CD reader on the host computer,
    all virtual machines with virtual CD readers based on the physical CD
    reader, such as <code class="filename">/dev/cdrom/</code>, can read the
    inserted CD. Assuming the operating system has automount functionality,
    the CD should automatically appear in the file system. Virtual CD
    readers cannot be used to write data to a CD. They are configured as
    read-only devices.
   </p></section><section class="sect2" id="sec-xen-config-vcd-add" data-id-title="Adding virtual CD readers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.1.3 </span><span class="title-name">Adding virtual CD readers</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-vcd-add">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Virtual CD readers can be based on a CD inserted into the CD reader or
    on an ISO image file.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Make sure that the virtual machine is running and the operating system
      has finished booting.
     </p></li><li class="step"><p>
      Insert the desired CD into the physical CD reader or copy the desired
      ISO image to a location available to Dom0.
     </p></li><li class="step"><p>
      Select a new, unused block device in your VM Guest, such as
      <code class="filename">/dev/xvdb</code>.
     </p></li><li class="step"><p>
      Choose the CD reader or ISO image that you want to assign to the
      guest.
     </p></li><li class="step"><p>
      When using a real CD reader, use the following command to assign the
      CD reader to your VM Guest. In this example, the name of the guest
      is alice:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl block-attach alice target=/dev/sr0,vdev=xvdb,access=ro</pre></div></li><li class="step"><p>
      When assigning an image file, use the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl block-attach alice target=/path/to/file.iso,vdev=xvdb,access=ro</pre></div></li><li class="step"><p>
      A new block device, such as <code class="filename">/dev/xvdb</code>, is added
      to the virtual machine.
     </p></li><li class="step"><p>
      If the virtual machine is running Linux, complete the following:
     </p><ol type="a" class="substeps"><li class="step"><p>
        Open a terminal in the virtual machine and enter <code class="command">fdisk
        -l</code> to verify that the device was properly added. You can
        also enter <code class="command">ls /sys/block</code> to see all disks
        available to the virtual machine.
       </p><p>
        The CD is recognized by the virtual machine as a virtual disk with a
        drive designation, for example:
       </p><div class="verbatim-wrap"><pre class="screen">/dev/xvdb</pre></div></li><li class="step"><p>
        Enter the command to mount the CD or ISO image using its drive
        designation. For example,
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mount -o ro /dev/xvdb /mnt</pre></div><p>
        mounts the CD to a mount point named <code class="command">/mnt</code>.
       </p><p>
        The CD or ISO image file should be available to the virtual machine
        at the specified mount point.
       </p></li></ol></li><li class="step"><p>
      If the virtual machine is running Windows, reboot the virtual machine.
     </p><p>
      Verify that the virtual CD reader appears in its <code class="literal">My
      Computer</code> section.
     </p></li></ol></div></div></section><section class="sect2" id="sec-xen-config-vcd-remove" data-id-title="Removing virtual CD readers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.1.4 </span><span class="title-name">Removing virtual CD readers</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-vcd-remove">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Make sure that the virtual machine is running and the operating system
      has finished booting.
     </p></li><li class="step"><p>
      If the virtual CD reader is mounted, unmount it from within the
      virtual machine.
     </p></li><li class="step"><p>
      Enter <code class="command">xl block-list alice</code> on the host view of the
      guest block devices.
     </p></li><li class="step"><p>
      Enter <code class="command">xl block-detach alice</code>
      <em class="replaceable">BLOCK_DEV_ID</em> to remove the virtual device
      from the guest. If that fails, try to add <code class="option">-f</code> to force
      the removal.
     </p></li><li class="step"><p>
      Press the hardware eject button to eject the CD.
     </p></li></ol></div></div></section></section><section class="sect1" id="sec-xen-config-remote-access" data-id-title="Remote access methods"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.2 </span><span class="title-name">Remote access methods</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-remote-access">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Some configurations, such as those that include rack-mounted servers,
   require a computer to run without a video monitor, keyboard, or mouse.
   This type of configuration is often called <code class="literal">headless</code> and
   requires the use of remote administration technologies.
  </p><p>
   Typical configuration scenarios and technologies include:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.6.5.4.1"><span class="term">Graphical desktop with X window server</span></dt><dd><p>
      If a graphical desktop, such as GNOME, is installed on the virtual
      machine host, you can use a remote viewer, such as a VNC viewer. On a
      remote computer, log in and manage the remote guest environment by
      using graphical tools, such as <code class="command">tigervnc</code> or
      <code class="command">virt-viewer</code>.
     </p></dd><dt id="id-1.12.6.6.5.4.2"><span class="term">Text only</span></dt><dd><p>
      You can use the <code class="command">ssh</code> command from a remote computer
      to log in to a virtual machine host and access its text-based console.
      You can then use the <code class="command">xl</code> command to manage virtual
      machines, and the <code class="command">virt-install</code> command to create new virtual machines.
     </p></dd></dl></div></section><section class="sect1" id="sec-xen-config-vnc" data-id-title="VNC viewer"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.3 </span><span class="title-name">VNC viewer</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-vnc">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   VNC viewer is used to view the environment of the running guest system in
   a graphical way. You can use it from Dom0 (known as local access or
   on-box access), or from a remote computer.
  </p><p>
   You can use the IP address of a VM Host Server and a VNC viewer to view the
   display of this VM Guest. When a virtual machine is running, the VNC
   server on the host assigns the virtual machine a port number to be used
   for VNC viewer connections. The assigned port number is the lowest port
   number available when the virtual machine starts. The number is only
   available for the virtual machine while it is running. After shutting
   down, the port number might be assigned to other virtual machines.
  </p><p>
   For example, if ports 1 and 2 and 4 and 5 are assigned to the running
   virtual machines, the VNC viewer assigns the lowest available port
   number, 3. If port number 3 is still in use the next time the virtual
   machine starts, the VNC server assigns a different port number to the
   virtual machine.
  </p><p>
   To use the VNC viewer from a remote computer, the firewall must permit
   access to as many ports as VM Guest systems run from. This means from
   port 5900 and up. For example, to run 10 VM Guest
   systems, you need to open the TCP ports 5900:5910.
  </p><p>
   To access the virtual machine from the local console running a VNC viewer
   client, enter one of the following commands:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="command">vncviewer ::590#</code>
    </p></li><li class="listitem"><p>
     <code class="command">vncviewer :#</code>
    </p></li></ul></div><p>
   <em class="replaceable">#</em> is the VNC viewer port number assigned to
   the virtual machine.
  </p><p>
   When accessing the VM Guest from a machine other than Dom0, use
   the following syntax:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>vncviewer 192.168.1.20::590#</pre></div><p>
   In this case, the IP address of Dom0 is 192.168.1.20.
  </p><section class="sect2" id="sec-xen-config-vnc-portnumbers" data-id-title="Assigning VNC viewer port numbers to virtual machines"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.3.1 </span><span class="title-name">Assigning VNC viewer port numbers to virtual machines</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-vnc-portnumbers">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Although the default behavior of VNC viewer is to assign the first
    available port number, you should assign a specific VNC viewer
    port number to a specific virtual machine.
   </p><p>
    To assign a specific port number on a VM Guest, edit the xl setting
    of the virtual machine and change the <code class="literal">vnclisten</code> to
    the desired value. Note that for example for port number 5902, specify 2
    only, as 5900 is added automatically:
   </p><div class="verbatim-wrap"><pre class="screen">vfb = [ 'vnc=1,vnclisten="localhost:2"' ]</pre></div><p>
    For more information regarding editing the xl settings of a guest
    domain, see <a class="xref" href="#sec-xen-manage-xl" title="25.1. XL—Xen management tool">Section 25.1, “XL—Xen management tool”</a>.
   </p><div id="id-1.12.6.6.6.12.6" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     Assign higher port numbers to avoid conflict with port numbers assigned
     by the VNC viewer, which uses the lowest available port number.
    </p></div></section><section class="sect2" id="sec-xen-config-vnc-sdl" data-id-title="Using SDL instead of a VNC viewer"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.3.2 </span><span class="title-name">Using SDL instead of a VNC viewer</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-vnc-sdl">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you access a virtual machine's display from the virtual machine host
    console (known as local or on-box access), you should use SDL
    instead of VNC viewer. VNC viewer is faster for viewing desktops over a
    network, but SDL is faster for viewing desktops from the same computer.
   </p><p>
    To set the default to use SDL instead of VNC, change the virtual
    machine's configuration information to the following. For instructions,
    see <a class="xref" href="#sec-xen-manage-xl" title="25.1. XL—Xen management tool">Section 25.1, “XL—Xen management tool”</a>.
   </p><div class="verbatim-wrap"><pre class="screen">vfb = [ 'sdl=1' ]</pre></div><p>
    Remember that, unlike a VNC viewer window, closing an SDL window
    terminates the virtual machine.
   </p></section></section><section class="sect1" id="sec-xen-config-keyboard" data-id-title="Virtual keyboards"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.4 </span><span class="title-name">Virtual keyboards</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-keyboard">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When a virtual machine is started, the host creates a virtual keyboard
   that matches the <code class="command">keymap</code> entry according to the virtual
   machine's settings. If there is no <code class="command">keymap</code> entry
   specified, the virtual machine's keyboard defaults to English (US).
  </p><p>
   To view a virtual machine's current <code class="command">keymap</code> entry,
   enter the following command on the Dom0:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>xl list -l <em class="replaceable">VM_NAME</em> | grep keymap</pre></div><p>
   To configure a virtual keyboard for a guest, use the following snippet:
  </p><div class="verbatim-wrap"><pre class="screen">vfb = [ 'keymap="de"' ]</pre></div><p>
   For a complete list of supported keyboard layouts, see the
   <code class="literal">Keymaps</code> section of the <code class="command">xl.cfg</code>
   manual page <code class="command">man 5 xl.cfg</code>.
  </p></section><section class="sect1" id="xen-config-cpupinning" data-id-title="Dedicating CPU resources"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.5 </span><span class="title-name">Dedicating CPU resources</span></span> <a title="Permalink" class="permalink" href="#xen-config-cpupinning">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In Xen it is possible to specify how many and which CPU cores the
   Dom0 or VM Guest should use to retain its performance. The
   performance of Dom0 is important for the overall system, as the disk
   and network drivers are running on it. Also I/O intensive guests'
   workloads may consume lots of Dom0s' CPU cycles. On the other hand,
   the performance of VM Guests is also important, to be able to
   accomplish the task they were set up for.
  </p><section class="sect2" id="config-cpupinning-dom0" data-id-title="Dom0"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.5.1 </span><span class="title-name">Dom0</span></span> <a title="Permalink" class="permalink" href="#config-cpupinning-dom0">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Dedicating CPU resources to Dom0 results in a better overall
    performance of the virtualized environment because Dom0 has free
    CPU time to process I/O requests from VM Guests. Failing to dedicate
    exclusive CPU resources to Dom0 usually results in a poor
    performance and can cause the VM Guests to function incorrectly.
   </p><p>
    Dedicating CPU resources involves three basic steps: modifying Xen
    boot line, binding Dom0's VCPUs to a physical processor, and
    configuring CPU-related options on VM Guests:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      First you need to append the <code class="literal">dom0_max_vcpus=X</code> to
      the Xen boot line. Do so by adding the following line to
      <code class="filename">/etc/default/grub</code>:
     </p><div class="verbatim-wrap"><pre class="screen">GRUB_CMDLINE_XEN="dom0_max_vcpus=X"</pre></div><p>
      If <code class="filename">/etc/default/grub</code> already contains a line
      setting <code class="envar">GRUB_CMDLINE_XEN</code>, rather append
      <code class="literal">dom0_max_vcpus=X</code> to this line.
     </p><p>
      <code class="literal">X</code> needs to be replaced by the number of VCPUs
      dedicated to Dom0.
     </p></li><li class="step"><p>
      Update the GRUB 2 configuration file by running the following
      command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> grub2-mkconfig -o /boot/grub2/grub.cfg</pre></div></li><li class="step"><p>
      Reboot for the change to take effect.
     </p></li><li class="step"><p>
      The next step is to bind (or <span class="quote">“<span class="quote">pin</span>”</span>) each Dom0's VCPU
      to a physical processor.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl vcpu-pin Domain-0 0 0
xl vcpu-pin Domain-0 1 1</pre></div><p>
      The first line binds Dom0's VCPU number 0 to the physical
      processor number 0, while the second line binds Dom0's VCPU
      number 1 to the physical processor number 1.
     </p></li><li class="step"><p>
      Lastly, you need to make sure no VM Guest uses the physical
      processors dedicated to VCPUs of Dom0. Assuming you are running
      an 8-CPU system, you need to add
     </p><div class="verbatim-wrap"><pre class="screen">cpus="2-8"</pre></div><p>
      to the configuration file of the relevant VM Guest.
     </p></li></ol></div></div></section><section class="sect2" id="config-cpupinning-domU" data-id-title="VM Guests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.5.2 </span><span class="title-name">VM Guests</span></span> <a title="Permalink" class="permalink" href="#config-cpupinning-domU">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    It is often necessary to dedicate specific CPU resources to a virtual
    machine. By default, a virtual machine uses any available CPU core. Its
    performance can be improved by assigning a reasonable number of physical
    processors to it as other VM Guests are not allowed to use
    them after that. Assuming a machine with 8 CPU cores while a virtual
    machine needs to use 2 of them, change its configuration file as
    follows:
   </p><div class="verbatim-wrap"><pre class="screen">vcpus=2
cpus="2,3"</pre></div><p>
    The above example dedicates <code class="literal">2</code> processors to the
    VM Guest, and these being the 3rd and 4th one, (<code class="literal">2</code>
    and <code class="literal">3</code> counted from zero). If you need to assign more
    physical processors, use the <code class="literal">cpus="2-8"</code> syntax.
   </p><p>
    If you need to change the CPU assignment for a guest named
    <span class="quote">“<span class="quote">alice</span>”</span> in a hotplug manner, do the following on the
    related Dom0:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl vcpu-set alice 2
<code class="prompt user">&gt; </code><code class="command">sudo</code> xl vcpu-pin alice 0 2
<code class="prompt user">&gt; </code><code class="command">sudo</code> xl vcpu-pin alice 1 3</pre></div><p>
    The example will dedicate 2 physical processors to the guest, and bind
    its VCPU 0 to physical processor 2 and VCPU 1 to physical processor 3.
    Now check the assignment:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl vcpu-list alice
Name                              ID VCPUs   CPU State   Time(s) CPU Affinity
alice                             4     0     2   -b-       1.9 2-3
alice                             4     1     3   -b-       2.8 2-3</pre></div></section></section><section class="sect1" id="sec-xen-config-hvm" data-id-title="HVM features"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.6 </span><span class="title-name">HVM features</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-hvm">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In Xen some features are only available for fully virtualized
   domains. They are not very often used, but still may be interesting in
   some environments.
  </p><section class="sect2" id="sec-xen-config-bootdevice" data-id-title="Specify boot device on boot"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.6.1 </span><span class="title-name">Specify boot device on boot</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-bootdevice">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Just as with physical hardware, it is sometimes desirable to boot a
    VM Guest from a different device than its own boot device. For fully
    virtual machines, it is possible to select a boot device with the
    <code class="literal">boot</code> parameter in a domain xl configuration file:
   </p><div class="verbatim-wrap"><pre class="screen">boot = <em class="replaceable">BOOT_DEVICE</em></pre></div><p>
    <em class="replaceable">BOOT_DEVICE</em> can be one of
    <code class="literal">c</code> for hard disk, <code class="literal">d</code> for CD-ROM, or
    <code class="literal">n</code> for Network/PXE. You can specify multiple options,
    and they will be attempted in the given order. For example,
   </p><div class="verbatim-wrap"><pre class="screen">boot = dc</pre></div><p>
    boots from CD-ROM, and falls back to the hard disk if CD-ROM is not
    bootable.
   </p></section><section class="sect2" id="sec-xen-config-cpuid" data-id-title="Changing CPUIDs for guests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.6.2 </span><span class="title-name">Changing CPUIDs for guests</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-cpuid">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To be able to migrate a VM Guest from one VM Host Server to a different
    VM Host Server, the VM Guest system may only use CPU
    features that are available on both VM Host Server systems. If the actual CPUs
    are different on both hosts, it may be necessary to hide some features
    before the VM Guest is started. This maintains the possibility to
    migrate the VM Guest between both hosts. For fully virtualized guests,
    this can be achieved by configuring the <code class="literal">cpuid</code> that is
    available to the guest.
   </p><p>
    To gain an overview of the current CPU, have a look at
    <code class="filename">/proc/cpuinfo</code>. This contains all the important
    information that defines the current CPU.
   </p><p>
    To redefine a CPU, first have a look at the respective cpuid definitions
    of the CPU vendor. These are available from:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.6.9.4.5.1"><span class="term">Intel</span></dt><dd><p>
       <a class="link" href="http://www.intel.com/Assets/PDF/appnote/241618.pdf" target="_blank">http://www.intel.com/Assets/PDF/appnote/241618.pdf</a>
      </p></dd></dl></div><div class="verbatim-wrap"><pre class="screen">cpuid = "host,tm=0,sse3=0"</pre></div><p>
    The syntax is a comma-separated list of key=value pairs, preceded by the
    word "host". A few keys take a numerical value, while all others take a
    single character which describes what to do with the feature bit. See
    <code class="command">man 5 xl.cfg</code> for a complete list of cpuid keys. The
    respective bits may be changed by using the following values:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.6.9.4.8.1"><span class="term">1</span></dt><dd><p>
       Force the corresponding bit to <code class="literal">1</code>
      </p></dd><dt id="id-1.12.6.6.9.4.8.2"><span class="term">0</span></dt><dd><p>
       Force the corresponding bit to <code class="literal">0</code>
      </p></dd><dt id="id-1.12.6.6.9.4.8.3"><span class="term">x</span></dt><dd><p>
       Use the values of the default policy
      </p></dd><dt id="id-1.12.6.6.9.4.8.4"><span class="term">k</span></dt><dd><p>
       Use the values defined by the host
      </p></dd><dt id="id-1.12.6.6.9.4.8.5"><span class="term">s</span></dt><dd><p>
       Like <code class="literal">k</code>, but preserve the value over migrations
      </p></dd></dl></div><p>
    Note that counting bits is done from right to left, starting with bit
    <code class="literal">0</code>.
   </p></section><section class="sect2" id="sec-xen-config-pirqs" data-id-title="Increasing the number of PCI-IRQs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">27.6.3 </span><span class="title-name">Increasing the number of PCI-IRQs</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-pirqs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    In case you need to increase the default number of PCI-IRQs available to
    Dom0 and/or VM Guest, you can do so by modifying the Xen
    kernel command line. Use the command
    <code class="command">extra_guest_irqs=</code>
    <em class="replaceable">DOMU_IRGS,DOM0_IRGS</em>. The optional first
    number <em class="replaceable">DOMU_IRGS</em> is common for all
    VM Guests, while the optional second number
    <em class="replaceable">DOM0_IRGS</em> (preceded by a comma) is for
    Dom0. Changing the setting for VM Guest has no impact on
    Dom0 and vice versa. For example to change Dom0 without
    changing VM Guest, use
   </p><div class="verbatim-wrap"><pre class="screen">extra_guest_irqs=,512</pre></div></section></section><section class="sect1" id="sec-xen-config-scheduling" data-id-title="Virtual CPU scheduling"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.7 </span><span class="title-name">Virtual CPU scheduling</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-scheduling">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_config_options.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The Xen hypervisor schedules virtual CPUs individually across physical
   CPUs.  With modern CPUs supporting multiple threads on each core, virtual
   CPUs can run on the same core in different threads and thus influence each
   other.  The performance of a virtual CPU running in one thread can be
   noticeably affected by what other virtual CPUs in other threads are doing.
   When these virtual CPUs belong to different guest systems, these guests can
   influence each other. The effect can vary, from variations in the guest CPU
   time accounting to worse scenarios such as <span class="emphasis"><em>side channel
    attack</em></span>.
  </p><p>
   <span class="emphasis"><em>Scheduling granularity</em></span> addresses this problem. You can
   specify it at boot time by using a Xen boot parameter:
  </p><div class="verbatim-wrap"><pre class="screen">sched-gran=<em class="replaceable">GRANULARITY</em></pre></div><p>
   Replace <em class="replaceable">GRANULARITY</em> with one of:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.6.10.6.1"><span class="term">cpu</span></dt><dd><p>
      The regular scheduling of the Xen hypervisor. Virtual CPUs of different
      guests can share one physical CPU core. This is the default.
     </p></dd><dt id="id-1.12.6.6.10.6.2"><span class="term">core</span></dt><dd><p>
      Virtual CPUs of a virtual core are always scheduled together on one
      physical core. Two or more virtual CPUs from different virtual cores will
      never be scheduled on the same physical core.  Therefore, some physical
      cores may have some of their CPUs left idle, even if there are virtual
      CPUs wanting to run. The impact on performance will depend on the actual
      workload being run inside of the guest systems. In most of the analyzed
      cases, the observed performance degradation, especially if under
      considerable load, was smaller than disabling HyperThreading, which leaves
      all the cores with just one thread (see the <code class="option">smt</code> boot
      option at <a class="link" href="https://xenbits.xen.org/docs/unstable/misc/xen-command-line.html#smt-x86" target="_blank">https://xenbits.xen.org/docs/unstable/misc/xen-command-line.html#smt-x86</a>).
     </p></dd><dt id="id-1.12.6.6.10.6.3"><span class="term">socket</span></dt><dd><p>
      The granularity goes even higher to a CPU socket level.
     </p></dd></dl></div></section></section><section class="chapter" id="cha-xen-admin" data-id-title="Administrative tasks"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">28 </span><span class="title-name">Administrative tasks</span></span> <a title="Permalink" class="permalink" href="#cha-xen-admin">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="sec-xen-config-bootloader" data-id-title="The boot loader program"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.1 </span><span class="title-name">The boot loader program</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-bootloader">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The boot loader controls how the virtualization software boots and runs.
   You can modify the boot loader properties by using YaST, or by
   directly editing the boot loader configuration file.
  </p><p>
   The YaST boot loader program is located at <span class="guimenu">YaST</span> › <span class="guimenu">System</span> › <span class="guimenu">Boot
   Loader</span>. Click the <span class="guimenu">Bootloader
   Options</span> tab and select the line containing the Xen kernel
   as the <span class="guimenu">Default Boot Section</span>.
  </p><div class="figure" id="id-1.12.6.7.4.4"><div class="figure-contents"><div class="mediaobject"><a href="images/xen_bootloader.png"><img src="images/xen_bootloader.png" width="80%" alt="Boot loader settings" title="Boot loader settings"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 28.1: </span><span class="title-name">Boot loader settings </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.7.4.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div><p>
   Confirm with <span class="guimenu">OK</span>. Next time you boot the host, it will
   be ready to provide the Xen virtualization environment.
  </p><p>
   You can use the Boot Loader program to specify functionality, such as:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Pass kernel command line parameters.
    </p></li><li class="listitem"><p>
     Specify the kernel image and initial RAM disk.
    </p></li><li class="listitem"><p>
     Select a specific hypervisor.
    </p></li><li class="listitem"><p>
     Pass additional parameters to the hypervisor. See
     <a class="link" href="http://xenbits.xen.org/docs/unstable/misc/xen-command-line.html" target="_blank">http://xenbits.xen.org/docs/unstable/misc/xen-command-line.html</a>
     for their complete list.
    </p></li></ul></div><p>
   You can customize your virtualization environment by editing the
   <code class="filename">/etc/default/grub</code> file. Add the following line to
   this file:
   <code class="literal">GRUB_CMDLINE_XEN="&lt;boot_parameters&gt;"</code>. Do not
   forget to run <code class="command">grub2-mkconfig -o /boot/grub2/grub.cfg</code>
   after editing the file.
  </p></section><section class="sect1" id="sec-xen-config-sparse" data-id-title="Sparse image files and disk space"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.2 </span><span class="title-name">Sparse image files and disk space</span></span> <a title="Permalink" class="permalink" href="#sec-xen-config-sparse">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the host’s physical disk reaches a state where it has no available
   space, a virtual machine using a virtual disk based on a sparse image
   file cannot write to its disk. Consequently, it reports I/O errors.
  </p><p>
   If this situation
   occurs, you should free up available space on the physical disk, remount
   the virtual machine’s file system, and set the file system back to
   read-write.
  </p><p>
   To check the actual disk requirements of a sparse image file, use the
   command <code class="command">du -h &lt;image file&gt;</code>.
  </p><p>
   To increase the available space of a sparse image file, first increase
   the file size and then the file system.
  </p><div id="id-1.12.6.7.5.6" data-id-title="Back up before resizing" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Back up before resizing</div><p>
    Touching the sizes of partitions or sparse files always bears the risk
    of data failure. Do not work without a backup.
   </p></div><p>
   The resizing of the image file can be done online, while the VM Guest
   is running. Increase the size of a sparse image file with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/zero of=&lt;image file&gt; count=0 bs=1M seek=&lt;new size in MB&gt;</pre></div><p>
   For example, to increase the file
   <code class="filename">/var/lib/xen/images/sles/disk0</code> to a size of 16GB,
   use the command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/zero of=/var/lib/xen/images/sles/disk0 count=0 bs=1M seek=16000</pre></div><div id="id-1.12.6.7.5.11" data-id-title="Increasing non-sparse images" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Increasing non-sparse images</div><p>
    It is also possible to increase the image files of devices that are not
    sparse files. However, you must know exactly where the previous image
    ends. Use the seek parameter to point to the end of the image file and
    use a command similar to the following:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/zero of=/var/lib/xen/images/sles/disk0 seek=8000 bs=1M count=2000</pre></div></div><p>
   Be sure to use the right seek, else data loss may happen.
  </p><p>
   If the VM Guest is running during the resize operation, also resize
   the loop device that provides the image file to the VM Guest. First
   detect the correct loop device with the command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> losetup -j /var/lib/xen/images/sles/disk0</pre></div><p>
   Then resize the loop device, for example <code class="filename">/dev/loop0</code>,
   with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> losetup -c /dev/loop0</pre></div><p>
   Finally check the size of the block device inside the guest system with
   the command <code class="command">fdisk -l /dev/xvdb</code>. The device name
   depends on the actually increased device.
  </p><p>
   The resizing of the file system inside the sparse file involves tools that
   are depending on the actual file system. <span class="phrase">This is
   described in detail in the <span class="intraxref">Book “Storage Administration Guide”</span>.</span>
  </p></section><section class="sect1" id="sec-xen-manage-migrate" data-id-title="Migrating Xen VM Guest systems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.3 </span><span class="title-name">Migrating Xen VM Guest systems</span></span> <a title="Permalink" class="permalink" href="#sec-xen-manage-migrate">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   With Xen it is possible to migrate a VM Guest system from one
   VM Host Server to another with almost no service interruption. This could be
   used for example to move a busy VM Guest to a VM Host Server that has
   stronger hardware or is not yet loaded. Or, if a service of a VM Host Server
   is required, all VM Guest systems running on this machine can be
   migrated to other machines to avoid interruption of service.
   These are only two examples—many more reasons may apply to your
   personal situation.
  </p><p>
   Before starting, some preliminary considerations regarding the
   VM Host Server should be taken into account:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     All VM Host Server systems should use a similar CPU. The frequency is not so
     important, but they should be using the same CPU family. To get more
     information about the used CPU, use <code class="command">cat /proc/cpuinfo</code>.
     Find more details about comparing host CPU features in <a class="xref" href="#sec-xen-manage-migrate-cpu" title="28.3.1. Detecting CPU features">Section 28.3.1, “Detecting CPU features”</a>.
    </p></li><li class="listitem"><p>
     All resources that are used by a specific guest system must be
     available on all involved VM Host Server systems—for example all used block devices
     must exist on both VM Host Server systems.
    </p></li><li class="listitem"><p>
     If the hosts included in the migration process run in different subnets,
     make sure that either DHCP relay is available to the guests,
     or for guests with static network configuration, set up the network manually.
    </p></li><li class="listitem"><p>
     Using special features like <code class="literal">PCI Pass-Through</code> may be
     problematic. Do not implement these when deploying for an environment
     that should migrate VM Guest systems between different VM Host Server
     systems.
    </p></li><li class="listitem"><p>
     For fast migrations, a fast network is mandatory. If possible, use GB
     Ethernet and fast switches. Deploying VLAN might also help avoid
     collisions.
    </p></li></ul></div><section class="sect2" id="sec-xen-manage-migrate-cpu" data-id-title="Detecting CPU features"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">28.3.1 </span><span class="title-name">Detecting CPU features</span></span> <a title="Permalink" class="permalink" href="#sec-xen-manage-migrate-cpu">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    By using the <code class="systemitem">cpuid</code> and
    <code class="systemitem">xen_maskcalc.py</code> tools, you can compare features of
    a CPU on the host from where you are migrating the source VM Guest with
    the features of CPUs on the target hosts. This way you can better predict
    if the guest migrations will be successful.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Run the <code class="command">cpuid -1r</code> command on each Dom0 that is
      supposed to run or receive the migrated VM Guest and capture the output
      in text files, for example:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux@vm_host1 &gt; </code>sudo cpuid -1r &gt; vm_host1.txt
<code class="prompt user">tux@vm_host2 &gt; </code>sudo cpuid -1r &gt; vm_host2.txt
<code class="prompt user">tux@vm_host3 &gt; </code>sudo cpuid -1r &gt; vm_host3.txt</pre></div></li><li class="step"><p>
      Copy all the output text files on a host with the
      <code class="command">xen_maskcalc.py</code> script installed.
     </p></li><li class="step"><p>
      Run the <code class="command">xen_maskcalc.py</code> script on all output text
      files:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xen_maskcalc.py vm_host1.txt vm_host2.txt vm_host3.txt
cpuid = [
    "0x00000001:ecx=x00xxxxxx0xxxxxxxxx00xxxxxxxxxxx",
    "0x00000007,0x00:ebx=xxxxxxxxxxxxxxxxxx00x0000x0x0x00"
]</pre></div></li><li class="step"><p>
      Copy the output <code class="literal">cpuid=[...]</code> configuration snipped into
      the <code class="command">xl</code> configuration of the migrated
      guest<code class="filename">domU.cfg</code> or alternatively to its <code class="systemitem">libvirt</code>'s
      XML configuration.
     </p></li><li class="step"><p>
      Start the source guest with the <span class="emphasis"><em>trimmed</em></span> CPU
      configuration. The guest can now only use CPU features which are present
      on each of the hosts.
     </p></li></ol></div></div><div id="id-1.12.6.7.6.5.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     <code class="systemitem">libvirt</code> also supports calculating a baseline CPU for migration. For more details, refer to <a class="link" href="https://documentation.suse.com/sles-15/html/SLES-all/article-virtualization-best-practices.html" target="_blank">https://documentation.suse.com/sles-15/html/SLES-all/article-virtualization-best-practices.html</a>.
    </p></div><section class="sect3" id="sec-xen-manage-migrate-cpu-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">28.3.1.1 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-xen-manage-migrate-cpu-info">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can find more details about <code class="systemitem">cpuid</code> at
     <a class="link" href="http://etallen.com/cpuid.html" target="_blank">http://etallen.com/cpuid.html</a>.
    </p><p>
     You can download the latest version of the CPU mask calculator from
     <a class="link" href="https://github.com/twizted/xen_maskcalc" target="_blank">https://github.com/twizted/xen_maskcalc</a>.
    </p></section></section><section class="sect2" id="sec-xen-manage-migrate-block" data-id-title="Preparing block devices for migrations"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">28.3.2 </span><span class="title-name">Preparing block devices for migrations</span></span> <a title="Permalink" class="permalink" href="#sec-xen-manage-migrate-block">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The block devices needed by the VM Guest system must be available on
    all involved VM Host Server systems. This is done by implementing some kind
    of shared storage that serves as container for the root file system of
    the migrated VM Guest system. Common possibilities include:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="literal">iSCSI</code> can be set up to give access to the same block
      devices from different systems at the same time. <span class="phrase">For
      more information about iSCSI, see <span class="intraxref">Book “Storage Administration Guide”, Chapter 15 “Mass storage over IP networks: iSCSI”</span>.</span>
     </p></li><li class="listitem"><p>
      <code class="literal">NFS</code> is a widely used root file system that can
      easily be accessed from different locations. For more information, see
      <span class="intraxref">Book “Storage Administration Guide”, Chapter 19 “Sharing file systems with NFS”</span>.
     </p></li><li class="listitem"><p>
      <code class="literal">DRBD</code> can be used if only two VM Host Server systems
      are involved. This gives some extra data security, because the used
      data is mirrored over the network. <span class="phrase">For more information, see the
      <em class="citetitle">SUSE Linux Enterprise High Availability
      <span class="productnumber"><span class="phrase">15 SP3</span></span></em> documentation at
      <a class="link" href="https://documentation.suse.com/sle-ha-15/" target="_blank">https://documentation.suse.com/sle-ha-15/</a></span>.
     </p></li><li class="listitem"><p>
      <code class="literal">SCSI</code> can also be used if the available hardware
      permits shared access to the same disks.
     </p></li><li class="listitem"><p>
      <code class="literal">NPIV</code> is a special mode to use Fibre channel disks.
      However, in this case all migration hosts must be attached to the same
      Fibre channel switch. For more information about NPIV, see
      <a class="xref" href="#sec-xen-config-disk" title="26.1. Mapping physical storage to virtual disks">Section 26.1, “Mapping physical storage to virtual disks”</a>. Commonly, this works if the
      Fibre channel environment supports 4 Gbps or faster connections.
     </p></li></ul></div></section><section class="sect2" id="sec-xen-manage-migrate-xl" data-id-title="Migrating VM Guest systems"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">28.3.3 </span><span class="title-name">Migrating VM Guest systems</span></span> <a title="Permalink" class="permalink" href="#sec-xen-manage-migrate-xl">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The actual migration of the VM Guest system is done with the
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl migrate &lt;domain_name&gt; &lt;host&gt;</pre></div><p>
    The speed of the migration depends on how fast the memory print can be
    saved to disk, sent to the new VM Host Server and loaded there. This means
    that small VM Guest systems can be migrated faster than big systems
    with a lot of memory.
   </p></section></section><section class="sect1" id="sec-xen-monitor" data-id-title="Monitoring Xen"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.4 </span><span class="title-name">Monitoring Xen</span></span> <a title="Permalink" class="permalink" href="#sec-xen-monitor">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For a regular operation of many virtual guests, having a possibility to
   check the sanity of all the different VM Guest systems is
   indispensable. Xen offers several tools besides the system tools to
   gather information about the system.
  </p><div id="id-1.12.6.7.7.3" data-id-title="Monitoring the VM Host Server" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Monitoring the VM Host Server</div><p>
    Basic monitoring of the VM Host Server (I/O and CPU) is available via the
    Virtual Machine Manager. Refer to
    <a class="xref" href="#cha-libvirt-admin-monitor-virt-manager" title="11.8.1. Monitoring with Virtual Machine Manager">Section 11.8.1, “Monitoring with Virtual Machine Manager”</a> for details.
   </p></div><section class="sect2" id="sec-xen-monitor-xentop" data-id-title="Monitor Xen with xentop"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">28.4.1 </span><span class="title-name">Monitor Xen with <code class="command">xentop</code></span></span> <a title="Permalink" class="permalink" href="#sec-xen-monitor-xentop">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The preferred terminal application to gather information about Xen
    virtual environment is <code class="command">xentop</code>. Unfortunately, this
    tool needs a rather broad terminal, else it inserts line breaks into the
    display.
   </p><p>
    <code class="command">xentop</code> has several command keys that can give you
    more information about the system that is monitored. Some of the more
    important are:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.7.7.4.4.1"><span class="term">D</span></dt><dd><p>
       Change the delay between the refreshes of the screen.
      </p></dd><dt id="id-1.12.6.7.7.4.4.2"><span class="term">N</span></dt><dd><p>
       Also display network statistics. Note, that only standard
       configurations will be displayed. If you use a special configuration
       like a routed network, no network will be displayed.
      </p></dd><dt id="id-1.12.6.7.7.4.4.3"><span class="term">B</span></dt><dd><p>
       Display the respective block devices and their cumulated usage count.
      </p></dd></dl></div><p>
    For more information about <code class="command">xentop</code> see the manual page
    <code class="command">man 1 xentop</code>.
   </p><div id="id-1.12.6.7.7.4.6" data-id-title="virt-top" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: <code class="command">virt-top</code></div><p>
     libvirt offers the hypervisor-agnostic tool <code class="command">virt-top</code>,
     which is recommended for monitoring VM Guests. See <a class="xref" href="#cha-libvirt-admin-monitor-virt-top" title="11.8.2. Monitoring with virt-top">Section 11.8.2, “Monitoring with <code class="command">virt-top</code>”</a> for details.
    </p></div></section><section class="sect2" id="sec-xen-monitor-tools" data-id-title="Additional tools"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">28.4.2 </span><span class="title-name">Additional tools</span></span> <a title="Permalink" class="permalink" href="#sec-xen-monitor-tools">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There are many system tools that also help monitoring or debugging a
    running <span class="phrase">SUSE Linux Enterprise</span> system. Many of these are covered in
    <span class="intraxref">Book “System Analysis and Tuning Guide”, Chapter 2 “System monitoring utilities”</span>. Especially useful for monitoring a
    virtualization environment are the following tools:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.7.7.5.3.1"><span class="term">ip</span></dt><dd><p>
       The command line utility <code class="command">ip</code> may be used to monitor
       arbitrary network interfaces. This is especially useful if you have
       set up a network that is routed or applied a masqueraded network. To
       monitor a network interface with the name
       <code class="literal">alice.0</code>, run the following command:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>watch ip -s link show alice.0</pre></div></dd><dt id="id-1.12.6.7.7.5.3.2"><span class="term">bridge</span></dt><dd><p>
       In a standard setup, all the Xen VM Guest systems are
       attached to a virtual network bridge. <code class="command">bridge</code> allows
       you to determine the connection between the bridge and the virtual
       network adapter in the VM Guest system. For example, the output
       of <code class="command">bridge link</code> may look like the following:
      </p><div class="verbatim-wrap"><pre class="screen">2: eth0 state DOWN : &lt;NO-CARRIER, ...,UP&gt; mtu 1500 master br0
8: vnet0 state UNKNOWN : &lt;BROADCAST, ...,LOWER_UP&gt; mtu 1500 master virbr0 \
  state forwarding priority 32 cost 100</pre></div><p>
       This shows that there are two virtual bridges defined on the system.  One
       is connected to the physical Ethernet device <code class="literal">eth0</code>, the
       other one is connected to a VLAN interface <code class="literal">vnet0</code>.
      </p></dd><dt id="id-1.12.6.7.7.5.3.3"><span class="term">iptables-save</span></dt><dd><p>
       Especially when using masquerade networks, or if several Ethernet
       interfaces are set up together with a firewall setup, it may be
       helpful to check the current firewall rules.
      </p><p>
       The command <code class="command">iptables</code> may be used to check all the
       different firewall settings. To list all the rules of a chain, or
       even of the complete setup, you may use the commands
       <code class="command">iptables-save</code> or <code class="command">iptables -S</code>.
      </p></dd></dl></div></section></section><section class="sect1" id="sec-xen-admin-vhostmd" data-id-title="Providing host information for VM Guest systems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.5 </span><span class="title-name">Providing host information for VM Guest systems</span></span> <a title="Permalink" class="permalink" href="#sec-xen-admin-vhostmd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In a standard Xen environment, the VM Guest systems have only
   very limited information about the VM Host Server system they are running
   on. If a guest should know more about the VM Host Server it runs on,
   <code class="systemitem">vhostmd</code> can provide more information to selected
   guests. To set up your system to run <code class="systemitem">vhostmd</code>,
   proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Install the package vhostmd on the VM Host Server.
    </p></li><li class="step"><p>
     To add or remove <code class="literal">metric</code> sections from the
     configuration, edit the file
     <code class="filename">/etc/vhostmd/vhostmd.conf</code>. However, the default works
     well.
    </p></li><li class="step"><p>
     Check the validity of the <code class="filename">vhostmd.conf</code>
     configuration file with the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cd /etc/vhostmd
<code class="prompt user">&gt; </code>xmllint --postvalid --noout vhostmd.conf</pre></div></li><li class="step"><p>
     Start the vhostmd daemon with the command <code class="command">sudo systemctl start
     vhostmd</code>.
    </p><p>
     If vhostmd should be started automatically during start-up of the
     system, run the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable vhostmd</pre></div></li><li class="step"><p>
     Attach the image file <code class="filename">/dev/shm/vhostmd0</code> to the
     VM Guest system named alice with the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>xl block-attach opensuse /dev/shm/vhostmd0,,xvdb,ro</pre></div></li><li class="step"><p>
     Log on the VM Guest system.
    </p></li><li class="step"><p>
     Install the client package <code class="systemitem">vm-dump-metrics</code>.
    </p></li><li class="step"><p>
     Run the command <code class="command">vm-dump-metrics</code>. To save the result to
     a file, use the option <code class="systemitem">-d &lt;filename&gt;</code>.
    </p></li></ol></div></div><p>
   The result of the <code class="systemitem">vm-dump-metrics</code> is an XML
   output. The respective metric entries follow the DTD
   <code class="filename">/etc/vhostmd/metric.dtd</code>.
  </p><p>
   For more information, see the manual pages <code class="command">man 8
   vhostmd</code> and <code class="filename">/usr/share/doc/vhostmd/README</code>
   on the VM Host Server system. On the guest, see the manual page <code class="command">man
   1 vm-dump-metrics</code>.
  </p></section></section><section class="chapter" id="cha-xen-xenstore" data-id-title="XenStore: configuration database shared between domains"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">29 </span><span class="title-name">XenStore: configuration database shared between domains</span></span> <a title="Permalink" class="permalink" href="#cha-xen-xenstore">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xenstore.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This section introduces basic information about XenStore, its role in
  the Xen environment, the directory structure of files used by
  XenStore, and the description of XenStore's commands.
 </p><section class="sect1" id="sec-xenstore-intro" data-id-title="Introduction"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">29.1 </span><span class="title-name">Introduction</span></span> <a title="Permalink" class="permalink" href="#sec-xenstore-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xenstore.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   XenStore is a database of configuration and status information
   shared between VM Guests and the management tools running in
   Dom0. VM Guests and the management tools read and write to
   XenStore to convey configuration information, status updates, and
   state changes. The XenStore database is managed by Dom0 and
   supports simple operations such as reading and writing a key.
   VM Guests and management tools can be notified of any changes in
   XenStore by watching entries of interest. Note that the
   <code class="systemitem">xenstored</code> daemon is managed by the
   <code class="systemitem">xencommons</code> service.
  </p><p>
   XenStore is located on Dom0 in a single database file
   <code class="filename">/var/lib/xenstored/tdb</code> (<code class="literal">tdb</code>
   represents <span class="emphasis"><em>tree database</em></span>).
  </p></section><section class="sect1" id="sec-xenstore-fsi" data-id-title="File system interface"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">29.2 </span><span class="title-name">File system interface</span></span> <a title="Permalink" class="permalink" href="#sec-xenstore-fsi">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xenstore.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   XenStore database content is represented by a virtual file system
   similar to <code class="filename">/proc</code> (for more information on
   <code class="filename">/proc</code>, see <span class="intraxref">Book “System Analysis and Tuning Guide”, Chapter 2 “System monitoring utilities”, Section 2.6 “The <code class="filename">/proc</code> file system”</span>). The
   tree has three main paths: <code class="filename">/vm</code>,
   <code class="filename">/local/domain</code>, and <code class="filename">/tool</code>.
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="filename">/vm</code> - stores information about the VM Guest
     configuration.
    </p></li><li class="listitem"><p>
     <code class="filename">/local/domain</code> - stores information about
     VM Guest on the local node.
    </p></li><li class="listitem"><p>
     <code class="filename">/tool</code> - stores general information about various
     tools.
    </p></li></ul></div><div id="id-1.12.6.8.5.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    Each VM Guest has two different ID numbers. The <span class="emphasis"><em>universal
    unique identifier</em></span> (UUID) remains the same even if the
    VM Guest is migrated to another machine. The <span class="emphasis"><em>domain
    identifier</em></span> (DOMID) is an identification number that
    represents a particular running instance. It typically changes when the
    VM Guest is migrated to another machine.
   </p></div><section class="sect2" id="id-1.12.6.8.5.5" data-id-title="XenStore commands"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">29.2.1 </span><span class="title-name">XenStore commands</span></span> <a title="Permalink" class="permalink" href="#id-1.12.6.8.5.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xenstore.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The file system structure of the XenStore database can be operated
    with the following commands:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.8.5.5.3.1"><span class="term"><code class="command">xenstore-ls</code>
     </span></dt><dd><p>
       Displays the full dump of the XenStore database.
      </p></dd><dt id="id-1.12.6.8.5.5.3.2"><span class="term"><code class="command">xenstore-read</code><code class="option">path_to_xenstore_entry</code>
     </span></dt><dd><p>
       Displays the value of the specified XenStore entry.
      </p></dd><dt id="id-1.12.6.8.5.5.3.3"><span class="term"><code class="command">xenstore-exists</code><code class="option">xenstore_path</code>
     </span></dt><dd><p>
       Reports whether the specified XenStore path exists.
      </p></dd><dt id="id-1.12.6.8.5.5.3.4"><span class="term"><code class="command">xenstore-list</code><code class="option">xenstore_path</code>
     </span></dt><dd><p>
       Displays all the children entries of the specified XenStore
       path.
      </p></dd><dt id="id-1.12.6.8.5.5.3.5"><span class="term"><code class="command">xenstore-write</code><code class="option">path_to_xenstore_entry</code>
     </span></dt><dd><p>
       Updates the value of the specified XenStore entry.
      </p></dd><dt id="id-1.12.6.8.5.5.3.6"><span class="term"><code class="command">xenstore-rm</code><code class="option">xenstore_path</code>
     </span></dt><dd><p>
       Removes the specified XenStore entry or directory.
      </p></dd><dt id="id-1.12.6.8.5.5.3.7"><span class="term"><code class="command">xenstore-chmod</code><code class="option">xenstore_path</code><code class="option">mode</code>
     </span></dt><dd><p>
       Updates the read/write permission on the specified XenStore
       path.
      </p></dd><dt id="id-1.12.6.8.5.5.3.8"><span class="term"><code class="command">xenstore-control</code>
     </span></dt><dd><p>
       Sends a command to the <code class="systemitem">xenstored</code> back-end,
       such as triggering an integrity check.
      </p></dd></dl></div></section><section class="sect2" id="xenstore-vm" data-id-title="/vm"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">29.2.2 </span><span class="title-name"><code class="filename">/vm</code></span></span> <a title="Permalink" class="permalink" href="#xenstore-vm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xenstore.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="filename">/vm</code> path is indexed by the UUID of each
    VM Guest, and stores configuration information such as the number of
    virtual CPUs and the amount of allocated memory. There is a
    <code class="filename">/vm/&lt;uuid&gt;</code> directory for each
    VM Guest. To list the directory content, use
    <code class="command">xenstore-list</code>.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xenstore-list /vm
00000000-0000-0000-0000-000000000000
9b30841b-43bc-2af9-2ed3-5a649f466d79-1</pre></div><p>
    The first line of the output belongs to Dom0, and the second one to
    a running VM Guest. The following command lists all the entries
    related to the VM Guest:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xenstore-list /vm/9b30841b-43bc-2af9-2ed3-5a649f466d79-1
image
rtc
device
pool_name
shadow_memory
uuid
on_reboot
start_time
on_poweroff
bootloader_args
on_crash
vcpus
vcpu_avail
bootloader
name</pre></div><p>
    To read a value of an entry, for example the number of virtual CPUs
    dedicated to the VM Guest, use <code class="command">xenstore-read</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xenstore-read /vm/9b30841b-43bc-2af9-2ed3-5a649f466d79-1/vcpus
1</pre></div><p>
    A list of selected <code class="filename">/vm/&lt;uuid&gt;</code> entries
    follows:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.8.5.6.9.1"><span class="term"><code class="literal">uuid</code>
     </span></dt><dd><p>
       UUID of the VM Guest. It does not change during the migration
       process.
      </p></dd><dt id="id-1.12.6.8.5.6.9.2"><span class="term"><code class="literal">on_reboot</code>
     </span></dt><dd><p>
       Specifies whether to destroy or restart the VM Guest in response
       to a reboot request.
      </p></dd><dt id="id-1.12.6.8.5.6.9.3"><span class="term"><code class="literal">on_poweroff</code>
     </span></dt><dd><p>
       Specifies whether to destroy or restart the VM Guest in response
       to a halt request.
      </p></dd><dt id="id-1.12.6.8.5.6.9.4"><span class="term"><code class="literal">on_crash</code>
     </span></dt><dd><p>
       Specifies whether to destroy or restart the VM Guest in response
       to a crash.
      </p></dd><dt id="id-1.12.6.8.5.6.9.5"><span class="term"><code class="literal">vcpus</code>
     </span></dt><dd><p>
       Number of virtual CPUs allocated to the VM Guest.
      </p></dd><dt id="id-1.12.6.8.5.6.9.6"><span class="term"><code class="literal">vcpu_avail</code>
     </span></dt><dd><p>
       Bitmask of active virtual CPUs for the VM Guest. The bitmask has
       several bits equal to the value of <code class="literal">vcpus</code>, with
       a bit set for each online virtual CPU.
      </p></dd><dt id="id-1.12.6.8.5.6.9.7"><span class="term"><code class="literal">name</code>
     </span></dt><dd><p>
       The name of the VM Guest.
      </p></dd></dl></div><p>
    Regular VM Guests (not Dom0) use the
    <code class="filename">/vm/&lt;uuid&gt;/image</code> path:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xenstore-list /vm/9b30841b-43bc-2af9-2ed3-5a649f466d79-1/image
ostype
kernel
cmdline
ramdisk
dmargs
device-model
display</pre></div><p>
    An explanation of the used entries follows:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.8.5.6.13.1"><span class="term"><code class="literal">ostype</code>
     </span></dt><dd><p>
       The OS type of the VM Guest.
      </p></dd><dt id="id-1.12.6.8.5.6.13.2"><span class="term"><code class="literal">kernel</code>
     </span></dt><dd><p>
       The path on Dom0 to the kernel for the VM Guest.
      </p></dd><dt id="id-1.12.6.8.5.6.13.3"><span class="term"><code class="literal">cmdline</code>
     </span></dt><dd><p>
       The kernel command line for the VM Guest used when booting.
      </p></dd><dt id="id-1.12.6.8.5.6.13.4"><span class="term"><code class="literal">ramdisk</code>
     </span></dt><dd><p>
       The path on Dom0 to the RAM disk for the VM Guest.
      </p></dd><dt id="id-1.12.6.8.5.6.13.5"><span class="term"><code class="literal">dmargs</code>
     </span></dt><dd><p>
       Shows arguments passed to the QEMU process. If you look at the
       QEMU process with <code class="command">ps</code>, you should see the same
       arguments as in
       <code class="filename">/vm/&lt;uuid&gt;/image/dmargs</code>.
      </p></dd></dl></div></section><section class="sect2" id="id-1.12.6.8.5.7" data-id-title="/local/domain/domid"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">29.2.3 </span><span class="title-name"><code class="filename">/local/domain/&lt;domid&gt;</code></span></span> <a title="Permalink" class="permalink" href="#id-1.12.6.8.5.7">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xenstore.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This path is indexed by the running domain (VM Guest) ID, and
    contains information about the running VM Guest. Remember that the
    domain ID changes during VM Guest migration. The following entries
    are available:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.8.5.7.3.1"><span class="term"><code class="literal">vm</code>
     </span></dt><dd><p>
       The path of the <code class="filename">/vm</code> directory for this
       VM Guest.
      </p></dd><dt id="id-1.12.6.8.5.7.3.2"><span class="term"><code class="literal">on_reboot, on_poweroff, on_crash, name</code>
     </span></dt><dd><p>
       See identical options in <a class="xref" href="#xenstore-vm" title="29.2.2. /vm">Section 29.2.2, “<code class="filename">/vm</code>”</a>
      </p></dd><dt id="id-1.12.6.8.5.7.3.3"><span class="term"><code class="literal">domid</code>
     </span></dt><dd><p>
       Domain identifier for the VM Guest.
      </p></dd><dt id="id-1.12.6.8.5.7.3.4"><span class="term"><code class="literal">cpu</code>
     </span></dt><dd><p>
       The current CPU to which the VM Guest is pinned.
      </p></dd><dt id="id-1.12.6.8.5.7.3.5"><span class="term"><code class="literal">cpu_weight</code>
     </span></dt><dd><p>
       The weight assigned to the VM Guest for scheduling purposes.
       Higher weights use the physical CPUs more often.
      </p></dd></dl></div><p>
    Apart from the individual entries described above, there are also
    several subdirectories under
    <code class="filename">/local/domain/&lt;domid&gt;</code>, containing specific
    entries. To see all entries available, refer to
    <a class="link" href="http://wiki.xen.org/wiki/XenStore_Reference" target="_blank">XenStore
    Reference</a>.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.8.5.7.5.1"><span class="term"><code class="literal">/local/domain/&lt;domid&gt;/memory</code>
     </span></dt><dd><p>
       Contains memory information.
       <code class="literal">/local/domain/&lt;domid&gt;/memory/target</code>
       contains target memory size for the VM Guest (in kilobytes).
      </p></dd><dt id="id-1.12.6.8.5.7.5.2"><span class="term"><code class="literal">/local/domain/&lt;domid&gt;/console</code>
     </span></dt><dd><p>
       Contains information about a console used by the VM Guest.
      </p></dd><dt id="id-1.12.6.8.5.7.5.3"><span class="term"><code class="literal">/local/domain/&lt;domid&gt;/backend</code>
     </span></dt><dd><p>
       Contains information about all back-end devices used by the
       VM Guest. The path has subdirectories of its own.
      </p></dd><dt id="id-1.12.6.8.5.7.5.4"><span class="term"><code class="literal">/local/domain/&lt;domid&gt;/device</code>
     </span></dt><dd><p>
       Contains information about the front-end devices for the
       VM Guest.
      </p></dd><dt id="id-1.12.6.8.5.7.5.5"><span class="term"><code class="literal">/local/domain/&lt;domid&gt;/device-misc</code>
     </span></dt><dd><p>
       Contains miscellaneous information about devices.
      </p></dd><dt id="id-1.12.6.8.5.7.5.6"><span class="term"><code class="literal">/local/domain/&lt;domid&gt;/store</code>
     </span></dt><dd><p>
       Contains information about the VM Guest's store.
      </p></dd></dl></div></section></section></section><section class="chapter" id="cha-xen-ha" data-id-title="Xen as a high-availability virtualization host"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">30 </span><span class="title-name">Xen as a high-availability virtualization host</span></span> <a title="Permalink" class="permalink" href="#cha-xen-ha">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_ha_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Setting up two Xen hosts as a failover system has several advantages
  compared to a setup where every server runs on dedicated hardware.
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Failure of a single server does not cause major interruption of the
    service.
   </p></li><li class="listitem"><p>
    A single big machine is normally way cheaper than multiple smaller
    machines.
   </p></li><li class="listitem"><p>
    Adding new servers as needed is a trivial task.
   </p></li><li class="listitem"><p>
    The usage of the server is improved, which has positive effects on
    the power consumption of the system.
   </p></li></ul></div><p>
  The setup of migration for Xen hosts is described in
  <a class="xref" href="#sec-xen-manage-migrate" title="28.3. Migrating Xen VM Guest systems">Section 28.3, “Migrating Xen VM Guest systems”</a>. In the following, several
  typical scenarios are described.
 </p><section class="sect1" id="sec-xen-ha-remote-storage" data-id-title="Xen HA with remote storage"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">30.1 </span><span class="title-name">Xen HA with remote storage</span></span> <a title="Permalink" class="permalink" href="#sec-xen-ha-remote-storage">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_ha_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Xen can directly provide several remote block devices to the
   respective Xen guest systems. These include iSCSI, NPIV, and NBD.
   All of these may be used to do live migrations. When a storage system is
   already in place, first try to use the same device type you already used
   in the network.
  </p><p>
   If the storage system cannot be used directly but provides a possibility
   to offer the needed space over NFS, it is also possible to create image
   files on NFS. If NFS is available on all Xen host
   systems, this method also allows live migrations of Xen guests.
  </p><p>
   When setting up a new system, one of the main considerations is whether a
   dedicated storage area network should be implemented. The following
   possibilities are available:
  </p><div class="table" id="tab-xen-remote-storage" data-id-title="Xen remote storage"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 30.1: </span><span class="title-name">Xen remote storage </span></span><a title="Permalink" class="permalink" href="#tab-xen-remote-storage">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_ha_setup.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Method
       </p>
      </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Complexity
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Comments
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Ethernet
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        low
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Note that all block device traffic goes over the same Ethernet
        interface as the network traffic. This may be limiting the
        performance of the guest.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Ethernet dedicated to storage.
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        medium
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Running the storage traffic over a dedicated Ethernet interface may
        eliminate a bottleneck on the server side. However, planning your
        own network with your own IP address range and possibly a VLAN
        dedicated to storage requires numerous considerations.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        NPIV
       </p>
      </td><td style="border-right: 1px solid ; ">
       <p>
        high
       </p>
      </td><td>
       <p>
        NPIV is a method to virtualize Fibre channel connections. This is
        available with adapters that support a data rate of at least 4
        Gbit/s and allows the setup of complex storage systems.
       </p>
      </td></tr></tbody></table></div></div><p>
   Typically, a 1 Gbit/s Ethernet device can fully use a typical
   hard disk or storage system. When using very fast storage systems, such
   an Ethernet device will probably limit the speed of the system.
  </p></section><section class="sect1" id="sec-xen-ha-local-storage" data-id-title="Xen HA with local storage"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">30.2 </span><span class="title-name">Xen HA with local storage</span></span> <a title="Permalink" class="permalink" href="#sec-xen-ha-local-storage">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_ha_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For space or budget reasons, it may be necessary to rely on storage that
   is local to the Xen host systems. To still maintain the possibility
   of live migrations, it is necessary to build block devices that are
   mirrored to both Xen hosts. The software that allows this is called
   Distributed Replicated Block Device (DRBD).
  </p><p>
   If a system that uses DRBD to mirror the block devices or files between
   two Xen hosts should be set up, both hosts should use the identical
   hardware. If one of the hosts has slower hard disks, both hosts will
   suffer from this limitation.
  </p><p>
   During the setup, each of the required block devices should use its own
   DRBD device. The setup of such a system is quite a complex task.
  </p></section><section class="sect1" id="sec-xen-ha-private-bridge" data-id-title="Xen HA and private bridges"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">30.3 </span><span class="title-name">Xen HA and private bridges</span></span> <a title="Permalink" class="permalink" href="#sec-xen-ha-private-bridge">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_ha_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When using several guest systems that need to communicate between each
   other, it is possible to do this over the regular interface. However, for
   security reasons it may be advisable to create a bridge that is only
   connected to guest systems.
  </p><p>
   In an HA environment that also should support live migrations, such a
   private bridge must be connected to the other Xen hosts. This is possible
   by using dedicated physical Ethernet devices and a dedicated network.
  </p><p>
   A different implementation method is using VLAN interfaces. In that case,
   all the traffic goes over the regular Ethernet interface. However, the
   VLAN interface does not get the regular traffic, because only the VLAN
   packets that are tagged for the correct VLAN are forwarded.
  </p><p>
   For more information about the setup of a VLAN interface see
   <a class="xref" href="#sec-xen-net-vlan" title="9.1.1.4. Using VLAN interfaces">Section 9.1.1.4, “Using VLAN interfaces”</a>.
  </p></section></section><section class="chapter" id="pv-to-fv" data-id-title="Xen: converting a paravirtual (PV) guest into a fully virtual (FV/HVM) guest"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">31 </span><span class="title-name">Xen: converting a paravirtual (PV) guest into a fully virtual (FV/HVM) guest</span></span> <a title="Permalink" class="permalink" href="#pv-to-fv">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/pv2fv.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This chapter explains how to convert a Xen paravirtual machine into a Xen
  fully virtualized machine.
 </p><div class="procedure" id="id-1.12.6.10.3" data-id-title="Guest side"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 31.1: </span><span class="title-name">Guest side </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.10.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/pv2fv.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
   In order to start the guest in FV mode, you need to run the following steps
   inside the guest.
  </p><ol class="procedure" type="1"><li class="step"><p>
    Prior to converting the guest, apply all pending patches and reboot the
    guest.
   </p></li><li class="step"><p>
    FV machines use the <code class="literal">-default</code> kernel. If this kernel is
    not already installed, install the <code class="literal">kernel-default</code>
    package (while running in PV mode).
   </p></li><li class="step"><p>
    PV machines typically use disk names such as <code class="literal">vda*</code>. These
    names must be changed to the FV <code class="literal">hd*</code> syntax. This change
    must be done in the following files:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="filename">/etc/fstab</code>
     </p></li><li class="listitem"><p>
      <code class="filename">/boot/grub/menu.lst</code> (SLES 11 only)
     </p></li><li class="listitem"><p>
      <code class="filename">/boot/grub*/device.map</code>
     </p></li><li class="listitem"><p>
      <code class="filename">/etc/sysconfig/bootloader</code>
     </p></li><li class="listitem"><p>
      <code class="filename">/etc/default/grub</code> (SLES 12 and 15 only)
     </p></li></ul></div><div id="id-1.12.6.10.3.5.3" data-id-title="Prefer UUIDs" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Prefer UUIDs</div><p>
     You should use UUIDs or logical volumes within your
     <code class="filename">/etc/fstab</code>. Using UUIDs simplifies the use of attached
     network storage, multipathing, and virtualization. To find the UUID of
     your disk, use the command <code class="command">blkid</code>.
    </p></div></li><li class="step"><p>
    To avoid any error regenerating the <code class="filename">initrd</code> with the required modules, you
    can create a symbolic link from <code class="filename">/dev/hda2</code> to
    <code class="filename">/dev/xvda2</code> etc. by using the <code class="command">ln</code>:
   </p><div class="verbatim-wrap"><pre class="screen">ln -sf /dev/xvda2 /dev/hda2
ln -sf /dev/xvda1 /dev/hda1
.....</pre></div></li><li class="step"><p>
    PV and FV machines use different disk and network driver modules. These FV
    modules must be added to the initrd manually. The expected modules are
    <code class="literal">xen-vbd</code> (for disk) and <code class="literal">xen-vnif</code> (for
    network). These are the only PV drivers for a fully virtualized VM Guest.
    All other modules, such as <code class="literal">ata_piix</code>,
    <code class="literal">ata_generic</code> and <code class="literal">libata</code>, should be
    added automatically.
   </p><div id="id-1.12.6.10.3.7.2" data-id-title="Adding modules to the initrd" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Adding modules to the initrd</div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       On SLES 11, you can add modules to the
       <code class="literal">INITRD_MODULES</code> line in the
       <code class="filename">/etc/sysconfig/kernel</code> file. For example:
      </p><div class="verbatim-wrap"><pre class="screen">INITRD_MODULES="xen-vbd xen-vnif"</pre></div><p>
       Run <code class="command">mkinitrd</code> to build a new initrd containing the
       modules.
      </p></li><li class="listitem"><p>
       On SLES 12 and 15, open or create
       <code class="filename">/etc/dracut.conf.d/10-virt.conf</code> and add the modules
       with <code class="literal">force_drivers</code> by adding a line as in the example
       below (mind the leading whitespace):
      </p><div class="verbatim-wrap"><pre class="screen">force_drivers+=" xen-vbd xen-vnif"</pre></div><p>
       Run <code class="command">dracut -f --kver
       <em class="replaceable">KERNEL_VERSION</em>-default</code> to build a
       new initrd (for the default version of the kernel) that contains the
       required modules.
      </p><p><span class="formalpara-title">Find your kernel version. </span>
        Use the <code class="command">uname -r</code> command to get the current version
        used on your system.
       </p></li></ul></div></div></li><li class="step"><p>
    Before shutting down the guest, set the default boot parameter to the
    <code class="literal">-default</code> kernel using <code class="command">yast
    bootloader</code>.
   </p></li><li class="step"><p>
    Under <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 11, if you have an X server running on your guest, you
    need to adjust the <code class="filename">/etc/X11/xorg.conf</code> file in order to
    adjust the X driver. Search for <code class="literal">fbdev</code> and change to
    <code class="literal">cirrus</code>.
   </p><div class="verbatim-wrap"><pre class="screen">Section "Device"
          Driver       "cirrus"
          ......
          EndSection</pre></div><div id="id-1.12.6.10.3.9.3" data-id-title="SUSE Linux Enterprise Server 12/15 and Xorg" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 12/15 and Xorg</div><p>
     Under <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 12/15, Xorg will automatically adjust the driver
     needed to be able to get a working X server.
    </p></div></li><li class="step"><p>
    Shut down the guest.
   </p></li></ol></div></div><div class="procedure" id="id-1.12.6.10.4" data-id-title="Host side"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 31.2: </span><span class="title-name">Host side </span></span><a title="Permalink" class="permalink" href="#id-1.12.6.10.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/pv2fv.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
   The following steps explain the action that you need to perform on the host.
  </p><ol class="procedure" type="1"><li class="step"><p>
    To start the guest in FV mode, the configuration of the VM must be modified
    to match an FV configuration. Editing the configuration of the VM can
    easily be done using <code class="command">virsh edit [DOMAIN]</code>. The following
    changes are recommended:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Make sure the machine, the type, and the <code class="literal">loader</code> entries
      in the OS section are changed from <code class="literal">xenpv</code> to
      <code class="literal">xenfv</code>. The updated OS section should look similar to:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;os&gt;
          &lt;type arch='x86_64' machine='xenfv'&gt;hvm&lt;/type&gt;
          &lt;loader&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
          &lt;boot dev='hd'/&gt;
&lt;/os&gt;</pre></div></li><li class="listitem"><p>
      In the OS section, remove anything that is specific to PV guests:
     </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><div class="verbatim-wrap"><pre class="screen">&lt;bootloader&gt;pygrub&lt;/bootloader&gt;</pre></div></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen">&lt;kernel&gt;/usr/lib/grub2/x86_64-xen/grub.xen&lt;/kernel&gt;</pre></div></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen">&lt;cmdline&gt;xen-fbfront.video=4,1024,768&lt;/cmdline&gt;</pre></div></li></ul></div></li><li class="listitem"><p>
      In the devices section, add the qemu emulator as:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;emulator&gt;/usr/lib/xen/bin/qemu-system-i386&lt;/emulator&gt;</pre></div></li><li class="listitem"><p>
      Update the disk configuration so the target device and bus use the FV
      syntax. This requires replacing the <code class="literal">xen</code> disk bus with
      <code class="literal">ide</code>, and the <code class="literal">vda</code> target device with
      <code class="literal">hda</code>. The changes should look similar to:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;target dev='hda' bus='ide'/&gt;</pre></div></li><li class="listitem"><p>
      Change the bus for the mouse and keyboard from <code class="literal">xen</code> to
      <code class="literal">ps2</code>. Also add a new USB tablet device:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;input type='mouse' bus='ps2'/&gt;
          &lt;input type='keyboard' bus='ps2'/&gt;
&lt;input type='tablet' bus='usb'/&gt;</pre></div></li><li class="listitem"><p>
      Change the console target type from <code class="literal">xen</code> to
      <code class="literal">serial</code>:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;console type='pty'&gt;
          &lt;target type='serial' port='0'/&gt;
&lt;/console&gt;</pre></div></li><li class="listitem"><p>
      Change the video configuration from <code class="literal">xen</code> to
      <code class="literal">cirrus</code>, with 8 MB of VRAM:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;video&gt;
          &lt;model type='cirrus' vram='8192' heads='1' primary='yes'/&gt;
&lt;/video&gt;</pre></div></li><li class="listitem"><p>
      If desired, add <code class="literal">acpi</code> and <code class="literal">apic</code> to
      the features of the VM:
     </p><div class="verbatim-wrap"><pre class="screen">&lt;features&gt;
          &lt;acpi/&gt;
          &lt;apic/&gt;
&lt;/features&gt;</pre></div></li></ul></div></li><li class="step"><p>
    Start the guest (using <code class="command">virsh</code> or
    <code class="command">virt-manager</code>). If the guest is running kernel-default
    (as verified through <code class="command">uname -a</code>), the machine is running
    in Fully Virtual mode.
   </p></li></ol></div></div><div id="id-1.12.6.10.5" data-id-title="guestfs-tools" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: guestfs-tools</div><p>
   To script this process, or work on disk images directly, you can use the
   guestfs-tools suite (see <a class="xref" href="#sec-guestfs-tools" title="20.3. Guestfs tools">Section 20.3, “Guestfs tools”</a> for more
   information). Numerous tools exist there to help modify disk images.
  </p></div></section></div><div class="part" id="part-virt-qemu" data-id-title="Managing virtual machines with QEMU"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part V </span><span class="title-name">Managing virtual machines with QEMU </span></span><a title="Permalink" class="permalink" href="#part-virt-qemu">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/book_virtualization.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-qemu-overview"><span class="title-number">32 </span><span class="title-name">QEMU overview</span></a></span></li><dd class="toc-abstract"><p>QEMU is a fast, cross-platform open source machine emulator which can emulate many hardware architectures. QEMU lets you run a complete unmodified operating system (VM Guest) on top of your existing system (VM Host Server). You can also use QEMU for debugging purposes—you can easily stop your runnin…</p></dd><li><span class="chapter"><a href="#cha-qemu-host"><span class="title-number">33 </span><span class="title-name">Setting up a KVM VM Host Server</span></a></span></li><dd class="toc-abstract"><p>
  This section documents how to set up and use <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15 SP3</span></span> as
  a QEMU-KVM based virtual machine host.
 </p></dd><li><span class="chapter"><a href="#cha-qemu-guest-inst"><span class="title-number">34 </span><span class="title-name">Guest installation</span></a></span></li><dd class="toc-abstract"><p>
  The <code class="systemitem">libvirt</code>-based tools such as
  <code class="command">virt-manager</code> and <code class="command">virt-install</code>
  offer convenient interfaces to set up and
  manage virtual machines. They act as a kind of wrapper for the
  <code class="command">qemu-system-ARCH</code>command. However, it is also possible to
  use <code class="command">qemu-system-ARCH</code> directly without using
  <code class="systemitem">libvirt</code>-based tools.
 </p></dd><li><span class="chapter"><a href="#cha-qemu-running"><span class="title-number">35 </span><span class="title-name">Running virtual machines with qemu-system-ARCH</span></a></span></li><dd class="toc-abstract"><p>Once you have a virtual disk image ready (for more information on disk images, see Section 34.2, “Managing disk images with qemu-img”), it is time to start the related virtual machine. Section 34.1, “Basic installation with qemu-system-ARCH” introduced simple commands to install and run a VM Guest. …</p></dd><li><span class="chapter"><a href="#cha-qemu-monitor"><span class="title-number">36 </span><span class="title-name">Virtual machine administration using QEMU monitor</span></a></span></li><dd class="toc-abstract"><p>When a virtual machine is invoked by the qemu-system-ARCH command, for example qemu-system-x86_64, a monitor console is provided for performing interaction with the user. Using the commands available in the monitor console, it is possible to inspect the running operating system, change removable med…</p></dd></ul></div><section class="chapter" id="cha-qemu-overview" data-id-title="QEMU overview"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">32 </span><span class="title-name">QEMU overview</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-overview">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_overview.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  QEMU is a fast, cross-platform open source machine emulator which can
  emulate many hardware architectures. QEMU lets you run a complete
  unmodified operating system (VM Guest) on top of your existing system
  (VM Host Server).  You can also use QEMU for debugging purposes—you can
  easily stop your running virtual machine, inspect its state, and save and
  restore it later.
 </p><p>
  QEMU mainly consists of the following parts:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Processor emulator.
   </p></li><li class="listitem"><p>
    Emulated devices, such as graphic card, network card, hard disks, or mouse.
   </p></li><li class="listitem"><p>
    Generic devices used to connect the emulated devices to the related host
    devices.
   </p></li><li class="listitem"><p>
    Debugger.
   </p></li><li class="listitem"><p>
    User interface used to interact with the emulator.
   </p></li></ul></div><p>
  QEMU is central to KVM and Xen Virtualization, where it
  provides the general machine emulation. Xen's usage of QEMU is
  somewhat hidden from the user, while KVM's usage exposes most
  QEMU features transparently. If the VM Guest hardware
  architecture is the same as the VM Host Server's architecture, QEMU can
  take advantage of the KVM acceleration (SUSE only supports
  QEMU with the KVM acceleration loaded).
 </p><p>
  Apart from providing a core virtualization infrastructure and
  processor-specific drivers, QEMU also provides an
  architecture-specific user space program for managing VM Guests.
  Depending on the architecture this program is one of:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    <code class="command">qemu-system-i386</code>
   </p></li><li class="listitem"><p>
    <code class="command">qemu-system-s390x</code>
   </p></li><li class="listitem"><p>
    <code class="command">qemu-system-x86_64</code>
   </p></li><li class="listitem"><p>
    <code class="command">qemu-system-aarch64</code>
   </p></li></ul></div><p>
  In the following this command is called <code class="command">qemu-system-<em class="replaceable">ARCH</em></code>; in
  examples the <code class="command">qemu-system-x86_64</code> command is used.
 </p></section><section class="chapter" id="cha-qemu-host" data-id-title="Setting up a KVM VM Host Server"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">33 </span><span class="title-name">Setting up a KVM VM Host Server</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-host">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This section documents how to set up and use <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15 SP3</span></span> as
  a QEMU-KVM based virtual machine host.
 </p><div id="id-1.12.7.3.4" data-id-title="Resources" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Resources</div><p>
   In general, the virtual guest system needs the same hardware resources as if
   it were installed on a physical machine. The more guests you plan to run on
   the host system, the more hardware resources—CPU, disk, memory, and
   network—you need to add to the VM Host Server.
  </p></div><section class="sect1" id="kvm-host-cpu" data-id-title="CPU support for virtualization"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">33.1 </span><span class="title-name">CPU support for virtualization</span></span> <a title="Permalink" class="permalink" href="#kvm-host-cpu">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To run KVM, your CPU must support virtualization, and virtualization needs
   to be enabled in BIOS. The file <code class="filename">/proc/cpuinfo</code> includes
   information about your CPU features.
  </p><p>
   To find out whether your system supports virtualization, see
   <a class="xref" href="#sec-kvm-requires-hardware" title="7.1.1. KVM hardware requirements">Section 7.1.1, “KVM hardware requirements”</a>.
  </p></section><section class="sect1" id="kvm-host-soft" data-id-title="Required software"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">33.2 </span><span class="title-name">Required software</span></span> <a title="Permalink" class="permalink" href="#kvm-host-soft">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The KVM host requires several packages to be installed. To install all
   necessary packages, do the following:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Verify that the <span class="package">yast2-vm</span> package is installed. This package
     is YaST's configuration tool that simplifies the installation of virtualization
     hypervisors.
    </p></li><li class="step"><p>
     Run <span class="guimenu">YaST</span> › <span class="guimenu">
     Virtualization</span> › <span class="guimenu">Install Hypervisor and
     Tools</span>.
    </p><div class="figure" id="id-1.12.7.3.6.3.2.2"><div class="figure-contents"><div class="mediaobject"><a href="images/yast2_hypervisors.png"><img src="images/yast2_hypervisors.png" width="75%" alt="Installing the KVM hypervisor and tools" title="Installing the KVM hypervisor and tools"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 33.1: </span><span class="title-name">Installing the KVM hypervisor and tools </span></span><a title="Permalink" class="permalink" href="#id-1.12.7.3.6.3.2.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
     Select <span class="guimenu">KVM server</span> and preferably also <span class="guimenu">KVM
     tools</span>, and confirm with <span class="guimenu">Accept</span>.
    </p></li><li class="step"><p>
     During the installation process, you can optionally let YaST create a
     <span class="guimenu">Network Bridge</span> for you automatically. If you do not
     plan to dedicate an additional physical network card to your virtual
     guests, network bridge is a standard way to connect the guest machines to
     the network.
    </p><div class="figure" id="id-1.12.7.3.6.3.4.2"><div class="figure-contents"><div class="mediaobject"><a href="images/yast2_netbridge.png"><img src="images/yast2_netbridge.png" width="75%" alt="Network bridge" title="Network bridge"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 33.2: </span><span class="title-name">Network bridge </span></span><a title="Permalink" class="permalink" href="#id-1.12.7.3.6.3.4.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
     After all the required packages are installed (and new network setup
     activated), try to load the KVM kernel module relevant for your CPU
     type—<code class="systemitem">kvm-intel</code> or
     <code class="systemitem">kvm-amd</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>modprobe kvm-intel</pre></div><p>
     Check if the module is loaded into memory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>lsmod | grep kvm
kvm_intel              64835  6
kvm                   411041  1 kvm_intel</pre></div><p>
     Now the KVM host is ready to serve KVM VM Guests. For more
     information, see <a class="xref" href="#cha-qemu-running" title="Chapter 35. Running virtual machines with qemu-system-ARCH">Chapter 35, <em>Running virtual machines with qemu-system-ARCH</em></a>.
    </p></li></ol></div></div></section><section class="sect1" id="kvm-host-virtio" data-id-title="KVM host-specific features"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">33.3 </span><span class="title-name">KVM host-specific features</span></span> <a title="Permalink" class="permalink" href="#kvm-host-virtio">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can improve the performance of KVM-based VM Guests by letting them
   fully use specific features of the VM Host Server's hardware
   (<span class="emphasis"><em>paravirtualization</em></span>). This section introduces
   techniques to make the guests access the physical host's hardware
   directly—without the emulation layer—to make the most use of it.
  </p><div id="id-1.12.7.3.7.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    Examples included in this section assume basic knowledge of the
    <code class="command">qemu-system-<em class="replaceable">ARCH</em></code> command line
    options. For more information, see <a class="xref" href="#cha-qemu-running" title="Chapter 35. Running virtual machines with qemu-system-ARCH">Chapter 35, <em>Running virtual machines with qemu-system-ARCH</em></a>.
   </p></div><section class="sect2" id="kvm-virtio-scsi" data-id-title="Using the host storage with virtio-scsi"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">33.3.1 </span><span class="title-name">Using the host storage with <code class="systemitem">virtio-scsi</code></span></span> <a title="Permalink" class="permalink" href="#kvm-virtio-scsi">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="systemitem">virtio-scsi</code> is an advanced storage stack for
    KVM. It replaces the former <code class="systemitem">virtio-blk</code> stack for
    SCSI devices pass-through. It has several advantages over
    <code class="systemitem">virtio-blk</code>:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.3.7.4.3.1"><span class="term">Improved scalability</span></dt><dd><p>
       KVM guests have a limited number of PCI controllers, which results in
       a limited number of possibly attached devices.
       <code class="systemitem">virtio-scsi</code> solves this limitation by grouping
       multiple storage devices on a single controller. Each device on a
       <code class="systemitem">virtio-scsi</code> controller is represented as a
       logical unit, or <span class="emphasis"><em>LUN</em></span>.
      </p></dd><dt id="id-1.12.7.3.7.4.3.2"><span class="term">Standard command set</span></dt><dd><p>
       <code class="systemitem">virtio-blk</code> uses a small set of commands that
       need to be known to both the <code class="systemitem">virtio-blk</code> driver
       and the virtual machine monitor, and so introducing a new command
       requires updating both the driver and the monitor.
      </p><p>
       By comparison, <code class="systemitem">virtio-scsi</code> does not define
       commands, but rather a transport protocol for these commands following
       the industry-standard SCSI specification. This approach is shared with
       other technologies, such as Fibre Channel, ATAPI, and USB devices.
      </p></dd><dt id="id-1.12.7.3.7.4.3.3"><span class="term">Device naming</span></dt><dd><p>
       <code class="systemitem">virtio-blk</code> devices are presented inside the
       guest as <code class="filename">/dev/vd<em class="replaceable">X</em></code>, which
       is different from device names in physical systems and may cause
       migration problems.
      </p><p>
       <code class="systemitem">virtio-scsi</code> keeps the device names identical to
       those on physical systems, making the virtual machines easily
       relocatable.
      </p></dd><dt id="id-1.12.7.3.7.4.3.4"><span class="term">SCSI device pass-through</span></dt><dd><p>
       For virtual disks backed by a whole LUN on the host, it is preferable
       for the guest to send SCSI commands directly to the LUN (pass-through).
       This is limited in <code class="systemitem">virtio-blk</code>, as guests need
       to use the virtio-blk protocol instead of SCSI command pass-through,
       and, moreover, it is not available for Windows guests.
       <code class="systemitem">virtio-scsi</code> natively removes these limitations.
      </p></dd></dl></div><section class="sect3" id="id-1.12.7.3.7.4.4" data-id-title="virtio-scsi usage"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">33.3.1.1 </span><span class="title-name"><code class="systemitem">virtio-scsi</code> usage</span></span> <a title="Permalink" class="permalink" href="#id-1.12.7.3.7.4.4">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     KVM supports the SCSI pass-through feature with the
     <code class="systemitem">virtio-scsi-pci</code> device:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>qemu-system-x86_64 [...] \
-device virtio-scsi-pci,id=scsi</pre></div></section></section><section class="sect2" id="kvm-qemu-vnet" data-id-title="Accelerated networking with vhost-net"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">33.3.2 </span><span class="title-name">Accelerated networking with <code class="systemitem">vhost-net</code></span></span> <a title="Permalink" class="permalink" href="#kvm-qemu-vnet">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="systemitem">vhost-net</code> module is used to accelerate KVM's
    paravirtualized network drivers. It provides better latency and greater
    network throughput. Use the <code class="literal">vhost-net</code> driver by starting
    the guest with the following example command line:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>qemu-system-x86_64 [...] \
-netdev tap,id=guest0,vhost=on,script=no \
-net nic,model=virtio,netdev=guest0,macaddr=00:16:35:AF:94:4B</pre></div><p>
    Note that <code class="literal">guest0</code> is an identification string of the
    vhost-driven device.
   </p></section><section class="sect2" id="kvm-qemu-multiqueue" data-id-title="Scaling network performance with multiqueue virtio-net"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">33.3.3 </span><span class="title-name">Scaling network performance with multiqueue virtio-net</span></span> <a title="Permalink" class="permalink" href="#kvm-qemu-multiqueue">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As the number of virtual CPUs increases in VM Guests, QEMU offers a way
    of improving the network performance using <span class="emphasis"><em>multiqueue</em></span>.
    Multiqueue virtio-net scales the network performance by allowing VM Guest
    virtual CPUs to transfer packets in parallel. Multiqueue support is
    required on both the VM Host Server and VM Guest sides.
   </p><div id="id-1.12.7.3.7.6.3" data-id-title="Performance benefit" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Performance benefit</div><p>
     The multiqueue virtio-net solution is most beneficial in the following
     cases:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       Network traffic packets are large.
      </p></li><li class="listitem"><p>
       VM Guest has many connections active at the same time, mainly between
       the guest systems, or between the guest and the host, or between the
       guest and an external system.
      </p></li><li class="listitem"><p>
       The number of active queues is equal to the number of virtual CPUs in
       the VM Guest.
      </p></li></ul></div></div><div id="id-1.12.7.3.7.6.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     While multiqueue virtio-net increases the total network throughput, it
     increases CPU consumption as it uses of the virtual CPU's power.
    </p></div><div class="procedure" id="kvm-qemu-mq-enable" data-id-title="How to enable multiqueue virtio-net"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 33.1: </span><span class="title-name">How to enable multiqueue virtio-net </span></span><a title="Permalink" class="permalink" href="#kvm-qemu-mq-enable">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
     The following procedure lists important steps to enable the multiqueue
     feature with <code class="command">qemu-system-ARCH</code>. It assumes that a tap
     network device with multiqueue capability (supported since kernel version
     3.8) is set up on the VM Host Server.
    </p><ol class="procedure" type="1"><li class="step"><p>
      In <code class="command">qemu-system-ARCH</code>, enable multiqueue for the tap
      device:
     </p><div class="verbatim-wrap"><pre class="screen">-netdev tap,vhost=on,queues=<em class="replaceable">2*N</em></pre></div><p>
      where <code class="literal">N</code> stands for the number of queue pairs.
     </p></li><li class="step"><p>
      In <code class="command">qemu-system-ARCH</code>, enable multiqueue and specify
      MSI-X (Message Signaled Interrupt) vectors for the virtio-net-pci device:
     </p><div class="verbatim-wrap"><pre class="screen">-device virtio-net-pci,mq=on,vectors=<em class="replaceable">2*N+2</em></pre></div><p>
      where the formula for the number of MSI-X vectors results from: N vectors
      for TX (transmit) queues, N for RX (receive) queues, one for
      configuration purposes, and one for possible VQ (vector quantization)
      control.
     </p></li><li class="step"><p>
      In VM Guest, enable multiqueue on the relevant network interface
      (<code class="literal">eth0</code> in this example):
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ethtool -L eth0 combined 2*N</pre></div></li></ol></div></div><p>
    The resulting <code class="command">qemu-system-ARCH</code> command line will look
    similar to the following example:
   </p><div class="verbatim-wrap"><pre class="screen">qemu-system-x86_64 [...] -netdev tap,id=guest0,queues=8,vhost=on \
-device virtio-net-pci,netdev=guest0,mq=on,vectors=10</pre></div><p>
    Note that the <code class="literal">id</code> of the network device
    (<code class="literal">guest0</code> ) needs to be identical for both options.
   </p><p>
    Inside the running VM Guest, specify the following command with <code class="systemitem">root</code>
    privileges:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ethtool -L eth0 combined 8</pre></div><p>
    Now the guest system networking uses the multiqueue support from the
    <code class="command">qemu-system-ARCH</code> hypervisor.
   </p></section><section class="sect2" id="kvm-vfio" data-id-title="VFIO: secure direct access to devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">33.3.4 </span><span class="title-name">VFIO: secure direct access to devices</span></span> <a title="Permalink" class="permalink" href="#kvm-vfio">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Directly assigning a PCI device to a VM Guest (PCI pass-through) avoids
    performance issues caused by avoiding any emulation in performance-critical
    paths. VFIO replaces the traditional KVM PCI Pass-Through device assignment. A
    prerequisite for this feature is a VM Host Server configuration as described in
    <a class="xref" href="#ann-vt-io-require" title="Important: Requirements for VFIO and SR-IOV">Important: Requirements for VFIO and SR-IOV</a>.
   </p><p>
    To be able to assign a PCI device via VFIO to a VM Guest, you need to find
    out which IOMMU Group it belongs to. The
    <a class="xref" href="#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a> (input/output memory
    management unit that connects a direct memory access-capable I/O bus to the
    main memory) API supports the notion of groups. A group is a set of devices
    that can be isolated from all other devices in the system. Groups are
    therefore the unit of ownership used by <a class="xref" href="#vt-io-vfio">VFIO</a>.
   </p><div class="procedure" id="id-1.12.7.3.7.7.4" data-id-title="Assigning a PCI device to a VM Guest via VFIO"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 33.2: </span><span class="title-name">Assigning a PCI device to a VM Guest via VFIO </span></span><a title="Permalink" class="permalink" href="#id-1.12.7.3.7.7.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Identify the host PCI device to assign to the guest.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lspci -nn
[...]
00:10.0 Ethernet controller [0200]: Intel Corporation 82576 \
Virtual Function [8086:10ca] (rev 01)
[...]</pre></div><p>
      Note down the device ID (<code class="literal">00:10.0</code> in this case) and the
      vendor ID (<code class="literal">8086:10ca</code>).
     </p></li><li class="step"><p>
      Find the IOMMU group of this device:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> readlink /sys/bus/pci/devices/0000\:00\:10.0/iommu_group
../../../kernel/iommu_groups/20</pre></div><p>
      The IOMMU group for this device is <code class="literal">20</code>. Now you can
      check the devices belonging to the same IOMMU group:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ls -l /sys/bus/pci/devices/0000\:01\:10.0/iommu_group/devices/
[...] 0000:00:1e.0 -&gt; ../../../../devices/pci0000:00/0000:00:1e.0
[...] 0000:01:10.0 -&gt; ../../../../devices/pci0000:00/0000:00:1e.0/0000:01:10.0
[...] 0000:01:10.1 -&gt; ../../../../devices/pci0000:00/0000:00:1e.0/0000:01:10.1</pre></div></li><li class="step"><p>
      Unbind the device from the device driver:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> echo "0000:01:10.0" &gt; /sys/bus/pci/devices/0000\:01\:10.0/driver/unbind</pre></div></li><li class="step"><p>
      Bind the device to the vfio-pci driver using the vendor ID from step 1:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> echo "8086 153a" &gt; /sys/bus/pci/drivers/vfio-pci/new_id</pre></div><p>
      A new device
      <code class="filename">/dev/vfio/<em class="replaceable">IOMMU_GROUP</em></code>
      will be created as a result, <code class="filename">/dev/vfio/20</code> in this
      case.
     </p></li><li class="step"><p>
      Change the ownership of the newly created device:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> chown qemu.qemu /dev/vfio/<em class="replaceable">DEVICE</em></pre></div></li><li class="step"><p>
      Now run the VM Guest with the PCI device assigned.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-<em class="replaceable">ARCH</em> [...] -device
     vfio-pci,host=00:10.0,id=<em class="replaceable">ID</em></pre></div></li></ol></div></div><div id="id-1.12.7.3.7.7.5" data-id-title="No hotplugging" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: No hotplugging</div><p>
     As of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15 SP3</span></span>, hotplugging of PCI devices passed to a
     VM Guest via VFIO is not supported.
    </p></div><p>
    You can find more detailed information on the <a class="xref" href="#vt-io-vfio">VFIO</a>
    driver in the <code class="filename">/usr/src/linux/Documentation/vfio.txt</code>
    file (package <code class="systemitem">kernel-source</code> needs to be
    installed).
   </p></section><section class="sect2" id="kvm-qemu-virtfs" data-id-title="VirtFS: sharing directories between host and guests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">33.3.5 </span><span class="title-name">VirtFS: sharing directories between host and guests</span></span> <a title="Permalink" class="permalink" href="#kvm-qemu-virtfs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    VM Guests usually run in a separate computing space—they are
    provided their own memory range, dedicated CPUs, and file system space. The
    ability to share parts of the VM Host Server's file system makes the
    virtualization environment more flexible by simplifying mutual data
    exchange. Network file systems, such as CIFS and NFS, have been the
    traditional way of sharing directories. But as they are not specifically
    designed for virtualization purposes, they suffer from major performance
    and feature issues.
   </p><p>
    KVM introduces a new optimized method called <span class="emphasis"><em>VirtFS</em></span>
    (sometimes called <span class="quote">“<span class="quote">file system pass-through</span>”</span>). VirtFS uses a
    paravirtual file system driver, which avoids converting the guest
    application file system operations into block device operations, and then
    again into host file system operations.
   </p><p>
    You typically use VirtFS for the following situations:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      To access a shared directory from several guests, or to provide
      guest-to-guest file system access.
     </p></li><li class="listitem"><p>
      To replace the virtual disk as the root file system to which the guest's
      RAM disk connects during the guest boot process.
     </p></li><li class="listitem"><p>
      To provide storage services to different customers from a single host
      file system in a cloud environment.
     </p></li></ul></div><section class="sect3" id="kvm-qemu-virtfs-implement" data-id-title="Implementation"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">33.3.5.1 </span><span class="title-name">Implementation</span></span> <a title="Permalink" class="permalink" href="#kvm-qemu-virtfs-implement">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     In QEMU, the implementation of VirtFS is simplified by defining two
     types of devices:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <code class="literal">virtio-9p-pci</code> device which transports protocol
       messages and data between the host and the guest.
      </p></li><li class="listitem"><p>
       <code class="literal">fsdev</code> device which defines the export file system
       properties, such as file system type and security model.
      </p></li></ul></div><div class="complex-example"><div class="example" id="ex-qemu-virtfs-host" data-id-title="Exporting hosts file system with VirtFS"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 33.1: </span><span class="title-name">Exporting host's file system with VirtFS </span></span><a title="Permalink" class="permalink" href="#ex-qemu-virtfs-host">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-fsdev local,id=exp1<span class="callout" id="co-virtfs-host-id">1</span>,path=/tmp/<span class="callout" id="co-virtfs-host-path">2</span>,security_model=mapped<span class="callout" id="co-virtfs-host-sec-model">3</span> \
-device virtio-9p-pci,fsdev=exp1<span class="callout" id="co-virtfs-host-fsdev">4</span>,mount_tag=v_tmp<span class="callout" id="co-virtfs-host-mnt-tag">5</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-virtfs-host-id"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Identification of the file system to be exported.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-virtfs-host-path"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        File system path on the host to be exported.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-virtfs-host-sec-model"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Security model to be used—<code class="literal">mapped</code> keeps the
        guest file system modes and permissions isolated from the host, while
        <code class="literal">none</code> invokes a <span class="quote">“<span class="quote">pass-through</span>”</span> security
        model in which permission changes on the guest's files are reflected on
        the host as well.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-virtfs-host-fsdev"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        The exported file system ID defined before with <code class="literal">-fsdev
        id=</code> .
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-virtfs-host-mnt-tag"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Mount tag used later on the guest to mount the exported file system.
       </p></td></tr></table></div><p>
      Such an exported file system can be mounted on the guest as follows:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mount -t 9p -o trans=virtio v_tmp /mnt</pre></div><p>
      where <code class="literal">v_tmp</code> is the mount tag defined earlier with
      <code class="literal">-device mount_tag=</code> and <code class="literal">/mnt</code> is the
      mount point where you want to mount the exported file system.
     </p></div></div></div></section></section><section class="sect2" id="kvm-qemu-ksm" data-id-title="KSM: sharing memory pages between guests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">33.3.6 </span><span class="title-name">KSM: sharing memory pages between guests</span></span> <a title="Permalink" class="permalink" href="#kvm-qemu-ksm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_host_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Kernel Same Page Merging (<a class="xref" href="#gloss-vt-acronym-ksm" title="KSM">KSM</a>) is a
    Linux kernel feature that merges identical memory pages from multiple
    running processes into one memory region. Because KVM guests run as
    processes under Linux, <a class="xref" href="#gloss-vt-acronym-ksm" title="KSM">KSM</a> provides the
    memory overcommit feature to hypervisors for more efficient use of memory.
    Therefore, if you need to run multiple virtual machines on a host with
    limited memory, <a class="xref" href="#gloss-vt-acronym-ksm" title="KSM">KSM</a> may be helpful to
    you.
   </p><p>
    <a class="xref" href="#gloss-vt-acronym-ksm" title="KSM">KSM</a> stores its status information in the
    files under the <code class="filename">/sys/kernel/mm/ksm</code> directory:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ls -1 /sys/kernel/mm/ksm
full_scans
merge_across_nodes
pages_shared
pages_sharing
pages_to_scan
pages_unshared
pages_volatile
run
sleep_millisecs</pre></div><p>
    For more information on the meaning of the
    <code class="filename">/sys/kernel/mm/ksm/*</code> files, see
    <code class="filename">/usr/src/linux/Documentation/vm/ksm.txt</code> (package
    <code class="systemitem">kernel-source</code>).
   </p><p>
    To use <a class="xref" href="#gloss-vt-acronym-ksm" title="KSM">KSM</a>, do the following.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Although <span class="productname"><span class="phrase">SLES</span></span> includes
      <a class="xref" href="#gloss-vt-acronym-ksm" title="KSM">KSM</a> support in the kernel, it is
      disabled by default. To enable it, run the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>echo 1 &gt; /sys/kernel/mm/ksm/run</pre></div></li><li class="step"><p>
      Now run several VM Guests under KVM and inspect the content of files
      <code class="filename">pages_sharing</code> and <code class="filename">pages_shared</code>,
      for example:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>while [ 1 ]; do cat /sys/kernel/mm/ksm/pages_shared; sleep 1; done
13522
13523
13519
13518
13520
13520
13528</pre></div></li></ol></div></div></section></section></section><section class="chapter" id="cha-qemu-guest-inst" data-id-title="Guest installation"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">34 </span><span class="title-name">Guest installation</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The <code class="systemitem">libvirt</code>-based tools such as
  <code class="command">virt-manager</code> and <code class="command">virt-install</code>
  offer convenient interfaces to set up and
  manage virtual machines. They act as a kind of wrapper for the
  <code class="command">qemu-system-ARCH</code>command. However, it is also possible to
  use <code class="command">qemu-system-ARCH</code> directly without using
  <code class="systemitem">libvirt</code>-based tools.
 </p><div id="id-1.12.7.4.4" data-id-title="qemu-system-ARCH and libvirt" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: <code class="command">qemu-system-ARCH</code> and libvirt</div><p>
   <a class="xref" href="#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a>s created with
   <code class="command">qemu-system-ARCH</code> are not "visible" for the
   <code class="systemitem">libvirt</code>-based tools.
  </p></div><section class="sect1" id="cha-qemu-guest-inst-qemu-kvm" data-id-title="Basic installation with qemu-system-ARCH"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">34.1 </span><span class="title-name">Basic installation with <code class="command">qemu-system-ARCH</code></span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-kvm">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In the following example, a virtual machine for a SUSE Linux Enterprise Server 11 installation is
   created. For detailed information on the commands, refer to the respective
   man pages.
  </p><p>
   If you do not already have an image of a system that you want to run in a
   virtualized environment, you need to create one from the installation media.
   In such case, you need to prepare a hard disk image, and obtain an image of
   the installation media or the media itself.
  </p><p>
   Create a hard disk with <code class="command">qemu-img</code>.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create<span class="callout" id="co-qemu-img-create">1</span> -f raw<span class="callout" id="co-qemu-img-format">2</span> /images/sles/hda<span class="callout" id="co-qemu-img-path">3</span> 8G<span class="callout" id="co-qemu-img-size">4</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-create"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The subcommand <code class="option">create</code> tells <code class="command">qemu-img</code>
     to create a new image.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-format"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Specify the disk's format with the <code class="option">-f</code> parameter.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-path"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The full path to the image file.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-size"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The size of the image—8 GB in this case. The image is created as a
     <a class="xref" href="#gloss-vt-storage-sparse" title="Sparse image file">Sparse image file</a> file that grows when the disk is
     filled with data. The specified size defines the maximum size to which the
     image file can grow.
    </p></td></tr></table></div><p>
   After at least one hard disk image is created, you can set up a virtual
   machine with <code class="command">qemu-system-ARCH</code> that will boot into the
   installation system:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>qemu-system-x86_64 -name "sles"<span class="callout" id="co-qemu-kvn-name">1</span>-machine accel=kvm -M pc<span class="callout" id="co-qemu-kvm-type">2</span> -m 768<span class="callout" id="co-qemu-kvm-memory">3</span> \
-smp 2<span class="callout" id="co-qemu-kvm-cpu">4</span> -boot d<span class="callout" id="co-qemu-kvm-boot">5</span> \
-drive file=/images/sles/hda,if=virtio,index=0,media=disk,format=raw<span class="callout" id="co-qemu-kvm-hdd">6</span> \
-drive file=/isos/SLE-15-SP3-Online-<em class="replaceable">ARCH</em>-GM-media1.iso,index=1,media=cdrom<span class="callout" id="co-qemu-kvm-cdrom">7</span> \
-net nic,model=virtio,macaddr=52:54:00:05:11:11<span class="callout" id="co-qemu-kvm-nic">8</span> -net user \
-vga cirrus<span class="callout" id="co-qemu-kvm-gfx">9</span> -balloon virtio<span class="callout" id="co-qemu-kvm-balloon">10</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-kvn-name"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Name of the virtual machine that will be displayed in the window caption
     and be used for the VNC server. This name must be unique.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-kvm-type"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Specifies the machine type. Use <code class="command">qemu-system-ARCH</code>
     <code class="option">-M ?</code> to display a list of valid parameters.
     <code class="literal">pc</code> is the default <span class="guimenu">Standard PC</span>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-kvm-memory"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Maximum amount of memory for the virtual machine.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-kvm-cpu"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Defines an SMP system with two processors.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-kvm-boot"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Specifies the boot order. Valid values are <code class="literal">a</code>,
     <code class="literal">b</code> (floppy 1 and 2), <code class="literal">c</code> (first hard
     disk), <code class="literal">d</code> (first CD-ROM), or <code class="literal">n</code> to
     <code class="literal">p</code> (Ether-boot from network adapter 1-3). Defaults to
     <code class="literal">c</code>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-kvm-hdd"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Defines the first (<code class="literal">index=0</code>) hard disk. It will be
     accessed as a paravirtualized (<code class="literal">if=virtio</code>) drive in
     <code class="literal">raw</code> format.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-kvm-cdrom"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The second (<code class="literal">index=1</code>) image drive will act as a CD-ROM.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-kvm-nic"><span class="callout">8</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Defines a paravirtualized (<code class="literal">model=virtio</code>) network
     adapter with the MAC address <code class="literal">52:54:00:05:11:11</code>. Be sure
     to specify a unique MAC address, otherwise a network conflict may occur.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-kvm-gfx"><span class="callout">9</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Specifies the graphic card. If you specify
     <code class="literal">none</code>, the graphic card will be disabled.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-kvm-balloon"><span class="callout">10</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Defines the paravirtualized balloon device that allows to dynamically
     change the amount of memory (up to the maximum value specified with the
     parameter <code class="option">-m</code>).
    </p></td></tr></table></div><p>
   After the installation of the guest operating system finishes, you can
   start the related virtual machine without the need to specify the
   CD-ROM device:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>qemu-system-x86_64 -name "sles" -machine type=pc,accel=kvm -m 768 \
-smp 2 -boot c \
-drive file=/images/sles/hda,if=virtio,index=0,media=disk,format=raw \
-net nic,model=virtio,macaddr=52:54:00:05:11:11 \
-vga cirrus -balloon virtio</pre></div></section><section class="sect1" id="cha-qemu-guest-inst-qemu-img" data-id-title="Managing disk images with qemu-img"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">34.2 </span><span class="title-name">Managing disk images with <code class="command">qemu-img</code></span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In the previous section (see
   <a class="xref" href="#cha-qemu-guest-inst-qemu-kvm" title="34.1. Basic installation with qemu-system-ARCH">Section 34.1, “Basic installation with <code class="command">qemu-system-ARCH</code>”</a>), we used the
   <code class="command">qemu-img</code> command to create an image of a hard disk. You
   can, however, use <code class="command">qemu-img</code> for general disk image
   manipulation. This section introduces <code class="command">qemu-img</code>
   subcommands to help manage the disk images flexibly.
  </p><section class="sect2" id="cha-qemu-guest-inst-qemu-img-general-invocation" data-id-title="General information on qemu-img invocation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">34.2.1 </span><span class="title-name">General information on qemu-img invocation</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-general-invocation">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">qemu-img</code> uses subcommands (like
    <code class="command">zypper</code> does) to do specific tasks. Each subcommand
    understands a different set of options. Some options are general and used
    by more of these subcommands, while some are unique to the related
    subcommand. See the qemu-img manual page (<code class="command">man 1
    qemu-img</code>) for a list of all supported options.
    <code class="command">qemu-img</code> uses the following general syntax:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img subcommand [options]</pre></div><p>
    and supports the following subcommands:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.4.6.3.5.1"><span class="term"><code class="literal">create</code>
     </span></dt><dd><p>
       Creates a new disk image on the file system.
      </p></dd><dt id="id-1.12.7.4.6.3.5.2"><span class="term"><code class="literal">check</code>
     </span></dt><dd><p>
       Checks an existing disk image for errors.
      </p></dd><dt id="id-1.12.7.4.6.3.5.3"><span class="term"><code class="literal">compare</code>
     </span></dt><dd><p>
       Check if two images have the same content.
      </p></dd><dt id="id-1.12.7.4.6.3.5.4"><span class="term"><code class="literal">map</code>
     </span></dt><dd><p>
       Dumps the metadata of the image file name and its backing file chain.
      </p></dd><dt id="id-1.12.7.4.6.3.5.5"><span class="term"><code class="literal">amend</code>
     </span></dt><dd><p>
       Amends the image format specific options for the image file name.
      </p></dd><dt id="id-1.12.7.4.6.3.5.6"><span class="term"><code class="literal">convert</code>
     </span></dt><dd><p>
       Converts an existing disk image to a new one in a different format.
      </p></dd><dt id="id-1.12.7.4.6.3.5.7"><span class="term"><code class="literal">info</code>
     </span></dt><dd><p>
       Displays information about the relevant disk image.
      </p></dd><dt id="id-1.12.7.4.6.3.5.8"><span class="term"><code class="literal">snapshot</code>
     </span></dt><dd><p>
       Manages snapshots of existing disk images.
      </p></dd><dt id="id-1.12.7.4.6.3.5.9"><span class="term"><code class="literal">commit</code>
     </span></dt><dd><p>
       Applies changes made to an existing disk image.
      </p></dd><dt id="id-1.12.7.4.6.3.5.10"><span class="term"><code class="literal">rebase</code>
     </span></dt><dd><p>
       Creates a new base image based on an existing image.
      </p></dd><dt id="id-1.12.7.4.6.3.5.11"><span class="term"><code class="literal">resize</code>
     </span></dt><dd><p>
       Increases or decreases the size of an existing image.
      </p></dd></dl></div></section><section class="sect2" id="cha-qemu-guest-inst-qemu-img-create" data-id-title="Creating, converting, and checking disk images"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">34.2.2 </span><span class="title-name">Creating, converting, and checking disk images</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-create">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This section describes how to create disk images, check their condition,
    convert a disk image from one format to another, and get detailed
    information about a particular disk image.
   </p><section class="sect3" id="cha-qemu-guest-inst-qemu-img-create-create" data-id-title="qemu-img create"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.2.1 </span><span class="title-name">qemu-img create</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-create-create">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use <code class="command">qemu-img create</code> to create a new disk image for your
     VM Guest operating system. The command uses the following syntax:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create -f fmt<span class="callout" id="co-qemu-img-create-f">1</span> -o options<span class="callout" id="co-qemu-img-create-o">2</span> fname<span class="callout" id="co-qemu-img-create-filename">3</span> size<span class="callout" id="co-qemu-img-create-size">4</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-create-f"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The format of the target image. Supported formats are
       <code class="literal">raw</code> and <code class="literal">qcow2</code>.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-create-o"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Some image formats support additional options to be passed on the
       command line. You can specify them here with the <code class="literal">-o</code>
       option. The <code class="literal">raw</code> image format supports only the
       <code class="literal">size</code> option, so it is possible to insert <code class="literal">-o
       size=8G</code> instead of adding the size option at the end of the
       command.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-create-filename"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Path to the target disk image to be created.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-create-size"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Size of the target disk image (if not already specified with the
       <code class="literal">-o size=&lt;image_size&gt;</code> option. Optional suffixes
       for the image size are <code class="literal">K</code> (kilobyte),
       <code class="literal">M</code> (megabyte), <code class="literal">G</code> (gigabyte), or
       <code class="literal">T</code> (terabyte).
      </p></td></tr></table></div><p>
     To create a new disk image <code class="filename">sles.raw</code> in the directory
     <code class="filename">/images</code> growing up to a maximum size of 4 GB, run the
     following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create -f raw -o size=4G /images/sles.raw
Formatting '/images/sles.raw', fmt=raw size=4294967296

<code class="prompt user">&gt; </code>ls -l /images/sles.raw
-rw-r--r-- 1 tux users 4294967296 Nov 15 15:56 /images/sles.raw

<code class="prompt user">&gt; </code>qemu-img info /images/sles.raw
image: /images/sles11.raw
file format: raw
virtual size: 4.0G (4294967296 bytes)
disk size: 0</pre></div><p>
     As you can see, the <span class="emphasis"><em>virtual</em></span> size of the newly created
     image is 4 GB, but the actual reported disk size is 0 as no data has been
     written to the image yet.
    </p><div id="id-1.12.7.4.6.4.3.8" data-id-title="VM Guest images on the Btrfs file system" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: VM Guest images on the Btrfs file system</div><p>
      If you need to create a disk image on the Btrfs file system, you can use
      <code class="option">nocow=on</code> to reduce the performance overhead created by
      the copy-on-write feature of Btrfs:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create -o nocow=on test.img 8G</pre></div><p>
      If you, however, want to use copy-on-write (for example for creating
      snapshots or sharing them across virtual machines), then leave the
      command line without the <code class="option">nocow</code> option.
     </p></div></section><section class="sect3" id="cha-qemu-guest-inst-qemu-img-create-convert" data-id-title="qemu-img convert"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.2.2 </span><span class="title-name">qemu-img convert</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-create-convert">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use <code class="command">qemu-img convert</code> to convert disk images to another
     format. To get a complete list of image formats supported by QEMU, run
     <code class="command">qemu-img</code> <code class="option">-h</code> and look at the last line
     of the output. The command uses the following syntax:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img convert -c<span class="callout" id="co-qemu-img-convert-c">1</span> -f fmt<span class="callout" id="co-qemu-img-convert-fmt">2</span> -O out_fmt<span class="callout" id="co-qemu-img-convert-ofmt">3</span> -o options<span class="callout" id="co-qemu-img-convert-o">4</span> fname<span class="callout" id="co-qemu-img-convert-fname">5</span> out_fname<span class="callout" id="co-qemu-img-convert-ofname">6</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-convert-c"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Applies compression on the target disk image. Only
       <code class="literal">qcow</code> and <code class="literal">qcow2</code> formats support
       compression.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-convert-fmt"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The format of the source disk image. It is usually autodetected and can
       therefore be omitted.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-convert-ofmt"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The format of the target disk image.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-convert-o"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Specify additional options relevant for the target image format. Use
       <code class="literal">-o ?</code> to view the list of options supported by the
       target image format.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-convert-fname"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Path to the source disk image to be converted.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-convert-ofname"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Path to the converted target disk image.
      </p></td></tr></table></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img convert -O vmdk /images/sles.raw \
/images/sles.vmdk

<code class="prompt user">&gt; </code>ls -l /images/
-rw-r--r-- 1 tux users 4294967296 16. lis 10.50 sles.raw
-rw-r--r-- 1 tux users 2574450688 16. lis 14.18 sles.vmdk</pre></div><p>
     To see a list of options relevant for the selected target image format,
     run the following command (replace <code class="literal">vmdk</code> with your image
     format):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img convert -O vmdk /images/sles.raw \
/images/sles.vmdk -o ?
Supported options:
size             Virtual disk size
backing_file     File name of a base image
compat6          VMDK version 6 image
subformat        VMDK flat extent format, can be one of {monolithicSparse \
    (default) | monolithicFlat | twoGbMaxExtentSparse | twoGbMaxExtentFlat}
scsi             SCSI image</pre></div></section><section class="sect3" id="cha-qemu-guest-inst-qemu-img-create-check" data-id-title="qemu-img check"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.2.3 </span><span class="title-name">qemu-img check</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-create-check">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use <code class="command">qemu-img check</code> to check the existing disk image for
     errors. Not all disk image formats support this feature. The command uses
     the following syntax:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img check -f fmt<span class="callout" id="co-qemu-img-check-fmt">1</span> fname<span class="callout" id="co-qemu-img-check-fname">2</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-check-fmt"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The format of the source disk image. It is usually autodetected and can
       therefore be omitted.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-check-fname"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Path to the source disk image to be checked.
      </p></td></tr></table></div><p>
     If no error is found, the command returns no output. Otherwise, the type
     and number of errors found is shown.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img check -f qcow2 /images/sles.qcow2
ERROR: invalid cluster offset=0x2af0000
[...]
ERROR: invalid cluster offset=0x34ab0000
378 errors were found on the image.</pre></div></section><section class="sect3" id="cha-qemu-guest-inst-qemu-img-create-incr" data-id-title="Increasing the size of an existing disk image"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.2.4 </span><span class="title-name">Increasing the size of an existing disk image</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-create-incr">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     When creating a new image, you must specify its maximum size before the
     image is created (see
     <a class="xref" href="#cha-qemu-guest-inst-qemu-img-create-create" title="34.2.2.1. qemu-img create">Section 34.2.2.1, “qemu-img create”</a>). After you
     have installed the VM Guest and have been using it for some time, the
     initial size of the image may no longer be sufficient. In that case,
     add more space to it.
    </p><p>
     To increase the size of an existing disk image by 2 gigabytes, use:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img resize /images/sles.raw +2GB</pre></div><div id="id-1.12.7.4.6.4.6.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      You can resize the disk image using the formats <code class="literal">raw</code>
      and <code class="literal">qcow2</code>. To resize an image in another format,
      convert it to a supported format with <code class="command">qemu-img convert</code>
      first.
     </p></div><p>
     The image now contains an empty space of 2 GB after the final partition.
     You can resize the existing partitions or add new ones.
    </p></section><section class="sect3" id="qemu-qcow2-advanced-options" data-id-title="Advanced options for the qcow2 file format"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.2.5 </span><span class="title-name">Advanced options for the qcow2 file format</span></span> <a title="Permalink" class="permalink" href="#qemu-qcow2-advanced-options">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <span class="emphasis"><em>qcow2</em></span> is the main disk image format used by QEMU.
     Its size grows on demand, and the disk space is only allocated when it is
     actually needed by the virtual machine.
    </p><p>
     A qcow2 formatted file is organized in units of constant size. These units
     are called <span class="emphasis"><em>clusters</em></span>. Viewed from the guest side, the
     virtual disk is also divided into clusters of the same size. QEMU
     defaults to 64 kB clusters, but you can specify a different value
     when creating a new image:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create -f qcow2 -o cluster_size=128K virt_disk.qcow2 4G</pre></div><p>
     A qcow2 image contains a set of tables organized in two levels that are
     called the L1 and L2 tables. There is just one L1 table per disk image,
     while there can be many L2 tables depending on how big the image is.
    </p><p>
     To read or write data to the virtual disk, QEMU needs to read its
     corresponding L2 table to find out the relevant data location. Because
     reading the table for each I/O operation consumes system resources, QEMU
     keeps a cache of L2 tables in memory to speed up disk access.
    </p><section class="sect4" id="id-1.12.7.4.6.4.7.7" data-id-title="Choosing the right cache size"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">34.2.2.5.1 </span><span class="title-name">Choosing the right cache size</span></span> <a title="Permalink" class="permalink" href="#id-1.12.7.4.6.4.7.7">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      The cache size relates to the amount of allocated space. L2 cache can map
      the following amount of virtual disk:
     </p><div class="verbatim-wrap"><pre class="screen">disk_size = l2_cache_size * cluster_size / 8</pre></div><p>
      With the default 64 kB of cluster size, that is
     </p><div class="verbatim-wrap"><pre class="screen">disk_size = l2_cache_size * 8192</pre></div><p>
      Therefore, to have a cache that maps
      <code class="literal">n</code> gigabytes of disk space with the default cluster
      size, you need
     </p><div class="verbatim-wrap"><pre class="screen">l2_cache_size = disk_size_GB * 131072</pre></div><p>
      QEMU uses 1 MB (1048576 bytes) of L2 cache by default. Following
      the above formulas, 1 MB of L2 cache covers 8 GB (1048576 /
      131072) of virtual disk. This means that the performance is fine with the
      default L2 cache size if your virtual disk size is up to 8 GB. For
      larger disks, you can speed up the disk access by increasing the L2 cache
      size.
     </p></section><section class="sect4" id="id-1.12.7.4.6.4.7.8" data-id-title="Configuring the cache size"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">34.2.2.5.2 </span><span class="title-name">Configuring the cache size</span></span> <a title="Permalink" class="permalink" href="#id-1.12.7.4.6.4.7.8">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      You can use the <code class="option">-drive</code> option on the QEMU command line
      to specify the cache sizes. Alternatively when communicating via QMP, use
      the <code class="command">blockdev-add</code> command. For more information on QMP,
      see <a class="xref" href="#qemu-monitor-qmp" title="36.11. QMP - QEMU machine protocol">Section 36.11, “QMP - QEMU machine protocol”</a>.
     </p><p>
      The following options configure the cache size for the virtual guest:
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.4.6.4.7.8.4.1"><span class="term">l2-cache-size</span></dt><dd><p>
         The maximum size of the L2 table cache.
        </p></dd><dt id="id-1.12.7.4.6.4.7.8.4.2"><span class="term">refcount-cache-size</span></dt><dd><p>
         The maximum size of the <span class="emphasis"><em>refcount</em></span> block cache. For
         more information on <span class="emphasis"><em>refcount</em></span>, see
         <a class="link" href="https://raw.githubusercontent.com/qemu/qemu/master/docs/qcow2-cache.txt" target="_blank">https://raw.githubusercontent.com/qemu/qemu/master/docs/qcow2-cache.txt</a>.
        </p></dd><dt id="id-1.12.7.4.6.4.7.8.4.3"><span class="term">cache-size</span></dt><dd><p>
         The maximum size of both caches combined.
        </p></dd></dl></div><p>
      When specifying values for the options above, be aware of the following:
     </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        The size of both the L2 and refcount block caches needs to be a
        multiple of the cluster size.
       </p></li><li class="listitem"><p>
        If you only set one of the options, QEMU will automatically adjust
        the other options so that the L2 cache is 4 times bigger than the
        refcount cache.
       </p></li></ul></div><p>
      The refcount cache is used much less often than the L2 cache, therefore you
      can keep it relatively small:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>qemu-system-ARCH [...] \
 -drive file=disk_image.qcow2,l2-cache-size=4194304,refcount-cache-size=262144</pre></div></section><section class="sect4" id="id-1.12.7.4.6.4.7.9" data-id-title="Reducing the memory usage"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">34.2.2.5.3 </span><span class="title-name">Reducing the memory usage</span></span> <a title="Permalink" class="permalink" href="#id-1.12.7.4.6.4.7.9">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      The larger the cache, the more memory it consumes. There is a separate L2
      cache for each qcow2 file. When using a lot of big disk images, you will
      probably need a considerably large amount of memory. Memory consumption
      is even worse if you add backing files
      (<a class="xref" href="#cha-qemu-guest-inst-qemu-img-effect" title="34.2.4. Manipulate disk images effectively">Section 34.2.4, “Manipulate disk images effectively”</a>) and snapshots
      (see <a class="xref" href="#cha-qemu-guest-inst-qemu-img-snapshots" title="34.2.3. Managing snapshots of virtual machines with qemu-img">Section 34.2.3, “Managing snapshots of virtual machines with qemu-img”</a>) to the
      guest's setup chain.
     </p><p>
      That is why QEMU introduced the <code class="option">cache-clean-interval</code>
      setting. It defines an interval in seconds after which all cache entries
      that have not been accessed are removed from memory.
     </p><p>
      The following example removes all unused cache entries every 10 minutes:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>qemu-system-ARCH [...] -drive file=hd.qcow2,cache-clean-interval=600</pre></div><p>
      If this option is not set, the default value is 0 and it disables this
      feature.
     </p></section></section></section><section class="sect2" id="cha-qemu-guest-inst-qemu-img-snapshots" data-id-title="Managing snapshots of virtual machines with qemu-img"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">34.2.3 </span><span class="title-name">Managing snapshots of virtual machines with qemu-img</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-snapshots">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <a class="xref" href="#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a> snapshots are snapshots of the complete
    environment in which a VM Guest is running. The snapshot includes the
    state of the processor (CPU), memory (RAM), devices, and all writable
    disks.
   </p><p>
    Snapshots are helpful when you need to save your virtual machine in a
    particular state. For example, after you configured network services on a
    virtualized server and want to quickly start the virtual machine in the
    same state you last saved it. Or you can create a snapshot after the
    virtual machine has been powered off to create a backup state before you
    try something experimental and possibly make VM Guest unstable. This
    section introduces the latter case, while the former is described in
    <a class="xref" href="#cha-qemu-monitor" title="Chapter 36. Virtual machine administration using QEMU monitor">Chapter 36, <em>Virtual machine administration using QEMU monitor</em></a>.
   </p><p>
    To use snapshots, your VM Guest must contain at least one writable hard
    disk image in <code class="literal">qcow2</code> format. This device is usually the
    first virtual hard disk.
   </p><p>
    <a class="xref" href="#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a> snapshots are created with the
    <code class="literal">savevm</code> command in the interactive QEMU monitor. To
    make identifying a particular snapshot easier, you can assign it a
    <span class="emphasis"><em>tag</em></span>. For more information on QEMU monitor, see
    <a class="xref" href="#cha-qemu-monitor" title="Chapter 36. Virtual machine administration using QEMU monitor">Chapter 36, <em>Virtual machine administration using QEMU monitor</em></a>.
   </p><p>
    Once your <code class="literal">qcow2</code> disk image contains saved snapshots, you
    can inspect them with the <code class="command">qemu-img snapshot</code> command.
   </p><div id="id-1.12.7.4.6.5.7" data-id-title="Shut down the VM Guest" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Shut down the VM Guest</div><p>
     Do not create or delete virtual machine snapshots with the
     <code class="command">qemu-img snapshot</code> command while the virtual machine is
     running. Otherwise, you may damage the disk image with the state of the
     virtual machine saved.
    </p></div><section class="sect3" id="cha-qemu-guest-inst-qemu-img-snapshots-l" data-id-title="Listing existing snapshots"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.3.1 </span><span class="title-name">Listing existing snapshots</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-snapshots-l">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use <code class="command">qemu-img snapshot -l</code>
     <em class="replaceable">DISK_IMAGE</em> to view a list of all existing
     snapshots saved in the <code class="literal">disk_image</code> image. You can get
     the list even while the VM Guest is running.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img snapshot -l /images/sles.qcow2
Snapshot list:
ID<span class="callout" id="co-qemu-img-snapshot-l-id">1</span>       TAG<span class="callout" id="co-qemu-img-snapshot-l-tag">2</span>               VM SIZE<span class="callout" id="co-qemu-img-snapshot-l-size">3</span>        DATE<span class="callout" id="co-qemu-img-snapshot-l-date">4</span>          VM CLOCK<span class="callout" id="co-qemu-img-snapshot-l-clock">5</span>
1         booting                4.4M 2013-11-22 10:51:10   00:00:20.476
2         booted                 184M 2013-11-22 10:53:03   00:02:05.394
3         logged_in              273M 2013-11-22 11:00:25   00:04:34.843
4         ff_and_term_running    372M 2013-11-22 11:12:27   00:08:44.965</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-snapshot-l-id"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Unique identification number of the snapshot. Usually auto-incremented.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-snapshot-l-tag"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Unique description string of the snapshot. It is meant as a
       human-readable version of the ID.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-snapshot-l-size"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The disk space occupied by the snapshot. Note that the more memory is
       consumed by running applications, the bigger the snapshot is.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-snapshot-l-date"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Time and date the snapshot was created.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-snapshot-l-clock"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The current state of the virtual machine's clock.
      </p></td></tr></table></div></section><section class="sect3" id="cha-qemu-guest-inst-qemu-img-snapshots-c" data-id-title="Creating snapshots of a powered-off virtual machine"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.3.2 </span><span class="title-name">Creating snapshots of a powered-off virtual machine</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-snapshots-c">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use <code class="command">qemu-img snapshot -c</code>
     <em class="replaceable">SNAPSHOT_TITLE</em>
     <em class="replaceable">DISK_IMAGE</em> to create a snapshot of the current
     state of a virtual machine that was previously powered off.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img snapshot -c backup_snapshot /images/sles.qcow2</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img snapshot -l /images/sles.qcow2
Snapshot list:
ID        TAG                 VM SIZE                DATE       VM CLOCK
1         booting                4.4M 2013-11-22 10:51:10   00:00:20.476
2         booted                 184M 2013-11-22 10:53:03   00:02:05.394
3         logged_in              273M 2013-11-22 11:00:25   00:04:34.843
4         ff_and_term_running    372M 2013-11-22 11:12:27   00:08:44.965
5         backup_snapshot           0 2013-11-22 14:14:00   00:00:00.000</pre></div><p>
     If something breaks in your VM Guest and you need to restore the state of
     the saved snapshot (ID 5 in our example), power off your VM Guest and
     execute the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img snapshot -a 5 /images/sles.qcow2</pre></div><p>
     The next time you run the virtual machine with
     <code class="command">qemu-system-ARCH</code>, it will be in the state of snapshot
     number 5.
    </p><div id="id-1.12.7.4.6.5.9.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      The <code class="command">qemu-img snapshot -c</code> command is not related to the
      <code class="literal">savevm</code> command of QEMU monitor (see
      <a class="xref" href="#cha-qemu-monitor" title="Chapter 36. Virtual machine administration using QEMU monitor">Chapter 36, <em>Virtual machine administration using QEMU monitor</em></a>). For example, you cannot apply a
      snapshot with <code class="command">qemu-img snapshot -a</code> on a snapshot
      created with <code class="literal">savevm</code> in QEMU's monitor.
     </p></div></section><section class="sect3" id="cha-qemu-guest-inst-qemu-img-snapshots-d" data-id-title="Deleting snapshots"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.3.3 </span><span class="title-name">Deleting snapshots</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-snapshots-d">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use <code class="command">qemu-img snapshot -d</code>
     <em class="replaceable">SNAPSHOT_ID</em>
     <em class="replaceable">DISK_IMAGE</em> to delete old or unneeded snapshots
     of a virtual machine. This saves some disk space inside the
     <code class="literal">qcow2</code> disk image as the space occupied by the snapshot
     data is restored:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img snapshot -d 2 /images/sles.qcow2</pre></div></section></section><section class="sect2" id="cha-qemu-guest-inst-qemu-img-effect" data-id-title="Manipulate disk images effectively"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">34.2.4 </span><span class="title-name">Manipulate disk images effectively</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-effect">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Imagine the following real-life situation: you are a server administrator
    who runs and manages several virtualized operating systems. One group of
    these systems is based on one specific distribution, while another group
    (or groups) is based on different versions of the distribution or even on a
    different (and maybe non-Unix) platform. To make the case even more
    complex, individual virtual guest systems based on the same distribution
    usually differ according to the department and deployment. A file server
    typically uses a different setup and services than a Web server does, while
    both may still be based on <span class="phrase">SUSE® Linux Enterprise Server</span>.
   </p><p>
    With QEMU it is possible to create <span class="quote">“<span class="quote">base</span>”</span> disk images. You
    can use them as template virtual machines. These base images will save you
    plenty of time because you will never need to install the same operating
    system more than once.
   </p><section class="sect3" id="cha-qemu-guest-inst-qemu-img-effect-base-and-derived" data-id-title="Base and derived images"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.4.1 </span><span class="title-name">Base and derived images</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-effect-base-and-derived">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     First, build a disk image as usual and install the target system on it.
     For more information, see <a class="xref" href="#cha-qemu-guest-inst-qemu-kvm" title="34.1. Basic installation with qemu-system-ARCH">Section 34.1, “Basic installation with <code class="command">qemu-system-ARCH</code>”</a>
     and <a class="xref" href="#cha-qemu-guest-inst-qemu-img-create" title="34.2.2. Creating, converting, and checking disk images">Section 34.2.2, “Creating, converting, and checking disk images”</a>. Then build a
     new image while using the first one as a base image. The base image is
     also called a <span class="emphasis"><em>backing</em></span> file. After your new
     <span class="emphasis"><em>derived</em></span> image is built, never boot the base image
     again, but boot the derived image instead. Several derived images may
     depend on one base image at the same time. Therefore, changing the base
     image can damage the dependencies. While using your derived image, QEMU
     writes changes to it and uses the base image only for reading.
    </p><p>
     It is a good practice to create a base image from a freshly installed
     (and, if needed, registered) operating system with no patches applied and
     no additional applications installed or removed. Later on, you can create
     another base image with the latest patches applied and based on the
     original base image.
    </p></section><section class="sect3" id="cha-qemu-guest-inst-qemu-img-effect-create-derived" data-id-title="Creating derived images"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.4.2 </span><span class="title-name">Creating derived images</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-effect-create-derived">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.12.7.4.6.6.5.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      While you can use the <code class="literal">raw</code> format for base images, you
      cannot use it for derived images because the <code class="literal">raw</code>
      format does not support the <code class="literal">backing_file</code> option. Use
      for example the <code class="literal">qcow2</code> format for the derived images.
     </p></div><p>
     For example, <code class="filename">/images/sles_base.raw</code> is the base image
     holding a freshly installed system.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img info /images/sles_base.raw
image: /images/sles_base.raw
file format: raw
virtual size: 4.0G (4294967296 bytes)
disk size: 2.4G</pre></div><p>
     The image's reserved size is 4 GB, the actual size is 2.4 GB, and its
     format is <code class="literal">raw</code>. Create an image derived from the
     <code class="filename">/images/sles_base.raw</code> base image with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create -f qcow2 /images/sles_derived.qcow2 \
-o backing_file=/images/sles_base.raw
Formatting '/images/sles_derived.qcow2', fmt=qcow2 size=4294967296 \
backing_file='/images/sles_base.raw' encryption=off cluster_size=0</pre></div><p>
     Look at the derived image details:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img info /images/sles_derived.qcow2
image: /images/sles_derived.qcow2
file format: qcow2
virtual size: 4.0G (4294967296 bytes)
disk size: 140K
cluster_size: 65536
backing file: /images/sles_base.raw \
(actual path: /images/sles_base.raw)</pre></div><p>
     Although the reserved size of the derived image is the same as the size of
     the base image (4 GB), the actual size is 140 KB only. The reason is that
     only changes made to the system inside the derived image are saved. Run
     the derived virtual machine, register it, if needed, and apply the latest
     patches. Do any other changes in the system such as removing unneeded or
     installing new software packages. Then shut the VM Guest down and examine
     its details once more:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img info /images/sles_derived.qcow2
image: /images/sles_derived.qcow2
file format: qcow2
virtual size: 4.0G (4294967296 bytes)
disk size: 1.1G
cluster_size: 65536
backing file: /images/sles_base.raw \
(actual path: /images/sles_base.raw)</pre></div><p>
     The <code class="literal">disk size</code> value has grown to 1.1 GB, which is the
     disk space occupied by the changes on the file system compared to the base
     image.
    </p></section><section class="sect3" id="cha-qemu-guest-inst-qemu-img-effect-rebase" data-id-title="Rebasing derived images"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.4.3 </span><span class="title-name">Rebasing derived images</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-effect-rebase">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     After you have modified the derived image (applied patches, installed
     specific applications, changed environment settings, etc.), it reaches the
     desired state. At that point, you can merge the original base
     image and the derived image to create a new base image.
    </p><p>
     Your original base image (<code class="filename">/images/sles_base.raw</code>)
     holds a freshly installed system. It can be a template for new modified
     base images, while the new one can contain the same system as the first
     one plus all security and update patches applied, for example. After you
     have created this new base image, you can use it as a template for more
     specialized derived images as well. The new base image becomes independent
     of the original one. The process of creating base images from derived ones
     is called <span class="emphasis"><em>rebasing</em></span>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img convert /images/sles_derived.qcow2 \
-O raw /images/sles_base2.raw</pre></div><p>
     This command created the new base image
     <code class="filename">/images/sles_base2.raw</code> using the
     <code class="literal">raw</code> format.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img info /images/sles_base2.raw
image: /images/sles11_base2.raw
file format: raw
virtual size: 4.0G (4294967296 bytes)
disk size: 2.8G</pre></div><p>
     The new image is 0.4 gigabytes bigger than the original base image. It
     uses no backing file, and you can easily create new derived images based
     upon it. This lets you create a sophisticated hierarchy of virtual disk
     images for your organization, saving a lot of time and work.
    </p></section><section class="sect3" id="cha-qemu-guest-inst-qemu-img-effect-mount" data-id-title="Mounting an image on a VM Host Server"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">34.2.4.4 </span><span class="title-name">Mounting an image on a VM Host Server</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-guest-inst-qemu-img-effect-mount">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     It can be useful to mount a virtual disk image under the host
     system. It is strongly recommended to read <a class="xref" href="#chap-guestfs" title="Chapter 20. libguestfs">Chapter 20, <em>libguestfs</em></a>
     and use dedicated tools to access a virtual machine image. However, if you
     need to do this manually, follow this guide.
    </p><p>
     Linux systems can mount an internal partition of a <code class="literal">raw</code>
     disk image using a loopback device. The first example procedure is more
     complex but more illustrative, while the second one is straightforward:
    </p><div class="procedure" id="id-1.12.7.4.6.6.7.4" data-id-title="Mounting disk image by calculating partition offset"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 34.1: </span><span class="title-name">Mounting disk image by calculating partition offset </span></span><a title="Permalink" class="permalink" href="#id-1.12.7.4.6.6.7.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_guest_installation.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Set a <span class="emphasis"><em>loop</em></span> device on the disk image whose partition
       you want to mount.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>losetup /dev/loop0 /images/sles_base.raw</pre></div></li><li class="step"><p>
       Find the <span class="emphasis"><em>sector size</em></span> and the starting
       <span class="emphasis"><em>sector number</em></span> of the partition you want to mount.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>fdisk -lu /dev/loop0

Disk /dev/loop0: 4294 MB, 4294967296 bytes
255 heads, 63 sectors/track, 522 cylinders, total 8388608 sectors
Units = sectors of 1 * 512 = 512<span class="callout" id="co-qemu-img-loopback-sector-size">1</span> bytes
Disk identifier: 0x000ceca8

       Device Boot      Start         End      Blocks   Id  System
/dev/loop0p1              63     1542239      771088+  82  Linux swap
/dev/loop0p2   *     1542240<span class="callout" id="co-qemu-img-loopback-sector-start">2</span>    8385929     3421845   83  Linux</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-loopback-sector-size"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The disk sector size.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-img-loopback-sector-start"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         The starting sector of the partition.
        </p></td></tr></table></div></li><li class="step"><p>
       Calculate the partition start offset:
      </p><p>
       <code class="literal">sector_size * sector_start = 512 * 1542240 = 789626880
       </code>
      </p></li><li class="step"><p>
       Delete the loop and mount the partition inside the disk image with the
       calculated offset on a prepared directory.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>losetup -d /dev/loop0
<code class="prompt user">&gt; </code>mount -o loop,offset=789626880 \
/images/sles_base.raw /mnt/sles/
<code class="prompt user">&gt; </code>ls -l /mnt/sles/
total 112
drwxr-xr-x   2 root root  4096 Nov 16 10:02 bin
drwxr-xr-x   3 root root  4096 Nov 16 10:27 boot
drwxr-xr-x   5 root root  4096 Nov 16 09:11 dev
[...]
drwxrwxrwt  14 root root  4096 Nov 24 09:50 tmp
drwxr-xr-x  12 root root  4096 Nov 16 09:16 usr
drwxr-xr-x  15 root root  4096 Nov 16 09:22 var</pre></div></li><li class="step"><p>
       Copy one or more files onto the mounted partition and unmount it when
       finished.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cp /etc/X11/xorg.conf /mnt/sles/root/tmp
<code class="prompt user">&gt; </code>ls -l /mnt/sles/root/tmp
<code class="prompt user">&gt; </code>umount /mnt/sles/</pre></div></li></ol></div></div><div id="id-1.12.7.4.6.6.7.5" data-id-title="Do not write to images currently in use" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Do not write to images currently in use</div><p>
      Never mount a partition of an image of a running virtual machine in a
      <code class="literal">read-write</code> mode. This could corrupt the partition and
      break the whole VM Guest.
     </p></div></section></section></section></section><section class="chapter" id="cha-qemu-running" data-id-title="Running virtual machines with qemu-system-ARCH"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">35 </span><span class="title-name">Running virtual machines with qemu-system-ARCH</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Once you have a virtual disk image ready (for more information on disk
  images, see <a class="xref" href="#cha-qemu-guest-inst-qemu-img" title="34.2. Managing disk images with qemu-img">Section 34.2, “Managing disk images with <code class="command">qemu-img</code>”</a>), it is time to
  start the related virtual machine.
  <a class="xref" href="#cha-qemu-guest-inst-qemu-kvm" title="34.1. Basic installation with qemu-system-ARCH">Section 34.1, “Basic installation with <code class="command">qemu-system-ARCH</code>”</a> introduced simple commands to
  install and run a VM Guest. This chapter focuses on a more detailed
  explanation of <code class="command">qemu-system-ARCH</code> usage, and shows solutions
  for more specific tasks. For a complete list of
  <code class="command">qemu-system-ARCH</code>'s options, see its manual page
  (<code class="command">man 1 qemu</code>).
 </p><section class="sect1" id="cha-qemu-running-basic" data-id-title="Basic qemu-system-ARCH invocation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.1 </span><span class="title-name">Basic <code class="command">qemu-system-ARCH</code> invocation</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-basic">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="command">qemu-system-ARCH</code> command uses the following syntax:
  </p><div class="verbatim-wrap"><pre class="screen">qemu-system-ARCH <em class="replaceable">OPTIONS</em><span class="callout" id="co-qemu-running-basic-opts">1</span> -drive file=<em class="replaceable">DISK_IMAGE</em><span class="callout" id="co-qemu-running-basic-img">2</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-running-basic-opts"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     <code class="command">qemu-system-ARCH</code> understands many options. Most of them
     define parameters of the emulated hardware, while others affect more
     general emulator behavior. If you do not supply any options, default
     values are used, and you need to supply the path to a disk image to be
     run.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-running-basic-img"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Path to the disk image holding the guest system you want to virtualize.
     <code class="command">qemu-system-ARCH</code> supports many image formats. Use
     <code class="command">qemu-img</code> <code class="option">--help</code> to list them.
    </p></td></tr></table></div><div id="id-1.12.7.5.4.5" data-id-title="AArch64 architecture" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: AArch64 architecture</div><p>
    KVM support is available only for 64-bit ARM architecture (AArch64).
    Running QEMU on the AArch64 architecture requires you to specify:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      A machine type designed for QEMU ARM virtual machines using the
      <code class="option">-machine virt-<em class="replaceable">VERSION_NUMBER</em></code>
      option.
     </p></li><li class="listitem"><p>
      A firmware image file using the <code class="option">-bios</code> option.
     </p><p>
       You can specify the firmware image files alternatively using the
       <code class="option">-drive</code> options, for example:
      </p><div class="verbatim-wrap"><pre class="screen">-drive file=/usr/share/edk2/aarch64/QEMU_EFI-pflash.raw,if=pflash,format=raw
-drive file=/var/lib/libvirt/qemu/nvram/opensuse_VARS.fd,if=pflash,format=raw</pre></div></li><li class="listitem"><p>
      A CPU of the VM Host Server using the <code class="option">-cpu host</code> option
      (default is <code class="option">cortex-15</code>).
     </p></li><li class="listitem"><p>
      The same Generic Interrupt Controller (GIC) version as the host using
      the <code class="option">-machine gic-version=host</code> option (default is
      <code class="option">2</code>).
     </p></li><li class="listitem"><p>
      If a graphic mode is needed, a graphic device of type
      <code class="literal">virtio-gpu-pci</code>.
     </p></li></ul></div><p>
    For example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-aarch64 [...] \
 -bios /usr/share/qemu/qemu-uefi-aarch64.bin \
 -cpu host \
 -device virtio-gpu-pci \
 -machine virt,accel=kvm,gic-version=host</pre></div></div></section><section class="sect1" id="cha-qemu-running-gen-opts" data-id-title="General qemu-system-ARCH options"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.2 </span><span class="title-name">General <code class="command">qemu-system-ARCH</code> options</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-gen-opts">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section introduces general <code class="command">qemu-system-ARCH</code> options
   and options related to the basic emulated hardware, such as the virtual
   machine's processor, memory, model type, or time processing methods.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.5.3.1"><span class="term"><code class="literal">-name <em class="replaceable">NAME_OF_GUEST</em></code>
    </span></dt><dd><p>
      Specifies the name of the running guest system. The name is displayed in
      the window caption and used for the VNC server.
     </p></dd><dt id="id-1.12.7.5.5.3.2"><span class="term"><code class="literal">-boot <em class="replaceable">OPTIONS</em></code>
    </span></dt><dd><p>
      Specifies the order in which the defined drives will be booted. Drives
      are represented by letters, where <code class="literal">a</code> and
      <code class="literal">b</code> stand for the floppy drives 1 and 2,
      <code class="literal">c</code> stands for the first hard disk, <code class="literal">d</code>
      stands for the first CD-ROM drive, and <code class="literal">n</code> to
      <code class="literal">p</code> stand for Ether-boot network adapters.
     </p><p>
      For example, <code class="literal">qemu-system-ARCH [...] -boot order=ndc</code>
      first tries to boot from the network, then from the first CD-ROM drive,
      and finally from the first hard disk.
     </p></dd><dt id="id-1.12.7.5.5.3.3"><span class="term"><code class="literal">-pidfile <em class="replaceable">FILENAME</em></code>
    </span></dt><dd><p>
      Stores the QEMU's process identification number (PID) in a file. This
      is useful if you run QEMU from a script.
     </p></dd><dt id="id-1.12.7.5.5.3.4"><span class="term"><code class="literal">-nodefaults</code>
    </span></dt><dd><p>
      By default QEMU creates basic virtual devices even if you do not
      specify them on the command line. This option turns this feature off, and
      you must specify every single device manually, including graphical and
      network cards, parallel or serial ports, or virtual consoles. Even QEMU
      monitor is not attached by default.
     </p></dd><dt id="id-1.12.7.5.5.3.5"><span class="term"><code class="literal">-daemonize</code>
    </span></dt><dd><p>
      <span class="quote">“<span class="quote">Daemonizes</span>”</span> the QEMU process after it is started. QEMU
      will detach from the standard input and standard output after it is ready
      to receive connections on any of its devices.
     </p></dd></dl></div><div id="id-1.12.7.5.5.4" data-id-title="SeaBIOS BIOS implementation" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: SeaBIOS BIOS implementation</div><p>
    SeaBIOS is the default BIOS used. You can boot USB devices, any drive
    (CD-ROM, Floppy, or a hard disk). It has USB mouse and keyboard support and
    supports multiple VGA cards. For more information about SeaBIOS, refer to
    the <a class="link" href="https://www.seabios.org/SeaBIOS" target="_blank">SeaBIOS
    Website</a>.
   </p></div><section class="sect2" id="cha-qemu-running-gen-opts-basic" data-id-title="Basic virtual hardware"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.2.1 </span><span class="title-name">Basic virtual hardware</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-gen-opts-basic">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect3" id="sec-qemu-running-gen-opts-machine" data-id-title="Machine type"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.2.1.1 </span><span class="title-name">Machine type</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-running-gen-opts-machine">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can specify the type of the emulated machine. Run
     <code class="command">qemu-system-ARCH -M help</code> to view a list of supported
     machine types.
    </p><div id="id-1.12.7.5.5.5.3.3" data-id-title="ISA-PC" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: ISA-PC</div><p>
      The machine type <span class="emphasis"><em>isapc: ISA-only-PC</em></span> is unsupported.
     </p></div></section><section class="sect3" id="cha-qemu-running-gen-opts-basic-cpu" data-id-title="CPU model"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.2.1.2 </span><span class="title-name">CPU model</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-gen-opts-basic-cpu">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To specify the type of the processor (CPU) model, run
     <code class="command">qemu-system-ARCH -cpu</code> <em class="replaceable">MODEL</em>.
     Use <code class="command">qemu-system-ARCH -cpu help</code> to view a list of
     supported CPU models.
    </p></section><section class="sect3" id="cha-qemu-running-gen-opts-basic-others" data-id-title="Other basic options"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.2.1.3 </span><span class="title-name">Other basic options</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-gen-opts-basic-others">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The following is a list of most commonly used options while launching
     <span class="emphasis"><em>qemu</em></span> from command line. To see all options available
     refer to <span class="emphasis"><em>qemu-doc</em></span> man page.
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.5.5.5.3.1"><span class="term"><code class="literal">-m <em class="replaceable">MEGABYTES</em></code>
      </span></dt><dd><p>
        Specifies how many megabytes are used for the virtual RAM size.
       </p></dd><dt id="id-1.12.7.5.5.5.5.3.2"><span class="term"><code class="literal">-balloon virtio</code>
      </span></dt><dd><p>
        Specifies a paravirtualized device to dynamically change the amount of
        virtual RAM memory assigned to VM Guest. The top limit is the amount
        of memory specified with <code class="literal">-m</code>.
       </p></dd><dt id="id-1.12.7.5.5.5.5.3.3"><span class="term"><code class="literal">-smp <em class="replaceable">NUMBER_OF_CPUS</em></code>
      </span></dt><dd><p>
        Specifies how many CPUs will be emulated. QEMU supports up to 255
        CPUs on the PC platform (up to 64 with KVM acceleration used). This
        option also takes other CPU-related parameters, such as number of
        <span class="emphasis"><em>sockets</em></span>, number of <span class="emphasis"><em>cores</em></span> per
        socket, or number of <span class="emphasis"><em>threads</em></span> per core.
       </p></dd></dl></div><p>
     The following is an example of a working
     <code class="command">qemu-system-ARCH</code> command line:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 \
 -name "SLES <span class="productnumber"><span class="phrase">15 SP3</span></span>" \
 -M pc-i440fx-2.7 -m 512 \
 -machine accel=kvm -cpu kvm64 -smp 2 \
 -drive format=raw,file=/images/sles.raw</pre></div><div class="figure" id="id-1.12.7.5.5.5.5.6"><div class="figure-contents"><div class="mediaobject"><a href="images/qemu_win_sles.png"><img src="images/qemu_win_sles.png" width="70%" alt="QEMU window with SLES as VM Guest" title="QEMU window with SLES as VM Guest"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 35.1: </span><span class="title-name">QEMU window with SLES as VM Guest </span></span><a title="Permalink" class="permalink" href="#id-1.12.7.5.5.5.5.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.5.5.5.7.1"><span class="term"><code class="literal">-no-acpi</code>
      </span></dt><dd><p>
        Disables <a class="xref" href="#gloss-vt-acpi" title="ACPI">ACPI</a> support.
       </p></dd><dt id="id-1.12.7.5.5.5.5.7.2"><span class="term"><code class="literal">-S</code>
      </span></dt><dd><p>
        QEMU starts with CPU stopped. To start CPU, enter
        <code class="literal">c</code> in QEMU monitor. For more information, see
        <a class="xref" href="#cha-qemu-monitor" title="Chapter 36. Virtual machine administration using QEMU monitor">Chapter 36, <em>Virtual machine administration using QEMU monitor</em></a>.
       </p></dd></dl></div></section></section><section class="sect2" id="cha-qemu-running-gen-opts-storing-cong" data-id-title="Storing and reading configuration of virtual devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.2.2 </span><span class="title-name">Storing and reading configuration of virtual devices</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-gen-opts-storing-cong">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.5.6.2.1"><span class="term"><code class="literal">-readconfig <em class="replaceable">CFG_FILE</em></code>
     </span></dt><dd><p>
       Instead of entering the devices configuration options on the command
       line each time you want to run VM Guest,
       <code class="command">qemu-system-ARCH</code> can read it from a file that was
       either previously saved with <code class="literal">-writeconfig</code> or edited
       manually.
      </p></dd><dt id="id-1.12.7.5.5.6.2.2"><span class="term"><code class="literal">-writeconfig <em class="replaceable">CFG_FILE</em></code>
     </span></dt><dd><p>
       Dumps the current virtual machine's devices configuration to a text
       file. It can be consequently re-used with the
       <code class="literal">-readconfig</code> option.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 -name "SLES <span class="productnumber"><span class="phrase">15 SP3</span></span>" \
 -machine accel=kvm -M pc-i440fx-2.7 -m 512 -cpu kvm64 \
 -smp 2 /images/sles.raw -writeconfig /images/sles.cfg
(exited)
<code class="prompt user">&gt; </code>cat /images/sles.cfg
# qemu config file

[drive]
  index = "0"
  media = "disk"
  file = "/images/sles_base.raw"</pre></div><p>
       This way you can effectively manage the configuration of your virtual
       machines' devices in a well-arranged way.
      </p></dd></dl></div></section><section class="sect2" id="cha-qemu-running-gen-opts-rtc" data-id-title="Guest real-time clock"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.2.3 </span><span class="title-name">Guest real-time clock</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-gen-opts-rtc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.5.7.2.1"><span class="term"><code class="literal">-rtc <em class="replaceable">OPTIONS</em></code>
     </span></dt><dd><p>
       Specifies the way the RTC is handled inside a VM Guest. By default, the
       clock of the guest is derived from that of the host system. Therefore,
       it is recommended that the host system clock is synchronized with an
       accurate external clock (for example, via NTP service).
      </p><p>
       If you need to isolate the VM Guest clock from the host one, specify
       <code class="literal">clock=vm</code> instead of the default
       <code class="literal">clock=host</code>.
      </p><p>
       You can also specify the initial time of the VM Guest's clock with the
       <code class="literal">base</code> option:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -rtc clock=vm,base=2010-12-03T01:02:00</pre></div><p>
       Instead of a time stamp, you can specify <code class="literal">utc</code> or
       <code class="literal">localtime</code>. The former instructs VM Guest to start at
       the current UTC value (Coordinated Universal Time, see
       <a class="link" href="http://en.wikipedia.org/wiki/UTC" target="_blank">http://en.wikipedia.org/wiki/UTC</a>), while the latter
       applies the local time setting.
      </p></dd></dl></div></section></section><section class="sect1" id="cha-qemu-running-devices" data-id-title="Using devices in QEMU"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.3 </span><span class="title-name">Using devices in QEMU</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-devices">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   QEMU virtual machines emulate all devices needed to run a VM Guest.
   QEMU supports, for example, several types of network cards, block devices
   (hard and removable drives), USB devices,
   character devices (serial and parallel
   ports), or multimedia devices (graphic and sound
   cards). This section introduces options to configure various types
   of supported devices.
  </p><div id="id-1.12.7.5.6.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    If your device, such as <code class="literal">-drive</code>, needs a special driver
    and driver properties to be set, specify them with the
    <code class="literal">-device</code> option, and identify with
    <code class="literal">drive=</code> suboption. For example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -drive if=none,id=drive0,format=raw \
-device virtio-blk-pci,drive=drive0,scsi=off ...</pre></div><p>
    To get help on available drivers and their properties, use <code class="option">-device
    ?</code> and <code class="option">-device
    <em class="replaceable">DRIVER</em>,?</code>.
   </p></div><section class="sect2" id="cha-qemu-running-devices-block" data-id-title="Block devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.3.1 </span><span class="title-name">Block devices</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-devices-block">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Block devices are vital for virtual machines. In general, these are fixed
    or removable storage media usually called <span class="emphasis"><em>drives</em></span>. One
    of the connected hard disks typically holds the guest operating system to
    be virtualized.
   </p><p>
    <a class="xref" href="#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a> drives are defined with
    <code class="literal">-drive</code>. This option has many sub-options, some of which
    are described in this section. For the complete list, see the manual page
    (<code class="command">man 1 qemu</code>).
   </p><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">Sub-options for the <code class="literal">-drive</code> option </span></span><a title="Permalink" class="permalink" href="#id-1.12.7.5.6.4.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.12.7.5.6.4.4.2"><span class="term"><code class="literal">file=image_fname</code>
     </span></dt><dd><p>
       Specifies the path to the disk image that will be used with this drive.
       If not specified, an empty (removable) drive is assumed.
      </p></dd><dt id="id-1.12.7.5.6.4.4.3"><span class="term"><code class="literal">if=drive_interface</code>
     </span></dt><dd><p>
       Specifies the type of interface to which the drive is connected.
       Currently only <code class="literal">floppy</code>, <code class="literal">scsi</code>,
       <code class="literal">ide</code>, or <code class="literal">virtio</code> are supported by
       SUSE. <code class="literal">virtio</code> defines a paravirtualized disk driver.
       Default is <code class="literal">ide</code>.
      </p></dd><dt id="id-1.12.7.5.6.4.4.4"><span class="term"><code class="literal">index=index_of_connector</code>
     </span></dt><dd><p>
       Specifies the index number of a connector on the disk interface (see the
       <code class="literal">if</code> option) where the drive is connected. If not
       specified, the index is automatically incremented.
      </p></dd><dt id="id-1.12.7.5.6.4.4.5"><span class="term"><code class="literal">media=type</code>
     </span></dt><dd><p>
       Specifies the type of media. Can be <code class="literal">disk</code> for hard
       disks, or <code class="literal">cdrom</code> for removable CD-ROM drives.
      </p></dd><dt id="id-1.12.7.5.6.4.4.6"><span class="term"><code class="literal">format=img_fmt</code>
     </span></dt><dd><p>
       Specifies the format of the connected disk image. If not specified, the
       format is autodetected. Currently, SUSE supports
       <code class="literal">raw</code> and <code class="literal">qcow2</code> formats.
      </p></dd><dt id="id-1.12.7.5.6.4.4.7"><span class="term"><code class="literal">cache=method</code>
     </span></dt><dd><p>
       Specifies the caching method for the drive. Possible values are
       <code class="literal">unsafe</code>, <code class="literal">writethrough</code>,
       <code class="literal">writeback</code>, <code class="literal">directsync</code>, or
       <code class="literal">none</code>. To improve performance when using the
       <code class="literal">qcow2</code> image format, select
       <code class="literal">writeback</code>.
       <code class="literal">none</code> disables the host page cache and, therefore, is
       the safest option. Default for image files is
       <code class="literal">writeback</code>. For more information, see
       <a class="xref" href="#cha-cachemodes" title="Chapter 18. Disk cache modes">Chapter 18, <em>Disk cache modes</em></a>.
      </p></dd></dl></div><div id="id-1.12.7.5.6.4.5" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     To simplify defining block devices, QEMU understands several shortcuts
     which you may find handy when entering the
     <code class="literal">qemu-system-ARCH</code> command line.
    </p><p>
     You can use
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 -cdrom /images/cdrom.iso</pre></div><p>
     instead of
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 -drive format=raw,file=/images/cdrom.iso,index=2,media=cdrom</pre></div><p>
     and
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 -hda /images/imagei1.raw -hdb /images/image2.raw -hdc \
/images/image3.raw -hdd /images/image4.raw</pre></div><p>
     instead of
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 -drive format=raw,file=/images/image1.raw,index=0,media=disk \
-drive format=raw,file=/images/image2.raw,index=1,media=disk \
-drive format=raw,file=/images/image3.raw,index=2,media=disk \
-drive format=raw,file=/images/image4.raw,index=3,media=disk</pre></div></div><div id="id-1.12.7.5.6.4.6" data-id-title="Using host drives instead of images" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Using host drives instead of images</div><p>
     As an alternative to using disk images (see
     <a class="xref" href="#cha-qemu-guest-inst-qemu-img" title="34.2. Managing disk images with qemu-img">Section 34.2, “Managing disk images with <code class="command">qemu-img</code>”</a>) you can also use existing
     VM Host Server disks, connect them as drives, and access them from VM Guest.
     Use the host disk device directly instead of disk image file names.
    </p><p>
     To access the host CD-ROM drive, use
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -drive file=/dev/cdrom,media=cdrom</pre></div><p>
     To access the host hard disk, use
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -drive file=/dev/hdb,media=disk</pre></div><p>
     A host drive used by a VM Guest must not be accessed concurrently by the
     VM Host Server or another VM Guest.
    </p></div><section class="sect3" id="kvm-freedisk" data-id-title="Freeing unused guest disk space"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.3.1.1 </span><span class="title-name">Freeing unused guest disk space</span></span> <a title="Permalink" class="permalink" href="#kvm-freedisk">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     A <a class="xref" href="#gloss-vt-storage-sparse" title="Sparse image file">Sparse image file</a> is a type of disk image file
     that grows in size as the user adds data to it, taking up only as much
     disk space as is stored in it. For example, if you copy 1 GB of data
     inside the sparse disk image, its size grows by 1 GB. If you then delete
     for example 500 MB of the data, the image size does not by default
     decrease as expected.
    </p><p>
     That is why the <code class="option">discard=on</code> option is introduced on the
     KVM command line. It tells the hypervisor to automatically free the
     <span class="quote">“<span class="quote">holes</span>”</span> after deleting data from the sparse guest image. Note
     that this option is valid only for the <code class="literal">if=scsi</code> drive
     interface:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -drive format=<em class="replaceable">img_format</em>,file=<em class="replaceable">/path/to/file.img</em>,if=scsi,discard=on</pre></div><div id="id-1.12.7.5.6.4.7.5" data-id-title="Support status" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Support status</div><p>
      <code class="option">if=scsi</code> is not supported. This interface does not map to
      <span class="emphasis"><em>virtio-scsi</em></span>, but rather to the <span class="emphasis"><em>lsi SCSI
      adapter</em></span>.
     </p></div></section><section class="sect3" id="kvm-iothreads" data-id-title="IOThreads"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.3.1.2 </span><span class="title-name">IOThreads</span></span> <a title="Permalink" class="permalink" href="#kvm-iothreads">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     IOThreads are dedicated event loop threads for virtio devices to perform
     I/O requests in order to improve scalability, especially on an SMP
     VM Host Server with SMP VM Guests using many disk devices. Instead of using
     QEMU's main event loop for I/O processing, IOThreads allow spreading
     I/O work across multiple CPUs and can improve latency when properly
     configured.
    </p><p>
     IOThreads are enabled by defining IOThread objects. virtio devices can
     then use the objects for their I/O event loops. Many virtio devices can
     use a single IOThread object, or virtio devices and IOThread objects
     can be configured in a 1:1 mapping. The following example creates a
     single IOThread with ID <code class="literal">iothread0</code> which is then used
     as the event loop for two virtio-blk devices.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -object iothread,id=iothread0\
-drive if=none,id=drive0,cache=none,aio=native,\
format=raw,file=filename -device virtio-blk-pci,drive=drive0,scsi=off,\
iothread=iothread0 -drive if=none,id=drive1,cache=none,aio=native,\
format=raw,file=filename -device virtio-blk-pci,drive=drive1,scsi=off,\
iothread=iothread0 [...]</pre></div><p>
      The following qemu command line example illustrates a 1:1 virtio device
      to IOThread mapping:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -object iothread,id=iothread0\
-object iothread,id=iothread1 -drive if=none,id=drive0,cache=none,aio=native,\
format=raw,file=filename -device virtio-blk-pci,drive=drive0,scsi=off,\
iothread=iothread0 -drive if=none,id=drive1,cache=none,aio=native,\
format=raw,file=filename -device virtio-blk-pci,drive=drive1,scsi=off,\
    iothread=iothread1 [...]</pre></div></section><section class="sect3" id="kvm-virtio-blk-use-bio" data-id-title="Bio-based I/O path for virtio-blk"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.3.1.3 </span><span class="title-name">Bio-based I/O path for virtio-blk</span></span> <a title="Permalink" class="permalink" href="#kvm-virtio-blk-use-bio">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     For better performance of I/O-intensive applications, a new I/O path was
     introduced for the virtio-blk interface in kernel version 3.7. This
     bio-based block device driver skips the I/O scheduler, and thus shortens
     the I/O path in guest and has lower latency. It is especially useful for
     high-speed storage devices, such as SSD disks.
    </p><p>
     The driver is disabled by default. To use it, do the following:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Append <code class="option">virtio_blk.use_bio=1</code> to the kernel command
       line on the guest. You can do so via
       <span class="guimenu">YaST</span> › <span class="guimenu">System</span> › <span class="guimenu">Boot
       Loader</span>.
      </p><p>
       You can do it also by editing <code class="filename">/etc/default/grub</code>,
       searching for the line that contains
       <code class="option">GRUB_CMDLINE_LINUX_DEFAULT=</code>, and adding the kernel
       parameter at the end. Then run <code class="command">grub2-mkconfig
       &gt;/boot/grub2/grub.cfg</code> to update the grub2 boot menu.
      </p></li><li class="step"><p>
       Reboot the guest with the new kernel command line active.
      </p></li></ol></div></div><div id="id-1.12.7.5.6.4.9.5" data-id-title="Bio-based driver on slow devices" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Bio-based driver on slow devices</div><p>
      The bio-based virtio-blk driver does not help on slow devices such as
      spin hard disks. The reason is that the benefit of scheduling is larger
      than what the shortened bio path offers. Do not use the bio-based driver
      on slow devices.
     </p></div></section><section class="sect3" id="sec-qemu-running-devices-block-iscsi" data-id-title="Accessing iSCSI resources directly"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.3.1.4 </span><span class="title-name">Accessing iSCSI resources directly</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-running-devices-block-iscsi">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     QEMU now integrates with <code class="literal">libiscsi</code>. This allows
     QEMU to access iSCSI resources directly and use them as virtual
     machine block devices.

     This feature does not require any host iSCSI initiator
     configuration, as is needed for a libvirt iSCSI target based storage
     pool setup. Instead it directly connects guest storage interfaces
     to an iSCSI target LUN by means of the user space library libiscsi.

     iSCSI-based disk devices can also be
     specified in the libvirt XML configuration.
    </p><div id="id-1.12.7.5.6.4.10.3" data-id-title="RAW image format" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: RAW image format</div><p>
     This feature is only available using the RAW image format, as the
     iSCSI protocol has some technical limitations.
     </p></div><p>
     The following is the QEMU command line interface for iSCSI connectivity.
    </p><div id="id-1.12.7.5.6.4.10.5" data-id-title="virt-manager limitation" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: virt-manager limitation</div><p>
      The use of libiscsi based storage provisioning is not yet exposed by
      the virt-manager interface, but instead it would be configured by
      directly editing the guest xml. This new way of accessing iSCSI
      based storage is to be done at the command line.
     </p></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 -machine accel=kvm \
  -drive file=iscsi://192.168.100.1:3260/iqn.2016-08.com.example:314605ab-a88e-49af-b4eb-664808a3443b/0,\
  format=raw,if=none,id=mydrive,cache=none \
  -device ide-hd,bus=ide.0,unit=0,drive=mydrive ...</pre></div><p>
Here is an example snippet of guest domain xml which uses the protocol
based iSCSI:
</p><div class="verbatim-wrap"><pre class="screen">&lt;devices&gt;
...
  &lt;disk type='network' device='disk'&gt;
    &lt;driver name='qemu' type='raw'/&gt;
    &lt;source protocol='iscsi' name='iqn.2013-07.com.example:iscsi-nopool/2'&gt;
      &lt;host name='example.com' port='3260'/&gt;
    &lt;/source&gt;
    &lt;auth username='myuser'&gt;
      &lt;secret type='iscsi' usage='libvirtiscsi'/&gt;
    &lt;/auth&gt;
    &lt;target dev='vda' bus='virtio'/&gt;
  &lt;/disk&gt;
&lt;/devices&gt;</pre></div><p>
   Contrast that with an example which uses the host based iSCSI
   initiator which virt-manager sets up:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;devices&gt;
...
  &lt;disk type='block' device='disk'&gt;
    &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;
    &lt;source dev='/dev/disk/by-path/scsi-0:0:0:0'/&gt;
    &lt;target dev='hda' bus='ide'/&gt;
    &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;
  &lt;/disk&gt;
  &lt;controller type='ide' index='0'&gt;
    &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01'
             function='0x1'/&gt;
  &lt;/controller&gt;
&lt;/devices&gt;</pre></div></section><section class="sect3" id="qemu-devices-block-rbd" data-id-title="Using RADOS block devices with QEMU"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.3.1.5 </span><span class="title-name">Using RADOS block devices with QEMU</span></span> <a title="Permalink" class="permalink" href="#qemu-devices-block-rbd">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      RADOS Block Devices (RBD) store data in a Ceph cluster. They allow snapshotting,
      replication, and data consistency. You can use an RBD from your
      KVM-managed VM Guests similarly to how you use other block devices.
     </p><p>For more details, refer to the <a class="link" href="https://documentation.suse.com/ses/6/html/ses-all/cha-ceph-kvm.html" target="_blank">SUSE Enterprise Storage
      <em class="citetitle">Administration Guide</em>, chapter
      <em class="citetitle">Ceph as a Back-end for QEMU KVM Instance</em></a>.
     </p></section></section><section class="sect2" id="cha-qemu-running-devices-graphic" data-id-title="Graphic devices and display options"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.3.2 </span><span class="title-name">Graphic devices and display options</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-devices-graphic">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This section describes QEMU options affecting the type of the emulated
    video card and the way VM Guest graphical output is displayed.
   </p><section class="sect3" id="cha-qemu-running-devices-graphic-vga" data-id-title="Defining video cards"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.3.2.1 </span><span class="title-name">Defining video cards</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-devices-graphic-vga">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     QEMU uses <code class="literal">-vga</code> to define a video card used to display
     VM Guest graphical output. The <code class="literal">-vga</code> option understands
     the following values:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.6.5.3.3.1"><span class="term"><code class="literal">none</code>
      </span></dt><dd><p>
        Disables video cards on VM Guest (no video card is emulated). You can
        still access the running VM Guest via the serial console.
       </p></dd><dt id="id-1.12.7.5.6.5.3.3.2"><span class="term"><code class="literal">std</code>
      </span></dt><dd><p>
        Emulates a standard VESA 2.0 VBE video card. Use it if you intend to
        use high display resolution on VM Guest.
       </p></dd><dt id="id-1.12.7.5.6.5.3.3.3"><span class="term"><code class="literal">cirrus</code>
      </span></dt><dd><p>
        Emulates Cirrus Logic GD5446 video card. Good choice if you insist on
        high compatibility of the emulated video hardware. Most operating
        systems (even Windows 95) recognize this type of card.
       </p><div id="id-1.12.7.5.6.5.3.3.3.2.2" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
         For best video performance with the <code class="literal">cirrus</code> type,
         use 16-bit color depth both on VM Guest and VM Host Server.
        </p></div></dd></dl></div></section><section class="sect3" id="cha-qemu-running-devices-graphic-display" data-id-title="Display options"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.3.2.2 </span><span class="title-name">Display options</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-devices-graphic-display">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The following options affect the way VM Guest graphical output is
     displayed.
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.6.5.4.3.1"><span class="term"><code class="literal">-display gtk</code>
      </span></dt><dd><p>
        Display video output in a GTK window. This interface provides UI
        elements to configure and control the VM during runtime.
       </p></dd><dt id="id-1.12.7.5.6.5.4.3.2"><span class="term"><code class="literal">-display sdl</code>
      </span></dt><dd><p>
        Display video output via SDL, usually in a separate graphics window.
        For more information, see the SDL documentation.
       </p></dd><dt id="id-1.12.7.5.6.5.4.3.3"><span class="term"><code class="literal">-spice option[,option[,...]]</code>
      </span></dt><dd><p>
        Enables the spice remote desktop protocol.
       </p></dd><dt id="id-1.12.7.5.6.5.4.3.4"><span class="term"><code class="literal">-display vnc</code>
      </span></dt><dd><p>
        Refer to <a class="xref" href="#cha-qemu-running-vnc" title="35.5. Viewing a VM Guest with VNC">Section 35.5, “Viewing a VM Guest with VNC”</a> for more information.
       </p></dd><dt id="id-1.12.7.5.6.5.4.3.5"><span class="term"><code class="literal">-nographic</code>
      </span></dt><dd><p>
        Disables QEMU's graphical output. The emulated serial port is
        redirected to the console.
       </p><p>
        After starting the virtual machine with <code class="literal">-nographic</code>,
        press
        <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">A</span>
        <span class="keycap">H</span> in the virtual console to view the list of other
        useful shortcuts, for example, to toggle between the console and the
        QEMU monitor.
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 -hda /images/sles_base.raw -nographic

C-a h    print this help
C-a x    exit emulator
C-a s    save disk data back to file (if -snapshot)
C-a t    toggle console timestamps
C-a b    send break (magic sysrq)
C-a c    switch between console and monitor
C-a C-a  sends C-a
(pressed C-a c)

QEMU 2.3.1 monitor - type 'help' for more information
(qemu)</pre></div></dd><dt id="id-1.12.7.5.6.5.4.3.6"><span class="term"><code class="literal">-no-frame</code>
      </span></dt><dd><p>
        Disables decorations for the QEMU window. Convenient for dedicated
        desktop work space.
       </p></dd><dt id="id-1.12.7.5.6.5.4.3.7"><span class="term"><code class="literal">-full-screen</code>
      </span></dt><dd><p>
        Starts QEMU graphical output in full screen mode.
       </p></dd><dt id="id-1.12.7.5.6.5.4.3.8"><span class="term"><code class="literal">-no-quit</code>
      </span></dt><dd><p>
        Disables the close button of the QEMU window and prevents it from
        being closed by force.
       </p></dd><dt id="id-1.12.7.5.6.5.4.3.9"><span class="term"><code class="literal">-alt-grab</code>, <code class="literal">-ctrl-grab</code>
      </span></dt><dd><p>
        By default, the QEMU window releases the <span class="quote">“<span class="quote">captured</span>”</span> mouse
        after pressing
        <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span>. You can change the key combination to either
        <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">Shift</span>
        (<code class="literal">-alt-grab</code>), or the right
        <span class="keycap">Ctrl</span> key (<code class="literal">-ctrl-grab</code>).
       </p></dd></dl></div></section></section><section class="sect2" id="cha-qemu-running-devices-usb" data-id-title="USB devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.3.3 </span><span class="title-name">USB devices</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-devices-usb">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There are two ways to create USB devices usable by the VM Guest in KVM:
    you can either emulate new USB devices inside a VM Guest, or assign an
    existing host USB device to a VM Guest. To use USB devices in QEMU you
    first need to enable the generic USB driver with the <code class="option">-usb</code>
    option. Then you can specify individual devices with the
    <code class="option">-usbdevice</code> option.
   </p><section class="sect3" id="kvm-usb-emulate" data-id-title="Emulating USB devices in VM Guest"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.3.3.1 </span><span class="title-name">Emulating USB devices in VM Guest</span></span> <a title="Permalink" class="permalink" href="#kvm-usb-emulate">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     SUSE currently supports the following types of USB devices:
     <code class="literal">disk</code>, <code class="literal">host</code>,
     <code class="literal">serial</code>, <code class="literal">braille</code>,
     <code class="literal">net</code>, <code class="literal">mouse</code>, and
     <code class="literal">tablet</code>.
    </p><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">Types of USB devices for the <code class="literal">-usbdevice</code> option </span></span><a title="Permalink" class="permalink" href="#id-1.12.7.5.6.6.3.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.12.7.5.6.6.3.3.2"><span class="term"><code class="literal">disk</code>
      </span></dt><dd><p>
        Emulates a mass storage device based on file. The optional
        <code class="literal">format</code> option is used rather than detecting the
        format.
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -usbdevice
        disk:format=raw:/virt/usb_disk.raw</pre></div></dd><dt id="id-1.12.7.5.6.6.3.3.3"><span class="term"><code class="literal">host</code>
      </span></dt><dd><p>
        Pass through the host device (identified by bus.addr).
       </p></dd><dt id="id-1.12.7.5.6.6.3.3.4"><span class="term"><code class="literal">serial</code>
      </span></dt><dd><p>
        Serial converter to a host character device.
       </p></dd><dt id="id-1.12.7.5.6.6.3.3.5"><span class="term"><code class="literal">braille</code>
      </span></dt><dd><p>
        Emulates a braille device using BrlAPI to display the braille output.
       </p></dd><dt id="id-1.12.7.5.6.6.3.3.6"><span class="term"><code class="literal">net</code>
      </span></dt><dd><p>
        Emulates a network adapter that supports CDC Ethernet and RNDIS
        protocols.
       </p></dd><dt id="id-1.12.7.5.6.6.3.3.7"><span class="term"><code class="literal">mouse</code>
      </span></dt><dd><p>
        Emulates a virtual USB mouse. This option overrides the default PS/2
        mouse emulation. The following example shows the hardware status of a
        mouse on VM Guest started with <code class="literal">qemu-system-ARCH [...]
        -usbdevice mouse</code>:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> hwinfo --mouse
20: USB 00.0: 10503 USB Mouse
[Created at usb.122]
UDI: /org/freedesktop/Hal/devices/usb_device_627_1_1_if0
[...]
Hardware Class: mouse
Model: "Adomax QEMU USB Mouse"
Hotplug: USB
Vendor: usb 0x0627 "Adomax Technology Co., Ltd"
Device: usb 0x0001 "QEMU USB Mouse"
[...]</pre></div></dd><dt id="id-1.12.7.5.6.6.3.3.8"><span class="term"><code class="literal">tablet</code>
      </span></dt><dd><p>
        Emulates a pointer device that uses absolute coordinates (such as
        touchscreen). This option overrides the default PS/2 mouse emulation.
        The tablet device is useful if you are viewing VM Guest via the VNC
        protocol. See <a class="xref" href="#cha-qemu-running-vnc" title="35.5. Viewing a VM Guest with VNC">Section 35.5, “Viewing a VM Guest with VNC”</a> for more
        information.
       </p></dd></dl></div></section></section><section class="sect2" id="cha-qemu-running-devices-char" data-id-title="Character devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.3.4 </span><span class="title-name">Character devices</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-devices-char">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use <code class="literal">-chardev</code> to create a new character device. The
    option uses the following general syntax:
   </p><div class="verbatim-wrap"><pre class="screen">qemu-system-x86_64 [...] -chardev <em class="replaceable">BACKEND_TYPE</em>,id=<em class="replaceable">ID_STRING</em></pre></div><p>
    where <em class="replaceable">BACKEND_TYPE</em> can be one of
    <code class="literal">null</code>, <code class="literal">socket</code>, <code class="literal">udp</code>,
    <code class="literal">msmouse</code>, <code class="literal">vc</code>, <code class="literal">file</code>,
    <code class="literal">pipe</code>, <code class="literal">console</code>,
    <code class="literal">serial</code>, <code class="literal">pty</code>,
    <code class="literal">stdio</code>, <code class="literal">braille</code>,
    <code class="literal">tty</code>, or <code class="literal">parport</code>. All character
    devices must have a unique identification string up to 127 characters long.
    It is used to identify the device in other related directives. For the
    complete description of all back-end's sub-options, see the manual page
    (<code class="command">man 1 qemu</code>). A brief description of the available
    <code class="literal">back-ends</code> follows:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.6.7.5.1"><span class="term"><code class="literal">null</code>
     </span></dt><dd><p>
       Creates an empty device that outputs no data and drops any data it
       receives.
      </p></dd><dt id="id-1.12.7.5.6.7.5.2"><span class="term"><code class="literal">stdio</code>
     </span></dt><dd><p>
       Connects to QEMU's process standard input and standard output.
      </p></dd><dt id="id-1.12.7.5.6.7.5.3"><span class="term"><code class="literal">socket</code>
     </span></dt><dd><p>
       Creates a two-way stream socket. If <em class="replaceable">PATH</em> is
       specified, a Unix socket is created:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -chardev \
socket,id=unix_socket1,path=/tmp/unix_socket1,server</pre></div><p>
       The <em class="replaceable">SERVER</em> suboption specifies that the
       socket is a listening socket.
      </p><p>
       If <em class="replaceable">PORT</em> is specified, a TCP socket is
       created:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -chardev \
socket,id=tcp_socket1,host=localhost,port=7777,server,nowait</pre></div><p>
       The command creates a local listening (<code class="literal">server</code>) TCP
       socket on port 7777. QEMU will not block waiting for a client to
       connect to the listening port (<code class="literal">nowait</code>).
      </p></dd><dt id="id-1.12.7.5.6.7.5.4"><span class="term"><code class="literal">udp</code>
     </span></dt><dd><p>
       Sends all network traffic from VM Guest to a remote host over the UDP
       protocol.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-chardev udp,id=udp_fwd,host=mercury.example.com,port=7777</pre></div><p>
       The command binds port 7777 on the remote host mercury.example.com and sends
       VM Guest network traffic there.
      </p></dd><dt id="id-1.12.7.5.6.7.5.5"><span class="term"><code class="literal">vc</code>
     </span></dt><dd><p>
       Creates a new QEMU text console. You can optionally specify the
       dimensions of the virtual console:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -chardev vc,id=vc1,width=640,height=480 \
-mon chardev=vc1</pre></div><p>
       The command creates a new virtual console called <code class="literal">vc1</code>
       of the specified size, and connects the QEMU monitor to it.
      </p></dd><dt id="id-1.12.7.5.6.7.5.6"><span class="term"><code class="literal">file</code>
     </span></dt><dd><p>
       Logs all traffic from VM Guest to a file on VM Host Server. The
       <code class="literal">path</code> is required and will be created if it does not
       exist.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-chardev file,id=qemu_log1,path=/var/log/qemu/guest1.log</pre></div></dd></dl></div><p>
    By default QEMU creates a set of character devices for serial and
    parallel ports, and a special console for QEMU monitor. However, you can
    create your own character devices and use them for the mentioned
    purposes. The following options will help you:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.6.7.7.1"><span class="term"><code class="literal">-serial <em class="replaceable">CHAR_DEV</em></code>
     </span></dt><dd><p>
       Redirects the VM Guest's virtual serial port to a character device
       <em class="replaceable">CHAR_DEV</em> on VM Host Server. By default, it is a
       virtual console (<code class="literal">vc</code>) in graphical mode, and
       <code class="literal">stdio</code> in non-graphical mode. The
       <code class="literal">-serial</code> understands many sub-options. See the manual
       page <code class="command">man 1 qemu</code> for a complete list of them.
      </p><p>
       You can emulate up to four serial ports. Use <code class="literal">-serial
       none</code> to disable all serial ports.
      </p></dd><dt id="id-1.12.7.5.6.7.7.2"><span class="term"><code class="literal">-parallel <em class="replaceable">DEVICE</em></code>
     </span></dt><dd><p>
       Redirects the VM Guest's parallel port to a
       <em class="replaceable">DEVICE</em>. This option supports the same devices
       as <code class="literal">-serial</code>.
      </p><div id="id-1.12.7.5.6.7.7.2.2.2" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
        With <span class="phrase">SUSE Linux Enterprise Server</span> as a VM Host Server, you can directly use the hardware parallel
        port devices <code class="filename">/dev/parportN</code> where
        <code class="literal">N</code> is the number of the port.
       </p></div><p>
       You can emulate up to three parallel ports. Use <code class="literal">-parallel
       none</code> to disable all parallel ports.
      </p></dd><dt id="id-1.12.7.5.6.7.7.3"><span class="term"><code class="literal">-monitor <em class="replaceable">CHAR_DEV</em></code>
     </span></dt><dd><p>
       Redirects the QEMU monitor to a character device
       <em class="replaceable">CHAR_DEV</em> on VM Host Server. This option supports
       the same devices as <code class="literal">-serial</code>. By default, it is a
       virtual console (<code class="literal">vc</code>) in a graphical mode, and
       <code class="literal">stdio</code> in non-graphical mode.
      </p></dd></dl></div><p>
    For a complete list of available character devices back-ends, see the man
    page (<code class="command">man 1 qemu</code>).
   </p></section></section><section class="sect1" id="cha-qemu-running-networking" data-id-title="Networking in QEMU"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.4 </span><span class="title-name">Networking in QEMU</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-networking">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use the <code class="literal">-netdev</code> option in combination with
   <code class="option">-device</code> to define a specific type of networking and a
   network interface card for your VM Guest. The syntax for the
   <code class="option">-netdev</code> option is
  </p><div class="verbatim-wrap"><pre class="screen">-netdev type[,prop[=value][,...]]</pre></div><p>
   Currently, SUSE supports the following network types:
   <code class="literal">user</code>, <code class="literal">bridge</code>, and
   <code class="literal">tap</code>. For a complete list of <code class="literal">-netdev</code>
   sub-options, see the manual page (<code class="command">man 1 qemu</code>).
  </p><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">Supported <code class="literal">-netdev</code> sub-options </span></span><a title="Permalink" class="permalink" href="#id-1.12.7.5.7.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.12.7.5.7.5.2"><span class="term"><code class="literal">bridge</code>
    </span></dt><dd><p>
      Uses a specified network helper to configure the TAP interface and attach
      it to a specified bridge. For more information, see
      <a class="xref" href="#cha-qemu-running-networking-bridge" title="35.4.3. Bridged networking">Section 35.4.3, “Bridged networking”</a>.
     </p></dd><dt id="id-1.12.7.5.7.5.3"><span class="term"><code class="literal">user</code>
    </span></dt><dd><p>
      Specifies user-mode networking. For more information, see
      <a class="xref" href="#cha-qemu-running-networking-usermode" title="35.4.2. User-mode networking">Section 35.4.2, “User-mode networking”</a>.
     </p></dd><dt id="id-1.12.7.5.7.5.4"><span class="term"><code class="literal">tap</code>
    </span></dt><dd><p>
      Specifies bridged or routed networking. For more information, see
      <a class="xref" href="#cha-qemu-running-networking-bridge" title="35.4.3. Bridged networking">Section 35.4.3, “Bridged networking”</a>.
     </p></dd></dl></div><section class="sect2" id="cha-qemu-running-networking-nic" data-id-title="Defining a network interface card"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.4.1 </span><span class="title-name">Defining a network interface card</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-networking-nic">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use <code class="literal">-netdev</code> together with the related
    <code class="option">-device</code> option to add a new emulated network card:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-netdev tap<span class="callout" id="co-qemu-running-networking-nic-tap">1</span>,id=hostnet0 \
-device virtio-net-pci<span class="callout" id="co-qemu-running-networking-nic-drv">2</span>,netdev=hostnet0,vlan=1<span class="callout" id="co-qemu-running-networking-nic-vlan">3</span>,\
macaddr=00:16:35:AF:94:4B<span class="callout" id="co-qemu-running-networking-nic-mac">4</span>,name=ncard1</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-running-networking-nic-tap"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Specifies the network device type.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-running-networking-nic-drv"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Specifies the model of the network card. Use
      <code class="command">qemu-system-ARCH -device help</code> and search for the
      <code class="literal">Network devices:</code>section to get the list of all network
      card models supported by QEMU on your platform.
     </p><p>
      Currently, SUSE supports the models <code class="literal">rtl8139</code>,
      <code class="literal">e1000</code> and its variants
      <code class="literal">e1000-82540em</code>, <code class="literal">e1000-82544gc</code> and
      <code class="literal">e1000-82545em</code>, and <code class="literal">virtio-net-pci</code>.
      To view a list of options for a specific driver, add
      <code class="option">help</code> as a driver option:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 -device e1000,help
e1000.mac=macaddr
e1000.vlan=vlan
e1000.netdev=netdev
e1000.bootindex=int32
e1000.autonegotiation=on/off
e1000.mitigation=on/off
e1000.addr=pci-devfn
e1000.romfile=str
e1000.rombar=uint32
e1000.multifunction=on/off
e1000.command_serr_enable=on/off</pre></div></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-running-networking-nic-vlan"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Connects the network interface to VLAN number 1. You can specify your own
      number—it is mainly useful for identification purpose. If you omit
      this suboption, QEMU uses the default 0.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-running-networking-nic-mac"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Specifies the Media Access Control (MAC) address for the network card. It
      is a unique identifier and you are advised to always specify it. If not,
      QEMU supplies its own default MAC address and creates a possible MAC
      address conflict within the related VLAN.
     </p></td></tr></table></div></section><section class="sect2" id="cha-qemu-running-networking-usermode" data-id-title="User-mode networking"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.4.2 </span><span class="title-name">User-mode networking</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-networking-usermode">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="literal">-netdev user</code> option instructs QEMU to use
    user-mode networking. This is the default if no networking mode is
    selected. Therefore, these command lines are equivalent:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 -hda /images/sles_base.raw</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 -hda /images/sles_base.raw -netdev user,id=hostnet0</pre></div><p>
    This mode is useful if you want to allow the VM Guest to access the
    external network resources, such as the Internet. By default, no incoming
    traffic is permitted and therefore, the VM Guest is not visible to other
    machines on the network. No administrator privileges are required in this
    networking mode. The user-mode is also useful for doing a network boot on
    your VM Guest from a local directory on VM Host Server.
   </p><p>
    The VM Guest allocates an IP address from a virtual DHCP server. VM Host Server
    (the DHCP server) is reachable at 10.0.2.2, while the IP address range for
    allocation starts from 10.0.2.15. You can use <code class="command">ssh</code> to
    connect to VM Host Server at 10.0.2.2, and <code class="command">scp</code> to copy files
    back and forth.
   </p><section class="sect3" id="cha-qemu-running-networking-usermode-examples" data-id-title="Command line examples"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.4.2.1 </span><span class="title-name">Command line examples</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-networking-usermode-examples">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This section shows several examples on how to set up user-mode networking
     with QEMU.
    </p><div class="example" id="ex-qemu-net-usermode-resctrict" data-id-title="Restricted user-mode networking"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.1: </span><span class="title-name">Restricted user-mode networking </span></span><a title="Permalink" class="permalink" href="#ex-qemu-net-usermode-resctrict">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-netdev user<span class="callout" id="co-usermode-user">1</span>,id=hostnet0 \
-device virtio-net-pci,netdev=hostnet0,vlan=1<span class="callout" id="co-usermode-vlan">2</span>,name=user_net1<span class="callout" id="co-usermode-name">3</span>,restrict=yes<span class="callout" id="co-usermode-restrict">4</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-usermode-user"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Specifies user-mode networking.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-usermode-vlan"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Connects to VLAN number 1. If omitted, defaults to 0.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-usermode-name"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Specifies a human-readable name of the network stack. Useful when
        identifying it in the QEMU monitor.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-usermode-restrict"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Isolates VM Guest. It then cannot communicate with VM Host Server
        and no network packets will be routed to the external network.
       </p></td></tr></table></div></div></div><div class="example" id="ex-qemu-net-usermode-iprange" data-id-title="User-mode networking with custom IP range"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.2: </span><span class="title-name">User-mode networking with custom IP range </span></span><a title="Permalink" class="permalink" href="#ex-qemu-net-usermode-iprange">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-netdev user,id=hostnet0 \
-device virtio-net-pci,netdev=hostnet0,net=10.2.0.0/8<span class="callout" id="co-usermode-net">1</span>,host=10.2.0.6<span class="callout" id="co-usermode-host">2</span>,\
dhcpstart=10.2.0.20<span class="callout" id="co-usermode-dhcpstart">3</span>,hostname=tux_kvm_guest<span class="callout" id="co-usermode-hostname">4</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-usermode-net"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Specifies the IP address of the network that VM Guest sees and
        optionally the netmask. Default is 10.0.2.0/8.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-usermode-host"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Specifies the VM Host Server IP address that VM Guest sees. Default is
        10.0.2.2.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-usermode-dhcpstart"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Specifies the first of the 16 IP addresses that the built-in DHCP
        server can assign to VM Guest. Default is 10.0.2.15.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-usermode-hostname"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Specifies the host name that the built-in DHCP server will assign to
        VM Guest.
       </p></td></tr></table></div></div></div><div class="example" id="ex-qemu-net-usermode-netboot-tftp" data-id-title="User-mode networking with network-boot and TFTP"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.3: </span><span class="title-name">User-mode networking with network-boot and TFTP </span></span><a title="Permalink" class="permalink" href="#ex-qemu-net-usermode-netboot-tftp">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-netdev user,id=hostnet0 \
-device virtio-net-pci,netdev=hostnet0,tftp=/images/tftp_dir<span class="callout" id="co-usermode-tftp">1</span>,\
bootfile=/images/boot/pxelinux.0<span class="callout" id="co-usermode-bootfile">2</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-usermode-tftp"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Activates a built-in TFTP (a file transfer protocol with the
        functionality of a very basic FTP) server. The files in the specified
        directory will be visible to a VM Guest as the root of a TFTP server.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-usermode-bootfile"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Broadcasts the specified file as a BOOTP (a network protocol that
        offers an IP address and a network location of a boot image, often used
        in diskless workstations) file. When used together with
        <code class="literal">tftp</code>, the VM Guest can boot via the network from
        the local directory on the host.
       </p></td></tr></table></div></div></div><div class="complex-example"><div class="example" id="ex-qemu-net-usermode-hostfwd" data-id-title="User-mode networking with host port forwarding"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.4: </span><span class="title-name">User-mode networking with host port forwarding </span></span><a title="Permalink" class="permalink" href="#ex-qemu-net-usermode-hostfwd">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-netdev user,id=hostnet0 \
-device virtio-net-pci,netdev=hostnet0,hostfwd=tcp::2222-:22</pre></div><p>
      Forwards incoming TCP connections to the port 2222 on the host to the
      port 22 (<code class="systemitem">SSH</code>) on VM Guest. If
      <code class="systemitem">sshd</code> is running on VM Guest,
      enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ssh qemu_host -p 2222</pre></div><p>
      where <code class="literal">qemu_host</code> is the host name or IP address of the
      host system, to get a <code class="systemitem">SSH</code> prompt
      from VM Guest.
     </p></div></div></div></section></section><section class="sect2" id="cha-qemu-running-networking-bridge" data-id-title="Bridged networking"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.4.3 </span><span class="title-name">Bridged networking</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-networking-bridge">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    With the <code class="literal">-netdev tap</code> option, QEMU creates a network
    bridge by connecting the host TAP network device to a specified VLAN of
    VM Guest. Its network interface is then visible to the rest of the
    network. This method does not work by default and needs to be explicitly
    specified.
   </p><p>
    First, create a network bridge and add a VM Host Server physical network
    interface (usually <code class="literal">eth0</code>) to it:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start <span class="guimenu">YaST Control Center</span> and select
      <span class="guimenu">System</span> › <span class="guimenu">Network
      Settings</span>.
     </p></li><li class="step"><p>
      Click <span class="guimenu">Add</span> and select <span class="guimenu">Bridge</span> from
      the <span class="guimenu">Device Type</span> drop-down box in the
      <span class="guimenu">Hardware Dialog</span> window. Click <span class="guimenu">Next</span>.
     </p></li><li class="step"><p>
      Choose whether you need a dynamically or statically assigned IP address,
      and fill the related network settings if applicable.
     </p></li><li class="step"><p>
      In the <span class="guimenu">Bridged Devices</span> pane, select the Ethernet
      device to add to the bridge.
     </p><p>
      Click <span class="guimenu">Next</span>. When asked about adapting an already
      configured device, click <span class="guimenu">Continue</span>.
     </p></li><li class="step"><p>
      Click <span class="guimenu">OK</span> to apply the changes. Check if the bridge is
      created:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>bridge link
2: eth0 state UP : &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 master br0 \
 state forwarding priority 32 cost 100</pre></div></li></ol></div></div><section class="sect3" id="cha-qemu-running-networking-bridge-manually" data-id-title="Connecting to a bridge manually"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.4.3.1 </span><span class="title-name">Connecting to a bridge manually</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-networking-bridge-manually">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use the following example script to connect VM Guest to the newly created
     bridge interface <code class="literal">br0</code>. Several commands in the script
     are run via the <code class="command">sudo</code> mechanism because they require
     <code class="systemitem">root</code> privileges.
    </p><div id="id-1.12.7.5.7.8.5.3" data-id-title="Required software" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Required software</div><p>
      To manage a network bridge, you need to have the
      <span class="package">tunctl</span> package installed.
     </p></div><div class="verbatim-wrap"><pre class="screen">#!/bin/bash
bridge=br0<span class="callout" id="co-qemu-net-bridge-br">1</span>
tap=$(sudo tunctl -u $(whoami) -b)<span class="callout" id="co-qemu-net-bridge-tap">2</span>
sudo ip link set $tap up<span class="callout" id="co-qemu-net-bridge-up">3</span>
sleep 1s<span class="callout" id="co-qemu-net-bridge-sleep">4</span>
sudo ip link add name $bridge type bridge
sudo ip link set $bridge up
sudo ip link set $tap master $bridge<span class="callout" id="co-qemu-net-bridge-br3">5</span>
qemu-system-x86_64 -machine accel=kvm -m 512 -hda /images/sles_base.raw \
 -netdev tap,id=hostnet0 \
 -device virtio-net-pci,netdev=hostnet0,vlan=0,macaddr=00:16:35:AF:94:4B,\
 ifname=$tap<span class="callout" id="co-qemu-net-bridge-ifname">6</span>,script=no<span class="callout" id="co-qemu-net-bridge-script">7</span>,downscript=no
sudo ip link set $tap nomaster<span class="callout" id="co-qemu-net-bridge-delif">8</span>
sudo ip link set $tap down<span class="callout" id="co-qemu-net-bridge-linkdown">9</span>
sudo tunctl -d $tap<span class="callout" id="co-qemu-net-bridge-deltap">10</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-net-bridge-br"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Name of the bridge device.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-net-bridge-tap"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Prepare a new TAP device and assign it to the user who runs the script.
       TAP devices are virtual network devices often used for virtualization
       and emulation setups.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-net-bridge-up"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Bring up the newly created TAP network interface.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-net-bridge-sleep"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Make a 1-second pause to make sure the new TAP network interface is
       really up.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-net-bridge-br3"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Add the new <code class="literal">TAP</code> device to the network bridge
       <code class="literal">br0</code>.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-net-bridge-ifname"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The <code class="literal">ifname=</code> suboption specifies the name of the TAP
       network interface used for bridging.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-net-bridge-script"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Before <code class="command">qemu-system-ARCH</code> connects to a network bridge,
       it checks the <code class="literal">script</code> and
       <code class="literal">downscript</code> values. If it finds the specified scripts
       on the VM Host Server file system, it runs the <code class="literal">script</code>
       before it connects to the network bridge and
       <code class="literal">downscript</code> after it exits the network environment.
       You can use these scripts to set up and tear down the bridged interfaces.
       By default,
       <code class="filename">/etc/qemu-ifup</code> and
       <code class="filename">/etc/qemu-ifdown</code> are examined. If
       <code class="literal">script=no</code> and <code class="literal">downscript=no</code> are
       specified, the script execution is disabled and you need to take care of
       it manually.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-net-bridge-delif"><span class="callout">8</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Deletes the TAP interface from a network bridge <code class="literal">br0</code>.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-net-bridge-linkdown"><span class="callout">9</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Sets the state of the TAP device to <code class="literal">down</code>.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-net-bridge-deltap"><span class="callout">10</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Tear down the TAP device.
      </p></td></tr></table></div></section><section class="sect3" id="qemu-bridge-helper" data-id-title="Connecting to a bridge with qemu-bridge-helper"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.4.3.2 </span><span class="title-name">Connecting to a bridge with qemu-bridge-helper</span></span> <a title="Permalink" class="permalink" href="#qemu-bridge-helper">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Another way to connect VM Guest to a network through a network bridge is
     by means of the <code class="filename">qemu-bridge-helper</code> helper program. It
     configures the TAP interface for you, and attaches it to the specified
     bridge. The default helper executable is
     <code class="filename">/usr/lib/qemu-bridge-helper</code>. The helper executable is
     setuid root, which is only executable by the members of the virtualization
     group (<code class="literal">kvm</code>). Therefore the
     <code class="command">qemu-system-ARCH</code> command itself does not need to be run
     under <code class="systemitem">root</code> privileges.
    </p><p>
     The helper is automatically called when you specify a network bridge:
    </p><div class="verbatim-wrap"><pre class="screen">qemu-system-x86_64 [...] \
 -netdev bridge,id=hostnet0,vlan=0,br=br0 \
 -device virtio-net-pci,netdev=hostnet0</pre></div><p>
     You can specify your own custom helper script that will take care of the
     TAP device (de)configuration, with the
     <code class="option">helper=/path/to/your/helper</code> option:
    </p><div class="verbatim-wrap"><pre class="screen">qemu-system-x86_64 [...] \
 -netdev bridge,id=hostnet0,vlan=0,br=br0,helper=/path/to/bridge-helper \
 -device virtio-net-pci,netdev=hostnet0</pre></div><div id="id-1.12.7.5.7.8.6.7" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
      To define access privileges to <code class="literal">qemu-bridge-helper</code>,
      inspect the <code class="filename">/etc/qemu/bridge.conf</code> file. For example
      the following directive
     </p><div class="verbatim-wrap"><pre class="screen">allow br0</pre></div><p>
      allows the <code class="command">qemu-system-ARCH</code> command to connect its
      VM Guest to the network bridge <code class="literal">br0</code>.
     </p></div></section></section></section><section class="sect1" id="cha-qemu-running-vnc" data-id-title="Viewing a VM Guest with VNC"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.5 </span><span class="title-name">Viewing a VM Guest with VNC</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-vnc">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   By default QEMU uses a GTK (a cross-platform toolkit library) window to
   display the graphical output of a VM Guest.
   
   With the <code class="literal">-vnc</code> option specified, you can make QEMU
   listen on a specified VNC display and redirect its graphical output to the
   VNC session.
  </p><div id="id-1.12.7.5.8.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    When working with QEMU's virtual machine via VNC session, it is useful to
    work with the <code class="literal">-usbdevice tablet</code> option.
   </p><p>
    Moreover, if you need to use another keyboard layout than the default
    <code class="literal">en-us</code>, specify it with the <code class="literal">-k</code> option.
   </p></div><p>
   The first suboption of <code class="literal">-vnc</code> must be a
   <span class="emphasis"><em>display</em></span> value. The <code class="literal">-vnc</code> option
   understands the following display specifications:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.8.5.1"><span class="term"><code class="literal">host:display</code>
    </span></dt><dd><p>
      Only connections from <code class="literal">host</code> on the display number
      <code class="literal">display</code> will be accepted. The TCP port on which the
      VNC session is then running is normally a 5900 +
      <code class="literal">display</code> number. If you do not specify
      <code class="literal">host</code>, connections will be accepted from any host.
     </p></dd><dt id="id-1.12.7.5.8.5.2"><span class="term"><code class="literal">unix:path</code>
    </span></dt><dd><p>
      The VNC server listens for connections on Unix domain sockets. The
      <code class="literal">path</code> option specifies the location of the related Unix
      socket.
     </p></dd><dt id="id-1.12.7.5.8.5.3"><span class="term"><code class="literal">none</code>
    </span></dt><dd><p>
      The VNC server functionality is initialized, but the server itself is not
      started. You can start the VNC server later with the QEMU monitor. For
      more information, see <a class="xref" href="#cha-qemu-monitor" title="Chapter 36. Virtual machine administration using QEMU monitor">Chapter 36, <em>Virtual machine administration using QEMU monitor</em></a>.
     </p></dd></dl></div><p>
   Following the display value there may be one or more option flags separated
   by commas. Valid options are:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.5.8.7.1"><span class="term"><code class="literal">reverse</code>
    </span></dt><dd><p>
      Connect to a listening VNC client via a <span class="emphasis"><em>reverse</em></span>
      connection.
     </p></dd><dt id="id-1.12.7.5.8.7.2"><span class="term"><code class="literal">websocket</code>
    </span></dt><dd><p>
      Opens an additional TCP listening port dedicated to VNC Websocket
      connections. By definition the Websocket port is 5700+display.
     </p></dd><dt id="id-1.12.7.5.8.7.3"><span class="term"><code class="literal">password</code>
    </span></dt><dd><p>
      Require that password-based authentication is used for client
      connections.
     </p></dd><dt id="id-1.12.7.5.8.7.4"><span class="term"><code class="literal">tls</code>
    </span></dt><dd><p>
      Require that clients use TLS when communicating with the VNC server.
     </p></dd><dt id="id-1.12.7.5.8.7.5"><span class="term"><code class="literal">x509=/path/to/certificate/dir</code>
    </span></dt><dd><p>
      Valid if TLS is specified. Require that x509 credentials are used for
      negotiating the TLS session.
     </p></dd><dt id="id-1.12.7.5.8.7.6"><span class="term"><code class="literal">x509verify=/path/to/certificate/dir</code>
    </span></dt><dd><p>
      Valid if TLS is specified. Require that x509 credentials are used for
      negotiating the TLS session.
     </p></dd><dt id="id-1.12.7.5.8.7.7"><span class="term"><code class="literal">sasl</code>
    </span></dt><dd><p>
      Require that the client uses SASL to authenticate with the VNC server.
     </p></dd><dt id="id-1.12.7.5.8.7.8"><span class="term"><code class="literal">acl</code>
    </span></dt><dd><p>
      Turn on access control lists for checking of the x509 client certificate
      and SASL party.
     </p></dd><dt id="id-1.12.7.5.8.7.9"><span class="term"><code class="literal">lossy</code>
    </span></dt><dd><p>
      Enable lossy compression methods (gradient, JPEG, ...).
     </p></dd><dt id="id-1.12.7.5.8.7.10"><span class="term"><code class="literal">non-adaptive</code>
    </span></dt><dd><p>
      Disable adaptive encodings. Adaptive encodings are enabled by default.
     </p></dd><dt id="id-1.12.7.5.8.7.11"><span class="term"><code class="literal">share=[allow-exclusive|force-shared|ignore]</code>
    </span></dt><dd><p>
      Set display sharing policy.
     </p></dd></dl></div><div id="id-1.12.7.5.8.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    For more details about the display options, see the
    <span class="emphasis"><em>qemu-doc</em></span> man page.
   </p></div><p>
   An example VNC usage:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] -vnc :5
# (on the client:)
<code class="prompt user">wilber &gt; </code>vncviewer venus:5 &amp;</pre></div><div class="figure" id="id-1.12.7.5.8.11"><div class="figure-contents"><div class="mediaobject"><a href="images/qemu_sles_vnc.png"><img src="images/qemu_sles_vnc.png" width="70%" alt="QEMU VNC session" title="QEMU VNC session"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 35.2: </span><span class="title-name">QEMU VNC session </span></span><a title="Permalink" class="permalink" href="#id-1.12.7.5.8.11">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div><section class="sect2" id="cha-qemu-running-vnc-secure" data-id-title="Secure VNC connections"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.5.1 </span><span class="title-name">Secure VNC connections</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-running-vnc-secure">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The default VNC server setup does not use any form of authentication. In
    the previous example, any user can connect and view the QEMU VNC session
    from any host on the network.
   </p><p>
    There are several levels of security that you can apply to your VNC
    client/server connection. You can either protect your connection with a
    password, use x509 certificates, use SASL authentication, or even combine
    some authentication methods in one QEMU command.
   </p><p>
    
    For more information about configuring x509
    certificates on a VM Host Server and the client, see
    <a class="xref" href="#sec-libvirt-connect-remote-tls" title="12.3.2. Remote TLS/SSL connection with x509 certificate (qemu+tls or xen+tls)">Section 12.3.2, “Remote TLS/SSL connection with x509 certificate (<code class="literal">qemu+tls</code> or <code class="literal">xen+tls</code>)”</a> and
    <a class="xref" href="#sec-libvirt-connect-remote-tls-client" title="12.3.2.3. Configuring the client and testing the setup">Section 12.3.2.3, “Configuring the client and testing the setup”</a>.
   </p><p>
    The Remmina VNC viewer supports advanced authentication mechanisms.
    Therefore, it will be used to view the graphical output of VM Guest in the
    following examples. For this example, let us assume that the server x509
    certificates <code class="filename">ca-cert.pem</code>,
    <code class="filename">server-cert.pem</code>, and
    <code class="filename">server-key.pem</code> are located in the
    <code class="filename">/etc/pki/qemu</code> directory on the host.
    The client certificates can be placed in any custom directory, as Remmina
    asks for their path on the connection start-up.
   </p><div class="complex-example"><div class="example" id="ex-running-vnc-secure-pwd" data-id-title="Password authentication"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.5: </span><span class="title-name">Password authentication </span></span><a title="Permalink" class="permalink" href="#ex-running-vnc-secure-pwd">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">qemu-system-x86_64 [...] -vnc :5,password -monitor stdio</pre></div><p>
     Starts the VM Guest graphical output on VNC display number 5 (usually
     port 5905). The <code class="literal">password</code> suboption initializes a simple
     password-based authentication method. There is no password set by default
     and you need to set one with the <code class="command">change vnc password</code>
     command in QEMU monitor:
    </p><div class="verbatim-wrap"><pre class="screen">QEMU 2.3.1 monitor - type 'help' for more information
(qemu) change vnc password
Password: ****</pre></div><p>
     You need the <code class="literal">-monitor stdio</code> option here, because you
     would not be able to manage the QEMU monitor without redirecting its
     input/output.
    </p></div></div></div><div class="figure" id="id-1.12.7.5.8.12.7"><div class="figure-contents"><div class="mediaobject"><a href="images/qemu_vnc_pwd.png"><img src="images/qemu_vnc_pwd.png" width="70%" alt="Authentication dialog in Remmina" title="Authentication dialog in Remmina"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 35.3: </span><span class="title-name">Authentication dialog in Remmina </span></span><a title="Permalink" class="permalink" href="#id-1.12.7.5.8.12.7">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div></div><div class="complex-example"><div class="example" id="ex-running-vnc-secure-x509" data-id-title="x509 certificate authentication"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.6: </span><span class="title-name">x509 certificate authentication </span></span><a title="Permalink" class="permalink" href="#ex-running-vnc-secure-x509">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
     The QEMU VNC server can use TLS encryption for the session and x509
     certificates for authentication. The server asks the client for a
     certificate and validates it against the CA certificate. Use this
     authentication type if your company provides an internal certificate
     authority.
    </p><div class="verbatim-wrap"><pre class="screen">qemu-system-x86_64 [...] -vnc :5,tls,x509verify=/etc/pki/qemu</pre></div></div></div></div><div class="complex-example"><div class="example" id="ex-running-vnc-secure-pwd-x509" data-id-title="x509 certificate and password authentication"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.7: </span><span class="title-name">x509 certificate and password authentication </span></span><a title="Permalink" class="permalink" href="#ex-running-vnc-secure-pwd-x509">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
     You can combine the password authentication with TLS encryption and x509
     certificate authentication to create a two-layer authentication model for
     clients. Remember to set the password in the QEMU monitor after you run
     the following command:
    </p><div class="verbatim-wrap"><pre class="screen">qemu-system-x86_64 [...] -vnc :5,password,tls,x509verify=/etc/pki/qemu \
-monitor stdio</pre></div></div></div></div><div class="complex-example"><div class="example" id="ex-running-vnc-secure-sasl" data-id-title="SASL authentication"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.8: </span><span class="title-name">SASL authentication </span></span><a title="Permalink" class="permalink" href="#ex-running-vnc-secure-sasl">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_running_vms_qemukvm.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
     Simple Authentication and Security Layer (SASL) is a framework for
     authentication and data security in Internet protocols. It integrates
     several authentication mechanisms, like PAM, Kerberos, LDAP and more. SASL
     keeps its own user database, so the connecting user accounts do not need
     to exist on VM Host Server.
    </p><p>
     For security reasons, you are advised to combine SASL authentication with
     TLS encryption and x509 certificates:
    </p><div class="verbatim-wrap"><pre class="screen">qemu-system-x86_64 [...] -vnc :5,tls,x509,sasl -monitor stdio</pre></div></div></div></div></section></section></section><section class="chapter" id="cha-qemu-monitor" data-id-title="Virtual machine administration using QEMU monitor"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">36 </span><span class="title-name">Virtual machine administration using QEMU monitor</span></span> <a title="Permalink" class="permalink" href="#cha-qemu-monitor">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  When a virtual machine is invoked by the <code class="command">qemu-system-<em class="replaceable">ARCH</em></code> command, for
  example <code class="command">qemu-system-x86_64</code>, a monitor console is provided
  for performing interaction with the user. Using the commands available in the
  monitor console, it is possible to inspect the running operating system,
  change removable media, take screenshots or audio grabs and control other
  aspects of the virtual machine.
 </p><div id="id-1.12.7.6.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
   The following sections list selected useful QEMU monitor commands
   and their purpose. To get the full list, enter <code class="command">help</code> in
   the QEMU monitor command line.
  </p></div><section class="sect1" id="sec-qemu-monitor-access" data-id-title="Accessing monitor console"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.1 </span><span class="title-name">Accessing monitor console</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-access">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.12.7.6.5.2" data-id-title="No monitor console for libvirt" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: No monitor console for <code class="systemitem">libvirt</code></div><p>
    You can access the monitor console only if you started the virtual machine
    directly with the <code class="command">qemu-system-<em class="replaceable">ARCH</em></code> command and are viewing its graphical output
    in a native QEMU window.
   </p><p>
    If you started the virtual machine with <code class="systemitem">libvirt</code> (for example, using
    <code class="command">virt-manager</code>) and are viewing its output via VNC or Spice
    sessions, you cannot access the monitor console directly. You can, however,
    send the monitor command to the virtual machine via <code class="command">virsh</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh qemu-monitor-command <em class="replaceable">COMMAND</em></pre></div></div><p>
   The way you access the monitor console depends on which display device you
   use to view the output of a virtual machine. Find more details about
   displays in <a class="xref" href="#cha-qemu-running-devices-graphic-display" title="35.3.2.2. Display options">Section 35.3.2.2, “Display options”</a>.
   For example, to view the monitor while the <code class="option">-display gtk</code>
   option is in use, press <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">2</span>. Similarly, when the
   <code class="option">-nographic</code> option is in use, you can switch to the
   monitor console by pressing the following key combination: <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">A</span><span class="keycap">C</span>.
  </p><p>
   To get help while using the console, use <code class="command">help</code> or
   <code class="command">?</code>. To get help for a specific command, use
   <code class="command">help</code> <em class="replaceable">COMMAND</em>.
  </p></section><section class="sect1" id="sec-qemu-monitor-get" data-id-title="Getting information about the guest system"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.2 </span><span class="title-name">Getting information about the guest system</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-get">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To get information about the guest system, use
   <code class="command">info</code>. If used without any option, the list of possible
   options is printed. Options determine which part of the system will be
   analyzed:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.6.6.3.1"><span class="term"><code class="command">info version</code>
    </span></dt><dd><p>
      Shows the version of QEMU.
     </p></dd><dt id="id-1.12.7.6.6.3.2"><span class="term"><code class="command">info commands</code>
    </span></dt><dd><p>
      Lists available QMP commands.
     </p></dd><dt id="id-1.12.7.6.6.3.3"><span class="term"><code class="command">info network</code>
    </span></dt><dd><p>
      Shows the network state.
     </p></dd><dt id="id-1.12.7.6.6.3.4"><span class="term"><code class="command">info chardev</code>
    </span></dt><dd><p>
      Shows the character devices.
     </p></dd><dt id="id-1.12.7.6.6.3.5"><span class="term"><code class="command">info block</code>
    </span></dt><dd><p>
      Information about block devices, such as hard disks, floppy drives,
      or CD-ROMs.
     </p></dd><dt id="id-1.12.7.6.6.3.6"><span class="term"><code class="command">info blockstats</code>
    </span></dt><dd><p>
      Read and write statistics on block devices.
     </p></dd><dt id="id-1.12.7.6.6.3.7"><span class="term"><code class="command">info registers</code>
    </span></dt><dd><p>
      Shows the CPU registers.
     </p></dd><dt id="id-1.12.7.6.6.3.8"><span class="term"><code class="command">info cpus</code>
    </span></dt><dd><p>
      Shows information about available CPUs.
     </p></dd><dt id="id-1.12.7.6.6.3.9"><span class="term"><code class="command">info history</code>
    </span></dt><dd><p>
      Shows the command line history.
     </p></dd><dt id="id-1.12.7.6.6.3.10"><span class="term"><code class="command">info irq</code>
    </span></dt><dd><p>
      Shows the interrupt statistics.
     </p></dd><dt id="id-1.12.7.6.6.3.11"><span class="term"><code class="command">info pic</code>
    </span></dt><dd><p>
      Shows the i8259 (PIC) state.
     </p></dd><dt id="id-1.12.7.6.6.3.12"><span class="term"><code class="command">info pci</code>
    </span></dt><dd><p>
      Shows the PCI information.
     </p></dd><dt id="id-1.12.7.6.6.3.13"><span class="term"><code class="command">info tlb</code>
    </span></dt><dd><p>
      Shows virtual to physical memory mappings.
     </p></dd><dt id="id-1.12.7.6.6.3.14"><span class="term"><code class="command">info mem</code>
    </span></dt><dd><p>
      Shows the active virtual memory mappings.
     </p></dd><dt id="id-1.12.7.6.6.3.15"><span class="term"><code class="command">info jit</code>
    </span></dt><dd><p>
      Shows dynamic compiler information.
     </p></dd><dt id="id-1.12.7.6.6.3.16"><span class="term"><code class="command">info kvm</code>
    </span></dt><dd><p>
      Shows the KVM information.
     </p></dd><dt id="id-1.12.7.6.6.3.17"><span class="term"><code class="command">info numa</code>
    </span></dt><dd><p>
      Shows the NUMA information.
     </p></dd><dt id="id-1.12.7.6.6.3.18"><span class="term"><code class="command">info usb</code>
    </span></dt><dd><p>
      Shows the guest USB devices.
     </p></dd><dt id="id-1.12.7.6.6.3.19"><span class="term"><code class="command">info usbhost</code>
    </span></dt><dd><p>
      Shows the host USB devices.
     </p></dd><dt id="id-1.12.7.6.6.3.20"><span class="term"><code class="command">info profile</code>
    </span></dt><dd><p>
      Shows the profiling information.
     </p></dd><dt id="id-1.12.7.6.6.3.21"><span class="term"><code class="command">info capture</code>
    </span></dt><dd><p>
      Shows the capture (audio grab) information.
     </p></dd><dt id="id-1.12.7.6.6.3.22"><span class="term"><code class="command">info snapshots</code>
    </span></dt><dd><p>
      Shows the currently saved virtual machine snapshots.
     </p></dd><dt id="id-1.12.7.6.6.3.23"><span class="term"><code class="command">info status</code>
    </span></dt><dd><p>
      Shows the current virtual machine status.
     </p></dd><dt id="id-1.12.7.6.6.3.24"><span class="term"><code class="command">info mice</code>
    </span></dt><dd><p>
      Shows which guest mice are receiving events.
     </p></dd><dt id="id-1.12.7.6.6.3.25"><span class="term"><code class="command">info vnc</code>
    </span></dt><dd><p>
      Shows the VNC server status.
     </p></dd><dt id="id-1.12.7.6.6.3.26"><span class="term"><code class="command">info name</code>
    </span></dt><dd><p>
      Shows the current virtual machine name.
     </p></dd><dt id="id-1.12.7.6.6.3.27"><span class="term"><code class="command">info uuid</code>
    </span></dt><dd><p>
      Shows the current virtual machine UUID.
     </p></dd><dt id="id-1.12.7.6.6.3.28"><span class="term"><code class="command">info usernet</code>
    </span></dt><dd><p>
      Shows the user network stack connection states.
     </p></dd><dt id="id-1.12.7.6.6.3.29"><span class="term"><code class="command">info migrate</code>
    </span></dt><dd><p>
      Shows the migration status.
     </p></dd><dt id="id-1.12.7.6.6.3.30"><span class="term"><code class="command">info balloon</code>
    </span></dt><dd><p>
      Shows the balloon device information.
     </p></dd><dt id="id-1.12.7.6.6.3.31"><span class="term"><code class="command">info qtree</code>
    </span></dt><dd><p>
      Shows the device tree.
     </p></dd><dt id="id-1.12.7.6.6.3.32"><span class="term"><code class="command">info qdm</code>
    </span></dt><dd><p>
      Shows the qdev device model list.
     </p></dd><dt id="id-1.12.7.6.6.3.33"><span class="term"><code class="command">info roms</code>
    </span></dt><dd><p>
      Shows the ROMs.
     </p></dd><dt id="id-1.12.7.6.6.3.34"><span class="term"><code class="command">info migrate_cache_size</code>
    </span></dt><dd><p>
      Shows the current migration xbzrle (<span class="quote">“<span class="quote">Xor Based Zero Run Length
      Encoding</span>”</span>) cache size.
     </p></dd><dt id="id-1.12.7.6.6.3.35"><span class="term"><code class="command">info migrate_capabilities</code>
    </span></dt><dd><p>
      Shows the status of the various migration capabilities, such as xbzrle
      compression.
     </p></dd><dt id="id-1.12.7.6.6.3.36"><span class="term"><code class="command">info mtree</code>
    </span></dt><dd><p>
      Shows the VM Guest memory hierarchy.
     </p></dd><dt id="id-1.12.7.6.6.3.37"><span class="term"><code class="command">info trace-events</code>
    </span></dt><dd><p>
      Shows available trace-events and their status.
     </p></dd></dl></div></section><section class="sect1" id="sec-qemu-monitor-vnc-pw" data-id-title="Changing VNC password"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.3 </span><span class="title-name">Changing VNC password</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-vnc-pw">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To change the VNC password, use the <code class="command">change vnc
   password</code> command and enter the new password:
  </p><div class="verbatim-wrap"><pre class="screen">(qemu) change vnc password
Password: ********
(qemu)</pre></div></section><section class="sect1" id="sec-qemu-monitor-manage-dev" data-id-title="Managing devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.4 </span><span class="title-name">Managing devices</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-manage-dev">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To add a new disk while the guest is running (hotplug), use the
   <code class="command">drive_add</code> and <code class="command">device_add</code> commands.
   First define a new drive to be added as a device to bus 0:
  </p><div class="verbatim-wrap"><pre class="screen">(qemu) drive_add 0 if=none,file=/tmp/test.img,format=raw,id=disk1
OK</pre></div><p>
   You can confirm your new device by querying the block subsystem:
  </p><div class="verbatim-wrap"><pre class="screen">(qemu) info block
[...]
disk1: removable=1 locked=0 tray-open=0 file=/tmp/test.img ro=0 drv=raw \
encrypted=0 bps=0 bps_rd=0 bps_wr=0 iops=0 iops_rd=0 iops_wr=0</pre></div><p>
   After the new drive is defined, it needs to be connected to a device so
   that the guest can see it. The typical device would be a
   <code class="literal">virtio-blk-pci</code> or <code class="literal">scsi-disk</code>. To get
   the full list of available values, run:
  </p><div class="verbatim-wrap"><pre class="screen">(qemu) device_add ?
name "VGA", bus PCI
name "usb-storage", bus usb-bus
[...]
name "virtio-blk-pci", bus virtio-bus</pre></div><p>
   Now add the device
  </p><div class="verbatim-wrap"><pre class="screen">(qemu) device_add virtio-blk-pci,drive=disk1,id=myvirtio1</pre></div><p>
   and confirm with
  </p><div class="verbatim-wrap"><pre class="screen">(qemu) info pci
[...]
Bus  0, device   4, function 0:
    SCSI controller: PCI device 1af4:1001
      IRQ 0.
      BAR0: I/O at 0xffffffffffffffff [0x003e].
      BAR1: 32 bit memory at 0xffffffffffffffff [0x00000ffe].
      id "myvirtio1"</pre></div><div id="id-1.12.7.6.8.12" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    Devices added with the <code class="command">device_add</code> command can be
    removed from the guest with <code class="command">device_del</code>. Enter
    <code class="command">help device_del</code> on the QEMU monitor command line
    for more information.
   </p></div><p>
   To release the device or file connected to the removable media device,
   use the <code class="command">eject</code> <em class="replaceable">DEVICE</em>
   command. Use the optional <code class="option">-f</code> to force ejection.
  </p><p>
   To change removable media (like CD-ROMs), use the
   <code class="command">change</code> <em class="replaceable">DEVICE</em> command. The
   name of the removable media can be determined using the <code class="command">info
   block</code> command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(qemu) </code><code class="command">info block</code>
ide1-cd0: type=cdrom removable=1 locked=0 file=/dev/sr0 ro=1 drv=host_device
<code class="prompt user">(qemu) </code><code class="command">change ide1-cd0 /path/to/image</code></pre></div></section><section class="sect1" id="sec-qemu-monitor-keyboard" data-id-title="Controlling keyboard and mouse"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.5 </span><span class="title-name">Controlling keyboard and mouse</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-keyboard">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   It is possible to use the monitor console to emulate keyboard and mouse
   input if necessary. For example, if your graphical user interface
   intercepts some key combinations at low level (such as <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F1</span>
   in X Window), you can still enter them using the <code class="command">sendkey</code>
   <em class="replaceable">KEYS</em>:
  </p><div class="verbatim-wrap"><pre class="screen">sendkey ctrl-alt-f1</pre></div><p>
   To list the key names used in the <em class="replaceable">KEYS</em> option,
   enter <code class="command">sendkey</code> and press <span class="keycap">→|</span>.
  </p><p>
   To control the mouse, the following commands can be used:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.6.9.6.1"><span class="term"><code class="command">mouse_move</code> <em class="replaceable">DX</em> <em class="replaceable">dy</em> [<em class="replaceable">DZ</em>]
    </span></dt><dd><p>
      Move the active mouse pointer to the specified coordinates dx, dy with
      the optional scroll axis dz.
     </p></dd><dt id="id-1.12.7.6.9.6.2"><span class="term"><code class="command">mouse_button</code> <em class="replaceable">VAL</em>
    </span></dt><dd><p>
      Change the state of the mouse buttons (1=left, 2=middle, 4=right).
     </p></dd><dt id="id-1.12.7.6.9.6.3"><span class="term"><code class="command">mouse_set</code> <em class="replaceable">INDEX</em>
    </span></dt><dd><p>
      Set which mouse device receives events. Device index numbers can be
      obtained with the <code class="command">info mice</code> command.
     </p></dd></dl></div></section><section class="sect1" id="sec-qemu-monitor-memory" data-id-title="Changing available memory"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.6 </span><span class="title-name">Changing available memory</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-memory">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the virtual machine was started with the <code class="option">-balloon
   virtio</code> option (the paravirtualized balloon device is therefore
   enabled), you can change the available memory dynamically. For
   more information about enabling the balloon device, see
   <a class="xref" href="#cha-qemu-guest-inst-qemu-kvm" title="34.1. Basic installation with qemu-system-ARCH">Section 34.1, “Basic installation with <code class="command">qemu-system-ARCH</code>”</a>.
  </p><p>
   To get information about the balloon device in the monitor console and to
   determine whether the device is enabled, use the <code class="command">info
   balloon</code> command:
  </p><div class="verbatim-wrap"><pre class="screen">(qemu) info balloon</pre></div><p>
   If the balloon device is enabled, use the <code class="command">balloon</code>
   <em class="replaceable">MEMORY_IN_MB</em> command to set the requested
   amount of memory:
  </p><div class="verbatim-wrap"><pre class="screen">(qemu) balloon 400</pre></div></section><section class="sect1" id="sec-qemu-monitor-virt-memory" data-id-title="Dumping virtual machine memory"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.7 </span><span class="title-name">Dumping virtual machine memory</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-virt-memory">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To save the content of the virtual machine memory to a disk or console
   output, use the following commands:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.6.11.3.1"><span class="term"><code class="command">memsave</code><em class="replaceable">ADDR</em><em class="replaceable">SIZE</em><em class="replaceable">FILENAME</em>
    </span></dt><dd><p>
      Saves virtual memory dump starting at <em class="replaceable">ADDR</em>
      of size <em class="replaceable">SIZE</em> to file
      <em class="replaceable">FILENAME</em>
     </p></dd><dt id="id-1.12.7.6.11.3.2"><span class="term"><code class="command">pmemsave</code><em class="replaceable">ADDR</em><em class="replaceable">SIZE</em><em class="replaceable">FILENAME</em>
    </span></dt><dd><p>
      Saves physical memory dump starting at <em class="replaceable">ADDR</em>
      of size <em class="replaceable">SIZE</em> to file
      <em class="replaceable">FILENAME</em>-
     </p></dd><dt id="id-1.12.7.6.11.3.3"><span class="term">x /<em class="replaceable">FMT</em><em class="replaceable">ADDR</em>
    </span></dt><dd><p>
      Makes a virtual memory dump starting at address
      <em class="replaceable">ADDR</em> and formatted according to the
      <em class="replaceable">FMT</em> string. The
      <em class="replaceable">FMT</em> string consists of three parameters
      <code class="literal"><em class="replaceable">COUNT</em><em class="replaceable">FORMAT</em><em class="replaceable">SIZE</em></code>:
     </p><p>
      The <em class="replaceable">COUNT</em> parameter is the number of items
      to be dumped.
     </p><p>
      The <em class="replaceable">FORMAT</em> can be <code class="literal">x</code>
      (hex), <code class="literal">d</code> (signed decimal), <code class="literal">u</code>
      (unsigned decimal), <code class="literal">o</code> (octal), <code class="literal">c</code>
      (char) or <code class="literal">i</code> (assembly instruction).
     </p><p>
      The <em class="replaceable">SIZE</em> parameter can be
      <code class="literal">b</code> (8 bits), <code class="literal">h</code> (16 bits),
      <code class="literal">w</code> (32 bits) or <code class="literal">g</code> (64 bits). On
      x86, <code class="literal">h</code> or <code class="literal">w</code> can be specified
      with the <code class="literal">i</code> format to respectively select 16 or
      32-bit code instruction size.
     </p></dd><dt id="id-1.12.7.6.11.3.4"><span class="term">xp /<em class="replaceable">FMT</em><em class="replaceable">ADDR</em>
    </span></dt><dd><p>
      Makes a physical memory dump starting at address
      <em class="replaceable">ADDR</em> and formatted according to the
      <em class="replaceable">FMT</em> string. The
      <em class="replaceable">FMT</em> string consists of three parameters
      <code class="literal"><em class="replaceable">COUNT</em><em class="replaceable">FORMAT</em><em class="replaceable">SIZE</em></code>:
     </p><p>
      The <em class="replaceable">COUNT</em> parameter is the number of the
      items to be dumped.
     </p><p>
      The <em class="replaceable">FORMAT</em> can be <code class="literal">x</code>
      (hex), <code class="literal">d</code> (signed decimal), <code class="literal">u</code>
      (unsigned decimal), <code class="literal">o</code> (octal), <code class="literal">c</code>
      (char) or <code class="literal">i</code> (asm instruction).
     </p><p>
      The <em class="replaceable">SIZE</em> parameter can be
      <code class="literal">b</code> (8 bits), <code class="literal">h</code> (16 bits),
      <code class="literal">w</code> (32 bits) or <code class="literal">g</code> (64 bits). On
      x86, <code class="literal">h</code> or <code class="literal">w</code> can be specified
      with the<code class="literal">i</code> format to respectively select 16 or
      32-bit code instruction size.
     </p></dd></dl></div></section><section class="sect1" id="sec-qemu-monitor-snapshots" data-id-title="Managing virtual machine snapshots"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.8 </span><span class="title-name">Managing virtual machine snapshots</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-snapshots">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Managing snapshots in QEMU monitor is not supported by
   SUSE yet. The information found in this section may be helpful in
   specific cases.
  </p><p>
   <a class="xref" href="#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a> snapshots are snapshots of the complete
   virtual machine including the state of CPU, RAM, and the content of all
   writable disks. To use virtual machine snapshots, you must have at least
   one non-removable and writable block device using the
   <code class="literal">qcow2</code> disk image format.
  </p><p>
   Snapshots are helpful when you need to save your virtual machine in a
   particular state. For example, after you have configured network services
   on a virtualized server and want to quickly start the virtual machine in
   the same state that was saved last. You can also create a snapshot after
   the virtual machine has been powered off to create a backup state before
   you try something experimental and possibly make VM Guest unstable.
   This section introduces the former case, while the latter is described in
   <a class="xref" href="#cha-qemu-guest-inst-qemu-img-snapshots" title="34.2.3. Managing snapshots of virtual machines with qemu-img">Section 34.2.3, “Managing snapshots of virtual machines with qemu-img”</a>.
  </p><p>
   The following commands are available for managing snapshots in QEMU
   monitor:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.6.12.6.1"><span class="term"><code class="command">savevm</code><em class="replaceable">NAME</em>
    </span></dt><dd><p>
      Creates a new virtual machine snapshot under the tag
      <em class="replaceable">NAME</em> or replaces an existing snapshot.
     </p></dd><dt id="id-1.12.7.6.12.6.2"><span class="term"><code class="command">loadvm</code><em class="replaceable">NAME</em>
    </span></dt><dd><p>
      Loads a virtual machine snapshot tagged
      <em class="replaceable">NAME</em>.
     </p></dd><dt id="id-1.12.7.6.12.6.3"><span class="term"><code class="command">delvm</code>
    </span></dt><dd><p>
      Deletes a virtual machine snapshot.
     </p></dd><dt id="id-1.12.7.6.12.6.4"><span class="term"><code class="command">info snapshots</code>
    </span></dt><dd><p>
      Prints information about available snapshots.
     </p><div class="verbatim-wrap"><pre class="screen">(qemu) info snapshots
Snapshot list:
ID<span class="callout" id="co-qemu-monitor-snapshot-l-id">1</span>      TAG<span class="callout" id="co-qemu-monitor-snapshot-l-tag">2</span>                 VM SIZE<span class="callout" id="co-qemu-monitor-snapshot-l-size">3</span>   DATE<span class="callout" id="co-qemu-monitor-snapshot-l-date">4</span>          VM CLOCK<span class="callout" id="co-qemu-monitor-snapshot-l-clock">5</span>
1         booting                4.4M 2013-11-22 10:51:10   00:00:20.476
2         booted                 184M 2013-11-22 10:53:03   00:02:05.394
3         logged_in              273M 2013-11-22 11:00:25   00:04:34.843
4         ff_and_term_running    372M 2013-11-22 11:12:27   00:08:44.965</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-monitor-snapshot-l-id"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Unique identification number of the snapshot. Usually
        auto-incremented.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-monitor-snapshot-l-tag"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Unique description string of the snapshot. It is meant as a human
        readable version of the ID.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-monitor-snapshot-l-size"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        The disk space occupied by the snapshot. Note that the more memory
        is consumed by running applications, the bigger the snapshot is.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-monitor-snapshot-l-date"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Time and date the snapshot was created.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-qemu-monitor-snapshot-l-clock"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        The current state of the virtual machine's clock.
       </p></td></tr></table></div></dd></dl></div></section><section class="sect1" id="sec-qemu-monitor-suspend" data-id-title="Suspending and resuming virtual machine execution"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.9 </span><span class="title-name">Suspending and resuming virtual machine execution</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-suspend">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following commands are available for suspending and resuming virtual
   machines:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.7.6.13.3.1"><span class="term"><code class="command">stop</code>
    </span></dt><dd><p>
      Suspends the execution of the virtual machine.
     </p></dd><dt id="id-1.12.7.6.13.3.2"><span class="term"><code class="command">cont</code>
    </span></dt><dd><p>
      Resumes the execution of the virtual machine.
     </p></dd><dt id="id-1.12.7.6.13.3.3"><span class="term"><code class="command">system_reset</code>
    </span></dt><dd><p>
      Resets the virtual machine. The effect is similar to the reset button
      on a physical machine. This may leave the file system in an unclean
      state.
     </p></dd><dt id="id-1.12.7.6.13.3.4"><span class="term"><code class="command">system_powerdown</code>
    </span></dt><dd><p>
      Sends an <a class="xref" href="#gloss-vt-acpi" title="ACPI">ACPI</a> shutdown request to the
      machine. The effect is similar to the power button on a physical
      machine.
     </p></dd><dt id="id-1.12.7.6.13.3.5"><span class="term"><code class="command">q</code> or <code class="command">quit</code>
    </span></dt><dd><p>
      Terminates QEMU immediately.
     </p></dd></dl></div></section><section class="sect1" id="sec-qemu-monitor-migrate" data-id-title="Live migration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.10 </span><span class="title-name">Live migration</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-migrate">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The live migration process allows to transmit any virtual machine from
   one host system to another host system without any interruption in
   availability. It is possible to change hosts permanently or only during
   maintenance.
  </p><p>
   The requirements for live migration:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     All requirements from
     <a class="xref" href="#libvirt-admin-live-migration-requirements" title="11.7.1. Migration requirements">Section 11.7.1, “Migration requirements”</a> are
     applicable.
    </p></li><li class="listitem"><p>
     Live migration is only possible between VM Host Servers with the same CPU
     features.
    </p></li><li class="listitem"><p>
     <a class="xref" href="#gloss-vt-storage-ahci" title="AHCI">AHCI</a> interface,
     <a class="xref" href="#gloss-vt-virtfs" title="VirtFS">VirtFS</a> feature, and the
     <code class="option">-mem-path</code> command line option are not compatible with
     migration.
    </p></li><li class="listitem"><p>
     The guest on the source and destination hosts must be started in the
     same way.
    </p></li><li class="listitem"><p>
     <code class="option">-snapshot</code> qemu command line option should not be used
     for migration (and this <code class="command">qemu</code> command line option is
     not supported).
    </p></li></ul></div><div id="id-1.12.7.6.14.5" data-id-title="Support status" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Support status</div><p>
    The <code class="literal">postcopy</code> mode is not yet supported in
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>.  It is released as a technology preview only.  For
    more information about <code class="literal">postcopy</code>, see <a class="link" href="http://wiki.qemu.org/Features/PostCopyLiveMigration" target="_blank">http://wiki.qemu.org/Features/PostCopyLiveMigration</a>.
   </p></div><p>
   More recommendations can be found at the following Web site:
   <a class="link" href="http://www.linux-kvm.org/page/Migration" target="_blank">http://www.linux-kvm.org/page/Migration</a>
  </p><p>
   The live migration process has the following steps:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     The virtual machine instance is running on the source host.
    </p></li><li class="step"><p>
     The virtual machine is started on the destination host in the frozen
     listening mode. The parameters used are the same as on the source host
     plus the <code class="option">-incoming
     tcp:<em class="replaceable">IP</em>:<em class="replaceable">PORT</em></code>
     parameter, where <em class="replaceable">IP</em> specifies the IP address
     and <em class="replaceable">PORT</em> specifies the port for listening to
     the incoming migration. If 0 is set as IP address, the virtual machine
     listens on all interfaces.
    </p></li><li class="step"><p>
     On the source host, switch to the monitor console and use the
     <code class="command">migrate -d tcp:</code>
     <em class="replaceable">DESTINATION_IP</em>:<em class="replaceable">PORT</em>
     command to initiate the migration.
    </p></li><li class="step"><p>
     To determine the state of the migration, use the <code class="command">info
     migrate</code> command in the monitor console on the source host.
    </p></li><li class="step"><p>
     To cancel the migration, use the <code class="command">migrate_cancel</code>
     command in the monitor console on the source host.
    </p></li><li class="step"><p>
     To set the maximum tolerable downtime for migration in seconds, use the
     <code class="command">migrate_set_downtime</code>
     <em class="replaceable">NUMBER_OF_SECONDS</em> command.
    </p></li><li class="step"><p>
     To set the maximum speed for migration in bytes per second, use the
     <code class="command">migrate_set_speed</code>
     <em class="replaceable">BYTES_PER_SECOND</em> command.
    </p></li></ol></div></div></section><section class="sect1" id="qemu-monitor-qmp" data-id-title="QMP - QEMU machine protocol"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.11 </span><span class="title-name">QMP - QEMU machine protocol</span></span> <a title="Permalink" class="permalink" href="#qemu-monitor-qmp">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   QMP is a JSON-based protocol that allows applications—such as
   <code class="systemitem">libvirt</code>—to communicate with a running QEMU instance.
   There are several ways you can access the QEMU monitor using QMP
   commands.
  </p><section class="sect2" id="sec-qemu-monitor-qmp-io" data-id-title="Access QMP via standard input/output"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">36.11.1 </span><span class="title-name">Access QMP via standard input/output</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-qmp-io">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The most flexible way to use QMP is by specifying the
    <code class="option">-mon</code> option. The following example creates a QMP
    instance using standard input/output. Note that in the following
    examples, <code class="literal">-&gt;</code> marks lines with commands sent
    from client to the running QEMU instance, while
    <code class="literal">&lt;-</code> marks lines with the output returned from
    QEMU.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-chardev stdio,id=mon0 \
-mon chardev=mon0,mode=control,pretty=on

&lt;- {
    "QMP": {
        "version": {
            "qemu": {
                "micro": 0,
                "minor": 0,
                "major": 2
            },
            "package": ""
        },
        "capabilities": [
        ]
    }
}</pre></div><p>
    When a new QMP connection is established, QMP sends its greeting message
    and enters capabilities negotiation mode. In this mode, only the
    <code class="command">qmp_capabilities</code> command works. To exit capabilities
    negotiation mode and enter command mode, the
    <code class="command">qmp_capabilities</code> command must be issued first:
   </p><div class="verbatim-wrap"><pre class="screen">-&gt; { "execute": "qmp_capabilities" }
&lt;- {
    "return": {
    }
}</pre></div><p>
    Note that <code class="literal">"return": {}</code> is a QMP's success response.
   </p><p>
    QMP's commands can have arguments. For example to eject a CD-ROM drive,
    enter the following:
   </p><div class="verbatim-wrap"><pre class="screen">-&gt;{ "execute": "eject", "arguments": { "device": "ide1-cd0" } }
&lt;- {
    "timestamp": {
        "seconds": 1410353381,
        "microseconds": 763480
    },
    "event": "DEVICE_TRAY_MOVED",
    "data": {
        "device": "ide1-cd0",
        "tray-open": true
    }
}
{
    "return": {
    }
}</pre></div></section><section class="sect2" id="sec-qemu-monitor-qmp-telnet" data-id-title="Access QMP via telnet"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">36.11.2 </span><span class="title-name">Access QMP via telnet</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-qmp-telnet">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Instead of the standard input/output, you can connect the QMP interface
    to a network socket and communicate with it via a specified port:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-chardev socket,id=mon0,host=localhost,port=4444,server,nowait \
-mon chardev=mon0,mode=control,pretty=on</pre></div><p>
    And then run telnet to connect to port 4444:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>telnet localhost 4444
Trying ::1...
Connected to localhost.
Escape character is '^]'.
&lt;- {
    "QMP": {
        "version": {
            "qemu": {
                "micro": 0,
                "minor": 0,
                "major": 2
            },
            "package": ""
        },
        "capabilities": [
        ]
    }
}</pre></div><p>
    You can create several monitor interfaces at the same time. The
    following example creates one HMP instance—human monitor which
    understands 'normal' QEMU monitor's commands—on the
    standard input/output, and one QMP instance on localhost port 4444:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-chardev stdio,id=mon0 -mon chardev=mon0,mode=readline \
-chardev socket,id=mon1,host=localhost,port=4444,server,nowait \
  -mon chardev=mon1,mode=control,pretty=on</pre></div></section><section class="sect2" id="sec-qemu-monitor-qmp-socket" data-id-title="Access QMP via Unix socket"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">36.11.3 </span><span class="title-name">Access QMP via Unix socket</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-qmp-socket">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Invoke QEMU using the <code class="option">-qmp</code> option, and create a
    Unix socket:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> qemu-system-x86_64 [...] \
-qmp unix:/tmp/qmp-sock,server --monitor stdio

QEMU waiting for connection on: unix:./qmp-sock,server</pre></div><p>
    To communicate with the QEMU instance via the
    <code class="literal">/tmp/qmp-sock</code> socket, use <code class="command">nc</code> (see
    <code class="command">man 1 nc</code> for more information) from another terminal
    on the same host:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> nc -U /tmp/qmp-sock
&lt;- {"QMP": {"version": {"qemu": {"micro": 0, "minor": 0, "major": 2} [...]</pre></div></section><section class="sect2" id="sec-qemu-monitor-qmp-virsh" data-id-title="Access QMP via libvirts virsh command"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">36.11.4 </span><span class="title-name">Access QMP via <code class="systemitem">libvirt</code>'s <code class="command">virsh</code> command</span></span> <a title="Permalink" class="permalink" href="#sec-qemu-monitor-qmp-virsh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/qemu_monitor.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you run your virtual machines under <code class="systemitem">libvirt</code> (see
    <a class="xref" href="#part-virt-libvirt" title="Part II. Managing virtual machines with libvirt">Part II, “Managing virtual machines with <code class="systemitem">libvirt</code>”</a>), you can communicate with its
    running guests by running the <code class="command">virsh
    qemu-monitor-command</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh qemu-monitor-command vm_guest1 \
--pretty '{"execute":"query-kvm"}'
&lt;- {
    "return": {
        "enabled": true,
        "present": true
    },
    "id": "libvirt-8"
}</pre></div><p>
    In the above example, we ran the simple command
    <code class="command">query-kvm</code> which checks if the host is capable of
    running KVM and if KVM is enabled.
   </p><div id="id-1.12.7.6.15.6.5" data-id-title="Generating human-readable output" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Generating human-readable output</div><p>
     To use the standard human-readable output format of QEMU
     instead of the JSON format, use the <code class="option">--hmp</code>
     option:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh qemu-monitor-command vm_guest1 --hmp "query-kvm"</pre></div></div></section></section></section></div><div class="part" id="part-virt-troubleshoot" data-id-title="Troubleshooting"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part VI </span><span class="title-name">Troubleshooting </span></span><a title="Permalink" class="permalink" href="#part-virt-troubleshoot">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/book_virtualization.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-virt-help"><span class="title-number">37 </span><span class="title-name">Integrated help and package documentation</span></a></span></li><dd class="toc-abstract"><p>Various virtualization packages provide commands for managing many aspects of a virtualization host. It is not possible or expected to remember all options supported by these commands. A basic installation of a Xen or KVM host includes manual pages and integrated help for shell commands. The documen…</p></dd><li><span class="chapter"><a href="#cha-virt-logs"><span class="title-number">38 </span><span class="title-name">Gathering system information and logs</span></a></span></li><dd class="toc-abstract"><p>
  When a virtualization host encounters a problem, it is often necessary to
  collect a detailed system report, which can be done with the help of the
  <code class="command">supportconfig</code> tool. See <a class="link" href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-adm-support.html" target="_blank">https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-adm-support.html</a>
  for more information about <code class="command">supportconfig</code>.
 </p></dd></ul></div><section class="chapter" id="cha-virt-help" data-id-title="Integrated help and package documentation"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">37 </span><span class="title-name">Integrated help and package documentation</span></span> <a title="Permalink" class="permalink" href="#cha-virt-help">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_help.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Various virtualization packages provide commands for managing many aspects
  of a virtualization host. It is not possible or expected to remember all
  options supported by these commands. A basic installation of a Xen or KVM
  host includes manual pages and integrated help for shell commands. The
  documentation sub-packages provide additional content beyond what is provided
  by the basic installation.
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.8.2.4.1"><span class="term">Manual pages for shell commands</span></dt><dd><p>
     Most commands include a manual page that provides detailed information about
     the command, describes any options, and in some cases gives example command
     usage. For example, to see the manual for the <code class="command">virt-install</code>
     command type:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>man virt-install</pre></div></dd><dt id="id-1.12.8.2.4.2"><span class="term">Integrated help for shell commands</span></dt><dd><p>
     Commands also include integrated help, providing more compact and topic-driven
     documentation. For example, to see a brief description of the
     <code class="command">virt-install</code> command type:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-install --help</pre></div><p>
     Integrated help can also be used to see the details of a specific option. For
     example, to see the sub-options supported by the disk option type:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virt-install --disk help</pre></div></dd><dt id="id-1.12.8.2.4.3"><span class="term">Documentation sub-packages</span></dt><dd><p>
     Many of the virtualization packages provide additional content in their
     documentation sub-package. As an example, the <span class="package">libvirt-doc</span> package contains
     all the documentation available at <a class="link" href="http://libvirt.org" target="_blank">http://libvirt.org</a>, plus sample code
     demonstrating the use of the libvirt C API. Use the <code class="command">rpm</code> command
     to view the contents of a documentation sub-package. For example, to see the
     contents of <span class="package">libvirt-doc</span>:
    </p><div class="verbatim-wrap"><pre class="screen">rpm -ql libvirt-doc</pre></div></dd></dl></div></section><section class="chapter" id="cha-virt-logs" data-id-title="Gathering system information and logs"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">38 </span><span class="title-name">Gathering system information and logs</span></span> <a title="Permalink" class="permalink" href="#cha-virt-logs">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_logs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  When a virtualization host encounters a problem, it is often necessary to
  collect a detailed system report, which can be done with the help of the
  <code class="command">supportconfig</code> tool. See <a class="link" href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-adm-support.html" target="_blank">https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-adm-support.html</a>
  for more information about <code class="command">supportconfig</code>.
 </p><p>
  In some cases, the information gathered by <code class="command">supportconfig</code>
  is insufficient, and logs generated from a custom logging or debugging
  configuration might be required to determine the cause of a problem.
 </p><section class="sect1" id="sec-logs-libvirt" data-id-title="libvirt log controls"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">38.1 </span><span class="title-name"><code class="systemitem">libvirt</code> log controls</span></span> <a title="Permalink" class="permalink" href="#sec-logs-libvirt">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/virt_logs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="systemitem">libvirt</code> provides logging facilities for both the library and the daemon.
   The behavior of the logging facility is controlled by adjusting the log level,
   filter, and output settings.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.8.3.5.3.1"><span class="term">Log level</span></dt><dd><p>
    <code class="systemitem">libvirt</code> log messages are classified into four priority levels: DEBUG,
    INFO, WARNING, and ERROR. The DEBUG level is very verbose and capable of
    generating gigabytes of information in a short time. The volume of log
    messages progressively decreases with the INFO, WARNING, and ERROR log
    levels. ERROR is the default log level.
   </p></dd><dt id="id-1.12.8.3.5.3.2"><span class="term">Log filters</span></dt><dd><p>
    Log filters provide a way to log only messages matching a specific
    component and log level. Log filters allow collecting the verbose DEBUG
    log messages of specific components, but only ERROR level log messages from
    the rest of the system. By default, no log filters are defined.
   </p></dd><dt id="id-1.12.8.3.5.3.3"><span class="term">Log outputs</span></dt><dd><p>
    Log outputs allow specifying where the filtered log messages are sent.
    Messages can be sent to a file, the standard error stream of the process,
    or journald. By default, filtered log messages are sent to journald.
   </p></dd></dl></div><p>
   See <a class="link" href="https://libvirt.org/logging.html" target="_blank">https://libvirt.org/logging.html</a> for more details
   on <code class="systemitem">libvirt</code>'s log controls.
  </p><p>
   A default <code class="systemitem">libvirt</code> installation has the log level set to ERROR, no log filters
   defined, and log outputs set to journald. Log messages from the <code class="systemitem">libvirt</code>
   daemon can be viewed with the <code class="command">journalctl</code> command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>jounalctl --unit libvirtd</pre></div><p>
   The default log facility settings are fine for normal operations and
   provide useful messages for applications and users of <code class="systemitem">libvirt</code>, but
   internal issues often require DEBUG level messages. As an example,
   consider a potential bug in the interaction between <code class="systemitem">libvirt</code> and the
   QEMU monitor. In this case, we only need to see the debug messages of
   the communication between <code class="systemitem">libvirt</code> and QEMU. The following example
   creates a log filter to select debug messages from the QEMU driver
   and send them to a file named <code class="filename">/tmp/libvirtd.log</code>
  </p><div class="verbatim-wrap"><pre class="screen">   log_filters="1:qemu.qemu_monitor_json"
   log_outputs="1:file:/tmp/libvirtd.log"</pre></div><p>
   Log controls for the <code class="systemitem">libvirt</code> daemon can be found in
   <code class="filename">/etc/libvirt/libvirtd.conf</code>. The daemon must be
   restarted after making any changes to the configuration file.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl restart libvirtd.service</pre></div></section></section></div><section class="glossary"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number"> </span><span class="title-name">Glossary</span></span> <a title="Permalink" class="permalink" href="#gloss-vt-glossary">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vt_glossary.xml" title="Edit source document"> </a></div></div></div></div></div><div class="line"/><div class="glossdiv" id="gloss-vt-general" data-id-title="General"><h3 class="title">General</h3><dl><dt id="gloss-vt-createvm"><span><span class="glossterm">Create Virtual Machine Wizard</span> <a title="Permalink" class="permalink" href="#gloss-vt-createvm">#</a></span></dt><dd class="glossdef"><p>
     A software program available in YaST and Virtual Machine Manager
     that provides a graphical interface to guide you through the steps to
     create virtual machines. It can also be run in text mode by entering
     <code class="command">virt-install</code> at a command prompt in the host
     environment.
    </p></dd><dt id="gloss-vt-dom0"><span><span class="glossterm">Dom0</span> <a title="Permalink" class="permalink" href="#gloss-vt-dom0">#</a></span></dt><dd class="glossdef"><p>
     The term is used in Xen environments, and refers to a virtual
     machine. The host operating system is actually a virtual machine
     running in a privileged domain and can be called Dom0. All
     other virtual machines on the host run in unprivileged domains and can
     be called domain U's.
    </p></dd><dt id="gloss-vt-hwassisted"><span><span class="glossterm">hardware-assisted</span> <a title="Permalink" class="permalink" href="#gloss-vt-hwassisted">#</a></span></dt><dd class="glossdef"><p>
     Intel* and AMD* provide virtualization hardware-assisted technology.
     This reduces the frequency of VM IN/OUT (fewer VM traps), because software
     is a major source of overhead, and increases the efficiency (the
     execution is done by the hardware). Moreover, this reduces the memory
     footprint, provides better resource control, and allows secure
     assignment of specific I/O devices.
    </p></dd><dt id="gloss-vt-hostenv"><span><span class="glossterm">Host Environment</span> <a title="Permalink" class="permalink" href="#gloss-vt-hostenv">#</a></span></dt><dd class="glossdef"><p>
     The desktop or command line environment that allows interaction with
     the host computer's environment. It provides a command line environment
     and can also include a graphical desktop, such as GNOME or IceWM. The
     host environment runs as a special type of virtual machine that has
     privileges to control and manage other virtual machines. Other commonly
     used terms include <a class="xref" href="#gloss-vt-dom0" title="Dom0">Dom0</a>, privileged domain,
     and host operating system.
    </p></dd><dt id="gloss-vt-hypervisor"><span><span class="glossterm">Hypervisor</span> <a title="Permalink" class="permalink" href="#gloss-vt-hypervisor">#</a></span></dt><dd class="glossdef"><p>
     The software that coordinates the low-level interaction between virtual
     machines and the underlying physical computer hardware.
    </p></dd><dt id="gloss-vt-kvm"><span><span class="glossterm">KVM</span> <a title="Permalink" class="permalink" href="#gloss-vt-kvm">#</a></span></dt><dd class="glossdef"><p>
     See <a class="xref" href="#cha-kvm-intro" title="Chapter 4. Introduction to KVM virtualization">Chapter 4, <em>Introduction to KVM virtualization</em></a>
    </p></dd><dt id="gloss-vt-parafb"><span><span class="glossterm">Paravirtualized Frame Buffer</span> <a title="Permalink" class="permalink" href="#gloss-vt-parafb">#</a></span></dt><dd class="glossdef"><p>
     The video output device that drives a video display from a memory
     buffer containing a complete frame of data for virtual machine displays
     running in paravirtual mode.
    </p></dd><dt id="gloss-vt-vhs"><span><span class="glossterm">VHS</span> <a title="Permalink" class="permalink" href="#gloss-vt-vhs">#</a></span></dt><dd class="glossdef"><p>
     Virtualization Host Server
    </p><p>
     The physical computer running a SUSE virtualization platform
     software. The virtualization environment consists of the hypervisor,
     the host environment, virtual machines, and associated tools, commands,
     and configuration files. Other commonly used terms include host, Host
     Computer, Host Machine (HM), Virtual Server (VS), Virtual Machine Host
     (VMH), and VM Host Server (VHS).
    </p></dd><dt id="gloss-vt-virtfs"><span><span class="glossterm">VirtFS</span> <a title="Permalink" class="permalink" href="#gloss-vt-virtfs">#</a></span></dt><dd class="glossdef"><p>
     VirtFS is a new paravirtualized file system interface designed for
     improving pass-through technologies in the KVM environment. It is based
     on the VirtIO framework.
    </p></dd><dt id="gloss-vt-vm"><span><span class="glossterm">Virtual Machine</span> <a title="Permalink" class="permalink" href="#gloss-vt-vm">#</a></span></dt><dd class="glossdef"><p>
     A virtualized PC environment (VM) capable of hosting a guest operating
     system and associated applications. Could be also called a
     VM Guest.
    </p></dd><dt id="gloss-vt-vmm"><span><span class="glossterm">Virtual Machine Manager</span> <a title="Permalink" class="permalink" href="#gloss-vt-vmm">#</a></span></dt><dd class="glossdef"><p>
     A software program that provides a graphical user interface for
     creating and managing virtual machines.
    </p></dd><dt id="gloss-vt-virtualized"><span><span class="glossterm">Virtualized</span> <a title="Permalink" class="permalink" href="#gloss-vt-virtualized">#</a></span></dt><dd class="glossdef"><p>
     A guest operating system or application running on a virtual machine.
    </p></dd><dt id="gloss-vt-xen"><span><span class="glossterm">Xen</span> <a title="Permalink" class="permalink" href="#gloss-vt-xen">#</a></span></dt><dd class="glossdef"><p>
     See <a class="xref" href="#cha-xen-basics" title="Chapter 3. Introduction to Xen virtualization">Chapter 3, <em>Introduction to Xen virtualization</em></a>
    </p></dd><dt id="gloss-vt-xl"><span><span class="glossterm">xl</span> <a title="Permalink" class="permalink" href="#gloss-vt-xl">#</a></span></dt><dd class="glossdef"><p>
     A set of commands for Xen that lets administrators manage virtual
     machines from a command prompt on the host computer. It replaced the
     deprecated <code class="command">xm</code> tool stack.
    </p></dd></dl></div><div class="glossdiv" id="gloss-vt-cpu" data-id-title="CPU"><h3 class="title">CPU</h3><dl><dt id="gloss-vt-cpu-capping"><span><span class="glossterm">CPU capping</span> <a title="Permalink" class="permalink" href="#gloss-vt-cpu-capping">#</a></span></dt><dd class="glossdef"><p>
     Virtual CPU capping allows you to set vCPU capacity to 1–100 percent
     of the physical CPU capacity.
    </p></dd><dt id="gloss-vt-cpu-hotplug"><span><span class="glossterm">CPU hotplugging</span> <a title="Permalink" class="permalink" href="#gloss-vt-cpu-hotplug">#</a></span></dt><dd class="glossdef"><p>
     CPU hotplugging is used to describe the functions of
     replacing/adding/removing a CPU without shutting down the system.
    </p></dd><dt id="gloss-vt-cpu-overcommit"><span><span class="glossterm">CPU over-commitment</span> <a title="Permalink" class="permalink" href="#gloss-vt-cpu-overcommit">#</a></span></dt><dd class="glossdef"><p>
     Virtual CPU over-commitment is the ability to assign more virtual CPUs
     to VMs than the actual number of physical CPUs present in the physical
     system. This procedure does not increase the overall performance of the
     system, but might be useful for testing purposes.
    </p></dd><dt id="gloss-vt-cpu-pinning"><span><span class="glossterm">CPU pinning</span> <a title="Permalink" class="permalink" href="#gloss-vt-cpu-pinning">#</a></span></dt><dd class="glossdef"><p>
     Processor affinity, or CPU pinning enables the binding and unbinding of
     a process or a thread to a central processing unit (CPU) or a range of
     CPUs.
    </p></dd></dl></div><div class="glossdiv" id="gloss-vt-network" data-id-title="Network"><h3 class="title">Network</h3><dl><dt id="gloss-vt-network-bridgenet"><span><span class="glossterm">Bridged Networking</span> <a title="Permalink" class="permalink" href="#gloss-vt-network-bridgenet">#</a></span></dt><dd class="glossdef"><p>
     A type of network connection that lets a virtual machine be identified
     on an external network as a unique identity that is separate from and
     unrelated to its host computer.
    </p></dd><dt id="gloss-vt-network-emptybridge"><span><span class="glossterm">Empty Bridge</span> <a title="Permalink" class="permalink" href="#gloss-vt-network-emptybridge">#</a></span></dt><dd class="glossdef"><p>
     A type of network bridge that has no physical network device or virtual
     network device provided by the host. This lets virtual machines
     communicate with other virtual machines on the same host but not with
     the host or on an external network.
    </p></dd><dt id="gloss-vt-network-externalnet"><span><span class="glossterm">External Network</span> <a title="Permalink" class="permalink" href="#gloss-vt-network-externalnet">#</a></span></dt><dd class="glossdef"><p>
     The network outside a host's internal network environment.
    </p></dd><dt id="gloss-vt-network-internalnetwork"><span><span class="glossterm">Internal Network</span> <a title="Permalink" class="permalink" href="#gloss-vt-network-internalnetwork">#</a></span></dt><dd class="glossdef"><p>
     A type of network configuration that restricts virtual machines to
     their host environment.
    </p></dd><dt id="gloss-vt-network-localbridge"><span><span class="glossterm">Local Bridge</span> <a title="Permalink" class="permalink" href="#gloss-vt-network-localbridge">#</a></span></dt><dd class="glossdef"><p>
     A type of network bridge that has a virtual network device but no
     physical network device provided by the host. This lets virtual
     machines communicate with the host and other virtual machines on the
     host. Virtual machines can communicate on an external network through
     the host.
    </p></dd><dt id="gloss-vt-network-nat"><span><span class="glossterm">Network Address Translation (NAT)</span> <a title="Permalink" class="permalink" href="#gloss-vt-network-nat">#</a></span></dt><dd class="glossdef"><p>
     A type of network connection that lets a virtual machine use the IP
     address and MAC address of the host.
    </p></dd><dt id="gloss-vt-network-nohostbridge"><span><span class="glossterm">No Host Bridge</span> <a title="Permalink" class="permalink" href="#gloss-vt-network-nohostbridge">#</a></span></dt><dd class="glossdef"><p>
     A type of network bridge that has a physical network device but no
     virtual network device provided by the host. This lets virtual machines
     communicate on an external network but not with the host. This lets you
     separate virtual machine network communications from the host
     environment.
    </p></dd><dt id="gloss-vt-network-traditionalbridge"><span><span class="glossterm">Traditional Bridge</span> <a title="Permalink" class="permalink" href="#gloss-vt-network-traditionalbridge">#</a></span></dt><dd class="glossdef"><p>
     A type of network bridge that has both a physical network device and a
     virtual network device provided by the host.
    </p></dd></dl></div><div class="glossdiv" id="gloss-vt-storage" data-id-title="Storage"><h3 class="title">Storage</h3><dl><dt id="gloss-vt-storage-ahci"><span><span class="glossterm">AHCI</span> <a title="Permalink" class="permalink" href="#gloss-vt-storage-ahci">#</a></span></dt><dd class="glossdef"><p>
     The Advanced Host Controller Interface (AHCI) is a technical standard
     defined by Intel* that specifies the operation of Serial ATA (SATA)
     host bus adapters in a non-implementation-specific manner.
    </p></dd><dt id="gloss-vt-storage-bd"><span><span class="glossterm">Block Device</span> <a title="Permalink" class="permalink" href="#gloss-vt-storage-bd">#</a></span></dt><dd class="glossdef"><p>
     Data storage devices, such as CD-ROM drives or disk drives, that move
     data in the form of blocks. Partitions and volumes are also considered
     block devices.
    </p></dd><dt id="gloss-vt-storage-fbvd"><span><span class="glossterm">File-Backed Virtual Disk</span> <a title="Permalink" class="permalink" href="#gloss-vt-storage-fbvd">#</a></span></dt><dd class="glossdef"><p>
     A virtual disk based on a file, also called a disk image file.
    </p></dd><dt id="gloss-vt-storage-rawdisk"><span><span class="glossterm">Raw Disk</span> <a title="Permalink" class="permalink" href="#gloss-vt-storage-rawdisk">#</a></span></dt><dd class="glossdef"><p>
     A method of accessing data on a disk at the individual byte level
     instead of through its file system.
    </p></dd><dt id="gloss-vt-storage-sparse"><span><span class="glossterm">Sparse image file</span> <a title="Permalink" class="permalink" href="#gloss-vt-storage-sparse">#</a></span></dt><dd class="glossdef"><p>
     A disk image file that does not reserve its entire amount of disk space
     but expands as data is written to it.
    </p></dd><dt id="gloss-vt-storage-xvda"><span><span class="glossterm">xvda</span> <a title="Permalink" class="permalink" href="#gloss-vt-storage-xvda">#</a></span></dt><dd class="glossdef"><p>
     The drive designation given to the first virtual disk on a paravirtual
     machine.
    </p></dd></dl></div><div class="glossdiv" id="gloss-vt-acronym" data-id-title="Acronyms"><h3 class="title">Acronyms</h3><dl><dt id="gloss-vt-acpi"><span><span class="glossterm">ACPI</span> <a title="Permalink" class="permalink" href="#gloss-vt-acpi">#</a></span></dt><dd class="glossdef"><p>
    Advanced Configuration and Power Interface (ACPI) specification provides
    an open standard for device configuration and power management by the
    operating system.
   </p></dd><dt id="gloss-vt-acronym-aer"><span><span class="glossterm">AER</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-aer">#</a></span></dt><dd class="glossdef"><p>
    Advanced Error Reporting
   </p><p>
    AER is a capability provided by the PCI Express specification which
    allows for reporting of PCI errors and recovery from some of them.
   </p></dd><dt id="gloss-vt-apic"><span><span class="glossterm">APIC</span> <a title="Permalink" class="permalink" href="#gloss-vt-apic">#</a></span></dt><dd class="glossdef"><p>
    Advanced Programmable Interrupt Controller (APIC) is a family of
    interrupt controllers.
   </p></dd><dt id="gloss-xmtoxl-vt-bdf"><span><span class="glossterm">BDF</span> <a title="Permalink" class="permalink" href="#gloss-xmtoxl-vt-bdf">#</a></span></dt><dd class="glossdef"><p>
    Bus:Device:Function
   </p><p>
    Notation used to succinctly describe PCI and PCIe devices.
   </p></dd><dt id="gloss-vt-acronym-cg"><span><span class="glossterm">CG</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-cg">#</a></span></dt><dd class="glossdef"><p>
    Control Groups
   </p><p>
    Feature to limit, account and isolate resource usage (CPU, memory, disk
    I/O, etc.).
   </p></dd><dt id="gloss-xmtoxl-vt-edf"><span><span class="glossterm">EDF</span> <a title="Permalink" class="permalink" href="#gloss-xmtoxl-vt-edf">#</a></span></dt><dd class="glossdef"><p>
    Earliest Deadline First
   </p><p>
    This scheduler provides weighted CPU sharing in an intuitive way and
    uses real-time algorithms to ensure time guarantees.
   </p></dd><dt id="gloss-vt-acronym-ept"><span><span class="glossterm">EPT</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-ept">#</a></span></dt><dd class="glossdef"><p>
    Extended Page Tables
   </p><p>
    Performance in a virtualized environment is close to that in a native
    environment. Virtualization does create some overheads, however. These
    come from the virtualization of the CPU, the
    <a class="xref" href="#gloss-vt-acronym-mmu" title="MMU">MMU</a>, and the I/O devices. In some
    recent x86 processors AMD and Intel have begun to provide hardware
    extensions to help bridge this performance gap. In 2006, both vendors
    introduced their first generation hardware support for x86
    virtualization with AMD-Virtualization (AMD-V) and Intel® VT-x
    technologies. Recently Intel introduced its second generation of
    hardware support that incorporates MMU-virtualization, called Extended
    Page Tables (EPT). EPT-enabled systems can improve performance compared
    to using shadow paging for <a class="xref" href="#gloss-vt-acronym-mmu" title="MMU">MMU</a>
    virtualization. EPT increases memory access latencies for a few
    workloads. This cost can be reduced by effectively using large pages in
    the guest and the hypervisor.
   </p></dd><dt id="gloss-xmtoxl-vt-flask"><span><span class="glossterm">FLASK</span> <a title="Permalink" class="permalink" href="#gloss-xmtoxl-vt-flask">#</a></span></dt><dd class="glossdef"><p>
    Flux Advanced Security Kernel
   </p><p>
    Xen implements a type of mandatory access control via a security
    architecture called FLASK using a module of the same name.
   </p></dd><dt id="gloss-vt-acronym-hap"><span><span class="glossterm">HAP</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-hap">#</a></span></dt><dd class="glossdef"><p>
    High Assurance Platform
   </p><p>
    HAP combines hardware and software technologies to improve workstation
    and network security.
   </p></dd><dt id="gloss-vt-acronym-hvm"><span><span class="glossterm">HVM</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-hvm">#</a></span></dt><dd class="glossdef"><p>
    Hardware Virtual Machine (commonly called like this by Xen).
   </p></dd><dt id="gloss-vt-acronym-iommu"><span><span class="glossterm">IOMMU</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-iommu">#</a></span></dt><dd class="glossdef"><p>
    Input/Output Memory Management Unit
   </p><p>
    IOMMU (AMD* technology) is a memory management unit
    (<a class="xref" href="#gloss-vt-acronym-mmu" title="MMU">MMU</a>) that connects a direct memory
    access-capable (DMA-capable) I/O bus to the main memory.
   </p></dd><dt id="gloss-vt-acronym-ksm"><span><span class="glossterm">KSM</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-ksm">#</a></span></dt><dd class="glossdef"><p>
    Kernel Same Page Merging
   </p><p>
    KSM allows for automatic sharing of identical memory pages between
    guests to save host memory. KVM is optimized to use KSM if enabled
    on the VM Host Server.
   </p></dd><dt id="gloss-vt-acronym-mmu"><span><span class="glossterm">MMU</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-mmu">#</a></span></dt><dd class="glossdef"><p>
    Memory Management Unit
   </p><p>
    is a computer hardware component responsible for handling accesses to
    memory requested by the CPU. Its functions include translation of
    virtual addresses to physical addresses (that is, virtual memory
    management), memory protection, cache control, bus arbitration and in
    simpler computer architectures (especially 8-bit systems) bank
    switching.
   </p></dd><dt id="gloss-vt-acronym-pae"><span><span class="glossterm">PAE</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-pae">#</a></span></dt><dd class="glossdef"><p>
    Physical Address Extension
   </p><p>
    32-bit x86 operating systems use Physical Address Extension (PAE) mode
    to enable addressing of more than 4 GB of physical memory. In PAE mode,
    page table entries (PTEs) are 64 bits in size.
   </p></dd><dt id="gloss-vt-acronym-pcid"><span><span class="glossterm">PCID</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-pcid">#</a></span></dt><dd class="glossdef"><p>
    Process-context identifiers
   </p><p>
    These are a facility by which a logical processor may cache information
    for multiple linear-address spaces so that the processor may retain
    cached information when software switches to a different linear address
    space. INVPCID instruction is used for fine-grained
    <a class="xref" href="#gloss-vt-acronym-tlb" title="TLB">TLB</a> flush, which is benefit for
    kernel.
   </p></dd><dt id="gloss-vt-acronym-pcie"><span><span class="glossterm">PCIe</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-pcie">#</a></span></dt><dd class="glossdef"><p>
    Peripheral Component Interconnect Express
   </p><p>
    PCIe was designed to replace older PCI, PCI-X and AGP bus standards.
    PCIe has numerous improvements including a higher maximum system bus
    throughput, a lower I/O pin count and smaller physical footprint.
    Moreover it also has a more detailed error detection and reporting
    mechanism (<a class="xref" href="#gloss-vt-acronym-aer" title="AER">AER</a>), and a native
    hotplug functionality. It is also backward compatible with PCI.
   </p></dd><dt id="gloss-vt-acronym-pse-pse36"><span><span class="glossterm">PSE and PSE36</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-pse-pse36">#</a></span></dt><dd class="glossdef"><p>
    Page Size Extended
   </p><p>
    PSE refers to a feature of x86 processors that allows for pages larger
    than the traditional 4 KiB size. PSE-36 capability offers 4 more bits,
    in addition to the normal 10 bits, which are used inside a page
    directory entry pointing to a large page. This allows a large page to be
    located in 36-bit address space.
   </p></dd><dt id="gloss-vt-acronym-pt"><span><span class="glossterm">PT</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-pt">#</a></span></dt><dd class="glossdef"><p>
    Page Table
   </p><p>
    A page table is the data structure used by a virtual memory system in a
    computer operating system to store the mapping between virtual addresses
    and physical addresses. Virtual addresses are those unique to the
    accessing process. Physical addresses are those unique to the hardware
    (RAM).
   </p></dd><dt id="gloss-vt-acronym-qxl"><span><span class="glossterm">QXL</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-qxl">#</a></span></dt><dd class="glossdef"><p>
    QXL is a cirrus VGA framebuffer (8M) driver for virtualized environment.
   </p></dd><dt id="gloss-vt-acronym-rvi-npt"><span><span class="glossterm">RVI or NPT</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-rvi-npt">#</a></span></dt><dd class="glossdef"><p>
    Rapid Virtualization Indexing, Nested Page Tables
   </p><p>
    An AMD second generation hardware-assisted virtualization technology for
    the processor memory management unit
    (<a class="xref" href="#gloss-vt-acronym-mmu" title="MMU">MMU</a>).
   </p></dd><dt id="gloss-vt-acronym-sata"><span><span class="glossterm">SATA</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-sata">#</a></span></dt><dd class="glossdef"><p>
    Serial ATA
   </p><p>
    SATA is a computer bus interface that connects host bus adapters to mass
    storage devices such as hard disks and optical drives.
   </p></dd><dt id="gloss-vt-acronym-seccomp2-based-sandboxing"><span><span class="glossterm">Seccomp2-based sandboxing</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-seccomp2-based-sandboxing">#</a></span></dt><dd class="glossdef"><p>
    Sandboxed environment where only predetermined system calls are
    permitted for added protection against malicious behavior.
   </p></dd><dt id="gloss-vt-acronym-smep"><span><span class="glossterm">SMEP</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-smep">#</a></span></dt><dd class="glossdef"><p>
    Supervisor Mode Execution Protection
   </p><p>
    This prevents the execution of user-mode pages by the Xen hypervisor,
    making many application-to-hypervisor exploits much harder.
   </p></dd><dt id="gloss-vt-acronym-spice"><span><span class="glossterm">SPICE</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-spice">#</a></span></dt><dd class="glossdef"><p>
    Simple Protocol for Independent Computing Environments
   </p></dd><dt id="gloss-xmtoxl-vt-sxp"><span><span class="glossterm">SXP</span> <a title="Permalink" class="permalink" href="#gloss-xmtoxl-vt-sxp">#</a></span></dt><dd class="glossdef"><p>
    An SXP file is a Xen Configuration File.
   </p></dd><dt id="gloss-vt-acronym-tcg"><span><span class="glossterm">TCG</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-tcg">#</a></span></dt><dd class="glossdef"><p>
    Tiny Code Generator
   </p><p>
    Instructions are emulated rather than executed by the CPU.
   </p></dd><dt id="gloss-vt-acronym-thp"><span><span class="glossterm">THP</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-thp">#</a></span></dt><dd class="glossdef"><p>
    Transparent Huge Pages
   </p><p>
    This allows CPUs to address memory using pages larger than the default 4
    KB. This helps reduce memory consumption and CPU cache usage. KVM
    is optimized to use THP (via madvise and opportunistic methods) if
    enabled on the VM Host Server.
   </p></dd><dt id="gloss-vt-acronym-tlb"><span><span class="glossterm">TLB</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-tlb">#</a></span></dt><dd class="glossdef"><p>
    Translation Lookaside Buffer
   </p><p>
    TLB is a cache that memory management hardware uses to improve virtual
    address translation speed. All current desktop, notebook, and server
    processors use a TLB to map virtual and physical address spaces, and it
    is nearly always present in any hardware that uses virtual memory.
   </p></dd><dt id="gloss-vt-acronym-vcpu"><span><span class="glossterm">VCPU</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vcpu">#</a></span></dt><dd class="glossdef"><p>
    A scheduling entity, containing each state for virtualized CPU.
   </p></dd><dt id="gloss-vt-acronym-vdi"><span><span class="glossterm">VDI</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vdi">#</a></span></dt><dd class="glossdef"><p>
    Virtual Desktop Infrastructure
   </p></dd><dt id="gloss-vt-acronym-vfio"><span><span class="glossterm">VFIO</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vfio">#</a></span></dt><dd class="glossdef"><p>
    Since kernel v3.6; a new method of accessing PCI devices from user space
    called VFIO.
   </p></dd><dt id="gloss-vt-acronym-vhs"><span><span class="glossterm">VHS</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vhs">#</a></span></dt><dd class="glossdef"><p>
    Virtualization Host Server
   </p></dd><dt id="gloss-vt-acronym-vmroot"><span><span class="glossterm">VM root</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vmroot">#</a></span></dt><dd class="glossdef"><p>
    <a class="xref" href="#gloss-vt-acronym-hypervisor-vmm" title="VMM">VMM</a> will run in
    <a class="xref" href="#gloss-vt-acronym-vmx" title="VMX">VMX</a> root operation and guest software
    will run in <a class="xref" href="#gloss-vt-acronym-vmx" title="VMX">VMX</a> non-root operation.
    Transitions between <a class="xref" href="#gloss-vt-acronym-vmx" title="VMX">VMX</a> root
    operation and <a class="xref" href="#gloss-vt-acronym-vmx" title="VMX">VMX</a> non-root operation
    are called <a class="xref" href="#gloss-vt-acronym-vmx" title="VMX">VMX</a> transitions.
   </p></dd><dt id="gloss-vt-acronym-vmcs"><span><span class="glossterm">VMCS</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vmcs">#</a></span></dt><dd class="glossdef"><p>
    Virtual Machine Control Structure
   </p><p>
    VMX non-root operation and VMX transitions are controlled by a data
    structure called a virtual-machine control structure (VMCS). Access to
    the VMCS is managed through a component of processor state called the
    VMCS pointer (one per logical processor). The value of the VMCS pointer
    is the 64-bit address of the VMCS. The VMCS pointer is read and written
    using the instructions VMPTRST and VMPTRLD. The
    <a class="xref" href="#gloss-vt-acronym-hypervisor-vmm" title="VMM">VMM</a> configures a VMCS
    using the VMREAD, VMWRITE, and VMCLEAR instructions. A
    <a class="xref" href="#gloss-vt-acronym-hypervisor-vmm" title="VMM">VMM</a> could use a different
    VMCS for each virtual machine that it supports. For a virtual machine
    with multiple logical processors (virtual processors), the
    <a class="xref" href="#gloss-vt-acronym-hypervisor-vmm" title="VMM">VMM</a> could use a different
    VMCS for each virtual processor.
   </p></dd><dt id="gloss-vt-acronym-vmdq"><span><span class="glossterm">VMDq</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vmdq">#</a></span></dt><dd class="glossdef"><p>
    Virtual Machine Device Queue
   </p><p>
    Multi-queue network adapters exist which support multiple VMs at the
    hardware level, having separate packet queues associated to the
    different hosted VMs (by means of the IP addresses of the VMs).
   </p></dd><dt id="gloss-vt-acronym-hypervisor-vmm"><span><span class="glossterm">VMM</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-hypervisor-vmm">#</a></span></dt><dd class="glossdef"><p>
    Virtual Machine Monitor (Hypervisor)
   </p><p>
    When the processor encounters an instruction or event of interest to the
    Hypervisor (<a class="xref" href="#gloss-vt-acronym-hypervisor-vmm" title="VMM">VMM</a>), it exits
    from guest mode back to the VMM. The VMM emulates the instruction or
    other event, at a fraction of native speed, and then returns to guest
    mode. The transitions from guest mode to the VMM and back again are
    high-latency operations, during which guest execution is completely
    stalled.
   </p></dd><dt id="gloss-vt-acronym-vmx"><span><span class="glossterm">VMX</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vmx">#</a></span></dt><dd class="glossdef"><p>
    Virtual Machine eXtensions
   </p></dd><dt id="gloss-vt-acronym-vpid"><span><span class="glossterm">VPID</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vpid">#</a></span></dt><dd class="glossdef"><p>
    New support for software control of
    <a class="xref" href="#gloss-vt-acronym-tlb" title="TLB">TLB</a> (VPID improves
    <a class="xref" href="#gloss-vt-acronym-tlb" title="TLB">TLB</a> performance with small
    <a class="xref" href="#gloss-vt-acronym-hypervisor-vmm" title="VMM">VMM</a> development effort).
   </p></dd><dt id="gloss-vt-acronym-vtd"><span><span class="glossterm">VT-d</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vtd">#</a></span></dt><dd class="glossdef"><p>
    Virtualization Technology for Directed I/O
   </p><p>
    Like <a class="xref" href="#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a> for
    <a class="link" href="https://software.intel.com/en-us/articles/intel-virtualization-technology-for-directed-io-vt-d-enhancing-intel-platforms-for-efficient-virtualization-of-io-devices" target="_blank">Intel*</a>.
   </p></dd><dt id="gloss-vt-acronym-vtpm"><span><span class="glossterm">vTPM</span> <a title="Permalink" class="permalink" href="#gloss-vt-acronym-vtpm">#</a></span></dt><dd class="glossdef"><p>
    Component to establish end-to-end integrity for guests via Trusted
    Computing.
   </p></dd></dl></div></section><section class="appendix" id="app-vmdp-driver" data-id-title="Virtual machine drivers"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">A </span><span class="title-name">Virtual machine drivers</span></span> <a title="Permalink" class="permalink" href="#app-vmdp-driver">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/vmdp_drivers.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Virtualization allows the consolidation of workloads on newer, more
  powerful, energy-efficient hardware. Paravirtualized operating systems
  such as <span class="productname"><span class="phrase">SUSE® Linux Enterprise Server</span></span> and other Linux distributions are aware of the
  underlying virtualization platform, and can therefore interact efficiently
  with it. Unmodified operating systems such as Microsoft Windows* are
  unaware of the virtualization platform and expect to interact directly
  with the hardware. Because this is not possible when consolidating
  servers, the hardware must be emulated for the operating system. Emulation
  can be slow, but it is especially troubling for high-throughput disk and
  network subsystems. Most performance loss occurs in this area.
 </p><p>
  The SUSE Linux Enterprise Virtual Machine Driver Pack (VMDP) contains 32-bit and 64-bit
  paravirtualized network, bus and block drivers for several Microsoft
  Windows operating systems. These drivers bring many of the performance
  advantages of paravirtualized operating systems to unmodified operating
  systems: Only the paravirtualized device driver (not the rest of
  the operating system) is aware of the virtualization platform. For
  example, a paravirtualized disk device driver appears as a normal,
  physical disk to the operating system. However, the device driver
  interacts directly with the virtualization platform (with no emulation). This
  helps to efficiently deliver disk access, allowing the disk and network subsystems
  to operate at near native speeds in a virtualized environment, without
  requiring changes to existing operating systems.
 </p><p>
  The SUSE® Linux Enterprise Virtual Machine Driver Pack is available as an add-on
  product for <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. For detailed information refer to
  <a class="link" href="https://www.suse.com/products/vmdriverpack/" target="_blank">https://www.suse.com/products/vmdriverpack/</a>.
 </p><p>
  For more information, refer to the
  <a class="link" href="https://documentation.suse.com/sle-vmdp/2.5/html/vmdp/index.html" target="_blank">
  Official VMDP <em class="citetitle">Installation Guide</em>
  </a>.
 </p></section><section class="appendix" id="app-gpu-passthru" data-id-title="Configuring GPU Pass-Through for NVIDIA cards"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">B </span><span class="title-name">Configuring GPU Pass-Through for NVIDIA cards</span></span> <a title="Permalink" class="permalink" href="#app-gpu-passthru">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="gpu-passthru-intro" data-id-title="Introduction"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">B.1 </span><span class="title-name">Introduction</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This article describes how to assign an NVIDIA GPU graphics card on the
   host machine to a virtualized guest.
  </p></section><section class="sect1" id="gpu-passthru-prerequisites" data-id-title="Prerequisites"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">B.2 </span><span class="title-name">Prerequisites</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-prerequisites">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     GPU pass-through is supported on the AMD64/Intel 64 architecture only.
    </p></li><li class="listitem"><p>
     The host operating system needs to be SLES 12 SP3 or newer.
    </p></li><li class="listitem"><p>
     This article deals with a set of instructions based on V100/T1000 NVIDIA
     cards, and is meant for GPU computation purposes only.
    </p></li><li class="listitem"><p>
     Verify that you are using an NVIDIA Tesla product—Maxwell, Pascal,
     or Volta.
    </p></li><li class="listitem"><p>
     To be able to manage the host system, you need an additional display card
     on the host that you can use when configuring the GPU Pass-Through, or a
     functional SSH environment.
    </p></li></ul></div></section><section class="sect1" id="gpu-passthru-host" data-id-title="Configuring the host"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">B.3 </span><span class="title-name">Configuring the host</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-host">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="gpu-passthru-verify-host" data-id-title="Verify the host environment"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">B.3.1 </span><span class="title-name">Verify the host environment</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-verify-host">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Verify that the host operating system is SLES 12 SP3 or newer:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /etc/issue
Welcome to SUSE Linux Enterprise Server 15  (x86_64) - Kernel \r (\l).</pre></div></li><li class="step"><p>
      Verify that the host supports <a class="xref" href="#gloss-vt-acronym-vtd" title="VT-d">VT-d</a>
      technology and that it is already enabled in the firmware settings:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>dmesg | grep -e "Directed I/O"
[   12.819760] DMAR: Intel(R) Virtualization Technology for Directed I/O</pre></div><p>
      If VT-d is not enabled in the firmware, enable it and reboot the host.
     </p></li><li class="step"><p>
      Verify that the host has an extra GPU or VGA card:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>lspci | grep -i "vga"
07:00.0 VGA compatible controller: Matrox Electronics Systems Ltd. \
  MGA G200e [Pilot] ServerEngines (SEP1) (rev 05)</pre></div><p>
      With a Tesla V100 card:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>lspci | grep -i nvidia
03:00.0 3D controller: NVIDIA Corporation GV100 [Tesla V100 PCIe] (rev a1)</pre></div><p>
      With a T1000 Mobile (available on Dell 5540):
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>lspci | grep -i nvidia
01:00.0 3D controller: NVIDIA Corporation TU117GLM [Quadro T1000 Mobile] (rev a1)</pre></div></li></ol></div></div></section><section class="sect2" id="gpu-passthru-enable-iommu" data-id-title="Enable"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">B.3.2 </span><span class="title-name">Enable <a class="xref" href="#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a></span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-enable-iommu">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <a class="xref" href="#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a> is disabled by default. You need
    to enable it at boot time in the <code class="filename">/etc/default/grub</code>
    configuration file.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      For Intel-based hosts:
     </p><div class="verbatim-wrap"><pre class="screen">GRUB_CMDLINE_LINUX="intel_iommu=on iommu=pt rd.driver.pre=vfio-pci"</pre></div><p>
      For AMD-based hosts:
     </p><div class="verbatim-wrap"><pre class="screen">GRUB_CMDLINE_LINUX="iommu=pt amd_iommu=on rd.driver.pre=vfio-pci"</pre></div></li><li class="step"><p>
      When you save the modified <code class="filename">/etc/default/grub</code> file,
      re-generate the main GRUB 2 configuration file
      <code class="filename">/boot/grub2/grub.cfg</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> grub2-mkconfig -o /boot/grub2/grub.cfg</pre></div></li><li class="step"><p>
      Reboot the host and verify that <a class="xref" href="#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a>
      is enabled:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>dmesg |  grep -e DMAR -e IOMMU</pre></div></li></ol></div></div></section><section class="sect2" id="gpu-passthru-blacklist-nouveau" data-id-title="Blacklist the Nouveau driver"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">B.3.3 </span><span class="title-name">Blacklist the Nouveau driver</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-blacklist-nouveau">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Because we want to assign the NVIDIA card to a VM guest, we need to avoid
    use of the card by the host OS's built-in driver for NVIDIA GPUs. The open
    source NVIDIA driver is called <code class="literal">nouveau</code>. Edit the file 
    <code class="filename">/etc/modprobe.d/50-blacklist.conf</code> and append the
    following line to its end:
   </p><div class="verbatim-wrap"><pre class="screen">blacklist nouveau</pre></div></section><section class="sect2" id="gpu-passthru-configure-vfio" data-id-title="Configure and isolate the GPU used for pass-through"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">B.3.4 </span><span class="title-name">Configure <a class="xref" href="#gloss-vt-acronym-vfio" title="VFIO">VFIO</a> and isolate the GPU used for pass-through</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-configure-vfio">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Find the card vendor and model IDs. Utilize the bus number identified in
      <a class="xref" href="#gpu-passthru-verify-host" title="B.3.1. Verify the host environment">Section B.3.1, “Verify the host environment”</a>, for example
      <code class="literal">03:00.0</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>lspci -nn | grep 03:00.0
03:00.0 3D controller [0302]: NVIDIA Corporation GV100 [Tesla V100 PCIe] [10de:1db4] (rev a1)</pre></div></li><li class="step"><p>
      Create the file <code class="filename">vfio.conf</code> in the
      <code class="filename">/etc/modprobe.d/</code> directory with the following
      content:
     </p><div class="verbatim-wrap"><pre class="screen">options vfio-pci ids=10de:1db4</pre></div><div id="id-1.12.11.4.5.2.2.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
       Verify that your card does not need an extra <code class="option">ids=</code>
       parameter. For some cards, you must specify the audio device too,
       so that device's ID must also be added to the list, otherwise you
       will not be able to use the card.
      </p></div></li></ol></div></div></section><section class="sect2" id="gpu-passthru-load-vfio" data-id-title="Load the driver"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">B.3.5 </span><span class="title-name">Load the <a class="xref" href="#gloss-vt-acronym-vfio" title="VFIO">VFIO</a> driver</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-load-vfio">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There are three ways you can load the
    <a class="xref" href="#gloss-vt-acronym-vfio" title="VFIO">VFIO</a> driver.
   </p><section class="sect3" id="gpu-passthru-load-vfio-initrd" data-id-title="Including the driver in the initrd file"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">B.3.5.1 </span><span class="title-name">Including the driver in the initrd file</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-load-vfio-initrd">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Create the file
       <code class="filename">/etc/dracut.conf.d/gpu-passthrough.conf</code> and add the
       following content (mind the leading whitespace):
      </p><div class="verbatim-wrap"><pre class="screen">add_drivers+=" vfio vfio_iommu_type1 vfio_pci vfio_virqfd"</pre></div></li><li class="step"><p>
       Re-generate the initrd file:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dracut --force /boot/initrd $(uname -r)</pre></div></li></ol></div></div></section><section class="sect3" id="gpu-passthru-load-vfio-modules" data-id-title="Adding the driver to the list of auto-loaded modules"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">B.3.5.2 </span><span class="title-name">Adding the driver to the list of auto-loaded modules</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-load-vfio-modules">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Create the file <code class="filename">/etc/modules-load.d/vfio-pci.conf</code> and
     add the following content:
    </p><div class="verbatim-wrap"><pre class="screen">vfio
vfio_iommu_type1
vfio_pci
kvm
kvm_intel</pre></div></section><section class="sect3" id="gpu-passthru-load-vfio-manual" data-id-title="Loading the driver manually"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">B.3.5.3 </span><span class="title-name">Loading the driver manually</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-load-vfio-manual">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To load the driver manually at run-time, execute the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> modprobe vfio-pci</pre></div></section></section><section class="sect2" id="gpu-passthru-disable-msr" data-id-title="Disable MSR for Microsoft Windows guests"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">B.3.6 </span><span class="title-name">Disable MSR for Microsoft Windows guests</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-disable-msr">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    For Microsoft Windows guests, we recommend disabling MSR (model-specific register) to
    avoid the guest crashing. Create the file
    <code class="filename">/etc/modprobe.d/kvm.conf</code> and add the following
    content:
   </p><div class="verbatim-wrap"><pre class="screen">options kvm ignore_msrs=1</pre></div></section><section class="sect2" id="gpu-passthru-ovmf" data-id-title="Install and enable UEFI firmware"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">B.3.7 </span><span class="title-name">Install and enable UEFI firmware</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-ovmf">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    For proper GPU Pass-Through functionality, the host needs to boot using UEFI
    firmware (that is, not using a legacy-style BIOS boot sequence).
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Install the <span class="package">qemu-ovmf</span> package which includes UEFI
      firmware images:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper install qemu-ovmf</pre></div></li><li class="step"><p>
      Get the list of OVMF <code class="literal">bin</code> and <code class="literal">vars</code>
      files by filtering the results of the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>rpm -ql qemu-ovmf</pre></div></li><li class="step"><p>
      Enable OVMF in the <code class="systemitem">libvirt</code> QEMU configuration in the file
      <code class="filename">/etc/libvirt/qemu.conf</code> by using the list obtained
      from the previous step. It should look similar to the following:
     </p><div class="verbatim-wrap"><pre class="screen">nvram = [
"/usr/share/qemu/ovmf-x86_64-4m.bin:/usr/share/qemu/ovmf-x86_64-4m-vars.bin",
"/usr/share/qemu/ovmf-x86_64-4m-code.bin:/usr/share/qemu/ovmf-x86_64-4m-vars.bin",
"/usr/share/qemu/ovmf-x86_64-smm-ms-code.bin:/usr/share/qemu/ovmf-x86_64-smm-ms-vars.bin",
"/usr/share/qemu/ovmf-x86_64-smm-opensuse-code.bin:/usr/share/qemu/ovmf-x86_64-smm-opensuse-vars.bin",
"/usr/share/qemu/ovmf-x86_64-ms-4m-code.bin:/usr/share/qemu/ovmf-x86_64-ms-4m-vars.bin",
"/usr/share/qemu/ovmf-x86_64-smm-suse-code.bin:/usr/share/qemu/ovmf-x86_64-smm-suse-vars.bin",
"/usr/share/qemu/ovmf-x86_64-ms-code.bin:/usr/share/qemu/ovmf-x86_64-ms-vars.bin",
"/usr/share/qemu/ovmf-x86_64-smm-code.bin:/usr/share/qemu/ovmf-x86_64-smm-vars.bin",
"/usr/share/qemu/ovmf-x86_64-opensuse-4m-code.bin:/usr/share/qemu/ovmf-x86_64-opensuse-4m-vars.bin",
"/usr/share/qemu/ovmf-x86_64-suse-4m-code.bin:/usr/share/qemu/ovmf-x86_64-suse-4m-vars.bin",
"/usr/share/qemu/ovmf-x86_64-suse-code.bin:/usr/share/qemu/ovmf-x86_64-suse-vars.bin",
"/usr/share/qemu/ovmf-x86_64-opensuse-code.bin:/usr/share/qemu/ovmf-x86_64-opensuse-vars.bin",
"/usr/share/qemu/ovmf-x86_64-code.bin:/usr/share/qemu/ovmf-x86_64-vars.bin",
]</pre></div></li></ol></div></div></section><section class="sect2" id="gpu-passthru-reboot" data-id-title="Reboot the host machine"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">B.3.8 </span><span class="title-name">Reboot the host machine</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-reboot">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    For most of the changes in the above steps to take effect, you need to
    reboot the host machine:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> shutdown -r now</pre></div></section></section><section class="sect1" id="gpu-passthru-guest" data-id-title="Configuring the guest"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">B.4 </span><span class="title-name">Configuring the guest</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-guest">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes how to configure the guest virtual machine so that it
   can use the host's NVIDIA GPU. Use Virtual Machine Manager or
   <code class="command">virt-install</code> to install the guest VM. Find more details
   in <a class="xref" href="#cha-kvm-inst" title="Chapter 10. Guest installation">Chapter 10, <em>Guest installation</em></a>.
  </p><section class="sect2" id="gpu-passthru-guest-general" data-id-title="Requirements for the guest configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">B.4.1 </span><span class="title-name">Requirements for the guest configuration</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-guest-general">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    During the guest VM installation, select <span class="guimenu">Customize configuration
    before install</span> and configure the following devices:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Use Q35 chipset if possible.
     </p></li><li class="listitem"><p>
      Install the guest VM using UEFI firmware.
     </p></li><li class="listitem"><p>
      Add the following emulated devices:
     </p><p>
      Graphic: Spice or VNC
     </p><p>
      Device: qxl, VGA, or Virtio
     </p><p>
      Find more information in <a class="xref" href="#sec-libvirt-config-video" title="14.6. Video">Section 14.6, “Video”</a>.
     </p></li><li class="listitem"><p>
      Add the host PCI device (<code class="literal">03:00.0</code> in our example) to
      the guest. Find more information in
      <a class="xref" href="#sec-libvirt-config-pci" title="14.12. Assigning a host PCI device to a VM Guest">Section 14.12, “Assigning a host PCI device to a VM Guest”</a>.
     </p></li><li class="listitem"><p>
      For best performance, we recommend using virtio drivers for the network
      card and storage.
     </p></li></ul></div></section><section class="sect2" id="gpu-passthru-guest-driver" data-id-title="Install the graphic card driver"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">B.4.2 </span><span class="title-name">Install the graphic card driver</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-guest-driver">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect3" id="gpu-passthru-guest-driver-linux-rpm" data-id-title="Linux guest"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">B.4.2.1 </span><span class="title-name">Linux guest</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-guest-driver-linux-rpm">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure" id="id-1.12.11.5.4.2.2" data-id-title="RPM-based distributions"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure B.1: </span><span class="title-name">RPM-based distributions </span></span><a title="Permalink" class="permalink" href="#id-1.12.11.5.4.2.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Download the driver RPM package from
       <a class="link" href="http://www.nvidia.com/download/driverResults.aspx/131159/en-us" target="_blank">http://www.nvidia.com/download/driverResults.aspx/131159/en-us</a>.
      </p></li><li class="step"><p>
       Install the downloaded RPM package:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> rpm -i nvidia-diag-driver-local-repo-sles123-390.30-1.0-1.x86_64.rpm</pre></div></li><li class="step"><p>
       Refresh repositories and install <span class="package">cuda-drivers</span>. This
       step will be different for non-SUSE distributions:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper refresh &amp;&amp; zypper install cuda-drivers</pre></div></li><li class="step"><p>
       Reboot the guest VM:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> shutdown -r now</pre></div></li></ol></div></div><div class="procedure" id="id-1.12.11.5.4.2.3" data-id-title="Generic installer"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure B.2: </span><span class="title-name">Generic installer </span></span><a title="Permalink" class="permalink" href="#id-1.12.11.5.4.2.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Because the installer needs to compile the NVIDIA driver modules,
       install the <span class="package">gcc-c++</span> and <span class="package">kernel-devel</span>
       packages.
      </p></li><li class="step"><p>
       Disable Secure Boot on the guest, because NVIDIA's driver modules are
       unsigned. On SUSE distributions, you can use the YaST GRUB 2 module
       to disable Secure Boot. Find more information in
       <span class="intraxref">Book “Administration Guide”, Chapter 13 “UEFI (Unified Extensible Firmware Interface)”, Section 13.1.1 “Implementation on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>”</span>.
      </p></li><li class="step"><p>
       Download the driver installation script from
       <a class="link" href="https://www.nvidia.com/Download/index.aspx?lang=en-us" target="_blank">https://www.nvidia.com/Download/index.aspx?lang=en-us</a>,
       make it executable, and run it to complete the driver
       installation:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>chmod +x NVIDIA-Linux-x86_64-460.73.01.run
<code class="prompt user">&gt; </code><code class="command">sudo</code> ./NVIDIA-Linux-x86_64-460.73.01.run</pre></div></li><li class="step"><p>
       Download CUDA drivers from
       <a class="link" href="https://developer.nvidia.com/cuda-downloads?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=SLES&amp;target_version=15&amp;target_type=rpmlocal" target="_blank">https://developer.nvidia.com/cuda-downloads?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=SLES&amp;target_version=15&amp;target_type=rpmlocal</a>
       and install following the on-screen instructions.
      </p></li></ol></div></div><div id="id-1.12.11.5.4.2.4" data-id-title="Display issues" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Display issues</div><p>
      After you have installed the NVIDIA drivers, the Virtual Machine Manager display will
      lose its connection to the guest OS. To access the guest VM, you
      must either login via <code class="command">ssh</code>, change to the
      console interface, or install a dedicated VNC server in the guest.
      To avoid a flickering screen, stop and disable the display manager:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl stop display-manager &amp;&amp; systemctl disable display-manager</pre></div></div><div class="procedure" id="id-1.12.11.5.4.2.5" data-id-title="Testing the Linux driver installation"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure B.3: </span><span class="title-name">Testing the Linux driver installation </span></span><a title="Permalink" class="permalink" href="#id-1.12.11.5.4.2.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Change the directory to the CUDA sample templates:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cd /usr/local/cuda-9.1/samples/0_Simple/simpleTemplates</pre></div></li><li class="step"><p>
       Compile and run the <code class="literal">simpleTemplates</code> file:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>make &amp;&amp; ./simpleTemplates
runTest&lt;float,32&gt;
GPU Device 0: "Tesla V100-PCIE-16GB" with compute capability 7.0
CUDA device [Tesla V100-PCIE-16GB] has 80 Multi-Processors
Processing time: 495.006000 (ms)
Compare OK
runTest&lt;int,64&gt;
GPU Device 0: "Tesla V100-PCIE-16GB" with compute capability 7.0
CUDA device [Tesla V100-PCIE-16GB] has 80 Multi-Processors
Processing time: 0.203000 (ms)
Compare OK
[simpleTemplates] -&gt; Test Results: 0 Failures</pre></div></li></ol></div></div></section><section class="sect3" id="gpu-passthru-guest-driver-windows" data-id-title="Microsoft Windows guest"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">B.4.2.2 </span><span class="title-name">Microsoft Windows guest</span></span> <a title="Permalink" class="permalink" href="#gpu-passthru-guest-driver-windows">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/gpu_passthru.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.12.11.5.4.3.2" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
      Before you install the NVIDIA drivers, you need to hide the hypervisor
      from the drivers by using the <code class="literal">&lt;hidden state='on'/&gt;</code>
      directive in the guest's <code class="systemitem">libvirt</code> definition.
     </p></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Download and install the NVIDIA driver from
       <a class="link" href="https://www.nvidia.com/Download/index.aspx" target="_blank">https://www.nvidia.com/Download/index.aspx</a>.
      </p></li><li class="step"><p>
       Download and install the CUDA toolkit from
       <a class="link" href="https://developer.nvidia.com/cuda-downloads?target_os=Windows&amp;target_arch=x86_64" target="_blank">https://developer.nvidia.com/cuda-downloads?target_os=Windows&amp;target_arch=x86_64</a>.
      </p></li><li class="step"><p>
       Find some NVIDIA demo samples in the directory <code class="filename">Program
       Files\Nvidia GPU Computing
       Toolkit\CUDA\v10.2\extras\demo_suite</code> on the guest.
      </p></li></ol></div></div></section></section></section></section><section class="appendix" id="cha-xmtoxl" data-id-title="XM, XL toolstacks, and the libvirt framework"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">C </span><span class="title-name">XM, XL toolstacks, and the <code class="systemitem">libvirt</code> framework</span></span> <a title="Permalink" class="permalink" href="#cha-xmtoxl">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xmtoxl.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="sec-xmtoxl-intro" data-id-title="Xen toolstacks"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">C.1 </span><span class="title-name">Xen toolstacks</span></span> <a title="Permalink" class="permalink" href="#sec-xmtoxl-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xmtoxl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Since the early Xen 2.x releases, <code class="command">xend</code> has been
   the de facto toolstack for managing Xen installations. In Xen
   4.1, a new toolstack called libxenlight (also known as libxl) was
   introduced with technology preview status. libxl is a small, low-level
   library written in C. It has been designed to provide a simple API for
   all client toolstacks
   (<a class="link" href="http://wiki.xen.org/wiki/XAPI" target="_blank">XAPI</a>,
   <code class="systemitem">libvirt</code>, xl). In Xen 4.2, libxl was promoted to supported status
   and <code class="command">xend</code> was marked deprecated.
   <code class="command">xend</code> has been included in the Xen 4.3 and 4.4
   series to give users enough time to convert their tooling to libxl. It
   has been removed from the upstream Xen project and will no longer be
   provided starting with the Xen 4.5 series and <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>
   <span class="phrase">12 SP1</span>.
  </p><p>
   <span class="phrase">Although SLES 11 SP3 contains Xen 4.2, SUSE
   retained the <code class="command">xend</code> toolstack since making such an invasive
   change in a service pack would be too disruptive for SUSE Linux Enterprise
   customers. However, SLES 12 provides a suitable opportunity to move to the
   new libxl toolstack and remove the deprecated, unmaintained
   <code class="command">xend</code> stack</span>. Starting with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="phrase">12 SP1</span>,
   <code class="command">xend</code> is no longer supported.
  </p><p>
   One of the major differences between <code class="command">xend</code> and libxl is
   that the former is stateful, while the latter is stateless. With
   <code class="command">xend</code>, all client applications such as
   <code class="command">xm</code> and <code class="systemitem">libvirt</code> see the same system state.
   <code class="command">xend</code> is responsible for maintaining state for the
   entire Xen host. In libxl, client applications such as
   <code class="command">xl</code> or <code class="systemitem">libvirt</code> must maintain state. Thus domains
   created with <code class="command">xl</code> or not visible or known to other libxl
   applications such as <code class="systemitem">libvirt</code>. Generally, it is discouraged to mix
   and match libxl applications and is preferred that a single libxl
   application be used to manage a Xen host. In <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, we
   recommend to use <code class="systemitem">libvirt</code> to manage Xen hosts. This allows
   management of the Xen system through <code class="systemitem">libvirt</code> applications such
   as <code class="command">virt-manager</code>, <code class="command">virt-install</code>,
   <code class="command">virt-viewer</code>,
   libguestfs, etc. If <code class="command">xl</code> is used to manage the Xen
   host, any virtual machines under its management will not be accessible
   to <code class="systemitem">libvirt</code>. Hence, they are not accessible to any of the <code class="systemitem">libvirt</code>
   applications.
  </p><section class="sect2" id="sec-xmtoxl-upgrade" data-id-title="Upgrading from xend/xm to xl/libxl"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">C.1.1 </span><span class="title-name">Upgrading from xend/xm to xl/libxl</span></span> <a title="Permalink" class="permalink" href="#sec-xmtoxl-upgrade">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xmtoxl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="command">xl</code> application, along with its configuration
    format (see <code class="command">man xl.cfg</code>), was designed to be
    backward-compatible with the <code class="command">xm</code> application and its
    configuration format (see <code class="command">man xm.cfg</code>). Existing
    <code class="command">xm</code> configuration should be usable with
    <code class="command">xl</code>. Since libxl is stateless, and
    <code class="command">xl</code> does not support the notion of managed domains,
    SUSE recommends using <code class="systemitem">libvirt</code> to manage Xen hosts.
    SUSE has provided a tool called <code class="command">xen2libvirt</code>, which
    provides a simple mechanism to import domains previously managed by
    <code class="command">xend</code> into <code class="systemitem">libvirt</code>. See
    <a class="xref" href="#xen-xen2libvirt" title="C.2. Import Xen domain configuration into libvirt">Section C.2, “Import Xen domain configuration into <code class="systemitem">libvirt</code>”</a> for more information on
    <code class="command">xen2libvirt</code>.
   </p></section><section class="sect2" id="sec-xmltoxl-design" data-id-title="XL design"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">C.1.2 </span><span class="title-name">XL design</span></span> <a title="Permalink" class="permalink" href="#sec-xmltoxl-design">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xmtoxl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The basic structure of every <code class="command">xl</code> command is:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="command">xl subcommand</code> <code class="option">OPTIONS</code> <em class="replaceable">DOMAIN</em></pre></div><p>
    <em class="replaceable">DOMAIN</em> is the numeric domain id, or the
    domain name (which will be internally translated to domain id), and
    <em class="replaceable">OPTIONS</em> are subcommand specific options.
   </p><p>
    Although xl/libxl was designed to be backward-compatible with xm/xend,
    there are a few differences that should be noted:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Managed or persistent domains. <code class="systemitem">libvirt</code> now provides this
      functionality.
     </p></li><li class="listitem"><p>
      xl/libxl does not support Python code in the domain configuration
      files.
     </p></li><li class="listitem"><p>
      xl/libxl does not support creating domains from SXP format
      configuration files (<code class="command">xm</code> <code class="option">create</code>
      -F).
     </p></li><li class="listitem"><p>
      xl/libxl does not support sharing storage across DomU's via
      <code class="command">w!</code> in domain configuration files.
     </p></li></ul></div><p>
    xl/libxl is relatively new and under heavy development, hence a few
    features are still missing with regard to the xm/xend toolstack:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      SCSI LUN/Host pass-through (PVSCSI)
     </p></li><li class="listitem"><p>
      USB pass-through (PVUSB)
     </p></li><li class="listitem"><p>
      Direct Kernel Boot for fully virtualized Linux guests for Xen
     </p></li></ul></div></section><section class="sect2" id="sec-xmtoxl-checklist" data-id-title="Checklist before upgrade"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">C.1.3 </span><span class="title-name">Checklist before upgrade</span></span> <a title="Permalink" class="permalink" href="#sec-xmtoxl-checklist">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xmtoxl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="phrase">Before upgrading a SLES 11 SP4 Xen host to SLES
    15:</span>
    
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      You must remove any Python code from your xm domain configuration
      files.
     </p></li><li class="listitem"><p>
      It is recommended to capture the libvirt domain XML from all existing
      virtual machines using <code class="command">virsh</code>
      <code class="option">dumpxml</code> <em class="replaceable">DOMAIN_NAME</em>
      <em class="replaceable">DOMAIN_NAME.xml</em>.
     </p></li><li class="listitem"><p>
      It is recommended to do a backup of
      <code class="filename">/etc/xen/xend-config.sxp</code> and
      <code class="filename">/boot/grub/menu.lst</code> files to keep references of
      previous parameters used for Xen.
     </p></li></ul></div><div id="id-1.12.12.3.7.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     Currently, live migrating virtual machines running on a <span class="phrase">SLES 11 SP4
     Xen host to a SLES 15</span> Xen host is not supported. The
     <code class="command">xend</code> and libxl toolstacks are not
     runtime-compatible. Virtual machine downtime will be required to move
     the virtual machines.
    </p></div></section></section><section class="sect1" id="xen-xen2libvirt" data-id-title="Import Xen domain configuration into libvirt"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">C.2 </span><span class="title-name">Import Xen domain configuration into <code class="systemitem">libvirt</code></span></span> <a title="Permalink" class="permalink" href="#xen-xen2libvirt">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl_xen2libvirt.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  <code class="command">xen2libvirt</code> is a command line tool to import legacy
  Xen domain configuration into the <code class="systemitem">libvirt</code> virtualization library
  (see The Virtualization book for more information on <code class="systemitem">libvirt</code>).
  xen2libvirt provides an easy way to import domains managed by the
  deprecated <code class="command">xm</code>/xend tool stack into the new
  <code class="systemitem">libvirt</code>/libxl tool stack. Several domains can be imported at once
  using its <code class="option">--recursive mode</code>
 </p><p>
  <code class="command">xen2libvirt</code> is included in the
  <code class="systemitem">xen-tools</code> package. If needed, install it with
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper install xen-tools</pre></div><p>
  <code class="command">xen2libvirt</code> general syntax is
 </p><div class="verbatim-wrap"><pre class="screen">xen2libvirt &lt;options&gt; <em class="replaceable">/path/to/domain/config</em></pre></div><p>
  where <code class="option">options</code> can be:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.12.4.9.1"><span class="term"><code class="option">-h</code>, <code class="option">--help</code>
   </span></dt><dd><p>
     Prints short information about <code class="command">xen2libvirt</code> usage.
    </p></dd><dt id="id-1.12.12.4.9.2"><span class="term"><code class="option">-c</code>, <code class="option">--convert-only</code>
   </span></dt><dd><p>
     Converts the domain configuration to the <code class="systemitem">libvirt</code> XML format, but
     does not do the import to <code class="systemitem">libvirt</code>.
    </p></dd><dt id="id-1.12.12.4.9.3"><span class="term"><code class="option">-r</code>, <code class="option">--recursive</code>
   </span></dt><dd><p>
     Converts and/or imports all domains configuration recursively, starting
     at the specified path.
    </p></dd><dt id="id-1.12.12.4.9.4"><span class="term"><code class="option">-f</code>, <code class="option">--format</code>
   </span></dt><dd><p>
     Specifies the format of the source domain configuration. Can be either
     <code class="literal">xm</code>, or <code class="literal">sexpr</code> (S-expression
     format).
    </p></dd><dt id="id-1.12.12.4.9.5"><span class="term"><code class="option">-v</code>, <code class="option">--verbose</code>
   </span></dt><dd><p>
     Prints more detailed information about the import process.
    </p></dd></dl></div><div class="complex-example"><div class="example" id="id-1.12.12.4.10" data-id-title="Converting Xen domain configuration to libvirt"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example C.1: </span><span class="title-name">Converting Xen domain configuration to <code class="systemitem">libvirt</code> </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.4.10">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl_xen2libvirt.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
   Suppose you have a Xen domain managed with <code class="command">xm</code>
   with the following configuration saved in
   <code class="filename">/etc/xen/sle12.xm</code>:
  </p><div class="verbatim-wrap"><pre class="screen">kernel = "/boot/vmlinuz-2.6-xenU"
  memory = 128
  name = "SLE12"
  root = "/dev/hda1 ro"
  disk = [ "file:/var/xen/sle12.img,hda1,w" ]</pre></div><p>
   Convert it to <code class="systemitem">libvirt</code> XML without importing it, and look at its
   content:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xen2libvirt -f xm -c /etc/xen/sle12.xm &gt; /etc/libvirt/qemu/sles12.xml
  # cat /etc/libvirt/qemu/sles12.xml
  &lt;domain type='xen'&gt;
  &lt;name&gt;SLE12&lt;/name&gt;
  &lt;uuid&gt;43e1863c-8116-469c-a253-83d8be09aa1d&lt;/uuid&gt;
  &lt;memory unit='KiB'&gt;131072&lt;/memory&gt;
  &lt;currentMemory unit='KiB'&gt;131072&lt;/currentMemory&gt;
  &lt;vcpu placement='static'&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
  &lt;type arch='x86_64' machine='xenpv'&gt;linux&lt;/type&gt;
  &lt;kernel&gt;/boot/vmlinuz-2.6-xenU&lt;/kernel&gt;
  &lt;/os&gt;
  &lt;clock offset='utc' adjustment='reset'/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;restart&lt;/on_crash&gt;
  &lt;devices&gt;
  &lt;disk type='file' device='disk'&gt;
  &lt;driver name='file'/&gt;
  &lt;source file='/var/xen/sle12.img'/&gt;
  &lt;target dev='hda1' bus='xen'/&gt;
  &lt;/disk&gt;
  &lt;console type='pty'&gt;
  &lt;target type='xen' port='0'/&gt;
  &lt;/console&gt;
  &lt;/devices&gt;
  &lt;/domain&gt;</pre></div><p>
   To import the domain into <code class="systemitem">libvirt</code>, you can either run the same
   <code class="command">xen2libvirt</code> command without the <code class="option">-c</code>
   option, or use the exported file
   <code class="filename">/etc/libvirt/qemu/sles12.xml</code> and define a new
   Xen domain using <code class="command">virsh</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> virsh define /etc/libvirt/qemu/sles12.xml</pre></div></div></div></div></section><section class="sect1" id="sec-xmvsxl" data-id-title="Differences between the xm and xl applications"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">C.3 </span><span class="title-name">Differences between the <code class="command">xm</code> and <code class="command">xl</code> applications</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The purpose of this chapter is to list all differences between
  <code class="command">xm</code> and <code class="command">xl</code> applications. Generally,
  <code class="command">xl</code> is designed to be compatible with
  <code class="command">xm</code>. Replacing <code class="command">xm</code> with
  <code class="command">xl</code> in custom scripts or tools is usually sufficient.
 </p><p>
  You can also use the <code class="systemitem">libvirt</code> framework using the
  <code class="command">virsh</code> command. In this documentation only the first
  <em class="replaceable">OPTION</em> for <code class="command">virsh</code> will be
  shown. To get more help on this option do a:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="command">virsh</code> <code class="option">help</code> <em class="replaceable">OPTION</em></pre></div><section class="sect2" id="sec-xmvsxl-conventions" data-id-title="Notation conventions"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">C.3.1 </span><span class="title-name">Notation conventions</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-conventions">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To easily understand the difference between <code class="command">xl</code> and
   <code class="command">xm</code> commands, the following notation is used in this
   section:
  </p><div class="table" id="id-1.12.12.5.6.3" data-id-title="Notation conventions"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.1: </span><span class="title-name">Notation conventions </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.6.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Notation
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Meaning
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        (-) minus
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Option exists in <code class="command">xm</code>, but <code class="command">xl</code>
        does not include it.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        (+) plus
       </p>
      </td><td>
       <p>
        Option exists in <code class="command">xl</code>, but <code class="command">xm</code>
        does not include it.
       </p>
      </td></tr></tbody></table></div></div></section><section class="sect2" id="sec-xmvsxl-global" data-id-title="New global options"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">C.3.2 </span><span class="title-name">New global options</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-global">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><div class="table" id="id-1.12.12.5.7.3" data-id-title="New global options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.2: </span><span class="title-name">New global options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.7.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Options
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Task
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        (+) <code class="option">-v</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Verbose, increase the verbosity of the output
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        (+) <code class="option">-N</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Dry run, do not actually execute the command
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        (+) <code class="option">-f</code>
       </p>
      </td><td>
       <p>
        Force execution. <code class="command">xl</code> will refuse to run some
        commands if it detects that <code class="command">xend</code> is also running,
        this option will force the execution of those commands, even though
        it is unsafe
       </p>
      </td></tr></tbody></table></div></div></section><section class="sect2" id="sec-xmvsxl-common" data-id-title="Unchanged options"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">C.3.3 </span><span class="title-name">Unchanged options</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-common">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   List of common options of <code class="command">xl</code> and
   <code class="command">xm</code>, and their <code class="systemitem">libvirt</code> equivalents.
  </p><div class="table" id="id-1.12.12.5.8.3" data-id-title="Common options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.3: </span><span class="title-name">Common options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.8.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/><col class="3"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Options
       </p>
      </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Task
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        <code class="systemitem">libvirt</code> equivalent
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        destroy <em class="replaceable">DOMAIN</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Immediately terminate the domain.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">destroy</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        domid <em class="replaceable">DOMAIN_NAME</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Convert a domain name to a <em class="replaceable">DOMAIN_ID</em>.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">domid</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        domname <em class="replaceable">DOMAIN_ID</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Convert a <em class="replaceable">DOMAIN_ID</em> to a
        <em class="replaceable">DOMAIN_NAME</em>.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">domname</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        help
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Display the short help message (that is, common commands).
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">help</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        pause <em class="replaceable">DOMAIN_ID</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Pause a domain. When in a paused state, the domain will still consume
        allocated resources such as memory, but will not be eligible for
        scheduling by the Xen hypervisor.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">suspend</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        unpause <em class="replaceable">DOMAIN_ID</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Move a domain out of the paused state. This will allow a previously
        paused domain to be eligible for scheduling by the Xen
        hypervisor.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">resume</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        rename <em class="replaceable">DOMAIN_ID</em>
        <em class="replaceable">NEW_DOMAIN_NAME</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Change the domain name of <em class="replaceable">DOMAIN_ID</em> to
        <em class="replaceable">NEW_DOMAIN_NAME</em>.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh dumpxml <em class="replaceable">DOMAINNAME</em> &gt;
          <em class="replaceable">DOMXML</em></pre></div></li><li class="listitem"><p>
          modify the domain's name in <em class="replaceable">DOMXML</em>
         </p></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh undefine <em class="replaceable">DOMAINNAME</em></pre></div></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh define <em class="replaceable">DOMAINNAME</em></pre></div></li></ol></div>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        sysrq <em class="replaceable">DOMAIN</em> &lt;letter&gt;
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Send a Magic System Request to the domain, each type of request is
        represented by a different letter. It can be used to send SysRq
        requests to Linux guests, see <a class="link" href="https://www.kernel.org/doc/html/latest/admin-guide/sysrq.html" target="_blank">https://www.kernel.org/doc/html/latest/admin-guide/sysrq.html</a>
        for more information. It requires PV drivers to be installed in your
        guest OS.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">send-keys</code> can send Magic
        Sys Req only for KVM
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        vncviewer <em class="replaceable">OPTIONS</em>
        <em class="replaceable">DOMAIN</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Attach to domain's VNC server, forking a
        <code class="command">vncviewer</code> process.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virt-viewer</code> <em class="replaceable">DOMAIN_ID</em>
       </p>
       <p>
        <code class="command">virsh</code> <em class="replaceable">VNCDISPLAY</em>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">vcpu-set</code> <em class="replaceable">DOMAIN_ID</em> <em class="replaceable">VCPUS</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Set the number of virtual CPUs for the domain in question. Like
        <code class="option">mem-set</code>, this command can only allocate up to the
        maximum virtual CPU count configured at boot for the domain.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">setvcpus</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        vcpu-list <em class="replaceable">DOMAIN_ID</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        List VCPU information for a specific domain. If no domain is
        specified, VCPU information for all domains will be provided.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">vcpuinfo</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        vcpu-pin <em class="replaceable">DOMAIN_ID</em> &lt;VCPU|all&gt;
        &lt;CPUs|all&gt;
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Pin the VCPU to only run on the specific CPUs. The keyword all can
        be used to apply the CPU list to all VCPUs in the domain.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">vcpupin</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">dmesg</code> [-c]
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Read the Xen message buffer, similar to dmesg on a Linux system.
        The buffer contains informational, warning, and error messages
        created during Xen's boot process.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">top</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Execute the <code class="command">xentop</code> command, which provides real
        time monitoring of domains. <code class="command">xentop</code> is a curses
        interface.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">nodecpustats</code>
       </p>
       <p>
        <code class="command">virsh</code> <code class="option">nodememstats</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">uptime</code> [-s] <em class="replaceable">DOMAIN</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Print the current uptime of the domains running. With the
        <code class="command">xl</code> command, the <em class="replaceable">DOMAIN</em>
        argument is mandatory.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">debug-keys</code> <em class="replaceable">KEYS</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Send debug keys to Xen. It is the same as pressing the Xen
        <span class="emphasis"><em>conswitch</em></span> (Ctrl-A by default) three times and
        then pressing "keys".
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">cpupool-migrate</code> <em class="replaceable">DOMAIN</em>
        <em class="replaceable">CPU_POOL</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Move a domain specified by <em class="replaceable">DOMAIN_ID</em> or
        <em class="replaceable">DOMAIN</em> into a
        <em class="replaceable">CPU_POOL</em>.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">cpupool-destroy</code> <em class="replaceable">CPU_POOL</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Deactivate a cpu pool. This is possible only if no domain is active
        in the cpu-pool.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">block-detach</code> <em class="replaceable">DOMAIN_ID</em>
        <em class="replaceable">DevId</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Detach a domain's virtual block device. <span class="emphasis"><em>devid</em></span>
        may be the symbolic name or the numeric device id given to the
        device by Dom0. You will need to run <code class="command">xl</code>
        <code class="option">block-list</code> to determine that number.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">detach-disk</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">network-attach</code> <em class="replaceable">DOMAIN_ID</em>
        <em class="replaceable">NETWORK_DEVICE</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Create a new network device in the domain specified by
        <em class="replaceable">DOMAIN_ID</em>. network-device describes the
        device to attach, using the same format as the vif string in the
        domain configuration file
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">attach-interface</code>
       </p>
       <p>
        <code class="command">virsh</code> <code class="option">attach-device</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">pci-attach</code> <em class="replaceable">DOMAIN</em> &lt;BDF&gt;
        [Virtual Slot]
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Hotplug a new pass-through PCI device to the specified domain.
        <a class="xref" href="#gloss-xmtoxl-vt-bdf" title="BDF">BDF</a> is the PCI Bus/Device/Function
        of the physical device to be passed through.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">virsh</code> <code class="option">attach-device</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">pci-list</code> <em class="replaceable">DOMAIN_ID</em>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        List pass-through PCI devices for a domain
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="command">getenforce</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Determine if the <a class="xref" href="#gloss-xmtoxl-vt-flask" title="FLASK">FLASK</a> security
        module is loaded and enforcing its policy.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        <code class="command">setenforce</code> <code class="option">&lt;1|0|Enforcing|Permissive&gt;</code>
       </p>
      </td><td style="border-right: 1px solid ; ">
       <p>
        Enable or disable enforcing of the
        <a class="xref" href="#gloss-xmtoxl-vt-flask" title="FLASK">FLASK</a> access controls. The default
        is permissive and can be changed using the flask_enforcing option on
        the hypervisor's command line.
       </p>
      </td><td>
       
      </td></tr></tbody></table></div></div></section><section class="sect2" id="sec-xmvsxl-removed" data-id-title="Removed options"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">C.3.4 </span><span class="title-name">Removed options</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-removed">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   List of <code class="command">xm</code> <code class="option">options</code> which are no more
   available with the XL tool stack and a replacement solution if available.
  </p><section class="sect3" id="sec-xmvsxl-removed-domain" data-id-title="Domain management"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.4.1 </span><span class="title-name">Domain management</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-removed-domain">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The list of Domain management removed command and their replacement.
   </p><div class="table" id="id-1.12.12.5.9.3.3" data-id-title="Domain management removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.4: </span><span class="title-name">Domain management removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.9.3.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/><col class="3"/></colgroup><thead><tr><th style="border-bottom: 1px solid ; " colspan="3">
        <p>
         Domain Management Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Options
        </p>
       </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Task
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         Equivalent
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">log</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Print the Xend log.
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         This log file can be found in
         <code class="filename">/var/log/xend.log</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">delete</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Remove a domain from Xend domain management. The
         <code class="option">list</code> option shows the domain names
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         <code class="command">virsh</code> <code class="option">undefine</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">new</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Adds a domain to Xend domain management
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         <code class="command">virsh</code> <code class="option">define</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">start</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Start a Xend managed domain that was added using the
         <code class="command">xm</code> <code class="option">new</code> command
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         <code class="command">virsh</code> <code class="option">start</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">dryrun</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Dry run - prints the resulting configuration in
         <a class="xref" href="#gloss-xmtoxl-vt-sxp" title="SXP">SXP</a> but does not create the
         domain
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         <code class="command">xl</code> <code class="option">-N</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">reset</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Reset a domain
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         <code class="command">virsh</code> <code class="option">reset</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">domstate</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Show domain state
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         <code class="command">virsh</code> <code class="option">domstate</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">serve</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Proxy Xend XMLRPC over stdio
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">resume</code> <em class="replaceable">DOMAIN</em>
         <em class="replaceable">OPTIONS</em>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Moves a domain out of the suspended state and back into memory
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         <code class="command">virsh</code> <code class="option">resume</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">suspend</code> <em class="replaceable">DOMAIN</em>
        </p>
       </td><td style="border-right: 1px solid ; ">
        <p>
         Suspend a domain to a state file so that it can be later resumed
         using the <code class="option">resume</code> subcommand. Similar to the
         <code class="option">save</code> subcommand although the state file may not be
         specified
        </p>
       </td><td>
        <p>
         <code class="command">virsh</code> <code class="option">managedsave</code>
        </p>
        <p>
         <code class="command">virsh</code> <code class="option">suspend</code>
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-removed-devices" data-id-title="USB devices"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.4.2 </span><span class="title-name">USB devices</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-removed-devices">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    USB <code class="option">options</code> are not available with xl/libxl tool stack.
    <code class="command">virsh</code> has the <code class="option"> attach-device</code> and
    <code class="option">detach-device</code> options but it does not work yet with
    <code class="option">USB</code>.
   </p><div class="table" id="id-1.12.12.5.9.4.3" data-id-title="USB devices management removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.5: </span><span class="title-name">USB devices management removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.9.4.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-bottom: 1px solid ; " colspan="2">
        <p>
         USB Devices Management Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Options
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         Task
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">usb-add</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Add a new USB physical bus to a domain
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">usb-del</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Delete a USB physical bus from a domain
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">usb-attach</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Attach a new USB physical bus to domain's virtual port
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">usb-detach</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Detach a USB physical bus from domain's virtual port
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">usb-list</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         List domain's attachment state of all virtual port
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">usb-list-assignable-devices</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         List all the assignable USB devices
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">usb-hc-create</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Create a domain's new virtual USB host controller
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">usb-hc-destroy</code>
        </p>
       </td><td>
        <p>
         Destroy a domain's virtual USB host controller
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-removed-cpu" data-id-title="CPU management"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.4.3 </span><span class="title-name">CPU management</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-removed-cpu">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    CPU management options has changed. New options are available, see:
    <a class="xref" href="#sec-xmvsxl-changed-cpu" title="C.3.5.10. xl cpupool-*">Section C.3.5.10, “<code class="command">xl</code> <code class="option">cpupool-*</code>”</a>
   </p><div class="table" id="id-1.12.12.5.9.5.3" data-id-title="CPU management removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.6: </span><span class="title-name">CPU management removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.9.5.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-bottom: 1px solid ; " colspan="2">
        <p>
         CPU Management Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Options
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         Task
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">cpupool-new</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Adds a CPU pool to Xend CPU pool management
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">cpupool-start</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Starts a Xend CPU pool
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">cpupool-delete</code>
        </p>
       </td><td>
        <p>
         Removes a CPU pool from Xend management
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-removed-others" data-id-title="Other options"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.4.4 </span><span class="title-name">Other options</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-removed-others">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><div class="table" id="id-1.12.12.5.9.6.3" data-id-title="Other options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.7: </span><span class="title-name">Other options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.9.6.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-bottom: 1px solid ; " colspan="2">
        <p>
         Other Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Options
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         Task
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">shell</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Launch an interactive shell
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">change-vnc-passwd</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Change vnc password
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         (-) <code class="option">vtpm-list</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         List virtual TPM devices
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">block-configure</code>
        </p>
       </td><td>
        <p>
         Change block device configuration
        </p>
       </td></tr></tbody></table></div></div></section></section><section class="sect2" id="sec-xmvsxl-changed" data-id-title="Changed options"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">C.3.5 </span><span class="title-name">Changed options</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect3" id="sec-xmvsxl-changed-create" data-id-title="create"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.1 </span><span class="title-name"><code class="option">create</code></span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-create">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">xl</code> <code class="option">create</code>
    <em class="replaceable">CONFIG_FILE</em> <em class="replaceable">OPTIONS
    </em> <em class="replaceable">VARS</em>
   </p><div id="id-1.12.12.5.10.3.3" data-id-title="libvirt equivalent:" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent:</div><p>
     <code class="command">virsh</code> <code class="option">create</code>
    </p></div><div class="table" id="id-1.12.12.5.10.3.4" data-id-title="xl create Changed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.8: </span><span class="title-name"><code class="command">xl</code> <code class="option">create</code> Changed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.3.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">create</code> Changed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (*) -f=<em class="replaceable">FILE</em>,
         --defconfig=<em class="replaceable">FILE</em>
        </p>
       </td><td>
        <p>
         Use the given configuration file
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.3.5" data-id-title="xm create Removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.9: </span><span class="title-name"><code class="command">xm</code> <code class="option">create</code> Removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.3.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">create</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-s</code>, <code class="option">--skipdtd</code>
        </p>
       </td><td>
        <p>
         Skip DTD checking - skips checks on XML before creating
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-x</code>, <code class="option">--xmldryrun</code>
        </p>
       </td><td>
        <p>
         XML dry run
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-F=<em class="replaceable">FILE</em>,
         --config=<em class="replaceable">FILE</em></code>
        </p>
       </td><td>
        <p>
         Use the given <a class="xref" href="#gloss-xmtoxl-vt-sxp" title="SXP">SXP</a> formatted
         configuration script
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">--path</code>
        </p>
       </td><td>
        <p>
         Search path for configuration scripts
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">--help_config</code>
        </p>
       </td><td>
        <p>
         Print the available configuration variables (vars) for the
         configuration script
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-n</code>, <code class="option">--dryrun</code>
        </p>
       </td><td>
        <p>
         Dry run — prints the configuration in
         <a class="xref" href="#gloss-xmtoxl-vt-sxp" title="SXP">SXP</a> but does not create the
         domain
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-c</code>, <code class="option">--console_autoconnect</code>
        </p>
       </td><td>
        <p>
         Connect to the console after the domain is created
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-q</code>, <code class="option">--quiet</code>
        </p>
       </td><td>
        <p>
         Quiet mode
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-p</code>, <code class="option">--paused</code>
        </p>
       </td><td>
        <p>
         Leave the domain paused after it is created
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.3.6" data-id-title="xl create Added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.10: </span><span class="title-name"><code class="command">xl</code> <code class="option">create</code> Added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.3.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">create</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-V</code>, <code class="option">--vncviewer</code>
        </p>
       </td><td>
        <p>
         Attach to domain's VNC server, forking a vncviewer process
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-A</code>, <code class="option">--vncviewer-autopass</code>
        </p>
       </td><td>
        <p>
         Pass VNC password to vncviewer via stdin
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-console" data-id-title="console"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.2 </span><span class="title-name"><code class="option">console</code></span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-console">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">xl</code> <code class="option">console</code>
    <em class="replaceable">OPTIONS</em> <em class="replaceable">DOMAIN</em>
   </p><div id="id-1.12.12.5.10.4.3" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh</code> <code class="option">console</code>
    </p></div><div class="table" id="id-1.12.12.5.10.4.4" data-id-title="xl console Added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.11: </span><span class="title-name"><code class="command">xl</code> <code class="option">console</code> Added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.4.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col style="width: 20%; " class="c1"/><col style="width: 80%; " class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">console</code> Added Option
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Option</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-t</code> [pv|serial]
        </p>
       </td><td>
        <p>
         Connect to a PV console or connect to an emulated serial console.
         PV consoles are the only consoles available for PV domains while
         HVM domains can have both
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-info" data-id-title="info"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.3 </span><span class="title-name">info</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-info">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">xl</code> <code class="option">info</code>
   </p><div class="table" id="id-1.12.12.5.10.5.3" data-id-title="xm info Removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.12: </span><span class="title-name"><code class="command">xm</code> <code class="option">info</code> Removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.5.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">info</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-n</code>, <code class="option">--numa</code>
        </p>
       </td><td>
        <p>
         Numa info
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-c</code>, <code class="option">--config</code>
        </p>
       </td><td>
        <p>
         List Xend configuration parameters
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-dump" data-id-title="dump-core"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.4 </span><span class="title-name"><code class="option">dump-core</code></span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-dump">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">xl</code> <code class="option">dump-core</code>
    <em class="replaceable">DOMAIN</em> <em class="replaceable">FILENAME</em>
   </p><div id="id-1.12.12.5.10.6.3" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh</code> <code class="option">dump</code>
    </p></div><div class="table" id="id-1.12.12.5.10.6.4" data-id-title="xm dump-core Removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.13: </span><span class="title-name"><code class="command">xm</code> <code class="option">dump-core</code> Removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.6.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">dump-core</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-L</code>, <code class="option">--live</code>
        </p>
       </td><td>
        <p>
         Dump core without pausing the domain
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-C</code>, <code class="option">--crash</code>
        </p>
       </td><td>
        <p>
         Crash domain after dumping core
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-R</code>, <code class="option">--reset</code>
        </p>
       </td><td>
        <p>
         Reset domain after dumping core
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-list" data-id-title="list"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.5 </span><span class="title-name"><code class="option">list</code></span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-list">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">xl list</code> <code class="option">options</code>
    <em class="replaceable">DOMAIN</em>
   </p><div id="id-1.12.12.5.10.7.3" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh</code> <code class="option">list --all</code>
    </p></div><div class="table" id="id-1.12.12.5.10.7.4" data-id-title="xm list Removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.14: </span><span class="title-name"><code class="command">xm</code> <code class="option">list</code> Removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.7.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">list</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-l</code>, <code class="option">--long</code>
        </p>
       </td><td>
        <p>
         The output for <code class="command">xm</code> <code class="option">list</code> presents
         the data in <a class="xref" href="#gloss-xmtoxl-vt-sxp" title="SXP">SXP</a> format
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">--state==<em class="replaceable">STATE</em></code>
        </p>
       </td><td>
        <p>
         Output information for VMs in the specified state
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.7.5" data-id-title="xl list Added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.15: </span><span class="title-name"><code class="command">xl</code> <code class="option">list</code> Added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.7.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">list</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-Z</code>, <code class="option">--context</code>
        </p>
       </td><td>
        <p>
         Also prints the security labels
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-v</code>, <code class="option">--verbose</code>
        </p>
       </td><td>
        <p>
         Also prints the domain UUIDs, the shutdown reason and security
         labels
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-mem" data-id-title="mem-*"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.6 </span><span class="title-name"><code class="option">mem-*</code></span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-mem">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.12.12.5.10.8.2" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh</code> <code class="option">setmem</code>
    </p><p>
     <code class="command">virsh</code> <code class="option">setmaxmem</code>
    </p></div><div class="table" id="id-1.12.12.5.10.8.3" data-id-title="xl mem-* Changed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.16: </span><span class="title-name"><code class="command">xl</code> <code class="option">mem-*</code> Changed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.8.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">mem-*</code> Changed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">mem-max</code> <em class="replaceable">DOMAIN_ID</em>
         <em class="replaceable">MEM</em>
        </p>
       </td><td>
        <p>
         Appending <code class="option">t</code> for terabytes, <code class="option">g</code> for
         gigabytes, <code class="option">m</code> for megabytes,<code class="option">k</code> for
         kilobytes and <code class="option">b</code> for bytes. Specify the maximum
         amount of memory the domain can use.
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">mem-set</code> <em class="replaceable">DOMAIN_ID</em>
         <em class="replaceable">MEM</em>
        </p>
       </td><td>
        <p>
         Set the domain's used memory using the balloon driver
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-migrate" data-id-title="migrate"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.7 </span><span class="title-name"><code class="option">migrate</code></span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-migrate">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">xl</code> <code class="option">migrate</code>
    <em class="replaceable">OPTIONS</em> <em class="replaceable">DOMAIN</em>
    <em class="replaceable">HOST</em>
   </p><div id="id-1.12.12.5.10.9.3" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh migrate --live hvm-sles11-qcow2 xen+</code>
     <em class="replaceable">CONNECTOR</em>://<em class="replaceable">USER</em>@<em class="replaceable">IP_ADDRESS</em>/
    </p></div><div class="table" id="id-1.12.12.5.10.9.4" data-id-title="xm migrate Removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.17: </span><span class="title-name"><code class="command">xm</code> <code class="option">migrate</code> Removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.9.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">migrate</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-l</code>, <code class="option">--live</code>
        </p>
       </td><td>
        <p>
         Use live migration. This will migrate the domain between hosts
         without shutting down the domain
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-r</code>, <code class="option">--resource</code>
         <em class="replaceable">Mbs</em>
        </p>
       </td><td>
        <p>
         Set maximum Mbs allowed for migrating the domain
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-c</code>, <code class="option">--change_home_server</code>
        </p>
       </td><td>
        <p>
         Change home server for managed domains
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-)
         <code class="option">--max_iters=</code><em class="replaceable">MAX_ITERS</em>
        </p>
       </td><td>
        <p>
         Number of iterations before final suspend (default:30)
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-)
         <code class="option">--max_factor=</code><em class="replaceable">MAX_FACTOR</em>
        </p>
       </td><td>
        <p>
         Max amount of memory to transfer before final suspend (default:
         3*RAM).
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-)
         <code class="option">--min_remaining=</code><em class="replaceable">MIN_REMAINING</em>
        </p>
       </td><td>
        <p>
         Number of dirty pages before final suspend (default:50)
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">--abort_if_busy</code>
        </p>
       </td><td>
        <p>
         Abort migration instead of doing final suspend
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">--log_progress</code>
        </p>
       </td><td>
        <p>
         Log progress of migration to <code class="filename">xend.log</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-s</code>, <code class="option">--ssl</code>
        </p>
       </td><td>
        <p>
         Use ssl connection for migration
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.9.5" data-id-title="xl migrate Added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.18: </span><span class="title-name"><code class="command">xl</code> <code class="option">migrate</code> Added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.9.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">migrate</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-s</code> <em class="replaceable">SSHCOMMAND</em>
        </p>
       </td><td>
        <p>
         Use &lt;sshcommand&gt; instead of <code class="command">ssh</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-e</code>
        </p>
       </td><td>
        <p>
         On the new host, do not wait in the background (on
         &lt;host&gt;) for the death of the domain
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-C</code> <em class="replaceable">CONFIG</em>
        </p>
       </td><td>
        <p>
         Send &lt;config&gt; instead of the configuration file used when
         creating the domain
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-management" data-id-title="Domain management"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.8 </span><span class="title-name">Domain management</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-management">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">xl</code> <code class="option">reboot</code>
    <em class="replaceable">OPTIONS</em> <em class="replaceable">DOMAIN</em>
   </p><div id="id-1.12.12.5.10.10.3" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh</code> <code class="option">reboot</code>
    </p></div><div class="table" id="id-1.12.12.5.10.10.4" data-id-title="xm reboot Removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.19: </span><span class="title-name"><code class="command">xm</code> <code class="option">reboot</code> Removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.10.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">reboot</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-a</code>, <code class="option">--all</code>
        </p>
       </td><td>
        <p>
         Reboot all domains
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-w</code>, <code class="option">--wait</code>
        </p>
       </td><td>
        <p>
         Wait for reboot to complete before returning. This may take a
         while, as all services in the domain need to be shut down
         cleanly
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.10.5" data-id-title="xl reboot Added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.20: </span><span class="title-name"><code class="command">xl</code> <code class="option">reboot</code> Added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.10.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">reboot</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Option</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-F</code>
        </p>
       </td><td>
        <p>
         Fallback to ACPI reset event for HVM guests with no PV drivers
        </p>
       </td></tr></tbody></table></div></div><p>
    <code class="command">xl</code> <code class="option">save</code>
    <em class="replaceable">OPTIONS</em> <em class="replaceable">DOMAIN</em>
    <em class="replaceable">CHECK_POINT_FILE</em>
    <em class="replaceable">CONFIG_FILE</em>
   </p><div id="id-1.12.12.5.10.10.7" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh</code> <code class="option">save</code>
    </p></div><div class="table" id="id-1.12.12.5.10.10.8" data-id-title="xl save Added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.21: </span><span class="title-name"><code class="command">xl</code> <code class="option">save</code> Added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.10.8">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">save</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Option</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-c</code>
        </p>
       </td><td>
        <p>
         Leave domain running after creating the snapshot
        </p>
       </td></tr></tbody></table></div></div><p>
    <code class="command">xl</code> <code class="option">restore</code>
    <em class="replaceable">OPTIONS</em>
    <em class="replaceable">CONFIG_FILE</em>
    <em class="replaceable">CHECK_POINT_FILE</em>
   </p><div id="id-1.12.12.5.10.10.10" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh</code> <code class="option">restore</code>
    </p></div><div class="table" id="id-1.12.12.5.10.10.11" data-id-title="xl restore Added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.22: </span><span class="title-name"><code class="command">xl</code> <code class="option">restore</code> Added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.10.11">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">restore</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-p</code>
        </p>
       </td><td>
        <p>
         Do not unpause domain after restoring it
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-e</code>
        </p>
       </td><td>
        <p>
         Do not wait in the background for the death of the domain on the
         new host
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-d</code>
        </p>
       </td><td>
        <p>
         Enable debug messages
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-V</code>, <code class="option">--vncviewer</code>
        </p>
       </td><td>
        <p>
         Attach to domain's VNC server, forking a vncviewer process
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-A</code>, <code class="option">--vncviewer-autopass</code>
        </p>
       </td><td>
        <p>
         Pass VNC password to vncviewer via stdin
        </p>
       </td></tr></tbody></table></div></div><p>
    <code class="command">xl</code> <code class="option">shutdown</code>
    <em class="replaceable">OPTIONS</em> <em class="replaceable">DOMAIN</em>
   </p><div id="id-1.12.12.5.10.10.13" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh</code> <code class="option">shutdown</code>
    </p></div><div class="table" id="id-1.12.12.5.10.10.14" data-id-title="xm shutdown Removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.23: </span><span class="title-name"><code class="command">xm</code> <code class="option">shutdown</code> Removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.10.14">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">shutdown</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-w</code>, <code class="option">--wait</code>
        </p>
       </td><td>
        <p>
         Wait for the domain to complete shutdown before returning
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-a</code>
        </p>
       </td><td>
        <p>
         Shutdown all guest domains
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-R</code>
        </p>
       </td><td>
        
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-H</code>
        </p>
       </td><td>
        
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.10.15" data-id-title="xl shutdown Added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.24: </span><span class="title-name"><code class="command">xl</code> <code class="option">shutdown</code> Added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.10.15">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">shutdown</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Option</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-F</code>
        </p>
       </td><td>
        <p>
         If the guest does not support PV shutdown control then fallback to
         sending an ACPI power event
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.10.16" data-id-title="xl trigger Changed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.25: </span><span class="title-name"><code class="command">xl</code> <code class="option">trigger</code> Changed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.10.16">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">trigger</code> Changed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Option</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">trigger</code>
         <em class="replaceable">DOMAIN</em>
         &lt;nmi|reset|init|power|sleep|s3resume&gt;
         <em class="replaceable">VCPU</em>
        </p>
       </td><td>
        <p>
         Send a trigger to a domain. Only available for HVM domains
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-sched" data-id-title="xl sched-*"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.9 </span><span class="title-name"><code class="command">xl</code> <code class="option">sched-*</code></span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-sched">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">xl</code> <code class="option">sched-credit</code>
    <em class="replaceable">OPTIONS</em>
   </p><div id="id-1.12.12.5.10.11.3" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh</code> <code class="option">schedinfo</code>
    </p></div><div class="table" id="id-1.12.12.5.10.11.4" data-id-title="xm sched-credit Removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.26: </span><span class="title-name"><code class="command">xm</code> <code class="option">sched-credit</code> Removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.11.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">sched-credit</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">-d</code> <em class="replaceable">DOMAIN</em>,
         <code class="option">--domain=</code><em class="replaceable">DOMAIN</em>
        </p>
       </td><td>
        <p>
         Domain
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">-w</code> <em class="replaceable">WEIGHT</em>,
         <code class="option">--weight=</code><em class="replaceable">WEIGHT</em>
        </p>
       </td><td>
        <p>
         A domain with a weight of 512 will get twice as much CPU as a
         domain with a weight of 256 on a contended host. Legal weights
         range from 1 to 65535 and the default is 256
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">-c</code> <em class="replaceable">CAP</em>,
         <code class="option">--cap=</code><em class="replaceable">CAP</em>
        </p>
       </td><td>
        <p>
         The CAP optionally fixes the maximum amount of CPU a domain can
         consume
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.11.5" data-id-title="xl sched-credit Added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.27: </span><span class="title-name"><code class="command">xl</code> <code class="option">sched-credit</code> Added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.11.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">sched-credit</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-p</code> <em class="replaceable">CPUPOOL</em>,
         <code class="option">--cpupool=</code><em class="replaceable">CPUPOOL</em>
        </p>
       </td><td>
        <p>
         Restrict output to domains in the specified cpupool
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-s</code>, <code class="option">--schedparam</code>
        </p>
       </td><td>
        <p>
         Specify to list or set pool-wide scheduler parameters
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-t</code> <em class="replaceable">TSLICE</em>,
         <code class="option">--tslice_ms=</code><em class="replaceable">TSLICE</em>
        </p>
       </td><td>
        <p>
         Timeslice tells the scheduler how long to allow VMs to run before
         pre-empting
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-r</code> <em class="replaceable">RLIMIT</em>,
         <code class="option">--ratelimit_us=</code><em class="replaceable">RLIMIT</em>
        </p>
       </td><td>
        <p>
         Ratelimit attempts to limit the number of schedules per second
        </p>
       </td></tr></tbody></table></div></div><p>
    <code class="command">xl</code> <code class="option">sched-credit2</code>
    <em class="replaceable">OPTIONS</em>
   </p><div id="id-1.12.12.5.10.11.7" data-id-title="libvirt status" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> status</div><p>
     <code class="command">virsh</code> only supports credit scheduler, not credit2
     scheduler
    </p></div><div class="table" id="id-1.12.12.5.10.11.8" data-id-title="xm sched-credit2 Removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.28: </span><span class="title-name"><code class="command">xm</code> <code class="option">sched-credit2</code> Removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.11.8">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">sched-credit2</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">-d</code> <em class="replaceable">DOMAIN</em>,
         <code class="option">--domain=</code><em class="replaceable">DOMAIN</em>
        </p>
       </td><td>
        <p>
         Domain
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">-w</code> <em class="replaceable">WEIGHT</em>,
         <code class="option">--weight=</code><em class="replaceable">WEIGHT</em>
        </p>
       </td><td>
        <p>
         Legal weights range from 1 to 65535 and the default is 256
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.11.9" data-id-title="xl sched-credit2 Added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.29: </span><span class="title-name"><code class="command">xl</code> <code class="option">sched-credit2</code> Added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.11.9">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">sched-credit2</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Option</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-p</code> <em class="replaceable">CPUPOOL</em>,
         <code class="option">--cpupool=</code><em class="replaceable">CPUPOOL</em>
        </p>
       </td><td>
        <p>
         Restrict output to domains in the specified cpupool
        </p>
       </td></tr></tbody></table></div></div><p>
    <code class="command">xl</code> <code class="option">sched-sedf</code>
    <em class="replaceable">OPTIONS</em>
   </p><div class="table" id="id-1.12.12.5.10.11.11" data-id-title="xm sched-sedf removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.30: </span><span class="title-name"><code class="command">xm</code> <code class="option">sched-sedf</code> removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.11.11">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">sched-sedf</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">-p</code> <em class="replaceable">PERIOD</em>,
         <code class="option">--period=</code><em class="replaceable">PERIOD</em>
        </p>
       </td><td>
        <p>
         The normal <a class="xref" href="#gloss-xmtoxl-vt-edf" title="EDF">EDF</a> scheduling usage
         in milliseconds
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">-s</code> <em class="replaceable">SLICE</em>,
         <code class="option">--slice=</code><em class="replaceable">SLICE</em>
        </p>
       </td><td>
        <p>
         The normal <a class="xref" href="#gloss-xmtoxl-vt-edf" title="EDF">EDF</a> scheduling usage
         in milliseconds
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">-l</code> <em class="replaceable">LATENCY</em>,
         <code class="option">--latency=</code><em class="replaceable">LATENCY</em>
        </p>
       </td><td>
        <p>
         Scaled period if domain is doing heavy I/O
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">-e</code> <em class="replaceable">EXTRA</em>,
         <code class="option">--extra=</code><em class="replaceable">EXTRA</em>
        </p>
       </td><td>
        <p>
         Flag for allowing domain to run in extra time (0 or 1)
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="option">-w</code> <em class="replaceable">WEIGHT</em>,
         <code class="option">--weight=</code><em class="replaceable">WEIGHT</em>
        </p>
       </td><td>
        <p>
         Another way of setting CPU slice
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.11.12" data-id-title="xl sched-sedf added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.31: </span><span class="title-name"><code class="command">xl</code> <code class="option">sched-sedf</code> added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.11.12">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">sched-sedf</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-c</code> <em class="replaceable">CPUPOOL</em>,
         <code class="option">--cpupool=</code><em class="replaceable">CPUPOOL</em>
        </p>
       </td><td>
        <p>
         Restrict output to domains in the specified cpupool
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-d</code> <em class="replaceable">DOMAIN</em>,
         <code class="option">--domain=</code><em class="replaceable">DOMAIN</em>
        </p>
       </td><td>
        <p>
         Domain
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-cpu" data-id-title="xl cpupool-*"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.10 </span><span class="title-name"><code class="command">xl</code> <code class="option">cpupool-*</code></span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-cpu">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">xl</code> <code class="option">cpupool-cpu-remove</code>
    <em class="replaceable">CPU_POOL</em> &lt;CPU
    nr&gt;|node:&lt;node nr&gt;
   </p><p>
    <code class="command">xl</code> <code class="option">cpupool-list</code> [-c|--cpus]
    <em class="replaceable">CPU_POOL</em>
   </p><div class="table" id="id-1.12.12.5.10.12.4" data-id-title="xm cpupool-list removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.32: </span><span class="title-name"><code class="command">xm</code> <code class="option">cpupool-list</code> removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.12.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">cpupool-*</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Option</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-l</code>, <code class="option">--long</code>
        </p>
       </td><td>
        <p>
         Output all CPU pool details in
         <a class="xref" href="#gloss-xmtoxl-vt-sxp" title="SXP">SXP</a> format
        </p>
       </td></tr></tbody></table></div></div><p>
    <code class="command">xl</code> <code class="option">cpupool-cpu-add</code>
    <em class="replaceable">CPU_POOL</em> cpu-nr|node:node-nr
   </p><p>
    <code class="command">xl</code> <code class="option">cpupool-create</code>
    <em class="replaceable">OPTIONS</em>
    <em class="replaceable">CONFIG_FILE</em> [Variable=Value ...]
   </p><div class="table" id="id-1.12.12.5.10.12.7" data-id-title="xm cpupool-create removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.33: </span><span class="title-name"><code class="command">xm</code> <code class="option">cpupool-create</code> removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.12.7">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">cpupool-create</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Options</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-f</code> <em class="replaceable">FILE</em>,
         --defconfig=<em class="replaceable">FILE</em>
        </p>
       </td><td>
        <p>
         Use the given Python configuration script. The configuration script
         is loaded after arguments have been processed
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-n</code>, <code class="option">--dryrun</code>
        </p>
       </td><td>
        <p>
         Dry run - prints the resulting configuration in
         <a class="xref" href="#gloss-xmtoxl-vt-sxp" title="SXP">SXP</a> but does not create the CPU
         pool
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">--help_config</code>
        </p>
       </td><td>
        <p>
         Print the available configuration variables (vars) for the
         configuration script
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">--path=</code><em class="replaceable">PATH</em>
        </p>
       </td><td>
        <p>
         Search path for configuration scripts. The value of PATH is a
         colon-separated directory list
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-F=</code><em class="replaceable">FILE</em>,
         --config=<em class="replaceable">FILE</em>
        </p>
       </td><td>
        <p>
         CPU pool configuration to use
         (<a class="xref" href="#gloss-xmtoxl-vt-sxp" title="SXP">SXP</a>)
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-attach" data-id-title="PCI and block devices"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.11 </span><span class="title-name">PCI and block devices</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-attach">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">xl</code> <code class="option">pci-detach</code> [-f]
    <em class="replaceable">DOMAIN_ID</em> &lt;BDF&gt;
   </p><div id="id-1.12.12.5.10.13.3" data-id-title="libvirt equivalent" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">libvirt</code> equivalent</div><p>
     <code class="command">virsh</code> <code class="option">detach-device</code>
    </p></div><div class="table" id="id-1.12.12.5.10.13.4" data-id-title="xl pci-detach added options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.34: </span><span class="title-name"><code class="command">xl</code> <code class="option">pci-detach</code> added options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.13.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">pci-detach</code> Added Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Option</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (+) <code class="option">-f</code>
        </p>
       </td><td>
        <p>
         If <code class="option">-f</code> is specified, <code class="command">xl</code> is going
         to forcefully remove the device even without guest's collaboration
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.13.5" data-id-title="xm block-list removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.35: </span><span class="title-name"><code class="command">xm</code> <code class="option">block-list</code> removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.13.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         <code class="option">block-list</code> Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Option</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-l</code>, <code class="option">--long</code>
        </p>
       </td><td>
        <p>
         List virtual block devices for a domain
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.13.6" data-id-title="Other options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.36: </span><span class="title-name">Other options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.13.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Option
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         <code class="systemitem">libvirt</code> equivalent
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="command">xl</code> <code class="option">block-attach</code>
         <em class="replaceable">DOMAIN</em>
         &lt;disk-spec-component(s)&gt;
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         <code class="command">virsh</code> <code class="option">attach-disk/attach-device</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="command">xl</code> <code class="option">block-list</code>
         <em class="replaceable">DOMAIN_ID</em>
        </p>
       </td><td>
        <p>
         <code class="command">virsh</code> <code class="option">domblklist</code>
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect3" id="sec-xmvsxl-changed-net" data-id-title="Network"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">C.3.5.12 </span><span class="title-name">Network</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-changed-net">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><div class="table" id="id-1.12.12.5.10.14.2" data-id-title="Network options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.37: </span><span class="title-name">Network options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.14.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Option
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         <code class="systemitem">libvirt</code> equivalent
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="command">xl</code> <code class="option">network-list</code>
         <em class="replaceable">DOMAIN(s)</em>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         <code class="command">virsh</code> <code class="option">domiflist</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="command">xl</code> <code class="option">network-detach</code>
         <em class="replaceable">DOMAIN_ID</em> devid|mac
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         <code class="command">virsh</code> <code class="option">detach-interface</code>
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="command">xl</code> <code class="option">network-attach</code>
         <em class="replaceable">DOMAIN(s)</em>
        </p>
       </td><td>
        <p>
         <code class="command">virsh</code>
         <code class="option">attach-interface/attach-device</code>
        </p>
       </td></tr></tbody></table></div></div><div class="table" id="id-1.12.12.5.10.14.3" data-id-title="xl network-attach removed options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.38: </span><span class="title-name"><code class="command">xl</code> <code class="option">network-attach</code> removed options </span></span><a title="Permalink" class="permalink" href="#id-1.12.12.5.10.14.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th colspan="2">
        <p>
         Removed Options
        </p>
       </th></tr><tr><th style="border-right: 1px solid ; ">
        <p>
         <span class="emphasis"><em>Option</em></span>
        </p>
       </th><th>
        <p>
         <span class="emphasis"><em>Task</em></span>
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
        <p>
         (-) <code class="option">-l</code>, <code class="option">--long</code>
        </p>
       </td><td>
        
       </td></tr></tbody></table></div></div></section></section><section class="sect2" id="sec-xmvsxl-new" data-id-title="New options"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">C.3.6 </span><span class="title-name">New options</span></span> <a title="Permalink" class="permalink" href="#sec-xmvsxl-new">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div></div></div></div><div class="table" id="table-xmtoxl-new-options" data-id-title="New options"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table C.39: </span><span class="title-name">New options </span></span><a title="Permalink" class="permalink" href="#table-xmtoxl-new-options">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Options
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Task
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="option">config-update</code> <em class="replaceable">DOMAIN</em>
        <em class="replaceable">CONFIG_FILE</em>
        <em class="replaceable">OPTIONS</em> <em class="replaceable">VARS</em>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Update the saved configuration for a running domain. This has no
        immediate effect but will be applied when the guest is next
        restarted. This command is useful to ensure that runtime
        modifications made to the guest will be preserved when the guest is
        restarted
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="option">migrate-receive</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="option">sharing</code> <em class="replaceable">DOMAIN</em>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        List count of shared pages.List specifically for that domain.
        Otherwise, list for all domains
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="option">vm-list</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Prints information about guests. This list excludes information
        about service or auxiliary domains such as Dom0 and stubdoms
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="option">cpupool-rename</code> <em class="replaceable">CPU_POOL</em>
        <em class="replaceable">NEWNAME</em>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Renames a cpu-pool to newname
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="option">cpupool-numa-split</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Splits up the machine into one cpu-pool per numa node
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        cd-insert <em class="replaceable">DOMAIN</em>
        &lt;VirtualDevice&gt; &lt;type:path&gt;
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Insert a CD-ROM into a guest domain's existing virtual CD drive. The
        virtual drive must already exist but can be current empty
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="option">cd-eject</code> <em class="replaceable">DOMAIN</em>
        &lt;VirtualDevice&gt;
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Eject a CD-ROM from a guest's virtual CD drive. Only works with HVM
        domains
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="option">pci-assignable-list</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        List all the assignable PCI devices. These are devices in the system
        which are configured to be available for pass-through and are bound
        to a suitable PCI back-end driver in Dom0 rather than a real
        driver
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="option">pci-assignable-add</code> &lt;BDF&gt;
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Make the device at PCI Bus/Device/Function
        <a class="xref" href="#gloss-xmtoxl-vt-bdf" title="BDF">BDF</a> assignable to guests.This will
        bind the device to the pciback driver
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="option">pci-assignable-remove</code>
        <em class="replaceable">OPTIONS</em> &lt;BDF&gt;
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Make the device at PCI Bus/Device/Function
        <a class="xref" href="#gloss-xmtoxl-vt-bdf" title="BDF">BDF</a> assignable to guests. This
        will at least unbind the device from pciback
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        <code class="option">loadpolicy</code> <em class="replaceable">POLICY_FILE</em>
       </p>
      </td><td>
       <p>
        Load <a class="xref" href="#gloss-xmtoxl-vt-flask" title="FLASK">FLASK</a> policy from the given
        policy file. The initial policy is provided to the hypervisor as a
        multiboot module; this command allows runtime updates to the policy.
        Loading new security policy will reset runtime changes to device
        labels
       </p>
      </td></tr></tbody></table></div></div></section></section><section class="sect1" id="sec-xmtoxl-links" data-id-title="External links"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">C.4 </span><span class="title-name">External links</span></span> <a title="Permalink" class="permalink" href="#sec-xmtoxl-links">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xm_vs_xl_links.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  For more information on Xen tool stacks refer to the following online
  resources:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.12.6.4.1"><span class="term">XL in Xen</span></dt><dd><p>
     <a class="link" href="http://wiki.xenproject.org/wiki/XL_in_Xen_4.2" target="_blank">XL in
     Xen 4.2</a>
    </p></dd><dt id="id-1.12.12.6.4.2"><span class="term"><code class="command">xl</code> command</span></dt><dd><p>
     <a class="link" href="http://xenbits.xen.org/docs/unstable/man/xl.1.html" target="_blank">XL</a>
     command line.
    </p></dd><dt id="id-1.12.12.6.4.3"><span class="term">xl.cfg</span></dt><dd><p>
     <a class="link" href="http://xenbits.xen.org/docs/unstable/man/xl.cfg.5.html" target="_blank">xl.cfg</a>
     domain configuration file syntax.
    </p></dd><dt id="id-1.12.12.6.4.4"><span class="term">xl disk</span></dt><dd><p>
     <a class="link" href="https://xenbits.xen.org/docs/4.3-testing/misc/xl-disk-configuration.txt" target="_blank">xl
     disk</a> configuration option.
    </p></dd><dt id="id-1.12.12.6.4.5"><span class="term">XL vs Xend</span></dt><dd><p>
     <a class="link" href="http://wiki.xenproject.org/wiki/XL_vs_Xend_Feature_Comparison" target="_blank">XL
     vs Xend</a> feature comparison.
    </p></dd><dt id="id-1.12.12.6.4.6"><span class="term">BDF doc</span></dt><dd><p>
     <a class="link" href="http://wiki.xen.org/wiki/Bus:Device.Function_%28BDF%29_Notation" target="_blank">BDF
     documentation</a>.
    </p></dd><dt id="id-1.12.12.6.4.7"><span class="term">libvirt</span></dt><dd><p>
     <a class="link" href="https://libvirt.org/manpages/virsh.html" target="_blank">virsh</a>
     command.
    </p></dd></dl></div></section><section class="sect1" id="sec-libvirt-managing-export-Xen-xm" data-id-title="Saving a Xen guest configuration in an xm compatible format"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">C.5 </span><span class="title-name">Saving a Xen guest configuration in an <code class="command">xm</code> compatible format</span></span> <a title="Permalink" class="permalink" href="#sec-libvirt-managing-export-Xen-xm">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/xen_xmtoxl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Although <code class="command">xl</code> is now the current toolkit for managing
   Xen guests (apart from the preferred <code class="systemitem">libvirt</code>), you may need to
   export the guest configuration to the previously used
   <code class="command">xm</code> format. To do this, follow these steps:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     First export the guest configuration to a file:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh dumpxml guest_id &gt; guest_cfg.xml</pre></div></li><li class="step"><p>
     Then convert the configuration to the <code class="command">xm</code> format:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>virsh domxml-to-native xen-xm guest_cfg.xml &gt; guest_xm_cfg</pre></div></li></ol></div></div></section></section><div class="legal-section"><section class="appendix" id="id-1.12.13" data-id-title="GNU licenses"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">D </span><span class="title-name">GNU licenses</span></span> <a title="Permalink" class="permalink" href="#id-1.12.13">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/common_legal.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This appendix contains the GNU Free Documentation License version 1.2.
 </p><section class="sect1" id="id-1.12.13.4" data-id-title="GNU Free Documentation License"><div class="titlepage"><div><div><div class="title-container"><h2 class="title legal"><span class="title-number-name"><span class="title-name">GNU Free Documentation License</span></span> <a title="Permalink" class="permalink" href="#id-1.12.13.4">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/common_license_gfdl1.2.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc. 51 Franklin St,
  Fifth Floor, Boston, MA 02110-1301 USA. Everyone is permitted to copy and
  distribute verbatim copies of this license document, but changing it is not
  allowed.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.4"><span class="name">
    0. PREAMBLE
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.4">#</a></h5></div><p>
  The purpose of this License is to make a manual, textbook, or other
  functional and useful document "free" in the sense of freedom: to assure
  everyone the effective freedom to copy and redistribute it, with or without
  modifying it, either commercially or non-commercially. Secondarily, this
  License preserves for the author and publisher a way to get credit for their
  work, while not being considered responsible for modifications made by
  others.
 </p><p>
  This License is a kind of "copyleft", which means that derivative works of
  the document must themselves be free in the same sense. It complements the
  GNU General Public License, which is a copyleft license designed for free
  software.
 </p><p>
  We have designed this License to use it for manuals for free software,
  because free software needs free documentation: a free program should come
  with manuals providing the same freedoms that the software does. But this
  License is not limited to software manuals; it can be used for any textual
  work, regardless of subject matter or whether it is published as a printed
  book. We recommend this License principally for works whose purpose is
  instruction or reference.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.8"><span class="name">
    1. APPLICABILITY AND DEFINITIONS
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.8">#</a></h5></div><p>
  This License applies to any manual or other work, in any medium, that
  contains a notice placed by the copyright holder saying it can be distributed
  under the terms of this License. Such a notice grants a world-wide,
  royalty-free license, unlimited in duration, to use that work under the
  conditions stated herein. The "Document", below, refers to any such manual or
  work. Any member of the public is a licensee, and is addressed as "you". You
  accept the license if you copy, modify or distribute the work in a way
  requiring permission under copyright law.
 </p><p>
  A "Modified Version" of the Document means any work containing the Document
  or a portion of it, either copied verbatim, or with modifications and/or
  translated into another language.
 </p><p>
  A "Secondary Section" is a named appendix or a front-matter section of the
  Document that deals exclusively with the relationship of the publishers or
  authors of the Document to the Document's overall subject (or to related
  matters) and contains nothing that could fall directly within that overall
  subject. (Thus, if the Document is in part a textbook of mathematics, a
  Secondary Section may not explain any mathematics.) The relationship could be
  a matter of historical connection with the subject or with related matters,
  or of legal, commercial, philosophical, ethical or political position
  regarding them.
 </p><p>
  The "Invariant Sections" are certain Secondary Sections whose titles are
  designated, as being those of Invariant Sections, in the notice that says
  that the Document is released under this License. If a section does not fit
  the above definition of Secondary then it is not allowed to be designated as
  Invariant. The Document may contain zero Invariant Sections. If the Document
  does not identify any Invariant Sections then there are none.
 </p><p>
  The "Cover Texts" are certain short passages of text that are listed, as
  Front-Cover Texts or Back-Cover Texts, in the notice that says that the
  Document is released under this License. A Front-Cover Text may be at most 5
  words, and a Back-Cover Text may be at most 25 words.
 </p><p>
  A "Transparent" copy of the Document means a machine-readable copy,
  represented in a format whose specification is available to the general
  public, that is suitable for revising the document straightforwardly with
  generic text editors or (for images composed of pixels) generic paint
  programs or (for drawings) some widely available drawing editor, and that is
  suitable for input to text formatters or for automatic translation to a
  variety of formats suitable for input to text formatters. A copy made in an
  otherwise Transparent file format whose markup, or absence of markup, has
  been arranged to thwart or discourage subsequent modification by readers is
  not Transparent. An image format is not Transparent if used for any
  substantial amount of text. A copy that is not "Transparent" is called
  "Opaque".
 </p><p>
  Examples of suitable formats for Transparent copies include plain ASCII
  without markup, Texinfo input format, LaTeX input format, SGML or XML using a
  publicly available DTD, and standard-conforming simple HTML, PostScript or
  PDF designed for human modification. Examples of transparent image formats
  include PNG, XCF and JPG. Opaque formats include proprietary formats that can
  be read and edited only by proprietary word processors, SGML or XML for which
  the DTD and/or processing tools are not generally available, and the
  machine-generated HTML, PostScript or PDF produced by some word processors
  for output purposes only.
 </p><p>
  The "Title Page" means, for a printed book, the title page itself, plus such
  following pages as are needed to hold, legibly, the material this License
  requires to appear in the title page. For works in formats which do not have
  any title page as such, "Title Page" means the text near the most prominent
  appearance of the work's title, preceding the beginning of the body of the
  text.
 </p><p>
  A section "Entitled XYZ" means a named subunit of the Document whose title
  either is precisely XYZ or contains XYZ in parentheses following text that
  translates XYZ in another language. (Here XYZ stands for a specific section
  name mentioned below, such as "Acknowledgements", "Dedications",
  "Endorsements", or "History".) To "Preserve the Title" of such a section when
  you modify the Document means that it remains a section "Entitled XYZ"
  according to this definition.
 </p><p>
  The Document may include Warranty Disclaimers next to the notice which states
  that this License applies to the Document. These Warranty Disclaimers are
  considered to be included by reference in this License, but only as regards
  disclaiming warranties: any other implication that these Warranty Disclaimers
  may have is void and has no effect on the meaning of this License.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.19"><span class="name">
    2. VERBATIM COPYING
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.19">#</a></h5></div><p>
  You may copy and distribute the Document in any medium, either commercially
  or non-commercially, provided that this License, the copyright notices, and
  the license notice saying this License applies to the Document are reproduced
  in all copies, and that you add no other conditions whatsoever to those of
  this License. You may not use technical measures to obstruct or control the
  reading or further copying of the copies you make or distribute. However, you
  may accept compensation in exchange for copies. If you distribute a large
  enough number of copies you must also follow the conditions in section 3.
 </p><p>
  You may also lend copies, under the same conditions stated above, and you may
  publicly display copies.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.22"><span class="name">
    3. COPYING IN QUANTITY
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.22">#</a></h5></div><p>
  If you publish printed copies (or copies in media that commonly have printed
  covers) of the Document, numbering more than 100, and the Document's license
  notice requires Cover Texts, you must enclose the copies in covers that
  carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the
  front cover, and Back-Cover Texts on the back cover. Both covers must also
  clearly and legibly identify you as the publisher of these copies. The front
  cover must present the full title with all words of the title equally
  prominent and visible. You may add other material on the covers in addition.
  Copying with changes limited to the covers, as long as they preserve the
  title of the Document and satisfy these conditions, can be treated as
  verbatim copying in other respects.
 </p><p>
  If the required texts for either cover are too voluminous to fit legibly, you
  should put the first ones listed (as many as fit reasonably) on the actual
  cover, and continue the rest onto adjacent pages.
 </p><p>
  If you publish or distribute Opaque copies of the Document numbering more
  than 100, you must either include a machine-readable Transparent copy along
  with each Opaque copy, or state in or with each Opaque copy a
  computer-network location from which the general network-using public has
  access to download using public-standard network protocols a complete
  Transparent copy of the Document, free of added material. If you use the
  latter option, you must take reasonably prudent steps, when you begin
  distribution of Opaque copies in quantity, to ensure that this Transparent
  copy will remain thus accessible at the stated location until at least one
  year after the last time you distribute an Opaque copy (directly or through
  your agents or retailers) of that edition to the public.
 </p><p>
  It is requested, but not required, that you contact the authors of the
  Document well before redistributing any large number of copies, to give them
  a chance to provide you with an updated version of the Document.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.27"><span class="name">
    4. MODIFICATIONS
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.27">#</a></h5></div><p>
  You may copy and distribute a Modified Version of the Document under the
  conditions of sections 2 and 3 above, provided that you release the Modified
  Version under precisely this License, with the Modified Version filling the
  role of the Document, thus licensing distribution and modification of the
  Modified Version to whoever possesses a copy of it. In addition, you must do
  these things in the Modified Version:
 </p><div class="orderedlist"><ol class="orderedlist" type="A"><li class="listitem"><p>
    Use in the Title Page (and on the covers, if any) a title distinct from
    that of the Document, and from those of previous versions (which should, if
    there were any, be listed in the History section of the Document). You may
    use the same title as a previous version if the original publisher of that
    version gives permission.
   </p></li><li class="listitem"><p>
    List on the Title Page, as authors, one or more persons or entities
    responsible for authorship of the modifications in the Modified Version,
    together with at least five of the principal authors of the Document (all
    of its principal authors, if it has fewer than five), unless they release
    you from this requirement.
   </p></li><li class="listitem"><p>
    State on the Title page the name of the publisher of the Modified Version,
    as the publisher.
   </p></li><li class="listitem"><p>
    Preserve all the copyright notices of the Document.
   </p></li><li class="listitem"><p>
    Add an appropriate copyright notice for your modifications adjacent to the
    other copyright notices.
   </p></li><li class="listitem"><p>
    Include, immediately after the copyright notices, a license notice giving
    the public permission to use the Modified Version under the terms of this
    License, in the form shown in the Addendum below.
   </p></li><li class="listitem"><p>
    Preserve in that license notice the full lists of Invariant Sections and
    required Cover Texts given in the Document's license notice.
   </p></li><li class="listitem"><p>
    Include an unaltered copy of this License.
   </p></li><li class="listitem"><p>
    Preserve the section Entitled "History", Preserve its Title, and add to it
    an item stating at least the title, year, new authors, and publisher of the
    Modified Version as given on the Title Page. If there is no section
    Entitled "History" in the Document, create one stating the title, year,
    authors, and publisher of the Document as given on its Title Page, then add
    an item describing the Modified Version as stated in the previous sentence.
   </p></li><li class="listitem"><p>
    Preserve the network location, if any, given in the Document for public
    access to a Transparent copy of the Document, and likewise the network
    locations given in the Document for previous versions it was based on.
    These may be placed in the "History" section. You may omit a network
    location for a work that was published at least four years before the
    Document itself, or if the original publisher of the version it refers to
    gives permission.
   </p></li><li class="listitem"><p>
    For any section Entitled "Acknowledgements" or "Dedications", Preserve the
    Title of the section, and preserve in the section all the substance and
    tone of each of the contributor acknowledgements and/or dedications given
    therein.
   </p></li><li class="listitem"><p>
    Preserve all the Invariant Sections of the Document, unaltered in their
    text and in their titles. Section numbers or the equivalent are not
    considered part of the section titles.
   </p></li><li class="listitem"><p>
    Delete any section Entitled "Endorsements". Such a section may not be
    included in the Modified Version.
   </p></li><li class="listitem"><p>
    Do not retitle any existing section to be Entitled "Endorsements" or to
    conflict in title with any Invariant Section.
   </p></li><li class="listitem"><p>
    Preserve any Warranty Disclaimers.
   </p></li></ol></div><p>
  If the Modified Version includes new front-matter sections or appendices that
  qualify as Secondary Sections and contain no material copied from the
  Document, you may at your option designate some or all of these sections as
  invariant. To do this, add their titles to the list of Invariant Sections in
  the Modified Version's license notice. These titles must be distinct from any
  other section titles.
 </p><p>
  You may add a section Entitled "Endorsements", provided it contains nothing
  but endorsements of your Modified Version by various parties--for example,
  statements of peer review or that the text has been approved by an
  organization as the authoritative definition of a standard.
 </p><p>
  You may add a passage of up to five words as a Front-Cover Text, and a
  passage of up to 25 words as a Back-Cover Text, to the end of the list of
  Cover Texts in the Modified Version. Only one passage of Front-Cover Text and
  one of Back-Cover Text may be added by (or through arrangements made by) any
  one entity. If the Document already includes a cover text for the same cover,
  previously added by you or by arrangement made by the same entity you are
  acting on behalf of, you may not add another; but you may replace the old
  one, on explicit permission from the previous publisher that added the old
  one.
 </p><p>
  The author(s) and publisher(s) of the Document do not by this License give
  permission to use their names for publicity for or to assert or imply
  endorsement of any Modified Version.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.34"><span class="name">
    5. COMBINING DOCUMENTS
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.34">#</a></h5></div><p>
  You may combine the Document with other documents released under this
  License, under the terms defined in section 4 above for modified versions,
  provided that you include in the combination all of the Invariant Sections of
  all of the original documents, unmodified, and list them all as Invariant
  Sections of your combined work in its license notice, and that you preserve
  all their Warranty Disclaimers.
 </p><p>
  The combined work need only contain one copy of this License, and multiple
  identical Invariant Sections may be replaced with a single copy. If there are
  multiple Invariant Sections with the same name but different contents, make
  the title of each such section unique by adding at the end of it, in
  parentheses, the name of the original author or publisher of that section if
  known, or else a unique number. Make the same adjustment to the section
  titles in the list of Invariant Sections in the license notice of the
  combined work.
 </p><p>
  In the combination, you must combine any sections Entitled "History" in the
  various original documents, forming one section Entitled "History"; likewise
  combine any sections Entitled "Acknowledgements", and any sections Entitled
  "Dedications". You must delete all sections Entitled "Endorsements".
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.38"><span class="name">
    6. COLLECTIONS OF DOCUMENTS
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.38">#</a></h5></div><p>
  You may make a collection consisting of the Document and other documents
  released under this License, and replace the individual copies of this
  License in the various documents with a single copy that is included in the
  collection, provided that you follow the rules of this License for verbatim
  copying of each of the documents in all other respects.
 </p><p>
  You may extract a single document from such a collection, and distribute it
  individually under this License, provided you insert a copy of this License
  into the extracted document, and follow this License in all other respects
  regarding verbatim copying of that document.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.41"><span class="name">
    7. AGGREGATION WITH INDEPENDENT WORKS
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.41">#</a></h5></div><p>
  A compilation of the Document or its derivatives with other separate and
  independent documents or works, in or on a volume of a storage or
  distribution medium, is called an "aggregate" if the copyright resulting from
  the compilation is not used to limit the legal rights of the compilation's
  users beyond what the individual works permit. When the Document is included
  in an aggregate, this License does not apply to the other works in the
  aggregate which are not themselves derivative works of the Document.
 </p><p>
  If the Cover Text requirement of section 3 is applicable to these copies of
  the Document, then if the Document is less than one half of the entire
  aggregate, the Document's Cover Texts may be placed on covers that bracket
  the Document within the aggregate, or the electronic equivalent of covers if
  the Document is in electronic form. Otherwise they must appear on printed
  covers that bracket the whole aggregate.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.44"><span class="name">
    8. TRANSLATION
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.44">#</a></h5></div><p>
  Translation is considered a kind of modification, so you may distribute
  translations of the Document under the terms of section 4. Replacing
  Invariant Sections with translations requires special permission from their
  copyright holders, but you may include translations of some or all Invariant
  Sections in addition to the original versions of these Invariant Sections.
  You may include a translation of this License, and all the license notices in
  the Document, and any Warranty Disclaimers, provided that you also include
  the original English version of this License and the original versions of
  those notices and disclaimers. In case of a disagreement between the
  translation and the original version of this License or a notice or
  disclaimer, the original version will prevail.
 </p><p>
  If a section in the Document is Entitled "Acknowledgements", "Dedications",
  or "History", the requirement (section 4) to Preserve its Title (section 1)
  will typically require changing the actual title.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.47"><span class="name">
    9. TERMINATION
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.47">#</a></h5></div><p>
  You may not copy, modify, sublicense, or distribute the Document except as
  expressly provided for under this License. Any other attempt to copy, modify,
  sublicense or distribute the Document is void, and will automatically
  terminate your rights under this License. However, parties who have received
  copies, or rights, from you under this License will not have their licenses
  terminated so long as such parties remain in full compliance.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.49"><span class="name">
    10. FUTURE REVISIONS OF THIS LICENSE
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.49">#</a></h5></div><p>
  The Free Software Foundation may publish new, revised versions of the GNU
  Free Documentation License from time to time. Such new versions will be
  similar in spirit to the present version, but may differ in detail to address
  new problems or concerns. See
  <a class="link" href="https://www.gnu.org/copyleft/" target="_blank">https://www.gnu.org/copyleft/</a>.
 </p><p>
  Each version of the License is given a distinguishing version number. If the
  Document specifies that a particular numbered version of this License "or any
  later version" applies to it, you have the option of following the terms and
  conditions either of that specified version or of any later version that has
  been published (not as a draft) by the Free Software Foundation. If the
  Document does not specify a version number of this License, you may choose
  any version ever published (not as a draft) by the Free Software Foundation.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.12.13.4.52"><span class="name">
    ADDENDUM: How to use this License for your documents
  </span><a title="Permalink" class="permalink" href="#id-1.12.13.4.52">#</a></h5></div><div class="verbatim-wrap"><pre class="screen">Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.</pre></div><p>
  If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
  replace the “with...Texts.” line with this:
 </p><div class="verbatim-wrap"><pre class="screen">with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</pre></div><p>
  If you have Invariant Sections without Cover Texts, or some other combination
  of the three, merge those two alternatives to suit the situation.
 </p><p>
  If your document contains nontrivial examples of program code, we recommend
  releasing these examples in parallel under your choice of free software
  license, such as the GNU General Public License, to permit their use in free
  software.
 </p></section></section></div></section></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>