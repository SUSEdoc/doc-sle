<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLES 15 SP3 | Storage Administration Guide | LVM volume snapshots</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="LVM volume snapshots | SLES 15 SP3"/>
<meta name="description" content="A Logical Volume Manager (LVM) logical volume snapshot is a copy-on-write technology that monitors changes to an existing volume’s data blocks so tha…"/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="15 SP3"/>
<meta name="book-title" content="Storage Administration Guide"/>
<meta name="chapter-title" content="Chapter 6. LVM volume snapshots"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Server 15 SP3"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Storage Administration Guide"/>
<meta property="og:description" content="Administer storage devices on SLES"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Storage Administration Guide"/>
<meta name="twitter:description" content="Administer storage devices on SLES"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "LVM volume snapshots",
  
    "description": "LVM volume snapshots",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-04-26T00:00+02:00",
      
    "datePublished": "2021-06-22T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-lvm.html" title="Chapter 5. LVM configuration"/><link rel="next" href="part-software-raid.html" title="Part III. Software RAID"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/storage_lvm-snapshots.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Storage Administration Guide</a><span> / </span><a class="crumb" href="part-lvm.html">Logical volumes (LVM)</a><span> / </span><a class="crumb" href="cha-lvm-snapshots.html">LVM volume snapshots</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Storage Administration Guide</div><ol><li><a href="storage-preface.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="part-filesystems.html" class="has-children "><span class="title-number">I </span><span class="title-name">File systems and mounting</span></a><ol><li><a href="cha-filesystems.html" class=" "><span class="title-number">1 </span><span class="title-name">Overview of file systems in Linux</span></a></li><li><a href="cha-resize-fs.html" class=" "><span class="title-number">2 </span><span class="title-name">Resizing file systems</span></a></li><li><a href="cha-uuid.html" class=" "><span class="title-number">3 </span><span class="title-name">Mounting storage devices</span></a></li><li><a href="cha-multitiercache.html" class=" "><span class="title-number">4 </span><span class="title-name">Multi-tier caching for block device operations</span></a></li></ol></li><li class="active"><a href="part-lvm.html" class="has-children you-are-here"><span class="title-number">II </span><span class="title-name">Logical volumes (LVM)</span></a><ol><li><a href="cha-lvm.html" class=" "><span class="title-number">5 </span><span class="title-name">LVM configuration</span></a></li><li><a href="cha-lvm-snapshots.html" class=" you-are-here"><span class="title-number">6 </span><span class="title-name">LVM volume snapshots</span></a></li></ol></li><li><a href="part-software-raid.html" class="has-children "><span class="title-number">III </span><span class="title-name">Software RAID</span></a><ol><li><a href="cha-raid.html" class=" "><span class="title-number">7 </span><span class="title-name">Software RAID configuration</span></a></li><li><a href="cha-raidroot.html" class=" "><span class="title-number">8 </span><span class="title-name">Configuring software RAID for the root partition</span></a></li><li><a href="cha-raid10.html" class=" "><span class="title-number">9 </span><span class="title-name">Creating software RAID 10 devices</span></a></li><li><a href="cha-raid-degraded.html" class=" "><span class="title-number">10 </span><span class="title-name">Creating a degraded RAID array</span></a></li><li><a href="cha-raid-resize.html" class=" "><span class="title-number">11 </span><span class="title-name">Resizing software RAID arrays with mdadm</span></a></li><li><a href="cha-raid-leds.html" class=" "><span class="title-number">12 </span><span class="title-name">Storage enclosure LED utilities for MD software RAIDs</span></a></li><li><a href="cha-raidtroubleshooting.html" class=" "><span class="title-number">13 </span><span class="title-name">Troubleshooting software RAIDs</span></a></li></ol></li><li><a href="part-net-storage.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Network storage</span></a><ol><li><a href="cha-isns.html" class=" "><span class="title-number">14 </span><span class="title-name">iSNS for Linux</span></a></li><li><a href="cha-iscsi.html" class=" "><span class="title-number">15 </span><span class="title-name">Mass storage over IP networks: iSCSI</span></a></li><li><a href="cha-fcoe.html" class=" "><span class="title-number">16 </span><span class="title-name">Fibre Channel storage over Ethernet networks: FCoE</span></a></li><li><a href="cha-nvmeof.html" class=" "><span class="title-number">17 </span><span class="title-name">NVMe-oF</span></a></li><li><a href="cha-multipath.html" class=" "><span class="title-number">18 </span><span class="title-name">Managing multipath I/O for devices</span></a></li><li><a href="cha-nfs.html" class=" "><span class="title-number">19 </span><span class="title-name">Sharing file systems with NFS</span></a></li><li><a href="cha-samba.html" class=" "><span class="title-number">20 </span><span class="title-name">Samba</span></a></li><li><a href="cha-autofs.html" class=" "><span class="title-number">21 </span><span class="title-name">On-demand mounting with autofs</span></a></li></ol></li><li><a href="bk09apa.html" class=" "><span class="title-number">A </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section xml:lang="en" class="chapter" id="cha-lvm-snapshots" data-id-title="LVM volume snapshots"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP3</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">6 </span><span class="title-name">LVM volume snapshots</span></span> <a title="Permalink" class="permalink" href="cha-lvm-snapshots.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/storage_lvm-snapshots.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  A Logical Volume Manager (LVM) logical volume snapshot is a copy-on-write
  technology that monitors changes to an existing volume’s data blocks so
  that when a write is made to one of the blocks, the block’s value at the
  snapshot time is copied to a snapshot volume. In this way, a point-in-time
  copy of the data is preserved until the snapshot volume is deleted.
 </p><section class="sect1" id="sec-lvm-snapshots-intro" data-id-title="Understanding volume snapshots"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.1 </span><span class="title-name">Understanding volume snapshots</span></span> <a title="Permalink" class="permalink" href="cha-lvm-snapshots.html#sec-lvm-snapshots-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/storage_lvm-snapshots.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A file system snapshot contains metadata about itself and data blocks from a
   source logical volume that has changed since the snapshot was taken. When
   you access data via the snapshot, you see a point-in-time copy of the source
   logical volume. There is no need to restore data from backup media or to
   overwrite the changed data.
  </p><div id="id-1.11.4.3.4.3" data-id-title="Mounting volumes with snapshots" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Mounting volumes with snapshots</div><p>
    During the snapshot’s lifetime, the snapshot must be mounted before its
    source logical volume can be mounted.
   </p></div><p>
   LVM volume snapshots allow you to create a backup from a point-in-time view
   of the file system. The snapshot is created instantly and persists until you
   delete it. You can back up the file system from the snapshot while the
   volume itself continues to be available for users. The snapshot initially
   contains some metadata about the snapshot, but no actual data from the
   source logical volume. Snapshot uses copy-on-write technology to detect when
   data changes in an original data block. It copies the value it held when the
   snapshot was taken to a block in the snapshot volume, then allows the new
   data to be stored in the source block. As more blocks change from their
   original value on the source logical volume, the snapshot size grows.
  </p><p>
   When you are sizing the snapshot, consider how much data is expected to
   change on the source logical volume and how long you plan to keep the
   snapshot. The amount of space that you allocate for a snapshot volume can
   vary, depending on the size of the source logical volume, how long you plan
   to keep the snapshot, and the number of data blocks that are expected to
   change during the snapshot’s lifetime. The snapshot volume cannot be
   resized after it is created. As a guide, create a snapshot volume that is
   about 10% of the size of the original logical volume. If you anticipate that
   every block in the source logical volume will change at least one time
   before you delete the snapshot, then the snapshot volume should be at least
   as large as the source logical volume plus some additional space for
   metadata about the snapshot volume. Less space is required if the data
   changes infrequently or if the expected lifetime is sufficiently brief.
  </p><p>
   In LVM2, snapshots are read/write by default. When you write data directly
   to the snapshot, that block is marked in the exception table as used, and
   never gets copied from the source logical volume. You can mount the snapshot
   volume, and test application changes by writing data directly to the
   snapshot volume. You can easily discard the changes by dismounting the
   snapshot, removing the snapshot, and then remounting the source logical
   volume.
  </p><p>
   In a virtual guest environment, you can use the snapshot function for LVM
   logical volumes you create on the server’s disks, as you would on a
   physical server.
  </p><p>
   In a virtual host environment, you can use the snapshot function to back up
   the virtual machine’s storage back-end, or to test changes to a virtual
   machine image, such as for patches or upgrades, without modifying the source
   logical volume. The virtual machine must be using an LVM logical volume as
   its storage back-end, as opposed to using a virtual disk file. You can mount
   the LVM logical volume and use it to store the virtual machine image as a
   file-backed disk, or you can assign the LVM logical volume as a physical
   disk to write to it as a block device.
  </p><p>
   Beginning in SLES 11 SP3, an LVM logical volume snapshot can be thinly
   provisioned. Thin provisioning is assumed if you create a snapshot without a
   specified size. The snapshot is created as a thin volume that uses space as
   needed from a thin pool. A thin snapshot volume has the same characteristics
   as any other thin volume. You can independently activate the volume, extend
   the volume, rename the volume, remove the volume, and even snapshot the
   volume.
  </p><div id="id-1.11.4.3.4.10" data-id-title="Thinly provisioned volumes in a cluster" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Thinly provisioned volumes in a cluster</div><p>
    To use thinly provisioned snapshots in a cluster, the source logical volume
    and its snapshots must be managed in a single cluster resource. This allows
    the volume and its snapshots to always be mounted exclusively on the same
    node.
   </p></div><p>
   When you are done with the snapshot, it is important to remove it from the
   system. A snapshot eventually fills up completely as data blocks change on
   the source logical volume. When the snapshot is full, it is disabled, which
   prevents you from remounting the source logical volume.
  </p><p>
   If you create multiple snapshots for a source logical volume, remove the
   snapshots in a last created, first deleted order.
  </p></section><section class="sect1" id="sec-lvm-snapshots-create" data-id-title="Creating Linux snapshots with LVM"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.2 </span><span class="title-name">Creating Linux snapshots with LVM</span></span> <a title="Permalink" class="permalink" href="cha-lvm-snapshots.html#sec-lvm-snapshots-create">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/storage_lvm-snapshots.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The Logical Volume Manager (LVM) can be used for creating snapshots of your
   file system.
  </p><p>
   Open a terminal and enter
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvcreate -s [-L <em class="replaceable">&lt;size</em>&gt;] -n <em class="replaceable">SNAP_VOLUME</em> <em class="replaceable">SOURCE_VOLUME_PATH</em></pre></div><p>
   If no size is specified, the snapshot is created as a thin snapshot.
  </p><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvcreate -s -L 1G -n linux01-snap /dev/lvm/linux01</pre></div><p>
   The snapshot is created as the <code class="filename">/dev/lvm/linux01-snap</code>
   volume.
  </p></section><section class="sect1" id="sec-lvm-snapshots-monitor" data-id-title="Monitoring a snapshot"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.3 </span><span class="title-name">Monitoring a snapshot</span></span> <a title="Permalink" class="permalink" href="cha-lvm-snapshots.html#sec-lvm-snapshots-monitor">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/storage_lvm-snapshots.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Open a terminal and enter
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvdisplay <em class="replaceable">SNAP_VOLUME</em></pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvdisplay /dev/vg01/linux01-snap

--- Logical volume ---
  LV Name                /dev/lvm/linux01
  VG Name                vg01
  LV UUID                QHVJYh-PR3s-A4SG-s4Aa-MyWN-Ra7a-HL47KL
  LV Write Access        read/write
  LV snapshot status     active destination for /dev/lvm/linux01
  LV Status              available
  # open                 0
  LV Size                80.00 GB
  Current LE             1024
  COW-table size         8.00 GB
  COW-table LE           512
  Allocated to snapshot  30%
  Snapshot chunk size    8.00 KB
  Segments               1
  Allocation             inherit
  Read ahead sectors     0
  Block device           254:5</pre></div></section><section class="sect1" id="sec-lvm-snapshots-delete" data-id-title="Deleting Linux snapshots"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.4 </span><span class="title-name">Deleting Linux snapshots</span></span> <a title="Permalink" class="permalink" href="cha-lvm-snapshots.html#sec-lvm-snapshots-delete">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/storage_lvm-snapshots.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Open a terminal and enter
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvremove <em class="replaceable">SNAP_VOLUME_PATH</em></pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvremove /dev/lvmvg/linux01-snap</pre></div></section><section class="sect1" id="sec-lvm-snapshots-xen-host" data-id-title="Using snapshots for virtual machines on a virtual host"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.5 </span><span class="title-name">Using snapshots for virtual machines on a virtual host</span></span> <a title="Permalink" class="permalink" href="cha-lvm-snapshots.html#sec-lvm-snapshots-xen-host">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/storage_lvm-snapshots.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Using an LVM logical volume for a virtual machine’s back-end storage
   allows flexibility in administering the underlying device, such as making it
   easier to move storage objects, create snapshots, and back up data. You can
   mount the LVM logical volume and use it to store the virtual machine image
   as a file-backed disk, or you can assign the LVM logical volume as a
   physical disk to write to it as a block device. You can create a virtual
   disk image on the LVM logical volume, then snapshot the LVM.
  </p><p>
   You can leverage the read/write capability of the snapshot to create
   different instances of a virtual machine, where the changes are made to the
   snapshot for a particular virtual machine instance. You can create a virtual
   disk image on an LVM logical volume, snapshot the source logical volume, and
   modify the snapshot for a particular virtual machine instance. You can
   create another snapshot of the source logical volume, and modify it for a
   different virtual machine instance. The majority of the data for the
   different virtual machine instances resides with the image on the source
   logical volume.
  </p><p>
   You can also leverage the read/write capability of the snapshot to preserve
   the virtual disk image while testing patches or upgrades in the guest
   environment. You create a snapshot of the LVM volume that contains the
   image, and then run the virtual machine on the snapshot location. The source
   logical volume is unchanged, and all changes for that machine are written to
   the snapshot. To return to the source logical volume of the virtual machine
   image, you power off the virtual machine, then remove the snapshot from the
   source logical volume. To start over, you re-create the snapshot, mount the
   snapshot, and restart the virtual machine on the snapshot image.
  </p><p>
   The following procedure uses a file-backed virtual disk image and the Xen
   hypervisor. You can adapt the procedure in this section for other
   hypervisors that run on the SUSE Linux Enterprise platform, such as KVM. To run a
   file-backed virtual machine image from the snapshot volume:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Ensure that the source logical volume that contains the file-backed
     virtual machine image is mounted, such as at mount point
     <code class="filename">/var/lib/xen/images/&lt;<em class="replaceable">IMAGE_NAME</em>&gt;</code>.
    </p></li><li class="step"><p>
     Create a snapshot of the LVM logical volume with enough space to store the
     differences that you expect.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvcreate -s -L 20G -n myvm-snap /dev/lvmvg/myvm</pre></div><p>
     If no size is specified, the snapshot is created as a thin snapshot.
    </p></li><li class="step"><p>
     Create a mount point where you will mount the snapshot volume.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mkdir -p /mnt/xen/vm/myvm-snap</pre></div></li><li class="step"><p>
     Mount the snapshot volume at the mount point you created.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mount -t auto /dev/lvmvg/myvm-snap /mnt/xen/vm/myvm-snap</pre></div></li><li class="step"><p>
     In a text editor, copy the configuration file for the source virtual
     machine, modify the paths to point to the file-backed image file on the
     mounted snapshot volume, and save the file such as
     <code class="filename">/etc/xen/myvm-snap.cfg</code>.
    </p></li><li class="step"><p>
     Start the virtual machine using the mounted snapshot volume of the virtual
     machine.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xm create -c /etc/xen/myvm-snap.cfg</pre></div></li><li class="step"><p>
     (Optional) Remove the snapshot, and use the unchanged virtual machine
     image on the source logical volume.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> umount /mnt/xenvms/myvm-snap
<code class="prompt user">&gt; </code><code class="command">sudo</code> lvremove -f /dev/lvmvg/mylvm-snap</pre></div></li><li class="step"><p>
     (Optional) Repeat this process as desired.
    </p></li></ol></div></div></section><section class="sect1" id="sec-lvm-snapshots-rollback" data-id-title="Merging a snapshot with the source logical volume to revert changes or roll back to a previous state"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.6 </span><span class="title-name">Merging a snapshot with the source logical volume to revert changes or roll back to a previous state</span></span> <a title="Permalink" class="permalink" href="cha-lvm-snapshots.html#sec-lvm-snapshots-rollback">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE15SP3/xml/storage_lvm-snapshots.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Snapshots can be useful if you need to roll back or restore data on a volume
   to a previous state. For example, you might need to revert data changes that
   resulted from an administrator error or a failed or undesirable package
   installation or upgrade.
  </p><p>
   You can use the <code class="command">lvconvert --merge</code> command to revert the
   changes made to an LVM logical volume. The merging begins as follows:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     If both the source logical volume and snapshot volume are not open, the
     merge begins immediately.
    </p></li><li class="listitem"><p>
     If the source logical volume or snapshot volume are open, the merge starts
     the first time either the source logical volume or snapshot volume are
     activated and both are closed.
    </p></li><li class="listitem"><p>
     If the source logical volume cannot be closed, such as the root file
     system, the merge is deferred until the next time the server reboots and
     the source logical volume is activated.
    </p></li><li class="listitem"><p>
     If the source logical volume contains a virtual machine image, you must
     shut down the virtual machine, deactivate the source logical volume and
     snapshot volume (by dismounting them in that order), and then issue the
     merge command. Because the source logical volume is automatically
     remounted and the snapshot volume is deleted when the merge is complete,
     you should not restart the virtual machine until after the merge is
     complete. After the merge is complete, you use the resulting logical
     volume for the virtual machine.
    </p></li></ul></div><p>
   After a merge begins, the merge continues automatically after server
   restarts until it is complete. A new snapshot cannot be created for the
   source logical volume while a merge is in progress.
  </p><p>
   While the merge is in progress, reads or writes to the source logical volume
   are transparently redirected to the snapshot that is being merged. This
   allows users to immediately view and access the data as it was when the
   snapshot was created. They do not need to wait for the merge to complete.
  </p><p>
   When the merge is complete, the source logical volume contains the same data
   as it did when the snapshot was taken, plus any data changes made after the
   merge began. The resulting logical volume has the source logical volume’s
   name, minor number, and UUID. The source logical volume is automatically
   remounted, and the snapshot volume is removed.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Open a terminal and enter
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvconvert --merge  [-b] [-i <em class="replaceable">SECONDS</em>] [<em class="replaceable">SNAP_VOLUME_PATH</em>[...<em class="replaceable">snapN</em>]|@<em class="replaceable">VOLUME_TAG</em>]</pre></div><p>
     You can specify one or multiple snapshots on the command line. You can
     alternatively tag multiple source logical volumes with the same volume tag
     then specify
     <code class="literal">@&lt;<em class="replaceable">VOLUME_TAG</em>&gt;</code> on the
     command line. The snapshots for the tagged volumes are merged to their
     respective source logical volumes. For information about tagging logical
     volumes, see
     <a class="xref" href="cha-lvm.html#sec-lvm-tagging" title="5.10. Tagging LVM2 storage objects">Section 5.10, “Tagging LVM2 storage objects”</a>.
    </p><p>
     The options include:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.4.3.9.8.1.5.1"><span class="term">-b, </span><span class="term">--background</span></dt><dd><p>
        Run the daemon in the background. This allows multiple specified
        snapshots to be merged concurrently in parallel.
       </p></dd><dt id="id-1.11.4.3.9.8.1.5.2"><span class="term">-i, </span><span class="term">--interval &lt;<em class="replaceable">SECONDS</em>&gt;</span></dt><dd><p>
        Report progress as a percentage at regular intervals. Specify the
        interval in seconds.
       </p></dd></dl></div><p>
     For more information about this command, see the
     <code class="command">lvconvert(8)</code> man page.
    </p><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvconvert --merge /dev/lvmvg/linux01-snap</pre></div><p>
     This command merges <code class="filename">/dev/lvmvg/linux01-snap</code> into its
     source logical volume.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvconvert --merge @mytag</pre></div><p>
     If <code class="filename">lvol1</code>, <code class="filename">lvol2</code>, and
     <code class="filename">lvol3</code> are all tagged with <code class="literal">mytag</code>,
     each snapshot volume is merged serially with its respective source logical
     volume; that is: <code class="filename">lvol1</code>, then
     <code class="filename">lvol2</code>, then <code class="filename">lvol3</code>. If the
     <code class="literal">--background</code> option is specified, the snapshots for the
     respective tagged logical volume are merged concurrently in parallel.
    </p></li><li class="step"><p>
     (Optional) If both the source logical volume and snapshot volume are open
     and they can be closed, you can manually deactivate and activate the
     source logical volume to get the merge to start immediately.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> umount <em class="replaceable">ORIGINAL_VOLUME</em>
<code class="prompt user">&gt; </code><code class="command">sudo</code> lvchange -an <em class="replaceable">ORIGINAL_VOLUME</em>
<code class="prompt user">&gt; </code><code class="command">sudo</code> lvchange -ay <em class="replaceable">ORIGINAL_VOLUME</em>
<code class="prompt user">&gt; </code><code class="command">sudo</code> mount <em class="replaceable">ORIGINAL_VOLUME</em> <em class="replaceable">MOUNT_POINT</em></pre></div><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> umount /dev/lvmvg/lvol01
<code class="prompt user">&gt; </code><code class="command">sudo</code> lvchange -an /dev/lvmvg/lvol01
<code class="prompt user">&gt; </code><code class="command">sudo</code> lvchange -ay /dev/lvmvg/lvol01
<code class="prompt user">&gt; </code><code class="command">sudo</code> mount /dev/lvmvg/lvol01 /mnt/lvol01</pre></div></li><li class="step"><p>
     (Optional) If both the source logical volume and snapshot volume are open
     and the source logical volume cannot be closed, such as the <code class="systemitem">root</code>
     file system, you can restart the server and mount the source logical
     volume to get the merge to start immediately after the restart.
    </p></li></ol></div></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-lvm.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 5 </span>LVM configuration</span></a> </div><div><a class="pagination-link next" href="part-software-raid.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Part III </span>Software RAID</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-lvm-snapshots.html#sec-lvm-snapshots-intro"><span class="title-number">6.1 </span><span class="title-name">Understanding volume snapshots</span></a></span></li><li><span class="sect1"><a href="cha-lvm-snapshots.html#sec-lvm-snapshots-create"><span class="title-number">6.2 </span><span class="title-name">Creating Linux snapshots with LVM</span></a></span></li><li><span class="sect1"><a href="cha-lvm-snapshots.html#sec-lvm-snapshots-monitor"><span class="title-number">6.3 </span><span class="title-name">Monitoring a snapshot</span></a></span></li><li><span class="sect1"><a href="cha-lvm-snapshots.html#sec-lvm-snapshots-delete"><span class="title-number">6.4 </span><span class="title-name">Deleting Linux snapshots</span></a></span></li><li><span class="sect1"><a href="cha-lvm-snapshots.html#sec-lvm-snapshots-xen-host"><span class="title-number">6.5 </span><span class="title-name">Using snapshots for virtual machines on a virtual host</span></a></span></li><li><span class="sect1"><a href="cha-lvm-snapshots.html#sec-lvm-snapshots-rollback"><span class="title-number">6.6 </span><span class="title-name">Merging a snapshot with the source logical volume to revert changes or roll back to a previous state</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>