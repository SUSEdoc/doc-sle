<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLED 15 SP5 | Security and Hardening Guide | Building profiles from the command line</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Building profiles from the command line | SLED 15 SP5"/>
<meta name="description" content="AppArmor® provides the user the ability to use a command line interface rather than a graphical interface to manage and configure the system security…"/>
<meta name="product-name" content="SUSE Linux Enterprise Desktop"/>
<meta name="product-number" content="15 SP5"/>
<meta name="book-title" content="Security and Hardening Guide"/>
<meta name="chapter-title" content="Chapter 35. Building profiles from the command line"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Desktop 15 SP5"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Security and Hardening Guide"/>
<meta property="og:description" content="Implement system security and hardening for SLED"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Security and Hardening Guide"/>
<meta name="twitter:description" content="Implement system security and hardening for SLED"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Building profiles from the command line",
  
    "description": "Building profiles from the command line",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-05-27T00:00+02:00",
      
    "datePublished": "2023-06-20T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-apparmor-yast.html" title="Chapter 34. Building and managing profiles with YaST"/><link rel="next" href="cha-apparmor-hat.html" title="Chapter 36. Profiling your Web applications using ChangeHat"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Security and Hardening Guide</a><span> / </span><a class="crumb" href="part-apparmor.html">Confining privileges with AppArmor</a><span> / </span><a class="crumb" href="cha-apparmor-commandline.html">Building profiles from the command line</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Security and Hardening Guide</div><ol><li><a href="preface-security.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="cha-security.html" class=" "><span class="title-number">1 </span><span class="title-name">Security and confidentiality</span></a></li><li><a href="part-auth.html" class="has-children "><span class="title-number">I </span><span class="title-name">Authentication</span></a><ol><li><a href="cha-pam.html" class=" "><span class="title-number">2 </span><span class="title-name">Authentication with PAM</span></a></li><li><a href="cha-nis.html" class=" "><span class="title-number">3 </span><span class="title-name">Using NIS</span></a></li><li><a href="cha-security-auth.html" class=" "><span class="title-number">4 </span><span class="title-name">Setting up authentication clients using YaST</span></a></li><li><a href="cha-security-ldap.html" class=" "><span class="title-number">5 </span><span class="title-name">LDAP with 389 Directory Server</span></a></li><li><a href="cha-security-kerberos.html" class=" "><span class="title-number">6 </span><span class="title-name">Network authentication with Kerberos</span></a></li><li><a href="cha-security-ad.html" class=" "><span class="title-number">7 </span><span class="title-name">Active Directory support</span></a></li><li><a href="cha-security-freeradius.html" class=" "><span class="title-number">8 </span><span class="title-name">Setting up a freeRADIUS server</span></a></li></ol></li><li><a href="part-local-security.html" class="has-children "><span class="title-number">II </span><span class="title-name">Local security</span></a><ol><li><a href="cha-physical-security.html" class=" "><span class="title-number">9 </span><span class="title-name">Physical security</span></a></li><li><a href="sec-sec-software-management.html" class=" "><span class="title-number">10 </span><span class="title-name">Software management</span></a></li><li><a href="sec-sec-file-management.html" class=" "><span class="title-number">11 </span><span class="title-name">File management</span></a></li><li><a href="cha-security-cryptofs.html" class=" "><span class="title-number">12 </span><span class="title-name">Encrypting partitions and files</span></a></li><li><a href="cha-configure-cryptctl.html" class=" "><span class="title-number">13 </span><span class="title-name">Storage encryption for hosted applications with cryptctl</span></a></li><li><a href="sec-sec-user-management.html" class=" "><span class="title-number">14 </span><span class="title-name">User management</span></a></li><li><a href="cha-sec-cron-at.html" class=" "><span class="title-number">15 </span><span class="title-name">Restricting <code class="systemitem">cron</code> and <code class="systemitem">at</code></span></a></li><li><a href="cha-spectre.html" class=" "><span class="title-number">16 </span><span class="title-name">Spectre/Meltdown checker</span></a></li><li><a href="cha-security-yast-security.html" class=" "><span class="title-number">17 </span><span class="title-name">Configuring security settings with YaST</span></a></li><li><a href="cha-security-polkit.html" class=" "><span class="title-number">18 </span><span class="title-name">The Polkit authentication framework</span></a></li><li><a href="cha-security-acls.html" class=" "><span class="title-number">19 </span><span class="title-name">Access control lists in Linux</span></a></li><li><a href="cha-aide.html" class=" "><span class="title-number">20 </span><span class="title-name">Intrusion detection with AIDE</span></a></li></ol></li><li><a href="part-network-security.html" class="has-children "><span class="title-number">III </span><span class="title-name">Network security</span></a><ol><li><a href="cha-xauth.html" class=" "><span class="title-number">21 </span><span class="title-name">X Window System and X authentication</span></a></li><li><a href="cha-ssh.html" class=" "><span class="title-number">22 </span><span class="title-name">Securing network operations with OpenSSH</span></a></li><li><a href="cha-security-firewall.html" class=" "><span class="title-number">23 </span><span class="title-name">Masquerading and firewalls</span></a></li><li><a href="cha-security-vpnserver.html" class=" "><span class="title-number">24 </span><span class="title-name">Configuring a VPN server</span></a></li><li><a href="cha-security-xca.html" class=" "><span class="title-number">25 </span><span class="title-name">Managing a PKI with XCA, X certificate and key manager</span></a></li><li><a href="cha-sec-sysctl.html" class=" "><span class="title-number">26 </span><span class="title-name">Improving network security with <code class="command">sysctl</code> variables</span></a></li></ol></li><li><a href="part-compliance.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Regulations and Compliance</span></a><ol><li><a href="cha-common-criteria.html" class=" "><span class="title-number">27 </span><span class="title-name">Common Criteria</span></a></li><li><a href="cha-security-fips.html" class=" "><span class="title-number">28 </span><span class="title-name">Enabling compliance with FIPS 140-3</span></a></li></ol></li><li class="active"><a href="part-apparmor.html" class="has-children you-are-here"><span class="title-number">V </span><span class="title-name">Confining privileges with <span class="phrase">AppArmor</span></span></a><ol><li><a href="cha-apparmor-intro.html" class=" "><span class="title-number">29 </span><span class="title-name">Introducing <span class="phrase">AppArmor</span></span></a></li><li><a href="cha-apparmor-start.html" class=" "><span class="title-number">30 </span><span class="title-name">Getting started</span></a></li><li><a href="cha-apparmor-concept.html" class=" "><span class="title-number">31 </span><span class="title-name">Immunizing programs</span></a></li><li><a href="cha-apparmor-profiles.html" class=" "><span class="title-number">32 </span><span class="title-name">Profile components and syntax</span></a></li><li><a href="cha-apparmor-repos.html" class=" "><span class="title-number">33 </span><span class="title-name"><span class="phrase">AppArmor</span> profile repositories</span></a></li><li><a href="cha-apparmor-yast.html" class=" "><span class="title-number">34 </span><span class="title-name">Building and managing profiles with YaST</span></a></li><li><a href="cha-apparmor-commandline.html" class=" you-are-here"><span class="title-number">35 </span><span class="title-name">Building profiles from the command line</span></a></li><li><a href="cha-apparmor-hat.html" class=" "><span class="title-number">36 </span><span class="title-name">Profiling your Web applications using ChangeHat</span></a></li><li><a href="cha-apparmor-pam.html" class=" "><span class="title-number">37 </span><span class="title-name">Confining users with <code class="systemitem">pam_apparmor</code></span></a></li><li><a href="cha-apparmor-managing.html" class=" "><span class="title-number">38 </span><span class="title-name">Managing profiled applications</span></a></li><li><a href="cha-apparmor-support.html" class=" "><span class="title-number">39 </span><span class="title-name">Support</span></a></li><li><a href="cha-apparmor-glossary.html" class=" "><span class="title-number">40 </span><span class="title-name"><span class="phrase">AppArmor</span> glossary</span></a></li></ol></li><li><a href="part-audit.html" class="has-children "><span class="title-number">VI </span><span class="title-name">The Linux Audit Framework</span></a><ol><li><a href="cha-audit-comp.html" class=" "><span class="title-number">41 </span><span class="title-name">Understanding Linux audit</span></a></li><li><a href="cha-audit-setup.html" class=" "><span class="title-number">42 </span><span class="title-name">Setting up the Linux audit framework</span></a></li><li><a href="cha-audit-scenarios.html" class=" "><span class="title-number">43 </span><span class="title-name">Introducing an audit rule set</span></a></li><li><a href="cha-audit-moreinfo.html" class=" "><span class="title-number">44 </span><span class="title-name">Useful resources</span></a></li></ol></li><li><a href="bk05apa.html" class=" "><span class="title-number">A </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-apparmor-commandline" data-id-title="Building profiles from the command line"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP5</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">35 </span><span class="title-name">Building profiles from the command line</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  <span class="phrase">AppArmor®</span> provides the user the ability to use a command line interface
  rather than a graphical interface to manage and configure the system
  security. Track the status of <span class="phrase">AppArmor</span> and create, delete or modify
  <span class="phrase">AppArmor</span> profiles using the <span class="phrase">AppArmor</span> command line tools.
 </p><div id="id-1.7.8.8.4" data-id-title="Background information" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Background information</div><p>
   Before starting to manage your profiles using the <span class="phrase">AppArmor</span> command line
   tools, check out the general introduction to <span class="phrase">AppArmor</span> given in
   <a class="xref" href="cha-apparmor-concept.html" title="Chapter 31. Immunizing programs">Chapter 31, <em>Immunizing programs</em></a> and
   <a class="xref" href="cha-apparmor-profiles.html" title="Chapter 32. Profile components and syntax">Chapter 32, <em>Profile components and syntax</em></a>.
  </p></div><section class="sect1" id="sec-apparmor-commandline-status" data-id-title="Checking the AppArmor status"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.1 </span><span class="title-name">Checking the <span class="phrase">AppArmor</span> status</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-status">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> can be in any one of three states:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.5.3.1"><span class="term">Unloaded</span></dt><dd><p>
      <span class="phrase">AppArmor</span> is not activated in the kernel.
     </p></dd><dt id="id-1.7.8.8.5.3.2"><span class="term">Running</span></dt><dd><p>
      <span class="phrase">AppArmor</span> is activated in the kernel and is enforcing <span class="phrase">AppArmor</span> program
      policies.
     </p></dd><dt id="id-1.7.8.8.5.3.3"><span class="term">Stopped</span></dt><dd><p>
      <span class="phrase">AppArmor</span> is activated in the kernel, but no policies are enforced.
     </p></dd></dl></div><p>
   Detect the state of <span class="phrase">AppArmor</span> by inspecting
   <code class="filename">/sys/kernel/security/apparmor/profiles</code>. If
   <code class="command">cat /sys/kernel/security/apparmor/profiles</code> reports a
   list of profiles, <span class="phrase">AppArmor</span> is running. If it is empty and returns nothing,
   <span class="phrase">AppArmor</span> is stopped. If the file does not exist, <span class="phrase">AppArmor</span> is unloaded.
  </p><p>
   Manage <span class="phrase">AppArmor</span> with <code class="command">systemctl</code>. It lets you perform the
   following operations:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.5.6.1"><span class="term"><code class="command">sudo systemctl start apparmor</code>
    </span></dt><dd><p>
      Behavior depends on the state of <span class="phrase">AppArmor</span>. If it is not activated,
      <code class="option">start</code> activates and starts it, putting it in the
      running state. If it is stopped, <code class="option">start</code> causes the
      re-scan of <span class="phrase">AppArmor</span> profiles found in
      <code class="filename">/etc/apparmor.d</code> and puts <span class="phrase">AppArmor</span> in the running
      state. If <span class="phrase">AppArmor</span> is already running, <code class="option">start</code> reports a
      warning and takes no action.
     </p><div id="id-1.7.8.8.5.6.1.2.2" data-id-title="Already running processes" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Already running processes</div><p>
       Already running processes need to be restarted to apply the <span class="phrase">AppArmor</span>
       profiles on them.
      </p></div></dd><dt id="id-1.7.8.8.5.6.2"><span class="term"><code class="command">sudo systemctl stop apparmor</code>
    </span></dt><dd><p>
      Stops <span class="phrase">AppArmor</span> if it is running by removing all profiles from kernel
      memory, effectively disabling all access controls, and putting <span class="phrase">AppArmor</span>
      into the stopped state. If the <span class="phrase">AppArmor</span> is already stopped,
      <code class="option">stop</code> tries to unload the profiles again, but nothing
      happens.
     </p></dd><dt id="id-1.7.8.8.5.6.3"><span class="term"><code class="command">sudo systemctl reload apparmor</code>
    </span></dt><dd><p>
      Causes the <span class="phrase">AppArmor</span> module to re-scan the profiles in
      <code class="filename">/etc/apparmor.d</code> without unconfining running
      
      processes. Freshly created profiles are enforced and recently deleted
      ones are removed from the <code class="filename">/etc/apparmor.d</code>
      directory.
     </p></dd></dl></div></section><section class="sect1" id="sec-apparmor-commandline-build" data-id-title="Building AppArmor profiles"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.2 </span><span class="title-name">Building <span class="phrase">AppArmor</span> profiles</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-build">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <span class="phrase">AppArmor</span> module profile definitions are stored in the
   <code class="filename">/etc/apparmor.d</code> directory as plain text files. For a
   detailed description of the syntax of these files, refer to
   <a class="xref" href="cha-apparmor-profiles.html" title="Chapter 32. Profile components and syntax">Chapter 32, <em>Profile components and syntax</em></a>.
  </p><p>
   All files in the <code class="filename">/etc/apparmor.d</code> directory are
   interpreted as profiles and are loaded as such. Renaming files in that
   directory is not an effective way of preventing profiles from being
   loaded. You must remove profiles from this directory to prevent them from
   being read and evaluated effectively, or call
   <code class="command">aa-disable</code> on the profile, which creates a
   symbolic link in <code class="filename">/etc/apparmor.d/disabled/</code>.
  </p><p>
   You can use a text editor, such as <code class="command">vi</code>, to access and
   make changes to these profiles. The following sections contain detailed
   steps for building profiles:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.6.5.1"><span class="term">Adding or creating <span class="phrase">AppArmor</span> profiles</span></dt><dd><p>
      Refer to <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-add" title="35.3. Adding or creating an AppArmor profile">Section 35.3, “Adding or creating an <span class="phrase">AppArmor</span> profile”</a>
     </p></dd><dt id="id-1.7.8.8.6.5.2"><span class="term">Editing <span class="phrase">AppArmor</span> profiles</span></dt><dd><p>
      Refer to <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-edit" title="35.4. Editing an AppArmor profile">Section 35.4, “Editing an <span class="phrase">AppArmor</span> profile”</a>
     </p></dd><dt id="id-1.7.8.8.6.5.3"><span class="term">Deleting <span class="phrase">AppArmor</span> profiles</span></dt><dd><p>
      Refer to
      <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-del" title="35.6. Deleting an AppArmor profile">Section 35.6, “Deleting an <span class="phrase">AppArmor</span> profile”</a>
     </p></dd></dl></div></section><section class="sect1" id="sec-apparmor-commandline-add" data-id-title="Adding or creating an AppArmor profile"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.3 </span><span class="title-name">Adding or creating an <span class="phrase">AppArmor</span> profile</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-add">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To add or create an <span class="phrase">AppArmor</span> profile for an application, you can use a
   systemic or stand-alone profiling method, depending on your needs. Learn
   more about these two approaches in
   <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling" title="35.7. Two methods of profiling">Section 35.7, “Two methods of profiling”</a>.
  </p></section><section class="sect1" id="sec-apparmor-commandline-edit" data-id-title="Editing an AppArmor profile"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.4 </span><span class="title-name">Editing an <span class="phrase">AppArmor</span> profile</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-edit">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following steps describe the procedure for editing an <span class="phrase">AppArmor</span>
   profile:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     If you are not currently logged in as <code class="systemitem">root</code>, enter
     <code class="command">su</code> in a terminal window.
    </p></li><li class="step"><p>
     Enter the <code class="systemitem">root</code> password when prompted.
    </p></li><li class="step"><p>
     Go to the profile directory with <code class="command">cd
     /etc/apparmor.d/</code>.
    </p></li><li class="step"><p>
     Enter <code class="command">ls</code> to view all profiles currently installed.
    </p></li><li class="step"><p>
     Open the profile to edit in a text editor, such as vim.
    </p></li><li class="step"><p>
     Make the necessary changes, then save the profile.
    </p></li><li class="step"><p>
     Restart <span class="phrase">AppArmor</span> by entering <code class="command">systemctl reload
     apparmor</code> in a terminal window.
    </p></li></ol></div></div></section><section class="sect1" id="sec-apparmor-commandline-unload" data-id-title="Unloading unknown AppArmor profiles"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.5 </span><span class="title-name">Unloading unknown <span class="phrase">AppArmor</span> profiles</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-unload">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.8.8.9.2" data-id-title="Danger of unloading wanted profiles" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Danger of unloading wanted profiles</div><p>
    <code class="command">aa-remove-unknown</code> unloads all profiles that
    are not stored in <code class="filename">/etc/apparmor.d</code>, for example
    automatically generated LXD profiles. This may compromise the
    security of the system. Use the <code class="option">-n</code> parameter to
    list all profiles that are unloaded.
   </p></div><p>
   To unload all <span class="phrase">AppArmor</span> profiles that are no longer in
   <code class="filename">/etc/apparmor.d/</code>, run:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aa-remove-unknown</code></pre></div><p>
   You can print a list of profiles that are removed:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aa-remove-unknown -n</code></pre></div></section><section class="sect1" id="sec-apparmor-commandline-del" data-id-title="Deleting an AppArmor profile"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.6 </span><span class="title-name">Deleting an <span class="phrase">AppArmor</span> profile</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-del">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following steps describe the procedure for deleting an <span class="phrase">AppArmor</span>
   profile.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Remove the <span class="phrase">AppArmor</span> definition from the kernel:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">apparmor_parser -R /etc/apparmor.d/<em class="replaceable">PROFILE</em></code></pre></div></li><li class="step"><p>
     Remove the definition file:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">rm /etc/apparmor.d/<em class="replaceable">PROFILE</em></code>
    <code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">rm /var/lib/apparmor/cache/<em class="replaceable">PROFILE</em></code></pre></div></li></ol></div></div></section><section class="sect1" id="sec-apparmor-commandline-profiling" data-id-title="Two methods of profiling"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.7 </span><span class="title-name">Two methods of profiling</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Given the syntax for <span class="phrase">AppArmor</span> profiles in
   <a class="xref" href="cha-apparmor-profiles.html" title="Chapter 32. Profile components and syntax">Chapter 32, <em>Profile components and syntax</em></a>, you
   could create profiles without using the tools. However, the effort
   involved would be substantial. To avoid such a situation, use the <span class="phrase">AppArmor</span>
   tools to automate the creation and refinement of profiles.
  </p><p>
   There are two ways to approach <span class="phrase">AppArmor</span> profile creation. Tools are
   available for both methods.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.4.1"><span class="term">Stand-alone profiling</span></dt><dd><p>
      A method suitable for profiling small applications that have a finite
      runtime, such as user client applications like mail clients. For more
      information, refer to
      <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-stand-alone" title="35.7.1. Stand-alone profiling">Section 35.7.1, “Stand-alone profiling”</a>.
     </p></dd><dt id="id-1.7.8.8.11.4.2"><span class="term">Systemic profiling</span></dt><dd><p>
      A method suitable for profiling many programs at once
      and for profiling applications that may run for days, weeks or
      continuously across reboots, such as network server applications like
      Web servers and mail servers. For more information, refer to
      <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-systemic" title="35.7.2. Systemic profiling">Section 35.7.2, “Systemic profiling”</a>.
     </p></dd></dl></div><p>
   Automated profile development becomes more manageable with the <span class="phrase">AppArmor</span>
   tools:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Decide which profiling method suits your needs.
    </p></li><li class="step"><p>
     Perform a static analysis. Run either <code class="command">aa-genprof</code> or
     <code class="command">aa-autodep</code>, depending on the profiling method
     chosen.
    </p></li><li class="step"><p>
     Enable dynamic learning. Activate learning mode for all profiled
     programs.
    </p></li></ol></div></div><section class="sect2" id="sec-apparmor-commandline-profiling-stand-alone" data-id-title="Stand-alone profiling"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.7.1 </span><span class="title-name">Stand-alone profiling</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-stand-alone">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Stand-alone profile generation and improvement is managed by a program
    called <code class="command">aa-genprof</code>. This method is easy because
    <code class="command">aa-genprof</code> takes care of everything, but is limited
    because it requires <code class="command">aa-genprof</code> to run for the entire
    duration of the test run of your program (you cannot reboot the machine
    while you are still developing your profile).
   </p><p>
    To use <code class="command">aa-genprof</code> for the stand-alone method of
    profiling, refer to
    <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-genprof" title="35.7.3.8. aa-genprof—generating profiles">Section 35.7.3.8, “aa-genprof—generating profiles”</a>.
   </p></section><section class="sect2" id="sec-apparmor-commandline-profiling-systemic" data-id-title="Systemic profiling"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.7.2 </span><span class="title-name">Systemic profiling</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-systemic">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This method is called <span class="emphasis"><em>systemic profiling</em></span> because it
    updates all the profiles on the system at once, rather than focusing
    on the one or few targeted by <code class="command">aa-genprof</code> or
    stand-alone profiling. With systemic profiling, profile construction and
    improvement are less automated, but more flexible. This method
    is suitable for profiling long-running applications whose behavior
    continues after rebooting, or many programs at once.
   </p><p>
    Build an <span class="phrase">AppArmor</span> profile for a group of applications as follows:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Create profiles for the individual programs that make up your
      application.
     </p><p>
      Although this approach is systemic, <span class="phrase">AppArmor</span> only monitors those
      programs with profiles and their children. To get <span class="phrase">AppArmor</span> to consider
      a program, you must at least have <code class="command">aa-autodep</code> create
      an approximate profile for it. To create this approximate profile,
      refer to
      <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-autodep" title="35.7.3.1. aa-autodep—creating approximate profiles">Section 35.7.3.1, “aa-autodep—creating approximate profiles”</a>.
     </p></li><li class="step"><p>
      Put relevant profiles into learning or complain mode.
     </p><p>
      Activate learning or complain mode for all profiled programs by
      entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-complain /etc/apparmor.d/*</pre></div><p>
      in a terminal window while logged in as <code class="systemitem">root</code>. This
      functionality is also available through the YaST Profile Mode
      module, described in
      <a class="xref" href="cha-apparmor-yast.html#sec-apparmor-yast-manage-profmodes" title="34.4.2. Changing the mode of individual profiles">Section 34.4.2, “Changing the mode of individual profiles”</a>.
     </p><p>
      When in learning mode, access requests are not blocked, even if the
      profile dictates that they should be. This enables you to run through
      several tests (as shown in
      <a class="xref" href="cha-apparmor-commandline.html#st-apparmor-commandline-profiling-systemic-exec" title="Step 3">Step 3</a>) and
      learn the access needs of the program so it runs properly. With this
      information, you can decide how secure to make the profile.
     </p><p>
      Refer to
      <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-complain" title="35.7.3.2. aa-complain—entering complain or learning mode">Section 35.7.3.2, “aa-complain—entering complain or learning mode”</a>
      for more detailed instructions for using learning or complain mode.
     </p></li><li class="step" id="st-apparmor-commandline-profiling-systemic-exec"><p>
      Exercise your application.
     </p><p>
      Run your application and exercise its functionality. How much to
      exercise the program is up to you, but you need the program to access
      each file representing its access needs. Because the execution is not
      being supervised by <code class="command">aa-genprof</code>, this step can go on
      for days or weeks and can span complete system reboots.
     </p></li><li class="step" id="st-apparmor-commandline-profiling-systemic-log"><p>
      Analyze the log.
     </p><p>
      In systemic profiling, run <code class="command">aa-logprof</code> directly
      instead of letting <code class="command">aa-genprof</code> run it (as in
      stand-alone profiling). The general form of
      <code class="command">aa-logprof</code> is:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-logprof [ -d <em class="replaceable">/path/to/profiles</em> ] [ -f <em class="replaceable">/path/to/logfile</em> ]</pre></div><p>
      Refer to
      <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-logprof" title="35.7.3.9. aa-logprof—scanning the system log">Section 35.7.3.9, “aa-logprof—scanning the system log”</a>
      for more information about using <code class="command">aa-logprof</code>.
     </p></li><li class="step"><p>
      Repeat
      <a class="xref" href="cha-apparmor-commandline.html#st-apparmor-commandline-profiling-systemic-exec" title="Step 3">Step 3</a> and
      <a class="xref" href="cha-apparmor-commandline.html#st-apparmor-commandline-profiling-systemic-log" title="Step 4">Step 4</a>.
     </p><p>
      This generates optimal profiles. An iterative approach captures
      smaller data sets that can be trained and reloaded into the policy
      engine. Subsequent iterations generate fewer messages and run faster.
     </p></li><li class="step"><p>
      Edit the profiles.
     </p><p>
      You should review the profiles that have been generated. You
      can open and edit the profiles in
      <code class="filename">/etc/apparmor.d/</code> using a text editor.
     </p></li><li class="step"><p>
      Return to enforce mode.
     </p><p>
      This is when the system goes back to enforcing the rules of the
      profiles, not only logging information. This can be done manually by
      removing the <code class="literal">flags=(complain)</code> text from the

      profiles or automatically by using the <code class="command">aa-enforce</code>
      command, which works identically to the <code class="command">aa-complain</code>
      command, except it sets the profiles to enforce mode. This
      functionality is also available through the YaST Profile Mode
      module, described in
      <a class="xref" href="cha-apparmor-yast.html#sec-apparmor-yast-manage-profmodes" title="34.4.2. Changing the mode of individual profiles">Section 34.4.2, “Changing the mode of individual profiles”</a>.
     </p><p>
      To ensure that all profiles are taken out of complain mode and put
      into enforce mode, enter <code class="command">aa-enforce
      /etc/apparmor.d/*</code>.
     </p></li><li class="step"><p>
      Re-scan all profiles.
     </p><p>
      To have <span class="phrase">AppArmor</span> re-scan all the profiles and change the enforcement
      mode in the kernel, enter <code class="command">systemctl reload
      apparmor</code>.
     </p></li></ol></div></div></section><section class="sect2" id="sec-apparmor-commandline-profiling-summary" data-id-title="Summary of profiling tools"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.7.3 </span><span class="title-name">Summary of profiling tools</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    All of the <span class="phrase">AppArmor</span> profiling utilities are provided by the
    <code class="systemitem">apparmor-utils</code> RPM package and are stored in
    <code class="filename">/usr/sbin</code>. Each tool has a different purpose.
   </p><section class="sect3" id="sec-apparmor-commandline-profiling-summary-autodep" data-id-title="aa-autodep—creating approximate profiles"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.1 </span><span class="title-name">aa-autodep—creating approximate profiles</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-autodep">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This creates an approximate profile for the program or application
     selected. You can generate approximate profiles for binary executables
     and interpreted script programs. The resulting profile is called
     <span class="quote">“<span class="quote">approximate</span>”</span> because it does not necessarily contain all
     of the profile entries that the program needs to be properly confined
     by <span class="phrase">AppArmor</span>. The minimum <code class="command">aa-autodep</code> approximate
     profile has, at minimum, a base include directive, which contains basic
     profile entries needed by most programs. For certain types of programs,
     <code class="command">aa-autodep</code> generates a more expanded profile. The
     profile is generated by recursively calling <code class="command">ldd(1)</code>
     on the executables listed on the command line.
    </p><p>
     To generate an approximate profile, use the
     <code class="command">aa-autodep</code> program. The program argument can be
     either the simple name of the program, which
     <code class="command">aa-autodep</code> finds by searching your shell's path
     variable, or it can be a fully qualified path. The program itself can
     be of any type (ELF binary, shell script, Perl script, etc.).
     <code class="command">aa-autodep</code> generates an approximate profile to
     improve through the dynamic profiling that follows.
    </p><p>
     The resulting approximate profile is written to the
     <code class="filename">/etc/apparmor.d</code> directory using the <span class="phrase">AppArmor</span>
     profile naming convention of naming the profile after the absolute path
     of the program, replacing the forward slash (<code class="literal">/</code>)
     characters in the path with period (<code class="literal">.</code>) characters.
     The general syntax of <code class="command">aa-autodep</code> is to enter the
     following in a terminal window:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-autodep [ -d <em class="replaceable">/PATH/TO/PROFILES</em> ] [<em class="replaceable">PROGRAM1</em> <em class="replaceable">PROGRAM2</em>...]</pre></div><p>
     If you do not enter the program name or names, you are prompted for
     them. <em class="replaceable">/path/to/profiles</em> overrides the
     default location of <code class="filename">/etc/apparmor.d</code>, should you
     keep profiles in a location other than the default.
    </p><p>
     To begin profiling, you must create profiles for each main executable
     service that is part of your application (anything that might start
     without being a child of another program that already has a profile).
     Finding all such programs depends on the application in question. Here
     are several strategies for finding such programs:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.3.8.1"><span class="term">Directories</span></dt><dd><p>
        If all the programs to profile are in one directory and there are no
        other programs in that directory, the simple command
        <code class="command">aa-autodep</code>
        <em class="replaceable">/path/to/your/programs/*</em> creates basic
        profiles for all programs in that directory.
       </p></dd><dt id="id-1.7.8.8.11.9.3.8.2"><span class="term">pstree -p</span></dt><dd><p>
        You can run your application and use the standard Linux
        <code class="command">pstree</code> command to find all processes running.
        Then manually hunt down the location of these programs and run the
        <code class="command">aa-autodep</code> for each one. If the programs are in
        your path, <code class="command">aa-autodep</code> finds them for you. If they
        are not in your path, the standard Linux command
        <code class="command">find</code> might be helpful in finding your programs.
        Execute <code class="command">find / -name '</code>
        <em class="replaceable">MY_APPLICATION</em>' -print to determine an
        application's path (<em class="replaceable">MY_APPLICATION</em> being
        an example application). You may use wild cards if appropriate.
       </p></dd></dl></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-complain" data-id-title="aa-complain—entering complain or learning mode"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.2 </span><span class="title-name">aa-complain—entering complain or learning mode</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-complain">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The complain or learning mode tool (<code class="command">aa-complain</code>)
     detects violations of <span class="phrase">AppArmor</span> profile rules, such as the profiled
     program accessing files not permitted by the profile. The violations
     are permitted, but also logged. To improve the profile, turn complain
     mode on, run the program through a suite of tests to generate log
     events that characterize the program's access needs, then postprocess
     the log with the <span class="phrase">AppArmor</span> tools to transform log events into improved
     profiles.
    </p><p>
     Manually activating complain mode (using the command line) adds a flag
     to the top of the profile so that <code class="literal">/bin/foo</code> becomes
     <code class="literal">/bin/foo flags=(complain)</code>. To use complain mode,

     open a terminal window and enter one of the following lines as
     <code class="systemitem">root</code>:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       If the example program (<em class="replaceable">PROGRAM1</em>) is in
       your path, use:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-complain [<em class="replaceable">PROGRAM1</em> <em class="replaceable">PROGRAM2</em> ...]</pre></div></li><li class="listitem"><p>
       If the program is not in your path, specify the entire path as
       follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-complain /sbin/<em class="replaceable">PROGRAM1</em></pre></div></li><li class="listitem"><p>
       If the profiles are not in <code class="filename">/etc/apparmor.d</code>, use
       the following to override the default location:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-complain <em class="replaceable">/path/to/profiles/</em><em class="replaceable">PROGRAM1</em></pre></div></li><li class="listitem"><p>
       Specify the profile for <em class="replaceable">/sbin/program1</em> as
       follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-complain /etc/apparmor.d/sbin.<em class="replaceable">PROGRAM1</em></pre></div></li></ul></div><p>
     Each of the above commands activates the complain mode for the profiles
     or programs listed. If the program name does not include its entire
     path, <code class="command">aa-complain</code> searches <code class="envar">$PATH</code> for
     the program. For example, <code class="command">aa-complain /usr/sbin/*</code>
     finds profiles associated with all the programs in
     <code class="filename">/usr/sbin</code> and puts them into complain mode.
     <code class="command">aa-complain /etc/apparmor.d/*</code> puts all the
     profiles in <code class="filename">/etc/apparmor.d</code> into complain mode.
    </p><div id="id-1.7.8.8.11.9.4.6" data-id-title="Toggling profile mode with YaST" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Toggling profile mode with YaST</div><p>
      YaST offers a graphical front-end for toggling complain and
      enforce mode. See <a class="xref" href="cha-apparmor-yast.html#sec-apparmor-yast-manage-profmodes" title="34.4.2. Changing the mode of individual profiles">Section 34.4.2, “Changing the mode of individual profiles”</a>
      for information.
     </p></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-decode" data-id-title="aa-decode—decoding hex-encoded strings in AppArmor log files"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.3 </span><span class="title-name">aa-decode—decoding hex-encoded strings in <span class="phrase">AppArmor</span> log files</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-decode">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">aa-decode</code> decodes hex-encoded strings in the
     <span class="phrase">AppArmor</span> log output. It can also process the audit log on standard
     input, convert any hex-encoded <span class="phrase">AppArmor</span> log entries, and display them on
     standard output.
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-disable" data-id-title="aa-disable—disabling an AppArmor security profile"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.4 </span><span class="title-name">aa-disable—disabling an <span class="phrase">AppArmor</span> security profile</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-disable">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use <code class="command">aa-disable</code> to disable the enforcement mode for
     one or more <span class="phrase">AppArmor</span> profiles. This command unloads the profile from
     the kernel and prevents the profile from being loaded on <span class="phrase">AppArmor</span>
     start-up. Use <code class="command">aa-enforce</code> or
     <code class="command">aa-complain</code> utilities to change this behavior.
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-easyprof" data-id-title="aa-easyprof—easy profile generation"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.5 </span><span class="title-name">aa-easyprof—easy profile generation</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-easyprof">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">aa-easyprof</code> provides an easy-to-use interface for
     <span class="phrase">AppArmor</span> profile generation. <code class="command">aa-easyprof</code> supports the
     use of templates and profile groups to quickly profile an application.
     While <code class="command">aa-easyprof</code> can help with profile generation,
     its utility is dependent on the quality of the templates, profile
     groups and abstractions used. Also, this tool may create a profile that
     is less restricted than when creating a profile manually or with
     <code class="command">aa-genprof</code> and <code class="command">aa-logprof</code>.
    </p><p>
     For more information, see the man page of
     <code class="command">aa-easyprof</code> (8).
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-enforce" data-id-title="aa-enforce—entering enforce mode"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.6 </span><span class="title-name">aa-enforce—entering enforce mode</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-enforce">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The enforce mode detects violations of <span class="phrase">AppArmor</span> profile rules, such as
     the profiled program accessing files not permitted by the profile. The
     violations are logged and not permitted. The default is for enforce
     mode to be enabled. To log the violations only, but still permit them,
     use complain mode.
    </p><p>
     Manually activating enforce mode (using the command line) removes the
     complain flag from the top of the profile so that <code class="literal">/bin/foo
     flags=(complain)</code> becomes <code class="literal">/bin/foo</code>. To use
     enforce mode, open a terminal window and enter one of the following
     lines.
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       If the example program (<em class="replaceable">PROGRAM1</em>) is in
       your path, use:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-enforce [<em class="replaceable">PROGRAM1</em> <em class="replaceable">PROGRAM2</em> ...]</pre></div></li><li class="listitem"><p>
       If the program is not in your path, specify the entire path, as
       follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-enforce /sbin/<em class="replaceable">PROGRAM1</em></pre></div></li><li class="listitem"><p>
       If the profiles are not in
       <em class="replaceable">/etc/apparmor.d</em>, use the following to
       override the default location:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-enforce -d <em class="replaceable">/path/to/profiles/     program1</em></pre></div></li><li class="listitem"><p>
       Specify the profile for <em class="replaceable">/sbin/program1</em> as
       follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-enforce /etc/apparmor.d/sbin.<em class="replaceable">PROGRAM1</em></pre></div></li></ul></div><p>
     Each of the above commands activates the enforce mode for the profiles
     and programs listed.
    </p><p>
     If you do not enter the program or profile names, you are prompted to
     enter one. <em class="replaceable">/path/to/profiles</em> overrides the
     default location of <code class="filename">/etc/apparmor.d</code>.
    </p><p>
     The argument can be either a list of programs or a list of profiles. If
     the program name does not include its entire path,
     <code class="command">aa-enforce</code> searches <code class="envar">$PATH</code> for the
     program.
    </p><div id="id-1.7.8.8.11.9.8.8" data-id-title="Toggling profile mode with YaST" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Toggling profile mode with YaST</div><p>
      YaST offers a graphical front-end for toggling complain and
      enforce mode. See <a class="xref" href="cha-apparmor-yast.html#sec-apparmor-yast-manage-profmodes" title="34.4.2. Changing the mode of individual profiles">Section 34.4.2, “Changing the mode of individual profiles”</a>
      for information.
     </p></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-exec" data-id-title="aa-exec—confining a program with the specified profile"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.7 </span><span class="title-name">aa-exec—confining a program with the specified profile</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-exec">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use <code class="command">aa-exec</code> to launch a program confined by a
     specified profile and/or profile namespace. If both a profile and
     namespace are specified, the program is confined by the profile in
     the new namespace. If only a profile namespace is specified, the
     profile name of the current confinement is used. If neither a
     profile nor namespace is specified, the command runs using the
     standard profile attachment—as if you did not use the
     <code class="command">aa-exec</code> command.
    </p><p>
     For more information on the command's options, see its manual page
     <code class="command">man 8 aa-exec</code>.
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-genprof" data-id-title="aa-genprof—generating profiles"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.8 </span><span class="title-name">aa-genprof—generating profiles</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-genprof">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">aa-genprof</code> is <span class="phrase">AppArmor</span>'s profile generating utility.
     It runs <code class="command">aa-autodep</code> on the specified program,
     creating an approximate profile (if a profile does not already exist
     for it), sets it to complain mode, reloads it into <span class="phrase">AppArmor</span>, marks the
     log, and prompts the user to execute the program and exercise its
     functionality. Its syntax is as follows:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-genprof [ -d <em class="replaceable">/path/to/profiles</em> ]  <em class="replaceable">PROGRAM</em></pre></div><p>
     To create a profile for the Apache Web server program httpd2-prefork,
     do the following as <code class="systemitem">root</code>:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Enter <code class="command">systemctl stop apache2</code>.
      </p></li><li class="step"><p>
       Next, enter <code class="command">aa-genprof httpd2-prefork</code>.
      </p><p>
       Now <code class="command">aa-genprof</code> does the following:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
         Resolves the full path of httpd2-prefork using your shell's path
         variables. You can also specify a full path. On <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>,
         the default full path is
         <span class="phrase"><code class="filename">/usr/sbin/httpd2-prefork</code></span>.
        </p></li><li class="listitem"><p>
         Checks to see if there is an existing profile for httpd2-prefork.
         If there is one, it updates it. If not, it creates one using the
         <code class="command">aa-autodep</code> as described in
         <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary" title="35.7.3. Summary of profiling tools">Section 35.7.3, “Summary of profiling tools”</a>.
        </p></li><li class="listitem"><p>
         Puts the profile for this program into learning or complain mode so
         that profile violations are logged, but are permitted to proceed. A
         log event looks like this (see
         <code class="filename">/var/log/audit/audit.log</code>):
        </p><div class="verbatim-wrap"><pre class="screen">type=APPARMOR_ALLOWED msg=audit(1189682639.184:20816): \
apparmor="DENIED" operation="file_mmap" parent=2692 \
profile="/usr/sbin/httpd2-prefork//HANDLING_UNTRUSTED_INPUT" \
name="/var/log/apache2/access_log-20140116" pid=28730 comm="httpd2-prefork" \
requested_mask="::r" denied_mask="::r" fsuid=30 ouid=0</pre></div><p>
         If you are not running the audit daemon, the <span class="phrase">AppArmor</span> events are
         logged directly to <code class="systemitem">systemd</code> journal (see
         <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: query the <code class="systemitem">systemd</code> journal”</span>):
        </p><div class="verbatim-wrap"><pre class="screen">Sep 13 13:20:30 K23 kernel: audit(1189682430.672:20810): \
apparmor="DENIED" operation="file_mmap" parent=2692 \
profile="/usr/sbin/httpd2-prefork//HANDLING_UNTRUSTED_INPUT" \
name="/var/log/apache2/access_log-20140116" pid=28730 comm="httpd2-prefork" \
requested_mask="::r" denied_mask="::r" fsuid=30 ouid=0</pre></div><p>
         They also can be viewed using the <code class="command">dmesg</code> command:
        </p><div class="verbatim-wrap"><pre class="screen">audit(1189682430.672:20810): apparmor="DENIED" \
operation="file_mmap" parent=2692 \
profile="/usr/sbin/httpd2-prefork//HANDLING_UNTRUSTED_INPUT" \
name="/var/log/apache2/access_log-20140116" pid=28730 comm="httpd2-prefork" \
requested_mask="::r" denied_mask="::r" fsuid=30 ouid=0</pre></div></li><li class="listitem"><p>
         Marks the log with a beginning marker of log events to consider.
         For example:
        </p><div class="verbatim-wrap"><pre class="screen">Sep 13 17:48:52 figwit root: GenProf: e2ff78636296f16d0b5301209a04430d</pre></div></li></ol></div></li><li class="step"><p>
       When prompted by the tool, run the application to profile in another
       terminal window and perform as many of the application functions as
       possible. Thus, the learning mode can log the files and directories
       to which the program requires access to function properly.
       For example, in a new terminal window, enter <code class="command">systemctl start
       apache2</code>.
      </p></li><li class="step"><p>
       Select from the following options that are available in the
       <code class="command">aa-genprof</code> terminal window after you have executed
       the program function:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         <span class="keycap">S</span> runs <code class="command">aa-genprof</code> on the system
         log from where it was marked when <code class="command">aa-genprof</code> was
         started and reloads the profile. If system events exist in the log,
         <span class="phrase">AppArmor</span> parses the learning mode log files. This generates a series
         of questions that you must answer to guide
         <code class="command">aa-genprof</code> in generating the security profile.
        </p></li><li class="listitem"><p>
         <span class="keycap">F</span> exits the tool.
        </p></li></ul></div><div id="id-1.7.8.8.11.9.10.5.4.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
        If requests to add hats appear, proceed to
        <a class="xref" href="cha-apparmor-hat.html" title="Chapter 36. Profiling your Web applications using ChangeHat">Chapter 36, <em>Profiling your Web applications using ChangeHat</em></a>.
       </p></div></li><li class="step"><p>
       Answer two types of questions:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         A resource is requested by a profiled program that is not in the
         profile (see
         <a class="xref" href="cha-apparmor-commandline.html#ex-apparmor-commandline-profiling-summary-genprof-learn" title="Learning mode exception: controlling access to specific resources">Example 35.1, “Learning mode exception: controlling access to specific resources”</a>).
        </p></li><li class="listitem"><p>
         A program is executed by the profiled program and the security
         domain transition has not been defined (see
         <a class="xref" href="cha-apparmor-commandline.html#ex-apparmor-commandline-profiling-summary-genprof-perms" title="Learning mode exception: defining permissions for an entry">Example 35.2, “Learning mode exception: defining permissions for an entry”</a>).
        </p></li></ul></div><p>
       Each of these categories results in a series of questions that you
       must answer to add the resource or program to the profile.
       <a class="xref" href="cha-apparmor-commandline.html#ex-apparmor-commandline-profiling-summary-genprof-learn" title="Learning mode exception: controlling access to specific resources">Example 35.1, “Learning mode exception: controlling access to specific resources”</a>
       and
       <a class="xref" href="cha-apparmor-commandline.html#ex-apparmor-commandline-profiling-summary-genprof-perms" title="Learning mode exception: defining permissions for an entry">Example 35.2, “Learning mode exception: defining permissions for an entry”</a>
       provide examples of each one. Subsequent steps describe your options
       in answering these questions.
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Dealing with execute accesses is complex. You must decide how to
         proceed with this entry regarding which execute permission type to
         grant to this entry:
        </p><div class="example" id="ex-apparmor-commandline-profiling-summary-genprof-learn" data-id-title="Learning mode exception: controlling access to specific resources"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.1: </span><span class="title-name">Learning mode exception: controlling access to specific resources </span></span><a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#ex-apparmor-commandline-profiling-summary-genprof-learn">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">Reading log entries from /var/log/audit/audit.log.
Updating AppArmor profiles in /etc/apparmor.d.

Profile:  /usr/sbin/cupsd
Program:  cupsd
Execute:  /usr/lib/cups/daemon/cups-lpd
Severity: unknown

(I)nherit / (P)rofile / (C)hild / (N)ame / (U)nconfined / (X)ix / (D)eny / Abo(r)t / (F)inish</pre></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.1"><span class="term">Inherit (ix)</span></dt><dd><p>
            The child inherits the parent's profile, running with the same
            access controls as the parent. This mode is useful when a
            confined program needs to call another confined program without
            gaining the permissions of the target's profile or losing the
            permissions of the current profile. This mode is often used when
            the child program is a <span class="emphasis"><em>helper application</em></span>,
            such as the <code class="command">/usr/bin/mail</code> client using
            <code class="command">less</code> as a pager.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.2"><span class="term">Profile (px/px)</span></dt><dd><p>
            The child runs using its own profile, which must be loaded into
            the kernel. If the profile is not present, attempts to execute
            the child fail with permission denied. This is most useful if
            the parent program is invoking a global service, such as DNS
            lookups or sending mail with your system's MTA.
           </p><p>
            Choose the <span class="guimenu">profile with clean exec</span> (Px)
            option to scrub the environment of environment variables that
            could modify execution behavior when passed to the child
            process.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.3"><span class="term">Child (cx/cx)</span></dt><dd><p>
            Sets up a transition to a subprofile. It is like px/Px
            transition, except to a child profile.
           </p><p>
            Choose the <span class="guimenu">profile with clean exec</span> (Cx)
            option to scrub the environment of environment variables that
            could modify execution behavior when passed to the child
            process.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.4"><span class="term">Unconfined (ux/ux)</span></dt><dd><p>
            The child runs unconfined without any <span class="phrase">AppArmor</span> profile
            applied to the executed resource.
           </p><p>
            Choose the <span class="guimenu">unconfined with clean exec</span> (Ux)
            option to scrub the environment of environment variables that
            could modify execution behavior when passed to the child
            process. Note that running unconfined profiles introduces a
            security vulnerability that could be used to evade <span class="phrase">AppArmor</span>. Only
            use it as a last resort.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.5"><span class="term">mmap (m)</span></dt><dd><p>
            This permission denotes that the program running under the
            profile can access the resource using the mmap system call with
            the flag <code class="envar">PROT_EXEC</code>. This means that the data
            mapped in it can be executed. You are prompted to include this
            permission if it is requested during a profiling run.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.6"><span class="term">Deny</span></dt><dd><p>
            Adds a <code class="literal">deny</code> rule to the profile, and
            permanently prevents the program from accessing the specified
            directory path entries. <span class="phrase">AppArmor</span> then continues to the next
            event.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.7"><span class="term">Abort</span></dt><dd><p>
            Aborts <code class="command">aa-logprof</code>, losing all rule changes
            entered so far and leaving all profiles unmodified.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.8"><span class="term">Finish</span></dt><dd><p>
            Closes <code class="command">aa-logprof</code>, saving all rule changes
            entered so far and modifying all profiles.
           </p></dd></dl></div></li><li class="listitem"><p>
         <a class="xref" href="cha-apparmor-commandline.html#ex-apparmor-commandline-profiling-summary-genprof-perms" title="Learning mode exception: defining permissions for an entry">Example 35.2, “Learning mode exception: defining permissions for an entry”</a>
         shows <span class="phrase">AppArmor</span> suggest allowing a globbing pattern
         <code class="filename">/var/run/nscd/*</code> for reading, then using an
         abstraction to cover common Apache-related access rules.
        </p><div class="example" id="ex-apparmor-commandline-profiling-summary-genprof-perms" data-id-title="Learning mode exception: defining permissions for an entry"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.2: </span><span class="title-name">Learning mode exception: defining permissions for an entry </span></span><a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#ex-apparmor-commandline-profiling-summary-genprof-perms">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">Profile:  /usr/sbin/httpd2-prefork
Path:     /var/run/nscd/dbSz9CTr
Mode:     r
Severity: 3

  1 - /var/run/nscd/dbSz9CTr
 [2 - /var/run/nscd/*]

(A)llow / [(D)eny] / (G)lob / Glob w/(E)xt / (N)ew / Abo(r)t / (F)inish / (O)pts
Adding /var/run/nscd/* r to profile.

Profile:  /usr/sbin/httpd2-prefork
Path:     /proc/11769/attr/current
Mode:     w
Severity: 9

 [1 - #include &lt;abstractions/apache2-common&gt;]
  2 - /proc/11769/attr/current
  3 - /proc/*/attr/current

(A)llow / [(D)eny] / (G)lob / Glob w/(E)xt / (N)ew / Abo(r)t / (F)inish / (O)pts
Adding #include &lt;abstractions/apache2-common&gt; to profile.</pre></div></div></div><p>
         <span class="phrase">AppArmor</span> provides one or more paths or includes. By entering the
         option number, select the desired options then proceed to the next
         step.
        </p><div id="id-1.7.8.8.11.9.10.5.5.4.2.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
          Not all these options are always presented in the <span class="phrase">AppArmor</span> menu.
         </p></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.10.5.5.4.2.5.1"><span class="term"><code class="literal">#include</code>
          </span></dt><dd><p>
            This is the section of an <span class="phrase">AppArmor</span> profile that refers to an
            include file, which procures access permissions for programs. By
            using an include, you can give the program access to directory
            paths or files that are also required by other programs. Using
            includes can reduce the size of a profile. It is good practice
            to select includes when suggested.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.5.2"><span class="term">Globbed version</span></dt><dd><p>
            This is accessed by selecting <span class="guimenu">Glob</span> as
            described in the next step. For information about globbing
            syntax, refer to <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-glob" title="32.6. Profile names, flags, paths, and globbing">Section 32.6, “Profile names, flags, paths, and globbing”</a>.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.5.3"><span class="term">Actual path</span></dt><dd><p>
            This is the literal path to which the program needs access so
            that it can run properly.
           </p></dd></dl></div><p>
         After you select the path or include, process it as an entry into
         the <span class="phrase">AppArmor</span> profile by selecting <span class="guimenu">Allow</span> or
         <span class="guimenu">Deny</span>. If you are not satisfied with the
         directory path entry as it is displayed, you can also
         <span class="guimenu">Glob</span> it.
        </p><p>
         The following options are available to process the learning mode
         entries and build the profile:
        </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.1"><span class="term">Select <span class="keycap">Enter</span>
          </span></dt><dd><p>
            Allows access to the selected directory path.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.2"><span class="term">Allow</span></dt><dd><p>
            Allows access to the specified directory path entries. <span class="phrase">AppArmor</span>
            suggests file permission access. For more information, refer to
            <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm" title="32.7. File permission access modes">Section 32.7, “File permission access modes”</a>.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.3"><span class="term">Deny</span></dt><dd><p>
            Prevents the program from accessing the specified directory path
            entries. <span class="phrase">AppArmor</span> then continues to the next event.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.4"><span class="term">New</span></dt><dd><p>
            Prompts you to enter your own rule for this event, allowing you
            to specify a regular expression. If the expression does not
            actually satisfy the event that prompted the question in the
            first place, <span class="phrase">AppArmor</span> asks for confirmation and lets you reenter
            the expression.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.5"><span class="term">Glob</span></dt><dd><p>
            Select a specific path or create a general rule using wild cards
            that match a broader set of paths. To select any of the offered
            paths, enter the number that is printed in front of the path
            then decide how to proceed with the selected item.
           </p><p>
            For more information about globbing syntax, refer to
            <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-glob" title="32.6. Profile names, flags, paths, and globbing">Section 32.6, “Profile names, flags, paths, and globbing”</a>.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.6"><span class="term">Glob w/ext</span></dt><dd><p>
            This modifies the original directory path while retaining the
            file name extension. For example,
            <code class="filename">/etc/apache2/file.ext</code> becomes
            <code class="filename">/etc/apache2/*.ext</code>, adding the wild card
            (asterisk) in place of the file name. This allows the program to
            access all files in the suggested directory that end with the
            <code class="literal">.ext</code> extension.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.7"><span class="term">Abort</span></dt><dd><p>
            Aborts <code class="command">aa-logprof</code>, losing all rule changes
            entered so far and leaving all profiles unmodified.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.8"><span class="term">Finish</span></dt><dd><p>
            Closes <code class="command">aa-logprof</code>, saving all rule changes
            entered so far and modifying all profiles.
           </p></dd></dl></div></li></ul></div></li><li class="step"><p>
       To view and edit your profile using <code class="command">vi</code>, enter
       <code class="command">vi /etc/apparmor.d/</code>
       <em class="replaceable">PROFILENAME</em> in a terminal window. To
       enable syntax highlighting when editing an <span class="phrase">AppArmor</span> profile in vim,
       use the commands <code class="command">:syntax on</code> then <code class="command">:set
       syntax=apparmor</code>. For more information about vim and syntax
       highlighting, refer to
       <a class="xref" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-vim" title="35.7.3.14. apparmor.vim">Section 35.7.3.14, “apparmor.vim”</a>.
      </p></li><li class="step"><p>
       Restart <span class="phrase">AppArmor</span> and reload the profile set including the newly
       created one using the <code class="command">systemctl reload
       apparmor</code> command.
      </p></li></ol></div></div><p>
     Like the graphical front-end for building <span class="phrase">AppArmor</span> profiles, the
     YaST Add Profile Wizard, <code class="command">aa-genprof</code> also
     supports the use of the local profile repository under
     <code class="filename">/usr/share/apparmor/extra-profiles</code>.
    </p><p>
     To use a profile from the local repository, proceed as follows:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Start <code class="command">aa-genprof</code> as described above.
      </p><p>
       If <code class="command">aa-genprof</code> finds an inactive local profile, the
       following lines appear on your terminal window:
      </p><div class="verbatim-wrap"><pre class="screen">Profile: /usr/bin/opera

 [1 - Inactive local profile for /usr/bin/opera]

[(V)iew Profile] / (U)se Profile / (C)reate New Profile / Abo(r)t / (F)inish</pre></div></li><li class="step"><p>
       To use this profile, press <span class="keycap">U</span>
       (<span class="guimenu">Use Profile</span>) and follow the profile generation
       procedure outlined above.
      </p><p>
       To examine the profile before activating it, press
       <span class="keycap">V</span> (<span class="guimenu">View Profile</span>).
      </p><p>
       To ignore the existing profile, press <span class="keycap">C</span>
       (<span class="guimenu">Create New Profile</span>) and follow the profile
       generation procedure outlined above to create the profile from
       scratch.
      </p></li><li class="step"><p>
       Leave <code class="command">aa-genprof</code> by pressing <span class="keycap">F</span>
       (<span class="guimenu">Finish</span>) when you are done and save your changes.
      </p></li></ol></div></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-logprof" data-id-title="aa-logprof—scanning the system log"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.9 </span><span class="title-name">aa-logprof—scanning the system log</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-logprof">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">aa-logprof</code> is an interactive tool used to review the
     complain and enforce mode events found in the log entries in
     <code class="filename">/var/log/audit/audit.log</code>, or directly in the
     <code class="systemitem">systemd</code> journal (see <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: query the <code class="systemitem">systemd</code> journal”</span>), and
     generate new entries in <span class="phrase">AppArmor</span> security profiles.
    </p><p>
     When you run <code class="command">aa-logprof</code>, it begins to scan the log
     files produced in complain and enforce mode and, if there are new
     security events that are not covered by the existing profile set, it
     gives suggestions for modifying the profile.
     <code class="command">aa-logprof</code> uses this information to observe program
     behavior.
    </p><p>
     If a confined program forks and executes another program,
     <code class="command">aa-logprof</code> sees this and asks the user which
     execution mode should be used when launching the child process. The
     execution modes <span class="emphasis"><em>ix</em></span>, <span class="emphasis"><em>px</em></span>,
     <span class="emphasis"><em>Px</em></span>, <span class="emphasis"><em>ux</em></span>,
     <span class="emphasis"><em>Ux</em></span>, <span class="emphasis"><em>cx</em></span>,
     <span class="emphasis"><em>Cx</em></span>, and named profiles, are options for starting
     the child process. If a separate profile exists for the child process,
     the default selection is <span class="emphasis"><em>Px</em></span>. If one does not
     exist, the profile defaults to <span class="emphasis"><em>ix</em></span>. Child processes
     with separate profiles have <code class="command">aa-autodep</code> run on them
     and are loaded into <span class="phrase">AppArmor</span>, if it is running.
    </p><p>
     When <code class="command">aa-logprof</code> exits, profiles are updated with the
     changes. If <span class="phrase">AppArmor</span> is active, the updated profiles are reloaded and,
     if any processes that generated security events are still running in
     the null-XXXX profiles (unique profiles temporarily created in complain
     mode), those processes are set to run under their proper profiles.
    </p><p>
     To run <code class="command">aa-logprof</code>, enter
     <code class="command">aa-logprof</code> into a terminal window while logged in as
     <code class="systemitem">root</code>. The following options can be used for
     <code class="command">aa-logprof</code>:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.11.7.1"><span class="term"><code class="command">aa-logprof -d</code><em class="replaceable">/path/to/profile/directory/</em>
      </span></dt><dd><p>
        Specifies the full path to the location of the profiles if the
        profiles are not located in the standard directory,
        <code class="filename">/etc/apparmor.d/</code>.
       </p></dd><dt id="id-1.7.8.8.11.9.11.7.2"><span class="term"><code class="command">aa-logprof -f</code><em class="replaceable">/path/to/logfile/</em>
      </span></dt><dd><p>
        Specifies the full path to the location of the log file if the log
        file is not located in the default directory or
        <code class="filename">/var/log/audit/audit.log</code>.
       </p></dd><dt id="id-1.7.8.8.11.9.11.7.3"><span class="term"><code class="command">aa-logprof -m "string marker in logfile"</code>
      </span></dt><dd><p>
        Marks the starting point for <code class="command">aa-logprof</code> to look
        in the system log. <code class="command">aa-logprof</code> ignores all events
        in the system log before the specified mark. If the mark contains
        spaces, it must be surrounded by quotes to work correctly. For
        example:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>aa-logprof -m "17:04:21"</pre></div><p>
        or
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>aa-logprof -m e2ff78636296f16d0b5301209a04430d</pre></div></dd></dl></div><p>
     <code class="command">aa-logprof</code> scans the log, asking you how to handle
     each logged event. Each question presents a numbered list of <span class="phrase">AppArmor</span>
     rules that can be added by pressing the number of the item on the list.
    </p><p>
     By default, <code class="command">aa-logprof</code> looks for profiles in
     <code class="filename">/etc/apparmor.d/</code>. Often running
     <code class="command">aa-logprof</code> as <code class="systemitem">root</code> is enough to update the
     profile. However, there might be times when you need to search archived
     log files, such as if the program exercise period exceeds the log
     rotation window (when the log file is archived and a new log file is
     started). If this is the case, you can enter <code class="command">zcat -f `ls
     -1tr</code> <em class="replaceable">/path/to/logfile*</em>` |
     aa-logprof -f -.
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-logprof-ex1" data-id-title="aa-logprof example 1"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.10 </span><span class="title-name">aa-logprof example 1</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-logprof-ex1">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The following is an example of how <code class="command">aa-logprof</code>
     addresses httpd2-prefork accessing the file
     <code class="filename">/etc/group</code>. <code class="literal">[]</code> indicates the
     default option.
    </p><p>
     In this example, the access to <code class="command">/etc/group</code> is part of
     httpd2-prefork accessing name services. The appropriate response is
     <code class="literal">1</code>, which includes a predefined set of <span class="phrase">AppArmor</span> rules.
     Selecting <code class="literal">1</code> to <code class="literal">#include</code> the name
     service package resolves all of the future questions pertaining to DNS
     lookups and makes the profile less brittle in that any changes to
     DNS configuration and the associated name service profile package can
     be made once, rather than needing to revise many profiles.
    </p><div class="verbatim-wrap"><pre class="screen">Profile:  /usr/sbin/httpd2-prefork
Path:     /etc/group
New Mode: r

[1 - #include &lt;abstractions/nameservice&gt;]
 2 - /etc/group
[(A)llow] / (D)eny / (N)ew / (G)lob / Glob w/(E)xt / Abo(r)t / (F)inish</pre></div><p>
     Select one of the following responses:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.12.6.1"><span class="term">Select <span class="keycap">Enter</span>
      </span></dt><dd><p>
        Triggers the default action, which is, in this example, allowing
        access to the specified directory path entry.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.2"><span class="term">Allow</span></dt><dd><p>
        Allows access to the specified directory path entries. <span class="phrase">AppArmor</span>
        suggests file permission access. For more information about this,
        refer to <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm" title="32.7. File permission access modes">Section 32.7, “File permission access modes”</a>.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.3"><span class="term">Deny</span></dt><dd><p>
        Permanently prevents the program from accessing the specified
        directory path entries. <span class="phrase">AppArmor</span> then continues to the next event.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.4"><span class="term">New</span></dt><dd><p>
        Prompts you to enter your own rule for this event, allowing you to
        specify whatever form of regular expression you want. If the
        expression entered does not satisfy the event that prompted
        the question in the first place, <span class="phrase">AppArmor</span> asks for confirmation and
        lets you reenter the expression.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.5"><span class="term">Glob</span></dt><dd><p>
        Select either a specific path or create a general rule using wild
        cards that matches on a broader set of paths. To select any of the
        offered paths, enter the number that is printed in front of the
        paths then decide how to proceed with the selected item.
       </p><p>
        For more information about globbing syntax, refer to
        <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-glob" title="32.6. Profile names, flags, paths, and globbing">Section 32.6, “Profile names, flags, paths, and globbing”</a>.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.6"><span class="term">Glob w/ext</span></dt><dd><p>
        This modifies the original directory path while retaining the file
        name extension. For example,
        <code class="filename">/etc/apache2/file.ext</code> becomes
        <code class="filename">/etc/apache2/*.ext</code>, adding the wild card
        (asterisk) in place of the file name. This allows the program to
        access all files in the suggested directory that end with the
        <code class="literal">.ext</code> extension.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.7"><span class="term">Abort</span></dt><dd><p>
        Aborts <code class="command">aa-logprof</code>, losing all rule changes
        entered so far and leaving all profiles unmodified.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.8"><span class="term">Finish</span></dt><dd><p>
        Closes <code class="command">aa-logprof</code>, saving all rule changes
        entered so far and modifying all profiles.
       </p></dd></dl></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-logprof-ex2" data-id-title="aa-logprof example 2"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.11 </span><span class="title-name">aa-logprof example 2</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-logprof-ex2">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     For example, when profiling vsftpd, see this question:
    </p><div class="verbatim-wrap"><pre class="screen">Profile:  /usr/sbin/vsftpd
Path:     /y2k.jpg

New Mode: r

[1 - /y2k.jpg]

(A)llow / [(D)eny] / (N)ew / (G)lob / Glob w/(E)xt / Abo(r)t / (F)inish</pre></div><p>
     Several items of interest appear in this question. First,
     vsftpd is asking for a path entry at the top of the tree, even though
     vsftpd on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>

     serves FTP files from <code class="filename">/srv/ftp</code> by default. This is
     because vsftpd uses chroot and, for the portion of the code inside the
     chroot jail, <span class="phrase">AppArmor</span> sees file accesses regarding the chroot
     environment rather than the global absolute path.
    </p><p>
     The second item of interest is that you should grant FTP read
     access to all JPEG files in the directory, so you could use
     <span class="guimenu">Glob w/Ext</span> and use the suggested path of
     <code class="literal">/*.jpg</code>. Doing so collapses all previous rules
     granting access to individual <code class="literal">.jpg</code> files and
     forestalls any future questions pertaining to access to
     <code class="filename">.jpg</code> files.
    </p><p>
     Finally, you should grant more general access to FTP files. If
     you select <span class="guimenu">Glob</span> in the last entry,
     <code class="command">aa-logprof</code> replaces the suggested path of
     <code class="filename">/y2k.jpg</code> with <code class="filename">/*</code>.
     Alternatively, you should grant even more access to the entire
     directory tree, in which case you could use the <span class="guimenu">New</span>
     path option and enter <code class="literal">/**.jpg</code> (which would grant
     access to all <code class="literal">.jpg</code> files in the entire directory
     tree) or <code class="filename">/**</code> (which would grant access to all
     files in the directory tree).
    </p><p>
     These items deal with read accesses. Write accesses are similar, except
     that it is good policy to be more conservative in your use of regular
     expressions for write accesses. Dealing with execute accesses is more
     complex. Find an example in
     <a class="xref" href="cha-apparmor-commandline.html#ex-apparmor-commandline-profiling-summary-genprof-learn" title="Learning mode exception: controlling access to specific resources">Example 35.1, “Learning mode exception: controlling access to specific resources”</a>.
    </p><p>
     In the following example, the <code class="filename">/usr/bin/mail</code> mail
     client is being profiled and <code class="command">aa-logprof</code> has
     discovered that <code class="command">/usr/bin/mail</code> executes
     <code class="command">/usr/bin/less</code> as a helper application to
     <span class="quote">“<span class="quote">page</span>”</span> long mail messages. Consequently, it presents this
     prompt:
    </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/nail -&gt; /usr/bin/less
(I)nherit / (P)rofile / (C)hild / (N)ame / (U)nconfined / (X)ix / (D)eny</pre></div><div id="id-1.7.8.8.11.9.13.10" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      The actual executable file for <code class="filename">/usr/bin/mail</code>
      turns out to be <code class="filename">/usr/bin/nail</code>, which is not a
      typographical error.
     </p></div><p>
     The program <code class="filename">/usr/bin/less</code> appears to be a
     simple one for scrolling through text that is more than one screen
     long and that is in fact what <code class="filename">/usr/bin/mail</code> is
     using it for. However, <code class="command">less</code> is actually a large
     and powerful program that uses many other helper applications, such
     as <code class="command">tar</code> and <code class="command">rpm</code>.
    </p><div id="id-1.7.8.8.11.9.13.12" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
      Run <code class="command">less</code> on a tar file or an RPM file and it shows
      you the inventory of these containers.
     </p></div><p>
     You do not want to run <code class="command">rpm</code> automatically when
     reading mail messages (that leads directly to a Microsoft*
     Outlook–style virus attack, because RPM has the power to
     install and modify system programs), so, in this case, the best choice
     is to use <span class="guimenu">Inherit</span>. This results in the less program
     executed from this context running under the profile for
     <code class="filename">/usr/bin/mail</code>. This has two consequences:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       You need to add all the basic file accesses for
       <code class="filename">/usr/bin/less</code> to the profile for
       <code class="filename">/usr/bin/mail</code>.
      </p></li><li class="listitem"><p>
       You can avoid adding the helper applications, such as
       <code class="command">tar</code> and <code class="command">rpm</code>, to the
       <code class="filename">/usr/bin/mail</code> profile so that when
       <code class="filename">/usr/bin/mail</code> runs
       <code class="filename">/usr/bin/less</code> in this context, the less program
       is far less dangerous than it would be without <span class="phrase">AppArmor</span> protection.
       Another option is to use the Cx execute modes. For more information
       on execute modes, see <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec" title="32.12. Execute modes">Section 32.12, “Execute modes”</a>.
      </p></li></ul></div><p>
     In other circumstances, you might instead want to use the
     <span class="guimenu">Profile</span> option. This has the following effects on
     <code class="command">aa-logprof</code>:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       The rule written into the profile uses px/Px, which forces the
       transition to the child's own profile.
      </p></li><li class="listitem"><p>
       <code class="command">aa-logprof</code> constructs a profile for the child and
       starts building it, in the same way that it built the parent profile,
       by assigning events for the child process to the child's profile and
       asking the <code class="command">aa-logprof</code> user questions. The profile
       will also be applied if you run the child as a stand-alone program.
      </p></li></ul></div><p>
     If a confined program forks and executes another program,
     <code class="command">aa-logprof</code> sees this and asks the user which
     execution mode should be used when launching the child process. The
     execution modes of inherit, profile, unconfined, child, named profile,
     or an option to deny the execution are presented.
    </p><p>
     If a separate profile exists for the child process, the default
     selection is profile. If a profile does not exist, the default is
     inherit. The inherit option, or <code class="literal">ix</code>, is described in
     <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm" title="32.7. File permission access modes">Section 32.7, “File permission access modes”</a>.
    </p><p>
     The profile option indicates that the child program should run in its
     own profile. A secondary question asks whether to sanitize the
     environment that the child program inherits from the parent. If you
     choose to sanitize the environment, this places the execution modifier
     <code class="literal">Px</code> in your <span class="phrase">AppArmor</span> profile. If you select not to
     sanitize, <code class="literal">px</code> is placed in the profile and no
     environment sanitizing occurs. The default for the execution mode is
     <code class="literal">Px</code> if you select profile execution mode.
    </p><p>
     The unconfined execution mode is not recommended and should only be
     used in cases where there is no other option to generate a profile for
     a program reliably. Selecting unconfined opens a warning dialog asking
     for confirmation of the choice. If you are sure and choose
     <span class="guimenu">Yes</span>, a second dialog ask whether to sanitize the
     environment. To use the execution mode <code class="literal">Ux</code> in your
     profile, select <span class="guimenu">Yes</span>. To use the execution mode
     <code class="literal">ux</code> in your profile instead, select
     <span class="guimenu">No</span>. The default value selected is
     <code class="literal">Ux</code> for unconfined execution mode.
    </p><div id="id-1.7.8.8.11.9.13.21" data-id-title="Running unconfined" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Running unconfined</div><p>
      Selecting <code class="literal">ux or Ux</code> is dangerous and provides
      no enforcement of policy (from a security perspective) of the
      resulting execution behavior of the child program.
     </p></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-unconfined" data-id-title="aa-unconfined—identifying unprotected processes"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.12 </span><span class="title-name">aa-unconfined—identifying unprotected processes</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-unconfined">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The <code class="command">aa-unconfined</code> command examines open network
     ports on your system, compares that to the set of profiles loaded on
     your system, and reports network services that do not have <span class="phrase">AppArmor</span>
     profiles. It requires <code class="systemitem">root</code> privileges and that it not be
     confined by an <span class="phrase">AppArmor</span> profile.
    </p><p>
     <code class="command">aa-unconfined</code> must be run as <code class="systemitem">root</code> to
     retrieve the process executable link from the
     <code class="filename">/proc</code> file system. This program is susceptible to
     the following race conditions:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       An unlinked executable is mishandled
      </p></li><li class="listitem"><p>
       A process that dies between <code class="command">netstat(8)</code> and further
       checks is mishandled
      </p></li></ul></div><div id="id-1.7.8.8.11.9.14.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      This program lists processes using TCP and UDP only. In short, this
      program is unsuitable for forensics use and is provided only as an aid
      to profiling all network-accessible processes in the lab.
     </p></div></section><section class="sect3" id="commandline-profiling-summary-aa-notify" data-id-title="aa-notify"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.13 </span><span class="title-name">aa-notify</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#commandline-profiling-summary-aa-notify">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">aa-notify</code> is a handy utility that displays <span class="phrase">AppArmor</span>
     notifications in your desktop environment. This is convenient if
     you do not want to inspect the <span class="phrase">AppArmor</span> log file, but rather let the
     desktop inform you about events that violate the policy. To enable
     <span class="phrase">AppArmor</span> desktop notifications, run <code class="command">aa-notify</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-notify -p -u <em class="replaceable">USERNAME</em> --display <em class="replaceable">DISPLAY_NUMBER</em></pre></div><p>
     where <em class="replaceable">USERNAME</em> is your user name under which
     you are logged in, and <em class="replaceable">DISPLAY_NUMBER</em> is the
     X Window display number you are currently using, such as
     <code class="literal">:0</code>. The process is run in the background, and shows
     a notification each time a deny event happens.
    </p><div id="id-1.7.8.8.11.9.15.5" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
      The active X Window display number is saved in the
      <code class="literal">$DISPLAY</code> variable, so you can use
      <code class="literal">--display $DISPLAY</code> to avoid finding out the current
      display number.
     </p></div><div class="figure" id="id-1.7.8.8.11.9.15.6"><div class="figure-contents"><div class="mediaobject"><a href="images/aa-notify.png"><img src="images/aa-notify.png" width="40%" alt="aa-notify Message in GNOME" title="aa-notify Message in GNOME"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 35.1: </span><span class="title-name"><code class="command">aa-notify Message in GNOME</code> </span></span><a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#id-1.7.8.8.11.9.15.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div><p>
     With the <code class="option">-s <em class="replaceable">DAYS</em></code> option,
     you can also configure <code class="command">aa-notify</code> to display a
     summary of notifications for the specified number of past days. For
     more information on <code class="command">aa-notify</code>, see its man page
     <code class="command">man 8 aa-notify</code>.
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-vim" data-id-title="apparmor.vim"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.14 </span><span class="title-name">apparmor.vim</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling-summary-vim">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     A syntax highlighting file for the vim text editor highlights various
     features of an <span class="phrase">AppArmor</span> profile with colors. Using vim and the <span class="phrase">AppArmor</span>
     syntax mode for vim, you can see the semantic implications of your
     profiles with color highlighting. Use vim to view and edit your profile
     by typing vim at a terminal window.
    </p><p>
     To enable the syntax coloring when you edit an <span class="phrase">AppArmor</span> profile in vim,
     use the commands <code class="literal">:syntax on</code> then <code class="literal">:set
     syntax=apparmor</code>. To make sure vim recognizes the edited file
     type correctly as an <span class="phrase">AppArmor</span> profile, add
    </p><div class="verbatim-wrap"><pre class="screen"># vim:ft=apparmor</pre></div><p>
     at the end of the profile.
    </p><div id="id-1.7.8.8.11.9.16.6" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
      <code class="command">vim</code> comes with <span class="phrase">AppArmor</span> highlighting automatically
      enabled for files in <code class="filename">/etc/apparmor.d/</code>.
     </p></div><p>
     When you enable this feature, vim colors the lines of the profile for
     you:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.16.8.1"><span class="term">Blue</span></dt><dd><p>
        Comments
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.2"><span class="term">White</span></dt><dd><p>
        Ordinary read access lines
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.3"><span class="term">Brown</span></dt><dd><p>
        Capability statements and complain flags
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.4"><span class="term">Yellow</span></dt><dd><p>
        Lines that grant write access
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.5"><span class="term">Green</span></dt><dd><p>
        Lines that grant execute permission (either ix or px)
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.6"><span class="term">Red</span></dt><dd><p>
        Lines that grant unconfined access (ux)
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.7"><span class="term">Red background</span></dt><dd><p>
        Syntax errors that do not load properly into the <span class="phrase">AppArmor</span> modules
       </p></dd></dl></div><p>
     Use the <code class="systemitem">apparmor.vim</code> and
     <code class="systemitem">vim</code> man pages and the <code class="option">:help
     syntax</code> from within the vim editor for further vim help about
     syntax highlighting. The <span class="phrase">AppArmor</span> syntax is stored in
     <code class="filename">/usr/share/vim/current/syntax/apparmor.vim.</code>
    </p></section></section></section><section class="sect1" id="sec-apparmor-commandline-filenames" data-id-title="Important file names and directories"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.8 </span><span class="title-name">Important file names and directories</span></span> <a title="Permalink" class="permalink" href="cha-apparmor-commandline.html#sec-apparmor-commandline-filenames">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following list contains the most important files and directories used
   by the <span class="phrase">AppArmor</span> framework. If you intend to manage and troubleshoot your
   profiles manually, make sure that you know about these files and
   directories:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.12.3.1"><span class="term"><code class="filename">/sys/kernel/security/apparmor/profiles</code>
    </span></dt><dd><p>
      Virtualized file representing the currently loaded set of profiles.
     </p></dd><dt id="id-1.7.8.8.12.3.2"><span class="term"><code class="filename">/etc/apparmor/</code>
    </span></dt><dd><p>
      Location of <span class="phrase">AppArmor</span> configuration files.
     </p></dd><dt id="id-1.7.8.8.12.3.3"><span class="term"><code class="filename">/usr/share/apparmor/extra-profiles</code>
    </span></dt><dd><p>
      A local repository of profiles shipped with <span class="phrase">AppArmor</span>, but not enabled
      by default.
     </p></dd><dt id="id-1.7.8.8.12.3.4"><span class="term"><code class="filename">/etc/apparmor.d/</code>
    </span></dt><dd><p>
      Location of profiles, named with the convention of replacing the
      <code class="literal">/</code> in paths with <code class="literal">.</code> (not for the
      root <code class="literal">/</code>) so profiles are easier to manage. For
      example, the profile for the program
      <code class="filename">/usr/sbin/smbd</code> is named
      <code class="filename">usr.sbin.smbd</code>.
     </p></dd><dt id="id-1.7.8.8.12.3.5"><span class="term"><code class="filename">/etc/apparmor.d/abstractions/</code>
    </span></dt><dd><p>
      Location of abstractions.
     </p></dd><dt id="id-1.7.8.8.12.3.6"><span class="term"><code class="filename">/etc/apparmor.d/program-chunks/</code>
    </span></dt><dd><p>
      Location of program chunks.
     </p></dd><dt id="id-1.7.8.8.12.3.7"><span class="term"><code class="filename">/proc/*/attr/current</code>
    </span></dt><dd><p>
      Check this file to review the confinement status of a process and the
      profile that is used to confine the process. The <code class="command">ps</code>
      <code class="option">auxZ</code> command retrieves this information
      automatically.
     </p></dd></dl></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-apparmor-yast.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 34 </span>Building and managing profiles with YaST</span></a> </div><div><a class="pagination-link next" href="cha-apparmor-hat.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 36 </span>Profiling your Web applications using ChangeHat</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-apparmor-commandline.html#sec-apparmor-commandline-status"><span class="title-number">35.1 </span><span class="title-name">Checking the <span class="phrase">AppArmor</span> status</span></a></span></li><li><span class="sect1"><a href="cha-apparmor-commandline.html#sec-apparmor-commandline-build"><span class="title-number">35.2 </span><span class="title-name">Building <span class="phrase">AppArmor</span> profiles</span></a></span></li><li><span class="sect1"><a href="cha-apparmor-commandline.html#sec-apparmor-commandline-add"><span class="title-number">35.3 </span><span class="title-name">Adding or creating an <span class="phrase">AppArmor</span> profile</span></a></span></li><li><span class="sect1"><a href="cha-apparmor-commandline.html#sec-apparmor-commandline-edit"><span class="title-number">35.4 </span><span class="title-name">Editing an <span class="phrase">AppArmor</span> profile</span></a></span></li><li><span class="sect1"><a href="cha-apparmor-commandline.html#sec-apparmor-commandline-unload"><span class="title-number">35.5 </span><span class="title-name">Unloading unknown <span class="phrase">AppArmor</span> profiles</span></a></span></li><li><span class="sect1"><a href="cha-apparmor-commandline.html#sec-apparmor-commandline-del"><span class="title-number">35.6 </span><span class="title-name">Deleting an <span class="phrase">AppArmor</span> profile</span></a></span></li><li><span class="sect1"><a href="cha-apparmor-commandline.html#sec-apparmor-commandline-profiling"><span class="title-number">35.7 </span><span class="title-name">Two methods of profiling</span></a></span></li><li><span class="sect1"><a href="cha-apparmor-commandline.html#sec-apparmor-commandline-filenames"><span class="title-number">35.8 </span><span class="title-name">Important file names and directories</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>