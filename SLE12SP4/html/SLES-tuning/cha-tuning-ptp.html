<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLES 12 SP4 | System Analysis and Tuning Guide | Precision Time Protocol</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Precision Time Protocol | SLES 12 SP4"/>
<meta name="description" content="For network environments, it is vital to keep the comp…"/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="12 SP4"/>
<meta name="book-title" content="System Analysis and Tuning Guide"/>
<meta name="chapter-title" content="Chapter 19. Precision Time Protocol"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="SUSE Linux Enterprise Server 12 SP4"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Precision Time Protocol | SLES 12 SP4"/>
<meta property="og:description" content="For network environments, it is vital to keep the computer and other devices' clocks synchronized and accurate. There are se…"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Precision Time Protocol | SLES 12 SP4"/>
<meta name="twitter:description" content="For network environments, it is vital to keep the computer and other devices' clocks synchronized and accurate. There are se…"/>
<link rel="prev" href="part-tuning-ptp.html" title="Part VII. Synchronized Clocks with Precision Time Protocol"/><link rel="next" href="app-tuning-docupdates.html" title="Appendix A. Documentation Updates"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">System Analysis and Tuning Guide</a><span> / </span><a class="crumb" href="part-tuning-ptp.html">Synchronized Clocks with Precision Time Protocol</a><span> / </span><a class="crumb" href="cha-tuning-ptp.html">Precision Time Protocol</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">System Analysis and Tuning Guide</div><ol><li><a href="preface-tuning.html" class=" "><span class="title-number"> </span><span class="title-name">About This Guide</span></a></li><li><a href="part-tuning-basics.html" class="has-children "><span class="title-number">I </span><span class="title-name">Basics</span></a><ol><li><a href="cha-tuning-basics.html" class=" "><span class="title-number">1 </span><span class="title-name">General Notes on System Tuning</span></a></li></ol></li><li><a href="part-tuning-monitoring.html" class="has-children "><span class="title-number">II </span><span class="title-name">System Monitoring</span></a><ol><li><a href="cha-util.html" class=" "><span class="title-number">2 </span><span class="title-name">System Monitoring Utilities</span></a></li><li><a href="cha-tuning-logfiles.html" class=" "><span class="title-number">3 </span><span class="title-name">Analyzing and Managing System Log Files</span></a></li></ol></li><li><a href="part-tuning-kerneltrace.html" class="has-children "><span class="title-number">III </span><span class="title-name">Kernel Monitoring</span></a><ol><li><a href="cha-tuning-systemtap.html" class=" "><span class="title-number">4 </span><span class="title-name">SystemTap—Filtering and Analyzing System Data</span></a></li><li><a href="cha-tuning-kprobes.html" class=" "><span class="title-number">5 </span><span class="title-name">Kernel Probes</span></a></li><li><a href="cha-perf.html" class=" "><span class="title-number">6 </span><span class="title-name">Hardware-Based Performance Monitoring with Perf</span></a></li><li><a href="cha-tuning-oprofile.html" class=" "><span class="title-number">7 </span><span class="title-name">OProfile—System-Wide Profiler</span></a></li></ol></li><li><a href="part-tuning-resources.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Resource Management</span></a><ol><li><a href="cha-tuning-resources.html" class=" "><span class="title-number">8 </span><span class="title-name">General System Resource Management</span></a></li><li><a href="cha-tuning-cgroups.html" class=" "><span class="title-number">9 </span><span class="title-name">Kernel Control Groups</span></a></li><li><a href="cha-tuning-numactl.html" class=" "><span class="title-number">10 </span><span class="title-name">Automatic Non-Uniform Memory Access (NUMA) Balancing</span></a></li><li><a href="cha-tuning-power.html" class=" "><span class="title-number">11 </span><span class="title-name">Power Management</span></a></li></ol></li><li><a href="part-tuning-kernel.html" class="has-children "><span class="title-number">V </span><span class="title-name">Kernel Tuning</span></a><ol><li><a href="cha-tuning-io.html" class=" "><span class="title-number">12 </span><span class="title-name">Tuning I/O Performance</span></a></li><li><a href="cha-tuning-taskscheduler.html" class=" "><span class="title-number">13 </span><span class="title-name">Tuning the Task Scheduler</span></a></li><li><a href="cha-tuning-memory.html" class=" "><span class="title-number">14 </span><span class="title-name">Tuning the Memory Management Subsystem</span></a></li><li><a href="cha-tuning-network.html" class=" "><span class="title-number">15 </span><span class="title-name">Tuning the Network</span></a></li></ol></li><li><a href="part-tuning-dumps.html" class="has-children "><span class="title-number">VI </span><span class="title-name">Handling System Dumps</span></a><ol><li><a href="cha-tuning-tracing.html" class=" "><span class="title-number">16 </span><span class="title-name">Tracing Tools</span></a></li><li><a href="cha-tuning-kexec.html" class=" "><span class="title-number">17 </span><span class="title-name">Kexec and Kdump</span></a></li><li><a href="cha-tuning-systemd-coredump.html" class=" "><span class="title-number">18 </span><span class="title-name">Using <code class="systemitem">systemd-coredump</code> to Debug Application Crashes</span></a></li></ol></li><li class="active"><a href="part-tuning-ptp.html" class="has-children you-are-here"><span class="title-number">VII </span><span class="title-name">Synchronized Clocks with Precision Time Protocol</span></a><ol><li><a href="cha-tuning-ptp.html" class=" you-are-here"><span class="title-number">19 </span><span class="title-name">Precision Time Protocol</span></a></li></ol></li><li><a href="app-tuning-docupdates.html" class=" "><span class="title-number">A </span><span class="title-name">Documentation Updates</span></a></li><li><a href="bk06apb.html" class=" "><span class="title-number">B </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-tuning-ptp" data-id-title="Precision Time Protocol"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">12 SP4</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">19 </span><span class="title-name">Precision Time Protocol</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  For network environments, it is vital to keep the computer and other
  devices' clocks synchronized and accurate. There are several solutions to
  achieve this, for example the widely used Network Time Protocol (NTP) described in
  <span class="intraxref">Book “Administration Guide”, Chapter 25 “Time Synchronization with NTP”</span>.
 </p><p>
  The Precision Time Protocol (PTP) is a protocol capable of sub-microsecond accuracy, which
  is better than what NTP achieves. PTP support is divided between the
  kernel and user space. The kernel in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> includes support for
  PTP clocks, which are provided by network drivers.
 </p><section class="sect1" id="tuning-ptp-intro" data-id-title="Introduction to PTP"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.1 </span><span class="title-name">Introduction to PTP</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The clocks managed by PTP follow a master-slave hierarchy. The slaves are
   synchronized to their masters. The hierarchy is updated by the
   <span class="emphasis"><em>best master clock</em></span> (BMC) algorithm, which runs on
   every clock. The clock with only one port can be either master or slave.
   Such a clock is called an <span class="emphasis"><em>ordinary clock</em></span> (OC). A
   clock with multiple ports can be master on one port and slave on another.
   Such a clock is called a <span class="emphasis"><em>boundary clock</em></span> (BC). The
   top-level master is called the <span class="emphasis"><em>grandmaster clock</em></span>.
   The grandmaster clock can be synchronized with a Global Positioning
   System (GPS). This way disparate networks can be synchronized with a
   high degree of accuracy.
  </p><p>
   The hardware support is the main advantage of PTP. It is supported by
   various network switches and network interface controllers (NIC). While
   it is possible to use non-PTP enabled hardware within the network, having
   network components between all PTP clocks PTP hardware enabled achieves
   the best possible accuracy.
  </p><section class="sect2" id="tuning-ptp-linuxptp" data-id-title="PTP Linux Implementation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.1.1 </span><span class="title-name">PTP Linux Implementation</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-linuxptp">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    On <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, the implementation of PTP is provided by the
    <code class="systemitem">linuxptp</code> package. Install it with
    <code class="command">zypper install linuxptp</code>. It includes the
    <code class="command">ptp4l</code> and <code class="command">phc2sys</code> programs for
    clock synchronization. <code class="command">ptp4l</code> implements the PTP
    boundary clock and ordinary clock. When hardware time stamping is
    enabled, <code class="command">ptp4l</code> synchronizes the PTP hardware clock to
    the master clock. With software time stamping, it synchronizes the
    system clock to the master clock. <code class="command">phc2sys</code> is needed
    only with hardware time stamping to synchronize the system clock to the
    PTP hardware clock on the network interface card (NIC).
   </p></section></section><section class="sect1" id="tuning-ptp-using" data-id-title="Using PTP"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.2 </span><span class="title-name">Using PTP</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-using">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="tuning-ptp-driver-support" data-id-title="Network Driver and Hardware Support"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.2.1 </span><span class="title-name">Network Driver and Hardware Support</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-driver-support">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    PTP requires that the used kernel network driver supports either
    software or hardware time stamping. Moreover, the NIC must support time
    stamping in the physical hardware. You can verify the driver and NIC
    time stamping capabilities with <code class="command">ethtool</code>:
   </p><div class="verbatim-wrap"><pre class="screen">ethtool -T eth0
Time stamping parameters for eth0:
Capabilities:
hardware-transmit     (SOF_TIMESTAMPING_TX_HARDWARE)
        software-transmit     (SOF_TIMESTAMPING_TX_SOFTWARE)
        hardware-receive      (SOF_TIMESTAMPING_RX_HARDWARE)
        software-receive      (SOF_TIMESTAMPING_RX_SOFTWARE)
        software-system-clock (SOF_TIMESTAMPING_SOFTWARE)
        hardware-raw-clock    (SOF_TIMESTAMPING_RAW_HARDWARE)
PTP Hardware Clock: 0
Hardware Transmit Timestamp Modes:
        off                   (HWTSTAMP_TX_OFF)
        on                    (HWTSTAMP_TX_ON)
Hardware Receive Filter Modes:
        none                  (HWTSTAMP_FILTER_NONE)
        all                   (HWTSTAMP_FILTER_ALL)</pre></div><p>
    Software time stamping requires the following parameters:
   </p><div class="verbatim-wrap"><pre class="screen">SOF_TIMESTAMPING_SOFTWARE
SOF_TIMESTAMPING_TX_SOFTWARE
SOF_TIMESTAMPING_RX_SOFTWARE</pre></div><p>
    Hardware time stamping requires the following parameters:
   </p><div class="verbatim-wrap"><pre class="screen">SOF_TIMESTAMPING_RAW_HARDWARE
SOF_TIMESTAMPING_TX_HARDWARE
SOF_TIMESTAMPING_RX_HARDWARE</pre></div></section><section class="sect2" id="tuning-ptp-ptp41" data-id-title="Using ptp4l"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.2.2 </span><span class="title-name">Using <code class="command">ptp4l</code></span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-ptp41">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">ptp4l</code> uses hardware time stamping by default. As
    <code class="systemitem">root</code>, you need to specify the network interface capable of
    hardware time stamping with the <code class="option">-i</code> option. The
    <code class="option">-m</code> tells <code class="command">ptp4l</code> to print its output
    to the standard output instead of the system's logging facility:
   </p><div class="verbatim-wrap"><pre class="screen">ptp4l -m -i eth0
selected eth0 as PTP clock
port 1: INITIALIZING to LISTENING on INITIALIZE
port 0: INITIALIZING to LISTENING on INITIALIZE
port 1: new foreign master 00a152.fffe.0b334d-1
selected best master clock 00a152.fffe.0b334d
port 1: LISTENING to UNCALIBRATED on RS_SLAVE
master offset -25937 s0 freq +0 path delay       12340
master offset -27887 s0 freq +0 path delay       14232
master offset -38802 s0 freq +0 path delay       13847
master offset -36205 s1 freq +0 path delay       10623
master offset  -6975 s2 freq -30575 path delay   10286
port 1: UNCALIBRATED to SLAVE on MASTER_CLOCK_SELECTED
master offset  -4284 s2 freq -30135 path delay    9892</pre></div><p>
    The <code class="literal">master offset</code> value represents the measured
    offset from the master (in nanoseconds).
   </p><p>
    The <code class="literal">s0</code>, <code class="literal">s1</code>, <code class="literal">s2</code>
    indicators show the different states of the clock servo:
    <code class="literal">s0</code> is unlocked,
    <code class="literal">s1</code> is clock step, and <code class="literal">s2</code> is
    locked. If the servo is in the locked state (<code class="literal">s2</code>), the
    clock will not be stepped (only slowly adjusted) if the
    <code class="option">pi_offset_const</code> option is set to a negative value in
    the configuration file (see <code class="command">man 8 ptp4l</code> for more
    information).
   </p><p>
    The <code class="literal">freq</code> value represents the frequency
    adjustment of the clock (in parts per billion, ppb).
   </p><p>
    The <code class="literal">path delay</code> value represents the estimated delay of the
    synchronization messages sent from the master (in nanoseconds).
   </p><p>
    Port 0 is a Unix domain socket used for local PTP management.
    Port 1 is the <code class="systemitem">eth0</code> interface.
   </p><p>
    <code class="literal">INITIALIZING</code>, <code class="literal">LISTENING</code>,
    <code class="literal">UNCALIBRATED</code> and <code class="literal">SLAVE</code> are examples of
    port states which change on <code class="literal">INITIALIZE</code>,
    <code class="literal">RS_SLAVE</code>, and <code class="literal">MASTER_CLOCK_SELECTED</code>
    events. When the port state changes from <code class="literal">UNCALIBRATED</code>
    to <code class="literal">SLAVE</code>, the computer has successfully synchronized with
    a PTP master clock.
   </p><p>
    You can enable software time stamping with the <code class="option">-S</code>
    option.
   </p><div class="verbatim-wrap"><pre class="screen">ptp4l -m -S -i eth3</pre></div><p>
    You can also run <code class="command">ptp4l</code> as a service:
   </p><div class="verbatim-wrap"><pre class="screen">systemctl start ptp4l</pre></div><p>
    In this case, <code class="command">ptp4l</code> reads its options from the
    <code class="filename">/etc/sysconfig/ptp4l</code> file. By default, this file
    tells <code class="command">ptp4l</code> to read the configuration options from
    <code class="filename">/etc/ptp4l.conf</code>. For more information on
    <code class="command">ptp4l</code> options and the configuration file settings,
    see <code class="command">man 8 ptp4l</code>.
   </p><p>
    To enable the <code class="command">ptp4l</code> service permanently, run the
    following:
   </p><div class="verbatim-wrap"><pre class="screen">systemctl enable ptp4l</pre></div><p>
    To disable it, run
   </p><div class="verbatim-wrap"><pre class="screen">systemctl disable ptp4l</pre></div></section><section class="sect2" id="tuning-ptp-confile" data-id-title="ptp4l Configuration File"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.2.3 </span><span class="title-name"><code class="command">ptp4l</code> Configuration File</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-confile">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">ptp4l</code> can read its configuration from an optional
    configuration file. As no configuration file is used by default, you
    need to specify it with <code class="option">-f</code>.
   </p><div class="verbatim-wrap"><pre class="screen">ptp4l -f /etc/ptp4l.conf</pre></div><p>
    The configuration file is divided into sections. The global section
    (indicated as <code class="literal">[global]</code>) sets the program options,
    clock options and default port options. Other sections are port
    specific, and they override the default port options. The name of the
    section is the name of the configured port—for example,
    <code class="literal">[eth0]</code>. An empty port section can be used to replace
    the command line option.
   </p><div class="verbatim-wrap"><pre class="screen">[global]
verbose               1
time_stamping         software
[eth0]</pre></div><p>
    The example configuration file is an equivalent of the following
    command's options:
   </p><div class="verbatim-wrap"><pre class="screen">ptp4l -i eth0 -m -S</pre></div><p>
    For a complete list of <code class="command">ptp4l</code> configuration options,
    see <code class="command">man 8 ptp4l</code>.
   </p></section><section class="sect2" id="tuning-ptp-delay-measurement" data-id-title="Delay Measurement"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.2.4 </span><span class="title-name">Delay Measurement</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-delay-measurement">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">ptp4l</code> measures time delay in two different ways:
    <span class="emphasis"><em>peer-to-peer</em></span> (P2P) or
    <span class="emphasis"><em>end-to-end</em></span> (E2E).
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.9.2.6.6.3.1"><span class="term">P2P</span></dt><dd><p>
       This method is specified with <code class="option">-P</code>.
      </p><p>
       It reacts to changes in the network environment faster and is more
       accurate in measuring the delay. It is only used in networks where
       each port exchanges PTP messages with one other port. P2P needs to be
       supported by all hardware on the communication path.
      </p></dd><dt id="id-1.8.9.2.6.6.3.2"><span class="term">E2E</span></dt><dd><p>
       This method is specified with <code class="option">-E</code>. This is the
       default.
      </p></dd><dt id="id-1.8.9.2.6.6.3.3"><span class="term">Automatic method selection</span></dt><dd><p>
       This method is specified with <code class="option">-A</code>. The automatic
       option starts <code class="command">ptp4l</code> in E2E mode, and changes to
       P2P mode if a peer delay request is received.
      </p></dd></dl></div><div id="id-1.8.9.2.6.6.4" data-id-title="Common Measurement Method" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Common Measurement Method</div><p>
     All clocks on a single PTP communication path must use the same method
     to measure the time delay. A warning will be printed if either a peer
     delay request is received on a port using the E2E mechanism, or an E2E
     delay request is received on a port using the P2P mechanism.
    </p></div></section><section class="sect2" id="tuning-ptp-pmc" data-id-title="PTP Management Client: pmc"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.2.5 </span><span class="title-name">PTP Management Client: <code class="command">pmc</code></span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-pmc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can use the <code class="command">pmc</code> client to obtain more detailed
    information about <code class="command">ptp41</code>. It reads from the standard
    input—or from the command line—actions specified by name and
    management ID. Then it sends the actions over the selected transport,
    and prints any received replies. There are three actions supported:
    <code class="command">GET</code> retrieves the specified information,
    <code class="command">SET</code> updates the specified information, and
    <code class="command">CMD</code> (or <code class="command">COMMAND</code>) initiates the
    specified event.
   </p><p>
    By default, the management commands are addressed to all ports. The
    <code class="command">TARGET</code> command can be used to select a particular
    clock and port for the subsequent messages. For a complete list of
    management IDs, run <code class="command">pmc help</code>.
   </p><div class="verbatim-wrap"><pre class="screen">pmc -u -b 0 'GET TIME_STATUS_NP'
sending: GET TIME_STATUS_NP
        90f2ca.fffe.20d7e9-0 seq 0 RESPONSE MANAGMENT TIME_STATUS_NP
                master_offset              283
                ingress_time               1361569379345936841
                cumulativeScaledRateOffset   +1.000000000
                scaledLastGmPhaseChange    0
                gmTimeBaseIndicator        0
                lastGmPhaseChange          0x0000'0000000000000000.0000
                gmPresent                  true
                gmIdentity                 00b058.feef.0b448a</pre></div><p>
    The <code class="option">-b</code> option specifies the boundary hops value in sent
    messages. Setting it to zero limits the boundary to the local
    <code class="command">ptp4l</code> instance. Increasing the value will retrieve
    the messages also from PTP nodes that are further from the local
    instance. The returned information may include:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.9.2.6.7.6.1"><span class="term">stepsRemoved</span></dt><dd><p>
       The number of communication nodes to the grandmaster clock.
      </p></dd><dt id="id-1.8.9.2.6.7.6.2"><span class="term">offsetFromMaster, master_offset</span></dt><dd><p>
       The last measured offset of the clock from the master clock
       (nanoseconds).
      </p></dd><dt id="id-1.8.9.2.6.7.6.3"><span class="term">meanPathDelay</span></dt><dd><p>
       The estimated delay of the synchronization messages sent from the
       master clock (nanoseconds).
      </p></dd><dt id="id-1.8.9.2.6.7.6.4"><span class="term">gmPresent</span></dt><dd><p>
       If <code class="literal">true</code>, the PTP clock is synchronized to the
       master clock; the local clock is not the grandmaster clock.
      </p></dd><dt id="id-1.8.9.2.6.7.6.5"><span class="term">gmIdentity</span></dt><dd><p>
       This is the grandmaster's identity.
      </p></dd></dl></div><p>
    For a complete list of <code class="command">pmc</code> command line options, see
    <code class="command">man 8 pmc</code>.
   </p></section></section><section class="sect1" id="tuning-ptp-phc2sys" data-id-title="Synchronizing the Clocks with phc2sys"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.3 </span><span class="title-name">Synchronizing the Clocks with <code class="command">phc2sys</code></span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-phc2sys">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use <code class="command">phc2sys</code> to synchronize the system clock to the PTP
   hardware clock (PHC) on the network card. The system clock is considered
   a <span class="emphasis"><em>slave</em></span>, while the network card a
   <span class="emphasis"><em>master</em></span>. PHC itself is synchronized with
   <code class="command">ptp4l</code> (see <a class="xref" href="cha-tuning-ptp.html#tuning-ptp-using" title="19.2. Using PTP">Section 19.2, “Using PTP”</a>). Use
   <code class="option">-s</code> to specify the master clock by device or network
   interface. Use <code class="option">-w</code> to wait until <code class="command">ptp4l</code>
   is in a synchronized state.
  </p><div class="verbatim-wrap"><pre class="screen">phc2sys -s eth0 -w</pre></div><p>
   PTP operates in <span class="emphasis"><em>International Atomic Time</em></span> (TAI),
   while the system clock uses <span class="emphasis"><em>Coordinated Universal
   Time</em></span> (UTC). If you do not specify <code class="option">-w</code> to wait
   for <code class="command">ptp4l</code> synchronization, you can specify the offset
   in seconds between TAI and UTC with <code class="option">-O</code>:
  </p><div class="verbatim-wrap"><pre class="screen">phc2sys -s eth0 -O -35</pre></div><p>
   You can run <code class="command">phc2sys</code> as a service as well:
  </p><div class="verbatim-wrap"><pre class="screen">systemctl start phc2sys</pre></div><p>
   In this case, <code class="command">phc2sys</code> reads its options from the
   <code class="filename">/etc/sysconfig/phc2sys</code> file. For more information on
   <code class="command">phc2sys</code> options, see <code class="command">man 8 phc2sys</code>.
  </p><p>
   To enable the <code class="command">phc2sys</code> service permanently, run the
   following:
  </p><div class="verbatim-wrap"><pre class="screen">systemctl enable phc2sys</pre></div><p>
   To disable it, run
  </p><div class="verbatim-wrap"><pre class="screen">systemctl dosable phc2sys</pre></div><section class="sect2" id="tuning-ptp-phc2sys-verify" data-id-title="Verifying Time Synchronization"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.3.1 </span><span class="title-name">Verifying Time Synchronization</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-phc2sys-verify">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When PTP time synchronization is working properly and hardware time
    stamping is used, <code class="command">ptp4l</code> and
    <code class="command">phc2sys</code> output messages with time offsets and
    frequency adjustments periodically to the system log.
   </p><p>
    An example of the <code class="command">ptp4l</code> output:
   </p><div class="verbatim-wrap"><pre class="screen">ptp4l[351.358]: selected /dev/ptp0 as PTP clock
ptp4l[352.361]: port 1: INITIALIZING to LISTENING on INITIALIZE
ptp4l[352.361]: port 0: INITIALIZING to LISTENING on INITIALIZE
ptp4l[353.210]: port 1: new foreign master 00a069.eefe.0b442d-1
ptp4l[357.214]: selected best master clock 00a069.eefe.0b662d
ptp4l[357.214]: port 1: LISTENING to UNCALIBRATED on RS_SLAVE
ptp4l[359.224]: master offset       3304 s0 freq      +0 path delay      9202
ptp4l[360.224]: master offset       3708 s1 freq  -28492 path delay      9202
ptp4l[361.224]: master offset      -3145 s2 freq  -32637 path delay      9202
ptp4l[361.224]: port 1: UNCALIBRATED to SLAVE on MASTER_CLOCK_SELECTED
ptp4l[362.223]: master offset       -145 s2 freq  -30580 path delay      9202
ptp4l[363.223]: master offset       1043 s2 freq  -28436 path delay      8972
[...]
ptp4l[371.235]: master offset        285 s2 freq  -28511 path delay      9199
ptp4l[372.235]: master offset        -78 s2 freq  -28788 path delay      9204</pre></div><p>
    An example of the <code class="command">phc2sys</code> output:
   </p><div class="verbatim-wrap"><pre class="screen">phc2sys[616.617]: Waiting for ptp4l...
phc2sys[628.628]: phc offset     66341 s0 freq      +0 delay   2729
phc2sys[629.628]: phc offset     64668 s1 freq  -37690 delay   2726
[...]
phc2sys[646.630]: phc offset      -333 s2 freq  -37426 delay   2747
phc2sys[646.630]: phc offset       194 s2 freq  -36999 delay   2749</pre></div><p>
    <code class="command">ptp4l</code> normally writes messages very frequently. You
    can reduce the frequency with the <code class="literal">summary_interval</code>
    directive. Its value is an exponent of the 2^N expression. For example,
    to reduce the output to every 1024 (which is equal to 2^10) seconds, add
    the following line to the <code class="filename">/etc/ptp4l.conf</code> file:
   </p><div class="verbatim-wrap"><pre class="screen">summary_interval 10</pre></div><p>
    You can also reduce the frequency of the <code class="command">phc2sys</code>
    command's updates with the <code class="option">-u
    <em class="replaceable">SUMMARY-UPDATES</em></code> option.
   </p></section></section><section class="sect1" id="tuning-ptp-examples" data-id-title="Examples of Configurations"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.4 </span><span class="title-name">Examples of Configurations</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-examples">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section includes several examples of <code class="command">ptp4l</code>
   configuration. The examples are not full configuration files but rather
   a minimal list of changes to be made to the specific files. The string
   <em class="replaceable">ethX</em> stands for the actual network interface
   name in your setup.
  </p><div class="complex-example"><div class="example" id="id-1.8.9.2.8.3" data-id-title="Slave clock using software time stamping"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 19.1: </span><span class="title-name">Slave clock using software time stamping </span></span><a title="Permalink" class="permalink" href="cha-tuning-ptp.html#id-1.8.9.2.8.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    No changes made to the distribution
    <code class="filename">/etc/ptp4l.conf</code>.
   </p></div></div></div><div class="complex-example"><div class="example" id="id-1.8.9.2.8.4" data-id-title="Slave clock using hardware time stamping"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 19.2: </span><span class="title-name">Slave clock using hardware time stamping </span></span><a title="Permalink" class="permalink" href="cha-tuning-ptp.html#id-1.8.9.2.8.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    <code class="filename">/etc/sysconfig/phc2sys</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-s ethX -w”</pre></div><p>
    No changes made to the distribution
    <code class="filename">/etc/ptp4l.conf</code>.
   </p></div></div></div><div class="complex-example"><div class="example" id="id-1.8.9.2.8.5" data-id-title="Master clock using hardware time stamping"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 19.3: </span><span class="title-name">Master clock using hardware time stamping </span></span><a title="Permalink" class="permalink" href="cha-tuning-ptp.html#id-1.8.9.2.8.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    <code class="filename">/etc/sysconfig/phc2sys</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-s CLOCK_REALTIME -c ethX -w”</pre></div><p>
    <code class="filename">/etc/ptp4l.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">priority1 127</pre></div></div></div></div><div class="complex-example"><div class="example" id="id-1.8.9.2.8.6" data-id-title="Master clock using software time stamping (not generally recommended)"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 19.4: </span><span class="title-name">Master clock using software time stamping (not generally recommended) </span></span><a title="Permalink" class="permalink" href="cha-tuning-ptp.html#id-1.8.9.2.8.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    <code class="filename">/etc/ptp4l.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">priority1 127</pre></div></div></div></div></section><section class="sect1" id="tuning-ptp-ntp" data-id-title="PTP and NTP"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.5 </span><span class="title-name">PTP and NTP</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-ntp">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   NTP and PTP time synchronization tools can coexist, synchronizing time
   from one to another in both directions.
  </p><section class="sect2" id="tuning-ptp-ntp2ptp" data-id-title="NTP to PTP Synchronization"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.5.1 </span><span class="title-name">NTP to PTP Synchronization</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-ntp2ptp">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When <code class="systemitem">ntpd</code> is used to synchronize the local
    system clock, you can configure the <code class="command">ptp4l</code> to be the
    grandmaster clock distributing the time from the local system clock via
    PTP. Include the <code class="option">priority1</code> option in
    <code class="filename">/etc/ptp4l.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">[global]
priority1 127
[eth0]</pre></div><p>
    Then run <code class="command">ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">ptp4l -f /etc/ptp4l.conf</pre></div><p>
    When hardware time stamping is used, you need to synchronize the PTP
    hardware clock to the system clock with <code class="command">phc2sys</code>:
   </p><div class="verbatim-wrap"><pre class="screen">phc2sys -c eth0 -s CLOCK_REALTIME -w</pre></div></section><section class="sect2" id="tuning-ptp-ptp2ntp" data-id-title="PTP to NTP Synchronization"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.5.2 </span><span class="title-name">PTP to NTP Synchronization</span></span> <a title="Permalink" class="permalink" href="cha-tuning-ptp.html#tuning-ptp-ptp2ntp">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP4/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can configure <code class="systemitem">ntpd</code> to distribute the time
    from the system clock synchronized by <code class="command">ptp4l</code> or
    <code class="command">phc2sys</code> by using the <span class="emphasis"><em>local</em></span>
    reference clock driver. Moreover, you need to stop
    <code class="systemitem">ntpd</code> from adjusting the system clock—do
    not specify any remote NTP servers in
    <code class="filename">/etc/ntp.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">server   127.127.1.0
fudge    127.127.1.0 stratum 0</pre></div><div id="id-1.8.9.2.9.4.4" data-id-title="NTP and DHCP" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: NTP and DHCP</div><p>
     When the DHCP client command <code class="command">dhclient</code> receives a
     list of NTP servers, it adds them to NTP configuration by default. To
     prevent this behavior, set
    </p><div class="verbatim-wrap"><pre class="screen">NETCONFIG_NTP_POLICY=""</pre></div><p>
     in the <code class="filename">/etc/sysconfig/network/config</code> file.
    </p></div></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="part-tuning-ptp.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Part VII </span>Synchronized Clocks with Precision Time Protocol</span></a> </div><div><a class="pagination-link next" href="app-tuning-docupdates.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Appendix A </span>Documentation Updates</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-tuning-ptp.html#tuning-ptp-intro"><span class="title-number">19.1 </span><span class="title-name">Introduction to PTP</span></a></span></li><li><span class="sect1"><a href="cha-tuning-ptp.html#tuning-ptp-using"><span class="title-number">19.2 </span><span class="title-name">Using PTP</span></a></span></li><li><span class="sect1"><a href="cha-tuning-ptp.html#tuning-ptp-phc2sys"><span class="title-number">19.3 </span><span class="title-name">Synchronizing the Clocks with <code class="command">phc2sys</code></span></a></span></li><li><span class="sect1"><a href="cha-tuning-ptp.html#tuning-ptp-examples"><span class="title-number">19.4 </span><span class="title-name">Examples of Configurations</span></a></span></li><li><span class="sect1"><a href="cha-tuning-ptp.html#tuning-ptp-ntp"><span class="title-number">19.5 </span><span class="title-name">PTP and NTP</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>