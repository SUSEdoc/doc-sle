<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><title>SLED 15 SP6 | System Analysis and Tuning Guide</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="System Analysis and Tuning Guide | SLED 15 SP6"/>
<meta name="description" content="How to detect and resolve problems on SLED and optimize system performance"/>
<meta name="product-name" content="SUSE Linux Enterprise Desktop"/>
<meta name="product-number" content="15 SP6"/>
<meta name="book-title" content="System Analysis and Tuning Guide"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Desktop 15 SP6"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="System Analysis and Tuning Guide"/>
<meta property="og:description" content="Analyze and tune SLED systems"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="System Analysis and Tuning Guide"/>
<meta name="twitter:description" content="Analyze and tune SLED systems"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "System Analysis and Tuning Guide",
  
    "description": "How to detect and resolve problems on SLED and optimize system performance",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-06-26T00:00+02:00",
      
    "datePublished": "2024-06-26T00:00+02:00",
      

    "about": [
      {
        "@type": "Thing",
        "name": "Administration"
      },
      {
        "@type": "Thing",
        "name": "Configuration"
      },
      {
        "@type": "Thing",
        "name": "Monitoring"
      }
    ],
  
    "mentions": [
      
      { "@type": "SoftwareApplication",
        "name": "SUSE Linux Enterprise Desktop",
        "softwareVersion": "15 SP6",
        "applicationCategory": "Operating System",
        "operatingSystem": "Linux"
      }
      
    ],
    
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/book_tuning.xml"/></head><body class="draft single normal offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="#book-tuning">System Analysis and Tuning Guide</a></div></div><main id="_content"><nav class="side-toc placebo" id="_side-toc-overall"> </nav><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section xml:lang="en" class="book" id="book-tuning" data-id-title="System Analysis and Tuning Guide"><div class="titlepage"><div><div class="big-version-info"><span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP6</span></span></span></div><div class="title-container"><h1 class="title">System Analysis and Tuning Guide</h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_tuning.xml" title="Edit source document"> </a></div></div><div class="abstract"><p> This guide supports administrators in problem detection,
     resolution and optimization. </p></div><div><div class="titlepage-revhistory"><a aria-label="Revision History" hreflang="en" href="rh-book-tuning.html" target="_blank">Revision History: System Analysis and Tuning Guide</a></div></div><div class="date"><span class="imprint-label">Publication Date: </span>October 04, 2024
</div></div></div><div class="toc"><ul><li><span class="preface"><a href="#preface-tuning"><span class="title-name">Preface</span></a></span><ul><li><span class="sect1"><a href="#id-1.8.2.3"><span class="title-name">Available documentation</span></a></span></li><li><span class="sect1"><a href="#id-1.8.2.4"><span class="title-name">Improving the documentation</span></a></span></li><li><span class="sect1"><a href="#id-1.8.2.5"><span class="title-name">Documentation conventions</span></a></span></li><li><span class="sect1"><a href="#id-1.8.2.6"><span class="title-name">Support</span></a></span></li></ul></li><li><span class="part"><a href="#part-tuning-basics"><span class="title-number">I </span><span class="title-name">Basics</span></a></span><ul><li><span class="chapter"><a href="#cha-tuning-basics"><span class="title-number">1 </span><span class="title-name">General notes on system tuning</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-basics-what"><span class="title-number">1.1 </span><span class="title-name">Be sure what problem to solve</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-basics-common"><span class="title-number">1.2 </span><span class="title-name">Rule out common problems</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-basics-bottleneck"><span class="title-number">1.3 </span><span class="title-name">Finding the bottleneck</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-basics-tuning"><span class="title-number">1.4 </span><span class="title-name">Step-by-step tuning</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-tuning-monitoring"><span class="title-number">II </span><span class="title-name">System monitoring</span></a></span><ul><li><span class="chapter"><a href="#cha-util"><span class="title-number">2 </span><span class="title-name">System monitoring utilities</span></a></span><ul><li><span class="sect1"><a href="#sec-util-multi"><span class="title-number">2.1 </span><span class="title-name">Multi-purpose tools</span></a></span></li><li><span class="sect1"><a href="#sec-util-system"><span class="title-number">2.2 </span><span class="title-name">System information</span></a></span></li><li><span class="sect1"><a href="#sec-util-processes"><span class="title-number">2.3 </span><span class="title-name">Processes</span></a></span></li><li><span class="sect1"><a href="#sec-util-memory"><span class="title-number">2.4 </span><span class="title-name">Memory</span></a></span></li><li><span class="sect1"><a href="#sec-util-networking"><span class="title-number">2.5 </span><span class="title-name">Networking</span></a></span></li><li><span class="sect1"><a href="#sec-util-proc"><span class="title-number">2.6 </span><span class="title-name">The <code class="filename">/proc</code> file system</span></a></span></li><li><span class="sect1"><a href="#sec-util-hardware"><span class="title-number">2.7 </span><span class="title-name">Hardware information</span></a></span></li><li><span class="sect1"><a href="#sec-util-file"><span class="title-number">2.8 </span><span class="title-name">Files and file systems</span></a></span></li><li><span class="sect1"><a href="#sec-util-user"><span class="title-number">2.9 </span><span class="title-name">User information</span></a></span></li><li><span class="sect1"><a href="#sec-util-time"><span class="title-number">2.10 </span><span class="title-name">Time and date</span></a></span></li><li><span class="sect1"><a href="#sec-util-rrdtool"><span class="title-number">2.11 </span><span class="title-name">Graph your data: RRDtool</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-syslog"><span class="title-number">3 </span><span class="title-name">System log files</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-syslog-logs"><span class="title-number">3.1 </span><span class="title-name">System log files in <code class="filename">/var/log/</code></span></a></span></li><li><span class="sect1"><a href="#sec-tuning-syslog-view"><span class="title-number">3.2 </span><span class="title-name">Viewing and parsing log files</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-syslog-logrotate"><span class="title-number">3.3 </span><span class="title-name">Managing log files with <code class="command">logrotate</code></span></a></span></li><li><span class="sect1"><a href="#sec-tuning-syslog-logwatch"><span class="title-number">3.4 </span><span class="title-name">Monitoring log files with <code class="command">logwatch</code></span></a></span></li><li><span class="sect1"><a href="#sec-tuning-syslog-forward"><span class="title-number">3.5 </span><span class="title-name">Configuring mail forwarding for <code class="systemitem">root</code></span></a></span></li><li><span class="sect1"><a href="#sec-tuning-syslog-server"><span class="title-number">3.6 </span><span class="title-name">Forwarding log messages to a central syslog server</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-syslog-logger"><span class="title-number">3.7 </span><span class="title-name">Using <code class="command">logger</code> to make system log entries</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-tuning-kerneltrace"><span class="title-number">III </span><span class="title-name">Kernel monitoring</span></a></span><ul><li><span class="chapter"><a href="#cha-tuning-systemtap"><span class="title-number">4 </span><span class="title-name">SystemTap—filtering and analyzing system data</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-systemtap-concept"><span class="title-number">4.1 </span><span class="title-name">Conceptual overview</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-systemtap-setup"><span class="title-number">4.2 </span><span class="title-name">Installation and setup</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-systemtap-syntax"><span class="title-number">4.3 </span><span class="title-name">Script syntax</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-systemtap-example"><span class="title-number">4.4 </span><span class="title-name">Example script</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-systemtap-userspace"><span class="title-number">4.5 </span><span class="title-name">User space probing</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-systemtap-more"><span class="title-number">4.6 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-kprobes"><span class="title-number">5 </span><span class="title-name">Kernel probes</span></a></span><ul><li><span class="sect1"><a href="#cha-tuning-kprobes-supparch"><span class="title-number">5.1 </span><span class="title-name">Supported architectures</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kprobes-types"><span class="title-number">5.2 </span><span class="title-name">Types of kernel probes</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kprobes-api"><span class="title-number">5.3 </span><span class="title-name">Kprobes API</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kprobes-debugfs"><span class="title-number">5.4 </span><span class="title-name"><code class="systemitem">debugfs</code> Interface</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kprobes-moreinfo"><span class="title-number">5.5 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-perf"><span class="title-number">6 </span><span class="title-name">Hardware-based performance monitoring with Perf</span></a></span><ul><li><span class="sect1"><a href="#sec-perf-concept"><span class="title-number">6.1 </span><span class="title-name">Hardware-based monitoring</span></a></span></li><li><span class="sect1"><a href="#sec-perf-sample-count"><span class="title-number">6.2 </span><span class="title-name">Sampling and counting</span></a></span></li><li><span class="sect1"><a href="#sec-perf-install"><span class="title-number">6.3 </span><span class="title-name">Installing Perf</span></a></span></li><li><span class="sect1"><a href="#sec-perf-subcommand"><span class="title-number">6.4 </span><span class="title-name">Perf subcommands</span></a></span></li><li><span class="sect1"><a href="#sec-perf-event"><span class="title-number">6.5 </span><span class="title-name">Counting particular types of event</span></a></span></li><li><span class="sect1"><a href="#sec-perf-command"><span class="title-number">6.6 </span><span class="title-name">Recording events specific to particular commands</span></a></span></li><li><span class="sect1"><a href="#sec-perf-more"><span class="title-number">6.7 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-oprofile"><span class="title-number">7 </span><span class="title-name">OProfile—system-wide profiler</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-oprofile-overview"><span class="title-number">7.1 </span><span class="title-name">Conceptual overview</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-oprofile-install"><span class="title-number">7.2 </span><span class="title-name">Installation and requirements</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-oprofile-utils"><span class="title-number">7.3 </span><span class="title-name">Available OProfile utilities</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-oprofile-using"><span class="title-number">7.4 </span><span class="title-name">Using OProfile</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-oprofiles-report"><span class="title-number">7.5 </span><span class="title-name">Generating reports</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-oprofile-moreinfo"><span class="title-number">7.6 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-dynamic-debug"><span class="title-number">8 </span><span class="title-name">Dynamic debug—kernel debugging messages</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-dynamic-debug-benefits"><span class="title-number">8.1 </span><span class="title-name">Benefits of dynamic debugging</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-dynamic-debug-check"><span class="title-number">8.2 </span><span class="title-name">Checking the status of dynamic debug</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-dynamic-debug-use"><span class="title-number">8.3 </span><span class="title-name">Using dynamic debug</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-dynamic-debug-view"><span class="title-number">8.4 </span><span class="title-name">Viewing the dynamic debug messages</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-tuning-resources"><span class="title-number">IV </span><span class="title-name">Resource management</span></a></span><ul><li><span class="chapter"><a href="#cha-tuning-resources"><span class="title-number">9 </span><span class="title-name">General system resource management</span></a></span><ul><li><span class="sect1"><a href="#cha-tuning-resources-installation"><span class="title-number">9.1 </span><span class="title-name">Planning the installation</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-resources-services"><span class="title-number">9.2 </span><span class="title-name">Disabling unnecessary services</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-resources-disk"><span class="title-number">9.3 </span><span class="title-name">File systems and disk access</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-cgroups"><span class="title-number">10 </span><span class="title-name">Kernel control groups</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-cgroups-overview"><span class="title-number">10.1 </span><span class="title-name">Overview</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-cgroups-accounting"><span class="title-number">10.2 </span><span class="title-name">Resource accounting</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-cgroups-usage"><span class="title-number">10.3 </span><span class="title-name">Setting resource limits</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-cgroups-tasksmax"><span class="title-number">10.4 </span><span class="title-name">Preventing fork bombs with <code class="literal">TasksMax</code></span></a></span></li><li><span class="sect1"><a href="#sec-control-io-cgroups"><span class="title-number">10.5 </span><span class="title-name">I/O control with cgroups</span></a></span></li><li><span class="sect1"><a href="#id-1.8.6.3.8"><span class="title-number">10.6 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-numactl"><span class="title-number">11 </span><span class="title-name">Automatic Non-Uniform Memory Access (NUMA) balancing</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-numactl-implementation"><span class="title-number">11.1 </span><span class="title-name">Implementation</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-numactl-configuration"><span class="title-number">11.2 </span><span class="title-name">Configuration</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-numactl-monitoring"><span class="title-number">11.3 </span><span class="title-name">Monitoring</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-numactl-impact"><span class="title-number">11.4 </span><span class="title-name">Impact</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-power"><span class="title-number">12 </span><span class="title-name">Power management</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-power-cpu"><span class="title-number">12.1 </span><span class="title-name">Power management at CPU Level</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-power-governors"><span class="title-number">12.2 </span><span class="title-name">In-kernel governors</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-power-tools-cpupower"><span class="title-number">12.3 </span><span class="title-name">The <code class="systemitem">cpupower</code> tools</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-power-options"><span class="title-number">12.4 </span><span class="title-name">Special tuning options</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-power-trouble"><span class="title-number">12.5 </span><span class="title-name">Troubleshooting</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-power-more"><span class="title-number">12.6 </span><span class="title-name">More information</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-power-tools-powertop"><span class="title-number">12.7 </span><span class="title-name">Monitoring power consumption with powerTOP</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-tuning-kernel"><span class="title-number">V </span><span class="title-name">Kernel tuning</span></a></span><ul><li><span class="chapter"><a href="#cha-tuning-io"><span class="title-number">13 </span><span class="title-name">Tuning I/O performance</span></a></span><ul><li><span class="sect1"><a href="#cha-tuning-io-switch"><span class="title-number">13.1 </span><span class="title-name">Switching I/O scheduling</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-io-schedulers-blkmq"><span class="title-number">13.2 </span><span class="title-name">Available I/O elevators with blk-mq I/O path</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-io-barrier"><span class="title-number">13.3 </span><span class="title-name">I/O barrier tuning</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-taskscheduler"><span class="title-number">14 </span><span class="title-name">Tuning the task scheduler</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-taskscheduler-intro"><span class="title-number">14.1 </span><span class="title-name">Introduction</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-taskscheduler-policy-class"><span class="title-number">14.2 </span><span class="title-name">Process classification</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-taskscheduler-cfs"><span class="title-number">14.3 </span><span class="title-name">Completely Fair Scheduler</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-taskscheduler-moreinfo"><span class="title-number">14.4 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-memory"><span class="title-number">15 </span><span class="title-name">Tuning the memory management subsystem</span></a></span><ul><li><span class="sect1"><a href="#cha-tuning-memory-usage"><span class="title-number">15.1 </span><span class="title-name">Memory usage</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-memory-optimize"><span class="title-number">15.2 </span><span class="title-name">Reducing memory usage</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-memory-vm"><span class="title-number">15.3 </span><span class="title-name">Virtual memory manager (VM) tunable parameters</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-memory-monitoring"><span class="title-number">15.4 </span><span class="title-name">Monitoring VM behavior</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-network"><span class="title-number">16 </span><span class="title-name">Tuning the network</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-network-buffers"><span class="title-number">16.1 </span><span class="title-name">Configurable kernel socket buffers</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-network-analyzing"><span class="title-number">16.2 </span><span class="title-name">Detecting network bottlenecks and analyzing network traffic</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-network-netfilter"><span class="title-number">16.3 </span><span class="title-name">Netfilter</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-network-rps"><span class="title-number">16.4 </span><span class="title-name">Improving the network performance with receive packet steering (RPS)</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-tuning-dumps"><span class="title-number">VI </span><span class="title-name">Handling system dumps</span></a></span><ul><li><span class="chapter"><a href="#cha-tuning-tracing"><span class="title-number">17 </span><span class="title-name">Tracing tools</span></a></span><ul><li><span class="sect1"><a href="#sec-tuning-tracing-strace"><span class="title-number">17.1 </span><span class="title-name">Tracing system calls with strace</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-tracing-ltrace"><span class="title-number">17.2 </span><span class="title-name">Tracing library calls with ltrace</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-tracing-valgrind"><span class="title-number">17.3 </span><span class="title-name">Debugging and profiling with Valgrind</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-tracing-valgrind-moreinfo"><span class="title-number">17.4 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-kexec"><span class="title-number">18 </span><span class="title-name">Kexec and Kdump</span></a></span><ul><li><span class="sect1"><a href="#cha-tuning-kexec-intro"><span class="title-number">18.1 </span><span class="title-name">Introduction</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kexec-pkgs"><span class="title-number">18.2 </span><span class="title-name">Required packages</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kexec-internals"><span class="title-number">18.3 </span><span class="title-name">Kexec internals</span></a></span></li><li><span class="sect1"><a href="#sec-tuning-kexec-crashkernel"><span class="title-number">18.4 </span><span class="title-name">Calculating <code class="option">crashkernel</code> allocation size</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kexec-basic-usage"><span class="title-number">18.5 </span><span class="title-name">Basic Kexec usage</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kexec-config"><span class="title-number">18.6 </span><span class="title-name">How to configure Kexec for routine reboots</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kdump-basic"><span class="title-number">18.7 </span><span class="title-name">Basic Kdump configuration</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kdump-analyze"><span class="title-number">18.8 </span><span class="title-name">Analyzing the crash dump</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kdump-advanced"><span class="title-number">18.9 </span><span class="title-name">Advanced Kdump configuration</span></a></span></li><li><span class="sect1"><a href="#cha-tuning-kdump-moreinfo"><span class="title-number">18.10 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-tuning-systemd-coredump"><span class="title-number">19 </span><span class="title-name">Using <code class="systemitem">systemd-coredump</code> to debug application crashes</span></a></span><ul><li><span class="sect1"><a href="#sect-sys-coredump-default"><span class="title-number">19.1 </span><span class="title-name">Use and configuration</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-tuning-ptp"><span class="title-number">VII </span><span class="title-name">Synchronized clocks with Precision Time Protocol</span></a></span><ul><li><span class="chapter"><a href="#cha-tuning-ptp"><span class="title-number">20 </span><span class="title-name">Precision Time Protocol</span></a></span><ul><li><span class="sect1"><a href="#tuning-ptp-intro"><span class="title-number">20.1 </span><span class="title-name">Introduction to PTP</span></a></span></li><li><span class="sect1"><a href="#tuning-ptp-using"><span class="title-number">20.2 </span><span class="title-name">Using PTP</span></a></span></li><li><span class="sect1"><a href="#tuning-ptp-phc2sys"><span class="title-number">20.3 </span><span class="title-name">Synchronizing the clocks with <code class="command">phc2sys</code></span></a></span></li><li><span class="sect1"><a href="#tuning-ptp-examples"><span class="title-number">20.4 </span><span class="title-name">Examples of configurations</span></a></span></li><li><span class="sect1"><a href="#tuning-ptp-ntp"><span class="title-number">20.5 </span><span class="title-name">PTP and NTP</span></a></span></li></ul></li></ul></li><li><span class="appendix"><a href="#id-1.8.10"><span class="title-number">A </span><span class="title-name">GNU licenses</span></a></span><ul><li><span class="sect1"><a href="#id-1.8.10.4"><span class="title-number">A.1 </span><span class="title-name">GNU Free Documentation License</span></a></span></li></ul></li></ul></div><div class="list-of-figures"><div class="toc-title">List of Figures</div><ul><li><span class="figure"><a href="#util-rrdtool-example-create-graph1"><span class="number">2.1 </span><span class="name">Example graph created with RRDtool</span></a></span></li><li><span class="figure"><a href="#fig-powertop-curses"><span class="number">12.1 </span><span class="name">powerTOP in interactive mode</span></a></span></li><li><span class="figure"><a href="#fig-powertop-html"><span class="number">12.2 </span><span class="name">HTML powerTOP report</span></a></span></li><li><span class="figure"><a href="#fig-tuning-kdump-basic-yast-kdump1"><span class="number">18.1 </span><span class="name">YaST Kdump module: start-up page</span></a></span></li></ul></div><div class="list-of-tables"><div class="toc-title">List of Tables</div><ul><li><span class="table"><a href="#id-1.8.4.2.11.5.5"><span class="number">2.1 </span><span class="name">List of query options of <code class="command">ethtool</code></span></a></span></li><li><span class="table"><a href="#tab-tuning-power-cstates"><span class="number">12.1 </span><span class="name">C-states</span></a></span></li><li><span class="table"><a href="#tab-tunables-mq-deadline"><span class="number">13.1 </span><span class="name"><code class="systemitem">MQ-DEADLINE</code> tunable parameters</span></a></span></li><li><span class="table"><a href="#tab-tunables-bfq"><span class="number">13.2 </span><span class="name"><code class="systemitem">BFQ</code> tunable parameters</span></a></span></li><li><span class="table"><a href="#tab-tunables-kyber"><span class="number">13.3 </span><span class="name"><code class="systemitem">KYBER</code> tunable parameters</span></a></span></li></ul></div><div class="list-of-examples"><div class="toc-title">List of Examples</div><ul><li><span class="example"><a href="#id-1.8.4.2.7.3.5"><span class="number">2.1 </span><span class="name"><code class="command">vmstat</code> output on a lightly used machine</span></a></span></li><li><span class="example"><a href="#id-1.8.4.2.7.3.6"><span class="number">2.2 </span><span class="name"><code class="command">vmstat</code> output on a heavily used machine (CPU bound)</span></a></span></li><li><span class="example"><a href="#ex-tuning-syslog-logrotate-config"><span class="number">3.1 </span><span class="name">Example for <code class="filename">/etc/logrotate.conf</code></span></a></span></li><li><span class="example"><a href="#ex-tuning-stap-simple"><span class="number">4.1 </span><span class="name">Simple SystemTap script</span></a></span></li><li><span class="example"><a href="#ex-tuning-stap-async"><span class="number">4.2 </span><span class="name">Probe with timer event</span></a></span></li><li><span class="example"><a href="#ex-tuning-stap-printf-formatspec"><span class="number">4.3 </span><span class="name"><code class="literal">printf</code> Function with format specifiers</span></a></span></li><li><span class="example"><a href="#id-1.8.5.2.6.8.4.3.6"><span class="number">4.4 </span><span class="name">Using global variables</span></a></span></li><li><span class="example"><a href="#id-1.8.5.2.7.4"><span class="number">4.5 </span><span class="name">Monitoring incoming TCP connections with <code class="literal">tcp_connections.stp</code></span></a></span></li><li><span class="example"><a href="#id-1.8.6.5.5.4.3"><span class="number">12.1 </span><span class="name">Example output of <code class="command">cpupower frequency-info</code></span></a></span></li><li><span class="example"><a href="#id-1.8.6.5.5.5.3"><span class="number">12.2 </span><span class="name">Example output of <code class="command">cpupower idle-info</code></span></a></span></li><li><span class="example"><a href="#ex-cpupower-monitor"><span class="number">12.3 </span><span class="name">Example <code class="command">cpupower monitor</code> output</span></a></span></li><li><span class="example"><a href="#id-1.8.9.2.8.3"><span class="number">20.1 </span><span class="name">Slave clock using software time stamping</span></a></span></li><li><span class="example"><a href="#id-1.8.9.2.8.4"><span class="number">20.2 </span><span class="name">Slave clock using hardware time stamping</span></a></span></li><li><span class="example"><a href="#id-1.8.9.2.8.5"><span class="number">20.3 </span><span class="name">Master clock using hardware time stamping</span></a></span></li><li><span class="example"><a href="#id-1.8.9.2.8.6"><span class="number">20.4 </span><span class="name">Master clock using software time stamping (not generally recommended)</span></a></span></li></ul></div><div><div xml:lang="en" class="legalnotice" id="id-1.8.1.5"><p>
  Copyright © 2006–2024

  SUSE LLC and contributors. All rights reserved.
 </p><p>
  Permission is granted to copy, distribute and/or modify this document under
  the terms of the GNU Free Documentation License, Version 1.2 or (at your
  option) version 1.3; with the Invariant Section being this copyright notice
  and license. A copy of the license version 1.2 is included in the section
  entitled <span class="quote">“<span class="quote">GNU Free Documentation License</span>”</span>.
 </p><p>
  For SUSE trademarks, see
  <a class="link" href="https://www.suse.com/company/legal/" target="_blank">https://www.suse.com/company/legal/</a>. All
  third-party trademarks are the property of their respective owners. Trademark
  symbols (®, ™ etc.) denote trademarks of SUSE and its affiliates.
  Asterisks (*) denote third-party trademarks.
 </p><p>
  All information found in this book has been compiled with utmost attention to
  detail. However, this does not guarantee complete accuracy. Neither
  SUSE LLC, its affiliates, the authors nor the translators shall be
  held liable for possible errors or the consequences thereof.
 </p></div></div><section class="preface" id="preface-tuning" data-id-title="Preface"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number"> </span><span class="title-name">Preface</span></span> <a title="Permalink" class="permalink" href="#preface-tuning">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_intro.xml" title="Edit source document"> </a></div></div></div></div></div><section xml:lang="en" class="sect1" id="id-1.8.2.3" data-id-title="Available documentation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1 </span><span class="title-name">Available documentation</span></span> <a title="Permalink" class="permalink" href="#id-1.8.2.3">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_available_doc.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.2.3.3.1"><span class="term">Online documentation</span></dt><dd><p>
     Our documentation is available online at <a class="link" href="https://documentation.suse.com" target="_blank">https://documentation.suse.com</a>.
     Browse or download the documentation in various formats.
    </p><div id="id-1.8.2.3.3.1.2.2" data-id-title="Latest updates" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Latest updates</div><p>
      The latest updates are usually available in the English-language version of this documentation.
     </p></div></dd><dt id="id-1.8.2.3.3.2"><span class="term">SUSE Knowledgebase</span></dt><dd><p>
     If you run into an issue, check out the Technical Information
     Documents (TIDs) that are available online at <a class="link" href="https://www.suse.com/support/kb/" target="_blank">https://www.suse.com/support/kb/</a>.
     Search the SUSE Knowledgebase for known solutions driven by customer need.
     </p></dd><dt id="id-1.8.2.3.3.3"><span class="term">Release notes</span></dt><dd><p>
     For release notes, see
     <a class="link" href="https://www.suse.com/releasenotes/" target="_blank">https://www.suse.com/releasenotes/</a>.
    </p></dd><dt id="id-1.8.2.3.3.4"><span class="term">In your system</span></dt><dd><p>
      For offline use, the release notes are also available under
      <code class="filename">/usr/share/doc/release-notes</code> on your system.
      The documentation for individual packages is available at
      <code class="filename">/usr/share/doc/packages</code>.
    </p><p>
      Many commands are also described in their <span class="emphasis"><em>manual
      pages</em></span>. To view them, run <code class="command">man</code>, followed
      by a specific command name. If the <code class="command">man</code> command is
      not installed on your system, install it with <code class="command">sudo zypper
      install man</code>.
    </p></dd></dl></div></section><section xml:lang="en" class="sect1" id="id-1.8.2.4" data-id-title="Improving the documentation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2 </span><span class="title-name">Improving the documentation</span></span> <a title="Permalink" class="permalink" href="#id-1.8.2.4">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_feedback.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Your feedback and contributions to this documentation are welcome.
  The following channels for giving feedback are available:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.2.4.4.1"><span class="term">Service requests and support</span></dt><dd><p>
     For services and support options available for your product, see
     <a class="link" href="https://www.suse.com/support/" target="_blank">https://www.suse.com/support/</a>.
    </p><p>
     To open a service request, you need a SUSE subscription registered at
     SUSE Customer Center.
     Go to <a class="link" href="https://scc.suse.com/support/requests" target="_blank">https://scc.suse.com/support/requests</a>, log
     in, and click <span class="guimenu">Create New</span>.
    </p></dd><dt id="id-1.8.2.4.4.2"><span class="term">Bug reports</span></dt><dd><p>
     Report issues with the documentation at <a class="link" href="https://bugzilla.suse.com/" target="_blank">https://bugzilla.suse.com/</a>.
    </p><p>
     To simplify this process, click the <span class="guimenu">Report
     an issue</span> icon next to a headline in the HTML
     version of this document. This preselects the right product and
     category in Bugzilla and adds a link to the current section.
     You can start typing your bug report right away.
    </p><p>
     A Bugzilla account is required.
    </p></dd><dt id="id-1.8.2.4.4.3"><span class="term">Contributions</span></dt><dd><p>
     To contribute to this documentation, click the <span class="guimenu">Edit source
     document</span> icon next to a headline in the HTML version of
     this document. This will take you to the source code on GitHub, where you
     can open a pull request.</p><p>
     A GitHub account is required.
    </p><div id="id-1.8.2.4.4.3.2.3" data-id-title="Edit source document only available for English" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <span class="guimenu">Edit source document</span> only available for English</div><p>
      The <span class="guimenu">Edit source document</span> icons are only available for the
      English version of each document. For all other languages, use the
      <span class="guimenu">Report an issue</span> icons instead.
     </p></div><p>
     For more information about the documentation environment used for this
     documentation, see the repository's README.
    </p></dd><dt id="id-1.8.2.4.4.4"><span class="term">Mail</span></dt><dd><p>
     You can also report errors and send feedback concerning the
     documentation to &lt;<a class="email" href="mailto:doc-team@suse.com">doc-team@suse.com</a>&gt;. Include the
     document title, the product version, and the publication date of the
     document. Additionally, include the relevant section number and title (or
     provide the URL) and provide a concise description of the problem.
    </p></dd></dl></div></section><section xml:lang="en" class="sect1" id="id-1.8.2.5" data-id-title="Documentation conventions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3 </span><span class="title-name">Documentation conventions</span></span> <a title="Permalink" class="permalink" href="#id-1.8.2.5">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_convention.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following notices and typographic conventions are used in this
  document:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    <code class="filename">/etc/passwd</code>: Directory names and file names
   </p></li><li class="listitem"><p>
    <em class="replaceable">PLACEHOLDER</em>: Replace
    <em class="replaceable">PLACEHOLDER</em> with the actual value
   </p></li><li class="listitem"><p>
    <code class="envar">PATH</code>: An environment variable
   </p></li><li class="listitem"><p>
    <code class="command">ls</code>, <code class="option">--help</code>: Commands, options, and
    parameters
   </p></li><li class="listitem"><p>
    <code class="systemitem">user</code>: The name of a user or group
   </p></li><li class="listitem"><p>
    <span class="package">package_name</span>: The name of a software package
   </p></li><li class="listitem"><p>
    <span class="keycap">Alt</span>, <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F1</span>: A key to press or a key combination. Keys
    are shown in uppercase as on a keyboard.
   </p></li><li class="listitem"><p>
    <span class="guimenu">File</span>, <span class="guimenu">File</span> › <span class="guimenu">Save
    As</span>: menu items, buttons
   </p></li><li class="listitem"><p>
    <em class="citetitle">Chapter 1, <span class="quote">“<span class="quote">Example chapter</span>”</span></em>:
    A cross-reference to another chapter in this guide.
   </p></li><li class="listitem"><p>
    Commands that must be run with <code class="systemitem">root</code> privileges. You can also
    prefix these commands with the <code class="command">sudo</code> command to run them
    as a non-privileged user:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">command</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">command</code></pre></div></li><li class="listitem"><p>
    Commands that can be run by non-privileged users:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">command</code></pre></div></li><li class="listitem"><p>
    Commands can be split into two or multiple lines by a backslash character
    (<code class="literal">\</code>) at the end of a line. The backslash informs the shell that
    the command invocation will continue after the end of the line:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">echo</code> a b \
c d</pre></div></li><li class="listitem"><p>
     A code block that shows both the command (preceded by a prompt)
     and the respective output returned by the shell:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">command</code>
output</pre></div></li><li class="listitem"><p>
    Notices
   </p><div id="id-1.8.2.5.4.14.2" data-id-title="Warning notice" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Warning notice</div><p>
     Vital information you must be aware of before proceeding. Warns you about
     security issues, potential loss of data, damage to hardware, or physical
     hazards.
    </p></div><div id="id-1.8.2.5.4.14.3" data-id-title="Important notice" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Important notice</div><p>
     Important information you should be aware of before proceeding.
    </p></div><div id="id-1.8.2.5.4.14.4" data-id-title="Note notice" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Note notice</div><p>
     Additional information, for example about differences in software
     versions.
    </p></div><div id="id-1.8.2.5.4.14.5" data-id-title="Tip notice" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Tip notice</div><p>
     Helpful information, like a guideline or a piece of practical advice.
    </p></div></li><li class="listitem"><p>
    Compact Notices
   </p><div id="id-1.8.2.5.4.15.2" class="admonition note compact"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><p>
     Additional information, for example about differences in software
     versions.
    </p></div><div id="id-1.8.2.5.4.15.3" class="admonition tip compact"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><p>
     Helpful information, like a guideline or a piece of practical advice.
    </p></div></li></ul></div></section><section xml:lang="en" class="sect1" id="id-1.8.2.6" data-id-title="Support"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4 </span><span class="title-name">Support</span></span> <a title="Permalink" class="permalink" href="#id-1.8.2.6">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Find the support statement for <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> and general information about
  technology previews below.
  For details about the product lifecycle, see
  <a class="link" href="https://www.suse.com/lifecycle" target="_blank">https://www.suse.com/lifecycle</a>.
  
  
 </p><p>
  If you are entitled to support, find details on how to collect information
  for a support ticket at
  <a class="link" href="https://documentation.suse.com/sles-15/html/SLES-all/cha-adm-support.html" target="_blank">https://documentation.suse.com/sles-15/html/SLES-all/cha-adm-support.html</a>.
 </p><section class="sect2" id="id-1.8.2.6.5" data-id-title="Support statement for SUSE Linux Enterprise Desktop"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1 </span><span class="title-name">Support statement for <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span></span> <a title="Permalink" class="permalink" href="#id-1.8.2.6.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To receive support, you need an appropriate subscription with SUSE.
   To view the specific support offers available to you, go to
   <a class="link" href="https://www.suse.com/support/" target="_blank">https://www.suse.com/support/</a> and select your product.
  </p><p>
   The support levels are defined as follows:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.2.6.5.4.1"><span class="term">L1</span></dt><dd><p>
      Problem determination, which means technical support designed to provide
      compatibility information, usage support, ongoing maintenance,
      information gathering and basic troubleshooting using available
      documentation.
     </p></dd><dt id="id-1.8.2.6.5.4.2"><span class="term">L2</span></dt><dd><p>
      Problem isolation, which means technical support designed to analyze
      data, reproduce customer problems, isolate a problem area and provide a
      resolution for problems not resolved by Level 1 or prepare for
      Level 3.
     </p></dd><dt id="id-1.8.2.6.5.4.3"><span class="term">L3</span></dt><dd><p>
      Problem resolution, which means technical support designed to resolve
      problems by engaging engineering to resolve product defects which have
      been identified by Level 2 Support.
     </p></dd></dl></div><p>
   For contracted customers and partners, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> is delivered with L3
   support for all packages, except for the following:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Technology previews.
    </p></li><li class="listitem"><p>
     Sound, graphics, fonts, and artwork.
    </p></li><li class="listitem"><p>
     Packages that require an additional customer contract.
    </p></li><li class="listitem"><p>
     Packages with names ending in <span class="package">-devel</span> (containing header
     files and similar developer resources) will only be supported together
     with their main packages.
    </p></li></ul></div><p>
   SUSE will only support the usage of original packages.
   That is, packages that are unchanged and not recompiled.
  </p></section><section class="sect2" id="id-1.8.2.6.6" data-id-title="Technology previews"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.2 </span><span class="title-name">Technology previews</span></span> <a title="Permalink" class="permalink" href="#id-1.8.2.6.6">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Technology previews are packages, stacks, or features delivered by SUSE
   to provide glimpses into upcoming innovations.
   Technology previews are included for your convenience to give you a chance
   to test new technologies within your environment.
   We would appreciate your feedback.
   If you test a technology preview, please contact your SUSE representative
   and let them know about your experience and use cases.
   Your input is helpful for future development.
  </p><p>
   Technology previews have the following limitations:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Technology previews are still in development.
     Therefore, they may be functionally incomplete, unstable, or otherwise
     <span class="emphasis"><em>not</em></span> suitable for production use.
    </p></li><li class="listitem"><p>
     Technology previews are <span class="emphasis"><em>not</em></span> supported.
    </p></li><li class="listitem"><p>
     Technology previews may only be available for specific hardware
     architectures.
    </p></li><li class="listitem"><p>
     Details and functionality of technology previews are subject to change.
     As a result, upgrading to subsequent releases of a technology preview may
     be impossible and require a fresh installation.
    </p></li><li class="listitem"><p>
     SUSE may discover that a preview does not meet customer or market needs,
     or does not comply with enterprise standards.
     Technology previews can be removed from a product at any time.
     SUSE does not commit to providing a supported version of such
     technologies in the future.
    </p></li></ul></div><p>
   For an overview of technology previews shipped with your product, see the
   release notes at <a class="link" href="https://www.suse.com/releasenotes" target="_blank">https://www.suse.com/releasenotes</a>.
  </p></section></section></section><div class="part" id="part-tuning-basics" data-id-title="Basics"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part I </span><span class="title-name">Basics </span></span><a title="Permalink" class="permalink" href="#part-tuning-basics">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_tuning.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-tuning-basics"><span class="title-number">1 </span><span class="title-name">General notes on system tuning</span></a></span></li><dd class="toc-abstract"><p>
    This manual discusses how to find the reasons for performance problems
    and provides means to solve these problems. Before you start tuning your
    system, you should make sure you have ruled out common problems and have
    found the cause for the problem. You should also have a detailed plan on
    how to tune the system, because applying random tuning tips does
    not help and could make things worse.
   </p></dd></ul></div><section class="chapter" id="cha-tuning-basics" data-id-title="General notes on system tuning"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">1 </span><span class="title-name">General notes on system tuning</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-basics">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_how.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    This manual discusses how to find the reasons for performance problems
    and provides means to solve these problems. Before you start tuning your
    system, you should make sure you have ruled out common problems and have
    found the cause for the problem. You should also have a detailed plan on
    how to tune the system, because applying random tuning tips does
    not help and could make things worse.
   </p></div></div></div></div><div class="procedure" id="id-1.8.3.2.3" data-id-title="General approach when tuning a system"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 1.1: </span><span class="title-name">General approach when tuning a system </span></span><a title="Permalink" class="permalink" href="#id-1.8.3.2.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_how.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
    Specify the problem that needs to be solved.
   </p></li><li class="step"><p>
    In case the degradation is new, identify any recent changes to the
    system.
   </p></li><li class="step" id="st-tuning-basics-whyproblem"><p>
    Identify why the issue is considered a performance problem.
   </p></li><li class="step"><p>
    Specify a metric that can be used to analyze performance. This metric
    could for example be latency, throughput, the maximum number of
    users that are simultaneously logged in, or the maximum number of active users.
   </p></li><li class="step"><p>
    Measure current performance using the metric from the previous step.
   </p></li><li class="step"><p>
    Identify the subsystems where the application is spending the most
    time.
   </p></li><li class="step"><ol type="a" class="substeps"><li class="step"><p>
      Monitor the system and/or the application.
     </p></li><li class="step"><p>
      Analyze the data, categorize where time is being spent.
     </p></li></ol></li><li class="step"><p>
    Tune the subsystem identified in the previous step.
   </p></li><li class="step"><p>
    Remeasure the current performance without monitoring using the same
    metric as before.
   </p></li><li class="step"><p>
    If performance is still not acceptable, start over with
    <a class="xref" href="#st-tuning-basics-whyproblem" title="Step 3">Step 3</a>.
   </p></li></ol></div></div><section class="sect1" id="sec-tuning-basics-what" data-id-title="Be sure what problem to solve"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.1 </span><span class="title-name">Be sure what problem to solve</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-basics-what">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_how.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Before starting to tuning a system, try to describe the problem as
   exactly as possible. A statement like <span class="quote">“<span class="quote">The system is slow!</span>”</span>
   is not a helpful problem description. For example, it could make a
   difference whether the system speed needs to be generally improved, or
   only at peak times.
  </p><p>
   Furthermore, make sure you can apply a measurement to your problem,
   otherwise you cannot verify if the tuning was a success or
   not. You should always be able to compare <span class="quote">“<span class="quote">before</span>”</span> and
   <span class="quote">“<span class="quote">after</span>”</span>. Which metrics to use depends on the scenario or
   application you are looking into. For example, relevant Web server metrics could be expressed in
   terms of the following:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.3.2.4.4.1"><span class="term">Latency</span></dt><dd><p>
      The time to deliver a page
     </p></dd><dt id="id-1.8.3.2.4.4.2"><span class="term">Throughput</span></dt><dd><p>
      Number of pages served per second or megabytes transferred per second
     </p></dd><dt id="id-1.8.3.2.4.4.3"><span class="term">Active users</span></dt><dd><p>
      The maximum number of users that can download pages while still
      receiving pages within an acceptable latency
     </p></dd></dl></div></section><section class="sect1" id="sec-tuning-basics-common" data-id-title="Rule out common problems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.2 </span><span class="title-name">Rule out common problems</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-basics-common">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_how.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A performance problem often is caused by network or hardware problems,
   bugs or configuration issues. Make sure to rule out problems such as the
   ones listed below before attempting to tune your system:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Check the output of the <code class="systemitem">systemd</code> journal (see
     <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: query the <code class="systemitem">systemd</code> journal”</span>) for unusual entries.
    </p></li><li class="listitem"><p>
     Check (using <code class="command">top</code> or <code class="command">ps</code>) whether a
     certain process misbehaves by eating up unusual amounts of CPU time or
     memory.
    </p></li><li class="listitem"><p>
     Check for network problems by inspecting
     <code class="filename">/proc/net/dev</code>.
    </p></li><li class="listitem"><p>
     In case of I/O problems with physical disks, make sure it is not caused
     by hardware problems (check the disk with the
     <code class="systemitem">smartmontools</code>) or by a full disk.
    </p></li><li class="listitem"><p>
     Ensure that background jobs are scheduled to be carried out in times
     the server load is low. Those jobs should also run with low priority
     (set via <code class="command">nice</code>).
    </p></li><li class="listitem"><p>
     If the machine runs several services using the same resources, consider
     moving services to another server.
    </p></li><li class="listitem"><p>
     Last, make sure your software is up-to-date.
    </p></li></ul></div></section><section class="sect1" id="sec-tuning-basics-bottleneck" data-id-title="Finding the bottleneck"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.3 </span><span class="title-name">Finding the bottleneck</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-basics-bottleneck">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_how.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Finding the bottleneck is the hardest part when tuning a
   system. <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> offers many tools to help you with this task.
   See <a class="xref" href="#part-tuning-monitoring" title="Part II. System monitoring">Part II, “System monitoring”</a> for detailed information on
   general system monitoring applications and log file analysis. If the
   problem requires a long-time in-depth analysis, the Linux kernel offers
   means to perform such analysis. See
   <a class="xref" href="#part-tuning-kerneltrace" title="Part III. Kernel monitoring">Part III, “Kernel monitoring”</a> for coverage.
  </p><p>
   Once you have collected the data, it needs to be analyzed. First, inspect
   if the server's hardware (memory, CPU, bus) and its I/O capacities (disk,
   network) are sufficient. If these basic conditions are met, the system
   can benefit from tuning.
  </p></section><section class="sect1" id="sec-tuning-basics-tuning" data-id-title="Step-by-step tuning"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.4 </span><span class="title-name">Step-by-step tuning</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-basics-tuning">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_how.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Make sure to carefully plan the tuning itself. It is of vital importance
   to only do one step at a time. Only by doing so can you
   measure whether the change made an improvement or even had a negative
   impact. Each tuning activity should be measured over a sufficient time
   period to ensure you can do an analysis based on significant
   data. If you cannot measure a positive effect, do not make the change
   permanent. Chances are that it can have a negative effect in the
   future.
  </p></section></section></div><div class="part" id="part-tuning-monitoring" data-id-title="System monitoring"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part II </span><span class="title-name">System monitoring </span></span><a title="Permalink" class="permalink" href="#part-tuning-monitoring">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_tuning.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-util"><span class="title-number">2 </span><span class="title-name">System monitoring utilities</span></a></span></li><dd class="toc-abstract"><p>
    There are programs, tools and utilities which you can use to
    examine the status of your system. This chapter introduces a few of them
    and describes their most important and frequently used parameters.
   </p></dd><li><span class="chapter"><a href="#cha-tuning-syslog"><span class="title-number">3 </span><span class="title-name">System log files</span></a></span></li><dd class="toc-abstract"><p>System log file analysis is one of the most important tasks when analyzing the system. In fact, looking at the system log files should be the first thing to do when maintaining or troubleshooting a system. SUSE Linux Enterprise Desktop automatically logs almost everything that happens on the system …</p></dd></ul></div><section class="chapter" id="cha-util" data-id-title="System monitoring utilities"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">2 </span><span class="title-name">System monitoring utilities</span></span> <a title="Permalink" class="permalink" href="#cha-util">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    There are programs, tools and utilities which you can use to
    examine the status of your system. This chapter introduces a few of them
    and describes their most important and frequently used parameters.
   </p></div></div></div></div><div id="id-1.8.4.2.3" data-id-title="Gathering and Analyzing System Information with supportconfig" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: 
   Gathering and Analyzing System Information with
   <code class="command">supportconfig</code>
  </div><p>
   Apart from the utilities presented in the following, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>
   also contains <code class="command">supportconfig</code>, a tool to create reports
   about the system such as: current kernel version, hardware, installed
   packages, partition setup and much more. These reports are used to
   provide the SUSE support with needed information in case a support
   ticket is created. However, they can also be analyzed for known issues to
   help resolve problems faster. For this purpose, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> provides
   both an appliance and a command line tool for Supportconfig Analysis
   (SCA). See <span class="intraxref">Book “Administration Guide”, Chapter 41 “Gathering system information for support”</span> for details.
  </p></div><p>
  For each of the described commands, examples of the relevant outputs are
  presented. In the examples, the first line is the command itself (after
  the <code class="systemitem">tux</code> &gt; or root #). Omissions are indicated with
  square brackets (<code class="literal">[...]</code>) and long lines are wrapped
  where necessary. Line breaks for long lines are indicated by a backslash
  (<code class="literal">\</code>).
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>command -x -y
output line 1
output line 2
output line 3 is annoyingly long, so long that \
    we need to break it
output line 4
[...]
output line 98
output line 99</pre></div><p>
  The descriptions have been kept short so that we can include as many
  utilities as possible. Further information for all the commands can be
  found in the manual pages. Most of the commands also understand the
  parameter <code class="option">--help</code>, which produces a brief list of possible
  parameters.
 </p><section class="sect1" id="sec-util-multi" data-id-title="Multi-purpose tools"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.1 </span><span class="title-name">Multi-purpose tools</span></span> <a title="Permalink" class="permalink" href="#sec-util-multi">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   While most Linux system monitoring tools monitor only a single aspect of
   the system, there are a few tools with a broader scope. To get
   an overview and find out which part of the system to examine further, use
   these tools first.
  </p><section class="sect2" id="sec-util-multi-vmstat" data-id-title="vmstat"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.1.1 </span><span class="title-name"><code class="command">vmstat</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-multi-vmstat">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    vmstat collects information about processes, memory, I/O, interrupts and
    CPUs:
   </p><div class="verbatim-wrap"><pre class="screen">vmstat [options] [delay [count]]</pre></div><p>
    When called without values for delay and count, it displays average values
    since the last reboot. When called with a value for delay (in seconds), it
    displays values for the given period (two seconds in the examples
    below). The value for count specifies the number of updates vmstat should
    perform. If not specified, it runs until manually stopped.
   </p><div class="example" id="id-1.8.4.2.7.3.5" data-id-title="vmstat output on a lightly used machine"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 2.1: </span><span class="title-name"><code class="command">vmstat</code> output on a lightly used machine </span></span><a title="Permalink" class="permalink" href="#id-1.8.4.2.7.3.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>vmstat 2
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0  44264  81520    424 935736    0    0    12    25   27   34  1  0 98   0  0
 0  0  44264  81552    424 935736    0    0     0     0   38   25  0  0 100  0  0
 0  0  44264  81520    424 935732    0    0     0     0   23   15  0  0 100  0  0
 0  0  44264  81520    424 935732    0    0     0     0   36   24  0  0 100  0  0
 0  0  44264  81552    424 935732    0    0     0     0   51   38  0  0 100  0  0</pre></div></div></div><div class="example" id="id-1.8.4.2.7.3.6" data-id-title="vmstat output on a heavily used machine (CPU bound)"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 2.2: </span><span class="title-name"><code class="command">vmstat</code> output on a heavily used machine (CPU bound) </span></span><a title="Permalink" class="permalink" href="#id-1.8.4.2.7.3.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>vmstat 2
procs -----------memory----------- ---swap-- -----io---- -system-- -----cpu------
 r  b   swpd   free   buff   cache   si   so    bi    bo   in   cs us sy id wa st
32  1  26236 459640 110240 6312648    0    0  9944     2 4552 6597 95  5  0  0  0
23  1  26236 396728 110336 6136224    0    0  9588     0 4468 6273 94  6  0  0  0
35  0  26236 554920 110508 6166508    0    0  7684 27992 4474 4700 95  5  0  0  0
28  0  26236 518184 110516 6039996    0    0 10830     4 4446 4670 94  6  0  0  0
21  5  26236 716468 110684 6074872    0    0  8734 20534 4512 4061 96  4  0  0  0</pre></div></div></div><div id="id-1.8.4.2.7.3.7" data-id-title="First line of output" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: First line of output</div><p>
     The first line of the vmstat output always displays average values
     since the last reboot.
    </p></div><p>
    The columns show the following:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.4.2.7.3.9.1"><span class="term"><span class="guimenu">r</span>
     </span></dt><dd><p>
       Shows the number of processes in a runnable state. These processes
       are either executing or waiting for a free CPU slot. If the number
       of processes in this column is constantly higher than the number of
       CPUs available, this may be an indication of insufficient CPU power.
      </p></dd><dt id="id-1.8.4.2.7.3.9.2"><span class="term"><span class="guimenu">b</span>
     </span></dt><dd><p>
       Shows the number of processes waiting for a resource other than a
       CPU. A high number in this column may indicate an I/O problem
       (network or disk).
      </p></dd><dt id="id-1.8.4.2.7.3.9.3"><span class="term"><span class="guimenu">swpd</span>
     </span></dt><dd><p>
       The amount of swap space (KB) currently used.
      </p></dd><dt id="id-1.8.4.2.7.3.9.4"><span class="term"><span class="guimenu">free</span>
     </span></dt><dd><p>
       The amount of unused memory (KB).
      </p></dd><dt id="id-1.8.4.2.7.3.9.5"><span class="term"><span class="guimenu">inact</span>
     </span></dt><dd><p>
       Recently unused memory that can be reclaimed. This column is only
       visible when calling <code class="command">vmstat</code> with the parameter
       <code class="option">-a</code> (recommended).
      </p></dd><dt id="id-1.8.4.2.7.3.9.6"><span class="term"><span class="guimenu">active</span>
     </span></dt><dd><p>
       Recently used memory that normally does not get reclaimed. This
       column is only visible when calling <code class="command">vmstat</code> with
       the parameter <code class="option">-a</code> (recommended).
      </p></dd><dt id="id-1.8.4.2.7.3.9.7"><span class="term"><span class="guimenu">buff</span>
     </span></dt><dd><p>
       File buffer cache (KB) in RAM that contains file system metadata. This
       column is not visible when calling <code class="command">vmstat</code> with
       the parameter <code class="option">-a</code>.
      </p></dd><dt id="id-1.8.4.2.7.3.9.8"><span class="term"><span class="guimenu">cache</span>
     </span></dt><dd><p>
       Page cache (KB) in RAM with the actual contents of files. This
       column is not visible when calling <code class="command">vmstat</code> with
       the parameter <code class="option">-a</code>.
      </p></dd><dt id="id-1.8.4.2.7.3.9.9"><span class="term"><span class="guimenu">si / so</span>
     </span></dt><dd><p>
       Amount of data (KB) that is moved from swap to RAM
       (<code class="literal">si</code>) or from RAM to swap (<code class="literal">so</code>)
       per second. High <code class="literal">so</code> values over a long period of
       time may indicate that an application is leaking memory and the
       leaked memory is being swapped out. High <code class="literal">si</code> values
       over a long period of time could mean that an application that was
       inactive for a long time is now active again. Combined high
       <code class="literal">si</code> and <code class="literal">so</code> values for prolonged
       periods of time are evidence of swap thrashing and may indicate that
       more RAM needs to be installed in the system because there is not
       enough memory to hold the working set size.
      </p></dd><dt id="id-1.8.4.2.7.3.9.10"><span class="term"><span class="guimenu">bi</span>
     </span></dt><dd><p>
       Number of blocks per second received from a block device (for
       example, a disk read). Swapping also impacts the values
       shown here. The block size may vary between file systems but can
       be determined using the stat utility. If throughput data is
       required then iostat may be used.
      </p></dd><dt id="id-1.8.4.2.7.3.9.11"><span class="term"><span class="guimenu">bo</span>
     </span></dt><dd><p>
       Number of blocks per second sent to a block device (for example, a
       disk write). Swapping also impacts the values shown here.
      </p></dd><dt id="id-1.8.4.2.7.3.9.12"><span class="term"><span class="guimenu">in</span>
     </span></dt><dd><p>
       Interrupts per second. A high value may indicate a high I/O level
       (network and/or disk), but could also be triggered for other reasons
       such as inter-processor interrupts triggered by another activity.
       Make sure to also check <code class="filename">/proc/interrupts</code> to
       identify the source of interrupts.
      </p></dd><dt id="id-1.8.4.2.7.3.9.13"><span class="term"><span class="guimenu">cs</span>
     </span></dt><dd><p>
       Number of context switches per second. This is the number of times
       that the kernel replaces executable code of one program in memory
       with that of another program.
      </p></dd><dt id="id-1.8.4.2.7.3.9.14"><span class="term"><span class="guimenu">us</span>
     </span></dt><dd><p>
       Percentage of CPU usage executing application code.
      </p></dd><dt id="id-1.8.4.2.7.3.9.15"><span class="term"><span class="guimenu">sy</span>
     </span></dt><dd><p>
       Percentage of CPU usage executing kernel code.
      </p></dd><dt id="id-1.8.4.2.7.3.9.16"><span class="term"><span class="guimenu">id</span>
     </span></dt><dd><p>
       Percentage of CPU time spent idling. If this value is zero over a
       longer time, your CPUs are working to full capacity. This
       is not necessarily a bad sign—rather refer to the values in
       columns <span class="guimenu">r</span> and <span class="guimenu">b</span> to determine if
       your machine is equipped with sufficient CPU power.
      </p></dd><dt id="id-1.8.4.2.7.3.9.17"><span class="term"><span class="guimenu">wa</span>
     </span></dt><dd><p>
       If "wa" time is non-zero, it indicates throughput lost because of
       waiting for I/O. This may be inevitable, for example, if a file is
       being read for the first time, background writeback cannot keep up,
       and so on. It can also be an indicator for a hardware bottleneck
       (network or hard disk). Lastly, it can indicate a potential for
       tuning the virtual memory manager (refer to
       <a class="xref" href="#cha-tuning-memory" title="Chapter 15. Tuning the memory management subsystem">Chapter 15, <em>Tuning the memory management subsystem</em></a>).
      </p></dd><dt id="id-1.8.4.2.7.3.9.18"><span class="term"><span class="guimenu">st</span>
     </span></dt><dd><p>
       Percentage of CPU time stolen from a virtual machine.
      </p></dd></dl></div><p>
    See <code class="command">vmstat</code> <code class="option">--help</code> for more options.
   </p></section><section class="sect2" id="sec-util-multi-dstat" data-id-title="dstat"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.1.2 </span><span class="title-name"><code class="command">dstat</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-multi-dstat">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_utilities_dstat.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  <code class="command">dstat</code> is a replacement for tools such as
  <code class="command">vmstat</code>, <code class="command">iostat</code>,
  <code class="command">netstat</code>, or <code class="command">ifstat</code>.
  <code class="command">dstat</code> displays information about the system
  resources in real time. For example, you can compare disk usage
  in combination with interrupts from the IDE controller, or compare
  network bandwidth with the disk throughput (in the same interval).
 </p><p>
  By default, its output is presented in readable tables.
  Alternatively, CSV output can be produced which is suitable as a
  spreadsheet import format.
 </p><p>
  It is written in Python and can be enhanced with plug-ins.
 </p><p>
  This is the general syntax:
 </p><div class="verbatim-wrap"><pre class="screen">dstat [-afv] [<em class="replaceable">OPTIONS</em>..] [<em class="replaceable">DELAY</em> [<em class="replaceable">COUNT</em>]]</pre></div><p>
  All options and parameters are optional.  Without any parameter, dstat
  displays statistics about CPU (<code class="option">-c</code>,
  <code class="option">--cpu</code>), disk (<code class="option">-d</code>,
  <code class="option">--disk</code>), network (<code class="option">-n</code>,
  <code class="option">--net</code>), paging (<code class="option">-g</code>,
  <code class="option">--page</code>), and the interrupts and context switches of
  the system (<code class="option">-y</code>, <code class="option">--sys</code>); it refreshes
  the output every second ad infinitum:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">dstat</code>
You did not select any stats, using -cdngy by default.
----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--
usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw
  0   0 100   0   0   0|  15k   44k|   0     0 |   0    82B| 148   194
  0   0 100   0   0   0|   0     0 |5430B  170B|   0     0 | 163   187
  0   0 100   0   0   0|   0     0 |6363B  842B|   0     0 | 196   185</pre></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.4.2.7.4.9.1"><span class="term"><code class="option">-a</code>, <code class="option">--all</code></span></dt><dd><p>
     equal to <code class="option">-cdngy</code> (default)
    </p></dd><dt id="id-1.8.4.2.7.4.9.2"><span class="term"><code class="option">-f</code>, <code class="option">--full</code></span></dt><dd><p>
     expand <code class="option">-C</code>, <code class="option">-D</code>,
     <code class="option">-I</code>, <code class="option">-N</code> and <code class="option">-S</code>
     discovery lists
    </p></dd><dt id="id-1.8.4.2.7.4.9.3"><span class="term"><code class="option">-v</code>, <code class="option">--vmstat</code></span></dt><dd><p>
     equal to <code class="option">-pmgdsc</code>, <code class="option">-D total</code>
    </p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.4.2.7.4.10.1"><span class="term"><em class="replaceable">DELAY</em></span></dt><dd><p>
     delay in seconds between each update
    </p></dd><dt id="id-1.8.4.2.7.4.10.2"><span class="term"><em class="replaceable">COUNT</em></span></dt><dd><p>
     the number of updates to display before exiting
    </p></dd></dl></div><p>
  The default delay is 1 and the count is unspecified (unlimited).
 </p><p>
  For more information, see the man page of <code class="command">dstat</code> and
  its Web page at <a class="link" href="http://dag.wieers.com/home-made/dstat/" target="_blank">http://dag.wieers.com/home-made/dstat/</a>.
 </p></section><section class="sect2" id="sec-util-multi-sar" data-id-title="System activity information: sar"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.1.3 </span><span class="title-name">System activity information: <code class="command">sar</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-multi-sar">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">sar</code> can generate extensive reports on almost all
    important system activities, among them CPU, memory, IRQ usage, I/O, and
    networking. It can also generate reports in real time.
    The <code class="command">sar</code> command gathers data from the
    <code class="filename">/proc</code> file system.
   </p><div id="id-1.8.4.2.7.5.3" data-id-title="sysstat package" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: sysstat package</div><p>
     The <code class="command">sar</code> command is a part of the
     <span class="package">sysstat</span> package. Install it with YaST, or with
     the <code class="command">zypper in sysstat</code> command. <code class="systemitem">sysstat.service</code> does not start by default,
     and must be enabled and started with the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl enable --now sysstat</code></pre></div></div><section class="sect3" id="sec-util-multi-sar-report" data-id-title="Generating reports with sar"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">2.1.3.1 </span><span class="title-name">Generating reports with <code class="command">sar</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-multi-sar-report">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To generate reports in real time, call <code class="command">sar</code> with an
     interval (seconds) and a count. To generate reports from files specify
     a file name with the option <code class="option">-f</code> instead of interval and
     count. If file name, interval and count are not specified,
     <code class="command">sar</code> attempts to generate a report from
     <code class="filename">/var/log/sa/sa<em class="replaceable">DD</em></code>, where
     <em class="replaceable">DD</em> stands for the current day. This is the
     default location to where <code class="command">sadc</code> (the system
     activity data collector) writes its data.
     Query multiple files with multiple <code class="option">-f</code> options.
    </p><div class="verbatim-wrap"><pre class="screen">sar 2 10                         # real time report, 10 times every 2 seconds
sar -f ~/reports/sar_2014_07_17  # queries file sar_2014_07_17
sar                              # queries file from today in /var/log/sa/
cd /var/log/sa &amp;&amp; \
sar -f sa01 -f sa02              # queries files /var/log/sa/0[12]</pre></div><p>
     Find examples for useful <code class="command">sar</code> calls and their
     interpretation below. For detailed information on the meaning of each
     column, refer to the <code class="systemitem">man (1)</code> of
     <code class="command">sar</code>.
    </p><div id="id-1.8.4.2.7.5.4.5" data-id-title="sysstat reporting when the service stops" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: sysstat reporting when the service stops</div><p>
      When the <code class="systemitem">sysstat</code> service is stopped (for example, during
      reboot or shutdown), the tool still collects last-minute statistics by
      automatically running the <code class="command">/usr/lib64/sa/sa1 -S ALL 1 1</code>
      command. The collected binary data is stored in the system activity data
      file.
     </p></div><section class="sect4" id="sec-util-multi-sar-report-cpu" data-id-title="CPU usage report: sar"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">2.1.3.1.1 </span><span class="title-name">CPU usage report: <code class="command">sar</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-multi-sar-report-cpu">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      When called with no options, <code class="command">sar</code> shows a basic
      report about CPU usage. On multi-processor machines, results for all
      CPUs are summarized. Use the option <code class="option">-P ALL</code> to also
      see statistics for individual CPUs.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>sar 10 5
Linux 6.4.0-150600.9-default (jupiter)         03/11/2024        _x86_64_        (2 CPU)

17:51:29        CPU     %user     %nice   %system   %iowait    %steal     %idle
17:51:39        all     57,93      0,00      9,58      1,01      0,00     31,47
17:51:49        all     32,71      0,00      3,79      0,05      0,00     63,45
17:51:59        all     47,23      0,00      3,66      0,00      0,00     49,11
17:52:09        all     53,33      0,00      4,88      0,05      0,00     41,74
17:52:19        all     56,98      0,00      5,65      0,10      0,00     37,27
Average:        all     49,62      0,00      5,51      0,24      0,00     44,62</pre></div><p>
      <span class="guimenu">%iowait</span> displays the percentage of time that the
      CPU was idle while waiting for an I/O request. If this value is
      much higher than zero over a long period of time, there is a
      bottleneck in the I/O system (network or hard disk). If the
      <span class="guimenu">%idle</span> value is zero over a long period of time,
      your CPU is working at capacity.
     </p></section><section class="sect4" id="sec-util-multi-sar-report-memory" data-id-title="Memory usage report: sar -r"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">2.1.3.1.2 </span><span class="title-name">Memory usage report: <code class="command">sar</code> <code class="option">-r</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-multi-sar-report-memory">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Generate an overall picture of the system memory (RAM) by using the
      option <code class="option">-r</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>sar -r 10 5
Linux 6.4.0-150600.9-default (jupiter)         03/11/2024        _x86_64_        (2 CPU)

17:55:27 kbmemfree kbmemused %memused kbbuffers kbcached kbcommit %commit kbactive kbinact kbdirty
17:55:37    104232   1834624    94.62        20   627340  2677656   66.24   802052  828024    1744
17:55:47     98584   1840272    94.92        20   624536  2693936   66.65   808872  826932    2012
17:55:57     87088   1851768    95.51        20   605288  2706392   66.95   827260  821304    1588
17:56:07     86268   1852588    95.55        20   599240  2739224   67.77   829764  820888    3036
17:56:17    104260   1834596    94.62        20   599864  2730688   67.56   811284  821584    3164
Average:     96086   1842770    95.04        20   611254  2709579   67.03   815846  823746    2309</pre></div><p>
      The columns <span class="guimenu">kbcommit</span> and <span class="guimenu">%commit</span>
      show an approximation of the maximum amount of memory (RAM and swap)
      that the current workload could need. While
      <span class="guimenu">kbcommit</span> displays the absolute number in kilobytes,
      <span class="guimenu">%commit</span> displays a percentage.
     </p></section><section class="sect4" id="sec-util-multi-sar-report-paging" data-id-title="Paging statistics report: sar -B"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">2.1.3.1.3 </span><span class="title-name">Paging statistics report: <code class="command">sar</code> <code class="option">-B</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-multi-sar-report-paging">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Use the option <code class="option">-B</code> to display the kernel paging
      statistics.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>sar -B 10 5
Linux 6.4.0-150600.9-default (jupiter)         03/11/2024        _x86_64_        (2 CPU)

18:23:01 pgpgin/s pgpgout/s fault/s majflt/s pgfree/s pgscank/s pgscand/s pgsteal/s %vmeff
18:23:11   366.80     11.60  542.50     1.10  4354.80      0.00      0.00      0.00   0.00
18:23:21     0.00    333.30 1522.40     0.00 18132.40      0.00      0.00      0.00   0.00
18:23:31    47.20    127.40 1048.30     0.10 11887.30      0.00      0.00      0.00   0.00
18:23:41    46.40      2.50  336.10     0.10  7945.00      0.00      0.00      0.00   0.00
18:23:51     0.00    583.70 2037.20     0.00 17731.90      0.00      0.00      0.00   0.00
Average:    92.08    211.70 1097.30     0.26 12010.28      0.00      0.00      0.00   0.00</pre></div><p>
      The <span class="guimenu">majflt/s</span> (major faults per second) column shows
      how many pages are loaded from disk into memory. The source of the
      faults may be file accesses or faults. At times, many
      major faults are normal. For example, during application start-up
      time. If major faults are experienced for the entire lifetime of the
      application it may be an indication that there is insufficient main
      memory, particularly if combined with large amounts of direct scanning
      (pgscand/s).
     </p><p>
      The <span class="guimenu">%vmeff</span> column shows the number of pages scanned
      (<span class="guimenu">pgscand/s</span>) in relation to the ones being reused
      from the main memory cache or the swap cache
      (<span class="guimenu">pgsteal/s</span>). It is a measurement of the efficiency
      of page reclaim. Healthy values are either near 100 (every inactive
      page swapped out is being reused) or 0 (no pages have been scanned).
      The value should not drop below 30.
     </p></section><section class="sect4" id="sec-util-multi-sar-report-disk" data-id-title="Block device statistics report: sar -d"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">2.1.3.1.4 </span><span class="title-name">Block device statistics report: <code class="command">sar</code> <code class="option">-d</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-multi-sar-report-disk">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Use the option <code class="option">-d</code> to display the block device (hard
      disk, optical drive, USB storage device, etc.). Make sure to use the
      additional option <code class="option">-p</code> (pretty-print) to make the
      <span class="guimenu">DEV</span> column readable.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>sar -d -p 10 5
 Linux 6.4.0-150600.9-default (jupiter)         03/11/2024        _x86_64_        (2 CPU)

18:46:09 DEV   tps rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
18:46:19 sda  1.70    33.60      0.00     19.76      0.00      0.47      0.47      0.08
18:46:19 sr0  0.00     0.00      0.00      0.00      0.00      0.00      0.00      0.00

18:46:19 DEV   tps rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
18:46:29 sda  8.60   114.40    518.10     73.55      0.06      7.12      0.93      0.80
18:46:29 sr0  0.00     0.00      0.00      0.00      0.00      0.00      0.00      0.00

18:46:29 DEV   tps rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
18:46:39 sda 40.50  3800.80    454.90    105.08      0.36      8.86      0.69      2.80
18:46:39 sr0  0.00     0.00      0.00      0.00      0.00      0.00      0.00      0.00

18:46:39 DEV   tps rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
18:46:49 sda  1.40     0.00    204.90    146.36      0.00      0.29      0.29      0.04
18:46:49 sr0  0.00     0.00      0.00      0.00      0.00      0.00      0.00      0.00

18:46:49 DEV   tps rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
18:46:59 sda  3.30     0.00    503.80    152.67      0.03      8.12      1.70      0.56
18:46:59 sr0  0.00     0.00      0.00      0.00      0.00      0.00      0.00      0.00

Average: DEV   tps rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
Average: sda 11.10   789.76    336.34    101.45      0.09      8.07      0.77      0.86
Average: sr0  0.00     0.00      0.00      0.00      0.00      0.00      0.00      0.00</pre></div><p>
      Compare the <span class="guimenu">Average</span> values for
      <span class="guimenu">tps</span>, <span class="guimenu">rd_sec/s</span>, and
      <span class="guimenu">wr_sec/s</span> of all disks. Constantly high values in
      the <span class="guimenu">svctm</span> and <span class="guimenu">%util</span> columns
      could be an indication that I/O subsystem is a bottleneck.
     </p><p>
      If the machine uses multiple disks, then it is best if I/O is
      interleaved evenly between disks of equal speed and capacity. It is necessary to take into account whether the storage has multiple
      tiers. Furthermore, if there are multiple paths to storage, then
      consider the extent of link saturation when balancing how storage
      is used.
     </p></section><section class="sect4" id="sec-util-multi-sar-report-net" data-id-title="Network statistics reports: sar -n KEYWORD"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">2.1.3.1.5 </span><span class="title-name">Network statistics reports: <code class="command">sar</code> <code class="option">-n <em class="replaceable">KEYWORD</em></code></span></span> <a title="Permalink" class="permalink" href="#sec-util-multi-sar-report-net">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      The option <code class="option">-n</code> lets you generate multiple network
      related reports. Specify one of the following keywords along with the
      <code class="option">-n</code>:
     </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        <span class="emphasis"><em>DEV</em></span>: Generates a statistic report for all
        network devices
       </p></li><li class="listitem"><p>
        <span class="emphasis"><em>EDEV</em></span>: Generates an error statistics report for
        all network devices
       </p></li><li class="listitem"><p>
        <span class="emphasis"><em>NFS</em></span>: Generates a statistic report for an NFS
        client
       </p></li><li class="listitem"><p>
        <span class="emphasis"><em>NFSD</em></span>: Generates a statistic report for an NFS
        server
       </p></li><li class="listitem"><p>
        <span class="emphasis"><em>SOCK</em></span>: Generates a statistic report on sockets
       </p></li><li class="listitem"><p>
        <span class="emphasis"><em>ALL</em></span>: Generates all network statistic reports
       </p></li></ul></div></section></section><section class="sect3" id="sec-util-multi-sar-visual" data-id-title="Visualizing sar data"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">2.1.3.2 </span><span class="title-name">Visualizing <code class="command">sar</code> data</span></span> <a title="Permalink" class="permalink" href="#sec-util-multi-sar-visual">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">sar</code> reports are not always easy to parse for humans.
     kSar, a Java application visualizing your <code class="command">sar</code> data,
     creates easy-to-read graphs. It can even generate PDF reports. kSar
     takes data generated in real time, and past data from a file. kSar
     is licensed under the BSD license and is available from
     <a class="link" href="https://sourceforge.net/projects/ksar/" target="_blank">https://sourceforge.net/projects/ksar/</a>.
    </p></section></section></section><section class="sect1" id="sec-util-system" data-id-title="System information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.2 </span><span class="title-name">System information</span></span> <a title="Permalink" class="permalink" href="#sec-util-system">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-util-system-iostat" data-id-title="Device load information: iostat"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.2.1 </span><span class="title-name">Device load information: <code class="command">iostat</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-system-iostat">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To monitor the system device load, use <code class="command">iostat</code>. It
    generates reports that can be useful for better balancing the load
    between physical disks attached to your system.
   </p><p>
    To be able to use <code class="command">iostat</code>, install the package
    <span class="package">sysstat</span>.
   </p><p>
    The first <code class="command">iostat</code> report shows statistics collected
    since the system was booted. Subsequent reports cover the time since the
    previous report.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>iostat
Linux 6.4.0-150600.9-default (jupiter)         03/11/2024        _x86_64_        (4 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          17.68    4.49    4.24    0.29    0.00   73.31

Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sdb               2.02        36.74        45.73    3544894    4412392
sda               1.05         5.12        13.47     493753    1300276
sdc               0.02         0.14         0.00      13641         37</pre></div><p>
    Invoking <code class="command">iostat</code> in this way helps you find out
    whether throughput is different from your expectation, but not why.
    Such questions can be better answered by an extended report which can be
    generated by invoking <code class="command">iostat</code> <code class="option">-x</code>.
    Extended reports additionally include, for example, information on average
    queue sizes and average wait times.
    It may also be easier to evaluate the data if idle block devices are
    excluded using the <code class="option">-z</code> switch.
    Find definitions for each of the displayed column titles in the
    man page of <code class="command">iostat</code> (<code class="command">man 1 iostat</code>).
   </p><p>
    You can also specify that a certain device should be monitored at specified
    intervals.
    For example, to generate five reports at three-second intervals for the
    device <code class="systemitem">sda</code>, use:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">iostat</code> -p sda 3 5</pre></div><p>
    To show statistics of network file systems (NFS), there are two similar
    utilities:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="command">nfsiostat-sysstat</code> is included with the
      package <span class="package">sysstat</span>.
     </p></li><li class="listitem"><p>
      <code class="command">nfsiostat</code> is included with the package
      <span class="package">nfs-client</span>.
     </p></li></ul></div><div id="id-1.8.4.2.8.3.12" data-id-title="Using iostat in multipath setups" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Using <code class="command">iostat</code> in multipath setups</div><p>
      The <code class="command">iostat</code> command might not show all controllers
      that are listed by <code class="command">nvme list-subsys</code>. By default,
      <code class="command">iostat</code> filters out all block devices with no I/O.
      To make <code class="command">iostat</code> show <span class="emphasis"><em>all</em></span>
      devices, use the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code> iostat -p ALL</pre></div></div></section><section class="sect2" id="sec-util-system-mpstat-monitoring" data-id-title="Processor activity monitoring: mpstat"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.2.2 </span><span class="title-name">Processor activity monitoring: <code class="command">mpstat</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-system-mpstat-monitoring">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The utility <code class="command">mpstat</code> examines activities of each
    available processor. If your system has one processor only, the global
    average statistics are reported.
   </p><p>
    The timing arguments work the same way as with the
    <code class="command">iostat</code> command. Entering <code class="command">mpstat 2
    5</code> prints five reports for all processors in two-second
    intervals.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>mpstat 2 5
Linux 6.4.0-150600.9-default (jupiter)         03/11/2024        _x86_64_        (2 CPU)

13:51:10  CPU   %usr  %nice  %sys  %iowait  %irq  %soft  %steal  %guest  %gnice   %idle
13:51:12  all   8,27   0,00  0,50     0,00  0,00   0,00    0,00    0,00    0,00   91,23
13:51:14  all  46,62   0,00  3,01     0,00  0,00   0,25    0,00    0,00    0,00   50,13
13:51:16  all  54,71   0,00  3,82     0,00  0,00   0,51    0,00    0,00    0,00   40,97
13:51:18  all  78,77   0,00  5,12     0,00  0,00   0,77    0,00    0,00    0,00   15,35
13:51:20  all  51,65   0,00  4,30     0,00  0,00   0,51    0,00    0,00    0,00   43,54
Average:  all  47,85   0,00  3,34     0,00  0,00   0,40    0,00    0,00    0,00   48,41</pre></div><p>
    From the <code class="command">mpstat</code> data, you can see:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    The ratio between the <span class="guimenu">%usr</span> and <span class="guimenu">%sys</span>.
    For example, a ratio
    of 10:1 indicates the workload is primarily running application code,
    and analysis should focus on the application. A ratio of 1:10
    indicates the workload is primarily kernel-bound, and tuning the kernel
    is worth considering. Alternatively, determine why the application is
    kernel-bound and see if that can be alleviated.
     </p></li><li class="listitem"><p>
    Whether there is a subset of CPUs that are nearly fully
    utilized even if the system is lightly loaded overall. Few
    hot CPUs can indicate that the workload is not parallelized and
    could benefit from executing on a machine with a smaller number of
    faster processors.
     </p></li></ul></div></section><section class="sect2" id="sec-util-system-turbostat" data-id-title="Processor frequency monitoring: turbostat"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.2.3 </span><span class="title-name">Processor frequency monitoring: <code class="command">turbostat</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-system-turbostat">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">turbostat</code> shows frequencies, load, temperature, and power
    of AMD64/Intel 64 processors. It can operate in two modes: If called
    with a command, the command process is forked and statistics are displayed
    upon command completion. When run without a command, it displays
    updated statistics every five seconds. <code class="command">turbostat</code> requires the kernel module
    <code class="systemitem">msr</code> to be loaded.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> turbostat find /etc -type d -exec true {} \;
0.546880 sec
     CPU Avg_MHz   Busy% Bzy_MHz TSC_MHz
       -     416   28.43    1465    3215
       0     631   37.29    1691    3215
       1     416   27.14    1534    3215
       2     270   24.30    1113    3215
       3     406   26.57    1530    3214
       4     505   32.46    1556    3214
       5     270   22.79    1184    3214</pre></div><p>
    The output depends on the CPU type and may vary. To display more details
    such as temperature and power, use the <code class="option">--debug</code> option. For
    more command line options and an explanation of the field descriptions,
    refer to <code class="command">man 8 turbostat</code>.
   </p></section><section class="sect2" id="sec-util-system-pidstat" data-id-title="Task monitoring: pidstat"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.2.4 </span><span class="title-name">Task monitoring: <code class="command">pidstat</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-system-pidstat">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you need to see what load a particular task applies to your system,
    use <code class="command">pidstat</code> command. It prints activity of every
    selected task or all tasks managed by Linux kernel if no task is
    specified. You can also set the number of reports to be displayed and
    the time interval between them.
   </p><p>
    For example, <code class="command">pidstat</code> <code class="option">-C</code> firefox 2 3
    prints the load statistic for tasks whose command name includes the
    string <span class="quote">“<span class="quote">firefox</span>”</span>. There are three reports printed at
    two second intervals.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>pidstat -C firefox 2 3
Linux 6.4.0-150600.9-default (jupiter)         03/11/2024        _x86_64_        (2 CPU)

14:09:11      UID       PID    %usr %system  %guest    %CPU   CPU  Command
14:09:13     1000       387   22,77    0,99    0,00   23,76     1  firefox

14:09:13      UID       PID    %usr %system  %guest    %CPU   CPU  Command
14:09:15     1000       387   46,50    3,00    0,00   49,50     1  firefox

14:09:15      UID       PID    %usr %system  %guest    %CPU   CPU  Command
14:09:17     1000       387   60,50    7,00    0,00   67,50     1  firefox

Average:      UID       PID    %usr %system  %guest    %CPU   CPU  Command
Average:     1000       387   43,19    3,65    0,00   46,84     -  firefox</pre></div><p>
    Similarly, <code class="command">pidstat</code> <code class="option">-d</code> can be
    used to estimate how much I/O tasks are doing, whether they are
    sleeping on that I/O and how many clock ticks the task was stalled.
   </p></section><section class="sect2" id="sec-util-dmesg" data-id-title="Kernel ring buffer: dmesg"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.2.5 </span><span class="title-name">Kernel ring buffer: <code class="command">dmesg</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-dmesg">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The Linux kernel keeps certain messages in a ring buffer. To view these
    messages, enter the command <code class="command">dmesg -T</code>.
   </p><p>
    Older events are logged in the <code class="systemitem">systemd</code> journal. See
    <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: query the <code class="systemitem">systemd</code> journal”</span> for more information on the journal.
   </p></section><section class="sect2" id="sec-util-system-lsof" data-id-title="List of open files: lsof"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.2.6 </span><span class="title-name">List of open files: <code class="command">lsof</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-system-lsof">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To view a list of all the files open for the process with process ID
    <em class="replaceable">PID</em>, use <code class="option">-p</code>. For example, to
    view all the files used by the current shell, enter:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>lsof -p $$
COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF  NODE NAME
bash    8842 root  cwd    DIR   0,32      222  6772 /root
bash    8842 root  rtd    DIR   0,32      166   256 /
bash    8842 root  txt    REG   0,32   656584 31066 /bin/bash
bash    8842 root  mem    REG   0,32  1978832 22993 /lib64/libc-2.19.so
[...]
bash    8842 root    2u   CHR  136,2      0t0     5 /dev/pts/2
bash    8842 root  255u   CHR  136,2      0t0     5 /dev/pts/2</pre></div><p>
    The special shell variable <code class="literal">$$</code>, whose value is the
    process ID of the shell, has been used.
   </p><p>
    When used with <code class="option">-i</code>, <code class="command">lsof</code> lists
    currently open Internet files as well:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>lsof -i
COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
wickedd-d  917 root    8u  IPv4  16627      0t0  UDP *:bootpc
wickedd-d  918 root    8u  IPv6  20752      0t0  UDP [fe80::5054:ff:fe72:5ead]:dhcpv6-client
sshd      3152 root    3u  IPv4  18618      0t0  TCP *:ssh (LISTEN)
sshd      3152 root    4u  IPv6  18620      0t0  TCP *:ssh (LISTEN)
master    4746 root   13u  IPv4  20588      0t0  TCP localhost:smtp (LISTEN)
master    4746 root   14u  IPv6  20589      0t0  TCP localhost:smtp (LISTEN)
sshd      8837 root    5u  IPv4 293709      0t0  TCP jupiter.suse.de:ssh-&gt;venus.suse.de:33619 (ESTABLISHED)
sshd      8837 root    9u  IPv6 294830      0t0  TCP localhost:x11 (LISTEN)
sshd      8837 root   10u  IPv4 294831      0t0  TCP localhost:x11 (LISTEN)</pre></div></section><section class="sect2" id="sec-util-system-udevmonitor" data-id-title="Kernel and udev event sequence viewer: udevadm monitor"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.2.7 </span><span class="title-name">Kernel and udev event sequence viewer: <code class="command">udevadm monitor</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-system-udevmonitor">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">udevadm monitor</code> listens to the kernel uevents and
    events sent out by a udev rule and prints the device path (DEVPATH) of
    the event to the console. This is a sequence of events while connecting
    a USB memory stick:
   </p><div id="id-1.8.4.2.8.9.3" data-id-title="Monitoring udev events" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Monitoring udev events</div><p>
     Only root user is allowed to monitor udev events by running the
     <code class="command">udevadm</code> command.
    </p></div><div class="verbatim-wrap"><pre class="screen">UEVENT[1138806687] add@/devices/pci0000:00/0000:00:1d.7/usb4/4-2/4-2.2
UEVENT[1138806687] add@/devices/pci0000:00/0000:00:1d.7/usb4/4-2/4-2.2/4-2.2
UEVENT[1138806687] add@/class/scsi_host/host4
UEVENT[1138806687] add@/class/usb_device/usbdev4.10
UDEV  [1138806687] add@/devices/pci0000:00/0000:00:1d.7/usb4/4-2/4-2.2
UDEV  [1138806687] add@/devices/pci0000:00/0000:00:1d.7/usb4/4-2/4-2.2/4-2.2
UDEV  [1138806687] add@/class/scsi_host/host4
UDEV  [1138806687] add@/class/usb_device/usbdev4.10
UEVENT[1138806692] add@/devices/pci0000:00/0000:00:1d.7/usb4/4-2/4-2.2/4-2.2
UEVENT[1138806692] add@/block/sdb
UEVENT[1138806692] add@/class/scsi_generic/sg1
UEVENT[1138806692] add@/class/scsi_device/4:0:0:0
UDEV  [1138806693] add@/devices/pci0000:00/0000:00:1d.7/usb4/4-2/4-2.2/4-2.2
UDEV  [1138806693] add@/class/scsi_generic/sg1
UDEV  [1138806693] add@/class/scsi_device/4:0:0:0
UDEV  [1138806693] add@/block/sdb
UEVENT[1138806694] add@/block/sdb/sdb1
UDEV  [1138806694] add@/block/sdb/sdb1
UEVENT[1138806694] mount@/block/sdb/sdb1
UEVENT[1138806697] umount@/block/sdb/sdb1</pre></div></section></section><section class="sect1" id="sec-util-processes" data-id-title="Processes"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.3 </span><span class="title-name">Processes</span></span> <a title="Permalink" class="permalink" href="#sec-util-processes">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-util-processes-ipcs" data-id-title="Inter-process communication: ipcs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.1 </span><span class="title-name">Inter-process communication: <code class="command">ipcs</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-processes-ipcs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The command <code class="command">ipcs</code> produces a list of the IPC resources
    currently in use:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ipcs
------ Message Queues --------
key        msqid      owner      perms      used-bytes   messages

------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status
0x00000000 65536      tux        600        524288     2          dest
0x00000000 98305      tux        600        4194304    2          dest
0x00000000 884738     root       600        524288     2          dest
0x00000000 786435     tux        600        4194304    2          dest
0x00000000 12058628   tux        600        524288     2          dest
0x00000000 917509     root       600        524288     2          dest
0x00000000 12353542   tux        600        196608     2          dest
0x00000000 12451847   tux        600        524288     2          dest
0x00000000 11567114   root       600        262144     1          dest
0x00000000 10911763   tux        600        2097152    2          dest
0x00000000 11665429   root       600        2336768    2          dest
0x00000000 11698198   root       600        196608     2          dest
0x00000000 11730967   root       600        524288     2          dest

------ Semaphore Arrays --------
key        semid      owner      perms      nsems
0xa12e0919 32768      tux        666        2</pre></div></section><section class="sect2" id="sec-util-processes-ps" data-id-title="Process list: ps"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.2 </span><span class="title-name">Process list: <code class="command">ps</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-processes-ps">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The command <code class="command">ps</code> produces a list of processes. Most
    parameters must be written without a minus sign. Refer to <code class="command">ps
    --help</code> for a brief help or to the man page for extensive help.
   </p><p>
    To list all processes with user and command line information, use
    <code class="command">ps axu</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ps axu
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.3  34376  4608 ?        Ss   Jul24   0:02 /usr/lib/systemd/systemd
root         2  0.0  0.0      0     0 ?        S    Jul24   0:00 [kthreadd]
root         3  0.0  0.0      0     0 ?        S    Jul24   0:00 [ksoftirqd/0]
root         5  0.0  0.0      0     0 ?        S&lt;   Jul24   0:00 [kworker/0:0H]
root         6  0.0  0.0      0     0 ?        S    Jul24   0:00 [kworker/u2:0]
root         7  0.0  0.0      0     0 ?        S    Jul24   0:00 [migration/0]
[...]
tux      12583  0.0  0.1 185980  2720 ?        Sl   10:12   0:00 /usr/lib/gvfs/gvfs-mtp-volume-monitor
tux      12587  0.0  0.1 198132  3044 ?        Sl   10:12   0:00 /usr/lib/gvfs/gvfs-gphoto2-volume-monitor
tux      12591  0.0  0.1 181940  2700 ?        Sl   10:12   0:00 /usr/lib/gvfs/gvfs-goa-volume-monitor
tux      12594  8.1 10.6 1418216 163564 ?      Sl   10:12   0:03 /usr/bin/gnome-shell
tux      12600  0.0  0.3 393448  5972 ?        Sl   10:12   0:00 /usr/lib/gnome-settings-daemon-3.0/gsd-printer
tux      12625  0.0  0.6 227776 10112 ?        Sl   10:12   0:00 /usr/lib/gnome-control-center-search-provider
tux      12626  0.5  1.5 890972 23540 ?        Sl   10:12   0:00 /usr/bin/nautilus --no-default-window
[...]</pre></div><p>
    To check how many <code class="command">sshd</code> processes are running, use the
    option <code class="option">-p</code> together with the command
    <code class="command">pidof</code>, which lists the process IDs of the given
    processes.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ps -p $(pidof sshd)
  PID TTY      STAT   TIME COMMAND
 1545 ?        Ss     0:00 /usr/sbin/sshd -D
 4608 ?        Ss     0:00 sshd: root@pts/0</pre></div><p>
    The process list can be formatted according to your needs. The option
    <code class="option">L</code> returns a list of all keywords. Enter the following
    command to issue a list of all processes sorted by memory usage:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ps ax --format pid,rss,cmd --sort rss
  PID   RSS CMD
  PID   RSS CMD
    2     0 [kthreadd]
    3     0 [ksoftirqd/0]
    4     0 [kworker/0:0]
    5     0 [kworker/0:0H]
    6     0 [kworker/u2:0]
    7     0 [migration/0]
    8     0 [rcu_bh]
[...]
12518 22996 /usr/lib/gnome-settings-daemon-3.0/gnome-settings-daemon
12626 23540 /usr/bin/nautilus --no-default-window
12305 32188 /usr/bin/Xorg :0 -background none -verbose
12594 164900 /usr/bin/gnome-shell</pre></div><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">Useful <code class="command">ps</code> calls </span></span><a title="Permalink" class="permalink" href="#id-1.8.4.2.9.4.9">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.8.4.2.9.4.9.2"><span class="term"><code class="command">ps aux</code><code class="option">--sort
       <em class="replaceable">COLUMN</em></code>
     </span></dt><dd><p>
       Sort the output by <em class="replaceable">COLUMN</em>. Replace
       <em class="replaceable">COLUMN</em> with
      </p><table style="border: 0; " class="simplelist"><tr><td><code class="option">pmem</code> for physical memory ratio</td></tr><tr><td><code class="option">pcpu</code> for CPU ratio</td></tr><tr><td><code class="option">rss</code> for resident set size (non-swapped physical
        memory)</td></tr></table></dd><dt id="id-1.8.4.2.9.4.9.3"><span class="term"><code class="command">ps axo pid,%cpu,rss,vsz,args,wchan</code>
     </span></dt><dd><p>
       Shows every process, their PID, CPU usage ratio, memory size
       (resident and virtual), name, and their syscall.
      </p></dd><dt id="id-1.8.4.2.9.4.9.4"><span class="term"><code class="command">ps axfo pid,args</code>
     </span></dt><dd><p>
       Show a process tree.
      </p></dd></dl></div></section><section class="sect2" id="sec-util-pstree" data-id-title="Process tree: pstree"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.3 </span><span class="title-name">Process tree: <code class="command">pstree</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-pstree">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The command <code class="command">pstree</code> produces a list of processes in
    the form of a tree:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>pstree
systemd---accounts-daemon---{gdbus}
        |                 |-{gmain}
        |-at-spi-bus-laun---dbus-daemon
        |                 |-{dconf worker}
        |                 |-{gdbus}
        |                 |-{gmain}
        |-at-spi2-registr---{gdbus}
        |-cron
        |-2*[dbus-daemon]
        |-dbus-launch
        |-dconf-service---{gdbus}
        |               |-{gmain}
        |-gconfd-2
        |-gdm---gdm-simple-slav---Xorg
        |     |                 |-gdm-session-wor---gnome-session---gnome-setti+
        |     |                 |                 |               |-gnome-shell+++
        |     |                 |                 |               |-{dconf work+
        |     |                 |                 |               |-{gdbus}
        |     |                 |                 |               |-{gmain}
        |     |                 |                 |-{gdbus}
        |     |                 |                 |-{gmain}
        |     |                 |-{gdbus}
        |     |                 |-{gmain}
        |     |-{gdbus}
        |     |-{gmain}
[...]</pre></div><p>
    The parameter <code class="option">-p</code> adds the process ID to a given name.
    To have the command lines displayed as well, use the <code class="option">-a</code>
    parameter:
   </p></section><section class="sect2" id="sec-util-processes-top" data-id-title="Table of processes: top"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.4 </span><span class="title-name">Table of processes: <code class="command">top</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-processes-top">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The command <code class="command">top</code> (an abbreviation of <span class="quote">“<span class="quote">table of
    processes</span>”</span>) displays a list of processes that is refreshed every
    two seconds. To stop the program, press <span class="keycap">Q</span>. The
    parameter <code class="option">-n 1</code> stops the program after a single
    display of the process list. The following is an example output of the
    command <code class="command">top -n 1</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>top -n 1
Tasks: 128 total,   1 running, 127 sleeping,   0 stopped,   0 zombie
%Cpu(s):  2.4 us,  1.2 sy,  0.0 ni, 96.3 id,  0.1 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem:   1535508 total,   699948 used,   835560 free,      880 buffers
KiB Swap:  1541116 total,        0 used,  1541116 free.   377000 cached Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
    1 root      20   0  116292   4660   2028 S 0.000 0.303   0:04.45 systemd
    2 root      20   0       0      0      0 S 0.000 0.000   0:00.00 kthreadd
    3 root      20   0       0      0      0 S 0.000 0.000   0:00.07 ksoftirqd+
    5 root       0 -20       0      0      0 S 0.000 0.000   0:00.00 kworker/0+
    6 root      20   0       0      0      0 S 0.000 0.000   0:00.00 kworker/u+
    7 root      rt   0       0      0      0 S 0.000 0.000   0:00.00 migration+
    8 root      20   0       0      0      0 S 0.000 0.000   0:00.00 rcu_bh
    9 root      20   0       0      0      0 S 0.000 0.000   0:00.24 rcu_sched
   10 root      rt   0       0      0      0 S 0.000 0.000   0:00.01 watchdog/0
   11 root       0 -20       0      0      0 S 0.000 0.000   0:00.00 khelper
   12 root      20   0       0      0      0 S 0.000 0.000   0:00.00 kdevtmpfs
   13 root       0 -20       0      0      0 S 0.000 0.000   0:00.00 netns
   14 root       0 -20       0      0      0 S 0.000 0.000   0:00.00 writeback
   15 root       0 -20       0      0      0 S 0.000 0.000   0:00.00 kintegrit+
   16 root       0 -20       0      0      0 S 0.000 0.000   0:00.00 bioset
   17 root       0 -20       0      0      0 S 0.000 0.000   0:00.00 crypto
   18 root       0 -20       0      0      0 S 0.000 0.000   0:00.00 kblockd</pre></div><p>
    By default the output is sorted by CPU usage (column
    <span class="guimenu">%CPU</span>, shortcut <span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">P</span>). Use the following key combinations to
    change the sort field:
   </p><table style="border: 0; " class="simplelist"><tr><td><span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">M</span>: Resident Memory (<span class="guimenu">RES</span>) </td></tr><tr><td><span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">N</span>: Process ID (<span class="guimenu">PID</span>) </td></tr><tr><td><span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">T</span>: Time (<span class="guimenu">TIME+</span>) </td></tr></table><p>
    To use any other field for sorting, press <span class="keycap">F</span> and select
    a field from the list. To toggle the sort order, Use <span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">R</span>.
   </p><p>
    The parameter <code class="option">-U <em class="replaceable">UID</em></code>
    monitors only the processes associated with a particular user. Replace
    <em class="replaceable">UID</em> with the user ID of the user. Use
    <code class="command">top -U $(id -u)</code> to show processes of the current user
   </p></section><section class="sect2" id="sec-util-processes-virtualtop" data-id-title="IBM Z hypervisor monitor: hyptop"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.5 </span><span class="title-name">IBM Z hypervisor monitor: <code class="command">hyptop</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-processes-virtualtop">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">hyptop</code> provides a dynamic real-time view of an
    IBM Z hypervisor environment, using the kernel infrastructure through
    debugfs. It works with either the z/VM or the LPAR hypervisor. Depending
    on the available data it, for example, shows CPU and memory consumption
    of active LPARs or z/VM guests. It provides a curses based user
    interface similar to the <code class="command">top</code> command.
    <code class="command">hyptop</code> provides two windows:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <span class="guimenu">sys_list</span>: Lists systems that the
      current hypervisor is running
     </p></li><li class="listitem"><p>
      <span class="guimenu">sys</span>: Shows one system in more detail
     </p></li></ul></div><p>
    You can run <code class="command">hyptop</code> in interactive mode (default) or
    in batch mode with the <code class="option">-b</code> option. Help in the
    interactive mode is available by pressing <span class="keycap">?</span> after
    <code class="command">hyptop</code> is started.
   </p><p>
    Output for the <span class="guimenu">sys_list</span> window under LPAR:
   </p><div class="verbatim-wrap"><pre class="screen">12:30:48 | CPU-T: IFL(18) CP(3) UN(3)     ?=help
system  #cpu    cpu   mgm    Cpu+  Mgm+   online
(str)    (#)    (%)   (%)    (hm)  (hm)    (dhm)
H05LP30   10 461.14 10.18 1547:41  8:15 11:05:59
H05LP33    4 133.73  7.57  220:53  6:12 11:05:54
H05LP50    4  99.26  0.01  146:24  0:12 10:04:24
H05LP02    1  99.09  0.00  269:57  0:00 11:05:58
TRX2CFA    1   2.14  0.03    3:24  0:04 11:06:01
H05LP13    6   1.36  0.34    4:23  0:54 11:05:56
TRX1      19   1.22  0.14   13:57  0:22 11:06:01
TRX2      20   1.16  0.11   26:05  0:25 11:06:00
H05LP55    2   0.00  0.00    0:22  0:00 11:05:52
H05LP56    3   0.00  0.00    0:00  0:00 11:05:52
         413 823.39 23.86 3159:57 38:08 11:06:01</pre></div><p>
    Output for the "sys_list" window under z/VM:
   </p><div class="verbatim-wrap"><pre class="screen">12:32:21 | CPU-T: UN(16)                          ?=help
system   #cpu    cpu    Cpu+   online memuse memmax wcur
(str)     (#)    (%)    (hm)    (dhm)  (GiB)  (GiB)  (#)
T6360004    6 100.31  959:47 53:05:20   1.56   2.00  100
T6360005    2   0.44    1:11  3:02:26   0.42   0.50  100
T6360014    2   0.27    0:45 10:18:41   0.54   0.75  100
DTCVSW1     1   0.00    0:00 53:16:42   0.01   0.03  100
T6360002    6   0.00  166:26 40:19:18   1.87   2.00  100
OPERATOR    1   0.00    0:00 53:16:42   0.00   0.03  100
T6360008    2   0.00    0:37 30:22:55   0.32   0.75  100
T6360003    6   0.00 3700:57 53:03:09   4.00   4.00  100
NSLCF1      1   0.00    0:02 53:16:41   0.03   0.25  500
EREP        1   0.00    0:00 53:16:42   0.00   0.03  100
PERFSVM     1   0.00    0:53  2:21:12   0.04   0.06    0
TCPIP       1   0.00    0:01 53:16:42   0.01   0.12 3000
DATAMOVE    1   0.00    0:05 53:16:42   0.00   0.03  100
DIRMAINT    1   0.00    0:04 53:16:42   0.01   0.03  100
DTCVSW2     1   0.00    0:00 53:16:42   0.01   0.03  100
RACFVM      1   0.00    0:00 53:16:42   0.01   0.02  100
           75 101.57 5239:47 53:16:42  15.46  22.50 3000</pre></div><p>
    Output for the <span class="guimenu">sys</span> window under LPAR:
   </p><div class="verbatim-wrap"><pre class="screen">14:08:41 | H05LP30 | CPU-T: IFL(18) CP(3) UN(3)                  ? = help
cpuid   type    cpu   mgm visual.
(#)    (str)    (%)   (%) (vis)
0        IFL  96.91  1.96 |############################################ |
1        IFL  81.82  1.46 |#####################################        |
2        IFL  88.00  2.43 |########################################     |
3        IFL  92.27  1.29 |##########################################   |
4        IFL  83.32  1.05 |#####################################        |
5        IFL  92.46  2.59 |##########################################   |
6        IFL   0.00  0.00 |                                             |
7        IFL   0.00  0.00 |                                             |
8        IFL   0.00  0.00 |                                             |
9        IFL   0.00  0.00 |                                             |
             534.79 10.78</pre></div><p>
    Output for the <span class="guimenu">sys</span> window under z/VM:
   </p><div class="verbatim-wrap"><pre class="screen">15:46:57 | T6360003 | CPU-T: UN(16)                  ? = help
cpuid     cpu visual
(#)       (%) (vis)
0      548.72 |#########################################    |
        548.72</pre></div></section><section class="sect2" id="sec-util-processes-iotop" data-id-title="A top-like I/O monitor: iotop"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.6 </span><span class="title-name">A top-like I/O monitor: <code class="command">iotop</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-processes-iotop">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="command">iotop</code> utility displays a table of I/O usage by
    processes or threads.
   </p><div id="id-1.8.4.2.9.8.3" data-id-title="Installing iotop" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Installing <code class="command">iotop</code></div><p>
     <code class="command">iotop</code> is not installed by default. You need to
     install it manually with <code class="command">zypper in iotop</code> as
     <code class="systemitem">root</code>.
    </p></div><p>
    <code class="command">iotop</code> displays columns for the I/O bandwidth read and
    written by each process during the sampling period. It also displays the
    percentage of time the process spent while swapping in and while waiting
    on I/O. For each process, its I/O priority (class/level) is shown. In
    addition, the total I/O bandwidth read and written during the sampling
    period is displayed at the top of the interface.
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The <span class="keycap">←</span> and <span class="keycap">→</span> keys
      change the sorting.
     </p></li><li class="listitem"><p>
      <span class="keycap">R</span> reverses the sort order.
     </p></li><li class="listitem"><p>
      <span class="keycap">O</span> toggles between showing all processes and threads
      (default view) and showing only those doing I/O. (This function is
      similar to adding <code class="option">--only</code> on command line.)
     </p></li><li class="listitem"><p>
      <span class="keycap">P</span> toggles between showing threads (default view) and
      processes. (This function is similar to <code class="option">--only</code>.)
     </p></li><li class="listitem"><p>
      <span class="keycap">A</span> toggles between showing the current I/O bandwidth
      (default view) and accumulated I/O operations since
      <code class="command">iotop</code> was started. (This function is similar to
      <code class="option">--accumulated</code>.)
     </p></li><li class="listitem"><p>
      <span class="keycap">I</span> lets you change the priority of a thread or a
      process's threads.
     </p></li><li class="listitem"><p>
      <span class="keycap">Q</span> quits <code class="command">iotop</code>.
     </p></li><li class="listitem"><p>
      Pressing any other key forces a refresh.
     </p></li></ul></div><p>
    Following is an example output of the command <code class="command">iotop
    --only</code>, while <code class="command">find</code> and
    <code class="command">emacs</code> are running:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>iotop --only
Total DISK READ: 50.61 K/s | Total DISK WRITE: 11.68 K/s
  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND
 3416 be/4 tux         50.61 K/s    0.00 B/s  0.00 %  4.05 % find /
  275 be/3 root        0.00 B/s    3.89 K/s  0.00 %  2.34 % [jbd2/sda2-8]
 5055 be/4 tux          0.00 B/s    3.89 K/s  0.00 %  0.04 % emacs</pre></div><p>
    <code class="command">iotop</code> can be also used in a batch mode
    (<code class="literal">-b</code>) and its output stored in a file for later
    analysis. For a complete set of options, see the manual page
    (<code class="command">man 8 iotop</code>).
   </p></section><section class="sect2" id="sec-util-processes-nice" data-id-title="Modify a processs niceness: nice and renice"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.7 </span><span class="title-name">Modify a process's niceness: <code class="command">nice</code> and <code class="command">renice</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-processes-nice">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The kernel determines which processes require more CPU time than others
    by the process's nice level, also called niceness. The higher the
    <span class="quote">“<span class="quote">nice</span>”</span> level of a process is, the less CPU time it takes from other processes. Nice levels range from -20 (the least
    <span class="quote">“<span class="quote">nice</span>”</span> level) to 19. Negative values can only be set by
    <code class="systemitem">root</code>.
   </p><p>
    Adjusting the niceness level is useful when running a non time-critical
    process that lasts long and uses large amounts of CPU time. For example,
    compiling a kernel on a system that also performs other tasks. Making
    such a process <span class="quote">“<span class="quote">nicer</span>”</span> ensures that the other tasks, for
    example, a Web server, have a higher priority.
   </p><p>
    Calling <code class="command">nice</code> without any parameters prints the
    current niceness:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>nice
0</pre></div><p>
    Running <code class="command">nice</code> <em class="replaceable">COMMAND</em>
    increments the current nice level for the given command by 10. Using
    <code class="command">nice</code> <code class="option">-n
    <em class="replaceable">LEVEL</em></code>
    <em class="replaceable">COMMAND</em> lets you specify a new niceness
    relative to the current one.
   </p><p>
    To change the niceness of a running process, use
    <code class="command">renice</code> <em class="replaceable">PRIORITY</em> <code class="option">-p
    <em class="replaceable">PROCESS_ID</em></code>, for example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>renice +5 3266</pre></div><p>
    To restore the niceness of all processes owned by a specific user, use the option
    <code class="option">-u <em class="replaceable">USER</em></code>.
    
    Process groups are reniced by the option <code class="option">-g <em class="replaceable">PROCESS_GROUP_ID</em></code>.
   </p></section></section><section class="sect1" id="sec-util-memory" data-id-title="Memory"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.4 </span><span class="title-name">Memory</span></span> <a title="Permalink" class="permalink" href="#sec-util-memory">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-util-memory-free" data-id-title="Memory usage: free"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.4.1 </span><span class="title-name">Memory usage: <code class="command">free</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-memory-free">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The utility <code class="command">free</code> examines RAM and swap usage. Details
    of both free and used memory and swap areas are shown:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>free
             total       used       free     shared    buffers     cached
Mem:      32900500   32703448     197052          0     255668    5787364
-/+ buffers/cache:   26660416    6240084
Swap:      2046972     304680    1742292</pre></div><p>
    The options <code class="option">-b</code>, <code class="option">-k</code>,
    <code class="option">-m</code>, <code class="option">-g</code> show the output in bytes, KB,
    MB, or GB, respectively. The parameter <code class="option">-s delay</code> ensures
    that the display is refreshed every <em class="replaceable">DELAY</em>
    seconds. For example, <code class="command">free -s 1.5</code> produces an update
    every 1.5 seconds.
   </p></section><section class="sect2" id="sec-util-memory-meminfo" data-id-title="Detailed memory usage: /proc/meminfo"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.4.2 </span><span class="title-name">Detailed memory usage: <code class="filename">/proc/meminfo</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-memory-meminfo">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use <code class="filename">/proc/meminfo</code> to get more detailed information
    on memory usage than with <code class="command">free</code>. In fact,
    <code class="command">free</code> uses a certain amount of data from this file. See an
    example output from a 64-bit system below, which differs slightly on 32-bit systems because of different memory management:
   </p><div class="verbatim-wrap"><pre class="screen">MemTotal:        1942636 kB
MemFree:         1294352 kB
MemAvailable:    1458744 kB
Buffers:             876 kB
Cached:           278476 kB
SwapCached:            0 kB
Active:           368328 kB
Inactive:         199368 kB
Active(anon):     288968 kB
Inactive(anon):    10568 kB
Active(file):      79360 kB
Inactive(file):   188800 kB
Unevictable:          80 kB
Mlocked:              80 kB
SwapTotal:       2103292 kB
SwapFree:        2103292 kB
Dirty:                44 kB
Writeback:             0 kB
AnonPages:        288592 kB
Mapped:            70444 kB
Shmem:             11192 kB
Slab:              40916 kB
SReclaimable:      17712 kB
SUnreclaim:        23204 kB
KernelStack:        2000 kB
PageTables:        10996 kB
NFS_Unstable:          0 kB
Bounce:                0 kB
WritebackTmp:          0 kB
CommitLimit:     3074608 kB
Committed_AS:    1407208 kB
VmallocTotal:   34359738367 kB
VmallocUsed:      145996 kB
VmallocChunk:   34359588844 kB
HardwareCorrupted:     0 kB
AnonHugePages:     86016 kB
HugePages_Total:       0
HugePages_Free:        0
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
DirectMap4k:       79744 kB
DirectMap2M:     2017280 kB</pre></div><p>
    These entries stand for the following:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.4.2.10.4.5.1"><span class="term"><span class="guimenu">MemTotal</span></span></dt><dd><p>
       Total amount of RAM.
      </p></dd><dt id="id-1.8.4.2.10.4.5.2"><span class="term"><span class="guimenu">MemFree</span></span></dt><dd><p>
       Amount of unused RAM.
      </p></dd><dt id="id-1.8.4.2.10.4.5.3"><span class="term"><span class="guimenu">MemAvailable</span></span></dt><dd><p>
       Estimate of how much memory is available for starting new applications
       without swapping.
      </p></dd><dt id="id-1.8.4.2.10.4.5.4"><span class="term"><span class="guimenu">Buffers</span></span></dt><dd><p>
       File buffer cache in RAM containing file system metadata.
      </p></dd><dt id="id-1.8.4.2.10.4.5.5"><span class="term"><span class="guimenu">Cached</span></span></dt><dd><p>
       Page cache in RAM.
       This excludes buffer cache and swap cache, but includes
       <span class="guimenu">Shmem</span> memory.
      </p></dd><dt id="id-1.8.4.2.10.4.5.6"><span class="term"><span class="guimenu">SwapCached</span></span></dt><dd><p>
       Page cache for swapped-out memory.
      </p></dd><dt id="id-1.8.4.2.10.4.5.7"><span class="term">
      <span class="guimenu">Active</span>, <span class="guimenu">Active(anon)</span>,
      <span class="guimenu">Active(file)</span>
     </span></dt><dd><p>
       Recently used memory that is not reclaimed unless necessary or on
       explicit request.
       <span class="guimenu">Active</span> is the sum of <span class="guimenu">Active(anon)</span>
       and <span class="guimenu">Active(file)</span>:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         <span class="guimenu">Active(anon)</span> tracks swap-backed memory.
         This includes private and shared anonymous mappings and
         private file pages after copy-on-write.
        </p></li><li class="listitem"><p>
         <span class="guimenu">Active(file)</span> tracks other file system backed
         memory.
        </p></li></ul></div></dd><dt id="id-1.8.4.2.10.4.5.8"><span class="term">
      <span class="guimenu">Inactive</span>, <span class="guimenu">Inactive(anon)</span>,
      <span class="guimenu">Inactive(file)</span>
     </span></dt><dd><p>
       Less recently used memory that is generally reclaimed first.
       <span class="guimenu">Inactive</span> is the sum of
       <span class="guimenu">Inactive(anon)</span> and <span class="guimenu">Inactive(file)</span>:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         <span class="guimenu">Inactive(anon)</span> tracks swap backed memory.
         This includes private and shared anonymous mappings and
         private file pages after copy-on-write.
        </p></li><li class="listitem"><p>
         <span class="guimenu">Inactive(file)</span> tracks other file system backed
         memory.
        </p></li></ul></div></dd><dt id="id-1.8.4.2.10.4.5.9"><span class="term"><span class="guimenu">Unevictable</span></span></dt><dd><p>
       Amount of memory that cannot be reclaimed (for example, because it is
       <span class="guimenu">Mlocked</span> or used as a RAM disk).
      </p></dd><dt id="id-1.8.4.2.10.4.5.10"><span class="term"><span class="guimenu">Mlocked</span></span></dt><dd><p>
       Amount of memory that is backed by the
       <code class="systemitem">mlock</code> system call.
       <code class="systemitem">mlock</code> allows processes to define which part of
       physical RAM their virtual memory should be mapped to.
       However, <code class="systemitem">mlock</code> does not guarantee this
       placement.
      </p></dd><dt id="id-1.8.4.2.10.4.5.11"><span class="term"><span class="guimenu">SwapTotal</span></span></dt><dd><p>
       Amount of swap space.
      </p></dd><dt id="id-1.8.4.2.10.4.5.12"><span class="term"><span class="guimenu">SwapFree</span></span></dt><dd><p>
       Amount of unused swap space.
      </p></dd><dt id="id-1.8.4.2.10.4.5.13"><span class="term"><span class="guimenu">Dirty</span>
     </span></dt><dd><p>
       Amount of memory waiting to be written to disk, because it contains
       changes compared to the backing storage. Dirty data can be explicitly
       synchronized either by the application or by the kernel after a short
       delay. A large amount of dirty data may take considerable time to write
       to disk resulting in stalls. The total amount of dirty data that can
       exist at any time can be controlled with the
       <code class="command">sysctl</code> parameters <code class="literal">vm.dirty_ratio</code>
       or <code class="literal">vm.dirty_bytes</code> (refer to <a class="xref" href="#cha-tuning-memory-usage-writeback" title="15.1.5. Writeback">Section 15.1.5, “Writeback”</a> for more details).
      </p></dd><dt id="id-1.8.4.2.10.4.5.14"><span class="term"><span class="guimenu">Writeback</span>
     </span></dt><dd><p>
       Amount of memory that is currently being written to disk.
      </p></dd><dt id="id-1.8.4.2.10.4.5.15"><span class="term"><span class="guimenu">Mapped</span>
     </span></dt><dd><p>
       Memory claimed with the <code class="systemitem">mmap</code> system call.
      </p></dd><dt id="id-1.8.4.2.10.4.5.16"><span class="term"><span class="guimenu">Shmem</span></span></dt><dd><p>
       Memory shared between groups of processes, such as IPC data,
       <code class="systemitem">tmpfs</code> data, and shared anonymous memory.
      </p></dd><dt id="id-1.8.4.2.10.4.5.17"><span class="term"><span class="guimenu">Slab</span></span></dt><dd><p>
       Memory allocation for internal data structures of the kernel.
      </p></dd><dt id="id-1.8.4.2.10.4.5.18"><span class="term"><span class="guimenu">SReclaimable</span></span></dt><dd><p>
       Slab section that can be reclaimed, such as caches (inode, dentry, etc.).
      </p></dd><dt id="id-1.8.4.2.10.4.5.19"><span class="term"><span class="guimenu">SUnreclaim</span></span></dt><dd><p>
       Slab section that cannot be reclaimed.
      </p></dd><dt id="id-1.8.4.2.10.4.5.20"><span class="term"><span class="guimenu">KernelStack</span></span></dt><dd><p>
       Amount of kernel space memory used by applications (through system calls).
      </p></dd><dt id="id-1.8.4.2.10.4.5.21"><span class="term"><span class="guimenu">PageTables</span></span></dt><dd><p>
       Amount of memory dedicated to page tables of all processes.
      </p></dd><dt id="id-1.8.4.2.10.4.5.22"><span class="term"><span class="guimenu">NFS_Unstable</span></span></dt><dd><p>
       NFS pages that have already been sent to the server, but are not yet
       committed there.
      </p></dd><dt id="id-1.8.4.2.10.4.5.23"><span class="term"><span class="guimenu">Bounce</span></span></dt><dd><p>
       Memory used for bounce buffers of block devices.
      </p></dd><dt id="id-1.8.4.2.10.4.5.24"><span class="term"><span class="guimenu">WritebackTmp</span></span></dt><dd><p>
       Memory used by FUSE for temporary writeback buffers.
      </p></dd><dt id="id-1.8.4.2.10.4.5.25"><span class="term"><span class="guimenu">CommitLimit</span></span></dt><dd><p>
       Amount of memory available to the system based on the overcommit
       ratio setting. This is only enforced if strict overcommit accounting
       is enabled.
      </p></dd><dt id="id-1.8.4.2.10.4.5.26"><span class="term"><span class="guimenu">Committed_AS</span></span></dt><dd><p>
       An approximation of the total amount of memory (RAM and swap) that the
       current workload would need in the worst case.
      </p></dd><dt id="id-1.8.4.2.10.4.5.27"><span class="term"><span class="guimenu">VmallocTotal</span></span></dt><dd><p>
       Amount of allocated kernel virtual address space.
      </p></dd><dt id="id-1.8.4.2.10.4.5.28"><span class="term"><span class="guimenu">VmallocUsed</span></span></dt><dd><p>
       Amount of used kernel virtual address space.
      </p></dd><dt id="id-1.8.4.2.10.4.5.29"><span class="term"><span class="guimenu">VmallocChunk</span></span></dt><dd><p>
       The largest contiguous block of available kernel virtual address space.
      </p></dd><dt id="id-1.8.4.2.10.4.5.30"><span class="term"><span class="guimenu">HardwareCorrupted</span></span></dt><dd><p>
       Amount of failed memory (can only be detected when using ECC RAM).
      </p></dd><dt id="id-1.8.4.2.10.4.5.31"><span class="term"><span class="guimenu">AnonHugePages</span></span></dt><dd><p>
       Anonymous hugepages that are mapped into user space page tables.
       These are allocated transparently for processes without being
       specifically requested, therefore they are also known as
       <span class="emphasis"><em>transparent hugepages</em></span> (THP).
      </p></dd><dt id="id-1.8.4.2.10.4.5.32"><span class="term"><span class="guimenu">HugePages_Total</span></span></dt><dd><p>
       Number of preallocated hugepages for use by
       <code class="systemitem">SHM_HUGETLB</code> and
       <code class="systemitem">MAP_HUGETLB</code> or through the
       <code class="systemitem">hugetlbfs</code> file system, as defined in
       <code class="filename">/proc/sys/vm/nr_hugepages</code>.
      </p></dd><dt id="id-1.8.4.2.10.4.5.33"><span class="term"><span class="guimenu">HugePages_Free</span></span></dt><dd><p>
       Number of hugepages available.
      </p></dd><dt id="id-1.8.4.2.10.4.5.34"><span class="term"><span class="guimenu">HugePages_Rsvd</span></span></dt><dd><p>
       Number of hugepages that are committed.
      </p></dd><dt id="id-1.8.4.2.10.4.5.35"><span class="term"><span class="guimenu">HugePages_Surp</span></span></dt><dd><p>
       Number of hugepages available beyond
       <span class="guimenu">HugePages_Total</span> (<span class="quote">“<span class="quote">surplus</span>”</span>), as defined
       in <code class="filename">/proc/sys/vm/nr_overcommit_hugepages</code>.
      </p></dd><dt id="id-1.8.4.2.10.4.5.36"><span class="term"><span class="guimenu">Hugepagesize</span></span></dt><dd><p>
       Size of a hugepage—on AMD64/Intel 64 the default is 2048 KB.
      </p></dd><dt id="id-1.8.4.2.10.4.5.37"><span class="term"><span class="guimenu">DirectMap4k</span> etc.</span></dt><dd><p>
       Amount of kernel memory that is mapped to pages with a given size (in the
       example: 4 kB).
      </p></dd></dl></div></section><section class="sect2" id="sec-util-memory-smaps" data-id-title="Process memory usage: smaps"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.4.3 </span><span class="title-name">Process memory usage: smaps</span></span> <a title="Permalink" class="permalink" href="#sec-util-memory-smaps">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Exactly determining how much memory a certain process is consuming is
    not possible with standard tools like <code class="command">top</code> or
    <code class="command">ps</code>. Use the smaps subsystem, introduced in kernel
    2.6.14, if you need exact data. It can be found at
    <code class="filename">/proc/<em class="replaceable">PID</em>/smaps</code> and
    shows you the number of clean and dirty memory pages the process with
    the ID <em class="replaceable">PID</em> is using at that time. It
    differentiates between shared and private memory, so you can see
    how much memory the process is using without including memory shared
    with other processes. For more information see
    <code class="filename">/usr/src/linux/Documentation/filesystems/proc.txt</code>
    (requires the package
    <code class="systemitem">kernel-source</code> to be
    installed).
   </p><p>
    smaps is expensive to read. Therefore it is not recommended to monitor
    it regularly, but only when closely monitoring a certain process.
   </p></section><section class="sect2" id="sec-util-memory-numatop" data-id-title="numaTOP"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.4.4 </span><span class="title-name">numaTOP</span></span> <a title="Permalink" class="permalink" href="#sec-util-memory-numatop">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      numaTOP is a tool for NUMA (Non-uniform Memory Access)
      systems. The tool helps to identify NUMA-related performance
      bottlenecks by providing real-time analysis of a NUMA system.
    </p><p>
      Generally speaking, numaTOP allows you to identify and
      investigate processes and threads with poor locality (that is
      poor ratio of local versus remote memory usage) by analyzing
      the number of Remote Memory Accesses (RMA), the number of Local Memory
      Accesses (LMA), and the RMA/LMA ratio.
    </p><p>
      numaTOP is supported on PowerPC and the following Intel Xeon
      processors: 5500-series, 6500/7500-series, 5600-series,
      E7-x8xx-series, and E5-16xx/24xx/26xx/46xx-series.
    </p><p>
      numaTOP is available in the official software repositories, and
      you can install the tool using the <code class="command">sudo zypper in
      numatop</code> command. To launch numaTOP, run the
      <code class="command">numatop</code> command. To get an overview of
      numaTOP functionality and usage, use the <code class="command">man
      numatop</code> command.
    </p></section></section><section class="sect1" id="sec-util-networking" data-id-title="Networking"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.5 </span><span class="title-name">Networking</span></span> <a title="Permalink" class="permalink" href="#sec-util-networking">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.8.4.2.11.2" data-id-title="Traffic shaping" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Traffic shaping</div><p>
    In case the network bandwidth is lower than expected, you should first
    check if any traffic shaping rules are active for your network segment.
   </p></div><section class="sect2" id="sec-util-networking-ip" data-id-title="Basic network diagnostics: ip"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.5.1 </span><span class="title-name">Basic network diagnostics: <code class="command">ip</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-networking-ip">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">ip</code> is a powerful tool to set up and control network
    interfaces. You can also use it to quickly view basic statistics about
    network interfaces of the system. For example, whether the interface is
    up or how many errors, dropped packets, or packet collisions there are.
   </p><p>
    If you run <code class="command">ip</code> with no additional parameter, it
    displays a help output. To list all network interfaces, enter
    <code class="command">ip addr show</code> (or abbreviated as <code class="command">ip
    a</code>). <code class="command">ip addr show up</code> lists only running
    network interfaces. <code class="command">ip -s link show</code>
    <em class="replaceable">DEVICE</em> lists statistics for the specified
    interface only:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ip -s link show br0
6: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT
    link/ether 00:19:d1:72:d4:30 brd ff:ff:ff:ff:ff:ff
    RX: bytes  packets  errors  dropped overrun mcast
    6346104756 9265517  0       10860   0       0
    TX: bytes  packets  errors  dropped carrier collsns
    3996204683 3655523  0       0       0       0</pre></div><p>
    <code class="command">ip</code> can also show interfaces
    (<code class="option">link</code>), routing tables (<code class="option">route</code>), and
    much more—refer to <code class="command">man 8 ip</code> for details.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ip route
default via 192.168.2.1 dev eth1
192.168.2.0/24 dev eth0  proto kernel  scope link  src 192.168.2.100
192.168.2.0/24 dev eth1  proto kernel  scope link  src 192.168.2.101
192.168.2.0/24 dev eth2  proto kernel  scope link  src 192.168.2.102</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ip link
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
    link/ether 52:54:00:44:30:51 brd ff:ff:ff:ff:ff:ff
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
    link/ether 52:54:00:a3:c1:fb brd ff:ff:ff:ff:ff:ff
4: eth2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
    link/ether 52:54:00:32:a4:09 brd ff:ff:ff:ff:ff:ff</pre></div></section><section class="sect2" id="sec-util-networking-nethogs" data-id-title="Show the network usage of processes: nethogs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.5.2 </span><span class="title-name">
    Show the network usage of processes: <code class="command">nethogs</code>
   </span></span> <a title="Permalink" class="permalink" href="#sec-util-networking-nethogs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    In certain cases, for example, if the network traffic suddenly becomes too high, it is desirable to quickly find out which applications are
    causing the traffic. <code class="command">nethogs</code>, a tool with a design
    similar to <code class="command">top</code>, shows incoming and outgoing traffic for
    all relevant processes:
   </p><div class="verbatim-wrap"><pre class="screen">PID   USER  PROGRAM                                DEV   SENT   RECEIVED
27145 root   zypper                                eth0  5.719  391.749 KB/sec
?     root   ..0:113:80c0:8080:10:160:0:100:30015        0.102    2.326 KB/sec
26635 tux    /usr/lib64/firefox/firefox            eth0  0.026    0.026 KB/sec
?     root   ..0:113:80c0:8080:10:160:0:100:30045        0.000    0.021 KB/sec
?     root   ..0:113:80c0:8080:10:160:0:100:30045        0.000    0.018 KB/sec
?     root   ..0:113:80c0:8080:10:160:0:100:30015        0.000    0.018 KB/sec
?     root   ..0:113:80c0:8080:10:160:0:100:30045        0.000    0.017 KB/sec
?     root   ..0:113:80c0:8080:10:160:0:100:30045        0.000    0.017 KB/sec
?     root   ..0:113:80c0:8080:10:160:0:100:30045        0.069    0.000 KB/sec
?     root   unknown TCP                                 0.000    0.000 KB/sec

TOTAL                                                  5.916  394.192 KB/sec</pre></div><p>
    Like in <code class="command">top</code>, <code class="command">nethogs</code> features
    interactive commands:
   </p><table style="border: 0; " class="simplelist"><tr><td><span class="keycap">M</span>: cycle between display modes (kb/s, kb, b, mb)
    </td></tr><tr><td><span class="keycap">R</span>: sort by <span class="guimenu">RECEIVED</span>
    </td></tr><tr><td><span class="keycap">S</span>: sort by <span class="guimenu">SENT</span></td></tr><tr><td><span class="keycap">Q</span>: quit</td></tr></table></section><section class="sect2" id="sec-util-networking-cards" data-id-title="Ethernet cards in detail: ethtool"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.5.3 </span><span class="title-name">Ethernet cards in detail: ethtool</span></span> <a title="Permalink" class="permalink" href="#sec-util-networking-cards">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">ethtool</code> can display and change detailed aspects of
    your Ethernet network device. By default it prints the current setting
    of the specified device.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ethtool eth0
Settings for eth0:
 Supported ports: [ TP ]
 Supported link modes:   10baseT/Half 10baseT/Full
                         100baseT/Half 100baseT/Full
                         1000baseT/Full
 Supports auto-negotiation: Yes
 Advertised link modes:  10baseT/Half 10baseT/Full
                         100baseT/Half 100baseT/Full
                         1000baseT/Full
 Advertised pause frame use: No
[...]
 Link detected: yes</pre></div><p>
    The following table shows <code class="command">ethtool</code> options that you
    can use to query the device for specific information:
   </p><div class="table" id="id-1.8.4.2.11.5.5" data-id-title="List of query options of ethtool"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 2.1: </span><span class="title-name">List of query options of <code class="command">ethtool</code> </span></span><a title="Permalink" class="permalink" href="#id-1.8.4.2.11.5.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="command">ethtool</code> option
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         it queries the device for
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         -a
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         pause parameter information
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         -c
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         interrupt coalescing information
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         -g
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Rx/Tx (receive/transmit) ring parameter information
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         -i
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         associated driver information
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         -k
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         offload information
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         -S
        </p>
       </td><td>
        <p>
         NIC and driver-specific statistics
        </p>
       </td></tr></tbody></table></div></div></section><section class="sect2" id="sec-util-networking-netstat" data-id-title="Show the network status: ss"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.5.4 </span><span class="title-name">Show the network status: <code class="command">ss</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-networking-netstat">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">ss</code> is a tool to dump socket statistics and replaces
    the <code class="command">netstat</code> command. To list all
    connections use <code class="command">ss</code> without parameters:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ss
Netid  State      Recv-Q Send-Q   Local Address:Port       Peer Address:Port
u_str  ESTAB      0      0                    * 14082                 * 14083
u_str  ESTAB      0      0                    * 18582                 * 18583
u_str  ESTAB      0      0                    * 19449                 * 19450
u_str  ESTAB      0      0      @/tmp/dbus-gmUUwXABPV 18784           * 18783
u_str  ESTAB      0      0      /var/run/dbus/system_bus_socket 19383 * 19382
u_str  ESTAB      0      0      @/tmp/dbus-gmUUwXABPV 18617           * 18616
u_str  ESTAB      0      0      @/tmp/dbus-58TPPDv8qv 19352           * 19351
u_str  ESTAB      0      0                    * 17658                 * 17657
u_str  ESTAB      0      0                    * 17693                 * 17694
[..]</pre></div><p>
    To show all network ports currently open, use the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ss -l
Netid  State      Recv-Q Send-Q      Local Address:Port  Peer Address:Port
nl     UNCONN     0      0                 rtnl:4195117                  *
nl     UNCONN     0      0       rtnl:wickedd-auto4/811                  *
nl     UNCONN     0      0       rtnl:wickedd-dhcp4/813                  *
nl     UNCONN     0      0                 rtnl:4195121                  *
nl     UNCONN     0      0                 rtnl:4195115                  *
nl     UNCONN     0      0       rtnl:wickedd-dhcp6/814                  *
nl     UNCONN     0      0                  rtnl:kernel                  *
nl     UNCONN     0      0             rtnl:wickedd/817                  *
nl     UNCONN     0      0                 rtnl:4195118                  *
nl     UNCONN     0      0                rtnl:nscd/706                  *
nl     UNCONN     4352   0              tcpdiag:ss/2381                  *
[...]</pre></div><p>
    When displaying network connections, you can specify the socket type to
    display: TCP (<code class="option">-t</code>) or UDP (<code class="option">-u</code>) for
    example. The <code class="option">-p</code> option shows the PID and name of the
    program to which each socket belongs.
   </p><p>
    The following example lists all TCP connections and the programs using
    these connections. The <code class="option">-a</code> option make sure all
    established connections (listening and non-listening) are shown. The
    <code class="option">-p</code> option shows the PID and name of the program to
    which each socket belongs.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ss -t -a -p
State    Recv-Q Send-Q  Local Address:Port   Peer Address:Port
LISTEN   0      128                  *:ssh                 *:*  users:(("sshd",1551,3))
LISTEN   0      100         127.0.0.1:smtp                 *:*  users:(("master",1704,13))
ESTAB    0      132      10.120.65.198:ssh  10.120.4.150:55715  users:(("sshd",2103,5))
LISTEN   0      128                 :::ssh                :::*  users:(("sshd",1551,4))
LISTEN   0      100               ::1:smtp                :::*  users:(("master",1704,14))</pre></div></section></section><section class="sect1" id="sec-util-proc" data-id-title="The /proc file system"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.6 </span><span class="title-name">The <code class="filename">/proc</code> file system</span></span> <a title="Permalink" class="permalink" href="#sec-util-proc">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="filename">/proc</code> file system is a pseudo file system in
   which the kernel reserves important information in the form of virtual
   files. For example, display the CPU type with this command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /proc/cpuinfo
processor       : 0
vendor_id       : GenuineIntel
cpu family      : 6
model           : 30
model name      : Intel(R) Core(TM) i5 CPU         750  @ 2.67GHz
stepping        : 5
microcode       : 0x6
cpu MHz         : 1197.000
cache size      : 8192 KB
physical id     : 0
siblings        : 4
core id         : 0
cpu cores       : 4
apicid          : 0
initial apicid  : 0
fpu             : yes
fpu_exception   : yes
cpuid level     : 11
wp              : yes
flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm sse4_1 sse4_2 popcnt lahf_lm ida dtherm tpr_shadow vnmi flexpriority ept vpid
bogomips        : 5333.85
clflush size    : 64
cache_alignment : 64
address sizes   : 36 bits physical, 48 bits virtual
power management:
[...]</pre></div><div id="id-1.8.4.2.12.4" data-id-title="Detailed processor information" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Detailed processor information</div><p>
    Detailed information about the processor on the AMD64/Intel 64 architecture is
    also available by running <code class="command">x86info</code>.
   </p></div><p>
   Query the allocation and use of interrupts with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /proc/interrupts
           CPU0       CPU1       CPU2       CPU3
  0:        121          0          0          0   IO-APIC-edge      timer
  8:          0          0          0          1   IO-APIC-edge      rtc0
  9:          0          0          0          0   IO-APIC-fasteoi   acpi
 16:          0      11933          0          0   IO-APIC-fasteoi   ehci_hcd:+
 18:          0          0          0          0   IO-APIC-fasteoi   i801_smbus
 19:          0     117978          0          0   IO-APIC-fasteoi   ata_piix,+
 22:          0          0    3275185          0   IO-APIC-fasteoi   enp5s1
 23:     417927          0          0          0   IO-APIC-fasteoi   ehci_hcd:+
 40:    2727916          0          0          0  HPET_MSI-edge      hpet2
 41:          0    2749134          0          0  HPET_MSI-edge      hpet3
 42:          0          0    2759148          0  HPET_MSI-edge      hpet4
 43:          0          0          0    2678206  HPET_MSI-edge      hpet5
 45:          0          0          0          0   PCI-MSI-edge      aerdrv, P+
 46:          0          0          0          0   PCI-MSI-edge      PCIe PME,+
 47:          0          0          0          0   PCI-MSI-edge      PCIe PME,+
 48:          0          0          0          0   PCI-MSI-edge      PCIe PME,+
 49:          0          0          0        387   PCI-MSI-edge      snd_hda_i+
 50:     933117          0          0          0   PCI-MSI-edge      nvidia
NMI:       2102       2023       2031       1920   Non-maskable interrupts
LOC:         92         71         57         41   Local timer interrupts
SPU:          0          0          0          0   Spurious interrupts
PMI:       2102       2023       2031       1920   Performance monitoring int+
IWI:      47331      45725      52464      46775   IRQ work interrupts
RTR:          2          0          0          0   APIC ICR read retries
RES:     472911     396463     339792     323820   Rescheduling interrupts
CAL:      48389      47345      54113      50478   Function call interrupts
TLB:      28410      26804      24389      26157   TLB shootdowns
TRM:          0          0          0          0   Thermal event interrupts
THR:          0          0          0          0   Threshold APIC interrupts
MCE:          0          0          0          0   Machine check exceptions
MCP:         40         40         40         40   Machine check polls
ERR:          0
MIS:          0</pre></div><p>
   The address assignment of executables and libraries is contained in the
   <code class="filename">maps</code> file:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /proc/self/maps
08048000-0804c000 r-xp 00000000 03:03 17753      /bin/cat
0804c000-0804d000 rw-p 00004000 03:03 17753      /bin/cat
0804d000-0806e000 rw-p 0804d000 00:00 0          [heap]
b7d27000-b7d5a000 r--p 00000000 03:03 11867      /usr/lib/locale/en_GB.utf8/
b7d5a000-b7e32000 r--p 00000000 03:03 11868      /usr/lib/locale/en_GB.utf8/
b7e32000-b7e33000 rw-p b7e32000 00:00 0
b7e33000-b7f45000 r-xp 00000000 03:03 8837       /lib/libc-2.3.6.so
b7f45000-b7f46000 r--p 00112000 03:03 8837       /lib/libc-2.3.6.so
b7f46000-b7f48000 rw-p 00113000 03:03 8837       /lib/libc-2.3.6.so
b7f48000-b7f4c000 rw-p b7f48000 00:00 0
b7f52000-b7f53000 r--p 00000000 03:03 11842      /usr/lib/locale/en_GB.utf8/
[...]
b7f5b000-b7f61000 r--s 00000000 03:03 9109       /usr/lib/gconv/gconv-module
b7f61000-b7f62000 r--p 00000000 03:03 9720       /usr/lib/locale/en_GB.utf8/
b7f62000-b7f76000 r-xp 00000000 03:03 8828       /lib/ld-2.3.6.so
b7f76000-b7f78000 rw-p 00013000 03:03 8828       /lib/ld-2.3.6.so
bfd61000-bfd76000 rw-p bfd61000 00:00 0          [stack]
ffffe000-fffff000 ---p 00000000 00:00 0          [vdso]</pre></div><p>
   A lot more information can be obtained from the <code class="filename">/proc</code> file system. Some
   important files and their contents are:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.4.2.12.10.1"><span class="term"><code class="filename">/proc/devices</code>
    </span></dt><dd><p>
      Available devices
     </p></dd><dt id="id-1.8.4.2.12.10.2"><span class="term"><code class="filename">/proc/modules</code>
    </span></dt><dd><p>
      Kernel modules loaded
     </p></dd><dt id="id-1.8.4.2.12.10.3"><span class="term"><code class="filename">/proc/cmdline</code>
    </span></dt><dd><p>
      Kernel command line
     </p></dd><dt id="id-1.8.4.2.12.10.4"><span class="term"><code class="filename">/proc/meminfo</code>
    </span></dt><dd><p>
      Detailed information about memory usage
     </p></dd><dt id="id-1.8.4.2.12.10.5"><span class="term"><code class="filename">/proc/config.gz</code>
    </span></dt><dd><p>
      <code class="command">gzip</code>-compressed configuration file of the kernel
      currently running
     </p></dd><dt id="id-1.8.4.2.12.10.6"><span class="term">/proc/<em class="replaceable">PID/</em>
    </span></dt><dd><p>
      Find information about processes currently running in the
      <code class="filename">/proc/</code><em class="replaceable">NNN</em> directories,
      where <em class="replaceable">NNN</em> is the process ID (PID) of the
      relevant process. Every process can find its own characteristics in
      <code class="filename">/proc/self/</code>.
     </p></dd></dl></div><p>
   Further information is available in the text file
   <code class="filename">/usr/src/linux/Documentation/filesystems/proc.txt</code>
   (this file is available when the package
   <code class="systemitem">kernel-source</code> is installed).
  </p><section class="sect2" id="sec-util-proc-procinfo" data-id-title="procinfo"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.6.1 </span><span class="title-name"><code class="command">procinfo</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-proc-procinfo">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Important information from the <code class="filename">/proc</code> file system is
    summarized by the command <code class="command">procinfo</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>procinfo
Linux 3.11.10-17-desktop (geeko@buildhost) (gcc 4.8.1 20130909) #1 4CPU [jupiter.example.com]

Memory:      Total        Used        Free      Shared     Buffers      Cached
Mem:       8181908     8000632      181276           0       85472     2850872
Swap:     10481660        1576    10480084

Bootup: Mon Jul 28 09:54:13 2014    Load average: 1.61 0.85 0.74 2/904 25949

user  :       1:54:41.84  12.7%  page in :    2107312  disk 1:    52212r   20199w
nice  :       0:00:00.46   0.0%  page out:    1714461  disk 2:    19387r   10928w
system:       0:25:38.00   2.8%  page act:     466673  disk 3:      548r      10w
IOwait:       0:04:16.45   0.4%  page dea:     272297
hw irq:       0:00:00.42   0.0%  page flt:  105754526
sw irq:       0:01:26.48   0.1%  swap in :          0
idle  :      12:14:43.65  81.5%  swap out:        394
guest :       0:02:18.59   0.2%
uptime:       3:45:22.24         context :   99809844

irq  0:       121 timer                 irq 41:   3238224 hpet3
irq  8:         1 rtc0                  irq 42:   3251898 hpet4
irq  9:         0 acpi                  irq 43:   3156368 hpet5
irq 16:     14589 ehci_hcd:usb1         irq 45:         0 aerdrv, PCIe PME
irq 18:         0 i801_smbus            irq 46:         0 PCIe PME, pciehp
irq 19:    124861 ata_piix, ata_piix, f irq 47:         0 PCIe PME, pciehp
irq 22:   3742817 enp5s1                irq 48:         0 PCIe PME, pciehp
irq 23:    479248 ehci_hcd:usb2         irq 49:       387 snd_hda_intel
irq 40:   3216894 hpet2                 irq 50:   1088673 nvidia</pre></div><p>
    To see all the information, use the parameter <code class="option">-a</code>. The
    parameter <code class="option">-nN</code> produces updates of the information every
    <em class="replaceable">N</em> seconds. In this case, stop the
    program by pressing <span class="keycap">Q</span>.
   </p><p>
    By default, the cumulative values are displayed. The parameter
    <code class="option">-d</code> produces the differential values. <code class="command">procinfo
    -dn5</code> displays the values that have changed in the last five
    seconds:
   </p></section><section class="sect2" id="sec-util-proc-procinfo-sysctl" data-id-title="System control parameters: /proc/sys/"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.6.2 </span><span class="title-name">System control parameters: <code class="filename">/proc/sys/</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-proc-procinfo-sysctl">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    System control parameters are used to modify the Linux kernel parameters
    at runtime. They reside in <code class="filename">/proc/sys/</code> and can be
    viewed and modified with the <code class="command">sysctl</code> command. To list
    all parameters, run <code class="command">sysctl</code> <code class="option">-a</code>. A
    single parameter can be listed with <code class="command">sysctl</code>
    <em class="replaceable">PARAMETER_NAME</em>.
   </p><p>
    Parameters are grouped into categories and can be listed with
    <code class="command">sysctl</code> <em class="replaceable">CATEGORY</em> or by
    listing the contents of the respective directories. The most important
    categories are listed below. The links to further readings require the
    installation of the package
    <code class="systemitem">kernel-source</code>.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.4.2.12.13.4.1"><span class="term"><code class="command">sysctl dev</code> (<code class="filename">/proc/sys/dev/</code>)</span></dt><dd><p>
       Device-specific information.
      </p></dd><dt id="id-1.8.4.2.12.13.4.2"><span class="term"><code class="command">sysctl fs</code> (<code class="filename">/proc/sys/fs/</code>)</span></dt><dd><p>
       Used file handles, quotas, and other file system-oriented parameters.
       For details see
       <code class="filename">/usr/src/linux/Documentation/sysctl/fs.txt</code>.
      </p></dd><dt id="id-1.8.4.2.12.13.4.3"><span class="term"><code class="command">sysctl kernel</code> (<code class="filename">/proc/sys/kernel/</code>)</span></dt><dd><p>
       Information about the task scheduler, system shared memory, and other
       kernel-related parameters. For details see
       <code class="filename">/usr/src/linux/Documentation/sysctl/kernel.txt</code>
      </p></dd><dt id="id-1.8.4.2.12.13.4.4"><span class="term"><code class="command">sysctl net</code> (<code class="filename">/proc/sys/net/</code>)</span></dt><dd><p>
       Information about network bridges, and general network parameters
       (mainly the <code class="filename">ipv4/</code> subdirectory). For details see
       <code class="filename">/usr/src/linux/Documentation/sysctl/net.txt</code>
      </p></dd><dt id="id-1.8.4.2.12.13.4.5"><span class="term"><code class="command">sysctl vm</code> (<code class="filename">/proc/sys/vm/</code>)</span></dt><dd><p>
       Entries in this path relate to information about the virtual memory,
       swapping, and caching. For details see
       <code class="filename">/usr/src/linux/Documentation/sysctl/vm.txt</code>
      </p></dd></dl></div><p>
    To set or change a parameter for the current session, use the command
    <code class="command">sysctl</code> <code class="option">-w</code>
    <em class="replaceable">PARAMETER</em>=<em class="replaceable">VALUE</em>.
    To permanently change a setting, add a line
    <em class="replaceable">PARAMETER</em>=<em class="replaceable">VALUE</em> to
    <code class="filename">/etc/sysctl.conf</code>.
   </p></section></section><section class="sect1" id="sec-util-hardware" data-id-title="Hardware information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.7 </span><span class="title-name">Hardware information</span></span> <a title="Permalink" class="permalink" href="#sec-util-hardware">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-util-hardware-lspci" data-id-title="PCI resources: lspci"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.7.1 </span><span class="title-name">PCI resources: <code class="command">lspci</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-hardware-lspci">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.8.4.2.13.3.2" data-id-title="Accessing PCI configuration." class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Accessing PCI configuration.</div><p>
     Most operating systems require root user privileges to grant access to
     the computer's PCI configuration.
    </p></div><p>
    The command <code class="command">lspci</code> lists the PCI resources:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>lspci
00:00.0 Host bridge: Intel Corporation 82845G/GL[Brookdale-G]/GE/PE \
    DRAM Controller/Host-Hub Interface (rev 01)
00:01.0 PCI bridge: Intel Corporation 82845G/GL[Brookdale-G]/GE/PE \
    Host-to-AGP Bridge (rev 01)
00:1d.0 USB Controller: Intel Corporation 82801DB/DBL/DBM \
    (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #1 (rev 01)
00:1d.1 USB Controller: Intel Corporation 82801DB/DBL/DBM \
    (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #2 (rev 01)
00:1d.2 USB Controller: Intel Corporation 82801DB/DBL/DBM \
    (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #3 (rev 01)
00:1d.7 USB Controller: Intel Corporation 82801DB/DBM \
    (ICH4/ICH4-M) USB2 EHCI Controller (rev 01)
00:1e.0 PCI bridge: Intel Corporation 82801 PCI Bridge (rev 81)
00:1f.0 ISA bridge: Intel Corporation 82801DB/DBL (ICH4/ICH4-L) \
    LPC Interface Bridge (rev 01)
00:1f.1 IDE interface: Intel Corporation 82801DB (ICH4) IDE \
    Controller (rev 01)
00:1f.3 SMBus: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) \
    SMBus Controller (rev 01)
00:1f.5 Multimedia audio controller: Intel Corporation 82801DB/DBL/DBM \
    (ICH4/ICH4-L/ICH4-M) AC'97 Audio Controller (rev 01)
01:00.0 VGA compatible controller: Matrox Graphics, Inc. G400/G450 (rev 85)
02:08.0 Ethernet controller: Intel Corporation 82801DB PRO/100 VE (LOM) \
    Ethernet Controller (rev 81)</pre></div><p>
    Using <code class="option">-v</code> results in a more detailed listing:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>lspci -v
[...]
00:03.0 Ethernet controller: Intel Corporation 82540EM Gigabit Ethernet \
Controller (rev 02)
  Subsystem: Intel Corporation PRO/1000 MT Desktop Adapter
  Flags: bus master, 66MHz, medium devsel, latency 64, IRQ 19
  Memory at f0000000 (32-bit, non-prefetchable) [size=128K]
  I/O ports at d010 [size=8]
  Capabilities: [dc] Power Management version 2
  Capabilities: [e4] PCI-X non-bridge device
  Kernel driver in use: e1000
  Kernel modules: e1000</pre></div><p>
    Information about device name resolution is obtained from the file
    <code class="filename">/usr/share/pci.ids</code>. PCI IDs not listed in this file
    are marked <span class="quote">“<span class="quote">Unknown device.</span>”</span>
   </p><p>
    The parameter <code class="option">-vv</code> produces all the information that
    could be queried by the program. To view the pure numeric values, use
    the parameter <code class="option">-n</code>.
   </p></section><section class="sect2" id="sec-util-hardware-lsusb" data-id-title="USB devices: lsusb"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.7.2 </span><span class="title-name">USB devices: <code class="command">lsusb</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-hardware-lsusb">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The command <code class="command">lsusb</code> lists all USB devices. With the
    option <code class="option">-v</code>, print a more detailed list. The detailed
    information is read from the directory
    <code class="filename">/proc/bus/usb/</code>. The following is the output of
    <code class="command">lsusb</code> with these USB devices attached: hub, memory
    stick, hard disk and mouse.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>lsusb
Bus 004 Device 007: ID 0ea0:2168 Ours Technology, Inc. Transcend JetFlash \
    2.0 / Astone USB Drive
Bus 004 Device 006: ID 04b4:6830 Cypress Semiconductor Corp. USB-2.0 IDE \
    Adapter
Bus 004 Device 005: ID 05e3:0605 Genesys Logic, Inc.
Bus 004 Device 001: ID 0000:0000
Bus 003 Device 001: ID 0000:0000
Bus 002 Device 001: ID 0000:0000
Bus 001 Device 005: ID 046d:c012 Logitech, Inc. Optical Mouse
Bus 001 Device 001: ID 0000:0000</pre></div></section><section class="sect2" id="sec-util-hardware-tmon" data-id-title="Monitoring and tuning the thermal subsystem: tmon"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.7.3 </span><span class="title-name">
    Monitoring and tuning the thermal subsystem: <code class="command">tmon</code>
   </span></span> <a title="Permalink" class="permalink" href="#sec-util-hardware-tmon">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">tmon</code> is a tool to help visualize, tune, and test the
    complex thermal subsystem. When started without parameters,
    <code class="command">tmon</code> runs in monitoring mode:
   </p><div class="verbatim-wrap"><pre class="screen">┌──────THERMAL ZONES(SENSORS)──────────────────────────────┐
│Thermal Zones:                 acpitz00                   │
│Trip Points:                   PC                         │
└──────────────────────────────────────────────────────────┘
┌─────────── COOLING DEVICES ──────────────────────────────┐
│ID  Cooling Dev   Cur    Max   Thermal Zone Binding       │
│00    Processor     0      3   ││││││││││││               │
│01    Processor     0      3   ││││││││││││               │
│02    Processor     0      3   ││││││││││││               │
│03    Processor     0      3   ││││││││││││               │
│04 intel_powerc    -1     50   ││││││││││││               │
└──────────────────────────────────────────────────────────┘
┌──────────────────────────────────────────────────────────┐
│                         10        20        30        40 │
│acpitz 0:[  8][&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;P9                    C31         │
└──────────────────────────────────────────────────────────┘
┌────────────────── CONTROLS ──────────────────────────────┐
│PID gain: kp=0.36 ki=5.00 kd=0.19 Output 0.00             │
│Target Temp: 65.0C, Zone: 0, Control Device: None         │
└──────────────────────────────────────────────────────────┘

Ctrl-c - Quit   TAB - Tuning</pre></div><p>
    For detailed information on how to interpret the data, how to log thermal
    data and how to use <code class="command">tmon</code> to test and tune cooling
    devices and sensors, refer to the man page: <code class="command">man 8
    tmon</code>. The package <span class="package">tmon</span> is not installed by
    default.
   </p></section><section class="sect2" id="sec-util-hardware-mcelog" data-id-title="MCELog: machine check exceptions (MCE)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.7.4 </span><span class="title-name">MCELog: machine check exceptions (MCE)</span></span> <a title="Permalink" class="permalink" href="#sec-util-hardware-mcelog">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.8.4.2.13.6.2" data-id-title="Availability" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Availability</div><p>This tool is only available on AMD64/Intel 64 systems.</p></div><p>
    The <code class="systemitem">mcelog</code> package logs and
    parses/translates Machine Check Exceptions (MCE) on hardware errors, including
    I/O, CPU, and memory errors. Additionally, mcelog handles predictive bad page
    offlining and automatic core offlining when cache errors happen.
    Formerly this was managed by a cron job executed hourly. Now hardware
    errors are immediately processed by an mcelog daemon.
   </p><div id="id-1.8.4.2.13.6.4" data-id-title="Support for AMD scalable MCA" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Support for AMD scalable MCA</div><p>
     <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> supports AMD's Scalable Machine Check
     Architecture (Scalable MCA). Scalable MCA improves hardware error
     reporting in AMD Zen processors. It expands information logged in
     MCA banks for improved error handling and better diagnosability.
    </p><p>
     <code class="systemitem">mcelog</code> captures MCA messages
     (<code class="systemitem">rasdaemon</code> and
     <code class="systemitem">dmesg</code> also capture MCA messages).
     See section 3.1, <em class="citetitle">Machine Check Architecture</em> of
     <em class="citetitle">Processor Programming Reference (PPR) for AMD Family
     17h Model 01h, Revision B1 Processors</em> for detailed
     information,
     <a class="link" href="https://developer.amd.com/wordpress/media/2017/11/54945_PPR_Family_17h_Models_00h-0Fh.pdf" target="_blank">https://developer.amd.com/wordpress/media/2017/11/54945_PPR_Family_17h_Models_00h-0Fh.pdf</a>.
    </p></div><p>
    mcelog is configured in <code class="filename">/etc/mcelog/mcelog.conf</code>.
    Configuration options are documented in
    <code class="command">man mcelog</code>, and at
    <a class="link" href="https://mcelog.org/" target="_blank">https://mcelog.org/</a>. The following example shows
    only changes to the default file:
   </p><div class="verbatim-wrap"><pre class="screen">daemon = yes
filter = yes
filter-memory-errors = yes
no-syslog = yes
logfile = /var/log/mcelog
run-credentials-user = root
run-credentials-group = nobody
client-group = root
socket-path = /var/run/mcelog-client</pre></div><p>
    The mcelog service is not enabled by default. The service can either be
    enabled and started via the YaST system services editor, or via command line:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl enable mcelog
<code class="prompt root"># </code>systemctl start mcelog</pre></div></section><section class="sect2" id="sec-util-hardware-dmicecode" data-id-title="AMD64/Intel 64: dmidecode: DMI table decoder"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.7.5 </span><span class="title-name">AMD64/Intel 64: dmidecode: DMI table decoder</span></span> <a title="Permalink" class="permalink" href="#sec-util-hardware-dmicecode">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">dmidecode</code> shows the machine's DMI table containing
    information such as serial numbers and BIOS revisions of the hardware.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>dmidecode
# dmidecode 2.12
SMBIOS 2.5 present.
27 structures occupying 1298 bytes.
Table at 0x000EB250.

Handle 0x0000, DMI type 4, 35 bytes
Processor Information
        Socket Designation: J1PR
        Type: Central Processor
        Family: Other
        Manufacturer: Intel(R) Corporation
        ID: E5 06 01 00 FF FB EB BF
        Version: Intel(R) Core(TM) i5 CPU         750  @ 2.67GHz
        Voltage: 1.1 V
        External Clock: 133 MHz
        Max Speed: 4000 MHz
        Current Speed: 2667 MHz
        Status: Populated, Enabled
        Upgrade: Other
        L1 Cache Handle: 0x0004
        L2 Cache Handle: 0x0003
        L3 Cache Handle: 0x0001
        Serial Number: Not Specified
        Asset Tag: Not Specified
        Part Number: Not Specified
[..]</pre></div></section><section class="sect2" id="sec-util-hardware-lshw" data-id-title="POWER: list hardware"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.7.6 </span><span class="title-name">POWER: list hardware</span></span> <a title="Permalink" class="permalink" href="#sec-util-hardware-lshw">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">lshw</code> extracts and displays the hardware
    configuration of the machine.
   </p></section></section><section class="sect1" id="sec-util-file" data-id-title="Files and file systems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.8 </span><span class="title-name">Files and file systems</span></span> <a title="Permalink" class="permalink" href="#sec-util-file">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-util-file-file" data-id-title="Determine the file type: file"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.8.1 </span><span class="title-name">Determine the file type: <code class="command">file</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-file-file">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The command <code class="command">file</code> determines the type of a file or a
    list of files by checking <code class="filename">/usr/share/misc/magic</code>.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>file /usr/bin/file
/usr/bin/file: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), \
    for GNU/Linux 2.6.4, dynamically linked (uses shared libs), stripped</pre></div><p>
    The parameter <code class="option">-f <em class="replaceable">LIST</em></code>
    specifies a file with a list of file names to examine. The
    <code class="option">-z</code> allows <code class="command">file</code> to look inside
    compressed files:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>file /usr/share/man/man1/file.1.gz
/usr/share/man/man1/file.1.gz: gzip compressed data, from Unix, max compression
<code class="prompt user">&gt; </code>file -z /usr/share/man/man1/file.1.gz
/usr/share/man/man1/file.1.gz: troff or preprocessor input text \
    (gzip compressed data, from Unix, max compression)</pre></div><p>
    The parameter <code class="option">-i</code> outputs a mime type string rather than
    the traditional description.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>file -i /usr/share/misc/magic
/usr/share/misc/magic: text/plain charset=utf-8</pre></div></section><section class="sect2" id="sec-util-file-mount-dudf" data-id-title="File systems and their usage: mount, df and du"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.8.2 </span><span class="title-name">File systems and their usage: <code class="command">mount</code>, <code class="command">df</code> and <code class="command">du</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-file-mount-dudf">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The command <code class="command">mount</code> shows which file system (device and
    type) is mounted at which mount point:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>mount
/dev/sda2 on / type ext4 (rw,acl,user_xattr)
proc on /proc type proc (rw)
sysfs on /sys type sysfs (rw)
debugfs on /sys/kernel/debug type debugfs (rw)
devtmpfs on /dev type devtmpfs (rw,mode=0755)
tmpfs on /dev/shm type tmpfs (rw,mode=1777)
devpts on /dev/pts type devpts (rw,mode=0620,gid=5)
/dev/sda3 on /home type ext3 (rw)
securityfs on /sys/kernel/security type securityfs (rw)
fusectl on /sys/fs/fuse/connections type fusectl (rw)
gvfs-fuse-daemon on /home/tux/.gvfs type fuse.gvfs-fuse-daemon \
(rw,nosuid,nodev,user=tux)</pre></div><p>
    Obtain information about total usage of the file systems with the
    command <code class="command">df</code>. The parameter <code class="option">-h</code> (or
    <code class="option">--human-readable</code>) transforms the output into a form
    understandable for common users.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>df -h
Filesystem            Size  Used Avail Use% Mounted on
/dev/sda2              20G  5,9G   13G  32% /
devtmpfs              1,6G  236K  1,6G   1% /dev
tmpfs                 1,6G  668K  1,6G   1% /dev/shm
/dev/sda3             208G   40G  159G  20% /home</pre></div><p>
    Display the total size of all the files in a given directory and its
    subdirectories with the command <code class="command">du</code>. The parameter
    <code class="option">-s</code> suppresses the output of detailed information and
    gives only a total for each argument. <code class="option">-h</code> again
    transforms the output into a human-readable form:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>du -sh /opt
192M    /opt</pre></div></section><section class="sect2" id="sec-util-file-readelf" data-id-title="Additional information about ELF binaries"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.8.3 </span><span class="title-name">Additional information about ELF binaries</span></span> <a title="Permalink" class="permalink" href="#sec-util-file-readelf">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Read the content of binaries with the <code class="command">readelf</code>
    utility. This even works with ELF files that were built for other
    hardware architectures:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>readelf --file-header /bin/ls
ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              EXEC (Executable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x402540
  Start of program headers:          64 (bytes into file)
  Start of section headers:          95720 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           56 (bytes)
  Number of program headers:         9
  Size of section headers:           64 (bytes)
  Number of section headers:         32
  Section header string table index: 31</pre></div></section><section class="sect2" id="sec-util-file-stat" data-id-title="File properties: stat"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.8.4 </span><span class="title-name">File properties: <code class="command">stat</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-file-stat">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The command <code class="command">stat</code> displays file properties:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>stat /etc/profile
  File: `/etc/profile'
  Size: 9662            Blocks: 24         IO Block: 4096   regular file
Device: 802h/2050d      Inode: 132349      Links: 1
Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2009-03-20 07:51:17.000000000 +0100
Modify: 2009-01-08 19:21:14.000000000 +0100
Change: 2009-03-18 12:55:31.000000000 +0100</pre></div><p>
    The parameter <code class="option">--file-system</code> produces details of the
    properties of the file system in which the specified file is located:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>stat /etc/profile --file-system
  File: "/etc/profile"
    ID: d4fb76e70b4d1746 Namelen: 255     Type: ext2/ext3
Block size: 4096       Fundamental block size: 4096
Blocks: Total: 2581445    Free: 1717327    Available: 1586197
Inodes: Total: 655776     Free: 490312</pre></div></section></section><section class="sect1" id="sec-util-user" data-id-title="User information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.9 </span><span class="title-name">User information</span></span> <a title="Permalink" class="permalink" href="#sec-util-user">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-util-system-fuser" data-id-title="User accessing files: fuser"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.9.1 </span><span class="title-name">User accessing files: <code class="command">fuser</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-system-fuser">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    It can be useful to determine what processes or users are currently
    accessing certain files. Suppose, for example, you want to unmount a
    file system mounted at <code class="filename">/mnt</code>.
    <code class="command">umount</code> returns "device is busy." The command
    <code class="command">fuser</code> can then be used to determine what processes
    are accessing the device:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>fuser -v /mnt/*

                     USER        PID ACCESS COMMAND
/mnt/notes.txt       tux    26597 f....  less</pre></div><p>
    Following termination of the <code class="command">less</code> process, which was
    running on another terminal, the file system can successfully be
    unmounted. When used with <code class="option">-k</code> option,
    <code class="command">fuser</code> stops processes accessing the file as
    well.
   </p></section><section class="sect2" id="sec-util-user-w" data-id-title="Who is doing what: w"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.9.2 </span><span class="title-name">Who is doing what: <code class="command">w</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-user-w">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    With the command <code class="command">w</code>, find out who is logged in to the
    system and what each user is doing. For example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>w
 16:00:59 up 1 day,  2:41,  3 users,  load average: 0.00, 0.01, 0.05
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
tux      :0       console          Wed13   ?xdm?   8:15   0.03s /usr/lib/gdm/gd
tux      console  :0               Wed13   26:41m  0.00s  0.03s /usr/lib/gdm/gd
tux      pts/0    :0               Wed13   20:11   0.10s  2.89s /usr/lib/gnome-</pre></div><p>
    If any users of other systems have logged in remotely, the parameter
    <code class="option">-f</code> shows the computers from which they have established
    the connection.
    
   </p></section></section><section class="sect1" id="sec-util-time" data-id-title="Time and date"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.10 </span><span class="title-name">Time and date</span></span> <a title="Permalink" class="permalink" href="#sec-util-time">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-util-time-time" data-id-title="Time measurement with time"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.10.1 </span><span class="title-name">Time measurement with <code class="command">time</code></span></span> <a title="Permalink" class="permalink" href="#sec-util-time-time">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Determine the time spent by commands with the <code class="command">time</code>
    utility. This utility is available in two versions: as a Bash built-in
    and as a program (<code class="command">/usr/bin/time</code>).
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>time find . &gt; /dev/null

real    0m4.051s<span class="callout" id="co-util-time-real">1</span>
user    0m0.042s<span class="callout" id="co-util-time-user">2</span>
sys     0m0.205s<span class="callout" id="co-util-time-sys">3</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-util-time-real"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      The real time that elapsed from the command's start-up until it
      finished.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-util-time-user"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      CPU time of the user as reported by the <code class="literal">times</code>
      system call.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-util-time-sys"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      CPU time of the system as reported by the <code class="literal">times</code>
      system call.
     </p></td></tr></table></div><p>
    The output of <code class="filename">/usr/bin/time</code> is much more detailed.
    It is recommended to run it with the <code class="option">-v</code> switch to
    produce human-readable output.
   </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/time -v find . &gt; /dev/null
        Command being timed: "find ."
        User time (seconds): 0.24
        System time (seconds): 2.08
        Percent of CPU this job got: 25%
        Elapsed (wall clock) time (h:mm:ss or m:ss): 0:09.03
        Average shared text size (kbytes): 0
        Average unshared data size (kbytes): 0
        Average stack size (kbytes): 0
        Average total size (kbytes): 0
        Maximum resident set size (kbytes): 2516
        Average resident set size (kbytes): 0
        Major (requiring I/O) page faults: 0
        Minor (reclaiming a frame) page faults: 1564
        Voluntary context switches: 36660
        Involuntary context switches: 496
        Swaps: 0
        File system inputs: 0
        File system outputs: 0
        Socket messages sent: 0
        Socket messages received: 0
        Signals delivered: 0
        Page size (bytes): 4096
        Exit status: 0</pre></div></section></section><section class="sect1" id="sec-util-rrdtool" data-id-title="Graph your data: RRDtool"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.11 </span><span class="title-name">Graph your data: RRDtool</span></span> <a title="Permalink" class="permalink" href="#sec-util-rrdtool">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are a lot of data in the world around you, which can be easily
   measured in time. For example, changes in the temperature, or the number
   of data sent or received by your computer's network interface. RRDtool
   can help you store and visualize such data in detailed and customizable
   graphs.
  </p><p>
   RRDtool is available for most Unix platforms and Linux distributions.
   <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span> ships RRDtool as well. Install it either with
   YaST or by entering
  </p><p>
   <code class="command">zypper</code> <code class="option">install</code>
   <em class="replaceable">rrdtool</em> in the command line as <code class="systemitem">root</code>.
  </p><div id="id-1.8.4.2.17.5" data-id-title="Bindings" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Bindings</div><p>
    There are Perl, Python, Ruby, and PHP bindings available for RRDtool, so
    that you can write your own monitoring scripts in your preferred
    scripting language.
   </p></div><section class="sect2" id="sec-util-rrdtool-howitworks" data-id-title="How RRDtool works"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.11.1 </span><span class="title-name">How RRDtool works</span></span> <a title="Permalink" class="permalink" href="#sec-util-rrdtool-howitworks">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    RRDtool is an abbreviation of <span class="emphasis"><em>Round Robin Database
    tool</em></span>. <span class="emphasis"><em>Round Robin</em></span> is a method for
    manipulating with a constant amount of data. It uses the principle of a
    circular buffer, where there is no end nor beginning to the data row
    which is being read. RRDtool uses Round Robin Databases to store and
    read its data.
   </p><p>
    As mentioned above, RRDtool is designed to work with data that change in
    time. The ideal case is a sensor which repeatedly reads measured data
    (like temperature, speed etc.) in constant periods of time, and then
    exports them in a given format. Such data is perfectly ready for
    RRDtool, and it is easy to process them and create the desired output.
   </p><p>
    Sometimes it is not possible to obtain the data automatically and
    regularly. Their format needs to be pre-processed before it is supplied
    to RRDtool, and often you need to manipulate RRDtool even manually.
   </p><p>
    The following is a simple example of basic RRDtool usage. It illustrates
    all three important phases of the usual RRDtool workflow:
    <span class="emphasis"><em>creating</em></span> a database, <span class="emphasis"><em>updating</em></span>
    measured values, and <span class="emphasis"><em>viewing</em></span> the output.
   </p></section><section class="sect2" id="sec-util-rrdtool-example" data-id-title="A practical example"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.11.2 </span><span class="title-name">A practical example</span></span> <a title="Permalink" class="permalink" href="#sec-util-rrdtool-example">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Suppose we want to collect and view information about the memory usage
    in the Linux system as it changes in time. To make the example more
    vivid, we measure the currently free memory over a period of 40 seconds
    in 4-second intervals. Three applications that generally consume a lot of
    system memory are started and closed: the Firefox Web browser, the
    Evolution e-mail client, and the Eclipse development framework.
   </p><section class="sect3" id="sec-util-rrdtool-example-collect" data-id-title="Collecting data"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">2.11.2.1 </span><span class="title-name">Collecting data</span></span> <a title="Permalink" class="permalink" href="#sec-util-rrdtool-example-collect">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     RRDtool is frequently used to measure and visualize network traffic. In
     such case, the Simple Network Management Protocol (SNMP) is used. This
     protocol can query network devices for relevant values of their
     internal counters. Exactly these values are to be stored with RRDtool.
     For more information on SNMP, see
     <a class="link" href="http://www.net-snmp.org/" target="_blank">http://www.net-snmp.org/</a>.
    </p><p>
     Our situation is different—we need to obtain the data
     manually. A helper script <code class="command">free_mem.sh</code> repetitively
     reads the current state of free memory and writes it to the standard
     output.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat free_mem.sh
INTERVAL=4
for steps in {1..10}
do
    DATE=`date +%s`
    FREEMEM=`free -b | grep "Mem" | awk '{ print $4 }'`
    sleep $INTERVAL
    echo "rrdtool update free_mem.rrd $DATE:$FREEMEM"
done</pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       The time interval is set to 4 seconds, and is implemented with the
       <code class="command">sleep</code> command.
      </p></li><li class="listitem"><p>
       RRDtool accepts time information in a special format - so called
       <span class="emphasis"><em>Unix time</em></span>. It is defined as the number of
       seconds since the midnight of January 1, 1970 (UTC). For example,
       1272907114 represents 2010-05-03 17:18:34.
      </p></li><li class="listitem"><p>
       The free memory information is reported in bytes with
       <code class="command">free</code> <code class="option">-b</code>. Prefer to supply basic
       units (bytes) instead of multiple units (like kilobytes).
      </p></li><li class="listitem"><p>
       The line with the <code class="command">echo ...</code> command contains the
       future name of the database file (<code class="literal">free_mem.rrd</code>),
       and together creates a command line for updating
       RRDtool values.
      </p></li></ul></div><p>
     After running <code class="command">free_mem.sh</code>, you see an output similar
     to this:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>sh free_mem.sh
rrdtool update free_mem.rrd 1272974835:1182994432
rrdtool update free_mem.rrd 1272974839:1162817536
rrdtool update free_mem.rrd 1272974843:1096269824
rrdtool update free_mem.rrd 1272974847:1034219520
rrdtool update free_mem.rrd 1272974851:909438976
rrdtool update free_mem.rrd 1272974855:832454656
rrdtool update free_mem.rrd 1272974859:829120512
rrdtool update free_mem.rrd 1272974863:1180377088
rrdtool update free_mem.rrd 1272974867:1179369472
rrdtool update free_mem.rrd 1272974871:1181806592</pre></div><p>
     It is convenient to redirect the command's output to a file with
    </p><p>
     <code class="command">sh free_mem.sh &gt; free_mem_updates.log</code>
    </p><p>
     to simplify its future execution.
    </p></section><section class="sect3" id="sec-util-rrdtool-example-create" data-id-title="Creating the database"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">2.11.2.2 </span><span class="title-name">Creating the database</span></span> <a title="Permalink" class="permalink" href="#sec-util-rrdtool-example-create">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Create the initial Robin Round database for our example with the
     following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>rrdtool create free_mem.rrd --start 1272974834 --step=4 \
DS:memory:GAUGE:600:U:U RRA:AVERAGE:0.5:1:24</pre></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Points to notice </span></span><a title="Permalink" class="permalink" href="#id-1.8.4.2.17.7.4.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
       This command creates a file called <code class="filename">free_mem.rrd</code>
       for storing our measured values in a Round Robin type database.
      </p></li><li class="listitem"><p>
       The <code class="option">--start</code> option specifies the time (in Unix time)
       when the first value is added to the database. In this example,
       it is one less than the first time value of the
       <code class="command">free_mem.sh</code> output (1272974835).
      </p></li><li class="listitem"><p>
       The <code class="option">--step</code> specifies the time interval in seconds
       with which the measured data is supplied to the database.
      </p></li><li class="listitem"><p>
       The <code class="literal">DS:memory:GAUGE:600:U:U</code> part introduces a new
       data source for the database. It is called
       <span class="emphasis"><em>memory</em></span>, its type is <span class="emphasis"><em>gauge</em></span>,
       the maximum number between two updates is 600 seconds, and the
       <span class="emphasis"><em>minimal</em></span> and <span class="emphasis"><em>maximal</em></span> value
       in the measured range are unknown (U).
      </p></li><li class="listitem"><p>
       <code class="literal">RRA:AVERAGE:0.5:1:24</code> creates Round Robin archive
       (RRA) whose stored data is processed with the
       <span class="emphasis"><em>consolidation functions</em></span> (CF) that calculates the
       <span class="emphasis"><em>average</em></span> of data points. 3 arguments of the
       consolidation function are appended to the end of the line.
      </p></li></ul></div><p>
     If no error message is displayed, then
     <code class="filename">free_mem.rrd</code> database is created in the current
     directory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ls -l free_mem.rrd
-rw-r--r-- 1 tux users 776 May  5 12:50 free_mem.rrd</pre></div></section><section class="sect3" id="sec-util-rrdtool-example-update" data-id-title="Updating database values"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">2.11.2.3 </span><span class="title-name">Updating database values</span></span> <a title="Permalink" class="permalink" href="#sec-util-rrdtool-example-update">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     After the database is created, you need to fill it with the measured
     data. In <a class="xref" href="#sec-util-rrdtool-example-collect" title="2.11.2.1. Collecting data">Section 2.11.2.1, “Collecting data”</a>, we already
     prepared the file <code class="filename">free_mem_updates.log</code> which
     consists of <code class="command">rrdtool update</code> commands. These commands
     do the update of database values for us.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>sh free_mem_updates.log; ls -l free_mem.rrd
-rw-r--r--  1 tux users  776 May  5 13:29 free_mem.rrd</pre></div><p>
     As you can see, the size of <code class="filename">free_mem.rrd</code> remained
     the same even after updating its data.
    </p></section><section class="sect3" id="sec-util-rrdtool-example-view" data-id-title="Viewing measured values"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">2.11.2.4 </span><span class="title-name">Viewing measured values</span></span> <a title="Permalink" class="permalink" href="#sec-util-rrdtool-example-view">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     We have already measured the values, created the database, and stored
     the measured value in it. Now we can play with the database, and
     retrieve or view its values.
    </p><p>
     To retrieve all the values from our database, enter the following on
     the command line:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>rrdtool fetch free_mem.rrd AVERAGE --start 1272974830 \
--end 1272974871
          memory
1272974832: nan
1272974836: 1.1729059840e+09
1272974840: 1.1461806080e+09
1272974844: 1.0807572480e+09
1272974848: 1.0030243840e+09
1272974852: 8.9019289600e+08
1272974856: 8.3162112000e+08
1272974860: 9.1693465600e+08
1272974864: 1.1801251840e+09
1272974868: 1.1799787520e+09
1272974872: nan</pre></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Points to notice </span></span><a title="Permalink" class="permalink" href="#id-1.8.4.2.17.7.6.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
       <code class="literal">AVERAGE</code> fetches the average value points from the
       database, because only one data source is defined
       (<a class="xref" href="#sec-util-rrdtool-example-create" title="2.11.2.2. Creating the database">Section 2.11.2.2, “Creating the database”</a>) with
       <code class="literal">AVERAGE</code> processing and no other function is
       available.
      </p></li><li class="listitem"><p>
       The first line of the output prints the name of the data source as
       defined in <a class="xref" href="#sec-util-rrdtool-example-create" title="2.11.2.2. Creating the database">Section 2.11.2.2, “Creating the database”</a>.
      </p></li><li class="listitem"><p>
       The left results column represents individual points in time, while
       the right one represents corresponding measured average values in
       scientific notation.
      </p></li><li class="listitem"><p>
       The <code class="literal">nan</code> in the last line stands for <span class="quote">“<span class="quote">not a
       number</span>”</span>.
      </p></li></ul></div><p>
     Now a graph representing the values stored in the database is drawn:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>rrdtool graph free_mem.png \
--start 1272974830 \
--end 1272974871 \
--step=4 \
DEF:free_memory=free_mem.rrd:memory:AVERAGE \
LINE2:free_memory#FF0000 \
--vertical-label "GB" \
--title "Free System Memory in Time" \
--zoom 1.5 \
--x-grid SECOND:1:SECOND:4:SECOND:10:0:%X</pre></div><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Points to notice </span></span><a title="Permalink" class="permalink" href="#id-1.8.4.2.17.7.6.8">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
       <code class="filename">free_mem.png</code> is the file name of the graph to be
       created.
      </p></li><li class="listitem"><p>
       <code class="option">--start</code> and <code class="option">--end</code> limit the time
       range within which the graph is drawn.
      </p></li><li class="listitem"><p>
       <code class="option">--step</code> specifies the time resolution (in seconds) of
       the graph.
      </p></li><li class="listitem"><p>
       The <code class="literal">DEF:...</code> part is a data definition called
       <span class="emphasis"><em>free_memory</em></span>. Its data is read from the
       <code class="filename">free_mem.rrd</code> database and its data source called
       <span class="emphasis"><em>memory</em></span>. The <span class="emphasis"><em>average</em></span> value
       points are calculated, because no others were defined in
       <a class="xref" href="#sec-util-rrdtool-example-create" title="2.11.2.2. Creating the database">Section 2.11.2.2, “Creating the database”</a>.
      </p></li><li class="listitem"><p>
       The <code class="literal">LINE...</code> part specifies properties of the line
       to be drawn into the graph. It is 2 pixels wide, its data come from
       the <span class="emphasis"><em>free_memory</em></span> definition, and its color is
       red.
      </p></li><li class="listitem"><p>
       <code class="option">--vertical-label</code> sets the label to be printed along
       the <span class="emphasis"><em>y</em></span> axis, and <code class="option">--title</code> sets
       the main label for the whole graph.
      </p></li><li class="listitem"><p>
       <code class="option">--zoom</code> specifies the zoom factor for the graph. This
       value must be greater than zero.
      </p></li><li class="listitem"><p>
       <code class="option">--x-grid</code> specifies how to draw grid lines and their
       labels into the graph. Our example places them every second, while
       major grid lines are placed every 4 seconds. Labels are placed every
       10 seconds under the major grid lines.
      </p></li></ul></div><div class="figure" id="util-rrdtool-example-create-graph1"><div class="figure-contents"><div class="mediaobject"><a href="images/rrdtool_graph1.png"><img src="images/rrdtool_graph1.png" width="55%" alt="Example graph created with RRDtool" title="Example graph created with RRDtool"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 2.1: </span><span class="title-name">Example graph created with RRDtool </span></span><a title="Permalink" class="permalink" href="#util-rrdtool-example-create-graph1">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></section></section><section class="sect2" id="sec-util-rrdtool-moreinfo" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.11.3 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-util-rrdtool-moreinfo">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/utilities.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    RRDtool is a complex tool with a lot of subcommands and command-line options. Some are easy to
    understand, but to make them produce the results you want and fine-tune them according to your liking may require a lot of effort.
   </p><p>
    Apart from RRDtool's man page (<code class="command">man 1 rrdtool</code>) which
    gives you only basic information, you should have a look at the
    <a class="link" href="https://oss.oetiker.ch/rrdtool/" target="_blank">RRDtool home
    page</a>. There is a detailed
    <a class="link" href="https://oss.oetiker.ch/rrdtool/doc/index.en.html" target="_blank">documentation</a>
    of the <code class="command">rrdtool</code> command and all its sub-commands.
    There are also several
    <a class="link" href="https://oss.oetiker.ch/rrdtool/tut/index.en.html" target="_blank">tutorials</a>
    to help you understand the common RRDtool workflow.
   </p><p>
    If you are interested in monitoring network traffic, have a look at
    <a class="link" href="https://oss.oetiker.ch/mrtg/" target="_blank">MRTG (Multi Router
    Traffic Grapher)</a>. MRTG can graph the activity of many network
    devices. It can use RRDtool.
   </p></section></section></section><section class="chapter" id="cha-tuning-syslog" data-id-title="System log files"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">3 </span><span class="title-name">System log files</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-syslog">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  System log file analysis is one of the most important tasks when analyzing
  the system. In fact, looking at the system log files should be the first
  thing to do when maintaining or troubleshooting a system. <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>
  automatically logs almost everything that happens on the system in detail.
  Since the move to <code class="systemitem">systemd</code>, kernel messages and messages of system
  services registered with <code class="systemitem">systemd</code> are logged in <code class="systemitem">systemd</code> journal
  (see <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: query the <code class="systemitem">systemd</code> journal”</span>). Other log files (mainly those of
  system applications) are written in plain text and can be easily read
  using an editor or pager. It is also possible to parse them using scripts.
  This allows you to filter their content.
 </p><section class="sect1" id="sec-tuning-syslog-logs" data-id-title="System log files in /var/log/"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.1 </span><span class="title-name">System log files in <code class="filename">/var/log/</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-syslog-logs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   System log files are always located under the
   <code class="filename">/var/log</code> directory. The following list presents an
   overview of all system log files from <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> present after a
   default installation. Depending on your installation scope,
   <code class="filename">/var/log</code> also contains log files from other services
   and applications not listed here. Some files and directories described
   below are <span class="quote">“<span class="quote">placeholders</span>”</span> and are only used, when the
   corresponding application is installed. Most log files are only visible
   for the user <code class="systemitem">root</code>.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.4.3.4.3.1"><span class="term"><code class="filename">apparmor/</code>
    </span></dt><dd><p>
      <span class="phrase">AppArmor</span> log files. For more information about <span class="phrase">AppArmor</span>, see
      <span class="intraxref">Book “Security and Hardening Guide”</span>.
     </p></dd><dt id="id-1.8.4.3.4.3.2"><span class="term"><code class="filename">audit/</code>
    </span></dt><dd><p>
      Logs from the audit framework. See <span class="intraxref">Book “Security and Hardening Guide”</span> for
      details.
     </p></dd><dt id="id-1.8.4.3.4.3.3"><span class="term"><code class="filename">ConsoleKit/</code>
    </span></dt><dd><p>
      Logs of the <code class="systemitem">ConsoleKit</code> daemon
      (daemon for tracking what users are logged in and how they interact
      with the computer).
     </p></dd><dt id="id-1.8.4.3.4.3.4"><span class="term"><code class="filename">cups/</code>
    </span></dt><dd><p>
      Access and error logs of the Common Unix Printing System
      (<code class="systemitem">cups</code>).
     </p></dd><dt id="id-1.8.4.3.4.3.5"><span class="term"><code class="filename">firewall</code>
    </span></dt><dd><p>
      Firewall logs.
     </p></dd><dt id="id-1.8.4.3.4.3.6"><span class="term"><code class="filename">gdm/</code>
    </span></dt><dd><p>
      Log files from the GNOME display manager.
     </p></dd><dt id="id-1.8.4.3.4.3.7"><span class="term"><code class="filename">krb5/</code>
    </span></dt><dd><p>
      Log files from the Kerberos network authentication system.
     </p></dd><dt id="id-1.8.4.3.4.3.8"><span class="term"><code class="filename">lastlog</code>
    </span></dt><dd><p>
      A database containing information on the last login of each user. Use
      the command <code class="command">lastlog</code> to view. See <code class="command">man 8
      lastlog</code> for more information.
     </p></dd><dt id="id-1.8.4.3.4.3.9"><span class="term"><code class="filename">localmessages</code>
    </span></dt><dd><p>
      Log messages of certain boot scripts, for example, the log of the DHCP
      client.
     </p></dd><dt id="id-1.8.4.3.4.3.10"><span class="term"><code class="filename">mail*</code>
    </span></dt><dd><p>
      Mail server (<code class="systemitem">postfix</code>,
      <code class="systemitem">sendmail</code>) logs.
     </p></dd><dt id="id-1.8.4.3.4.3.11"><span class="term"><code class="filename">messages</code>
    </span></dt><dd><p>
      This is the default place where all kernel and system log messages go
      and should be the first place (along with
      <code class="filename">/var/log/warn</code>) to look at in case of problems.
     </p></dd><dt id="id-1.8.4.3.4.3.12"><span class="term"><code class="filename">NetworkManager</code>
    </span></dt><dd><p>
      NetworkManager log files.
     </p></dd><dt id="id-1.8.4.3.4.3.13"><span class="term"><code class="filename">news/</code>
    </span></dt><dd><p>
      Log messages from a news server.
     </p></dd><dt id="id-1.8.4.3.4.3.14"><span class="term"><code class="filename">chrony/</code>
    </span></dt><dd><p>
      Logs from the Network Time Protocol daemon
      (<code class="systemitem">chrony</code>).
     </p></dd><dt id="id-1.8.4.3.4.3.15"><span class="term"><code class="filename">pk_backend_zypp*</code>
    </span></dt><dd><p>
      PackageKit (with <code class="systemitem">libzypp</code>
      back-end) log files.
     </p></dd><dt id="id-1.8.4.3.4.3.16"><span class="term"><code class="filename">samba/</code>
    </span></dt><dd><p>
      Log files from Samba, the Windows SMB/CIFS file server.
     </p></dd><dt id="id-1.8.4.3.4.3.17"><span class="term"><code class="filename">warn</code>
    </span></dt><dd><p>
      Log of all system warnings and errors. This should be the first place
      (along with the output of the <code class="systemitem">systemd</code> journal) to look in case of
      problems.
     </p></dd><dt id="id-1.8.4.3.4.3.18"><span class="term"><code class="filename">wtmp</code>
    </span></dt><dd><p>
      Database of all login/logout activities,
      
      and remote connections. Use the command <code class="command">last</code> to
      view. See <code class="command">man 1 last</code> for more information.
     </p></dd><dt id="id-1.8.4.3.4.3.19"><span class="term"><code class="filename">Xorg.<em class="replaceable">NUMBER</em>.log</code>
    </span></dt><dd><p>
      X.Org start-up log file. Refer to these files in case you have
      problems starting X.Org.
     </p><p>
      The <em class="replaceable">NUMBER</em> in the file name is the
      display number. For example, the default <code class="filename">Xorg.0.log</code> is the log for display number
      <code class="literal">0</code>, and <code class="filename">Xorg.1.log</code> is the log for display number
      <code class="literal">1</code>. Copies from previous X.Org starts are named as <code class="filename">Xorg.<em class="replaceable">NUMBER</em>.log.old</code>.
     </p><div id="id-1.8.4.3.4.3.19.2.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
       The X.Org log files are available in the
       <code class="filename">/var/log/</code> directory
       only if you start an X.Org session as <code class="systemitem">root</code>.
       If you start an X.Org session as any other user, you can locate the log files in the <code class="filename">~/.local/share/xorg/</code> directory.
      </p></div></dd><dt id="id-1.8.4.3.4.3.20"><span class="term"><code class="filename">YaST2/</code>
    </span></dt><dd><p>
      All YaST log files.
     </p></dd><dt id="id-1.8.4.3.4.3.21"><span class="term"><code class="filename">zypp/</code>
    </span></dt><dd><p>
      <code class="systemitem">libzypp</code> log files. Refer to
      these files for the package installation history.
     </p></dd><dt id="id-1.8.4.3.4.3.22"><span class="term"><code class="filename">zypper.log</code>
    </span></dt><dd><p>
      Logs from the command line installer <code class="command">zypper</code>.
     </p></dd></dl></div></section><section class="sect1" id="sec-tuning-syslog-view" data-id-title="Viewing and parsing log files"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.2 </span><span class="title-name">Viewing and parsing log files</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-syslog-view">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To view log files, you can use any text editor. There is also a simple
   YaST module for viewing the system log available in the YaST
   control center under <span class="guimenu">Miscellaneous</span> › <span class="guimenu">System Log</span>.
  </p><p>
   For viewing log files in a text console, use the commands
   <code class="command">less</code> or <code class="command">more</code>. Use
   <code class="command">head</code> and <code class="command">tail</code> to view the beginning
   or end of a log file. To view entries appended to a log file in real-time
   use <code class="command">tail</code> <code class="option">-f</code>. For information about
   how to use these tools, see their man pages.
  </p><p>
   To search for strings or regular expressions in log files use
   <code class="command">grep</code>. <code class="command">awk</code> is useful for parsing and
   rewriting log files.
  </p></section><section class="sect1" id="sec-tuning-syslog-logrotate" data-id-title="Managing log files with logrotate"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.3 </span><span class="title-name">Managing log files with <code class="command">logrotate</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-syslog-logrotate">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Log files under <code class="filename">/var/log</code> grow on a daily basis and
   quickly become large. <code class="command">logrotate</code> is a tool that
   helps you manage log files and their growth. It allows automatic
   rotation, removal, compression, and mailing of log files. Log files can
   be handled periodically (daily, weekly, or monthly) or when exceeding a
   particular size.
  </p><p>
   <code class="command">logrotate</code> is run daily by <code class="systemitem">systemd</code>,
   and thus modifies log files only once a day. However, exceptions
   occur when a log file is modified because of its size, if
   <code class="command">logrotate</code> is run multiple times a day, or if
   <code class="option">--force</code> is enabled. Use
   <code class="filename">/var/lib/misc/logrotate.status</code> to find out when a
   particular file was last rotated.
  </p><p>
   The main configuration file of <code class="command">logrotate</code> is
   <code class="filename">/etc/logrotate.conf</code>. System packages and
   programs that produce log files (for example,
   <code class="systemitem">apache2</code>) put their own
   configuration files in the <code class="filename">/etc/logrotate.d/</code>
   directory. The content of <code class="filename">/etc/logrotate.d/</code> is
   included via <code class="filename">/etc/logrotate.conf</code>.
  </p><div class="complex-example"><div class="example" id="ex-tuning-syslog-logrotate-config" data-id-title="Example for /etc/logrotate.conf"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 3.1: </span><span class="title-name">Example for <code class="filename">/etc/logrotate.conf</code> </span></span><a title="Permalink" class="permalink" href="#ex-tuning-syslog-logrotate-config">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
    
   </p><div class="verbatim-wrap"><pre class="screen"># see "man logrotate" for details
# rotate log files weekly
weekly

# keep 4 weeks worth of backlogs
rotate 4

# create new (empty) log files after rotating old ones
create

# use date as a suffix of the rotated file
dateext

# uncomment this if you want your log files compressed
#compress

# comment these to switch compression to use gzip or another
# compression scheme
compresscmd /usr/bin/bzip2
uncompresscmd /usr/bin/bunzip2

# RPM packages drop log rotation information into this directory
include /etc/logrotate.d</pre></div></div></div></div><div id="id-1.8.4.3.6.6" data-id-title="Avoid permission conflicts" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Avoid permission conflicts</div><p>
    The <code class="systemitem">create</code> option pays heed to the modes and
    ownership of files specified in <code class="filename">/etc/permissions*</code>.
    If you modify these settings, make sure no conflicts arise.
   </p></div></section><section class="sect1" id="sec-tuning-syslog-logwatch" data-id-title="Monitoring log files with logwatch"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.4 </span><span class="title-name">Monitoring log files with <code class="command">logwatch</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-syslog-logwatch">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">logwatch</code> is a customizable, pluggable log-monitoring
   script. It parses system logs, extracts the important information and
   presents them in a human readable manner. To use
   <code class="command">logwatch</code>, install the <span class="package">logwatch</span> package.
  </p><p>
   <code class="command">logwatch</code> can either be used at the command line to
   generate on-the-fly reports, or via <code class="systemitem">cron</code> to regularly create custom
   reports. Reports can either be printed on the screen, saved to a file, or
   be mailed to a specified address. The latter is especially useful when
   automatically generating reports via <code class="systemitem">cron</code>.
  </p><p>
   On the command line, you can tell <code class="command">logwatch</code> for which
   service and time span to generate a report and how much detail should be
   included:
  </p><div class="verbatim-wrap"><pre class="screen"># Detailed report on all kernel messages from yesterday
logwatch --service kernel --detail High --range Yesterday --print

# Low detail report on all sshd events recorded (incl. archived logs)
logwatch --service sshd --detail Low --range All --archives --print

# Mail a report on all smartd messages from May 5th to May 7th to root@localhost
logwatch --service smartd --range 'between 5/5/2005 and 5/7/2005' \
--mailto root@localhost --print</pre></div><p>
   The <code class="option">--range</code> option has got a complex syntax—see
   <code class="command">logwatch</code> <code class="option">--range help</code> for details. A
   list of all services that can be queried is available with the following
   command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ls /usr/share/logwatch/default.conf/services/ | sed 's/\.conf//g'</pre></div><p>
   <code class="command">logwatch</code> can be customized to great detail. However,
   the default configuration should be sufficient. The default
   configuration files are located under
   <code class="filename">/usr/share/logwatch/default.conf/</code>. Never change them
   because they would get overwritten again with the next update. Rather
   place custom configuration in <code class="filename">/etc/logwatch/conf/</code>
   (you may use the default configuration file as a template, though). A
   detailed HOWTO on customizing <code class="command">logwatch</code> is available at
   <code class="filename">/usr/share/doc/packages/logwatch/HOWTO-Customize-LogWatch</code>.
   The following configuration files exist:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.4.3.7.9.1"><span class="term"><code class="filename">logwatch.conf</code>
    </span></dt><dd><p>
      The main configuration file. The default version is extensively
      commented. Each configuration option can be overwritten on the command
      line.
     </p></dd><dt id="id-1.8.4.3.7.9.2"><span class="term"><code class="filename">ignore.conf</code>
    </span></dt><dd><p>
      Filter for all lines that should globally be ignored by
      <code class="command">logwatch</code>.
     </p></dd><dt id="id-1.8.4.3.7.9.3"><span class="term"><code class="filename">services/*.conf</code>
    </span></dt><dd><p>
      The service directory holds configuration files for each service you
      can generate a report for.
     </p></dd><dt id="id-1.8.4.3.7.9.4"><span class="term"><code class="filename">logfiles/*.conf</code>
    </span></dt><dd><p>
      Specifications on which log files should be parsed for each service.
     </p></dd></dl></div></section><section class="sect1" id="sec-tuning-syslog-forward" data-id-title="Configuring mail forwarding for root"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.5 </span><span class="title-name">Configuring mail forwarding for <code class="systemitem">root</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-syslog-forward">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   System daemons, <code class="systemitem">cron</code> jobs, <code class="systemitem">systemd</code>
   timers, and other applications can generate messages and send them to the
   <code class="systemitem">root</code> user of the system. By default, each user account owns a local
   mailbox and will be notified about new mail messages upon login.
  </p><p>
   These messages can contain security relevant reports and incidents that require a quick response by the system administrator. To get notified about
   these messages in a timely fashion, it is strongly recommended to forward
   these mails to a dedicated remote e-mail account that is regularly checked.
  </p><div class="procedure" id="pro-tuning-syslog-forward" data-id-title="Configure mail forwarding for the root user"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 3.1: </span><span class="title-name">Configure mail forwarding for the <code class="systemitem">root</code> user </span></span><a title="Permalink" class="permalink" href="#pro-tuning-syslog-forward">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
    To forward mail for the <code class="systemitem">root</code> user, perform the following steps:
   </p><ol class="procedure" type="1"><li class="step"><p>
     Install the <span class="package">yast2-mail</span> package:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">zypper in yast2-mail</code></pre></div></li><li class="step"><p>
     Run the interactive YaST mail configuration:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">yast mail</code></pre></div></li><li class="step"><p>
     Choose <span class="guimenu">Permanent</span> as <span class="guimenu">Connection type</span>
     and proceed with <span class="guimenu">Next</span>.
    </p></li><li class="step"><p>
     Enter the address of the <span class="guimenu">Outgoing mail server</span>. If
     necessary, configure <span class="guimenu">Authentication</span>. It is strongly
     recommended to <span class="guimenu">Enforce TLS encryption </span> to prevent
     potentially sensitive system data from being sent unencrypted over the
     network. Proceed with <span class="guimenu">Next</span>.
    </p></li><li class="step"><p>
     Enter the e-mail address to <span class="guimenu">Forward root's mail to</span> and
     <span class="guimenu">Finish</span> the configuration.
    </p><div id="id-1.8.4.3.8.4.7.2" data-id-title="Do not accept remote SMTP connections" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Do not accept remote SMTP connections</div><p>
      Do <span class="emphasis"><em>not</em></span> enable <span class="guimenu">Accept remote SMTP
       connections</span>, otherwise the local machine will act as a mail
      relay.
     </p></div></li><li class="step"><p>
     Send a message to test whether mail forwarding works correctly:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">mail root</code>
subject: test
test
.</pre></div></li><li class="step"><p>
     Use the <code class="command">mailq</code> command to verify that the test message
     has been sent. Upon success, the queue should be empty. The message should
     be received by the dedicated mail address configured previously.
    </p></li></ol></div></div><p>
   Depending on the number of managed machines and the number of persons who
   need to be informed about system events, different e-mail address models can
   be established:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Collect messages from different systems in an e-mail account that is only
     accessed by a single person.
    </p></li><li class="listitem"><p>
     Collect messages from different systems in a group e-mail account (aliases
     or mailing list) that can be accessed by all relevant persons.
    </p></li><li class="listitem"><p>
     Create separate e-mail accounts for each system.
    </p></li></ul></div><p>
   It is crucial that administrators regularly check the related e-mail accounts.
   To facilitate this effort and identify important events, avoid sending
   unnecessary information. Configure applications to only send relevant
   information.
  </p></section><section class="sect1" id="sec-tuning-syslog-server" data-id-title="Forwarding log messages to a central syslog server"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.6 </span><span class="title-name">Forwarding log messages to a central syslog server</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-syslog-server">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   System log data can be forwarded from individual systems to a central
   syslog server on the network. This allows administrators to get an overview
   of events on all hosts, and prevents attackers that succeed in taking over a
   system from manipulating system logs to cover their tracks.
  </p><p>
   Setting up a central syslog server consists of two parts. First you configure
   the central log server, then the clients for remote logging.
  </p><section class="sect2" id="sec-tuning-syslog-server-setup" data-id-title="Set up the central syslog server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">3.6.1 </span><span class="title-name">Set up the central syslog server</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-syslog-server-setup">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure" id="pro-tuning-syslog-server" data-id-title="Configure the central rsyslog server"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 3.2: </span><span class="title-name">Configure the central <code class="systemitem">rsyslog</code> server </span></span><a title="Permalink" class="permalink" href="#pro-tuning-syslog-server">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
     To set up a central syslog server, perform the following steps:
    </p><ol class="procedure" type="1"><li class="step"><p>
      Edit the configuration file
      <code class="filename">/etc/rsyslog.d/remote.conf</code>.
     </p></li><li class="step"><p>
      Uncomment the following lines in the <code class="literal">UDP Syslog Server</code>
      or <code class="literal">TCP Syslog Server</code> section of the configuration file.
      Assign an IP address and port for <code class="systemitem">rsyslogd</code>.
     </p><p>
      TCP example:
     </p><div class="verbatim-wrap"><pre class="screen">$ModLoad imtcp.so
$UDPServerAddress <em class="replaceable">IP</em><span class="callout" id="co-tuning-syslog-server-ip">1</span>
$InputTCPServerRun <em class="replaceable">PORT</em><span class="callout" id="co-tuning-syslog-server-port">2</span></pre></div><p>
      UDP example:
     </p><div class="verbatim-wrap"><pre class="screen">$ModLoad imudp.so
$UDPServerAddress <em class="replaceable">IP</em><a class="xref" href="#co-tuning-syslog-server-ip"><span class="callout">1</span></a>
$UDPServerRun <em class="replaceable">PORT</em><a class="xref" href="#co-tuning-syslog-server-port"><span class="callout">2</span></a></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-syslog-server-ip"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        IP address of the interface for <code class="systemitem">rsyslogd</code> to listen on. If no address is
        given, the daemon listens on all interfaces.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-syslog-server-port"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Port for <code class="systemitem">rsyslogd</code> to listen on.
        Select a privileged port below 1024. The default is 514.
       </p></td></tr></table></div><div id="id-1.8.4.3.9.4.2.4.7" data-id-title="TCP versus UDP protocol" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: TCP versus UDP protocol</div><p>
       Traditionally syslog uses the UDP protocol to transmit log messages over
       the network. This involves less overhead, but lacks reliability. Log
       messages can get lost under high load.
       
       
      </p><p>
       The TCP protocol is more reliable and should be preferred over UDP.
      </p></div><div id="id-1.8.4.3.9.4.2.4.8" data-id-title="UDPServerAddress with TCP" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="literal">UDPServerAddress</code> with TCP</div><p>
       The <code class="literal">$UDPServerAddress</code> configuration parameter in the
       TCP example is no error. Despite its name it is used for both TCP and
       UDP.
      </p></div></li><li class="step"><p>
      Save the file.
     </p></li><li class="step"><p>
      Restart the <code class="systemitem">rsyslog</code> service:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl restart rsyslog.service</code></pre></div></li><li class="step"><p>Open the respective port in the firewall. For <code class="systemitem">firewalld</code> with TCP on port 514 run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">firewall-cmd --add-port <em class="replaceable">514/tcp</em> --permanent</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">firewall-cmd --reload</code></pre></div></li></ol></div></div><p>
    You have now configured the central syslog server. Next, configure clients
    for remote logging.
   </p></section><section class="sect2" id="sec-tuning-syslog-server-client" data-id-title="Set up the client machines"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">3.6.2 </span><span class="title-name">Set up the client machines</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-syslog-server-client">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure" id="pro-tuning-syslog-client" data-id-title="Configure a rsyslog instance for remote logging"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 3.3: </span><span class="title-name">Configure a <span class="guimenu">rsyslog</span> instance for remote logging </span></span><a title="Permalink" class="permalink" href="#pro-tuning-syslog-client">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
     To configure a machine for remote logging to a central syslog server,
     perform the following steps:
    </p><ol class="procedure" type="1"><li class="step"><p>
      Edit the configuration file
      <code class="filename">/etc/rsyslog.d/remote.conf</code>.
     </p></li><li class="step"><p>
      Uncomment the appropriate line (TCP or UDP) and replace
      <code class="literal">remote-host</code> with the address of the central syslog
      server set up in <a class="xref" href="#sec-tuning-syslog-server-setup" title="3.6.1. Set up the central syslog server">Section 3.6.1, “Set up the central syslog server”</a>.
     </p><p>
      TCP example:
     </p><div class="verbatim-wrap"><pre class="screen"># Remote Logging using TCP for reliable delivery
# remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional
*.* <em class="replaceable">@@remote-host</em></pre></div><p>
      UDP example:
     </p><div class="verbatim-wrap"><pre class="screen"># Remote Logging using UDP
# remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional
*.* <em class="replaceable">@remote-host</em></pre></div></li><li class="step"><p>
      Save the file.
     </p></li><li class="step"><p>
      Restart the <code class="systemitem">rsyslog</code> service:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl restart rsyslog.service</code></pre></div></li><li class="step"><p>
      Verify the proper function of the syslog forwarding:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">logger "hello world"</code></pre></div><p>
      The log message <code class="literal">hello world</code> should now appear on the
      central syslog server.
     </p></li></ol></div></div><p>
    You have now configured a system for remote logging to your central syslog
    server. Repeat this procedure for all systems that should log remotely.
   </p></section><section class="sect2" id="sec-tuning-syslog-server-more" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">3.6.3 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-syslog-server-more">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This basic setup does not include encryption and is only suitable for
    trusted internal networks. TLS encryption is strongly recommended, but
    requires a certificate infrastructure.
   </p><p>
    In this configuration, all messages from remote hosts are treated the
    same on the central syslog server. Consider filtering messages into separate
    files by remote host or classify them by message category.
   </p><p>
    For more information about encryption, filtering, and other advanced topics,
    consult the <span class="productname">RSyslog</span> documentation at
    <a class="link" href="https://www.rsyslog.com/doc/master/index.html#manual" target="_blank">https://www.rsyslog.com/doc/master/index.html#manual</a>.
   </p></section></section><section class="sect1" id="sec-tuning-syslog-logger" data-id-title="Using logger to make system log entries"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.7 </span><span class="title-name">Using <code class="command">logger</code> to make system log entries</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-syslog-logger">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_logfiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">logger</code> is a tool for making entries in the system log.
   It provides a shell command interface to the rsyslogd system log module.
   For example, the following line outputs its message in
   <code class="filename">/var/log/messages</code> or directly in the journal (if no
   logging facility is running):
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>logger -t Test "This message comes from $USER"</pre></div><p>
   Depending on the current user and host name, the log contains a line
   similar to this:
  </p><div class="verbatim-wrap"><pre class="screen">Sep 28 13:09:31 venus Test: This message comes from tux</pre></div></section></section></div><div class="part" id="part-tuning-kerneltrace" data-id-title="Kernel monitoring"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part III </span><span class="title-name">Kernel monitoring </span></span><a title="Permalink" class="permalink" href="#part-tuning-kerneltrace">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_tuning.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-tuning-systemtap"><span class="title-number">4 </span><span class="title-name">SystemTap—filtering and analyzing system data</span></a></span></li><dd class="toc-abstract"><p>SystemTap provides a command line interface and a scripting language to examine the activities of a running Linux system, particularly the kernel, in fine detail. SystemTap scripts are written in the SystemTap scripting language, are then compiled to C-code kernel modules and inserted into the kerne…</p></dd><li><span class="chapter"><a href="#cha-tuning-kprobes"><span class="title-number">5 </span><span class="title-name">Kernel probes</span></a></span></li><dd class="toc-abstract"><p>
  Kernel probes are a set of tools to collect Linux kernel debugging and
  performance information. Developers and system administrators use
  them either to debug the kernel, or to find system performance
  bottlenecks. The reported data can then be used to tune the system for
  better performance.
 </p></dd><li><span class="chapter"><a href="#cha-perf"><span class="title-number">6 </span><span class="title-name">Hardware-based performance monitoring with Perf</span></a></span></li><dd class="toc-abstract"><p>
    Perf is an interface to access the performance monitoring unit (PMU) of a
    processor and to record and display software events such as page faults.
    It supports system-wide, per-thread, and KVM virtualization guest
    monitoring.
   </p></dd><li><span class="chapter"><a href="#cha-tuning-oprofile"><span class="title-number">7 </span><span class="title-name">OProfile—system-wide profiler</span></a></span></li><dd class="toc-abstract"><p>
    OProfile is a profiler for dynamic program analysis. It investigates
    the behavior of a running program and gathers information. This
    information can be viewed and gives hints for further optimization.
   </p><p>
    It is not necessary to recompile or use wrapper libraries to
    use OProfile. Not even a kernel patch is needed. When
    profiling an application, you can expect a small overhead, depending on the
    workload and sampling frequency.
   </p></dd><li><span class="chapter"><a href="#cha-tuning-dynamic-debug"><span class="title-number">8 </span><span class="title-name">Dynamic debug—kernel debugging messages</span></a></span></li><dd class="toc-abstract"><p>
        Dynamic debug is a powerful debugging feature in the Linux kernel that
        allows you to enable and disable debugging messages at runtime without
        the need to recompile the kernel or reboot the system.
      </p></dd></ul></div><section class="chapter" id="cha-tuning-systemtap" data-id-title="SystemTap—filtering and analyzing system data"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">4 </span><span class="title-name">SystemTap—filtering and analyzing system data</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-systemtap">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  SystemTap provides a command line interface and a scripting language to
  examine the activities of a running Linux system, particularly the kernel,
  in fine detail. SystemTap scripts are written in the SystemTap scripting
  language, are then compiled to C-code kernel modules and inserted into the
  kernel. The scripts can be designed to extract, filter and summarize data,
  thus allowing the diagnosis of complex performance problems or functional
  problems. SystemTap provides information similar to the output of tools
  like <code class="command">netstat</code>, <code class="command">ps</code>,
  <code class="command">top</code>, and <code class="command">iostat</code>. However, more
  filtering and analysis options can be used for the collected information.
 </p><section class="sect1" id="sec-tuning-systemtap-concept" data-id-title="Conceptual overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.1 </span><span class="title-name">Conceptual overview</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-concept">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Each time you run a SystemTap script, a SystemTap session is started.
   Several passes are done on the script before it is allowed to run.
   Then, the script is compiled into a kernel module and loaded. If the
   script has been executed before and no system components have changed
   (for example, different compiler or kernel versions, library paths, or
   script contents), SystemTap does not compile the script again. Instead,
   it uses the <code class="filename">*.c</code> and <code class="filename">*.ko</code> data
   stored in the SystemTap cache (<code class="filename">~/.systemtap</code>).
  </p><p>
   The module is unloaded when the tap has finished running. For an example, see
   the test run in <a class="xref" href="#sec-tuning-systemtap-setup" title="4.2. Installation and setup">Section 4.2, “Installation and setup”</a> and the
   respective explanation.

  </p><section class="sect2" id="sec-tuning-systemtap-concept-scripts" data-id-title="SystemTap scripts"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1.1 </span><span class="title-name">SystemTap scripts</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-concept-scripts">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    SystemTap usage is based on SystemTap scripts
    (<code class="filename">*.stp</code>). They tell SystemTap which type of
    information to collect, and what to do once that information is
    collected. The scripts are written in the SystemTap scripting language
    that is similar to AWK and C. For the language definition, see
    <a class="link" href="https://sourceware.org/systemtap/langref.pdf" target="_blank">https://sourceware.org/systemtap/langref.pdf</a>. A lot of
    useful example scripts are available from
    <a class="link" href="https://www.sourceware.org/systemtap/examples/" target="_blank">https://www.sourceware.org/systemtap/examples/</a>.
   </p><p>
    The essential idea behind a SystemTap script is to name
    <code class="literal">events</code>, and to give them <code class="literal">handlers</code>.
    When SystemTap runs the script, it monitors for certain events. When an
    event occurs, the Linux kernel runs the handler as a sub-routine, then
    resumes. Thus, events serve as the triggers for handlers to run.
    Handlers can record specified data and print it in a certain manner.
   </p><p>
    The SystemTap language only uses a few data types (integers, strings,
    and associative arrays of these), and full control structures (blocks,
    conditionals, loops, functions). It has a lightweight punctuation
    (semicolons are optional) and does not need detailed declarations (types
    are inferred and checked automatically).
   </p><p>
    For more information about SystemTap scripts and their syntax, refer to
    <a class="xref" href="#sec-tuning-systemtap-syntax" title="4.3. Script syntax">Section 4.3, “Script syntax”</a> and to the
    <code class="command">stapprobes</code> and <code class="command">stapfuncs</code> man
    pages, that are available with the
    <code class="systemitem">systemtap-docs</code> package.
   </p></section><section class="sect2" id="sec-tuning-systemtap-concept-tapsets" data-id-title="Tapsets"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1.2 </span><span class="title-name">Tapsets</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-concept-tapsets">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    
    Tapsets are a library of pre-written probes and functions that can be
    used in SystemTap scripts. When a user runs a SystemTap script,
    SystemTap checks the script's probe events and handlers against the
    tapset library. SystemTap then loads the corresponding probes and
    functions before translating the script to C. Like SystemTap scripts
    themselves, tapsets use the file name extension
    <code class="filename">*.stp</code>.

   </p><p>
    However, unlike SystemTap scripts, tapsets are not meant for direct
    execution. They constitute the library from which other scripts can pull
    definitions. Thus, the tapset library is an abstraction layer designed
    to make it easier for users to define events and functions. Tapsets
    provide aliases for functions that users could want to specify as an
    event. Knowing the proper alias is often easier than remembering
    specific kernel functions that may vary between kernel versions.
   </p></section><section class="sect2" id="sec-tuning-systemtap-concept-cmd" data-id-title="Commands and privileges"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1.3 </span><span class="title-name">Commands and privileges</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-concept-cmd">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The main commands associated with SystemTap are <code class="command">stap</code>
    and <code class="command">staprun</code>. To execute them, you either need
    <code class="systemitem">root</code> privileges or must be a member of the
    <code class="systemitem">stapdev</code> or
    <code class="systemitem">stapusr</code> group.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.2.4.6.3.1"><span class="term"><code class="command">stap</code>
     </span></dt><dd><p>
       SystemTap front-end. Runs a SystemTap script (either from file, or
       from standard input). It translates the script into C code, compiles
       it, and loads the resulting kernel module into a running Linux
       kernel. Then, the requested system trace or probe functions are
       performed.
      </p></dd><dt id="id-1.8.5.2.4.6.3.2"><span class="term"><code class="command">staprun</code>
     </span></dt><dd><p>
       SystemTap back-end. Loads and unloads kernel modules produced by the
       SystemTap front-end.

      </p></dd></dl></div><p>
    For a list of options for each command, use <code class="option">--help</code>. For
    details, refer to the <code class="command">stap</code> and the
    <code class="command">staprun</code> man pages.
   </p><p>
 
    To avoid giving <code class="systemitem">root</code> access to users solely to enable them to work
    with SystemTap, use one of the following SystemTap groups. They are not available
    by default on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, but you can create the groups and modify the
    access rights accordingly. Also, adjust the permissions of the
    <code class="command">staprun</code> command if the security implications are
    appropriate for your environment.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.2.4.6.6.1"><span class="term"><code class="systemitem">stapdev</code>
     </span></dt><dd><p>
       Members of this group can run SystemTap scripts with
       <code class="command">stap</code>, or run SystemTap instrumentation modules
       with <code class="command">staprun</code>. As running <code class="command">stap</code>
       involves compiling scripts into kernel modules and loading them into
       the kernel, members of this group still have effective <code class="systemitem">root</code>
       access.
      </p></dd><dt id="id-1.8.5.2.4.6.6.2"><span class="term"><code class="systemitem">stapusr</code>
     </span></dt><dd><p>
       Members of this group are only allowed to run SystemTap
       instrumentation modules with <code class="command">staprun</code>. In addition,
       they can only run those modules from
       <code class="filename">/lib/modules/<em class="replaceable">KERNEL_VERSION</em>/systemtap/</code>.
       This directory must be owned by <code class="systemitem">root</code> and must only be
       writable for the <code class="systemitem">root</code> user.
      </p></dd></dl></div></section><section class="sect2" id="sec-tuning-systemtap-concept-dir" data-id-title="Important files and directories"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1.4 </span><span class="title-name">Important files and directories</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-concept-dir">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following list gives an overview of the SystemTap main files and
    directories.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.2.4.7.3.1"><span class="term"><code class="filename">/lib/modules/<em class="replaceable">KERNEL_VERSION</em>/systemtap/</code>
     </span></dt><dd><p>
       Holds the SystemTap instrumentation modules.
      </p></dd><dt id="id-1.8.5.2.4.7.3.2"><span class="term"><code class="filename">/usr/share/systemtap/tapset/</code>
     </span></dt><dd><p>
       Holds the standard library of tapsets.
      </p></dd><dt id="id-1.8.5.2.4.7.3.3"><span class="term"><code class="filename">/usr/share/doc/packages/systemtap/examples</code>
     </span></dt><dd><p>
       Holds several example SystemTap scripts for different purposes.
       Only available if the
       <code class="systemitem">systemtap-docs</code> package is
       installed.
      </p></dd><dt id="id-1.8.5.2.4.7.3.4"><span class="term"><code class="filename">~/.systemtap/cache</code>
     </span></dt><dd><p>
       Data directory for cached SystemTap files.
      </p></dd><dt id="id-1.8.5.2.4.7.3.5"><span class="term"><code class="filename">/tmp/stap*</code>
     </span></dt><dd><p>
       Temporary directory for SystemTap files, including translated C code
       and kernel object.
      </p></dd></dl></div></section></section><section class="sect1" id="sec-tuning-systemtap-setup" data-id-title="Installation and setup"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.2 </span><span class="title-name">Installation and setup</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-setup">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>


   As SystemTap needs information about the kernel, some additional
   kernel-related packages must be installed. For each kernel you want to
   probe with SystemTap, you need to install a set of the following
   packages. This set should exactly match the kernel version and flavor
   (indicated by <code class="literal">*</code> in the overview below).
  </p><div id="id-1.8.5.2.5.3" data-id-title="Repository for packages with debugging information" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Repository for packages with debugging information</div><p>
    If you subscribed your system for online updates, you can find
    <span class="quote">“<span class="quote">debuginfo</span>”</span> packages in the
    <code class="literal">*-Debuginfo-Updates</code> online installation repository
    relevant for <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP6</span></span>. Use YaST to
    enable the repository.
   </p></div><p>

   For the classic SystemTap setup, install the following packages (using
   either YaST or <code class="command">zypper</code>).
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="systemitem">systemtap</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">systemtap-server</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">systemtap-docs</code> (optional)
    </p></li><li class="listitem"><p>
     <code class="systemitem">kernel-*-base</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">kernel-*-debuginfo</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">kernel-*-devel</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">kernel-source-*</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">gcc</code>
    </p></li></ul></div><p>
   To get access to the man pages and to a helpful collection of example
   SystemTap scripts for different purposes, additionally install the
   <code class="systemitem">systemtap-docs</code> package.
  </p><p>
   To check if all packages are correctly installed on the machine and if
   SystemTap is ready to use, execute the following command as
   <code class="systemitem">root</code>.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>stap -v -e 'probe vfs.read {printf("read performed\n"); exit()}'</pre></div><p>
   It probes the currently used kernel by running a script and returning an
   output. If the output is similar to the following, SystemTap is
   successfully deployed and ready to use:
  </p><div class="verbatim-wrap"><pre class="screen">Pass <span class="callout" id="co-tuning-stap-pass1">1</span>: parsed user script and 59 library script(s) in 80usr/0sys/214real ms.
Pass <span class="callout" id="co-tuning-stap-pass2">2</span>: analyzed script: 1 probe(s), 11 function(s), 2 embed(s), 1 global(s) in
 140usr/20sys/412real ms.
Pass <span class="callout" id="co-tuning-stap-pass3">3</span>: translated to C into
 "/tmp/stapDwEk76/stap_1856e21ea1c246da85ad8c66b4338349_4970.c" in 160usr/0sys/408real ms.
Pass <span class="callout" id="co-tuning-stap-pass4">4</span>: compiled C into "stap_1856e21ea1c246da85ad8c66b4338349_4970.ko" in
 2030usr/360sys/10182real ms.
Pass <span class="callout" id="co-tuning-stap-pass5">5</span>: starting run.
 read performed
Pass <a class="xref" href="#co-tuning-stap-pass5"><span class="callout">5</span></a>: run completed in 10usr/20sys/257real ms.</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-pass1"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Checks the script against the existing tapset library in
     <code class="filename">/usr/share/systemtap/tapset/</code> for any tapsets used.
     Tapsets are scripts that form a library of pre-written probes and
     functions that can be used in SystemTap scripts.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-pass2"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Examines the script for its components.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-pass3"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Translates the script to C. Runs the system C compiler to create a
     kernel module from it. Both the resulting C code
     (<code class="filename">*.c</code>) and the kernel module
     (<code class="filename">*.ko</code>) are stored in the SystemTap cache,
     <code class="filename">~/.systemtap</code>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-pass4"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Loads the module and enables all the probes (events and handlers) in
     the script by hooking into the kernel. The event being probed is a
     Virtual File System (VFS) read. As the event occurs on any processor, a
     valid handler is executed (prints the text <code class="literal">read
     performed</code>) and closed with no errors.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-pass5"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     After the SystemTap session is terminated, the probes are disabled, and
     the kernel module is unloaded.
    </p></td></tr></table></div><p>
   In case any error messages appear during the test, check the output for
   hints about any missing packages and make sure they are installed
   correctly. Rebooting and loading the appropriate kernel may also be
   needed.
   
  </p></section><section class="sect1" id="sec-tuning-systemtap-syntax" data-id-title="Script syntax"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.3 </span><span class="title-name">Script syntax</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-syntax">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   SystemTap scripts consist of the following two components:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.2.6.3.1"><span class="term"><a class="xref" href="#sec-tuning-systemtap-syntax-events" title="4.3.2. SystemTap events (probe points)">SystemTap events (probe points)</a>
    </span></dt><dd><p>
      Name the kernel events at the associated handler should be executed.
      Examples for events are entering or exiting a certain function, a
      timer expiring, or starting or terminating a session.
     </p></dd><dt id="id-1.8.5.2.6.3.2"><span class="term"><a class="xref" href="#sec-tuning-systemtap-syntax-handlers" title="4.3.3. SystemTap handlers (probe body)">SystemTap handlers (probe body)</a>
    </span></dt><dd><p>
      Series of script language statements that specify the work to be done
      whenever a certain event occurs. This normally includes extracting
      data from the event context, storing them into internal variables, or
      printing results.
     </p></dd></dl></div><p>
   An event and its corresponding handler is collectively called a
   <code class="literal">probe</code>. SystemTap events are also called <code class="literal">probe
   points</code>. A probe's handler is also called a <code class="literal">probe
   body</code>.
  </p><p>
   Comments can be inserted anywhere in the SystemTap script in different
   styles: using either <code class="literal">#</code>, <code class="literal">/* */</code>, or
   <code class="literal">//</code> as marker.
  </p><section class="sect2" id="sec-tuning-systemtap-syntax-probe" data-id-title="Probe format"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.3.1 </span><span class="title-name">Probe format</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-syntax-probe">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A SystemTap script can have multiple probes. They must be written in the
    following format:
   </p><div class="verbatim-wrap"><pre class="screen">probe <em class="replaceable">EVENT</em> {<em class="replaceable">STATEMENTS</em>}</pre></div><p>
    Each probe has a corresponding statement block. This statement block
    must be enclosed in <code class="literal">{ }</code> and contains the statements
    to be executed per event.
   </p><div class="complex-example"><div class="example" id="ex-tuning-stap-simple" data-id-title="Simple SystemTap script"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 4.1: </span><span class="title-name">Simple SystemTap script </span></span><a title="Permalink" class="permalink" href="#ex-tuning-stap-simple">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
     The following example shows a simple SystemTap script.
    </p><div class="verbatim-wrap"><pre class="screen">probe<span class="callout" id="co-tuning-stap-probe">1</span> begin<span class="callout" id="co-tuning-stap-event-begin">2</span>
{<span class="callout" id="co-tuning-stap-handler-start">3</span>
   printf<span class="callout" id="co-tuning-stap-handler-function-printf">4</span> ("hello world\n")<span class="callout" id="co-tuning-stap-handler-string">5</span>
   exit ()<span class="callout" id="co-tuning-stap-handler-function-exit">6</span>
}<span class="callout" id="co-tuning-stap-handler-end">7</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-probe"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Start of the probe.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-event-begin"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Event <code class="literal">begin</code> (the start of the SystemTap session).
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-handler-start"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Start of the handler definition, indicated by <code class="literal">{</code>.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-handler-function-printf"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       First function defined in the handler: the <code class="literal">printf</code>
       function.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-handler-string"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       String to be printed by the <code class="literal">printf</code> function,
       followed by a line break (<code class="literal">/n</code>).
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-handler-function-exit"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Second function defined in the handler: the <code class="literal">exit()</code>
       function. Note that the SystemTap script will continue to run until
       the <code class="literal">exit()</code> function executes. If you want to stop
       the execution of the script before, stop it manually by pressing
       <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">C</span>.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-handler-end"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       End of the handler definition, indicated by <code class="literal">}</code>.
      </p></td></tr></table></div><p>
     The event <code class="literal">begin</code>
     <a class="xref" href="#co-tuning-stap-event-begin"><span class="callout">2</span></a>
     (the start of the SystemTap session) triggers the handler enclosed in
     <code class="literal">{ }</code>. Here, that is the <code class="literal">printf</code>
     function
     <a class="xref" href="#co-tuning-stap-handler-function-printf"><span class="callout">4</span></a>.
     In this case, it prints <code class="literal">hello world</code> followed by a
     new line
     <a class="xref" href="#co-tuning-stap-handler-string"><span class="callout">5</span></a>.
     Then, the script exits.
    </p></div></div></div><p>
    If your statement block holds several statements, SystemTap executes
    these statements in sequence—you do not need to insert special
    separators or terminators between multiple statements. A statement block
    can also be nested within another statement blocks. Generally, statement
    blocks in SystemTap scripts use the same syntax and semantics as in the
    C programming language.
   </p></section><section class="sect2" id="sec-tuning-systemtap-syntax-events" data-id-title="SystemTap events (probe points)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.3.2 </span><span class="title-name">SystemTap events (probe points)</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-syntax-events">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    SystemTap supports several built-in events.
   </p><p>
    The general event syntax is a dotted-symbol sequence. This allows a
    breakdown of the event namespace into parts. Each component identifier
    may be parameterized by a string or number literal, with a syntax like a
    function call. A component may include a <code class="literal">*</code> character,
    to expand to other matching probe points. A probe point may be followed
    by a <code class="literal">?</code> character, to indicate that it is optional,
    and that no error should result if it fails to expand.
    
    Alternately, a probe point may be followed by a <code class="literal">!</code>
    character to indicate that it is both optional and sufficient.
   </p><p>
    SystemTap supports multiple events per probe—they need to be
    separated by a comma (<code class="literal">,</code>). If multiple events are
    specified in a single probe, SystemTap will execute the handler when any
    of the specified events occur.
   </p><p>
    The events can be classified into the following categories:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Synchronous events: Occur when any process executes an instruction at
      a particular location in kernel code. This gives other events a
      reference point (instruction address) from which more contextual data
      may be available.
     </p><p>
      An example for a synchronous event is
      <code class="literal">vfs.<em class="replaceable">FILE_OPERATION</em></code>: The
      entry to the <em class="replaceable">FILE_OPERATION</em> event for
      Virtual File System (VFS). For example, in
      <a class="xref" href="#sec-tuning-systemtap-setup" title="4.2. Installation and setup">Section 4.2, “Installation and setup”</a>, <code class="literal">read</code>
      is the <em class="replaceable">FILE_OPERATION</em> event used for VFS.



     </p></li><li class="listitem"><p>
      Asynchronous events: Not tied to a particular instruction or location
      in code. This family of probe points consists mainly of counters,
      timers, and similar constructs.
     </p><p>
      Examples for asynchronous events are: <code class="literal">begin</code> (start
      of a SystemTap session—when a SystemTap script is run,
      <code class="literal">end</code> (end of a SystemTap session), or timer events.
      Timer events specify a handler to be executed periodically, like
      <code class="literal">example
      timer.s(<em class="replaceable">SECONDS</em>)</code>, or
      <code class="literal">timer.ms(<em class="replaceable">MILLISECONDS</em>)</code>.
     </p><p>
      When used together with other probes that collect information,
      timer events allow you to print periodic updates and see how that
      information changes over time.
     </p></li></ul></div><div class="complex-example"><div class="example" id="ex-tuning-stap-async" data-id-title="Probe with timer event"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 4.2: </span><span class="title-name">Probe with timer event </span></span><a title="Permalink" class="permalink" href="#ex-tuning-stap-async">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
     For example, the following probe would print the text <span class="quote">“<span class="quote">hello
     world</span>”</span> every 4 seconds:
    </p><div class="verbatim-wrap"><pre class="screen">probe timer.s(4)
{
   printf("hello world\n")
}</pre></div></div></div></div><p>
    For detailed information about supported events, refer to the
    <code class="command">stapprobes</code> man page. The <em class="citetitle">See
    Also</em> section of the man page also contains links to other
    man pages that discuss supported events for specific subsystems and
    components.
   </p></section><section class="sect2" id="sec-tuning-systemtap-syntax-handlers" data-id-title="SystemTap handlers (probe body)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.3.3 </span><span class="title-name">SystemTap handlers (probe body)</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-syntax-handlers">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Each SystemTap event is accompanied by a corresponding handler defined
    for that event, consisting of a statement block.
   </p><section class="sect3" id="sec-tuning-systemtap-syntax-handlers-functions" data-id-title="Functions"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">4.3.3.1 </span><span class="title-name">Functions</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-syntax-handlers-functions">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     If you need the same set of statements in multiple probes, you can
     place them in a function for easy reuse. Functions are defined by the
     keyword <code class="literal">function</code> followed by a name. They take any
     number of string or numeric arguments (by value) and may return a
     single string or number.
    </p><div class="verbatim-wrap"><pre class="screen">function <em class="replaceable">FUNCTION_NAME</em>(<em class="replaceable">ARGUMENTS</em>) {<em class="replaceable">STATEMENTS</em>}
probe <em class="replaceable">EVENT</em> {<em class="replaceable">FUNCTION_NAME</em>(<em class="replaceable">ARGUMENTS</em>)}</pre></div><p>
     The statements in <em class="replaceable">FUNCTION_NAME</em> are executed
     when the probe for <em class="replaceable">EVENT</em> executes. The
     <em class="replaceable">ARGUMENTS</em> are optional values passed into
     the function.
    </p><p>
     Functions can be defined anywhere in the script. They may take any
    </p><p>
     One of the functions frequently needed is already introduced in
     <a class="xref" href="#ex-tuning-stap-simple" title="Simple SystemTap script">Example 4.1, “Simple SystemTap script”</a>: the <code class="literal">printf</code>
     function for printing data in a formatted way. When using the
     <code class="literal">printf</code> function, you can specify how arguments
     should be printed by using a format string. The format string is
     included in quotation marks and can contain further format specifiers,
     introduced by a <code class="literal">%</code> character.
    </p><p>
     Which format strings to use depends on your list of arguments. Format
     strings can have multiple format specifiers—each matching a
     corresponding argument. Multiple arguments can be separated by a comma.
    </p><div class="example" id="ex-tuning-stap-printf-formatspec" data-id-title="printf Function with format specifiers"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 4.3: </span><span class="title-name"><code class="literal">printf</code> Function with format specifiers </span></span><a title="Permalink" class="permalink" href="#ex-tuning-stap-printf-formatspec">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">printf ("<span class="callout" id="co-tuning-stap-formatstring-start">1</span>%s<span class="callout" id="co-tuning-stap-string-spec">2</span>(%d<span class="callout" id="co-tuning-stap-int-spec">3</span>) open\n<span class="callout" id="co-tuning-stap-formatstring-end">4</span>", execname(), pid())</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-formatstring-start"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Start of the format string, indicated by <code class="literal">"</code>.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-string-spec"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        String format specifier.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-int-spec"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Integer format specifier.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-tuning-stap-formatstring-end"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        End of the format string, indicated by <code class="literal">"</code>.
       </p></td></tr></table></div></div></div><p>
     The example above prints the current executable name
     (<code class="literal">execname()</code>) as a string and the process ID
     (<code class="literal">pid()</code>) as an integer in brackets. Then, a space,
     the word <code class="literal">open</code> and a line break follow:
    </p><div class="verbatim-wrap"><pre class="screen">[...]
vmware-guestd(2206) open
held(2360) open
[...]</pre></div><p>
     Apart from the two functions <code class="literal">execname()</code>and
     <code class="literal">pid()</code>) used in
     <a class="xref" href="#ex-tuning-stap-printf-formatspec" title="printf Function with format specifiers">Example 4.3, “<code class="literal">printf</code> Function with format specifiers”</a>, a variety of other
     functions can be used as <code class="literal">printf</code> arguments.
    </p><p>
     Among the most commonly used SystemTap functions are the following:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.2.6.8.3.13.1"><span class="term">tid()</span></dt><dd><p>
        ID of the current thread.
       </p></dd><dt id="id-1.8.5.2.6.8.3.13.2"><span class="term">pid()</span></dt><dd><p>
        Process ID of the current thread.
       </p></dd><dt id="id-1.8.5.2.6.8.3.13.3"><span class="term">uid()</span></dt><dd><p>
        ID of the current user.
       </p></dd><dt id="id-1.8.5.2.6.8.3.13.4"><span class="term">cpu()</span></dt><dd><p>
        Current CPU number.
       </p></dd><dt id="id-1.8.5.2.6.8.3.13.5"><span class="term">execname()</span></dt><dd><p>
        Name of the current process.
       </p></dd><dt id="id-1.8.5.2.6.8.3.13.6"><span class="term">gettimeofday_s()</span></dt><dd><p>
        Number of seconds since Unix epoch (January 1, 1970).
       </p></dd><dt id="id-1.8.5.2.6.8.3.13.7"><span class="term">ctime()</span></dt><dd><p>
        Convert time into a string.
       </p></dd><dt id="id-1.8.5.2.6.8.3.13.8"><span class="term">pp()</span></dt><dd><p>
        String describing the probe point currently being handled.
       </p></dd><dt id="id-1.8.5.2.6.8.3.13.9"><span class="term">thread_indent()</span></dt><dd><p>
        Useful function for organizing print results. It (internally) stores
        an indentation counter for each thread (<code class="literal">tid()</code>).
        The function takes one argument, an indentation delta, indicating
        how many spaces to add or remove from the thread's indentation
        counter. It returns a string with some generic trace data along with
        an appropriate number of indentation spaces. The generic data
        returned includes a time stamp (number of microseconds since the
        initial indentation for the thread), a process name, and the thread
        ID itself. This allows you to identify what functions were called,
        who called them, and how long they took.
       </p><p>
        Call entries and exits often do not immediately precede each other
        (otherwise it would be easy to match them). In between a first call
        entry and its exit, usually other call entries and exits
        are made. The indentation counter helps you match an entry with its
        corresponding exit as it indents the next function call in case it
        is <span class="emphasis"><em>not</em></span> the exit of the previous one.
       </p></dd></dl></div><p>
     For more information about supported SystemTap functions, refer to the
     <code class="command">stapfuncs</code> man page.
    </p></section><section class="sect3" id="sec-tuning-systemtap-syntax-handlers-others" data-id-title="Other basic constructs"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">4.3.3.2 </span><span class="title-name">Other basic constructs</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-syntax-handlers-others">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Apart from functions, you can use other common constructs in
     SystemTap handlers, including variables, conditional statements (like
     <code class="literal">if</code>/<code class="literal">else</code>, <code class="literal">while</code>
     loops, <code class="literal">for</code> loops, arrays or command line arguments.
    </p><section class="sect4" id="sec-tuning-systemtap-syntax-handlers-others-variables" data-id-title="Variables"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">4.3.3.2.1 </span><span class="title-name">Variables</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-syntax-handlers-others-variables">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Variables may be defined anywhere in the script. To define one, simply
      choose a name and assign a value from a function or expression to it:
     </p><div class="verbatim-wrap"><pre class="screen">foo = gettimeofday( )</pre></div><p>
      Then you can use the variable in an expression. From the type of
      values assigned to the variable, SystemTap automatically infers the
      type of each identifier (string or number). Any inconsistencies will
      be reported as errors. In the example above, <code class="literal">foo</code>
      would automatically be classified as a number and could be printed via
      <code class="literal">printf()</code> with the integer format specifier
      (<code class="literal">%d</code>).
     </p><p>
      However, by default the variables are local to the probe containing them. They are initialized, used and disposed of at each handler
      evocation. To share variables between probes, declare them global
      anywhere in the script. To do so, use the <code class="literal">global</code>
      keyword outside of the probes:
     </p><div class="complex-example"><div class="example" id="id-1.8.5.2.6.8.4.3.6" data-id-title="Using global variables"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 4.4: </span><span class="title-name">Using global variables </span></span><a title="Permalink" class="permalink" href="#id-1.8.5.2.6.8.4.3.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">global count_jiffies, count_ms
probe timer.jiffies(100) { count_jiffies ++ }
probe timer.ms(100) { count_ms ++ }
probe timer.ms(12345)
{
  hz=(1000*count_jiffies) / count_ms
  printf ("jiffies:ms ratio %d:%d =&gt; CONFIG_HZ=%d\n",
    count_jiffies, count_ms, hz)
  exit ()
  }</pre></div><p>
       This example script computes the CONFIG_HZ setting of the kernel by
       using timers that count jiffies and milliseconds, then computing
       accordingly. (A jiffy is the duration of one tick of the system timer
       interrupt. It is not an absolute time interval unit, since its
       duration depends on the clock interrupt frequency of the particular
       hardware platform). With the <code class="literal">global</code> statement it
       is possible to use the variables <code class="literal">count_jiffies</code> and
       <code class="literal">count_ms</code> also in the probe
       <code class="literal">timer.ms(12345)</code>. With <code class="literal">++</code> the
       value of a variable is incremented by <code class="literal">1</code>.
      </p></div></div></div></section><section class="sect4" id="sec-tuning-systemtap-syntax-handlers-others-conditional" data-id-title="Conditional statements"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">4.3.3.2.2 </span><span class="title-name">Conditional statements</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-syntax-handlers-others-conditional">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      There are several conditional statements that you can use in
      SystemTap scripts. The most common conditional statements are the following:
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.2.6.8.4.4.3.1"><span class="term">If/else statements</span></dt><dd><p>
         They are expressed in the following format:
        </p><div class="verbatim-wrap"><pre class="screen">if (<em class="replaceable">CONDITION</em>)<span class="callout" id="co-tuning-systemtap-cond-if">1</span><em class="replaceable">STATEMENT1</em><span class="callout" id="co-tuning-systemtap-cond-if-statement1">2</span>
else<span class="callout" id="co-tuning-systemtap-cond-else">3</span><em class="replaceable">STATEMENT2</em><span class="callout" id="co-tuning-systemtap-cond-if-statement2">4</span></pre></div><p>
         The <code class="literal">if</code> statement compares an integer-valued
         expression to zero. If the condition expression
         <a class="xref" href="#co-tuning-systemtap-cond-if"><span class="callout">1</span></a>
         is non-zero, the first statement
         <a class="xref" href="#co-tuning-systemtap-cond-if-statement1"><span class="callout">2</span></a>
         is executed. If the condition expression is zero, the second
         statement
         <a class="xref" href="#co-tuning-systemtap-cond-if-statement2"><span class="callout">4</span></a>
         is executed. The else clause
         (<a class="xref" href="#co-tuning-systemtap-cond-else"><span class="callout">3</span></a>
         and
         <a class="xref" href="#co-tuning-systemtap-cond-if-statement2"><span class="callout">4</span></a>)
         is optional. Both
         <a class="xref" href="#co-tuning-systemtap-cond-if-statement1"><span class="callout">2</span></a>
         and
         <a class="xref" href="#co-tuning-systemtap-cond-if-statement2"><span class="callout">4</span></a>
         can also be statement blocks.
        </p></dd><dt id="id-1.8.5.2.6.8.4.4.3.2"><span class="term">While loops</span></dt><dd><p>
         They are expressed in the following format:
        </p><div class="verbatim-wrap"><pre class="screen">while (<em class="replaceable">CONDITION</em>)<span class="callout" id="co-tuning-systemtap-cond-while">1</span><em class="replaceable">STATEMENT</em><span class="callout" id="co-tuning-systemtap-cond-while-statement">2</span></pre></div><p>
         While <code class="literal">condition</code> is non-zero, the statement
         <a class="xref" href="#co-tuning-systemtap-cond-while-statement"><span class="callout">2</span></a>
         is executed.
         <a class="xref" href="#co-tuning-systemtap-cond-while-statement"><span class="callout">2</span></a>
         can also be a statement block. It must change a value so
         <code class="literal">condition</code> will eventually be zero.
        </p></dd><dt id="id-1.8.5.2.6.8.4.4.3.3"><span class="term">For loops</span></dt><dd><p>
         They are a shortcut for <code class="literal">while</code> loops and are
         expressed in the following format:
        </p><div class="verbatim-wrap"><pre class="screen">for (<em class="replaceable">INITIALIZATION</em><span class="callout" id="co-tuning-systemtap-cond-for-init">1</span>; <em class="replaceable">CONDITIONAL</em><span class="callout" id="co-tuning-systemtap-cond-for-cond">2</span>; <em class="replaceable">INCREMENT</em><span class="callout" id="co-tuning-systemtap-cond-for-increment">3</span>) statement</pre></div><p>
         The expression specified in
         <a class="xref" href="#co-tuning-systemtap-cond-for-init"><span class="callout">1</span></a>
         is used to initialize a counter for the number of loop iterations
         and is executed before execution of the loop starts. The execution
         of the loop continues until the loop condition
         <a class="xref" href="#co-tuning-systemtap-cond-for-cond"><span class="callout">2</span></a>
         is false. (This expression is checked at the beginning of each loop
         iteration). The expression specified in
         <a class="xref" href="#co-tuning-systemtap-cond-for-increment"><span class="callout">3</span></a>
         is used to increment the loop counter. It is executed at the end of
         each loop iteration.
        </p></dd><dt id="id-1.8.5.2.6.8.4.4.3.4"><span class="term">Conditional operators</span></dt><dd><p>
         The following operators can be used in conditional statements:
        </p><p><span class="formalpara-title">==:</span>
          Is equal to
         </p><p><span class="formalpara-title">!=:</span>
          Is not equal to
         </p><p><span class="formalpara-title">&gt;=:</span>
          Is greater than or equal to
         </p><p><span class="formalpara-title">&lt;=:</span>
          Is less than or equal to
         </p></dd></dl></div></section></section></section></section><section class="sect1" id="sec-tuning-systemtap-example" data-id-title="Example script"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.4 </span><span class="title-name">Example script</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-example">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you have installed the
   <code class="systemitem">systemtap-docs</code> package, you can
   find several useful SystemTap example scripts in
   <code class="filename">/usr/share/doc/packages/systemtap/examples</code>.
  </p><p>
   This section describes a rather simple example script in more detail:
   <code class="filename">/usr/share/doc/packages/systemtap/examples/network/tcp_connections.stp</code>.
  </p><div class="example" id="id-1.8.5.2.7.4" data-id-title="Monitoring incoming TCP connections with tcp_connections.stp"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 4.5: </span><span class="title-name">Monitoring incoming TCP connections with <code class="literal">tcp_connections.stp</code> </span></span><a title="Permalink" class="permalink" href="#id-1.8.5.2.7.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">#! /usr/bin/env stap

probe begin {
  printf("%6s %16s %6s %6s %16s\n",
         "UID", "CMD", "PID", "PORT", "IP_SOURCE")
}

probe kernel.function("tcp_accept").return?,
      kernel.function("inet_csk_accept").return? {
  sock = $return
  if (sock != 0)
    printf("%6d %16s %6d %6d %16s\n", uid(), execname(), pid(),
           inet_get_local_port(sock), inet_get_ip_source(sock))
}</pre></div></div></div><p>
   This SystemTap script monitors the incoming TCP connections and helps to
   identify unauthorized or unwanted network access requests in real time.
   It shows the following information for each new incoming TCP connection
   accepted by the computer:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     User ID (<code class="literal">UID</code>)
    </p></li><li class="listitem"><p>
     Command accepting the connection (<code class="literal">CMD</code>)
    </p></li><li class="listitem"><p>
     Process ID of the command (<code class="literal">PID</code>)
    </p></li><li class="listitem"><p>
     Port used by the connection (<code class="literal">PORT</code>)
    </p></li><li class="listitem"><p>
     IP address from which the TCP connection originated
     (<code class="literal">IP_SOURCE</code>)
    </p></li></ul></div><p>
   To run the script, execute
  </p><div class="verbatim-wrap"><pre class="screen">stap /usr/share/doc/packages/systemtap/examples/network/tcp_connections.stp</pre></div><p>
   and follow the output on the screen. To manually stop the script, press
   <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">C</span>.
  </p></section><section class="sect1" id="sec-tuning-systemtap-userspace" data-id-title="User space probing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.5 </span><span class="title-name">User space probing</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-userspace">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   
   For debugging user space applications (like DTrace can do),
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP6</span></span> supports user space probing with
   SystemTap. Custom probe points can be inserted in any user space
   application. Thus, SystemTap lets you use both kernel space and user space
   probes to debug the behavior of the whole system.
  </p><p>
   To get the required utrace infrastructure and the uprobes kernel module
   for user space probing, you need to install the
   <code class="systemitem">kernel-trace</code> package in
   addition to the packages listed in
   <a class="xref" href="#sec-tuning-systemtap-setup" title="4.2. Installation and setup">Section 4.2, “Installation and setup”</a>.
  </p><p>
   <code class="command">utrace</code> implements a framework for controlling
   user space tasks. It provides an interface that can be used by various
   tracing <span class="quote">“<span class="quote">engines</span>”</span>, implemented as loadable kernel modules.
   The engines register callback functions for specific events, then attach
   to whichever thread they want to trace. As the callbacks are made from
   <span class="quote">“<span class="quote">safe</span>”</span> places in the kernel, this allows for great leeway in
   the kinds of processing the functions can do. Several events can be
   watched via utrace. For example, you can observe events such as system call entry and exit,
   fork(), and
   signals being sent to the task. More details about the utrace
   infrastructure are available at
   <a class="link" href="https://sourceware.org/systemtap/wiki/utrace" target="_blank">https://sourceware.org/systemtap/wiki/utrace</a>.
  </p><p>
   SystemTap includes support for probing the entry into and return from a
   function in user space processes, probing predefined markers in
   user space code, and monitoring user-process events.
  </p><p>
   To check if the currently running kernel provides the needed utrace
   support, use the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> grep CONFIG_UTRACE /boot/config-`uname -r`</pre></div><p>
   For more details about user space probing, refer to
   <a class="link" href="https://sourceware.org/systemtap/SystemTap_Beginners_Guide/userspace-probing.html" target="_blank">https://sourceware.org/systemtap/SystemTap_Beginners_Guide/userspace-probing.html</a>.
  </p></section><section class="sect1" id="sec-tuning-systemtap-more" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.6 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-systemtap-more">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemtap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This chapter only provides a short SystemTap overview. Refer to the
   following links for more information about SystemTap:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.2.9.3.1"><span class="term"><a class="link" href="https://sourceware.org/systemtap/" target="_blank">https://sourceware.org/systemtap/</a>
    </span></dt><dd><p>
      SystemTap project home page.
     </p></dd><dt id="id-1.8.5.2.9.3.2"><span class="term"><a class="link" href="https://sourceware.org/systemtap/wiki/" target="_blank">https://sourceware.org/systemtap/wiki/</a>
    </span></dt><dd><p>
      A large collection of useful information about SystemTap, ranging from
      detailed user and developer documentation to reviews and comparisons
      with other tools, or Frequently Asked Questions and tips. Also
      contains collections of SystemTap scripts, examples and usage stories
      and lists recent talks and papers about SystemTap.
     </p></dd><dt id="id-1.8.5.2.9.3.3"><span class="term"><a class="link" href="https://sourceware.org/systemtap/documentation.html" target="_blank">https://sourceware.org/systemtap/documentation.html</a>
    </span></dt><dd><p>
      Features a <em class="citetitle">SystemTap Tutorial</em>, a
      <em class="citetitle">SystemTap Beginner's Guide</em>, a <em class="citetitle">Tapset
      Developer's Guide</em>, and a <em class="citetitle">SystemTap Language
      Reference</em> in PDF and HTML format. Also lists the relevant
      man pages.
     </p></dd></dl></div><p>
   You can also find the SystemTap language reference and SystemTap tutorial
   in your installed system under
   <code class="filename">/usr/share/doc/packages/systemtap</code>. Example SystemTap
   scripts are available from the <code class="filename">example</code> subdirectory.
  </p></section></section><section class="chapter" id="cha-tuning-kprobes" data-id-title="Kernel probes"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">5 </span><span class="title-name">Kernel probes</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Kernel probes are a set of tools to collect Linux kernel debugging and
  performance information. Developers and system administrators use
  them either to debug the kernel, or to find system performance
  bottlenecks. The reported data can then be used to tune the system for
  better performance.
 </p><p>
  You can insert these probes into any kernel routine, and specify a handler
  to be invoked after a particular break-point is hit. The main advantage of
  kernel probes is that you no longer need to rebuild the kernel and reboot
  the system after you make changes in a probe.
 </p><p>
  To use kernel probes, you typically need to write or obtain a specific
  kernel module. Such modules include both the <span class="emphasis"><em>init</em></span> and
  the <span class="emphasis"><em>exit</em></span> function. The init function (such as
  <code class="systemitem">register_kprobe()</code>) registers one or more probes,
  while the exit function unregisters them. The registration function
  defines <span class="emphasis"><em>where</em></span> the probe is inserted and
  <span class="emphasis"><em>which handler</em></span> is called after the probe is hit.
  To register or unregister a group of probes at one time, you can use
  relevant
  <code class="literal">register_&lt;<em class="replaceable">PROBE_TYPE</em>&gt;probes()</code>
  or
  <code class="literal">unregister_&lt;<em class="replaceable">PROBE_TYPE</em>&gt;probes()</code>
  functions.
 </p><p>
  Debugging and status messages are typically reported with the
  <code class="systemitem">printk</code> kernel routine.
  <code class="systemitem">printk</code> is a kernel space equivalent of a
  user space <code class="systemitem">printf</code> routine. For more information
  on <code class="systemitem">printk</code>, see
  <a class="link" href="https://www.win.tue.nl/~aeb/linux/lk/lk-2.html#ss2.8" target="_blank">Logging
  kernel messages</a>. Normally, you can view these messages by
  inspecting the output of the <code class="systemitem">systemd</code> journal (see
  <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: query the <code class="systemitem">systemd</code> journal”</span>). For more information on log files, see
  <a class="xref" href="#cha-tuning-syslog" title="Chapter 3. System log files">Chapter 3, <em>System log files</em></a>.
 </p><section class="sect1" id="cha-tuning-kprobes-supparch" data-id-title="Supported architectures"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.1 </span><span class="title-name">Supported architectures</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes-supparch">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Kernel probes are <span class="emphasis"><em>fully</em></span> implemented on the following
   architectures:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     x86
    </p></li><li class="listitem"><p>
     AMD64/Intel 64
    </p></li><li class="listitem"><p>
     Arm
    </p></li><li class="listitem"><p>
     POWER
    </p></li></ul></div><p>
   Kernel probes are <span class="emphasis"><em>partially</em></span> implemented on the
   following architectures:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     IA64 (does not support probes on instruction
     <code class="systemitem">slot1</code>)
    </p></li><li class="listitem"><p>
     sparc64 (return probes not yet implemented)
    </p></li></ul></div></section><section class="sect1" id="cha-tuning-kprobes-types" data-id-title="Types of kernel probes"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.2 </span><span class="title-name">Types of kernel probes</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes-types">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are three types of kernel probes: <span class="emphasis"><em>Kprobes</em></span>,
   <span class="emphasis"><em>Jprobes</em></span>, and <span class="emphasis"><em>Kretprobes</em></span>.
   Kretprobes are sometimes called <span class="emphasis"><em>return
   probes</em></span>. You can find source code examples of all three type of
   probes in the Linux kernel. See the directory
   <code class="filename">/usr/src/linux/samples/kprobes/</code> (package
   <code class="systemitem">kernel-source</code>).
   
  </p><section class="sect2" id="cha-tuning-kprobes-types-kprobe" data-id-title="Kprobes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.1 </span><span class="title-name">Kprobes</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes-types-kprobe">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Kprobes can be attached to any instruction in the Linux kernel.
    When Kprobes is registered, it inserts a break-point at the first
    byte of the probed instruction. When the processor hits this
    break-point, the processor registers are saved, and the processing
    passes to Kprobes. First, a <span class="emphasis"><em>pre-handler</em></span> is
    executed, then the probed instruction is stepped, and, finally a
    <span class="emphasis"><em>post-handler</em></span> is executed. The control is then passed
    to the instruction following the probe point.
   </p></section><section class="sect2" id="cha-tuning-kprobes-types-jprobe" data-id-title="Jprobes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.2 </span><span class="title-name">Jprobes</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes-types-jprobe">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Jprobes is implemented through the Kprobes mechanism. It is
    inserted on a function's entry point and allows direct access to the
    arguments of the function which is being probed. Its handler routine
    must have the same argument list and return value as the probed
    function. To end it, call the <code class="systemitem">jprobe_return()</code>
    function.
   </p><p>
    When a jprobe is hit, the processor registers are saved, and the
    instruction pointer is directed to the jprobe handler routine. The
    control then passes to the handler with the same register contents as the
    function being probed. Finally, the handler calls the
    <code class="systemitem">jprobe_return()</code> function, and switches the
    control back to the control function.
   </p><p>
    Generally, you can insert multiple probes on one function. Jprobe is,
    however, limited to only one instance per function.
   </p></section><section class="sect2" id="cha-tuning-kprobes-types-kretprobe" data-id-title="Return probe"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.3 </span><span class="title-name">Return probe</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes-types-kretprobe">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Return probes are also implemented through Kprobes. When the
    <code class="systemitem">register_kretprobe()</code> function is called, a
    kprobe is attached to the entry of the probed function.
    After hitting the probe, the kernel probes mechanism saves the probed
    function return address and calls a user-defined return handler. The
    control is then passed back to the probed function.
   </p><p>
    Before you call <code class="systemitem">register_kretprobe()</code>, you need
    to set a <code class="systemitem">maxactive</code> argument, which specifies
    how many instances of the function can be probed at the same time. If
    set too low, a certain number of probes is missed.
   </p></section></section><section class="sect1" id="cha-tuning-kprobes-api" data-id-title="Kprobes API"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.3 </span><span class="title-name">Kprobes API</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes-api">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The programming interface of Kprobes consists of functions which are
   used to register and unregister all used kernel probes, and associated
   probe handlers. For a more detailed description of these functions and
   their arguments, see the information sources in
   <a class="xref" href="#cha-tuning-kprobes-moreinfo" title="5.5. More information">Section 5.5, “More information”</a>.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.3.9.3.1"><span class="term"><code class="systemitem">register_kprobe()</code>
    </span></dt><dd><p>
      Inserts a break-point on a specified address. When the break-point is
      hit, the <code class="systemitem">pre_handler</code> and
      <code class="systemitem">post_handler</code> are called.
     </p></dd><dt id="id-1.8.5.3.9.3.2"><span class="term"><code class="systemitem">register_jprobe()</code>
    </span></dt><dd><p>
      Inserts a break-point in the specified address. The address needs to
      be the address of the first instruction of the probed function. When
      the break-point is hit, the specified handler is run. The handler
      should have the same argument list and return type as the probed.
     </p></dd><dt id="id-1.8.5.3.9.3.3"><span class="term"><code class="systemitem">register_kretprobe()</code>
    </span></dt><dd><p>
      Inserts a return probe for the specified function. When the probed
      function returns, a specified handler is run. This function returns 0
      on success, or a negative error number on failure.
     </p></dd><dt id="id-1.8.5.3.9.3.4"><span class="term"><code class="systemitem">unregister_kprobe()</code>, <code class="systemitem">unregister_jprobe()</code>, <code class="systemitem">unregister_kretprobe()</code>
    </span></dt><dd><p>
      Removes the specified probe. You can use it any time after the probe
      has been registered.
     </p></dd><dt id="id-1.8.5.3.9.3.5"><span class="term"><code class="systemitem">register_kprobes()</code>, <code class="systemitem">register_jprobes()</code>, <code class="systemitem">register_kretprobes()</code>
    </span></dt><dd><p>
      Inserts each of the probes in the specified array.
     </p></dd><dt id="id-1.8.5.3.9.3.6"><span class="term"><code class="systemitem">unregister_kprobes()</code>, <code class="systemitem">unregister_jprobes()</code>, <code class="systemitem">unregister_kretprobes()</code>
    </span></dt><dd><p>
      Removes each of the probes in the specified array.
     </p></dd><dt id="id-1.8.5.3.9.3.7"><span class="term"><code class="systemitem">disable_kprobe()</code>, <code class="systemitem">disable_jprobe()</code>, <code class="systemitem">disable_kretprobe()</code>
    </span></dt><dd><p>
      Disables the specified probe temporarily.
     </p></dd><dt id="id-1.8.5.3.9.3.8"><span class="term"><code class="systemitem">enable_kprobe()</code>, <code class="systemitem">enable_jprobe()</code>, <code class="systemitem">enable_kretprobe()</code>
    </span></dt><dd><p>
      Temporarily enables disabled probes.
     </p></dd></dl></div></section><section class="sect1" id="cha-tuning-kprobes-debugfs" data-id-title="debugfs Interface"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.4 </span><span class="title-name"><code class="systemitem">debugfs</code> Interface</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes-debugfs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In recent Linux kernels, the Kprobes instrumentation uses the
   kernel's <code class="systemitem">debugfs</code> interface. It can list all
   registered probes and globally switch all probes on or off.
  </p><section class="sect2" id="cha-tuning-kprobes-debugfs-list" data-id-title="Listing registered kernel probes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.4.1 </span><span class="title-name">Listing registered kernel probes</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes-debugfs-list">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The list of all currently registered probes is in the
    <code class="filename">/sys/kernel/debug/kprobes/list</code> file.
   </p><div class="verbatim-wrap"><pre class="screen">saturn.example.com:~ # cat /sys/kernel/debug/kprobes/list
c015d71a  k  vfs_read+0x0   [DISABLED]
c011a316  j  do_fork+0x0
c03dedc5  r  tcp_v4_rcv+0x0</pre></div><p>
    The first column lists the address in the kernel where the probe is
    inserted. The second column prints the type of the probe:
    <code class="literal">k</code> for kprobe, <code class="literal">j</code> for jprobe, and
    <code class="literal">r</code> for return probe. The third column specifies the
    symbol, offset and optional module name of the probe. The following
    optional columns include the status information of the probe. If the
    probe is inserted on a virtual address which is not valid anymore, it is
    marked with <code class="literal">[GONE]</code>. If the probe is temporarily
    disabled, it is marked with <code class="literal">[DISABLED]</code>.
   </p></section><section class="sect2" id="cha-tuning-kprobes-debugfs-switch" data-id-title="Globally enabling/disabling kernel probes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.4.2 </span><span class="title-name">Globally enabling/disabling kernel probes</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes-debugfs-switch">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="filename">/sys/kernel/debug/kprobes/enabled</code> file
    represents a switch with which you can globally and forcibly turn on or
    off all the registered kernel probes. To turn them off, simply enter
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>echo "0" &gt; /sys/kernel/debug/kprobes/enabled</pre></div><p>
    on the command line as <code class="systemitem">root</code>. To turn them on again, enter
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>echo "1" &gt; /sys/kernel/debug/kprobes/enabled</pre></div><p>
    With such operations, you do not change the status of the probes. If a
    probe is temporarily disabled, it is not enabled automatically but remains in the <code class="literal">[DISABLED]</code> state after entering
    the latter command.
   </p></section></section><section class="sect1" id="cha-tuning-kprobes-moreinfo" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.5 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kprobes-moreinfo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To learn more about kernel probes, look at the following sources of
   information:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Thorough but more technically oriented information about kernel probes
     is in <code class="filename">/usr/src/linux/Documentation/trace/kprobes.txt</code>
     (package <code class="systemitem">kernel-source</code>).
    </p></li><li class="listitem"><p>
     Examples of all three types of probes (together with related
     <code class="filename">Makefile</code>) are in the
     <code class="filename">/usr/src/linux/samples/kprobes/</code> directory (package
     <code class="systemitem">kernel-source</code>).
    </p></li><li class="listitem"><p>
     In-depth information about Linux kernel modules and
     <code class="systemitem">printk</code> kernel routine can be found at
     <a class="link" href="https://tldp.org/LDP/lkmpg/2.6/html/lkmpg.html" target="_blank">The
     Linux Kernel Module Programming Guide</a>
    </p></li></ul></div></section></section><section class="chapter" id="cha-perf" data-id-title="Hardware-based performance monitoring with Perf"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">6 </span><span class="title-name">Hardware-based performance monitoring with Perf</span></span> <a title="Permalink" class="permalink" href="#cha-perf">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_perf.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Perf is an interface to access the performance monitoring unit (PMU) of a
    processor and to record and display software events such as page faults.
    It supports system-wide, per-thread, and KVM virtualization guest
    monitoring.
   </p></div></div></div></div><p>
  You can store resulting information in a report.
  This report contains information about, for example, instruction pointers or
  what code a thread was executing.
 </p><p>
  Perf consists of two parts:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Code integrated into the Linux kernel that instructs
    the hardware.
   </p></li><li class="listitem"><p>
    The <code class="command">perf</code> user space utility that allows you to use the
    kernel code and helps you analyze gathered data.
   </p></li></ul></div><section class="sect1" id="sec-perf-concept" data-id-title="Hardware-based monitoring"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.1 </span><span class="title-name">Hardware-based monitoring</span></span> <a title="Permalink" class="permalink" href="#sec-perf-concept">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_perf.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Performance monitoring means collecting information related to how an
   application or system performs.
   This information can be obtained either through software-based means or from
   the CPU or chipset.
   Perf integrates both of these methods.
  </p><p>
   Many modern processors contain a performance monitoring unit (PMU).
   The design and functionality of a PMU is CPU-specific.
   For example, the number of registers, counters and features supported varies by CPU implementation.
  </p><p>
   Each PMU model consists of a set of registers: the performance monitor
   configuration (PMC) and the performance monitor data (PMD).
   Both can be read, but only PMCs are writable.
   These registers store configuration information and data.
  </p></section><section class="sect1" id="sec-perf-sample-count" data-id-title="Sampling and counting"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.2 </span><span class="title-name">Sampling and counting</span></span> <a title="Permalink" class="permalink" href="#sec-perf-sample-count">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_perf.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Perf supports several profiling modes:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title">Counting. </span>
      Count the number of occurrences of an event.
     </p></li><li class="listitem"><p><span class="formalpara-title">Event-based sampling. </span>
      A less exact way of counting: A sample is recorded whenever a certain
      threshold number of events has occurred.
     </p></li><li class="listitem"><p><span class="formalpara-title">Time-based sampling. </span>
      A less exact way of counting: A sample is recorded in a defined frequency.
     </p></li><li class="listitem"><p><span class="formalpara-title">Instruction-based sampling (AMD64 only). </span>
      The processor follows instructions appearing in a given interval and
      samples which events they produce.
      This allows following up on individual instructions and seeing which of
      them is critical to performance.
     </p></li></ul></div></section><section class="sect1" id="sec-perf-install" data-id-title="Installing Perf"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.3 </span><span class="title-name">Installing Perf</span></span> <a title="Permalink" class="permalink" href="#sec-perf-install">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_perf.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The Perf kernel code is already included with the default kernel.
   To be able to use the user space utility, install the package
   <span class="package">perf</span>.
  </p></section><section class="sect1" id="sec-perf-subcommand" data-id-title="Perf subcommands"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.4 </span><span class="title-name">Perf subcommands</span></span> <a title="Permalink" class="permalink" href="#sec-perf-subcommand">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_perf.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To gather the required information, the <code class="command">perf</code> tool has
   several subcommands. This section gives an overview of the most often used
   commands.
  </p><p>
   To see help in the form of a man page for any of the subcommands, use either
   <code class="command">perf help</code><em class="replaceable">SUBCOMMAND</em>
   or
   <code class="command">man perf-</code><em class="replaceable">SUBCOMMAND</em>.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.4.10.4.1"><span class="term"><code class="command">perf stat</code></span></dt><dd><p>
      Start a program and create a statistical overview that is displayed after
      the program quits.
      <code class="command">perf stat</code> is used to count events.
     </p></dd><dt id="id-1.8.5.4.10.4.2"><span class="term"><code class="command">perf record</code></span></dt><dd><p>
      Start a program and create a report with performance counter information.
      The report is stored as <code class="filename">perf.data</code> in the current
      directory.
      <code class="command">perf record</code> is used to sample events.
     </p></dd><dt id="id-1.8.5.4.10.4.3"><span class="term"><code class="command">perf report</code></span></dt><dd><p>
      Display a report that was previously created with
      <code class="command">perf record</code>.
     </p></dd><dt id="id-1.8.5.4.10.4.4"><span class="term"><code class="command">perf annotate</code></span></dt><dd><p>
      Display a report file and an annotated version of the executed
      code.
      If debug symbols are installed, the source code is also displayed.
     </p></dd><dt id="id-1.8.5.4.10.4.5"><span class="term"><code class="command">perf list</code></span></dt><dd><p>
      List event types that Perf can report with the current kernel and with
      your CPU.
      You can filter event types by category. For example, to see hardware
      events only, use <code class="command">perf list hw</code>.
     </p><p>
      The man page for <code class="command">perf_event_open</code> has short descriptions
      for the most important events.
      For example, to find a description of the event
      <code class="systemitem">branch-misses</code>, search for
      <code class="literal">BRANCH_MISSES</code> (note the spelling differences):
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">man</code> perf_event_open | <code class="command">grep</code> -A5 <em class="replaceable">BRANCH_MISSES</em></pre></div><p>
      Sometimes, events may be ambiguous.
      The lowercase hardware event names are not the names of raw
      hardware events but instead the names of aliases created by Perf.
      These aliases map to differently named but similarly defined hardware
      events on each supported processor.
     </p><p>
      For example, the <code class="systemitem">cpu-cycles</code> event is mapped to
      the hardware event <code class="systemitem">UNHALTED_CORE_CYCLES</code> on
      Intel processors.
      On AMD processors, however, it is mapped to the hardware event
      <code class="systemitem">CPU_CLK_UNHALTED</code>.
     </p><p>
      Perf also allows measuring raw events specific to your hardware.
      To look up their descriptions, see the
      Architecture Software Developer's Manual of your CPU vendor.
      The relevant documents for AMD64/Intel 64 processors are linked to in
      <a class="xref" href="#sec-perf-more" title="6.7. More information">Section 6.7, “More information”</a>.
     </p></dd><dt id="id-1.8.5.4.10.4.6"><span class="term"><code class="command">perf top</code></span></dt><dd><p>
      Display system activity as it happens.
     </p></dd><dt id="id-1.8.5.4.10.4.7"><span class="term"><code class="command">perf trace</code></span></dt><dd><p>
      This command behaves similarly to <code class="command">strace</code>.
      With this subcommand, you can see which system calls are executed by a
      particular thread or process and which signals it receives.
     </p></dd></dl></div></section><section class="sect1" id="sec-perf-event" data-id-title="Counting particular types of event"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.5 </span><span class="title-name">Counting particular types of event</span></span> <a title="Permalink" class="permalink" href="#sec-perf-event">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_perf.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To count the number of occurrences of an event, such as those displayed by
   <code class="command">perf list</code>, use:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">perf</code> stat -e <em class="replaceable">EVENT</em> -a</pre></div><p>
   To count multiple types of events at once, list them separated by commas.
   For example, to count <code class="systemitem">cpu-cycles</code> and
   <code class="systemitem">instructions</code>, use:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">perf</code> stat -e cpu-cycles,instructions -a</pre></div><p>
   To stop the session, press
   <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">C</span>.
  </p><p>
   You can also count the number of occurrences of an event within a particular
   time:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">perf</code> stat -e <em class="replaceable">EVENT</em> -a -- sleep <em class="replaceable">TIME</em></pre></div><p>
   Replace <em class="replaceable">TIME</em> by a value in seconds.
  </p></section><section class="sect1" id="sec-perf-command" data-id-title="Recording events specific to particular commands"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.6 </span><span class="title-name">Recording events specific to particular commands</span></span> <a title="Permalink" class="permalink" href="#sec-perf-command">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_perf.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are several ways to sample events specific to a particular command:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      To create a report for a newly invoked command, use:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">perf</code> record <em class="replaceable">COMMAND</em></pre></div><p>
      Then, use the started process normally.
      When you quit the process, the Perf session also stops.
     </p></li><li class="listitem"><p>
      To create a report for the entire system while a newly invoked command is
      running, use:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">perf</code> record -a <em class="replaceable">COMMAND</em></pre></div><p>
      Then, use the started process normally.
      When you quit the process, the Perf session also stops.
     </p></li><li class="listitem"><p>
      To create a report for an already running process, use:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">perf</code> record -p <em class="replaceable">PID</em></pre></div><p>
      Replace <em class="replaceable">PID</em> with a process ID.
      To stop the session, press
      <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">C</span>.
     </p></li></ul></div><p>
   Now you can view the gathered data (<code class="filename">perf.data</code>)
   using:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">perf</code> report</pre></div><p>
   This opens a pseudo-graphical interface.
   
   To receive help, press <span class="keycap">H</span>.
   To quit, press <span class="keycap">Q</span>.
  </p><p>
   If you prefer a graphical interface, try the GTK+ interface of Perf:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">perf</code> report --gtk</pre></div><p>
    However, the GTK+ interface is limited in functionality.
    
  </p></section><section class="sect1" id="sec-perf-more" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.7 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-perf-more">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_perf.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This chapter only provides a short overview. Refer to the following links
   for more information:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.4.13.3.1"><span class="term"><a class="link" href="https://perf.wiki.kernel.org/index.php/Main_Page" target="_blank">https://perf.wiki.kernel.org/index.php/Main_Page</a>
    </span></dt><dd><p>
      The project home page.
      It also features a tutorial on using <code class="command">perf</code>.
     </p></dd><dt id="id-1.8.5.4.13.3.2"><span class="term"><a class="link" href="https://www.brendangregg.com/perf.html" target="_blank">https://www.brendangregg.com/perf.html</a>
    </span></dt><dd><p>
      Unofficial page with many one-line examples of how to use
      <code class="command">perf</code>.
     </p></dd><dt id="id-1.8.5.4.13.3.3"><span class="term"><a class="link" href="https://web.eece.maine.edu/~vweaver/projects/perf_events/" target="_blank">https://web.eece.maine.edu/~vweaver/projects/perf_events/</a>
    </span></dt><dd><p>
      Unofficial page with several resources, primarily relating to the Linux
      kernel code of Perf and its API.
      This page includes, for example, a CPU compatibility table and a
      programming guide.
     </p></dd><dt id="id-1.8.5.4.13.3.4"><span class="term"><a class="link" href="https://www-ssl.intel.com/content/dam/www/public/us/en/documents/manuals/64-ia-32-architectures-software-developer-vol-3b-part-2-manual.pdf" target="_blank">https://www-ssl.intel.com/content/dam/www/public/us/en/documents/manuals/64-ia-32-architectures-software-developer-vol-3b-part-2-manual.pdf</a>
    </span></dt><dd><p>
      The <em class="citetitle">Intel Architectures Software Developer's Manual,
      Volume 3B</em>.
     </p></dd><dt id="id-1.8.5.4.13.3.5"><span class="term"><a class="link" href="https://support.amd.com/TechDocs/24593.pdf" target="_blank">https://support.amd.com/TechDocs/24593.pdf</a>
    </span></dt><dd><p>
      The <em class="citetitle">AMD Architecture Programmer's Manual, Volume 2</em>.
     </p></dd><dt id="id-1.8.5.4.13.3.6"><span class="term"><a class="xref" href="#cha-tuning-oprofile" title="Chapter 7. OProfile—system-wide profiler">Chapter 7, <em>OProfile—system-wide profiler</em></a>
    </span></dt><dd><p>
      Consult this chapter for other performance optimizations.
     </p></dd></dl></div></section></section><section class="chapter" id="cha-tuning-oprofile" data-id-title="OProfile—system-wide profiler"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">7 </span><span class="title-name">OProfile—system-wide profiler</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-oprofile">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_oprofile.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    OProfile is a profiler for dynamic program analysis. It investigates
    the behavior of a running program and gathers information. This
    information can be viewed and gives hints for further optimization.
   </p><p>
    It is not necessary to recompile or use wrapper libraries to
    use OProfile. Not even a kernel patch is needed. When
    profiling an application, you can expect a small overhead, depending on the
    workload and sampling frequency.
   </p></div></div></div></div><section class="sect1" id="sec-tuning-oprofile-overview" data-id-title="Conceptual overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.1 </span><span class="title-name">Conceptual overview</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-oprofile-overview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_oprofile.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   OProfile consists of a kernel driver and a daemon for collecting data.
   It uses the hardware performance counters provided on many
   processors. OProfile is capable of profiling all code
   including the kernel, kernel modules, kernel interrupt handlers, system
   shared libraries, and other applications.
  </p><p>
   Modern processors support profiling through the hardware by performance
   counters. Depending on the processor, there can be many counters and each
   of these can be programmed with an event to count. Each counter has a
   value which determines how often a sample is taken. The lower the value,
   the more often it is used.
  </p><p>
   During the post-processing step, all information is collected and
   instruction addresses are mapped to a function name.
  </p></section><section class="sect1" id="sec-tuning-oprofile-install" data-id-title="Installation and requirements"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.2 </span><span class="title-name">Installation and requirements</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-oprofile-install">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_oprofile.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To use OProfile, install the <code class="systemitem">oprofile</code> package.<span class="phrase">
   OProfile works on AMD64/Intel 64, IBM Z, and POWER processors.</span>
  </p><p>
   It is useful to install the <code class="filename">*-debuginfo</code> package for
   the respective application you want to profile. To profile
   the kernel, you need the <code class="filename">debuginfo</code> package as well.
  </p></section><section class="sect1" id="sec-tuning-oprofile-utils" data-id-title="Available OProfile utilities"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.3 </span><span class="title-name">Available OProfile utilities</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-oprofile-utils">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_oprofile.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   OProfile contains several utilities to handle the profiling process and
   its profiled data. The following list is a short summary of programs used
   in this chapter:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.5.5.3.1"><span class="term"><code class="command">opannotate</code>
    </span></dt><dd><p>
      Outputs annotated source or assembly listings mixed with profile
      information. An annotated report can be used in combination with
      <code class="command">addr2line</code> to identify the source file and line
      where hotspots potentially exist. See <code class="command">man addr2line</code>
      for more information.
     </p></dd><dt id="id-1.8.5.5.5.3.2"><span class="term"><code class="command">operf</code>
    </span></dt><dd><p>
      Profiler tool. After profiling stops, the data that is by default stored in
      <code class="filename"><em class="replaceable">CUR_DIR</em>/oprofile_data/samples/current</code>
      can be processed by <code class="command">opreport</code>, for example.
     </p></dd><dt id="id-1.8.5.5.5.3.3"><span class="term"><code class="command">ophelp</code>
    </span></dt><dd><p>
      Lists available events with short descriptions.
     </p></dd><dt id="id-1.8.5.5.5.3.4"><span class="term"><code class="command">opimport</code>
    </span></dt><dd><p>
      Converts sample database files from a foreign binary format to the format specific to the platform.
     </p></dd><dt id="id-1.8.5.5.5.3.5"><span class="term"><code class="command">opreport</code>
    </span></dt><dd><p>
      Generates reports from profiled data.
     </p></dd></dl></div></section><section class="sect1" id="sec-tuning-oprofile-using" data-id-title="Using OProfile"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.4 </span><span class="title-name">Using OProfile</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-oprofile-using">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_oprofile.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   With OProfile, you can profile both the kernel and applications. When
   profiling the kernel, tell OProfile where to find the
   <code class="filename">vmlinuz*</code> file. Use the <code class="option">--vmlinux</code>
   option and point it to <code class="filename">vmlinuz*</code> (generally available in
   <code class="filename">/boot</code>). If you need to profile kernel modules,
   OProfile does this by default. However, make sure you read
   <a class="link" href="https://oprofile.sourceforge.net/doc/kernel-profiling.html" target="_blank">https://oprofile.sourceforge.net/doc/kernel-profiling.html</a>.
  </p><p>
   Most applications do not need to profile the kernel, therefore you
   should use the <code class="option">--no-vmlinux</code> option to reduce the amount
   of information.
  </p><section class="sect2" id="sec-tuning-oprofile-using-report" data-id-title="Creating a report"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.4.1 </span><span class="title-name">Creating a report</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-oprofile-using-report">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_oprofile.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Starting the daemon, collecting data, stopping the daemon, and creating
    a report for the application <em class="replaceable">COMMAND</em>.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Open a shell and log in as <code class="systemitem">root</code>.
     </p></li><li class="step"><p>
      Decide whether to profile with or without the Linux kernel:
     </p><ol type="a" class="substeps"><li class="step"><p><span class="formalpara-title">Profile with the Linux kernel. </span>
         Execute the following commands, because
         <code class="command">operf</code> can only work with uncompressed
         images:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cp /boot/vmlinux-`uname -r`.gz /tmp
<code class="prompt user">&gt; </code>gunzip /tmp/vmlinux*.gz
<code class="prompt user">&gt; </code>operf--vmlinux=/tmp/vmlinux* <em class="replaceable">COMMAND</em></pre></div></li><li class="step"><p><span class="formalpara-title">Profile without the Linux kernel. </span>
         Use the following command:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>operf --no-vmlinux <em class="replaceable">COMMAND</em></pre></div><p>
        To see which functions call other functions in the
        output, additionally use the <code class="option">--callgraph</code> option and
        set a maximum <em class="replaceable">DEPTH</em>:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>operf --no-vmlinux --callgraph
<em class="replaceable">DEPTH</em> <em class="replaceable">COMMAND</em></pre></div></li></ol></li><li class="step"><p>
      <code class="command">operf</code> writes its data to <code class="filename"><em class="replaceable">CUR_DIR</em>/oprofile_data/samples/current</code>.
      After the <code class="command">operf</code> command is finished (or is aborted by
      <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">C</span>),
      the data can be analyzed with <code class="command">oreport</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>opreport
Overflow stats not available
CPU: CPU with timer interrupt, speed 0 MHz (estimated)
Profiling through timer interrupt
          TIMER:0|
  samples|      %|
------------------
    84877 98.3226 no-vmlinux
...</pre></div></li></ol></div></div></section><section class="sect2" id="sec-tuning-oprofile-events" data-id-title="Getting event configurations"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.4.2 </span><span class="title-name">Getting event configurations</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-oprofile-events">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_oprofile.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The general procedure for event configuration is as follows:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Use first the events <code class="literal">CPU-CLK_UNHALTED</code> and
      <code class="literal">INST_RETIRED</code> to find optimization opportunities.
     </p></li><li class="step"><p>
      Use specific events to find bottlenecks. To list them, use the command
      <code class="command">perf list</code>.
     </p></li></ol></div></div><p>
    If you need to profile certain events, first check the available events
    supported by your processor with the <code class="command">ophelp</code> command
    (example output generated from Intel Core i5 CPU):
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">ophelp</code>
oprofile: available events for CPU type "Intel Architectural Perfmon"

See Intel 64 and IA-32 Architectures Software Developer's Manual
Volume 3B (Document 253669) Chapter 18 for architectural perfmon events
This is a limited set of fallback events because oprofile does not know your CPU
CPU_CLK_UNHALTED: (counter: all))
        Clock cycles when not halted (min count: 6000)
INST_RETIRED: (counter: all))
        number of instructions retired (min count: 6000)
LLC_MISSES: (counter: all))
        Last level cache demand requests from this core that missed the LLC (min count: 6000)
        Unit masks (default 0x41)
        ----------
        0x41: No unit mask
LLC_REFS: (counter: all))
        Last level cache demand requests from this core (min count: 6000)
        Unit masks (default 0x4f)
        ----------
        0x4f: No unit mask
BR_MISS_PRED_RETIRED: (counter: all))
        number of mispredicted branches retired (precise) (min count: 500)</pre></div><p>
    Specify the performance counter events with the option
    <code class="option">--event</code>. Multiple options are possible. This option
    needs an event name (from <code class="command">ophelp</code>) and a sample rate,
    for example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>operf --events CPU_CLK_UNHALTED:100000</pre></div><div id="id-1.8.5.5.6.5.8" data-id-title="Setting sampling rates with CPU_CLK_UNHALTED" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Setting sampling rates with <code class="literal">CPU_CLK_UNHALTED</code></div><p>
     Setting low sampling rates can seriously impair the system performance
     while high sample rates can disrupt the system to such a high degree
     that the data is useless. It is recommended to tune the performance
     metric for being monitored with and without OProfile and to
     experimentally determine the minimum sample rate that disrupts the
     performance the least.
    </p></div></section></section><section class="sect1" id="sec-tuning-oprofiles-report" data-id-title="Generating reports"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.5 </span><span class="title-name">Generating reports</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-oprofiles-report">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_oprofile.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Before generating a report, make sure the <code class="command">operf</code> has
   stopped. Unless you have provided an output directory with
   <code class="option">--session-dir</code>, <code class="command">operf</code> has written its
   data to <em class="replaceable">CUR_DIR</em>/oprofile_data/samples/current,
   and the reporting tools <code class="command">opreport</code> and
   <code class="command">opannotate</code> look there by default.
  </p><p>
   Calling <code class="command">opreport</code> without any options gives a complete
   summary. With an executable as an argument, retrieve profile data only
   from this executable. If you analyze applications written in C++, use the
   <code class="option">--demangle smart</code> option.
  </p><p>
   The <code class="command">opannotate</code> generates output with annotations from
   source code. Run it with the following options:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">opannotate</code> --source \
   --base-dirs=<em class="replaceable">BASEDIR</em> \
   --search-dirs=<em class="replaceable">SEARCHDIR</em> \
   --output-dir=annotated/ \
   /lib/libfoo.so</pre></div><p>
   The option <code class="option">--base-dir</code> contains a comma-separated list of
   paths which is stripped from debug source files. These paths are
   searched before looking in <code class="option">--search-dirs</code>. The
   <code class="option">--search-dirs</code> option is also a comma-separated list of
   directories to search for source files.
  </p><div id="id-1.8.5.5.7.7" data-id-title="Inaccuracies in annotated source" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Inaccuracies in annotated source</div><p>
    Because of compiler optimization, code can disappear and appear in a
    different place. Use the information in
    <a class="link" href="https://oprofile.sourceforge.net/doc/debug-info.html" target="_blank">https://oprofile.sourceforge.net/doc/debug-info.html</a>
    to fully understand its implications.
   </p></div></section><section class="sect1" id="sec-tuning-oprofile-moreinfo" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.6 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-oprofile-moreinfo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_oprofile.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This chapter only provides a short overview. Refer to the following links
   for more information:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.5.8.3.1"><span class="term"><a class="link" href="https://oprofile.sourceforge.net" target="_blank">https://oprofile.sourceforge.net</a>
    </span></dt><dd><p>
      The project home page.
     </p></dd><dt id="id-1.8.5.5.8.3.2"><span class="term">Manpages</span></dt><dd><p>
      Details descriptions about the options of the different tools.
     </p></dd><dt id="id-1.8.5.5.8.3.3"><span class="term"><code class="filename">/usr/share/doc/packages/oprofile/oprofile.html</code>
    </span></dt><dd><p>
      Contains the OProfile manual.
     </p></dd><dt id="id-1.8.5.5.8.3.4"><span class="term"><a class="link" href="https://developer.intel.com/" target="_blank">https://developer.intel.com/</a>
    </span></dt><dd><p>
      Architecture reference for Intel processors.
     </p></dd></dl></div></section></section><section class="chapter" id="cha-tuning-dynamic-debug" data-id-title="Dynamic debug—kernel debugging messages"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">8 </span><span class="title-name">Dynamic debug—kernel debugging messages</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-dynamic-debug">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_dynamic_debug.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
        Dynamic debug is a powerful debugging feature in the Linux kernel that
        allows you to enable and disable debugging messages at runtime without
        the need to recompile the kernel or reboot the system.
      </p></div></div></div></div><p>
    You can use dynamic debugging in several situations, such as:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        Troubleshooting kernel issues
      </p></li><li class="listitem"><p>
        Developing drivers for new hardware
      </p></li><li class="listitem"><p>
        Tracing and auditing security events
      </p></li></ul></div><section class="sect1" id="sec-tuning-dynamic-debug-benefits" data-id-title="Benefits of dynamic debugging"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.1 </span><span class="title-name">Benefits of dynamic debugging</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-dynamic-debug-benefits">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_dynamic_debug.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Certain benefits of dynamic debugging are listed below:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.6.5.3.1"><span class="term">Real-time debugging</span></dt><dd><p>
            Dynamic debugging enables debugging messages without requiring a
            system reboot. This real-time capability is crucial for diagnosing
            issues in production environments.
          </p></dd><dt id="id-1.8.5.6.5.3.2"><span class="term">Selective debugging</span></dt><dd><p>
            You can enable debugging messages for specific parts of the kernel
            or even individual modules, allowing you to focus on relevant
            information.
          </p></dd><dt id="id-1.8.5.6.5.3.3"><span class="term">Performance tuning</span></dt><dd><p>
            Use dynamic debugging to monitor and optimize kernel performance by
            selectively enabling or disabling debugging messages based on the
            current analysis requirements.
          </p></dd></dl></div></section><section class="sect1" id="sec-tuning-dynamic-debug-check" data-id-title="Checking the status of dynamic debug"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.2 </span><span class="title-name">Checking the status of dynamic debug</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-dynamic-debug-check">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_dynamic_debug.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      For supported kernel versions that are installed by default, dynamic
      debug is already built in. To check the status of dynamic debug, run the
      following command as the root user:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">zcat /proc/config.gz | grep CONFIG_DYNAMIC_DEBUG</code></pre></div><p>
      If dynamic debug is compiled into the kernel, you should see an output
      similar to the following:
    </p><div class="verbatim-wrap"><pre class="screen">CONFIG_DYNAMIC_DEBUG=y
CONFIG_DYNAMIC_DEBUG_CORE=y</pre></div></section><section class="sect1" id="sec-tuning-dynamic-debug-use" data-id-title="Using dynamic debug"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.3 </span><span class="title-name">Using dynamic debug</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-dynamic-debug-use">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_dynamic_debug.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To enable specific debug messages or logs within the running kernel, you
      can use the <code class="command">echo</code> command and write to the
      <code class="filename">/sys/kernel/debug/dynamic_debug/control</code> file.
    </p><p>
      The following examples illustrate certain simple uses of dynamic debug:
    </p><div id="id-1.8.5.6.7.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
        Dynamic debug relies on specific debugging macros, such as
        <code class="systemitem">pr_debug</code>, embedded in the kernel code. These
        macros are used by kernel developers to insert debugging messages into
        the code.
      </p><p>
        The examples in this section assume that the
        <code class="systemitem">pr_debug</code> macro works correctly because dynamic
        debug is allowed for the running kernel.
      </p></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.5.6.7.5.1"><span class="term">Enabling debug messages for a specific kernel source code file</span></dt><dd><p>
            To enable the debug messages for a specific kernel source code
            file, use the following example:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">echo "file <em class="replaceable">FILE_NAME.c</em> +p" &gt; /sys/kernel/debug/dynamic_debug/control</code></pre></div></dd><dt id="id-1.8.5.6.7.5.2"><span class="term">Enabling debug messages for a specific kernel module</span></dt><dd><p>
            To enable debug messages for a specific kernel module, use the
            following example:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">echo "module <em class="replaceable">MODULE_NAME</em> +p" &gt; /sys/kernel/debug/dynamic_debug/control</code></pre></div></dd><dt id="id-1.8.5.6.7.5.3"><span class="term">Disabling debug messages</span></dt><dd><p>
            To disable previously enabled debugging messages for a specific
            kernel source code file or a kernel module, run the
            <code class="command">echo</code> command with the <code class="command">-p</code>
            option. For example:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">echo "file <em class="replaceable">FILE_NAME.c</em> -p" &gt; /sys/kernel/debug/dynamic_debug/control</code></pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">echo "module <em class="replaceable">MODULE_NAME</em> -p" &gt; /sys/kernel/debug/dynamic_debug/control</code></pre></div></dd></dl></div><p>
      For detailed information about dynamic debug and its use cases, refer to
      its
      <a class="link" href="https://www.kernel.org/doc/html/latest/admin-guide/dynamic-debug-howto.html" target="_blank">official
      documentation</a>.
    </p></section><section class="sect1" id="sec-tuning-dynamic-debug-view" data-id-title="Viewing the dynamic debug messages"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.4 </span><span class="title-name">Viewing the dynamic debug messages</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-dynamic-debug-view">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_dynamic_debug.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      You can view the dynamic debug messages that were generated based on the
      configurations you enabled, by running <code class="command">dmesg</code> and
      filtering the output with <code class="command">grep</code>. For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">dmesg | grep -i "<em class="replaceable">FILE_NAME.c</em>"</code></pre></div><p>
      Optionally, to continuously monitor the system messages as they are
      generated, you can use the <code class="command">tail</code> command with the
      <code class="command">-f</code> option:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">tail -f /var/log/messages</code></pre></div></section></section></div><div class="part" id="part-tuning-resources" data-id-title="Resource management"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part IV </span><span class="title-name">Resource management </span></span><a title="Permalink" class="permalink" href="#part-tuning-resources">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_tuning.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-tuning-resources"><span class="title-number">9 </span><span class="title-name">General system resource management</span></a></span></li><dd class="toc-abstract"><p>
    Tuning the system is not only about optimizing the kernel or getting the
    most out of your application, it begins with setting up a lean and fast
    system. The way you set up your partitions and file systems can
    influence the server's speed. The number of active services and the way
    routine tasks are scheduled also affects performance.
   </p></dd><li><span class="chapter"><a href="#cha-tuning-cgroups"><span class="title-number">10 </span><span class="title-name">Kernel control groups</span></a></span></li><dd class="toc-abstract"><p>
        Kernel Control Groups (<span class="quote">“<span class="quote">cgroups</span>”</span>) are a kernel feature for
        assigning and limiting hardware and system resources for processes.
        Processes can also be organized in a hierarchical tree structure.
      </p></dd><li><span class="chapter"><a href="#cha-tuning-numactl"><span class="title-number">11 </span><span class="title-name">Automatic Non-Uniform Memory Access (NUMA) balancing</span></a></span></li><dd class="toc-abstract"><p>
    There are physical limitations to hardware that are encountered when
    many CPUs and lots of memory are required. In this
    chapter, the important limitation is that there is limited communication
    bandwidth between the CPUs and the memory. One architecture modification
    that was introduced to address this is Non-Uniform Memory Access (NUMA).
   </p><p>
    In this configuration, there are multiple nodes. Each of the nodes
    contains a subset of all CPUs and memory. The access speed to main
    memory is determined by the location of the memory relative to the CPU.
    The performance of a workload depends on the application threads
    accessing data that is local to the CPU the thread is executing on.
    Automatic NUMA Balancing migrates data on demand to memory nodes that are
    local to the CPU accessing that data.
    Depending on the workload, this can dramatically boost performance when
    using NUMA hardware.
   </p></dd><li><span class="chapter"><a href="#cha-tuning-power"><span class="title-number">12 </span><span class="title-name">Power management</span></a></span></li><dd class="toc-abstract"><p>
    Power management aims at reducing operating costs for energy and cooling
    systems while at the same time keeping the performance of a system at a
    level that matches the current requirements. Thus, power management is
    always a matter of balancing the actual performance needs and power
    saving options for a system. Power management can be implemented and
    used at different levels of the system. A set of specifications for
    power management functions of devices and the operating system interface
    to them has been defined in the Advanced Configuration and Power
    Interface (ACPI). As power savings in server environments can primarily
    be achieved at the processor level, this chapter introduces the
    main concepts and highlights a few tools for analyzing and influencing
    relevant parameters.
   </p></dd></ul></div><section class="chapter" id="cha-tuning-resources" data-id-title="General system resource management"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">9 </span><span class="title-name">General system resource management</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Tuning the system is not only about optimizing the kernel or getting the
    most out of your application, it begins with setting up a lean and fast
    system. The way you set up your partitions and file systems can
    influence the server's speed. The number of active services and the way
    routine tasks are scheduled also affects performance.
   </p></div></div></div></div><section class="sect1" id="cha-tuning-resources-installation" data-id-title="Planning the installation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.1 </span><span class="title-name">Planning the installation</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources-installation">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A carefully planned installation ensures that the system is set up
   exactly as you need it for the given purpose. It also saves considerable
   time when fine tuning the system. All changes suggested in this section
   can be made in the <span class="guimenu">Installation Settings</span> step during
   the installation. See <span class="intraxref">Book “Deployment Guide”, Chapter 5 “Installation steps”, Section 5.14 “Installation settings”</span> for details.
  </p><section class="sect2" id="cha-tuning-resources-installation-partitioning" data-id-title="Partitioning"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.1.1 </span><span class="title-name">Partitioning</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources-installation-partitioning">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Depending on the server's range of applications and the hardware layout,
    the partitioning scheme can influence the machine's performance
    (although to a lesser extent only). It is beyond the scope of this
    manual to suggest different partitioning schemes for particular
    workloads. However, the following rules positively affect
    performance. They do not apply when using an external storage system.
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Make sure there is always a certain amount of free space available on the disk, since
      a full disk delivers inferior performance.
     </p></li><li class="listitem"><p>
      Disperse simultaneous read and write access onto different disks by,
      for example:
     </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        using separate disks for the operating system, data, and log files
       </p></li><li class="listitem"><p>
        placing a mail server's spool directory on a separate disk
       </p></li><li class="listitem"><p>
        distributing the user directories of a home server between different
        disks
       </p></li></ul></div></li></ul></div></section><section class="sect2" id="cha-tuning-resources-installation-scope" data-id-title="Installation scope"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.1.2 </span><span class="title-name">Installation scope</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources-installation-scope">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The installation scope has no direct influence on the machine's
    performance, but a carefully chosen scope of packages has advantages. It
    is recommended to install the minimum of packages needed to run the
    server. A system with a minimum set of packages is easier to maintain
    and has fewer potential security issues. Furthermore, a tailor made
    installation scope also ensures that no unnecessary services are started
    by default.
   </p><p>
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> lets you customize the installation scope on the
    Installation Summary screen. By default, you can select or remove
    preconfigured patterns for specific tasks, but it is also possible to
    start the YaST Software Manager for a fine-grained package-based
    selection.
   </p><p>
    One or more of the following default patterns may not be needed in all
    cases:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.6.2.3.4.5.1"><span class="term"><span class="guimenu">GNOME desktop environment</span>
     </span></dt><dd><p>
       Servers rarely need a full desktop environment. In case a graphical
       environment is needed, a more economical solution such as IceWM can
       be sufficient.
      </p></dd><dt id="id-1.8.6.2.3.4.5.2"><span class="term"><span class="guimenu">X Window System</span>
     </span></dt><dd><p>
       When solely administrating the server and its applications via
       command line, consider not installing this pattern. However, keep in
       mind that it is needed to run GUI applications from a remote machine.
       If your application is managed by a GUI or if you prefer the GUI
       version of YaST, keep this pattern.
      </p></dd><dt id="id-1.8.6.2.3.4.5.3"><span class="term"><span class="guimenu">Print server</span>
     </span></dt><dd><p>
       This pattern is only needed to print from the machine.
      </p></dd></dl></div></section><section class="sect2" id="cha-tuning-resources-installation-target" data-id-title="Default target"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.1.3 </span><span class="title-name">Default target</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources-installation-target">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A running X Window System consumes many resources and is rarely needed on
    a server. It is strongly recommended to start the system in target
    <code class="systemitem">multi-user.target</code>. You can still remotely start graphical applications.


   </p></section></section><section class="sect1" id="cha-tuning-resources-services" data-id-title="Disabling unnecessary services"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.2 </span><span class="title-name">Disabling unnecessary services</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources-services">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The default installation starts several services (the number varies
   with the installation scope). Since each service consumes resources, it
   is recommended to disable the ones not needed. Run <span class="guimenu">YaST</span> › <span class="guimenu">System</span> › <span class="guimenu">Services Manager</span> to start the services
   management module.
  </p><p>
   If you are using the graphical version of YaST, you can click the
   column headlines to sort the list of services. Use this to get an
   overview of which services are currently running.

   Use the <span class="guimenu">Start/Stop</span> button to disable the service for
   the running session. To permanently disable it, use the
   <span class="guimenu">Enable/Disable</span> button.
  </p><p>
   The following list shows services that are started by default after the
   installation of <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. Check which of the components you need,
   and disable the others:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.6.2.4.5.1"><span class="term"><span class="guimenu">alsasound</span>
    </span></dt><dd><p>
      Loads the Advanced Linux Sound System.
     </p></dd><dt id="id-1.8.6.2.4.5.2"><span class="term"><span class="guimenu">auditd</span>
    </span></dt><dd><p>
      A daemon for the Audit system (see <span class="intraxref">Book “Security and Hardening Guide”</span> for
      details). Disable this if you do not use Audit.
     </p></dd><dt id="id-1.8.6.2.4.5.3"><span class="term"><span class="guimenu">bluez-coldplug</span>
    </span></dt><dd><p>
      Handles cold plugging of Bluetooth dongles.
     </p></dd><dt id="id-1.8.6.2.4.5.4"><span class="term"><span class="guimenu">cups</span>
    </span></dt><dd><p>
      A printer daemon.
     </p></dd><dt id="id-1.8.6.2.4.5.5"><span class="term"><span class="guimenu">java.binfmt_misc</span>
    </span></dt><dd><p>
      Enables the execution of <code class="filename">*.class</code> or
      <code class="filename">*.jar</code> Java programs.
     </p></dd><dt id="id-1.8.6.2.4.5.6"><span class="term"><span class="guimenu">nfs</span>
    </span></dt><dd><p>
      Services needed to mount NFS.
     </p></dd><dt id="id-1.8.6.2.4.5.7"><span class="term"><span class="guimenu">smbfs</span>
    </span></dt><dd><p>
      Services needed to mount SMB/CIFS file systems from a Windows* server.
     </p></dd><dt id="id-1.8.6.2.4.5.8"><span class="term"><span class="guimenu">splash / splash_early</span>
    </span></dt><dd><p>
      Shows the splash screen on start-up.
     </p></dd></dl></div></section><section class="sect1" id="cha-tuning-resources-disk" data-id-title="File systems and disk access"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.3 </span><span class="title-name">File systems and disk access</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources-disk">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Hard disks are the slowest components in a computer system and therefore
   often the cause for a bottleneck. Using the file system that best suits
   your workload helps to improve performance. Using special mount options
   or prioritizing a process's I/O priority are further means to speed up
   the system.
  </p><section class="sect2" id="cha-tuning-resources-disk-filesystems" data-id-title="File systems"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.3.1 </span><span class="title-name">File systems</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources-disk-filesystems">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> ships with several file systems,
    including Btrfs, Ext4, Ext3, Ext2, and XFS. Each file system has
    its own advantages and disadvantages.
   </p><section class="sect3" id="cha-tuning-resources-disk-filesystems-nfs" data-id-title="NFS"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.3.1.1 </span><span class="title-name">NFS</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources-disk-filesystems-nfs">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     NFS (Version 3) tuning is covered in detail in the NFS Howto at
     <a class="link" href="https://nfs.sourceforge.net/nfs-howto/" target="_blank">https://nfs.sourceforge.net/nfs-howto/</a>. When mounting NFS shares, start
     with the experiment of increasing the size of the read-write blocks to <code class="literal">32768</code>, by using the
     mount
     options <code class="option">wsize</code> and <code class="option">rsize</code>.
    </p></section></section><section class="sect2" id="cha-tuning-resources-disk-mount" data-id-title="Time stamp update policy"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.3.2 </span><span class="title-name">Time stamp update policy</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources-disk-mount">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Each file and directory in a file system has three time stamps associated
    with it: a time when the file was last read called <span class="emphasis"><em>access
    time</em></span>, a time when the file data was last modified called
    <span class="emphasis"><em>modification time</em></span>, and a time when the file metadata
    was last modified called <span class="emphasis"><em>change time</em></span>. Keeping access
    time always up to date has significant performance overhead since every
    read-only access incurs a write operation. By default, every file
    system updates access time only if current file access time is older than a
    day, or older than file modification or change time. This feature
    is called <span class="emphasis"><em>relative access time</em></span> and the corresponding
    mount option is <code class="option">relatime</code>. Updates of access time can be disabled using the <code class="option">noatime</code> mount option.
    However, you need to verify your applications do not use it. This can be
    true for file and Web servers or for network storage. If the default
    relative access time update policy is not suitable for your applications,
    use the <code class="option">strictatime</code> mount option.
   </p><p>
    Some file systems (for example Ext4) also support lazy time stamp updates.
    When this feature is enabled using the <code class="option">lazytime</code> mount
    option, updates of all time stamps happen in memory but they are not
    written to disk. That happens only in response to
    <code class="systemitem">fsync</code> or <code class="systemitem">sync</code> system
    calls, when the file information is written due to another reason such as
    file size update, when time stamps are older than 24 hours, or when cached
    file information needs to be evicted from memory.
   </p><p>
    To update mount options used for a file system, either edit
    <code class="filename">/etc/fstab</code> directly, or use the <span class="guimenu">Fstab
    Options</span> dialog when editing or adding a partition with the
    YaST Partitioner.
   </p></section><section class="sect2" id="cha-tuning-resources-disk-ionice" data-id-title="Prioritizing disk access with ionice"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.3.3 </span><span class="title-name">Prioritizing disk access with <code class="command">ionice</code></span></span> <a title="Permalink" class="permalink" href="#cha-tuning-resources-disk-ionice">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemresources.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="command">ionice</code> command lets you prioritize disk access
    for single processes. This enables you to give less I/O priority to
    background processes with heavy disk access that are not time-critical,
    such as backup jobs. <code class="command">ionice</code> also lets you raise the
    I/O priority for a specific process to make sure this process always has
    immediate access to the disk. The caveat of this feature is that standard
    writes are cached in the page cache and are written back to persistent
    storage only later by an independent kernel process. Thus the I/O priority
    setting generally does not apply for these writes. Also be aware that
    I/O class and priority setting are obeyed only by
    <span class="emphasis"><em>BFQ</em></span> I/O scheduler for blk-mq I/O path (refer
    to <a class="xref" href="#cha-tuning-io-schedulers-blkmq" title="13.2. Available I/O elevators with blk-mq I/O path">Section 13.2, “Available I/O elevators with blk-mq I/O path”</a>). You can set
    the following three scheduling classes:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.6.2.5.5.3.1"><span class="term">Idle</span></dt><dd><p>
       A process from the idle scheduling class is only granted disk access
       when no other process has asked for disk I/O.
      </p></dd><dt id="id-1.8.6.2.5.5.3.2"><span class="term">Best effort</span></dt><dd><p>
       The default scheduling class used for any process that has not asked
       for a specific I/O priority. Priority within this class can be
       adjusted to a level from <code class="literal">0</code> to <code class="literal">7</code>
       (with <code class="literal">0</code> being the highest priority). Programs
       running at the same best-effort priority are served in a round-robin
       fashion. Some kernel versions treat priority within the best-effort
       class differently—for details, refer to the
       <code class="systemitem">ionice(1)</code> man page.
      </p></dd><dt id="id-1.8.6.2.5.5.3.3"><span class="term">Real-time</span></dt><dd><p>
       Processes in this class are always granted disk access first.
       Fine-tune the priority level from <code class="literal">0</code> to
       <code class="literal">7</code> (with <code class="literal">0</code> being the highest
       priority). Use with care, since it can starve other processes.
      </p></dd></dl></div><p>
    For more details and the exact command syntax refer to the
    <code class="systemitem">ionice(1)</code> man page. If you need more reliable
    control over bandwidth available to each application, use
    Kernel Control Groups as described in
    <a class="xref" href="#cha-tuning-cgroups" title="Chapter 10. Kernel control groups">Chapter 10, <em>Kernel control groups</em></a>.
   </p></section></section></section><section class="chapter" id="cha-tuning-cgroups" data-id-title="Kernel control groups"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">10 </span><span class="title-name">Kernel control groups</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-cgroups">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
        Kernel Control Groups (<span class="quote">“<span class="quote">cgroups</span>”</span>) are a kernel feature for
        assigning and limiting hardware and system resources for processes.
        Processes can also be organized in a hierarchical tree structure.
      </p></div></div></div></div><section class="sect1" id="sec-tuning-cgroups-overview" data-id-title="Overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.1 </span><span class="title-name">Overview</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-cgroups-overview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Every process is assigned exactly one administrative cgroup. cgroups are
      ordered in a hierarchical tree structure. You can set resource
      limitations, such as CPU, memory, disk I/O or network bandwidth usage,
      for single processes or for whole branches of the hierarchy tree.
    </p><p>
      On <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, <code class="systemitem">systemd</code> uses cgroups to organize all processes in
      groups, which <code class="systemitem">systemd</code> calls slices. <code class="systemitem">systemd</code> also provides an
      interface for setting cgroup properties.
    </p><p>
      The command <code class="command">systemd-cgls</code> displays the hierarchy tree.
    </p><p>
      The kernel cgroup API comes in two variants—v1 and v2.
      Additionally, there can be multiple cgroup hierarchies exposing different
      APIs. From many possible combinations, there are two practical choices:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          unified: v2 hierarchy with controllers
        </p></li><li class="listitem"><p>
          hybrid: v2 hierarchy without controllers, and the controllers are on
          v1 hierarchies (deprecated)
        </p></li></ul></div><p>
      The default mode is unified. There is a hybrid mode that provides
      backward compatibility for applications that need it.
    </p><p>
      You may set only one mode.
    </p><section class="sect2" id="sec-cgroups-hybrid-hierarchy" data-id-title="Hybrid cgroup hierarchy"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.1.1 </span><span class="title-name">Hybrid cgroup hierarchy</span></span> <a title="Permalink" class="permalink" href="#sec-cgroups-hybrid-hierarchy">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.8.6.3.3.9.2" data-id-title="Deprecation notice" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Deprecation notice</div><p>
          cgroup v1 has been deprecated, and might be removed in a future
          release.
        </p></div><p>
        To enable the hybrid control group hierarchy, append
        <code class="option">systemd.unified_cgroup_hierarchy=0</code> as a kernel
        command-line parameter to the GRUB 2 boot loader. For more details
        about configuring GRUB 2, refer to <span class="intraxref">Book “Administration Guide”, Chapter 18 “The boot loader GRUB 2”</span>.
      </p></section></section><section class="sect1" id="sec-tuning-cgroups-accounting" data-id-title="Resource accounting"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.2 </span><span class="title-name">Resource accounting</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-cgroups-accounting">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Organizing processes into different cgroups can be used to obtain
      per-cgroup resource consumption data.
    </p><p>
      The accounting has comparatively small but non-zero overhead, whose
      impact depends on the workload. Activating accounting for one unit also
      implicitly activates it for all units in the same slice, and for all its
      parent slices, and the units contained in them.
    </p><p>
      The accounting can be set on a per-unit basis with directives such as
      <code class="literal">MemoryAccounting=</code> or globally for all units in
      <code class="filename">/etc/systemd/system.conf</code> with the directive
      <code class="literal">DefaultMemoryAccounting=</code>. Refer to <code class="command">man
      systemd.resource-control</code> for the exhaustive list of possible
      directives.
    </p></section><section class="sect1" id="sec-tuning-cgroups-usage" data-id-title="Setting resource limits"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.3 </span><span class="title-name">Setting resource limits</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-cgroups-usage">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.8.6.3.5.2" data-id-title="Implicit resource consumption" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Implicit resource consumption</div><p>
        Be aware that resource consumption implicitly depends on the
        environment where your workload executes (for example, size of data
        structures in libraries/kernel, forking behavior of utilities,
        computational efficiency). Hence it is recommended to (re)calibrate
        your limits should the environment change.
      </p></div><p>
      Limitations to cgroups can be set with the <code class="command">systemctl
      set-property</code> command. The syntax is:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">systemctl set-property [--runtime] <em class="replaceable">NAME</em> <em class="replaceable">PROPERTY1</em>=<em class="replaceable">VALUE</em> [<em class="replaceable">PROPERTY2</em>=<em class="replaceable">VALUE</em>]</code></pre></div><p>
      The configured value is applied immediately. Optionally, use the
      <code class="option">--runtime</code> option, so that the new values do not persist
      after reboot.
    </p><p>
      Replace <em class="replaceable">NAME</em> with a <code class="systemitem">systemd</code> service, scope,
      or slice name.
    </p><p>
      For a complete list of properties and more details, see <code class="command">man
      systemd.resource-control</code>.
    </p></section><section class="sect1" id="sec-tuning-cgroups-tasksmax" data-id-title="Preventing fork bombs with TasksMax"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.4 </span><span class="title-name">Preventing fork bombs with <code class="literal">TasksMax</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-cgroups-tasksmax">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      <code class="systemitem">systemd</code> supports configuring task count limits both for each individual
      leaf unit, or aggregated on slices. Upstream <code class="systemitem">systemd</code> ships with
      defaults that limit the number of tasks in each unit (15% of the kernel
      global limit, run <code class="command">/usr/sbin/sysctl kernel.pid_max</code> to
      see the total limit). Each user's slice is limited to 33% of the kernel
      limit. However, this is different for <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>.
    </p><section class="sect2" id="sec-tasksmax-defaults" data-id-title="Finding the current default TasksMax values"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.4.1 </span><span class="title-name">Finding the current default <code class="literal">TasksMax</code> values</span></span> <a title="Permalink" class="permalink" href="#sec-tasksmax-defaults">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        It became apparent, in practice, that there is not a single default
        that applies to all use cases. <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> ships with two custom
        configurations that override the upstream defaults for system units and
        for user slices, and sets them both to <code class="literal">infinity</code>.
        <code class="filename">/usr/lib/systemd/system.conf.d/__25-defaults-SLE.conf</code>
        contains these lines:
      </p><div class="verbatim-wrap"><pre class="screen">[Manager]
DefaultTasksMax=infinity</pre></div><p>
        <code class="filename">/usr/lib/systemd/system/user-.slice.d/25-defaults-SLE.conf
        </code> contains these lines:
      </p><div class="verbatim-wrap"><pre class="screen">[Slice]
TasksMax=infinity</pre></div><p>
        Use <code class="command">systemctl</code> to verify the DefaultTasksMax value:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">systemctl show --property DefaultTasksMax</code>
DefaultTasksMax=infinity</pre></div><p>
        <code class="literal">infinity</code> means having no limit. It is not a
        requirement to change the default, but setting certain limits may help
        to prevent system crashes from runaway processes.
      </p></section><section class="sect2" id="sec-edit-taskmax-default" data-id-title="Overriding the DefaultTasksMax value"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.4.2 </span><span class="title-name">Overriding the <code class="literal">DefaultTasksMax</code> value</span></span> <a title="Permalink" class="permalink" href="#sec-edit-taskmax-default">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        Change the global <code class="literal">DefaultTasksMax</code> value by creating
        a new override file,
        <code class="filename">/etc/systemd/system.conf.d/90-system-tasksmax.conf</code>,
        and write the following lines to set a new default limit of 256 tasks
        per system unit:
      </p><div class="verbatim-wrap"><pre class="screen">[Manager]
DefaultTasksMax=256</pre></div><p>
        Load the new setting, then verify that it changed:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl daemon-reload</code>
<code class="prompt user">&gt; </code><code class="command">systemctl show --property DefaultTasksMax</code>
DefaultTasksMax=256</pre></div><p>
        Adjust this default value to suit your needs. You can set different
        limits on individual services as needed. This example is for MariaDB.
        First check the current active value:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">systemctl status mariadb.service</code>
  ● mariadb.service - MariaDB database server
   Loaded: loaded (/usr/lib/systemd/system/mariadb.service; disabled; vendor preset&gt;
   Active: active (running) since Tue 2020-05-26 14:15:03 PDT; 27min ago
     Docs: man:mysqld(8)
           https://mariadb.com/kb/en/library/systemd/
 Main PID: 11845 (mysqld)
   Status: "Taking your SQL requests now..."
    Tasks: 30 (limit: 256)
   CGroup: /system.slice/mariadb.service
           └─11845 /usr/sbin/mysqld --defaults-file=/etc/my.cnf --user=mysql</pre></div><p>
        The Tasks line shows that MariaDB currently has 30 tasks running, and
        has an upper limit of the default 256, which is inadequate for a
        database. The following example demonstrates how to raise MariaDB's
        limit to 8192.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl set-property mariadb.service TasksMax=8192</code>
<code class="prompt user">&gt; </code><code class="command">systemctl status mariadb.service</code>
● mariadb.service - MariaDB database server
   Loaded: loaded (/usr/lib/systemd/system/mariadb.service; disabled; vendor preset: disab&gt;
  Drop-In: /etc/systemd/system/mariadb.service.d
           └─50-TasksMax.conf
   Active: active (running) since Tue 2020-06-02 17:57:48 PDT; 7min ago
     Docs: man:mysqld(8)
           https://mariadb.com/kb/en/library/systemd/
  Process: 3446 ExecStartPre=/usr/lib/mysql/mysql-systemd-helper upgrade (code=exited, sta&gt;
  Process: 3440 ExecStartPre=/usr/lib/mysql/mysql-systemd-helper install (code=exited, sta&gt;
 Main PID: 3452 (mysqld)
   Status: "Taking your SQL requests now..."
    Tasks: 30 (limit: 8192)
   CGroup: /system.slice/mariadb.service
           └─3452 /usr/sbin/mysqld --defaults-file=/etc/my.cnf --user=mysql</pre></div><p>
        <code class="command">systemctl set-property</code> applies the new limit and
        creates a drop-in file for persistence,
        <code class="filename">/etc/systemd/system/mariadb.service.d/50-TasksMax.conf</code>,
        that contains only the changes you want to apply to the existing unit
        file. The value does not have to be 8192, but should be whatever limit
        is appropriate for your workloads.
      </p></section><section class="sect2" id="id-1.8.6.3.6.5" data-id-title="Default TasksMax limit on users"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.4.3 </span><span class="title-name">Default <code class="literal">TasksMax</code> limit on users</span></span> <a title="Permalink" class="permalink" href="#id-1.8.6.3.6.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The default limit on users should be high, because user sessions need
        more resources. Set your own default for any user by creating a new
        file, for example
        <code class="filename">/etc/systemd/system/user-.slice.d/40-user-taskmask.conf</code>.
        The following example sets a default of 16284:
      </p><div class="verbatim-wrap"><pre class="screen">[Slice]
TasksMax=16284</pre></div><div id="id-1.8.6.3.6.5.4" data-id-title="Numeric prefixes reference" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Numeric prefixes reference</div><p>
          See <span class="intraxref">Book “Administration Guide”, Chapter 19 “The <code class="systemitem">systemd</code> daemon”, Section 19.5.3 “Creating drop-in files manually”</span> to learn what
          numeric prefixes are expected for drop-in files.
        </p></div><p>
        Then reload systemd to load the new value, and verify the change:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl daemon-reload</code>
<code class="prompt user">&gt; </code><code class="command">systemctl show --property TasksMax user-1000.slice</code>
TasksMax=16284</pre></div><p>
        How do you know what values to use? This varies according to your
        workloads, system resources, and other resource configurations. When
        your <code class="literal">TasksMax</code> value is too low, you may see error
        messages such as <span class="emphasis"><em>Failed to fork (Resources temporarily
        unavailable)</em></span>, <span class="emphasis"><em>Can't create thread to handle new
        connection</em></span>, and <span class="emphasis"><em>Error: Function call 'fork' failed
        with error code 11, 'Resource temporarily unavailable'</em></span>.
      </p><p>
        For more information on configuring system resources in systemd, see
        <code class="literal">systemd.resource-control (5)</code>.
      </p></section></section><section class="sect1" id="sec-control-io-cgroups" data-id-title="I/O control with cgroups"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.5 </span><span class="title-name">I/O control with cgroups</span></span> <a title="Permalink" class="permalink" href="#sec-control-io-cgroups">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      This section introduces using the Linux kernel's block I/O controller to
      prioritize or throttle I/O operations. This leverages the means provided
      by systemd to configure cgroups, and discusses probable pitfalls when
      dealing with proportional I/O control.
    </p><section class="sect2" id="sec-cgroups-prerequisites" data-id-title="Prerequisites"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.5.1 </span><span class="title-name">Prerequisites</span></span> <a title="Permalink" class="permalink" href="#sec-cgroups-prerequisites">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The following subsections describe steps that you must take in advance
        when you design and configure your system, since those aspects cannot
        be changed during runtime.
      </p><section class="sect3" id="sec-cgroups-filesystems" data-id-title="File system"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">10.5.1.1 </span><span class="title-name">File system</span></span> <a title="Permalink" class="permalink" href="#sec-cgroups-filesystems">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          You should use a cgroup-writeback-aware file system (otherwise
          writeback charging is not possible). The recommended <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>
          file systems added support in the following upstream releases:
          
        </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
              Btrfs (v4.3)
            </p></li><li class="listitem"><p>
              Ext4 (v4.3)
            </p></li><li class="listitem"><p>
              XFS (v5.3)
            </p></li></ul></div><p>
          As of
          <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> 15<span class="phrase"> SP3</span>,
          any of the named file systems can be used.
        </p></section><section class="sect3" id="sec-cgroups-block-io-scheduler" data-id-title="Block I/O scheduler"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">10.5.1.2 </span><span class="title-name">Block I/O scheduler</span></span> <a title="Permalink" class="permalink" href="#sec-cgroups-block-io-scheduler">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          The throttling policy is implemented higher in the stack, therefore
          it does not require any additional adjustments. The proportional I/O
          control policies have two different implementations: the BFQ
          controller, and the cost-based model. We describe the BFQ controller
          here. To exert its proportional implementation for a particular
          device, we must make sure that BFQ is the chosen scheduler. Check the
          current scheduler:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">cat /sys/class/block/<em class="replaceable">sda</em>/queue/scheduler</code>
mq-deadline kyber bfq [none]</pre></div><p>
          Switch the scheduler to BFQ:
        </p><div class="verbatim-wrap"><pre class="screen"> <code class="prompt root"># </code><code class="command">echo bfq &gt; /sys/class/block/<em class="replaceable">sda</em>/queue/scheduler</code></pre></div><p>
          You must specify the disk device (not a partition). The optimal way
          to set this attribute is a udev rule specific to the device.
          <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> ships udev rules that already enable BFQ for rotational
          disk drives.
        </p></section><section class="sect3" id="sec-cgroups-hierarchy" data-id-title="Cgroup hierarchy layout"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">10.5.1.3 </span><span class="title-name">Cgroup hierarchy layout</span></span> <a title="Permalink" class="permalink" href="#sec-cgroups-hierarchy">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          Normally, all tasks reside in the root cgroup and they compete
          against each other. When the tasks are distributed into the cgroup
          tree the competition occurs between sibling cgroups only. This
          applies to the proportional I/O control; the throttling
          hierarchically aggregates throughput of all descendants (see the
          following diagram).
        </p><div class="verbatim-wrap"><pre class="screen">r
`-  a      IOWeight=100
    `- [c] IOWeight=300
    `-  d  IOWeight=100
`- [b]     IOWeight=200</pre></div><p>
          I/O is originating only from cgroups c and b. Even though c has a
          higher weight, it is treated with lower priority because it is
          level-competing with b.
        </p></section></section><section class="sect2" id="sec-cgroups-configure-control-quantities" data-id-title="Configuring control quantities"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.5.2 </span><span class="title-name">Configuring control quantities</span></span> <a title="Permalink" class="permalink" href="#sec-cgroups-configure-control-quantities">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        You can apply the values to (long running) services permanently.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl set-property <em class="replaceable">fast.service</em> IOWeight=<em class="replaceable">400</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl set-property <em class="replaceable">slow.service</em> IOWeight=<em class="replaceable">50</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl set-property <em class="replaceable">throttled.service</em> IOReadBandwidthMax="<em class="replaceable">/dev/sda 1M</em>"</code></pre></div><p>
        Alternatively, you can apply I/O control to individual commands, for
        example:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemd-run --scope -p IOWeight=<em class="replaceable">400</em> <em class="replaceable">high_prioritized_command</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemd-run --scope -p IOWeight=<em class="replaceable">50</em> <em class="replaceable">low_prioritized_command</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemd-run --scope -p IOReadBandwidthMax="<em class="replaceable">/dev/sda 1M</em>" <em class="replaceable">dd if=/dev/sda of=/dev/null bs=1M count=10</em></code></pre></div></section><section class="sect2" id="sec-cgroups-control-behavior" data-id-title="I/O control behavior and setting expectations"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.5.3 </span><span class="title-name">I/O control behavior and setting expectations</span></span> <a title="Permalink" class="permalink" href="#sec-cgroups-control-behavior">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The following list items describe I/O control behavior, and what you
        should expect under different conditions.
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            I/O control works best for direct I/O operations (bypassing page
            cache), the situations where the actual I/O is decoupled from the
            caller (typically writeback via page cache) may manifest variously.
            For example, delayed I/O control or even no observed I/O control
            (consider little bursts or competing workloads that happen to never
            <span class="quote">“<span class="quote">meet,</span>”</span> submitting I/O at the same time, and
            saturating the bandwidth). For these reasons, the resulting ratio
            of I/O throughputs does not strictly follow the ratio of configured
            weights.
          </p></li><li class="listitem"><p>
            systemd performs scaling of configured weights (to adjust for
            narrower BFQ weight range), hence the resulting throughput ratios
            also differ.
          </p></li><li class="listitem"><p>
            The writeback activity depends on the amount of dirty pages,
            besides the global sysctl knobs
            (<code class="filename">vm.dirty_background_ratio</code> and
            <code class="filename">vm.dirty_ratio</code>)). Memory limits of individual
            cgroups come into play when the dirty limits are distributed among
            cgroups, and this in turn may affect I/O intensity of affected
            cgroups.
          </p></li><li class="listitem"><p>
            Not all storages are equal. The I/O control happens at the I/O
            scheduler layer, which has ramifications for setups with devices
            stacked on these that do no actual scheduling. Consider device
            mapper logical volumes spanning multiple physical devices, MD RAID,
            or even Btrfs RAID. I/O control over such setups may be
            challenging.
          </p></li><li class="listitem"><p>
            There is no separate setting for proportional I/O control of reads
            and writes.
          </p></li><li class="listitem"><p>
            Proportional I/O control is only one of the policies that can
            interact with each other (but responsible resource design perhaps
            avoids that).
          </p></li><li class="listitem"><p>
            The I/O device bandwidth is not the only shared resource on the I/O
            path. Global file system structures are involved, which is relevant
            when I/O control is meant to guarantee certain bandwidth; it does
            not, and it may even lead to priority inversion (prioritized cgroup
            waiting for a transaction of slower cgroup).
          </p></li><li class="listitem"><p>
            So far, we have been discussing only explicit I/O of file system
            data, but swap-in and swap-out can also be controlled. Although if
            such a need arises, it points out to improperly provisioned memory
            (or memory limits).
          </p></li></ul></div></section><section class="sect2" id="sec-cgroups-user-sessions" data-id-title="Resource control in user sessions"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.5.4 </span><span class="title-name">Resource control in user sessions</span></span> <a title="Permalink" class="permalink" href="#sec-cgroups-user-sessions">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        In order to apply cgroup resource control within user sessions,
        controllers must be delegated user instances of <code class="systemitem">systemd</code>.
        <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> ships <code class="systemitem">systemd</code> default configuration that delegates
        <span class="emphasis"><em>no</em></span> controllers.
      </p><p>
        You can use drop-in files to change the set of delegated controllers.
        For instance,
        <code class="filename">/etc/systemd/system/user@.service.d/60-delegate.conf</code>
        adds controllers to all users, while
        <code class="filename">/etc/systemd/system/user@<em class="replaceable">uid</em>.service.d/60-delegate.conf</code>
        adds controllers only to a particular user. The content of the file
        should be like the following:
      </p><div class="verbatim-wrap"><pre class="screen">[Service]
Delegate=pids memory</pre></div><p>
        Both the <code class="systemitem">systemd</code> instance and the affected user instance must be notified
        to reload the new configuration.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl daemon-reload</code>
<code class="prompt user">&gt; </code><code class="command">systemctl --user daemon-reexec</code></pre></div><p>
        Alternatively, the affected user may log out and log in instead of applying
        the second line to restart their user instance.
      </p></section></section><section class="sect1" id="id-1.8.6.3.8" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.6 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#id-1.8.6.3.8">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_cgroups.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          Kernel documentation (package
          <code class="systemitem">kernel-source</code>): files in
          <code class="filename">/usr/src/linux/Documentation/admin-guide/cgroup-v1</code>
          and file
          <code class="filename">/usr/src/linux/Documentation/admin-guide/cgroup-v2.rst</code>.
        </p></li><li class="listitem"><p>
          <code class="command">man systemd.resource-control</code>
        </p></li><li class="listitem"><p>
          <a class="link" href="https://lwn.net/Articles/604609/" target="_blank">https://lwn.net/Articles/604609/</a>—Brown,
          Neil: Control Groups Series (2014, 7 parts).
        </p></li><li class="listitem"><p>
          <a class="link" href="https://lwn.net/Articles/243795/" target="_blank">https://lwn.net/Articles/243795/</a>—Corbet,
          Jonathan: Controlling memory use in containers (2007).
        </p></li><li class="listitem"><p>
          <a class="link" href="https://lwn.net/Articles/236038/" target="_blank">https://lwn.net/Articles/236038/</a>—Corbet,
          Jonathan: Process containers (2007).
        </p></li></ul></div></section></section><section class="chapter" id="cha-tuning-numactl" data-id-title="Automatic Non-Uniform Memory Access (NUMA) balancing"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">11 </span><span class="title-name">Automatic Non-Uniform Memory Access (NUMA) balancing</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-numactl">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_numactl.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    There are physical limitations to hardware that are encountered when
    many CPUs and lots of memory are required. In this
    chapter, the important limitation is that there is limited communication
    bandwidth between the CPUs and the memory. One architecture modification
    that was introduced to address this is Non-Uniform Memory Access (NUMA).
   </p><p>
    In this configuration, there are multiple nodes. Each of the nodes
    contains a subset of all CPUs and memory. The access speed to main
    memory is determined by the location of the memory relative to the CPU.
    The performance of a workload depends on the application threads
    accessing data that is local to the CPU the thread is executing on.
    Automatic NUMA Balancing migrates data on demand to memory nodes that are
    local to the CPU accessing that data.
    Depending on the workload, this can dramatically boost performance when
    using NUMA hardware.
   </p></div></div></div></div><section class="sect1" id="sec-tuning-numactl-implementation" data-id-title="Implementation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.1 </span><span class="title-name">Implementation</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-numactl-implementation">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_numactl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Automatic NUMA balancing happens in three basic steps:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     A task scanner periodically scans a portion of a task's address space
     and marks the memory to force a page fault when the data is next
     accessed.
    </p></li><li class="listitem"><p>
     The next access to the data results in a NUMA Hinting Fault. Based
     on this fault, the data can be migrated to a memory node associated
     with the task accessing the memory.
    </p></li><li class="listitem"><p>
     To keep a task, the CPU it is using and the memory it is accessing
     together, the scheduler groups tasks that share data.
    </p></li></ol></div><p>
   The unmapping of data and page fault handling incurs overhead. However,
   commonly the overhead is offset by threads accessing data associated
   with the CPU.
  </p></section><section class="sect1" id="sec-tuning-numactl-configuration" data-id-title="Configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.2 </span><span class="title-name">Configuration</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-numactl-configuration">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_numactl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Static configuration has been the recommended way of tuning workloads on
   NUMA hardware. To do this, memory policies can be set with
   <code class="command">numactl</code>, <code class="command">taskset</code> or
   <code class="command">cpusets</code>. NUMA-aware applications can use special APIs.
   In cases where the static policies have already been created, automatic
   NUMA balancing should be disabled as the data access should already be
   local.
  </p><p>
   <code class="command">numactl</code> <code class="option">--hardware</code> shows the
   memory configuration of the machine and whether it supports NUMA or not.
   This is example output from a 4-node machine.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>numactl --hardware
available: 4 nodes (0-3)
node 0 cpus: 0 4 8 12 16 20 24 28 32 36 40 44
node 0 size: 16068 MB
node 0 free: 15909 MB
node 1 cpus: 1 5 9 13 17 21 25 29 33 37 41 45
node 1 size: 16157 MB
node 1 free: 15948 MB
node 2 cpus: 2 6 10 14 18 22 26 30 34 38 42 46
node 2 size: 16157 MB
node 2 free: 15981 MB
node 3 cpus: 3 7 11 15 19 23 27 31 35 39 43 47
node 3 size: 16157 MB
node 3 free: 16028 MB
node distances:
node   0   1   2   3
  0:  10  20  20  20
  1:  20  10  20  20
  2:  20  20  10  20
  3:  20  20  20  10</pre></div><p>
   Automatic NUMA balancing can be enabled or disabled for the current
   session by writing <code class="literal">1</code> or <code class="literal">0</code>
   to <code class="filename">/proc/sys/kernel/numa_balancing</code> which enables or disables the feature respectively. To permanently enable or
   disable it, use the kernel command line option
   <code class="literal">numa_balancing=[enable|disable]</code>.
  </p><p>
   If Automatic NUMA Balancing is enabled, the task scanner behavior can be
   configured.
   
   The task scanner balances the overhead of Automatic NUMA Balancing with
   the amount of time it takes to identify the best placement of data.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.6.4.4.7.1"><span class="term"><code class="literal">numa_balancing_scan_delay_ms</code>
    </span></dt><dd><p>
      The amount of CPU time a thread must consume before its data is
      scanned. This prevents creating overhead because of short-lived
      processes.
     </p></dd><dt id="id-1.8.6.4.4.7.2"><span class="term"><code class="literal">numa_balancing_scan_period_min_ms</code> and
     <code class="literal">numa_balancing_scan_period_max_ms</code>
    </span></dt><dd><p>
      Controls how frequently a task's data is scanned. Depending on the
      locality of the faults, the scan rate increases or decreases. These
      settings control the min and max scan rates.
     </p></dd><dt id="id-1.8.6.4.4.7.3"><span class="term"><code class="literal">numa_balancing_scan_size_mb</code>
    </span></dt><dd><p>
      Controls how much address space is scanned when the task scanner is
      active.
     </p></dd></dl></div></section><section class="sect1" id="sec-tuning-numactl-monitoring" data-id-title="Monitoring"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.3 </span><span class="title-name">Monitoring</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-numactl-monitoring">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_numactl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The most important task is to assign metrics to your workload and measure
   the performance with Automatic NUMA Balancing enabled and disabled to
   measure the impact. Profiling tools can be used to monitor local and
   remote memory accesses if the CPU supports such monitoring. Automatic
   NUMA Balancing activity can be monitored via the following parameters in
   <code class="filename">/proc/vmstat</code>:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.6.4.5.3.1"><span class="term"><code class="literal">numa_pte_updates</code>
    </span></dt><dd><p>
      The amount of base pages that were marked for NUMA hinting faults.
     </p></dd><dt id="id-1.8.6.4.5.3.2"><span class="term"><code class="literal">numa_huge_pte_updates</code>
    </span></dt><dd><p>
      The amount of transparent huge pages that were marked for NUMA hinting
      faults. In combination with <code class="literal">numa_pte_updates</code> the
      total address space that was marked can be calculated.
     </p></dd><dt id="id-1.8.6.4.5.3.3"><span class="term"><code class="literal">numa_hint_faults</code>
    </span></dt><dd><p>
      Records how many NUMA hinting faults were trapped.
     </p></dd><dt id="id-1.8.6.4.5.3.4"><span class="term"><code class="literal">numa_hint_faults_local</code>
    </span></dt><dd><p>
      Shows how many of the hinting faults were to local nodes. In
      combination with <code class="literal">numa_hint_faults</code>, the percentage
      of local versus remote faults can be calculated. A high percentage of
      local hinting faults indicates that the workload is closer to being
      converged.
     </p></dd><dt id="id-1.8.6.4.5.3.5"><span class="term"><code class="literal">numa_pages_migrated</code>
    </span></dt><dd><p>
      Records how many pages were migrated because they were misplaced. As
      migration is a copying operation, it contributes the largest part of
      the overhead created by NUMA balancing.
     </p></dd></dl></div></section><section class="sect1" id="sec-tuning-numactl-impact" data-id-title="Impact"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.4 </span><span class="title-name">Impact</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-numactl-impact">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_numactl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following illustrates a simple test case of a 4-node NUMA machine
   running the SpecJBB 2005
   
   using a single instance of the JVM with no static tuning around memory
   policies. However, the impact for each workload varies and this example is based on a pre-release version of <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>
   12.
  </p><div class="verbatim-wrap"><pre class="screen">            Balancing disabled      Balancing enabled
TPut 1      26629.00 (  0.00%)     26507.00 ( -0.46%)
TPut 2      55841.00 (  0.00%)     53592.00 ( -4.03%)
TPut 3      86078.00 (  0.00%)     86443.00 (  0.42%)
TPut 4     116764.00 (  0.00%)    113272.00 ( -2.99%)
TPut 5     143916.00 (  0.00%)    141581.00 ( -1.62%)
TPut 6     166854.00 (  0.00%)    166706.00 ( -0.09%)
TPut 7     195992.00 (  0.00%)    192481.00 ( -1.79%)
TPut 8     222045.00 (  0.00%)    227143.00 (  2.30%)
TPut 9     248872.00 (  0.00%)    250123.00 (  0.50%)
TPut 10    270934.00 (  0.00%)    279314.00 (  3.09%)
TPut 11    297217.00 (  0.00%)    301878.00 (  1.57%)
TPut 12    311021.00 (  0.00%)    326048.00 (  4.83%)
TPut 13    324145.00 (  0.00%)    346855.00 (  7.01%)
TPut 14    345973.00 (  0.00%)    378741.00 (  9.47%)
TPut 15    354199.00 (  0.00%)    394268.00 ( 11.31%)
TPut 16    378016.00 (  0.00%)    426782.00 ( 12.90%)
TPut 17    392553.00 (  0.00%)    437772.00 ( 11.52%)
TPut 18    396630.00 (  0.00%)    456715.00 ( 15.15%)
TPut 19    399114.00 (  0.00%)    484020.00 ( 21.27%)
TPut 20    413907.00 (  0.00%)    493618.00 ( 19.26%)
TPut 21    413173.00 (  0.00%)    510386.00 ( 23.53%)
TPut 22    420256.00 (  0.00%)    521016.00 ( 23.98%)
TPut 23    425581.00 (  0.00%)    536214.00 ( 26.00%)
TPut 24    429052.00 (  0.00%)    532469.00 ( 24.10%)
TPut 25    426127.00 (  0.00%)    526548.00 ( 23.57%)
TPut 26    422428.00 (  0.00%)    531994.00 ( 25.94%)
TPut 27    424378.00 (  0.00%)    488340.00 ( 15.07%)
TPut 28    419338.00 (  0.00%)    543016.00 ( 29.49%)
TPut 29    403347.00 (  0.00%)    529178.00 ( 31.20%)
TPut 30    408681.00 (  0.00%)    510621.00 ( 24.94%)
TPut 31    406496.00 (  0.00%)    499781.00 ( 22.95%)
TPut 32    404931.00 (  0.00%)    502313.00 ( 24.05%)
TPut 33    397353.00 (  0.00%)    522418.00 ( 31.47%)
TPut 34    382271.00 (  0.00%)    491989.00 ( 28.70%)
TPut 35    388965.00 (  0.00%)    493012.00 ( 26.75%)
TPut 36    374702.00 (  0.00%)    502677.00 ( 34.15%)
TPut 37    367578.00 (  0.00%)    500588.00 ( 36.19%)
TPut 38    367121.00 (  0.00%)    496977.00 ( 35.37%)
TPut 39    355956.00 (  0.00%)    489430.00 ( 37.50%)
TPut 40    350855.00 (  0.00%)    487802.00 ( 39.03%)
TPut 41    345001.00 (  0.00%)    468021.00 ( 35.66%)
TPut 42    336177.00 (  0.00%)    462260.00 ( 37.50%)
TPut 43    329169.00 (  0.00%)    467906.00 ( 42.15%)
TPut 44    329475.00 (  0.00%)    470784.00 ( 42.89%)
TPut 45    323845.00 (  0.00%)    450739.00 ( 39.18%)
TPut 46    323878.00 (  0.00%)    435457.00 ( 34.45%)
TPut 47    310524.00 (  0.00%)    403914.00 ( 30.07%)
TPut 48    311843.00 (  0.00%)    459017.00 ( 47.19%)

                        Balancing Disabled        Balancing Enabled
 Expctd Warehouse          48.00 (  0.00%)          48.00 (  0.00%)
 Expctd Peak Bops      310524.00 (  0.00%)      403914.00 ( 30.07%)
 Actual Warehouse          25.00 (  0.00%)          29.00 ( 16.00%)
 Actual Peak Bops      429052.00 (  0.00%)      543016.00 ( 26.56%)
 SpecJBB Bops            6364.00 (  0.00%)        9368.00 ( 47.20%)
 SpecJBB Bops/JVM        6364.00 (  0.00%)        9368.00 ( 47.20%)</pre></div><p>
   Automatic NUMA Balancing simplifies
   tuning workloads for high performance on NUMA machines. Where
   possible, it is still recommended to statically tune the workload to
   partition it within each node. However, in all other cases, automatic
   NUMA balancing should boost performance.
  </p></section></section><section class="chapter" id="cha-tuning-power" data-id-title="Power management"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">12 </span><span class="title-name">Power management</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-power">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Power management aims at reducing operating costs for energy and cooling
    systems while at the same time keeping the performance of a system at a
    level that matches the current requirements. Thus, power management is
    always a matter of balancing the actual performance needs and power
    saving options for a system. Power management can be implemented and
    used at different levels of the system. A set of specifications for
    power management functions of devices and the operating system interface
    to them has been defined in the Advanced Configuration and Power
    Interface (ACPI). As power savings in server environments can primarily
    be achieved at the processor level, this chapter introduces the
    main concepts and highlights a few tools for analyzing and influencing
    relevant parameters.
   </p></div></div></div></div><section class="sect1" id="sec-tuning-power-cpu" data-id-title="Power management at CPU Level"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.1 </span><span class="title-name">Power management at CPU Level</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-cpu">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   At the CPU level, you can control power usage in several ways. For
   example, by using idling power states (C-states), changing CPU frequency
   (P-states), and throttling the CPU (T-states). The following sections
   give a short introduction to each approach and its significance for power
   savings. Detailed specifications can be found at
   <a class="link" href="https://uefi.org/sites/default/files/resources/ACPI_Spec_6_4_Jan22.pdf" target="_blank">https://uefi.org/sites/default/files/resources/ACPI_Spec_6_4_Jan22.pdf</a>.
  </p><section class="sect2" id="sec-tuning-power-cpu-cstates" data-id-title="C-states (processor operating states)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.1.1 </span><span class="title-name">C-states (processor operating states)</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-cpu-cstates">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Modern processors have several power saving modes called
    <code class="literal">C-states</code>. They reflect the capability of an idle
    processor to turn off unused components to save power.
   </p><p>
    When a processor is in the <code class="literal">C0</code> state, it is executing
    instructions. A processor running in any other C-state is idle. The
    higher the C number, the deeper the CPU sleep mode: more components are
    shut down to save power. Deeper sleep states can save large amounts of
    energy. Their downside is that they introduce latency. This means, it
    takes more time for the CPU to go back to <code class="literal">C0</code>.
    Depending on workload (threads waking up, triggering CPU usage and then
    going back to sleep again for a short period of time) and hardware (for
    example, interrupt activity of a network device), disabling the deepest
    sleep states can increase overall performance. For details
    on how to do so, refer to
    <a class="xref" href="#sec-tuning-power-tools-cpupower-idle-info" title="12.3.2. Viewing kernel idle statistics with cpupower">Section 12.3.2, “Viewing kernel idle statistics with <code class="command">cpupower</code>”</a>.
   </p><p>
    Some states also have submodes with different power saving latency
    levels. Which C-states and submodes are supported depends on the
    respective processor. However, <code class="literal">C1</code> is always
    available.
   </p><p>
    <a class="xref" href="#tab-tuning-power-cstates" title="C-states">Table 12.1, “C-states”</a> gives an overview of the most
    common C-states.
   </p><div class="table" id="tab-tuning-power-cstates" data-id-title="C-states"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 12.1: </span><span class="title-name">C-states </span></span><a title="Permalink" class="permalink" href="#tab-tuning-power-cstates">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Mode
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         Definition
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         C0
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Operational state. CPU fully turned on.
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         C1
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         First idle state. Stops CPU main internal clocks via software. Bus
         interface unit and APIC are kept running at full speed.
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         C2
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Stops CPU main internal clocks via hardware. State in which the
         processor maintains all software-visible states, but may take
         longer to wake up through interrupts.
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         C3
        </p>
       </td><td>
        <p>
         Stops all CPU internal clocks. The processor does not need to keep
         its cache coherent, but maintains other states. Some processors
         have variations of the C3 state that differ in how long it takes to
         wake the processor through interrupts.
        </p>
       </td></tr></tbody></table></div></div><p>
    To avoid needless power consumption, it is recommended to test your
    workloads with deep sleep states enabled versus deep sleep states
    disabled. For more information, refer to
    <a class="xref" href="#sec-tuning-power-tools-cpupower-idle-info" title="12.3.2. Viewing kernel idle statistics with cpupower">Section 12.3.2, “Viewing kernel idle statistics with <code class="command">cpupower</code>”</a> or the
    <code class="command">cpupower-idle-set(1)</code> man page.
   </p></section><section class="sect2" id="sec-tuning-power-cpu-pstates" data-id-title="P-states (processor performance states)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.1.2 </span><span class="title-name">P-states (processor performance states)</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-cpu-pstates">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    While a processor operates (in C0 state), it can be in one of several
    CPU performance states <code class="literal">(P-states)</code>. Whereas C-states
    are idle states (all but C0), <code class="literal">P-states</code> are
    operational states that relate to CPU frequency and voltage.
   </p><p>
    The higher the P-state, the lower the frequency and voltage at which the
    processor runs. The number of P-states is processor-specific and the
    implementation differs across the different types. However,
    <code class="literal">P0</code> is always the highest-performance state (except for <a class="xref" href="#sec-tuning-cpu-power-turbo" title="12.1.3. Turbo features">Section 12.1.3, “Turbo features”</a>). Higher
    P-state numbers represent slower processor speeds and lower power
    consumption. For example, a processor in <code class="literal">P3</code> state runs
    more slowly and uses less power than a processor running in the
    <code class="literal">P1</code> state. To operate at any P-state, the processor
    must be in the <code class="literal">C0</code> state, which means that it is
    working and not idling. The CPU P-states are also defined in the ACPI
    specification, see <a class="link" href="https://uefi.org/sites/default/files/resources/ACPI_Spec_6_5_Aug29.pdf" target="_blank">https://uefi.org/sites/default/files/resources/ACPI_Spec_6_5_Aug29.pdf</a>.
   </p><p>
    C-states and P-states can vary independently of one another.
   </p></section><section class="sect2" id="sec-tuning-cpu-power-turbo" data-id-title="Turbo features"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.1.3 </span><span class="title-name">Turbo features</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-cpu-power-turbo">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Turbo features allow to dynamically <code class="literal">overtick</code> active CPU
    cores while other cores are in deep sleep states. This increases the performance
    of active threads while still
    complying with Thermal Design Power (TDP) limits.
   </p><p>
    However, the conditions under which a CPU core can use turbo frequencies
    are architecture-specific. Learn how to evaluate the efficiency of those
    new features in <a class="xref" href="#sec-tuning-power-tools-cpupower" title="12.3. The cpupower tools">Section 12.3, “The <code class="systemitem">cpupower</code> tools”</a>.
   </p></section></section><section class="sect1" id="sec-tuning-power-governors" data-id-title="In-kernel governors"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.2 </span><span class="title-name">In-kernel governors</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-governors">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p> The in-kernel governors belong to the Linux kernel CPUfreq infrastructure and can be
   used to dynamically scale processor frequencies at runtime. You can think of the governors as a
   sort of preconfigured power scheme for the CPU. The CPUfreq governors use P-states to
   change frequencies and lower power consumption. The dynamic governors can switch between CPU
   frequencies, based on CPU usage, to allow for power savings while not sacrificing performance.
  </p><p>
    The following governors are available with the CPUfreq subsystem:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.6.5.4.4.1"><span class="term">Performance governor</span></dt><dd><p>
       The CPU frequency is statically set to the highest possible for
       maximum performance. Consequently, saving power is not the focus of
       this governor.
      </p><p>See also <a class="xref" href="#sec-tuning-power-options-p-states" title="12.4.1. Tuning options for P-states">Section 12.4.1, “Tuning options for P-states”</a>.
      </p></dd><dt id="id-1.8.6.5.4.4.2"><span class="term">Powersave governor</span></dt><dd><p>
       The CPU frequency is statically set to the lowest possible. This can
       have severe impact on the performance, as the system never rises
       above this frequency no matter how busy the processors are. An important
       exception is the <code class="literal">intel_pstate</code> which defaults to the
       <code class="literal">powersave</code> mode. This is due to a hardware-specific
       decision but functionally it operates similarly to the
       <code class="literal">on-demand</code> governor.
      </p><p>
       However, using this governor often does not lead to the expected
       power savings as the highest savings can be achieved at idle
       through entering C-states. With the powersave governor, processes run
       at the lowest frequency and thus take longer to finish. This means it
       takes longer until the system can go into an idle C-state.
      </p><p>
       Tuning options: The range of minimum frequencies available to the
       governor can be adjusted (for example, with the
       <code class="command">cpupower</code> command line tool).
      </p></dd><dt id="id-1.8.6.5.4.4.3"><span class="term">On-demand governor</span></dt><dd><p>
       The kernel implementation of a dynamic CPU frequency policy: The
       governor monitors the processor usage. When it exceeds a
       certain threshold, the governor sets the frequency to the highest
       available. If the usage is less than the threshold, the next lowest
       frequency is used. If the system continues to be underemployed, the
       frequency is again reduced until the lowest available frequency is
       set.
      </p></dd></dl></div><div id="id-1.8.6.5.4.5" data-id-title="Drivers and in-kernel governors" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Drivers and in-kernel governors</div><p>Not all drivers use the in-kernel governors to dynamically scale power frequency at
    runtime. For example, the <code class="literal">intel_pstate</code> driver adjusts power frequency itself. Use
    the <code class="command">cpupower frequency-info</code> command to find out which driver your system
    uses.</p></div></section><section class="sect1" id="sec-tuning-power-tools-cpupower" data-id-title="The cpupower tools"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.3 </span><span class="title-name">The <code class="systemitem">cpupower</code> tools</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-tools-cpupower">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>The <code class="command">cpupower</code> tools are designed to give an overview
   of <span class="emphasis"><em>all</em></span> CPU power-related parameters that are supported
   on a given machine, including turbo (or boost) states. Use the toolset to
   view and modify settings of the kernel-related CPUfreq and cpuidle systems
   and other settings not related to frequency scaling or idle states. The
   integrated monitoring framework can access both kernel-related parameters
   and hardware statistics. Therefore, it is ideally suited for performance
   benchmarks. It also helps you to identify the dependencies between turbo and
   idle states.
   </p><p> After installing the <code class="systemitem">cpupower</code> package, view the
   available <code class="command">cpupower</code> subcommands with
   <code class="command">cpupower --help</code>. Access the general man page with
   <code class="command">man cpupower</code>, and the man pages of the subcommands with
   <code class="command">man cpupower-<em class="replaceable">SUBCOMMAND</em></code>.
   </p><section class="sect2" id="sec-tuning-power-tools-cpupower-freq-info" data-id-title="Viewing current settings with cpupower"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.3.1 </span><span class="title-name">Viewing current settings with <code class="command">cpupower</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-tools-cpupower-freq-info">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The <code class="command">cpupower frequency-info</code> command shows the
     statistics of the cpufreq driver used in the kernel. Additionally, it
     shows if turbo (boost) states are supported and enabled in the BIOS.
     Run without any options, it shows an output similar to the following:
    </p><div class="example" id="id-1.8.6.5.5.4.3" data-id-title="Example output of cpupower frequency-info"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 12.1: </span><span class="title-name">Example output of <code class="command">cpupower frequency-info</code> </span></span><a title="Permalink" class="permalink" href="#id-1.8.6.5.5.4.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cpupower frequency-info
analyzing CPU 0:
  driver: intel_pstate
  CPUs which run at the same hardware frequency: 0
  CPUs which need to have their frequency coordinated by software: 0
  maximum transition latency: 0.97 ms.
  hardware limits: 1.20 GHz - 3.80 GHz
  available cpufreq governors: performance, powersave
  current policy: frequency should be within 1.20 GHz and 3.80 GHz.
                  The governor "powersave" may decide which speed to use
                  within this range.
  current CPU frequency is 3.40 GHz (asserted by call to hardware).
  boost state support:
    Supported: yes
    Active: yes
    3500 MHz max turbo 4 active cores
    3600 MHz max turbo 3 active cores
    3600 MHz max turbo 2 active cores
    3800 MHz max turbo 1 active cores</pre></div></div></div><p>
     To get the current values for all CPUs, use
     <code class="command">cpupower -c all frequency-info</code>.
    </p></section><section class="sect2" id="sec-tuning-power-tools-cpupower-idle-info" data-id-title="Viewing kernel idle statistics with cpupower"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.3.2 </span><span class="title-name">Viewing kernel idle statistics with <code class="command">cpupower</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-tools-cpupower-idle-info">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The <code class="command">idle-info</code> subcommand shows the statistics of the
     cpuidle driver used in the kernel. It works on all architectures that
     use the cpuidle kernel framework.
    </p><div class="example" id="id-1.8.6.5.5.5.3" data-id-title="Example output of cpupower idle-info"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 12.2: </span><span class="title-name">Example output of <code class="command">cpupower idle-info</code> </span></span><a title="Permalink" class="permalink" href="#id-1.8.6.5.5.5.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cpupower idle-info
CPUidle driver: intel_idle
CPUidle governor: menu

Analyzing CPU 0:
Number of idle states: 6
Available idle states: POLL C1-SNB C1E-SNB C3-SNB C6-SNB C7-SNB
POLL:
Flags/Description: CPUIDLE CORE POLL IDLE
Latency: 0
Usage: 163128
Duration: 17585669
C1-SNB:
Flags/Description: MWAIT 0x00
Latency: 2
Usage: 16170005
Duration: 697658910
C1E-SNB:
Flags/Description: MWAIT 0x01
Latency: 10
Usage: 4421617
Duration: 757797385
C3-SNB:
Flags/Description: MWAIT 0x10
Latency: 80
Usage: 2135929
Duration: 735042875
C6-SNB:
Flags/Description: MWAIT 0x20
Latency: 104
Usage: 53268
Duration: 229366052
C7-SNB:
Flags/Description: MWAIT 0x30
Latency: 109
Usage: 62593595
Duration: 324631233978</pre></div></div></div><p>
     After finding out which processor idle states are supported with
     <code class="command">cpupower idle-info</code>, individual states can be
     disabled using the <code class="command">cpupower idle-set</code> command.
     Typically one wants to disable the deepest sleep state, for example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cpupower idle-set -d 5</pre></div><p>Or, for disabling all CPUs with latencies equal to or higher than <code class="literal">80</code>:</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cpupower idle-set -D 80</pre></div></section><section class="sect2" id="sec-tuning-power-tools-cpupower-monitor" data-id-title="Monitoring kernel and hardware statistics with cpupower"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.3.3 </span><span class="title-name">Monitoring kernel and hardware statistics with <code class="command">cpupower</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-tools-cpupower-monitor">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use the <code class="command">monitor</code> subcommand to report processor topology, and monitor frequency
     and idle power state statistics over a certain period of time. The
     default interval is <code class="literal">1</code> second, but it can be changed
     with the <code class="option">-i</code>. Independent processor sleep states and
     frequency counters are implemented in the tool—some retrieved
     from kernel statistics, others reading out hardware registers. The
     available monitors depend on the underlying hardware and the system.
     List them with <code class="command">cpupower monitor -l</code>.
     For a description of the individual monitors, refer to the
     cpupower-monitor man page.
    </p><p>
     The <code class="command">monitor</code> subcommand allows you to execute
     performance benchmarks. To compare kernel statistics with hardware
     statistics for specific workloads, concatenate the respective command, for example:</p><div class="verbatim-wrap"><pre class="screen"><code class="command">cpupower</code> <code class="option">monitor</code> db_test.sh</pre></div><div class="complex-example"><div class="example" id="ex-cpupower-monitor" data-id-title="Example cpupower monitor output"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 12.3: </span><span class="title-name">Example <code class="command">cpupower monitor</code> output </span></span><a title="Permalink" class="permalink" href="#ex-cpupower-monitor">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cpupower monitor
|Mperf                   || Idle_Stats
 <span class="callout" id="co-cpupower-mon-mperf">1</span>                         <span class="callout" id="co-cpupower-mon-idle">2</span> 
CPU | C0   | Cx   | Freq || POLL | C1   | C2   | C3
   0|  3.71| 96.29|  2833||  0.00|  0.00|  0.02| 96.32
   1| 100.0| -0.00|  2833||  0.00|  0.00|  0.00|  0.00
   2|  9.06| 90.94|  1983||  0.00|  7.69|  6.98| 76.45
   3|  7.43| 92.57|  2039||  0.00|  2.60| 12.62| 77.52</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-cpupower-mon-mperf"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Mperf shows the average frequency of a CPU, including boost
        frequencies, over time. Additionally, it shows the
        percentage of time the CPU has been active (<code class="literal">C0</code>)
        or in any sleep state (<code class="literal">Cx</code>). As the turbo states are managed by the
        BIOS, it is impossible to get the frequency values at a given
        instant. On modern processors with turbo features the Mperf monitor
        is the only way to find out about the frequency a certain CPU has
        been running in.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-cpupower-mon-idle"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Idle_Stats shows the statistics of the cpuidle kernel subsystem. The
        kernel updates these values every time an idle state is entered or
        left. Therefore, there can be a few inaccuracies when cores are in an
        idle state for some time when the measure starts or ends.
       </p></td></tr></table></div><p>
      Apart from the (general) monitors in the example above, other
      architecture-specific monitors are available. For detailed
      information, refer to the <code class="command">cpupower-monitor</code> man
      page.
     </p></div></div></div><p>
     By comparing the values of the individual monitors, you can find
     correlations and dependencies and evaluate how well the power saving
     mechanism works for a certain workload. In
     <a class="xref" href="#ex-cpupower-monitor" title="Example cpupower monitor output">Example 12.3</a> you can
     see that CPU <code class="literal">0</code> is idle (the value of
     <code class="literal">Cx</code> is near 100%), but runs at a high frequency.
     This is because the CPUs <code class="literal">0</code> and <code class="literal">1</code>
     have the same frequency values which means that there is a dependency
     between them.
    </p></section><section class="sect2" id="sec-tuning-power-tools-cpupower-freq-set" data-id-title="Modifying current settings with cpupower"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.3.4 </span><span class="title-name">Modifying current settings with <code class="command">cpupower</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-tools-cpupower-freq-set">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can use
     <code class="command">cpupower frequency-set</code> command as <code class="systemitem">root</code> to
     modify current settings. It allows you to set values for the minimum or
     maximum CPU frequency the governor may select or to create a new
     governor. With the <code class="option">-c</code> option, you can also specify for
     which of the processors the settings should be modified. That makes it
     easy to use a consistent policy across all processors without adjusting
     the settings for each processor individually. For more details and the
     available options, see the man page
     <code class="literal">cpupower-frequency-set</code> or run
     <code class="command">cpupower frequency-set</code>
     <code class="option">--help</code>.
    </p></section></section><section class="sect1" id="sec-tuning-power-options" data-id-title="Special tuning options"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.4 </span><span class="title-name">Special tuning options</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-options">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following sections highlight important settings.
  </p><section class="sect2" id="sec-tuning-power-options-p-states" data-id-title="Tuning options for P-states"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.4.1 </span><span class="title-name">Tuning options for P-states</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-options-p-states">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The CPUfreq subsystem offers several tuning options for P-states:
    You can switch between the different governors, influence minimum or
    maximum CPU frequency to be used or change individual governor
    parameters.
   </p><p>
    To switch to another governor at runtime, use
    <code class="command">cpupower frequency-set</code> with the <code class="option">-g</code> option. For
    example, running the following command (as <code class="systemitem">root</code>) will activate the
    performance governor:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cpupower frequency-set -g performance</pre></div><p>
    To set values for the minimum or maximum CPU frequency the governor may
    select, use the <code class="option">-d</code> or <code class="option">-u</code> option,
    respectively.
   </p></section></section><section class="sect1" id="sec-tuning-power-trouble" data-id-title="Troubleshooting"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.5 </span><span class="title-name">Troubleshooting</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-trouble">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.6.5.7.2.1"><span class="term">BIOS options enabled?</span></dt><dd><p>
      To use C-states or P-states, check your BIOS options:
     </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        To use C-states, make sure to enable <code class="literal">CPU C State</code>
        or similar options to benefit from power savings at idle.
       </p></li><li class="listitem"><p>
        To use P-states and the CPUfreq governors, make sure to enable
        <code class="literal">Processor Performance States</code> options or similar.
       </p></li><li class="listitem"><p>
        Even if P-states and C-states are available, it is possible that the
        platform firmware is managing CPU frequencies which may be sub-optimal.
        For example, if <code class="literal">pcc-cpufreq</code> is loaded then the
        OS is only giving hints to the firmware, which is free to ignore the
        hints. This can be addressed by selecting "OS Management" or similar
        for CPU frequency managed in the BIOS. After reboot, an alternative
        driver will be used but the performance impact should be carefully
        measured.
       </p></li></ul></div><p>
      In case of a CPU upgrade, make sure to upgrade your BIOS, too. The
      BIOS needs to know the new CPU and its frequency stepping to
      pass this information on to the operating system.
     </p></dd><dt id="id-1.8.6.5.7.2.2"><span class="term">Log file information?</span></dt><dd><p>
      Check the <code class="systemitem">systemd</code> journal (see <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: query the <code class="systemitem">systemd</code> journal”</span>)
      for any output regarding the CPUfreq subsystem. Only severe
      errors are reported there.
     </p><p>
      If you suspect problems with the CPUfreq subsystem on your
      machine, you can also enable additional debug output. To do so, either
      use <code class="command">cpufreq.debug=7</code> as boot parameter or execute
      the following command as <code class="systemitem">root</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>echo 7 &gt; /sys/module/cpufreq/parameters/debug</pre></div><p>
      This will cause CPUfreq to log more information to
      <code class="command">dmesg</code> on state transitions, which is useful for
      diagnosis. But as this additional output of kernel messages can be
      rather comprehensive, use it only if you are sure that a
      problem exists.
     </p></dd></dl></div></section><section class="sect1" id="sec-tuning-power-more" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.6 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-more">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Platforms with a Baseboard Management Controller (BMC) may have additional
   power management configuration options accessible via the service
   processor. These configurations are vendor specific and therefore not
   subject of this guide. For more information, refer to the manuals provided
   by your vendor.
   
  </p><p>
   For more information about powerTOP, refer to
   <a class="link" href="https://01.org/powertop" target="_blank">https://01.org/powertop</a>.
  </p></section><section class="sect1" id="sec-tuning-power-tools-powertop" data-id-title="Monitoring power consumption with powerTOP"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.7 </span><span class="title-name">Monitoring power consumption with powerTOP</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-power-tools-powertop">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   powerTOP helps to identify the causes of unnecessary high power
   consumption. This is especially
   useful for laptops, where minimizing power consumption is
   more important. It supports both Intel and AMD processors.
   Install it in the usual way:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">zypper in powertop</code></pre></div><p>
   powerTOP combines several sources of information (analysis of
   programs, device drivers, kernel options, number and sources of
   interrupts waking up processors from sleep states) and provides
   several ways of viewing them. You can launch it in interactive mode,
   which runs in an ncurses session (see
   <a class="xref" href="#fig-powertop-curses" title="powerTOP in interactive mode">Figure 12.1, “powerTOP in interactive mode”</a>):
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">powertop</code></pre></div><div class="figure" id="fig-powertop-curses"><div class="figure-contents"><div class="mediaobject"><a href="images/powertop_ncurses.png"><img src="images/powertop_ncurses.png" width="75%" alt="powerTOP in interactive mode" title="powerTOP in interactive mode"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 12.1: </span><span class="title-name">powerTOP in interactive mode </span></span><a title="Permalink" class="permalink" href="#fig-powertop-curses">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div><p>
   powerTOP supports exporting reports to HTML and CSV.
   The following example generates a single report of a 240-second run:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">powertop --iteration=1 --time=240 --html=<em class="replaceable">POWERREPORT.HTML</em></code></pre></div><p>
   It can be useful to run separate reports over time.
   The following example runs powerTOP 10 times for 20 seconds each time,
   and creates a separate HTML report for each run:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">powertop --iteration=10 --time=20 --html=<em class="replaceable">POWERREPORT.HTML</em></code></pre></div><p>
   This creates 10 time-stamped reports:
  </p><div class="verbatim-wrap"><pre class="screen">powerreport-20200108-104512.html
powerreport-20200108-104451.html
powerreport-20200108-104431.html
[...]</pre></div><p>
   An HTML report looks like <a class="xref" href="#fig-powertop-html" title="HTML powerTOP report">Figure 12.2, “HTML powerTOP report”</a>:
  </p><div class="figure" id="fig-powertop-html"><div class="figure-contents"><div class="mediaobject"><a href="images/powertop_html.png"><img src="images/powertop_html.png" width="75%" alt="HTML powerTOP report" title="HTML powerTOP report"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 12.2: </span><span class="title-name">HTML powerTOP report </span></span><a title="Permalink" class="permalink" href="#fig-powertop-html">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_power.xml" title="Edit source document"> </a></div></div></div><p>
   The Tuning tab of the HTML reports, and the Tunables tab in the
   interactive mode, both provide commands for testing the various power
   settings. The HTML report prints the commands, which you can copy
   to a root command line for testing, for example
   <code class="command">echo '0' &gt; '/proc/sys/kernel/nmi_watchdog'</code>.
   The ncurses mode provides a simple toggle between <code class="literal">Good</code>
   and <code class="literal">Bad</code>. <code class="literal">Good</code> runs a command
   to enable power saving, and <code class="literal">Bad</code> turns off power saving.
   Enable all powerTOP settings with one command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">powertop --auto-tune</code></pre></div><p>
   None of these changes survive a reboot. To make any changes
   permanent, use <code class="command">sysctl</code>, <code class="command">udev</code>,
   or <code class="systemitem">systemd</code> to run your selected commands at
   boot. powerTOP includes a <code class="systemitem">systemd</code> service file,
   <code class="filename">/usr/lib/systemd/system/powertop.service</code>. This
   starts powerTOP with the <code class="command">--auto-tune</code> option:
  </p><div class="verbatim-wrap"><pre class="screen">ExecStart=/usr/sbin/powertop --auto-tune</pre></div><p>
   Test this carefully before launching the <code class="systemitem">systemd</code> service,
   to see if it gives the results that you want.
   You should not use USB keyboards, and mice should not enter power save mode to avoid constantly
   waking them up and disturbing other devices. For easier testing and configuration editing,
   extract the commands from an HTML report with <code class="command">awk</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>awk -F '&lt;/?td ?&gt;' '/tune/ { print $4 }' <em class="replaceable">POWERREPORT.HTML</em></pre></div><p>
   In calibrate mode, powerTOP sets up several runs that use different idle
   settings for backlight, CPU, Wi-Fi, USB devices, and disks, and helps to
   identify optimal brightness settings on battery power:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">powertop --calibrate</code></pre></div><p>
   You may call a file that creates a workload for more accurate calibration:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">powertop --calibrate --workload=<em class="replaceable">FILENAME</em> --html=POWERREPORT.HTML</code></pre></div><p>
   For more information, see:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     The powerTOP project page at <a class="link" href="https://01.org/powertop" target="_blank">https://01.org/powertop</a>
    </p></li><li class="listitem"><p>
     <a class="xref" href="#sec-util-proc-procinfo-sysctl" title="2.6.2. System control parameters: /proc/sys/">Section 2.6.2, “System control parameters: <code class="filename">/proc/sys/</code>”</a>
    </p></li><li class="listitem"><p>
     <span class="intraxref">Book “Administration Guide”, Chapter 19 “The <code class="systemitem">systemd</code> daemon”</span>
    </p></li><li class="listitem"><p>
     <span class="intraxref">Book “Administration Guide”, Chapter 29 “Dynamic kernel device management with <code class="systemitem">udev</code>”</span>
    </p></li></ul></div></section></section></div><div class="part" id="part-tuning-kernel" data-id-title="Kernel tuning"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part V </span><span class="title-name">Kernel tuning </span></span><a title="Permalink" class="permalink" href="#part-tuning-kernel">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_tuning.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-tuning-io"><span class="title-number">13 </span><span class="title-name">Tuning I/O performance</span></a></span></li><dd class="toc-abstract"><p>
  I/O scheduling controls how input/output operations are submitted to
  storage. <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> offers several I/O algorithms—called
  <code class="literal">elevators</code>—suiting different workloads.
  Elevators can help to reduce seek operations and can prioritize I/O requests.
 </p></dd><li><span class="chapter"><a href="#cha-tuning-taskscheduler"><span class="title-number">14 </span><span class="title-name">Tuning the task scheduler</span></a></span></li><dd class="toc-abstract"><p>Modern operating systems, such as SUSE® Linux Enterprise Desktop, normally run many tasks at the same time. For example, you can be searching in a text file while receiving an e-mail and copying a big file to an external hard disk. These simple tasks require many additional processes to be run by th…</p></dd><li><span class="chapter"><a href="#cha-tuning-memory"><span class="title-number">15 </span><span class="title-name">Tuning the memory management subsystem</span></a></span></li><dd class="toc-abstract"><p>
  To understand and tune the memory management behavior of the
  kernel, it is important to first have an overview of how it works and
  cooperates with other subsystems.
 </p></dd><li><span class="chapter"><a href="#cha-tuning-network"><span class="title-number">16 </span><span class="title-name">Tuning the network</span></a></span></li><dd class="toc-abstract"><p>The network subsystem is complex and its tuning highly depends on the system use scenario and on external factors such as software clients or hardware components (switches, routers, or gateways) in your network. The Linux kernel aims more at reliability and low latency than low overhead and high thr…</p></dd></ul></div><section class="chapter" id="cha-tuning-io" data-id-title="Tuning I/O performance"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">13 </span><span class="title-name">Tuning I/O performance</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-io">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  I/O scheduling controls how input/output operations are submitted to
  storage. <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> offers several I/O algorithms—called
  <code class="literal">elevators</code>—suiting different workloads.
  Elevators can help to reduce seek operations and can prioritize I/O requests.
 </p><p>
  Choosing the best suited I/O elevator not only depends on the workload
  but on the hardware too. For example, single ATA disk systems, SSDs, RAID arrays, or
  network storage systems each require different tuning
  strategies.
 </p><section class="sect1" id="cha-tuning-io-switch" data-id-title="Switching I/O scheduling"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.1 </span><span class="title-name">Switching I/O scheduling</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-io-switch">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> picks a default I/O scheduler at boot-time, which can be
   changed on the fly per block device. This makes it possible to set different
   algorithms, for example, for the device hosting the system partition and the
   device hosting a database.
  </p><p>
   The default I/O scheduler is chosen for each device based on whether the
   device reports to be rotational disk or not. For rotational disks, the
   <code class="systemitem">BFQ</code> I/O scheduler is picked.
   Other devices default to <code class="systemitem">MQ-DEADLINE</code> or <code class="systemitem">NONE</code>.
  </p><p>
   To change the elevator for a specific device in the running system, run
   the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> echo <em class="replaceable">SCHEDULER</em> &gt; /sys/block/<em class="replaceable">DEVICE</em>/queue/scheduler</pre></div><p>
   Here, <em class="replaceable">SCHEDULER</em> is one of
   <code class="option">bfq</code>, <code class="option">none</code>,
   <code class="option">kyber</code>, or <code class="option">mq-deadline</code>.
   <em class="replaceable">DEVICE</em> is the block device
   (<code class="systemitem">sda</code> for example). This change does not
   persist during reboot. For permanent I/O scheduler change for a particular
   device, copy <code class="filename">/usr/lib/udev/rules.d/60-io-scheduler.rules</code> to
   <code class="filename">/etc/udev/rules.d/60-io-scheduler.rules</code>, and edit
   the latter file to suit your needs.
  </p></section><section class="sect1" id="cha-tuning-io-schedulers-blkmq" data-id-title="Available I/O elevators with blk-mq I/O path"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.2 </span><span class="title-name">Available I/O elevators with blk-mq I/O path</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-io-schedulers-blkmq">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
       Below is a list of elevators available on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> for devices
       that use the blk-mq I/O path.
       If an elevator has tunable parameters, they can be set with the
       command:
     </p><div class="verbatim-wrap"><pre class="screen">echo <em class="replaceable">VALUE</em> &gt; /sys/block/<em class="replaceable">DEVICE</em>/queue/iosched/<em class="replaceable">TUNABLE</em></pre></div><p>
   In the command above, <em class="replaceable">VALUE</em> is the desired value for the
   <em class="replaceable">TUNABLE</em> and <em class="replaceable">DEVICE</em> is
   the block device.
  </p><p>
   To find out what elevators are available for a device
   (<code class="systemitem">sda</code> for example), run the following
   command (the currently selected scheduler is listed in brackets):
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /sys/block/sda/queue/scheduler
[mq-deadline] kyber bfq none</pre></div><section class="sect2" id="sec-tuning-io-schedulers-mqdeadline" data-id-title="MQ-DEADLINE"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.2.1 </span><span class="title-name"><code class="systemitem">MQ-DEADLINE</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-io-schedulers-mqdeadline">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">MQ-DEADLINE</code> is a
     latency-oriented I/O scheduler. <code class="systemitem">MQ-DEADLINE</code> has the following
     tunable parameters:
   </p><div class="table" id="tab-tunables-mq-deadline" data-id-title="MQ-DEADLINE tunable parameters"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 13.1: </span><span class="title-name"><code class="systemitem">MQ-DEADLINE</code> tunable parameters </span></span><a title="Permalink" class="permalink" href="#tab-tunables-mq-deadline">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; "><p>File</p></th><th style="border-bottom: 1px solid ; "><p>Description</p></th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">writes_starved</code></p></td><td style="border-bottom: 1px solid ; "><p> Controls how many times reads are preferred
	   over writes. A value of <code class="literal">3</code> means that
	   three read operations can be done before writes and reads
	   are dispatched on the same selection criteria.
	   </p><p>Default is <code class="literal">3</code>.
	   </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">read_expire</code></p></td><td style="border-bottom: 1px solid ; "><p> Sets the deadline (current time plus the
	   <code class="literal">read_expire</code> value) for read operations in milliseconds.
	   </p><p>Default is <code class="literal">500</code>.
	   </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">write_expire</code></p></td><td style="border-bottom: 1px solid ; "><p> Sets the deadline (current time plus the
	   <code class="literal">write_expire</code> value) for write operations in
	   milliseconds.
	   </p><p>Default is <code class="literal">5000</code>.
	   </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">front_merges</code></p></td><td style="border-bottom: 1px solid ; "><p> Enables (1) or disables (0) attempts to front
	   merge requests.
	   </p><p>Default is <code class="literal">1</code>.</p></td></tr><tr><td style="border-right: 1px solid ; "><p><code class="filename">fifo_batch</code></p></td><td><p> Sets the maximum number of requests per batch
	   (deadline expiration is only checked for batches). This
	   parameter allows to balance between latency and
	   throughput. When set to <code class="literal">1</code> (that is, one
	   request per batch), it results in <span class="quote">“<span class="quote">first come, first served</span>”</span> behavior and lowest latency, with higher values increasing the throughput.
	   </p><p>Default is <code class="literal">16</code>.
	   </p></td></tr></tbody></table></div></div></section><section class="sect2" id="sec-tuning-io-schedulers-none" data-id-title="NONE"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.2.2 </span><span class="title-name"><code class="systemitem">NONE</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-io-schedulers-none">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     When <code class="systemitem">NONE</code> is selected
     as I/O elevator option for blk-mq, no I/O scheduler
     is used, and I/O requests are passed down to the
     device without further I/O scheduling interaction.
   </p><p>
     <code class="systemitem">NONE</code> is the default for
     NVM Express devices. With no overhead compared to other I/O
     elevator options, it is considered the fastest way of passing down
     I/O requests on multiple queues to such devices.
   </p><p>
     There are no tunable parameters for <code class="systemitem">NONE</code>.
   </p></section><section class="sect2" id="sec-tuning-io-schedulers-bfq" data-id-title="BFQ (Budget Fair Queueing)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.2.3 </span><span class="title-name"><code class="systemitem">BFQ</code> (Budget Fair Queueing)</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-io-schedulers-bfq">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">BFQ</code> is a
     fairness-oriented scheduler. It is described as "a
     proportional-share storage-I/O scheduling algorithm based on the
     slice-by-slice service scheme of CFQ. But BFQ assigns budgets,
     measured in number of sectors, to processes instead of time
     slices." (Source: 
     <a class="link" href="https://github.com/torvalds/linux/blob/6f7da290413ba713f0cdd9ff1a2a9bb129ef4f6c/block/bfq-iosched.c#L31" target="_blank">linux-4.12/block/bfq-iosched.c</a>)
   </p><p>
     <code class="systemitem">BFQ</code> allows to assign
     I/O priorities to tasks which are taken into account during
     scheduling decisions (see <a class="xref" href="#cha-tuning-resources-disk-ionice" title="9.3.3. Prioritizing disk access with ionice">Section 9.3.3, “Prioritizing disk access with <code class="command">ionice</code>”</a>).
   </p><p>
     <code class="systemitem">BFQ</code> scheduler has the
     following tunable parameters:
   </p><div class="table" id="tab-tunables-bfq" data-id-title="BFQ tunable parameters"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 13.2: </span><span class="title-name"><code class="systemitem">BFQ</code> tunable parameters </span></span><a title="Permalink" class="permalink" href="#tab-tunables-bfq">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; "><p>File</p></th><th style="border-bottom: 1px solid ; "><p>Description</p></th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">slice_idle</code></p></td><td style="border-bottom: 1px solid ; "><p>Value in milliseconds specifies how long to
           idle, waiting for next request on an empty queue.
           </p><p>Default is <code class="literal">8</code>.
           </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">slice_idle_us</code></p></td><td style="border-bottom: 1px solid ; "><p>Same as <code class="filename">slice_idle</code> but in
           microseconds.
           </p><p>Default is <code class="literal">8000</code>.
           </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">low_latency</code></p></td><td style="border-bottom: 1px solid ; "><p>Enables (1) or disables (0) <code class="systemitem">BFQ</code>'s low latency mode. This
           mode prioritizes certain applications (for example, if interactive)
           such that they observe lower latency.
           </p><p>Default is <code class="literal">1</code>.
           </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">back_seek_max</code></p></td><td style="border-bottom: 1px solid ; "><p> Maximum value (in Kbytes) for backward seeking.
           </p><p>Default is <code class="literal">16384</code>.
           </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">back_seek_penalty</code></p></td><td style="border-bottom: 1px solid ; "><p> Used to compute the cost of backward seeking.
           </p><p>Default is <code class="literal">2</code>.
           </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">fifo_expire_async</code></p></td><td style="border-bottom: 1px solid ; "><p> Value (in milliseconds) is used to set the
           timeout of asynchronous requests.
           </p><p>Default is <code class="literal">250</code>.
           </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">fifo_expire_sync</code></p></td><td style="border-bottom: 1px solid ; "><p> Value in milliseconds specifies the
           timeout of synchronous requests.
           </p><p>Default is <code class="literal">125</code>.
           </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">timeout_sync</code></p></td><td style="border-bottom: 1px solid ; "><p> Maximum time in milliseconds that a task
           (queue) is serviced after it has been selected.
           </p><p>Default is <code class="literal">124</code>.
           </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">max_budget</code></p></td><td style="border-bottom: 1px solid ; "><p> Limit for number of sectors that are served
           at maximum within <code class="literal">timeout_sync</code>. If set to
           <code class="literal">0</code> <code class="systemitem">BFQ</code> internally calculates a
           value based on <code class="filename">timeout_sync</code> and an
           estimated peak rate.
           </p><p>Default is <code class="literal">0</code>
           (set to auto-tuning). </p></td></tr><tr><td style="border-right: 1px solid ; "><p><code class="filename">strict_guarantees</code></p></td><td><p> Enables (1) or disables (0) <code class="systemitem">BFQ</code> specific queue handling
           required to give stricter bandwidth sharing guarantees
           under certain conditions.
           </p><p>Default is <code class="literal">0</code>.
           </p></td></tr></tbody></table></div></div></section><section class="sect2" id="sec-tuning-io-schedulers-kyber" data-id-title="KYBER"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.2.4 </span><span class="title-name"><code class="systemitem">KYBER</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-io-schedulers-kyber">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="systemitem">KYBER</code> is a
    latency-oriented I/O scheduler. It makes it possible to set target latencies
    for reads and synchronous writes and throttles I/O requests in
    order to try to meet these target latencies.
   </p><div class="table" id="tab-tunables-kyber" data-id-title="KYBER tunable parameters"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 13.3: </span><span class="title-name"><code class="systemitem">KYBER</code> tunable parameters </span></span><a title="Permalink" class="permalink" href="#tab-tunables-kyber">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; "><p>File</p></th><th style="border-bottom: 1px solid ; "><p>Description</p></th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">read_lat_nsec</code></p></td><td style="border-bottom: 1px solid ; "><p>Sets the target latency for read operations in
           nanoseconds.
           </p><p>Default is <code class="literal">2000000</code>.
           </p></td></tr><tr><td style="border-right: 1px solid ; "><p><code class="filename">write_lat_nsec</code></p></td><td><p>Sets the target latency for write operations in
           nanoseconds.
           </p><p>Default is <code class="literal">10000000</code>.
           </p></td></tr></tbody></table></div></div></section></section><section class="sect1" id="cha-tuning-io-barrier" data-id-title="I/O barrier tuning"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.3 </span><span class="title-name">I/O barrier tuning</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-io-barrier">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_storagescheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Certain file systems (for example, Ext3 or Ext4) send write
   barriers to disk after fsync or during transaction commits. Write
   barriers enforce proper ordering of writes, making volatile disk write
   caches safe to use (with performance penalty). If your disks are
   battery-backed in one way or another, disabling barriers can safely
   improve performance.
  </p><div id="id-1.8.7.2.7.3" data-id-title="nobarrier is deprecated in XFS" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: <code class="option">nobarrier</code> is deprecated in XFS</div><p>
  The <code class="option">nobarrier</code> option is deprecated
  for XFS and is not a valid mount option in SUSE Linux Enterprise 15 SP2 and upward. Any
  XFS mount command that explicitly specifies the flag may fail to mount the
  file system. To prevent this from happening, make sure that no scripts or
  fstab entries contain the <code class="option">nobarrier</code> option.
  </p></div><p>
   Sending write barriers can be disabled using the
   <code class="option">nobarrier</code> mount option.
  </p><div id="id-1.8.7.2.7.5" data-id-title="Disabling barriers can lead to data loss" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Disabling barriers can lead to data loss</div><p>
    Disabling barriers when disks cannot guarantee caches are properly
    written in case of power failure can lead to severe file system
    corruption and data loss.
   </p></div></section></section><section class="chapter" id="cha-tuning-taskscheduler" data-id-title="Tuning the task scheduler"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">14 </span><span class="title-name">Tuning the task scheduler</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-taskscheduler">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Modern operating systems, such as <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span>, normally run many tasks
    at the same time. For example, you can be searching in a text file while
    receiving an e-mail and copying a big file to an external hard disk. These
    simple tasks require many additional processes to be run by the system. To
    provide each task with its required system resources, the Linux kernel
    needs a tool to distribute available system resources to individual tasks.
    And this is exactly what the <span class="emphasis"><em>task scheduler</em></span> does.
  </p><p>
    The following sections explain the most important terms related to a
    process scheduling. They also introduce information about the task
    scheduler policy, scheduling algorithm, description of the task scheduler
    used by <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, and references to other sources of relevant
    information.
  </p><section class="sect1" id="sec-tuning-taskscheduler-intro" data-id-title="Introduction"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.1 </span><span class="title-name">Introduction</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      The Linux kernel controls the way that tasks (or processes) are managed
      on the system. The task scheduler, sometimes called <span class="emphasis"><em>process
      scheduler</em></span>, is the part of the kernel that decides which task
      to run next. It is responsible for the optimal use of system resources to
      guarantee that multiple tasks are being executed simultaneously. This
      makes it a core component of any multitasking operating system.
    </p><section class="sect2" id="sec-tuning-taskscheduler-intro-preemption" data-id-title="Preemption"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.1.1 </span><span class="title-name">Preemption</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-intro-preemption">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The theory behind task scheduling is simple. If there are runnable
        processes in a system, at least one process must always be running. If
        there are more runnable processes than processors in a system, not all
        the processes can be running all the time.
      </p><p>
        Therefore, certain processes need to be stopped temporarily, or
        <span class="emphasis"><em>suspended</em></span>, so that others can be running again.
        The scheduler decides what process in the queue runs next.
      </p><p>
        As already mentioned, Linux, like all other Unix variants, is a
        <span class="emphasis"><em>multitasking</em></span> operating system. That means that
        several tasks can be running at the same time. Linux provides a so
        called <span class="emphasis"><em>preemptive</em></span> multitasking, where the
        scheduler decides when a process is suspended. This forced suspension
        is called <span class="emphasis"><em>preemption</em></span>. All Unix flavors have been
        providing preemptive multitasking since the beginning.
      </p></section><section class="sect2" id="sec-tuning-taskscheduler-intro-timeslice" data-id-title="Timeslice"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.1.2 </span><span class="title-name">Timeslice</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-intro-timeslice">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The time period for which a process runs before it is
        <span class="emphasis"><em>preempted</em></span> is defined in advance. It is called a
        <span class="emphasis"><em>timeslice</em></span> of a process and represents the amount
        of processor time that is provided to each process. By assigning
        timeslices, the scheduler makes global decisions for the running
        system, and prevents individual processes from taking control of the
        processor resources.
        
      </p></section><section class="sect2" id="sec-tuning-taskscheduler-intro-priority" data-id-title="Process priority"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.1.3 </span><span class="title-name">Process priority</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-intro-priority">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The scheduler evaluates processes based on their priority. To calculate
        the current priority of a process, the task scheduler uses complex
        algorithms. As a result, each process is given a value according to
        which it is <span class="quote">“<span class="quote">allowed</span>”</span> to run on a processor.
      </p></section></section><section class="sect1" id="sec-tuning-taskscheduler-policy-class" data-id-title="Process classification"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.2 </span><span class="title-name">Process classification</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-policy-class">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Processes are classified according to their purpose and behavior.
      Although the borderline is not always distinct, generally two criteria
      are used to sort them. These criteria are independent and do not exclude
      each other.
    </p><p>
      One approach is to classify a process either
      <span class="emphasis"><em>I/O-bound</em></span> or <span class="emphasis"><em>processor-bound</em></span>.
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.3.6.4.1"><span class="term">I/O-bound</span></dt><dd><p>
            I/O stands for Input/Output devices, such as keyboards, mice, or
            optical and hard disks. <span class="emphasis"><em>I/O-bound processes</em></span>
            spend most of the time submitting and waiting for requests. They
            are run frequently, but at short time intervals, not to block other
            processes waiting for I/O requests.
          </p></dd><dt id="id-1.8.7.3.6.4.2"><span class="term">processor-bound</span></dt><dd><p>
            <span class="emphasis"><em>Processor-bound</em></span> tasks use their time to
            execute a code, and run until they are preempted by the scheduler.
            They do not block processes waiting for I/O requests, and,
            therefore, can be run less frequently but for longer time
            intervals.
          </p></dd></dl></div><p>
      Another approach is to divide processes by type into
      <span class="emphasis"><em>interactive</em></span>, <span class="emphasis"><em>batch</em></span>, and
      <span class="emphasis"><em>real-time</em></span> processes.
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          <span class="emphasis"><em>Interactive</em></span> processes spend a lot of time
          waiting for I/O requests, such as keyboard or mouse operations. The
          scheduler must wake up such processes quickly on user request, or the
          user finds the environment unresponsive. The typical delay is
          approximately 100 ms. Office applications, text editors or image
          manipulation programs represent typical interactive processes.
        </p></li><li class="listitem"><p>
          <span class="emphasis"><em>Batch</em></span> processes often run in the background and
          do not need to be responsive. They receive lower priority from the
          scheduler. Multimedia converters, database search engines, or log
          files analyzers are typical examples of batch processes.
        </p></li><li class="listitem"><p>
          <span class="emphasis"><em>Real-time</em></span> processes must never be blocked by
          low-priority processes, and the scheduler guarantees a short response
          time to them. Applications for editing multimedia content are a good
          example here.
        </p></li></ul></div></section><section class="sect1" id="sec-tuning-taskscheduler-cfs" data-id-title="Completely Fair Scheduler"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.3 </span><span class="title-name">Completely Fair Scheduler</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-cfs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Since the Linux kernel version 2.6.23, a new approach has been taken to
      the scheduling of runnable processes. Completely Fair Scheduler (CFS)
      became the default Linux kernel scheduler. Since then, important changes
      and improvements have been made. The information in this chapter applies
      to <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> with kernel version 2.6.32 and higher (including 3.x
      kernels). The scheduler environment was divided into several parts, and
      three main new features were introduced:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.3.7.3.1"><span class="term">Modular scheduler core</span></dt><dd><p>
            The core of the scheduler was enhanced with <span class="emphasis"><em>scheduling
            classes</em></span>. These classes are modular and represent
            scheduling policies.
          </p></dd><dt id="id-1.8.7.3.7.3.2"><span class="term">Completely Fair Scheduler</span></dt><dd><p>
            Introduced in kernel 2.6.23 and extended in 2.6.24, CFS tries to
            assure that each process obtains its <span class="quote">“<span class="quote">fair</span>”</span> share of
            the processor time.
          </p></dd><dt id="id-1.8.7.3.7.3.3"><span class="term">Group scheduling</span></dt><dd><p>
            For example, if you split processes into groups according to which
            user is running them, CFS tries to provide each of these groups
            with the same amount of processor time.
          </p></dd></dl></div><p>
      As a result, CFS brings optimized scheduling for both servers and
      desktops.
    </p><section class="sect2" id="sec-tuning-taskscheduler-cfs-howitworks" data-id-title="How CFS works"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.3.1 </span><span class="title-name">How CFS works</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-cfs-howitworks">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        CFS tries to guarantee a fair approach to each runnable task. To find
        the most balanced way of task scheduling, it uses the concept of
        <span class="emphasis"><em>red-black tree</em></span>. A red-black tree is a type of
        self-balancing data search tree which provides inserting and removing
        entries in a reasonable way so that it remains well balanced.
      </p><p>
        When CFS schedules a task it accumulates <span class="quote">“<span class="quote">virtual runtime</span>”</span>
        or <span class="emphasis"><em>vruntime</em></span>. The next task picked to run is always
        the task with the minimum accumulated vruntime so far. By balancing the
        red-black tree when tasks are inserted into the <span class="emphasis"><em>run
        queue</em></span> (a planned time line of processes to be executed
        next), the task with the minimum vruntime is always the first entry in
        the red-black tree.
      </p><p>
        The amount of vruntime a task accrues is related to its priority. High
        priority tasks gain vruntime at a slower rate than low priority tasks,
        which results in high priority tasks being picked to run on the
        processor more often.
      </p></section><section class="sect2" id="sec-tuning-taskscheduler-cfs-grouping" data-id-title="Grouping processes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.3.2 </span><span class="title-name">Grouping processes</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-cfs-grouping">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        Since the Linux kernel version 2.6.24, CFS can be tuned to be fair to
        groups rather than to tasks only. Runnable tasks are then grouped to
        form entities, and CFS tries to be fair to these entities instead of
        individual runnable tasks. The scheduler also tries to be fair to
        individual tasks within these entities.
      </p><p>
        The kernel scheduler lets you group runnable tasks using control
        groups. For more information, see <a class="xref" href="#cha-tuning-cgroups" title="Chapter 10. Kernel control groups">Chapter 10, <em>Kernel control groups</em></a>.
      </p></section><section class="sect2" id="sec-tuning-taskscheduler-cfs-kernelconfig" data-id-title="Kernel configuration options"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.3.3 </span><span class="title-name">Kernel configuration options</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-cfs-kernelconfig">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        Basic aspects of the task scheduler behavior can be set through the
        kernel configuration options. Setting these options is part of the
        kernel compilation process. Because kernel compilation process is a
        complex task and out of this document's scope, refer to relevant source
        of information.
      </p><div id="id-1.8.7.3.7.7.3" data-id-title="Kernel compilation" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Kernel compilation</div><p>
          If you run <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> on a kernel that was not shipped with it,
          for example on a self-compiled kernel, you lose the entire support
          entitlement.
        </p></div></section><section class="sect2" id="sec-tuning-taskscheduler-cfs-terms" data-id-title="Terminology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.3.4 </span><span class="title-name">Terminology</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-cfs-terms">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        Documents regarding task scheduling policy often use several technical
        terms which you need to know to understand the information correctly. A
        few of them are as follows:
      </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.3.7.8.3.1"><span class="term">Latency</span></dt><dd><p>
              Delay between the time a process is scheduled to run and the
              actual process execution.
            </p></dd><dt id="id-1.8.7.3.7.8.3.2"><span class="term">Granularity</span></dt><dd><p>
              The relation between granularity and latency can be expressed by
              the following equation:
            </p><div class="verbatim-wrap"><pre class="screen">gran = ( lat / rtasks ) - ( lat / rtasks / rtasks )</pre></div><p>
              where <span class="emphasis"><em>gran</em></span> stands for granularity,
              <span class="emphasis"><em>lat</em></span> stand for latency, and
              <span class="emphasis"><em>rtasks</em></span> is the number of running tasks.
            </p></dd></dl></div><section class="sect3" id="kernel-tasksched-policies" data-id-title="Scheduling policies"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">14.3.4.1 </span><span class="title-name">Scheduling policies</span></span> <a title="Permalink" class="permalink" href="#kernel-tasksched-policies">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          The Linux kernel supports the following scheduling policies:
        </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.3.7.8.4.3.1"><span class="term">SCHED_FIFO</span></dt><dd><p>
                Scheduling policy designed for special time-critical
                applications. It uses the First In-First Out scheduling
                algorithm.
              </p></dd><dt id="id-1.8.7.3.7.8.4.3.2"><span class="term">SCHED_BATCH</span></dt><dd><p>
                Scheduling policy designed for CPU-intensive tasks.
              </p></dd><dt id="id-1.8.7.3.7.8.4.3.3"><span class="term">SCHED_IDLE</span></dt><dd><p>
                Scheduling policy intended for <span class="emphasis"><em>very</em></span>
                low-priority tasks.
              </p></dd><dt id="id-1.8.7.3.7.8.4.3.4"><span class="term">SCHED_OTHER</span></dt><dd><p>
                Default Linux time-sharing scheduling policy used by most of
                the processes.
              </p></dd><dt id="id-1.8.7.3.7.8.4.3.5"><span class="term">SCHED_RR</span></dt><dd><p>
                Similar to <code class="systemitem">SCHED_FIFO</code>, but uses the
                Round Robin scheduling algorithm.
              </p></dd></dl></div></section></section><section class="sect2" id="sec-tuning-taskscheduler-cfs-chrt" data-id-title="Changing real-time attributes of processes with chrt"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.3.5 </span><span class="title-name">Changing real-time attributes of processes with <code class="command">chrt</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-cfs-chrt">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The <code class="command">chrt</code> command sets or retrieves the real-time
        scheduling attributes of a running process, or runs a command with the
        specified attributes. You can get or retrieve both the scheduling
        policy and priority of a process.
      </p><p>
        In the following examples, a process whose PID is 16244 is used.
      </p><p>
        To <span class="emphasis"><em>retrieve</em></span> the real-time attributes of an
        existing task:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>chrt -p 16244
pid 16244's current scheduling policy: SCHED_OTHER
pid 16244's current scheduling priority: 0</pre></div><p>
        Before setting a new scheduling policy on the process, you need to find
        out the minimum and maximum valid priorities for each scheduling
        algorithm:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>chrt -m
SCHED_SCHED_OTHER min/max priority : 0/0
SCHED_SCHED_FIFO min/max priority : 1/99
SCHED_SCHED_RR min/max priority : 1/99
SCHED_SCHED_BATCH min/max priority : 0/0
SCHED_SCHED_IDLE min/max priority : 0/0</pre></div><p>
        In the above example, SCHED_OTHER, SCHED_BATCH, SCHED_IDLE polices only
        allow for priority 0, while that of SCHED_FIFO and SCHED_RR can range
        from 1 to 99.
      </p><p>
        To set SCHED_BATCH scheduling policy:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>chrt -b -p 0 16244
pid 16244's current scheduling policy: SCHED_BATCH
pid 16244's current scheduling priority: 0</pre></div><p>
        For more information on <code class="command">chrt</code>, see its man page
        (<code class="command">man 1 chrt</code>).
      </p></section><section class="sect2" id="sec-tuning-taskscheduler-cfs-tuning" data-id-title="Runtime tuning with sysctl"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.3.6 </span><span class="title-name">Runtime tuning with <code class="command">sysctl</code></span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-cfs-tuning">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The <code class="command">sysctl</code> interface for examining and changing
        kernel parameters at runtime introduces important variables, using
        which you can change the default behavior of the task scheduler. The
        syntax of the <code class="command">sysctl</code> is simple, and all the
        following commands must be entered on the command line as <code class="systemitem">root</code>.
      </p><p>
        To read a value from a kernel variable, enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">sysctl <em class="replaceable">VARIABLE</em></code></pre></div><p>
        To assign a value, enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">sysctl <em class="replaceable">VARIABLE</em>=<em class="replaceable">VALUE</em></code></pre></div><p>
        To get a list of all scheduler-related variables, run the
        <code class="command">sysctl</code> command, and use <code class="command">grep</code> to
        filter the output:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">sysctl -A | grep "sched" | grep -v "domain"</code>
kernel.sched_cfs_bandwidth_slice_us = 5000
kernel.sched_child_runs_first = 0
kernel.sched_compat_yield = 0
kernel.sched_latency_ns = 24000000
kernel.sched_migration_cost_ns = 500000
kernel.sched_min_granularity_ns = 8000000
kernel.sched_nr_migrate = 32
kernel.sched_rr_timeslice_ms = 25
kernel.sched_rt_period_us = 1000000
kernel.sched_rt_runtime_us = 950000
kernel.sched_schedstats = 0
kernel.sched_shares_window_ns = 10000000
kernel.sched_time_avg_ms = 1000
kernel.sched_tunable_scaling = 1
kernel.sched_wakeup_granularity_ns = 10000000</pre></div><p>
        Variables ending with <span class="quote">“<span class="quote">_ns</span>”</span> and <span class="quote">“<span class="quote">_us</span>”</span> accept
        values in nanoseconds and microseconds, respectively.
      </p><p>
        A list of the most important task scheduler <code class="command">sysctl</code>
        tuning variables (located at <code class="filename">/proc/sys/kernel/</code>)
        with a short description follows:
      </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.3.7.10.11.1"><span class="term"><code class="systemitem">sched_cfs_bandwidth_slice_us</code></span></dt><dd><p>
              When CFS bandwidth control is in use, this parameter controls the
              amount of runtime (bandwidth) transferred to a run queue from the
              task's control group bandwidth pool. Small values allow the
              global bandwidth to be shared in a fine-grained manner among
              tasks, larger values reduce transfer overhead. See
              <a class="link" href="https://www.kernel.org/doc/Documentation/scheduler/sched-bwc.txt" target="_blank">https://www.kernel.org/doc/Documentation/scheduler/sched-bwc.txt</a>.
            </p></dd><dt id="id-1.8.7.3.7.10.11.2"><span class="term"><code class="systemitem">sched_child_runs_first</code></span></dt><dd><p>
              A freshly forked child runs before the parent continues
              execution. Setting this parameter to <code class="literal">1</code> is
              beneficial for an application in which the child performs an
              execution after fork.
            </p></dd><dt id="id-1.8.7.3.7.10.11.3"><span class="term"><code class="systemitem">sched_compat_yield</code></span></dt><dd><p>
              Enables the aggressive CPU yielding behavior of the old
              <span class="emphasis"><em>O(1)</em></span> scheduler by moving the relinquishing
              task to the end of the runnable queue (right-most position in the
              red-black tree). Applications that depend on the
              <code class="option">sched_yield(2)</code> syscall behavior may see
              performance improvements by giving other processes a chance to
              run when there are highly contended resources (such as locks).
              Given that this call occurs in context switching, misusing the
              call can hurt the workload. Use it only when you see a drop in
              performance. The default value is <code class="literal">0</code>.
            </p></dd><dt id="id-1.8.7.3.7.10.11.4"><span class="term"><code class="systemitem">sched_migration_cost_ns</code></span></dt><dd><p>
              Amount of time after the last execution that a task is considered
              to be <span class="quote">“<span class="quote">cache hot</span>”</span> in migration decisions. A
              <span class="quote">“<span class="quote">hot</span>”</span> task has fewer chances of migration to another
              CPU, so increasing this variable reduces task migrations. The
              default value is <code class="literal">500000</code> (ns).
            </p><p>
              If the CPU idle time is higher than expected when there are
              runnable processes, try reducing this value. If tasks bounce
              between CPUs or nodes too often, try increasing it.
            </p></dd><dt id="id-1.8.7.3.7.10.11.5"><span class="term"><code class="systemitem">sched_latency_ns</code></span></dt><dd><p>
              Targeted preemption latency for CPU bound tasks. Increasing this
              variable increases a CPU bound task's timeslice. A task's
              timeslice is its weighted fair share of the scheduling period:
            </p><p>
              timeslice = scheduling period * (task's weight/total weight of
              tasks in the run queue)
            </p><p>
              The task's weight depends on the task's nice level and the
              scheduling policy. Minimum task weight for a SCHED_OTHER task is
              15, corresponding to nice 19. The maximum task weight is 88761,
              corresponding to nice -20.
            </p><p>
              Timeslices become smaller as the load increases. When the number
              of runnable tasks exceeds
              <code class="systemitem">sched_latency_ns</code>/<code class="systemitem">sched_min_granularity_ns</code>,
              the slice becomes number_of_running_tasks *
              <code class="systemitem">sched_min_granularity_ns</code>. Before that,
              the slice is equal to <code class="systemitem">sched_latency_ns</code>.
            </p><p>
              This value also specifies the maximum amount of time during which
              a sleeping task is considered to be running for entitlement
              calculations. Increasing this variable increases the amount of
              time a waking task may consume before being preempted, thus
              increasing scheduler latency for CPU bound tasks. The default
              value is <code class="literal">6000000</code> (ns).
            </p></dd><dt id="id-1.8.7.3.7.10.11.6"><span class="term"><code class="systemitem">sched_min_granularity_ns</code></span></dt><dd><p>
              Minimal preemption granularity for CPU bound tasks. See
              <code class="systemitem">sched_latency_ns</code> for details. The
              default value is <code class="literal">4000000</code> (ns).
            </p></dd><dt id="id-1.8.7.3.7.10.11.7"><span class="term"><code class="systemitem">sched_wakeup_granularity_ns</code></span></dt><dd><p>
              The wake-up preemption granularity. Increasing this variable
              reduces wake-up preemption, reducing disturbance of compute bound
              tasks. Lowering it improves wake-up latency and throughput for
              latency critical tasks, particularly when a short duty cycle load
              component must compete with CPU bound components. The default
              value is <code class="literal">2500000</code> (ns).
            </p><div id="id-1.8.7.3.7.10.11.7.2.2" data-id-title="Setting the right wake-up granularity value" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Setting the right wake-up granularity value</div><p>
                Settings larger than half of
                <code class="systemitem">sched_latency_ns</code> result in no wake-up
                preemption. Short duty cycle tasks cannot compete with CPU hogs
                effectively.
              </p></div></dd><dt id="id-1.8.7.3.7.10.11.8"><span class="term"><code class="systemitem">sched_rr_timeslice_ms</code></span></dt><dd><p>
              Quantum that SCHED_RR tasks are allowed to run before they are
              preempted and put to the end of the task list.
            </p></dd><dt id="id-1.8.7.3.7.10.11.9"><span class="term"><code class="systemitem">sched_rt_period_us</code></span></dt><dd><p>
              Period over which real-time task bandwidth enforcement is
              measured. The default value is <code class="literal">1000000</code> (µs).
            </p></dd><dt id="id-1.8.7.3.7.10.11.10"><span class="term"><code class="systemitem">sched_rt_runtime_us</code></span></dt><dd><p>
              Quantum allocated to real-time tasks during sched_rt_period_us.
              Setting to -1 disables RT bandwidth enforcement. By default, RT
              tasks may consume 95%CPU/sec, thus leaving 5%CPU/sec or 0.05 s to
              be used by SCHED_OTHER tasks. The default value is
              <code class="literal">950000</code> (µs).
            </p></dd><dt id="id-1.8.7.3.7.10.11.11"><span class="term"><code class="systemitem">sched_nr_migrate</code></span></dt><dd><p>
              Controls how many tasks can be migrated across processors for
              load-balancing purposes. Because balancing iterates the runqueue
              with interrupts disabled (softirq), it can incur in irq-latency
              penalties for real-time tasks. Therefore, increasing this value
              may give a performance boost to large SCHED_OTHER threads at the
              expense of increased irq-latencies for real-time tasks. The
              default value is <code class="literal">32</code>.
            </p></dd><dt id="id-1.8.7.3.7.10.11.12"><span class="term"><code class="systemitem">sched_time_avg_ms</code></span></dt><dd><p>
              This parameter sets the period over which the time spent running
              real-time tasks is averaged. That average assists CFS in making
              load-balancing decisions and gives an indication of how busy a
              CPU is with high-priority real-time tasks.
            </p><p>
              The optimal setting for this parameter is highly workload
              dependent and depends, among other things, on how frequently
              real-time tasks are running and for how long.
            </p></dd></dl></div><div id="id-1.8.7.3.7.10.12" data-id-title="A few scheduler parameters have been moved to debugfs" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: A few scheduler parameters have been moved to <code class="systemitem">debugfs</code></div><p>
          If the default Linux kernel version of your operating system is 5.13
          or later (which can be checked using the command <code class="code">rpm -q
          kernel-default</code>), you might notice messages in the kernel
          logs that are similar to the following example:
        </p><div class="verbatim-wrap"><pre class="screen">[ 20.485624] The sched.sched_min_granularity_ns sysctl was moved to debugfs in kernel 5.13 for CPU scheduler debugging only. This sysctl will be removed in a future SLE release.
[ 20.485632] The sched.sched_wakeup_granularity_ns sysctl was moved to debugfs in kernel 5.13 for CPU scheduler debugging only. This sysctl will be removed in a future SLE release.</pre></div><p>
          This happens because six scheduler parameters have been moved from
          <code class="filename">/proc/sys/kernel/sched_*</code> to
          <code class="filename">/sys/kernel/debug/sched/*</code>. The affected
          scheduler parameters are as follows:
        </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
              <code class="systemitem">sched_latency_ns</code>
            </p></li><li class="listitem"><p>
              <code class="systemitem">sched_migration_cost_ns</code>
            </p></li><li class="listitem"><p>
              <code class="systemitem">sched_min_granularity_ns</code>
            </p></li><li class="listitem"><p>
              <code class="systemitem">sched_nr_migrate</code>
            </p></li><li class="listitem"><p>
              <code class="systemitem">sched_tunable_scaling</code>
            </p></li><li class="listitem"><p>
              <code class="systemitem">sched_wakeup_granularity_n</code>
            </p></li></ul></div><p>
          For temporary convenience, the <code class="systemitem">sysctl</code> for
          these scheduler parameters still exists in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. However,
          due to planned changes in the CPU scheduler implementation, there is
          no guarantee that either the <code class="systemitem">sysctl</code> or the
          <code class="systemitem">debugfs</code> options will exist in a future
          release of <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>.
        </p><p>
          If any of your current system tuning configurations depend on these
          six scheduler parameters, we strongly recommend that you find an
          alternate method of achieving your objective and stop depending on
          them for production workloads.
        </p></div></section><section class="sect2" id="sec-tuning-taskscheduler-cfs-debug" data-id-title="Debugging interface and scheduler statistics"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.3.7 </span><span class="title-name">Debugging interface and scheduler statistics</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-taskscheduler-cfs-debug">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        CFS comes with a new improved debugging interface, and provides runtime
        statistics information. Relevant files were added to the
        <code class="filename">/proc</code> file system, which can be examined simply
        with the <code class="command">cat</code> or <code class="command">less</code> command. A
        list of the related <code class="filename">/proc</code> files follows with their
        short description:
      </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.3.7.11.3.1"><span class="term"><code class="filename">/proc/sched_debug</code></span></dt><dd><p>
              Contains the current values of all tunable variables (see
              <a class="xref" href="#sec-tuning-taskscheduler-cfs-tuning" title="14.3.6. Runtime tuning with sysctl">Section 14.3.6, “Runtime tuning with <code class="command">sysctl</code>”</a>)
              that affect the task scheduler behavior, CFS statistics, and
              information about the run queues (CFS, RT and deadline) on all
              available processors. A summary of the task running on each
              processor is also shown, with the task name and PID, along with
              scheduler specific statistics. The first being the
              <code class="option">tree-key</code> column, it indicates the task's virtual
              runtime, and its name comes from the kernel sorting all runnable
              tasks by this key in a red-black tree. The
              <code class="option">switches</code> column indicates the total number of
              switches (involuntary or not), and the <code class="option">prio</code>
              refers to the process priority. The <code class="option">wait-time</code>
              value indicates the amount of time the task waited to be
              scheduled. Finally both <code class="option">sum-exec</code> and
              <code class="option">sum-sleep</code> account for the total amount of time
              (in nanoseconds) the task was running on the processor or asleep,
              respectively.
            </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cat /proc/sched_debug
Sched Debug Version: v0.11, 6.4.0-150600.9-default #1
ktime                                   : 23533900.395978
sched_clk                               : 23543587.726648
cpu_clk                                 : 23533900.396165
jiffies                                 : 4300775771
sched_clock_stable                      : 0

sysctl_sched
  .sysctl_sched_latency                    : 6.000000
  .sysctl_sched_min_granularity            : 2.000000
  .sysctl_sched_wakeup_granularity         : 2.500000
  .sysctl_sched_child_runs_first           : 0
  .sysctl_sched_features                   : 154871
  .sysctl_sched_tunable_scaling            : 1 (logarithmic)

cpu#0, 2666.762 MHz
  .nr_running                    : 1
  .load                          : 1024
  .nr_switches                   : 1918946
[...]

cfs_rq[0]:/
  .exec_clock                    : 170176.383770
  .MIN_vruntime                  : 0.000001
  .min_vruntime                  : 347375.854324
  .max_vruntime                  : 0.000001
[...]

rt_rq[0]:/
  .rt_nr_running                 : 0
  .rt_throttled                  : 0
  .rt_time                       : 0.000000
  .rt_runtime                    : 950.000000

dl_rq[0]:
  .dl_nr_running                 : 0

  task   PID         tree-key  switches  prio     wait-time        [...]
------------------------------------------------------------------------
R  cc1 63477     98876.717832       197   120      0.000000         ...</pre></div></dd><dt id="id-1.8.7.3.7.11.3.2"><span class="term"><code class="filename">/proc/schedstat</code></span></dt><dd><p>
              Displays statistics relevant to the current run queue. Also
              domain-specific statistics for SMP systems are displayed for all
              connected processors. Because the output format is not
              user-friendly, read the contents of
              <code class="filename">/usr/src/linux/Documentation/scheduler/sched-stats.txt</code>
              for more information.
            </p></dd><dt id="id-1.8.7.3.7.11.3.3"><span class="term"><code class="filename">/proc/<em class="replaceable">PID</em>/sched</code></span></dt><dd><p>
              Displays scheduling information on the process with id
              <em class="replaceable">PID</em>.
            </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cat /proc/$(pidof gdm)/sched
gdm (744, #threads: 3)
-------------------------------------------------------------------
se.exec_start                                :          8888.758381
se.vruntime                                  :          6062.853815
se.sum_exec_runtime                          :             7.836043
se.statistics.wait_start                     :             0.000000
se.statistics.sleep_start                    :          8888.758381
se.statistics.block_start                    :             0.000000
se.statistics.sleep_max                      :          1965.987638
[...]
se.avg.decay_count                           :                 8477
policy                                       :                    0
prio                                         :                  120
clock-delta                                  :                  128
mm-&gt;numa_scan_seq                            :                    0
numa_migrations, 0
numa_faults_memory, 0, 0, 1, 0, -1
numa_faults_memory, 1, 0, 0, 0, -1</pre></div></dd></dl></div></section></section><section class="sect1" id="cha-tuning-taskscheduler-moreinfo" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.4 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-taskscheduler-moreinfo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_taskscheduler.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To get a compact knowledge about Linux kernel task scheduling, you need
      to explore several information sources. Here are some:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          For task scheduler System Calls description, see the relevant manual
          page (for example <code class="command">man 2 sched_setaffinity</code>).
        </p></li><li class="listitem"><p>
          A useful lecture on Linux scheduler policy and algorithm is available
          in
          <a class="link" href="https://www.inf.fu-berlin.de/lehre/SS01/OS/Lectures/Lecture08.pdf" target="_blank">https://www.inf.fu-berlin.de/lehre/SS01/OS/Lectures/Lecture08.pdf</a>.
        </p></li><li class="listitem"><p>
          A good overview of Linux process scheduling is given in
          <em class="citetitle">Linux Kernel Development</em> by Robert Love
          (ISBN-10: 0-672-32512-8). See
          <a class="link" href="https://www.informit.com/articles/article.aspx?p=101760" target="_blank">https://www.informit.com/articles/article.aspx?p=101760</a>.
        </p></li><li class="listitem"><p>
          A comprehensive overview of the Linux kernel internals is given in
          <em class="citetitle">Understanding the Linux Kernel</em> by Daniel P.
          Bovet and Marco Cesati (ISBN 978-0-596-00565-8).
        </p></li><li class="listitem"><p>
          Technical information about task scheduler is covered in files under
          <code class="filename">/usr/src/linux/Documentation/scheduler</code>.
        </p></li></ul></div></section></section><section class="chapter" id="cha-tuning-memory" data-id-title="Tuning the memory management subsystem"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">15 </span><span class="title-name">Tuning the memory management subsystem</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  To understand and tune the memory management behavior of the
  kernel, it is important to first have an overview of how it works and
  cooperates with other subsystems.
 </p><p>
  
  The memory management subsystem, also called the virtual memory manager,
  will subsequently be called <span class="quote">“<span class="quote">VM</span>”</span>. The role of the VM
  is to manage the allocation of physical memory (RAM) for the entire kernel
  and user programs. It is also responsible for providing a virtual memory
  environment for user processes (managed via POSIX APIs with Linux
  extensions). Finally, the VM frees up RAM when there
  is a shortage, either by trimming caches or swapping out
  <span class="quote">“<span class="quote">anonymous</span>”</span> memory.
 </p><p>
  The most important thing to understand when examining and tuning VM is how
  its caches are managed. The basic goal of the VM's caches is to minimize
  the cost of I/O as generated by swapping and file system operations
  (including network file systems). This is achieved by avoiding I/O or by submitting I/O in better patterns.
 </p><p>
  Free memory is used and filled up by these caches as required. The
  more memory is available for caches and anonymous memory, the more
  effectively the caches and swapping operate. However, if a memory
  shortage is encountered, the caches are trimmed or the memory is swapped
  out.
 </p><p>
  For a particular workload, the first thing that can be done to improve
  performance is to increase memory and reduce the frequency that memory
  must be trimmed or swapped. The second thing is to change the way caches
  are managed by changing kernel parameters.
 </p><p>
  Finally, the workload itself should be examined and tuned as well. If an
  application is allowed to run more processes or threads, effectiveness of
  VM caches can be reduced, if each process is operating in its own area of
  the file system. Memory overheads are also increased. If applications
  allocate their own buffers or caches, larger caches mean that less
  memory is available for VM caches. However, more processes and threads can
  mean more opportunity to overlap and pipeline I/O, and may take better
  advantage of multiple cores. Experimentation is required for the best
  results.
 </p><section class="sect1" id="cha-tuning-memory-usage" data-id-title="Memory usage"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.1 </span><span class="title-name">Memory usage</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-usage">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Memory allocations can be characterized as
   <span class="quote">“<span class="quote">pinned</span>”</span> (also known as <span class="quote">“<span class="quote">unreclaimable</span>”</span>),
   <span class="quote">“<span class="quote">reclaimable</span>”</span> or <span class="quote">“<span class="quote">swappable</span>”</span>.
  </p><section class="sect2" id="cha-tuning-memory-usage-anonymous" data-id-title="Anonymous memory"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.1 </span><span class="title-name">Anonymous memory</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-usage-anonymous">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Anonymous memory tends to be program heap and stack memory (for example,
    <code class="literal">&gt;malloc()</code>). It is reclaimable, except in special
    cases such as <code class="literal">mlock</code> or if there is no available swap
    space. Anonymous memory must be written to swap before it can be
    reclaimed. Swap I/O (both swapping in and swapping out pages) tends to
    be less efficient than pagecache I/O, because of allocation and access
    patterns.
   </p></section><section class="sect2" id="cha-tuning-memory-usage-pagecache" data-id-title="Pagecache"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.2 </span><span class="title-name">Pagecache</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-usage-pagecache">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A cache of file data. When a file is read from disk or network, the
    contents are stored in pagecache. No disk or network access is required,
    if the contents are up-to-date in pagecache. tmpfs and shared memory
    segments count toward pagecache.
   </p><p>
    When a file is written to, the new data is stored in pagecache before
    being written back to a disk or the network (making it a write-back
    cache). When a page has new data not written back yet, it is called
    <span class="quote">“<span class="quote">dirty</span>”</span>. Pages not classified as dirty are
    <span class="quote">“<span class="quote">clean</span>”</span>. Clean pagecache pages can be reclaimed if there is
    a memory shortage by simply freeing them. Dirty pages must first be made
    clean before being reclaimed.
   </p></section><section class="sect2" id="cha-tuning-memory-usage-buffercache" data-id-title="Buffercache"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.3 </span><span class="title-name">Buffercache</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-usage-buffercache">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This is a type of pagecache for block devices (for example, /dev/sda). A
    file system typically uses the buffercache when accessing its on-disk
    metadata structures such as inode tables, allocation bitmaps, and so
    forth. Buffercache can be reclaimed similarly to pagecache.
   </p></section><section class="sect2" id="cha-tuning-memory-usage-bufferheads" data-id-title="Buffer heads"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.4 </span><span class="title-name">Buffer heads</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-usage-bufferheads">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Buffer heads are small auxiliary structures that tend to be allocated
    upon pagecache access. They can generally be reclaimed easily when the
    pagecache or buffercache pages are clean.
   </p></section><section class="sect2" id="cha-tuning-memory-usage-writeback" data-id-title="Writeback"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.5 </span><span class="title-name">Writeback</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-usage-writeback">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As applications write to files, the pagecache becomes dirty
    and the buffercache may become dirty. When the amount of
    dirty memory reaches a specified number of pages in bytes
    (<span class="emphasis"><em>vm.dirty_background_bytes</em></span>), or when the
    amount of dirty memory reaches a specific ratio to total memory
    (<span class="emphasis"><em>vm.dirty_background_ratio</em></span>), or when the pages
    have been dirty for longer than a specified amount of time
    (<span class="emphasis"><em>vm.dirty_expire_centisecs</em></span>), the kernel begins
    writeback of pages starting with files that had the pages dirtied first.
    The background bytes and ratios are mutually exclusive and setting one
    will overwrite the other. Flusher threads perform writeback in the
    background and allow applications to continue running. If the I/O
    cannot keep up with applications dirtying pagecache, and dirty data
    reaches a critical setting (<span class="emphasis"><em>vm.dirty_bytes</em></span> or
    <span class="emphasis"><em>vm.dirty_ratio</em></span>), then applications begin to be
    throttled to prevent dirty data exceeding this threshold.
   </p></section><section class="sect2" id="cha-tuning-memory-usage-readahead" data-id-title="Readahead"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.6 </span><span class="title-name">Readahead</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-usage-readahead">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The VM monitors file access patterns and may attempt to perform
    readahead. Readahead reads pages into the pagecache from the file system
    that have not been requested yet. It is done to allow fewer,
    larger I/O requests to be submitted (more efficient). And for I/O to be
    pipelined (I/O performed at the same time as the application is
    running).
   </p></section><section class="sect2" id="cha-tuning-memory-usage-vfs" data-id-title="VFS caches"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.1.7 </span><span class="title-name">VFS caches</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-usage-vfs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect3" id="cha-tuning-memory-usage-vfs-inode" data-id-title="Inode cache"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.1.7.1 </span><span class="title-name">Inode cache</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-usage-vfs-inode">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This is an in-memory cache of the inode structures for each file
     system. These contain attributes such as the file size, permissions and
     ownership, and pointers to the file data.
    </p></section><section class="sect3" id="cha-tuning-memory-usage-vfs-dir-entry" data-id-title="Directory entry cache"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.1.7.2 </span><span class="title-name">Directory entry cache</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-usage-vfs-dir-entry">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This is an in-memory cache of the directory entries in the system.
     These contain a name (the name of a file), the inode which it refers
     to, and children entries. This cache is used when traversing the
     directory structure and accessing a file by name.
    </p></section></section></section><section class="sect1" id="cha-tuning-memory-optimize" data-id-title="Reducing memory usage"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.2 </span><span class="title-name">Reducing memory usage</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-optimize">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="cha-tuning-memory-optimize-malloc" data-id-title="Reducing malloc (anonymous) usage"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.2.1 </span><span class="title-name">Reducing malloc (anonymous) usage</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-optimize-malloc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Applications running on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP6</span></span> can allocate
    more memory compared to older releases. This is because of
    <code class="systemitem">glibc</code> changing its default
    behavior while allocating user space memory. See
    <a class="link" href="https://www.gnu.org/s/libc/manual/html_node/Malloc-Tunable-Parameters.html" target="_blank">https://www.gnu.org/s/libc/manual/html_node/Malloc-Tunable-Parameters.html</a>
    for explanation of these parameters.
   </p><p>
    To restore behavior similar to older releases, M_MMAP_THRESHOLD should
    be set to 128*1024. This can be done with mallopt() call from the
    application, or via setting <code class="varname">MALLOC_MMAP_THRESHOLD_</code>
    environment variable before running the application.
   </p></section><section class="sect2" id="cha-tuning-memory-optimize-overhead" data-id-title="Reducing kernel memory overheads"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.2.2 </span><span class="title-name">Reducing kernel memory overheads</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-optimize-overhead">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Kernel memory that is reclaimable (caches, described above) is
    trimmed automatically during memory shortages. Most other kernel memory
    cannot be easily reduced but is a property of the workload given to the
    kernel.
   </p><p>
    Reducing the requirements of the user space workload reduces the
    kernel memory usage (fewer processes, fewer open files and sockets,
    etc.).
   </p></section><section class="sect2" id="cha-tuning-memory-optimize-cgoups" data-id-title="Memory controller (memory cgroups)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.2.3 </span><span class="title-name">Memory controller (memory cgroups)</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-optimize-cgoups">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If the memory cgroups feature is not needed, it can be switched off by
    passing cgroup_disable=memory on the kernel command line, reducing
    memory consumption of the kernel a bit. There is also a slight
    performance benefit as there is a small amount of accounting overhead
    when memory cgroups are available even if none are configured.
   </p></section></section><section class="sect1" id="cha-tuning-memory-vm" data-id-title="Virtual memory manager (VM) tunable parameters"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.3 </span><span class="title-name">Virtual memory manager (VM) tunable parameters</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-vm">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When tuning the VM, it should be understood that certain changes take time to affect the workload and take full effect. If the workload
   changes throughout the day, it may behave differently at different
   times. A change that increases throughput under certain conditions may
   decrease it under other conditions.
  </p><section class="sect2" id="cha-tuning-memory-vm-reclaim" data-id-title="Reclaim ratios"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.3.1 </span><span class="title-name">Reclaim ratios</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-vm-reclaim">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.4.11.3.2.1"><span class="term"><code class="filename">/proc/sys/vm/swappiness</code>
     </span></dt><dd><p>
       This control is used to define how aggressively the kernel swaps out
       anonymous memory relative to pagecache and other caches. Increasing
       the value increases the amount of swapping. The default value is
       <code class="literal">60</code>.
      </p><p>
       Swap I/O tends to be much less efficient than other I/O. However,
       certain pagecache pages are accessed much more frequently than less
       used anonymous memory. The right balance should be found here.
      </p><p>
       If swap activity is observed during slowdowns, it may be worth
       reducing this parameter. If there is a lot of I/O activity and the
       amount of pagecache in the system is rather small, or if there are
       large dormant applications running, increasing this value can
       improve performance.
      </p><p>
       The more data is swapped out, the longer the system
       takes to swap data back in when it is needed.
      </p></dd><dt id="id-1.8.7.4.11.3.2.2"><span class="term"><code class="filename">/proc/sys/vm/vfs_cache_pressure</code>
     </span></dt><dd><p>
       This variable controls the tendency of the kernel to reclaim the
       memory which is used for caching of VFS caches, versus pagecache and
       swap. Increasing this value increases the rate at which VFS caches
       are reclaimed.
      </p><p>
       It is difficult to know when this should be changed, other than by
       experimentation. The <code class="command">slabtop</code> command (part of the
       package <code class="systemitem">procps</code>) shows top
       memory objects used by the kernel. The vfs caches are the "dentry"
       and the "*_inode_cache" objects. If these are consuming a large
       amount of memory in relation to pagecache, it may be worth trying to
       increase pressure. Could also help to reduce swapping. The default
       value is <code class="literal">100</code>.
      </p></dd><dt id="id-1.8.7.4.11.3.2.3"><span class="term"><code class="filename">/proc/sys/vm/min_free_kbytes</code>
     </span></dt><dd><p>
       This controls the amount of memory that is kept free for use by
       special reserves including <span class="quote">“<span class="quote">atomic</span>”</span> allocations (those
       which cannot wait for reclaim). This should not normally be lowered
       unless the system is being carefully tuned for memory usage
       (normally useful for embedded rather than server applications). If
       <span class="quote">“<span class="quote">page allocation failure</span>”</span> messages and stack traces are
       frequently seen in logs, min_free_kbytes could be increased until the
       errors disappear. There is no need for concern if these messages are infrequent. The default value depends on the amount of RAM.
      </p></dd><dt id="id-1.8.7.4.11.3.2.4"><span class="term"><code class="filename">/proc/sys/vm/watermark_scale_factor</code></span></dt><dd><p>
      Broadly speaking, free memory has high, low and min watermarks. When
      the low watermark is reached then <code class="command">kswapd</code> wakes to
      reclaim memory in the background. It stays awake until free memory
      reaches the high watermark. Applications will stall and reclaim
      memory when the min watermark is reached.
      </p><p>
      The <code class="literal">watermark_scale_factor</code> defines the amount
      of memory left in a node/system before kswapd is woken up and how
      much memory needs to be free before kswapd goes back to sleep.
      The unit is in fractions of 10,000. The default value of 10 means
      the distances between watermarks are 0.1% of the available memory
      in the node/system. The maximum value is 1000, or 10% of memory.
      </p><p>
      Workloads that frequently stall in direct reclaim, accounted by
      <code class="literal">allocstall</code> in <code class="filename">/proc/vmstat</code>,
      may benefit from altering this parameter. Similarly, if
      <code class="command">kswapd</code> is sleeping prematurely, as accounted for by
      <code class="literal">kswapd_low_wmark_hit_quickly</code>, then it may indicate
      that the number of pages kept free to avoid stalls is too low.
      </p></dd></dl></div></section><section class="sect2" id="cha-tuning-memory-vm-writeback" data-id-title="Writeback parameters"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.3.2 </span><span class="title-name">Writeback parameters</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-vm-writeback">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    One important change in writeback behavior since <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> 10 is
    that modification to file-backed mmap() memory is accounted immediately
    as dirty memory (and subject to writeback). Whereas previously it would
    only be subject to writeback after it was unmapped, upon an msync()
    system call, or under heavy memory pressure.
   </p><p>
    Some applications do not expect mmap modifications to be subject to such
    writeback behavior, and performance can be reduced. Increasing writeback
    ratios and times can improve this type of slowdown.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.4.11.4.4.1"><span class="term"><code class="filename">/proc/sys/vm/dirty_background_ratio</code>
     </span></dt><dd><p>
       This is the percentage of the total amount of free and reclaimable
       memory. When the amount of dirty pagecache exceeds this percentage,
       writeback threads start writing back dirty memory. The default value
       is <code class="literal">10</code> (%).
      </p></dd><dt id="id-1.8.7.4.11.4.4.2"><span class="term"><code class="filename">/proc/sys/vm/dirty_background_bytes</code>
     </span></dt><dd><p>
       This contains the amount of dirty memory at which
       the background kernel flusher threads start writeback.
       <code class="filename">dirty_background_bytes</code> is the counterpart of
       <code class="filename">dirty_background_ratio</code>. If one of them is set,
       the other one will automatically be read as <code class="literal">0</code>.
      </p></dd><dt id="id-1.8.7.4.11.4.4.3"><span class="term"><code class="filename">/proc/sys/vm/dirty_ratio</code>
     </span></dt><dd><p>
       Similar percentage value as for
       <code class="filename">dirty_background_ratio</code>. When this is exceeded,
       applications that want to write to the pagecache are blocked and
       wait for kernel background flusher threads to reduce the amount of dirty
       memory. The default value is <code class="literal">20</code> (%).
      </p></dd><dt id="id-1.8.7.4.11.4.4.4"><span class="term"><code class="filename">/proc/sys/vm/dirty_bytes</code>
     </span></dt><dd><p>
       This file controls the same tunable as <code class="filename">dirty_ratio</code>
       however the amount of dirty memory is in bytes as opposed to a
       percentage of reclaimable memory. Since both
       <code class="filename">dirty_ratio</code> and <code class="filename">dirty_bytes</code>
       control the same tunable, if one of them is set, the other one is
       automatically read as <code class="literal">0</code>. The minimum value allowed
       for <code class="filename">dirty_bytes</code> is two pages (in bytes); any value
       lower than this limit is ignored and the old configuration will be
       retained.
      </p></dd><dt id="id-1.8.7.4.11.4.4.5"><span class="term"><code class="filename">/proc/sys/vm/dirty_expire_centisecs</code>
     </span></dt><dd><p>
       The data which has been dirty in-memory for longer than this interval
       is written out next time a flusher thread wakes up. Expiration
       is measured based on the modification time of a file's inode.
       Therefore, multiple dirtied pages from the same file are all written when the interval is exceeded.
      </p></dd></dl></div><p>
    <code class="filename">dirty_background_ratio</code> and
    <code class="filename">dirty_ratio</code> together determine the pagecache
    writeback behavior. If these values are increased, more dirty memory is
    kept in the system for a longer time. With more dirty memory allowed in
    the system, the chance to improve throughput by avoiding writeback I/O
    and to submitting more optimal I/O patterns increases. However, more
    dirty memory can either harm latency when memory needs to be reclaimed
    or at points of data integrity (<span class="quote">“<span class="quote">synchronization points</span>”</span>) when it
    needs to be written back to disk.
   </p></section><section class="sect2" id="cha-tuning-memory-vm-writetiming" data-id-title="Timing differences of I/O writes between SUSE Linux Enterprise 12 and SUSE Linux Enterprise 11"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.3.3 </span><span class="title-name">Timing differences of I/O writes between SUSE Linux Enterprise 12 and SUSE Linux Enterprise 11</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-vm-writetiming">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The system is required to limit what percentage of the system's memory
    contains file-backed data that needs writing to disk. This guarantees
    that the system can always allocate the necessary data structures to
    complete I/O. The maximum amount of memory that can be dirty and
    requires writing at any time is controlled by
    <code class="literal">vm.dirty_ratio</code>
    (<code class="filename">/proc/sys/vm/dirty_ratio</code>). The defaults are:
   </p><div class="verbatim-wrap"><pre class="screen">SLE-11-SP3:     vm.dirty_ratio = 40
SLE-12:         vm.dirty_ratio = 20</pre></div><p>
    The primary advantage of using the lower ratio in SUSE Linux Enterprise 12 is that
    page reclamation and allocation in low memory situations completes
    faster as there is a higher probability that old clean pages are
    quickly found and discarded. The secondary advantage is that if all
    data on the system must be synchronized, then the time to complete the
    operation on SUSE Linux Enterprise 12 is lower than SUSE Linux Enterprise 11 SP3 by default.
    Most workloads will not notice this change as data is synchronized with
    <code class="literal">fsync()</code> by the application or data is not dirtied
    quickly enough to hit the limits.
   </p><p>
    There are exceptions, and if your application is affected by this, it
    can manifest as an unexpected stall during writes. To prove it is
    affected by dirty data rate limiting then monitor
    <code class="literal">/proc/<em class="replaceable">PID_OF_APPLICATION</em>/stack</code>
    and it will be observed that the application spends significant time in
    <code class="literal">balance_dirty_pages_ratelimited</code>. If this is observed
    and it is a problem, then increase the value of
    <code class="literal">vm.dirty_ratio</code> to 40 to restore the SUSE Linux Enterprise 11 SP3
    behavior.
   </p><div id="id-1.8.7.4.11.5.6" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
     The overall I/O throughput is the same regardless of the setting. The only difference is the
     timing of when the I/O is queued.
    </p></div><p>
    This is an example of using <code class="command">dd</code> to asynchronously
    write 30% of memory to disk which would happen to be affected by the
    change in <code class="literal">vm.dirty_ratio</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>MEMTOTAL_MBYTES=`free -m | grep Mem: | awk '{print $2}'`
<code class="prompt root"># </code>sysctl vm.dirty_ratio=40
<code class="prompt root"># </code>dd if=/dev/zero of=zerofile ibs=1048576 count=$((MEMTOTAL_MBYTES*30/100))
2507145216 bytes (2.5 GB) copied, 8.00153 s, 313 MB/s
<code class="prompt root"># </code>sysctl vm.dirty_ratio=20
dd if=/dev/zero of=zerofile ibs=1048576 count=$((MEMTOTAL_MBYTES*30/100))
2507145216 bytes (2.5 GB) copied, 10.1593 s, 247 MB/s</pre></div><p>
    The parameter affects the time it takes for the command to
    complete and the apparent write speed of the device. With
    <code class="literal">dirty_ratio=40</code>, more of the data is cached and
    written to disk in the background by the kernel. The speed of I/O is identical in both cases. To
    demonstrate, this is the result when <code class="command">dd</code> synchronizes
    the data before exiting:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>sysctl vm.dirty_ratio=40
<code class="prompt root"># </code>dd if=/dev/zero of=zerofile ibs=1048576 count=$((MEMTOTAL_MBYTES*30/100)) conv=fdatasync
2507145216 bytes (2.5 GB) copied, 21.0663 s, 119 MB/s
<code class="prompt root"># </code>sysctl vm.dirty_ratio=20
<code class="prompt root"># </code>dd if=/dev/zero of=zerofile ibs=1048576 count=$((MEMTOTAL_MBYTES*30/100)) conv=fdatasync
2507145216 bytes (2.5 GB) copied, 21.7286 s, 115 MB/s</pre></div><p>
    As observed, <code class="literal">dirty_ratio</code> had almost no impact here and
    is within the natural variability of a command. Hence,
    <code class="literal">dirty_ratio</code> does not directly impact I/O performance
    but it may affect the apparent performance of a workload that writes
    data asynchronously without synchronizing.
   </p></section><section class="sect2" id="cha-tuning-memory-vm-readahead" data-id-title="Readahead parameters"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.3.4 </span><span class="title-name">Readahead parameters</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-vm-readahead">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.4.11.6.2.1"><span class="term"><code class="filename">/sys/block/<em class="replaceable">&lt;bdev&gt;</em>/queue/read_ahead_kb</code>
     </span></dt><dd><p>
       If one or more processes are sequentially reading a file, the kernel
       reads certain data in advance (ahead) to reduce the amount of
       time that processes need to wait for data to be available. The actual
       amount of data being read in advance is computed dynamically, based
       on the extent of <span class="emphasis"><em>sequentiality</em></span> of the I/O. This parameter sets the
       maximum amount of data that the kernel reads ahead for a single file.
       If you observe that large sequential reads from a file are not fast
       enough, you can try increasing this value. Increasing it too far may
       result in readahead thrashing where pagecache used for readahead is
       reclaimed before it can be used, or slowdowns because of a large
       amount of useless I/O. The default value is <code class="literal">512</code>
       (KB).
      </p></dd></dl></div></section><section class="sect2" id="cha-tuning-memory-vm-thp" data-id-title="Transparent HugePage parameters"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.3.5 </span><span class="title-name">Transparent HugePage parameters</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-vm-thp">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Transparent HugePages (THP) provide a way to dynamically allocate huge
     pages either on‑demand by the process or deferring the allocation
     until later via the <code class="command">khugepaged</code> kernel thread. This
     method is distinct from the use of <code class="literal">hugetlbfs</code> to
     manually manage their allocation and use. Workloads with contiguous memory
     access patterns can benefit greatly from THP. A 1000-fold decrease in page
     faults can be observed when running synthetic workloads with contiguous
     memory access patterns.
   </p><p>
     There are cases when THP may be undesirable. Workloads with sparse memory
     access patterns can perform poorly with THP due to excessive memory
     usage. For example, 2 MB of memory may be used at fault time instead of 4
     KB for each fault and ultimately lead to premature page reclaim. <span class="phrase"> On releases older than SUSE Linux Enterprise 12 SP2, it was
     possible for an application to stall for long periods of time trying to
     allocate a THP which frequently led to a recommendation of disabling
     THP. Such recommendations should be re-evaluated for SUSE Linux Enterprise 12 SP3 and
     later releases.</span>
   </p><p>
     The behavior of THP may be configured via the
     <code class="option">transparent_hugepage=</code> kernel parameter or via
     sysfs. For example, it may be disabled by adding the kernel parameter
     <code class="option">transparent_hugepage=never</code>, rebuilding your grub2
     configuration, and rebooting. Verify if THP is disabled with:

    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cat /sys/kernel/mm/transparent_hugepage/enabled
always madvise [never]</pre></div><p>
      If disabled, the value <code class="literal">never</code> is shown
      in square brackets like in the example above. A value of
      <code class="literal">always</code> mandatorily tries and uses THP at fault
      time but defers to <code class="command">khugepaged</code> if the allocation
      fails. A value of <code class="literal">madvise</code> will only allocate THP
      for address spaces explicitly specified by an application.
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.4.11.7.7.1"><span class="term"><code class="filename">/sys/kernel/mm/transparent_hugepage/defrag</code>
       </span></dt><dd><p>
         This parameter controls how much effort an application commits when
         allocating a THP. A value of <code class="literal">always</code> is the default
         for <span class="phrase">SUSE Linux Enterprise 12 SP1 and earlier</span> releases
         that supported THP. If a THP is not available, the application tries to defragment memory.
         It potentially incurs large stalls in an application if the memory is fragmented and a THP
         is not available.
        </p><p>
         A value of <code class="literal">madvise</code> means that THP allocation
         requests will only defragment if the application explicitly requests
         it. This is the default for <span class="phrase">SUSE Linux Enterprise 12
         SP2</span> and later
         releases.
        </p><p>
         <code class="literal">defer</code> is only available on <span class="phrase">SUSE Linux Enterprise 12 SP2</span> and later releases. If a THP is not available, the
         application falls back to using small pages if a THP is not
         available. It wakes the <code class="command">kswapd</code> and
         <code class="command">kcompactd</code> kernel threads to defragment memory in
         the background and a THP will be allocated later by
         <code class="command">khugepaged</code>.
       </p><p>
         The final option <code class="literal">never</code> uses small pages if
         a THP is unavailable but no other action will take place.
        </p></dd></dl></div></section><section class="sect2" id="cha-tuning-memory-vm-khugepaged" data-id-title="khugepaged parameters"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.3.6 </span><span class="title-name">khugepaged parameters</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-vm-khugepaged">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    khugepaged is automatically started when
    <code class="literal">transparent_hugepage</code> is set to
    <code class="literal">always</code> or <code class="literal">madvise</code>, and it will be
    automatically shut down if it is set to <code class="literal">never</code>. Normally
    this runs at low frequency but the behavior can be tuned.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.4.11.8.3.1"><span class="term"><code class="filename">/sys/kernel/mm/transparent_hugepage/khugepaged/defrag</code> </span></dt><dd><p>
        A value of 0 will disable <code class="command">khugepaged</code> even though
        THP may still be used at fault time. This may be important for
        latency-sensitive applications that benefit from THP but cannot
        tolerate a stall if <code class="command">khugepaged</code> tries to update an
        application memory usage.
       </p></dd><dt id="id-1.8.7.4.11.8.3.2"><span class="term"><code class="filename">/sys/kernel/mm/transparent_hugepage/khugepaged/pages_to_scan</code></span></dt><dd><p>
        This parameter controls how many pages are scanned by
        <code class="command">khugepaged</code> in a single pass. A scan identifies
        small pages that can be reallocated as THP. Increasing this value
         will allocate THP in the background faster at the cost of CPU
         usage.
       </p></dd><dt id="id-1.8.7.4.11.8.3.3"><span class="term"><code class="filename">/sys/kernel/mm/transparent_hugepage/khugepaged/scan_sleep_millisecs</code></span></dt><dd><p>
       <code class="command">khugepaged</code> sleeps for a short interval specified
       by this parameter after each pass to limit how much CPU usage is
       used. Reducing this value allocates THP in the background faster
       at the cost of CPU usage. A value of 0 will force continual scanning.
       </p></dd><dt id="id-1.8.7.4.11.8.3.4"><span class="term"><code class="filename">/sys/kernel/mm/transparent_hugepage/khugepaged/alloc_sleep_millisecs</code>
      </span></dt><dd><p>
         This parameter controls how long <code class="command">khugepaged</code> will
         sleep in the event it fails to allocate a THP in the background waiting
         for <code class="command">kswapd</code> and <code class="command">kcompactd</code> to
         take action.
       </p></dd></dl></div><p>
     The remaining parameters for <code class="command">khugepaged</code> are rarely
     useful for performance tuning but are fully documented in
     <code class="filename">/usr/src/linux/Documentation/vm/transhuge.txt</code>
   </p></section><section class="sect2" id="cha-tuning-memory-vm-more" data-id-title="Further VM parameters"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.3.7 </span><span class="title-name">Further VM parameters</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-vm-more">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    For the complete list of the VM tunable parameters, see
    <code class="filename">/usr/src/linux/Documentation/sysctl/vm.txt</code>
    (available after having installed the
    <code class="systemitem">kernel-source</code> package).
   </p></section></section><section class="sect1" id="cha-tuning-memory-monitoring" data-id-title="Monitoring VM behavior"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.4 </span><span class="title-name">Monitoring VM behavior</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-memory-monitoring">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_memory.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Some simple tools that can help monitor VM behavior:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     vmstat: This tool gives a good overview of what the VM is doing. See
     <a class="xref" href="#sec-util-multi-vmstat" title="2.1.1. vmstat">Section 2.1.1, “<code class="command">vmstat</code>”</a> for details.
    </p></li><li class="listitem"><p>
     <code class="filename">/proc/meminfo</code>: This file gives a detailed
     breakdown of where memory is being used. See
     <a class="xref" href="#sec-util-memory-meminfo" title="2.4.2. Detailed memory usage: /proc/meminfo">Section 2.4.2, “Detailed memory usage: <code class="filename">/proc/meminfo</code>”</a> for details.
    </p></li><li class="listitem"><p>
     <code class="command">slabtop</code>: This tool provides detailed information
     about kernel slab memory usage. buffer_head, dentry, inode_cache,
     ext3_inode_cache, etc. are the major caches. This command is available
     with the package <code class="systemitem">procps</code>.
    </p></li><li class="listitem"><p>
    <code class="filename">/proc/vmstat</code>: This file gives a detailed breakdown of
    internal VM behavior. The information contained within is implementation
    specific and may not always be available. Some information is duplicated in
    <code class="filename">/proc/meminfo</code> and other information can be presented
    in a friendly fashion by utilities. For maximum utility, this file needs to
    be monitored over time to observe rates of change. The most important
    pieces of information that are hard to derive from other sources are as
    follows:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.4.12.3.4.2.1"><span class="term"><code class="literal">pgscan_kswapd_*, pgsteal_kswapd_*</code></span></dt><dd><p>
        These report respectively the number of pages scanned and reclaimed
        by <code class="command">kswapd</code> since the system started. The ratio
        between these values can be interpreted as the reclaim efficiency
        with a low efficiency implying that the system is struggling to
        reclaim memory and may be thrashing. Light activity here is
        generally not something to be concerned with.
       </p></dd><dt id="id-1.8.7.4.12.3.4.2.2"><span class="term"><code class="literal">pgscan_direct_*, pgsteal_direct_*</code></span></dt><dd><p>
         These report respectively the number of pages scanned and
         reclaimed by an application directly. This is correlated with
         increases in the <code class="literal">allocstall</code> counter. This is
         more serious than <code class="command">kswapd</code> activity as these
         events indicate that processes are stalling. Heavy activity
         here combined with <code class="command">kswapd</code> and high rates of
         <code class="literal">pgpgin</code>, <code class="literal">pgpout</code> and/or high
         rates of <code class="literal">pswapin</code> or <code class="literal">pswpout</code>
         are signs that a system is thrashing heavily.
        </p><p>
         More detailed information can be obtained using tracepoints.
        </p></dd><dt id="id-1.8.7.4.12.3.4.2.3"><span class="term"><code class="literal">thp_fault_alloc, thp_fault_fallback</code></span></dt><dd><p>
        These counters correspond to how many THPs were allocated directly
        by an application and how many times a THP was not available and
        small pages were used. Generally a high fallback rate is harmless
        unless the application is sensitive to TLB pressure.
       </p></dd><dt id="id-1.8.7.4.12.3.4.2.4"><span class="term"><code class="literal">thp_collapse_alloc, thp_collapse_alloc_failed</code></span></dt><dd><p>
        These counters correspond to how many THPs were allocated by
        <code class="command">khugepaged</code> and how many times a THP was not
        available and small pages were used. A high fallback rate implies
        that the system is fragmented and THPs are not being used even
        when the memory usage by applications would allow them. It is
        only a problem for applications that are sensitive to TLB pressure.
       </p></dd><dt id="id-1.8.7.4.12.3.4.2.5"><span class="term"><code class="literal">compact_*_scanned, compact_stall, compact_fail,
      compact_success</code></span></dt><dd><p>
        These counters may increase when THP is enabled and the system is
        fragmented. <code class="literal">compact_stall</code> is incremented when
        an application stalls allocating THP. The remaining counters
        account for pages scanned, the number of defragmentation events
        that succeeded or failed.
       </p></dd></dl></div></li></ol></div></section></section><section class="chapter" id="cha-tuning-network" data-id-title="Tuning the network"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">16 </span><span class="title-name">Tuning the network</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-network">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The network subsystem is complex and its tuning highly depends on
  the system use scenario and on external factors such as software
  clients or hardware components (switches, routers, or gateways) in your
  network. The Linux kernel aims more at reliability and low latency than
  low overhead and high throughput. Other settings can mean less security,
  but better performance.
 </p><section class="sect1" id="sec-tuning-network-buffers" data-id-title="Configurable kernel socket buffers"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">16.1 </span><span class="title-name">Configurable kernel socket buffers</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-network-buffers">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Most of modern networking is based on the TCP/IP protocol and a socket interface
   for communication; for more information about TCP/IP, see
   <span class="intraxref">Book “Administration Guide”, Chapter 23 “Basic networking”</span>. The Linux kernel handles data it receives
   or sends via the socket interface in socket buffers. These kernel socket
   buffers are tunable.
  </p><div id="id-1.8.7.5.4.3" data-id-title="TCP autotuning" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: TCP autotuning</div><p>
    Since kernel version 2.6.17 full autotuning with 4 MB maximum buffer
    size exists. This means that manual tuning does not
    improve networking performance considerably. It is often the best not to
    touch the following variables, or, at least, to check the outcome of
    tuning efforts carefully.
   </p><p>
    If you update from an older kernel, it is recommended to remove manual
    TCP tunings in favor of the autotuning feature.
   </p></div><p>
   The special files in the <code class="filename">/proc</code> file system can
   modify the size and behavior of kernel socket buffers; for general
   information about the <code class="filename">/proc</code> file system, see
   <a class="xref" href="#sec-util-proc" title="2.6. The /proc file system">Section 2.6, “The <code class="filename">/proc</code> file system”</a>. Find networking related files in:
  </p><div class="verbatim-wrap"><pre class="screen">/proc/sys/net/core
/proc/sys/net/ipv4
/proc/sys/net/ipv6</pre></div><p>
   General <code class="systemitem">net</code> variables are explained in the
   kernel documentation
   (<code class="filename">linux/Documentation/sysctl/net.txt</code>). Special
   <code class="systemitem">ipv4</code> variables are explained in
   <code class="filename">linux/Documentation/networking/ip-sysctl.txt</code> and
   <code class="filename">linux/Documentation/networking/ipvs-sysctl.txt</code>.
  </p><p>
   In the <code class="filename">/proc</code> file system, for example, it is
   possible to either set the Maximum Socket Receive Buffer and Maximum
   Socket Send Buffer for all protocols, or both these options for the TCP
   protocol only (in <code class="filename">ipv4</code>) and thus overriding the
   setting for all protocols (in <code class="filename">core</code>).
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.5.4.8.1"><span class="term"><code class="filename">/proc/sys/net/ipv4/tcp_moderate_rcvbuf</code>
    </span></dt><dd><p>
      If <code class="filename">/proc/sys/net/ipv4/tcp_moderate_rcvbuf</code> is set
      to <code class="literal">1</code>, autotuning is active and buffer size is
      adjusted dynamically.
     </p></dd><dt id="id-1.8.7.5.4.8.2"><span class="term"><code class="filename">/proc/sys/net/ipv4/tcp_rmem</code>
    </span></dt><dd><p>
      The three values setting the minimum, initial, and maximum size of the
      Memory Receive Buffer per connection. They define the actual memory
      usage, not only TCP window size.
     </p></dd><dt id="id-1.8.7.5.4.8.3"><span class="term"><code class="filename">/proc/sys/net/ipv4/tcp_wmem</code>
    </span></dt><dd><p>
      The same as <code class="filename">tcp_rmem</code>, but for Memory Send Buffer
      per connection.
     </p></dd><dt id="id-1.8.7.5.4.8.4"><span class="term"><code class="filename">/proc/sys/net/core/rmem_max</code>
    </span></dt><dd><p>
      Set to limit the maximum receive buffer size that applications can
      request.
     </p></dd><dt id="id-1.8.7.5.4.8.5"><span class="term"><code class="filename">/proc/sys/net/core/wmem_max</code>
    </span></dt><dd><p>
      Set to limit the maximum send buffer size that applications can
      request.
     </p></dd></dl></div><p>
   Via <code class="filename">/proc</code> it is possible to disable TCP features
   that you do not need (all TCP features are switched on by default). For
   example, check the following files:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.7.5.4.10.1"><span class="term"><code class="filename">/proc/sys/net/ipv4/tcp_timestamps</code>
    </span></dt><dd><p>
      TCP time stamps are defined in RFC1323.
     </p></dd><dt id="id-1.8.7.5.4.10.2"><span class="term"><code class="filename">/proc/sys/net/ipv4/tcp_window_scaling</code>
    </span></dt><dd><p>
      TCP window scaling is also defined in RFC1323.
     </p></dd><dt id="id-1.8.7.5.4.10.3"><span class="term"><code class="filename">/proc/sys/net/ipv4/tcp_sack</code>
    </span></dt><dd><p>
      Select acknowledgments (SACKS).
     </p></dd></dl></div><p>
   Use <code class="command">sysctl</code> to read or write variables of the
   <code class="filename">/proc</code> file system. <code class="command">sysctl</code> is
   preferable to <code class="command">cat</code> (for reading) and
   <code class="command">echo</code> (for writing), because it also reads settings
   from <code class="filename">/etc/sysctl.conf</code> and, thus, those settings
   survive reboots reliably. With <code class="command">sysctl</code> you can read all
   variables and their values easily; as <code class="systemitem">root</code> use the following
   command to list TCP related settings:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> sysctl -a | grep tcp</pre></div><div id="id-1.8.7.5.4.13" data-id-title="Side effects of tuning network variables" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Side effects of tuning network variables</div><p>
    Tuning network variables can affect other system resources such as CPU
    or memory use.


   </p></div></section><section class="sect1" id="sec-tuning-network-analyzing" data-id-title="Detecting network bottlenecks and analyzing network traffic"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">16.2 </span><span class="title-name">Detecting network bottlenecks and analyzing network traffic</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-network-analyzing">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Before starting with network tuning, it is important to isolate network
   bottlenecks and network traffic patterns. There are certain tools that can
   help you with detecting those bottlenecks.
  </p><p>
   The following tools can help analyzing your network traffic:
   <code class="command">netstat</code>, <code class="command">tcpdump</code>, and
   <code class="command">wireshark</code>. Wireshark is a network traffic analyzer.
  </p></section><section class="sect1" id="sec-tuning-network-netfilter" data-id-title="Netfilter"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">16.3 </span><span class="title-name">Netfilter</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-network-netfilter">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The Linux firewall and masquerading features are provided by the
   Netfilter kernel modules. This is a highly configurable rule based
   framework. If a rule matches a packet, Netfilter accepts or denies it or
   takes special action (<span class="quote">“<span class="quote">target</span>”</span>) as defined by rules such as
   address translation.
  </p><p>
   There are many properties Netfilter can take into account.
   Thus, the more rules are defined, the longer packet processing may last.
   Also advanced connection tracking could be rather expensive and, thus,
   slowing down overall networking.
  </p><p>
   When the kernel queue becomes full, all new packets are dropped, causing
   existing connections to fail. The 'fail-open' feature allows a user to
   temporarily disable the packet inspection and maintain the connectivity
   under heavy network traffic. For reference, see <a class="link" href="https://home.regit.org/netfilter-en/using-nfqueue-and-libnetfilter_queue/" target="_blank">https://home.regit.org/netfilter-en/using-nfqueue-and-libnetfilter_queue/</a>.
  </p><p>
   For more information, see the home page of the Netfilter and iptables
   project, <a class="link" href="https://www.netfilter.org" target="_blank">https://www.netfilter.org</a>.
  </p></section><section class="sect1" id="sec-tuning-network-rps" data-id-title="Improving the network performance with receive packet steering (RPS)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">16.4 </span><span class="title-name">Improving the network performance with receive packet steering (RPS)</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-network-rps">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_network.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Modern network interface devices can move so many packets that the host
   can become the limiting factor for achieving maximum performance.
   To keep up, the system must be able to distribute the work across
   multiple CPU cores.
  </p><p>
   Some modern network interfaces can help distribute the work to multiple
   CPU cores through the implementation of multiple transmission and
   multiple receive queues in hardware. However, others are only equipped
   with a single queue and the driver must deal with all incoming packets in
   a single, serialized stream. To work around this issue, the operating
   system must <span class="quote">“<span class="quote">parallelize</span>”</span> the stream to distribute the work across
   multiple CPUs. On <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> this is done via Receive Packet
   Steering (RPS). RPS can also be used in virtual environments.
  </p><p>
   RPS creates a unique hash for each data stream using IP addresses and
   port numbers. The use of this hash ensures that packets for the same data
   stream are sent to the same CPU, which helps to increase performance.
  </p><p>
   RPS is configured per network device receive queue and interface. The
   configuration file names match the following scheme:
  </p><div class="verbatim-wrap"><pre class="screen">/sys/class/net/<em class="replaceable">&lt;device&gt;</em>/queues/<em class="replaceable">&lt;rx-queue&gt;</em>/rps_cpus</pre></div><p>
   <em class="replaceable">&lt;device&gt;</em> stands for the network
   device, such as <code class="literal">eth0</code>, <code class="literal">eth1</code>.
   <em class="replaceable">&lt;rx-queue&gt;</em> stands for the receive queue,
   such as <code class="literal">rx-0</code>, <code class="literal">rx-1</code>.
  </p><p>
   If the network interface hardware only supports a single receive queue,
   only <code class="literal">rx-0</code> exists. If it supports multiple receive
   queues, there is an rx-<em class="replaceable">N</em> directory for
   each receive queue.
  </p><p>
   These configuration files contain a comma-delimited list of CPU bitmaps.
   By default, all bits are set to <code class="literal">0</code>. With this setting,
   RPS is disabled and therefore the CPU that handles the interrupt also processes the packet queue.
  </p><p>
   To enable RPS and enable specific CPUs to process packets for the receive
   queue of the interface, set the value of their positions in the bitmap to
   <code class="literal">1</code>. For example, to enable CPUs 0-3 to process packets
   for the first receive queue for eth0, set the bit positions
   0-3 to 1 in binary: <code class="literal">00001111</code>. This representation then
   needs to be converted to hex—which results in <code class="literal">F</code> in
   this case. Set this hex value with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> echo "f" &gt; /sys/class/net/eth0/queues/rx-0/rps_cpus</pre></div><p>
   If you wanted to enable CPUs 8-15:
  </p><div class="verbatim-wrap"><pre class="screen">1111 1111 0000 0000 (binary)
15     15    0    0 (decimal)
F       F    0    0 (hex)</pre></div><p>
   The command to set the hex value of <code class="literal">ff00</code> would be:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> echo "ff00" &gt; /sys/class/net/eth0/queues/rx-0/rps_cpus</pre></div><p>
   On NUMA machines, best performance can be achieved by configuring RPS to
   use the CPUs on the same NUMA node as the interrupt for the interface's
   receive queue.
  </p><p>
   On non-NUMA machines, all CPUs can be used. If the interrupt rate is high, excluding the CPU handling the network interface can boost
   performance. The CPU being used for the network interface can be
   determined from <code class="filename">/proc/interrupts</code>. For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> cat /proc/interrupts
            CPU0       CPU1       CPU2       CPU3
...
  51:  113915241          0          0          0      Phys-fasteoi   eth0
...</pre></div><p>
   In this case, <code class="literal">CPU 0</code> is the only CPU processing
   interrupts for <code class="literal">eth0</code>, since only
   <code class="literal">CPU0</code> contains a non-zero value.
  </p><p>
   On x86 and AMD64/Intel 64 platforms, <code class="command">irqbalance</code> can be used
   to distribute hardware interrupts across CPUs. See <code class="command">man 1
   irqbalance</code> for more details.
  </p></section></section></div><div class="part" id="part-tuning-dumps" data-id-title="Handling system dumps"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part VI </span><span class="title-name">Handling system dumps </span></span><a title="Permalink" class="permalink" href="#part-tuning-dumps">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_tuning.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-tuning-tracing"><span class="title-number">17 </span><span class="title-name">Tracing tools</span></a></span></li><dd class="toc-abstract"><p>SUSE Linux Enterprise Desktop comes with several tools that help you obtain useful information about your system. You can use the information for different purposes. For example, to debug and find problems in your program, to discover places causing performance drops, or to trace a running process t…</p></dd><li><span class="chapter"><a href="#cha-tuning-kexec"><span class="title-number">18 </span><span class="title-name">Kexec and Kdump</span></a></span></li><dd class="toc-abstract"><p>
  Kexec is a tool to boot to another kernel from the currently running one.
  You can perform faster system reboots without any hardware initialization.
  You can also prepare the system to boot to another kernel if the system
  crashes.
 </p></dd><li><span class="chapter"><a href="#cha-tuning-systemd-coredump"><span class="title-number">19 </span><span class="title-name">Using <code class="systemitem">systemd-coredump</code> to debug application crashes</span></a></span></li><dd class="toc-abstract"><p>systemd-coredump collects and displays core dumps, for analyzing application crashes. The core dump contains an image of the process's memory at the time of termination. By default, when a process crashes (or all processes belonging to an application), it stores the core dump in the /var/lib/systemd…</p></dd></ul></div><section class="chapter" id="cha-tuning-tracing" data-id-title="Tracing tools"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">17 </span><span class="title-name">Tracing tools</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-tracing">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> comes with several tools that help you obtain useful
  information about your system. You can use the information for different
  purposes. For example, to debug and find problems in your program, to
  discover places causing performance drops, or to trace a running process to
  find out what system resources it uses. <span class="phrase">Most of the
  tools are part of the installation media. In certain cases, they need to be
  installed from the SUSE Software Development Kit, which is a separate download.</span>
 </p><div id="id-1.8.8.2.4" data-id-title="Tracing and impact on performance" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Tracing and impact on performance</div><p>
   While a running process is being monitored for system or library calls,
   the performance of the process is heavily reduced. You are advised to use
   tracing tools only for the time you need to collect the data.
  </p></div><section class="sect1" id="sec-tuning-tracing-strace" data-id-title="Tracing system calls with strace"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.1 </span><span class="title-name">Tracing system calls with strace</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-strace">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="command">strace</code> command traces system calls of a process
   and signals received by the process. <code class="command">strace</code> can either
   run a new command and trace its system calls, or you can attach
   <code class="command">strace</code> to an already running command. Each line of the
   command's output contains the system call name, followed by its arguments
   in parentheses and its return value.
  </p><p>
   To run a new command and start tracing its system calls, enter the
   command to be monitored as you normally do, and add
   <code class="command">strace</code> at the beginning of the command line:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>strace ls
execve("/bin/ls", ["ls"], [/* 52 vars */]) = 0
brk(0)                                  = 0x618000
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) \
        = 0x7f9848667000
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) \
        = 0x7f9848666000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT \
(No such file or directory)
open("/etc/ld.so.cache", O_RDONLY)      = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=200411, ...}) = 0
mmap(NULL, 200411, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f9848635000
close(3)                                = 0
open("/lib64/librt.so.1", O_RDONLY)     = 3
[...]
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) \
= 0x7fd780f79000
write(1, "Desktop\nDocuments\nbin\ninst-sys\n", 31Desktop
Documents
bin
inst-sys
) = 31
close(1)                                = 0
munmap(0x7fd780f79000, 4096)            = 0
close(2)                                = 0
exit_group(0)                           = ?</pre></div><p>
   To attach <code class="command">strace</code> to an already running process, you
   need to specify the <code class="option">-p</code> with the process ID
   (<code class="systemitem">PID</code>) of the process that you want to monitor:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>strace -p `pidof cron`
 Process 1261 attached
 restart_syscall(&lt;... resuming interrupted call ...&gt;) = 0
  stat("/etc/localtime", {st_mode=S_IFREG|0644, st_size=2309, ...}) = 0
  select(5, [4], NULL, NULL, {0, 0})      = 0 (Timeout)
  socket(PF_LOCAL, SOCK_STREAM|SOCK_CLOEXEC|SOCK_NONBLOCK, 0) = 5
  connect(5, {sa_family=AF_LOCAL, sun_path="/var/run/nscd/socket"}, 110) = 0
  sendto(5, "\2\0\0\0\0\0\0\0\5\0\0\0root\0", 17, MSG_NOSIGNAL, NULL, 0) = 17
  poll([{fd=5, events=POLLIN|POLLERR|POLLHUP}], 1, 5000) = 1 ([{fd=5, revents=POLLIN|POLLHUP}])
  read(5, "\2\0\0\0\1\0\0\0\5\0\0\0\2\0\0\0\0\0\0\0\0\0\0\0\5\0\0\0\6\0\0\0"..., 36) = 36
  read(5, "root\0x\0root\0/root\0/bin/bash\0", 28) = 28
  close(5)                                = 0
  rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0
  rt_sigaction(SIGCHLD, NULL, {0x7f772b9ea890, [], SA_RESTORER|SA_RESTART, 0x7f772adf7880}, 8) = 0
  rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
  nanosleep({60, 0}, 0x7fff87d8c580)      = 0
  stat("/etc/localtime", {st_mode=S_IFREG|0644, st_size=2309, ...}) = 0
  select(5, [4], NULL, NULL, {0, 0})      = 0 (Timeout)
  socket(PF_LOCAL, SOCK_STREAM|SOCK_CLOEXEC|SOCK_NONBLOCK, 0) = 5
  connect(5, {sa_family=AF_LOCAL, sun_path="/var/run/nscd/socket"}, 110) = 0
  sendto(5, "\2\0\0\0\0\0\0\0\5\0\0\0root\0", 17, MSG_NOSIGNAL, NULL, 0) = 17
  poll([{fd=5, events=POLLIN|POLLERR|POLLHUP}], 1, 5000) = 1 ([{fd=5, revents=POLLIN|POLLHUP}])
  read(5, "\2\0\0\0\1\0\0\0\5\0\0\0\2\0\0\0\0\0\0\0\0\0\0\0\5\0\0\0\6\0\0\0"..., 36) = 36
  read(5, "root\0x\0root\0/root\0/bin/bash\0", 28) = 28
  close(5)
  [...]</pre></div><p>
   The <code class="option">-e</code> option understands several sub-options and
   arguments. For example, to trace all attempts to open or write to a
   particular file, use the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>strace -e trace=open,write ls ~
open("/etc/ld.so.cache", O_RDONLY)       = 3
open("/lib64/librt.so.1", O_RDONLY)      = 3
open("/lib64/libselinux.so.1", O_RDONLY) = 3
open("/lib64/libacl.so.1", O_RDONLY)     = 3
open("/lib64/libc.so.6", O_RDONLY)       = 3
open("/lib64/libpthread.so.0", O_RDONLY) = 3
[...]
open("/usr/lib/locale/cs_CZ.utf8/LC_CTYPE", O_RDONLY) = 3
open(".", O_RDONLY|O_NONBLOCK|O_DIRECTORY|O_CLOEXEC) = 3
write(1, "addressbook.db.bak\nbin\ncxoffice\n"..., 311) = 311</pre></div><p>
   To trace only network related system calls, use <code class="option">-e
   trace=network</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>strace -e trace=network -p 26520
Process 26520 attached - interrupt to quit
socket(PF_NETLINK, SOCK_RAW, 0)         = 50
bind(50, {sa_family=AF_NETLINK, pid=0, groups=00000000}, 12) = 0
getsockname(50, {sa_family=AF_NETLINK, pid=26520, groups=00000000}, \
[12]) = 0
sendto(50, "\24\0\0\0\26\0\1\3~p\315K\0\0\0\0\0\0\0\0", 20, 0,
{sa_family=AF_NETLINK, pid=0, groups=00000000}, 12) = 20
[...]</pre></div><p>
   The <code class="option">-c</code> calculates the time the kernel spent on each
   system call:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>strace -c find /etc -name xorg.conf
/etc/X11/xorg.conf
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 32.38    0.000181         181         1           execve
 22.00    0.000123           0       576           getdents64
 19.50    0.000109           0       917        31 open
 19.14    0.000107           0       888           close
  4.11    0.000023           2        10           mprotect
  0.00    0.000000           0         1           write
[...]
  0.00    0.000000           0         1           getrlimit
  0.00    0.000000           0         1           arch_prctl
  0.00    0.000000           0         3         1 futex
  0.00    0.000000           0         1           set_tid_address
  0.00    0.000000           0         4           fadvise64
  0.00    0.000000           0         1           set_robust_list
------ ----------- ----------- --------- --------- ----------------
100.00    0.000559                  3633        33 total</pre></div><p>
   To trace all child processes of a process, use <code class="option">-f</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>strace -f systemctl status apache2.service
execve("/usr/bin/systemctl", ["systemctl", "status", "apache2.service"], \
 0x7ffea44a3318 /* 56 vars */) = 0
brk(NULL)                               = 0x5560f664a000
[...]
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f98c58a5000
mmap(NULL, 4420544, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f98c524a000
mprotect(0x7f98c53f4000, 2097152, PROT_NONE) = 0
[...]
[pid  9130] read(0, "\342\227\217 apache2.service - The Apache"..., 8192) = 165
[pid  9130] read(0, "", 8027)           = 0
● apache2.service - The Apache Webserver227\217 apache2.service - Th"..., 193
   Loaded: loaded (/usr/lib/systemd/system/apache2.service; disabled; vendor preset: disabled)
   Active: inactive (dead)
) = 193
[pid  9130] ioctl(3, SNDCTL_TMR_STOP or TCSETSW, {B38400 opost isig icanon echo ...}) = 0
[pid  9130] exit_group(0)               = ?
[pid  9130] +++ exited with 0 +++
&lt;... waitid resumed&gt;{si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=9130, \
 si_uid=0, si_status=0, si_utime=0, si_stime=0}, WEXITED, NULL) = 0
--- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=9130, si_uid=0, \
  si_status=0, si_utime=0, si_stime=0} ---
exit_group(3)                           = ?
+++ exited with 3 +++</pre></div><p>
   If you need to analyze the output of <code class="command">strace</code> and the
   output messages are too long to be inspected directly in the console
   window, use <code class="option">-o</code>. In that case, unnecessary messages, such
   as information about attaching and detaching processes, are suppressed.
   You can also suppress these messages (normally printed on the standard
   output) with <code class="option">-q</code>. To add time stamps at the beginning of each line
   with a system call, use <code class="option">-t</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>strace -t -o strace_sleep.txt sleep 1; more strace_sleep.txt
08:44:06 execve("/bin/sleep", ["sleep", "1"], [/* 81 vars */]) = 0
08:44:06 brk(0)                         = 0x606000
08:44:06 mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, \
-1, 0) = 0x7f8e78cc5000
[...]
08:44:06 close(3)                       = 0
08:44:06 nanosleep({1, 0}, NULL)        = 0
08:44:07 close(1)                       = 0
08:44:07 close(2)                       = 0
08:44:07 exit_group(0)                  = ?</pre></div><p>
   The behavior and output format of strace can be controlled. For
   more information, see the relevant manual page (man 1 strace).
  </p></section><section class="sect1" id="sec-tuning-tracing-ltrace" data-id-title="Tracing library calls with ltrace"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.2 </span><span class="title-name">Tracing library calls with ltrace</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-ltrace">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">ltrace</code> traces dynamic library calls of a process. It
   is used in a similar way to <code class="command">strace</code>, and most of their
   parameters have a similar or identical meaning. By default,
   <code class="command">ltrace</code> uses <code class="filename">/etc/ltrace.conf</code> or
   <code class="filename">~/.ltrace.conf</code> configuration files. You can,
   however, specify an alternative one with the <code class="option">-F
   <em class="replaceable">CONFIG_FILE</em></code> option.
  </p><p>
   In addition to library calls, <code class="command">ltrace</code> with the
   <code class="option">-S</code> option can trace system calls as well:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ltrace -S -o ltrace_find.txt find /etc -name \
xorg.conf; more ltrace_find.txt
SYS_brk(NULL)                                              = 0x00628000
SYS_mmap(0, 4096, 3, 34, 0xffffffff)                       = 0x7f1327ea1000
SYS_mmap(0, 4096, 3, 34, 0xffffffff)                       = 0x7f1327ea0000
[...]
fnmatch("xorg.conf", "xorg.conf", 0)                       = 0
free(0x0062db80)                                           = &lt;void&gt;
__errno_location()                                         = 0x7f1327e5d698
__ctype_get_mb_cur_max(0x7fff25227af0, 8192, 0x62e020, -1, 0) = 6
__ctype_get_mb_cur_max(0x7fff25227af0, 18, 0x7f1327e5d6f0, 0x7fff25227af0,
0x62e031) = 6
__fprintf_chk(0x7f1327821780, 1, 0x420cf7, 0x7fff25227af0, 0x62e031
&lt;unfinished ...&gt;
SYS_fstat(1, 0x7fff25227230)                               = 0
SYS_mmap(0, 4096, 3, 34, 0xffffffff)                       = 0x7f1327e72000
SYS_write(1, "/etc/X11/xorg.conf\n", 19)                   = 19
[...]</pre></div><p>
   You can change the type of traced events with the <code class="option">-e</code>
   option. The following example prints library calls related to
   <code class="systemitem">fnmatch</code> and <code class="systemitem">strlen</code>
   functions:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ltrace -e fnmatch,strlen find /etc -name xorg.conf
[...]
fnmatch("xorg.conf", "xorg.conf", 0)             = 0
strlen("Xresources")                             = 10
strlen("Xresources")                             = 10
strlen("Xresources")                             = 10
fnmatch("xorg.conf", "Xresources", 0)            = 1
strlen("xorg.conf.install")                      = 17
[...]</pre></div><p>
   To display only the symbols included in a specific library, use
   <code class="option">-l <em class="replaceable">/path/to/library</em></code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ltrace -l /lib64/librt.so.1 sleep 1
clock_gettime(1, 0x7fff4b5c34d0, 0, 0, 0)                  = 0
clock_gettime(1, 0x7fff4b5c34c0, 0xffffffffff600180, -1, 0) = 0
+++ exited (status 0) +++</pre></div><p>
   You can make the output more readable by indenting each nested call by
   the specified number of space with the <code class="option">-n
   <em class="replaceable">NUM_OF_SPACES</em></code>.
  </p></section><section class="sect1" id="sec-tuning-tracing-valgrind" data-id-title="Debugging and profiling with Valgrind"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.3 </span><span class="title-name">Debugging and profiling with Valgrind</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-valgrind">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Valgrind is a set of tools to debug and profile your programs so that
   they can run both faster and with fewer errors. Valgrind can detect problems
   related to memory management and threading, or can also serve as a
   framework for building new debugging tools. It is well known that this
   tool can incur high overhead, causing, for example, higher runtimes or
   changing the normal program behavior under concurrent workloads based on timing.
  </p><section class="sect2" id="sec-tuning-tracing-valgrind-install" data-id-title="Installation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.3.1 </span><span class="title-name">Installation</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-valgrind-install">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Valgrind is not shipped with standard <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> distribution. To
    install it on your system, you need to obtain SUSE Software Development Kit, and either
    install it and run
   </p><p>
    <code class="command">zypper</code> <code class="option">install
    <em class="replaceable">VALGRIND</em></code>
   </p><p>
    or browse through the SUSE Software Development Kit directory tree, locate the Valgrind
    package and install it with
   </p><p>
    <code class="command">rpm</code> <code class="option">-i</code>
    valgrind-<em class="replaceable">VERSION_ARCHITECTURE</em>.rpm
   </p><p>
    The SDK is a module for SUSE Linux Enterprise and is available via an online channel from
    the SUSE Customer Center. Refer to <span class="intraxref">Article “Modules and Extensions Quick Start”</span> for details.
   </p></section><section class="sect2" id="sec-tuning-tracing-valgrind-supparch" data-id-title="Supported architectures"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.3.2 </span><span class="title-name">Supported architectures</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-valgrind-supparch">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> supports Valgrind on the following architectures:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      AMD64/Intel 64
     </p></li><li class="listitem"><p>
      POWER
     </p></li><li class="listitem"><p>
      IBM Z
     </p></li></ul></div></section><section class="sect2" id="sec-tuning-tracing-valgrind-core" data-id-title="General information"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.3.3 </span><span class="title-name">General information</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-valgrind-core">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The main advantage of Valgrind is that it works with existing compiled
    executables. You do not need to recompile or modify your programs to
    use it. Run Valgrind like this:
   </p><p>
    <code class="command">valgrind</code> <em class="replaceable">VALGRIND_OPTIONS</em>
    your-prog <em class="replaceable">YOUR-PROGRAM-OPTIONS</em>
   </p><p>
    Valgrind consists of several tools, and each provides specific
    functionality. Information in this section is general and valid
    regardless of the used tool. The most important configuration option is
    <code class="option">--tool</code>. This option tells Valgrind which tool to run.
    If you omit this option, <code class="systemitem">memcheck</code> is selected
    by default. For example, to run <code class="command">find ~</code>
    <code class="option">-name</code> .bashrc with Valgrind's
    <code class="systemitem">memcheck</code> tools, enter the following in the
    command line:
   </p><p>
    <code class="command">valgrind</code> <code class="option">--tool</code>=memcheck find ~ -name
    .bashrc
   </p><p>
    A list of standard Valgrind tools with a brief description follows:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.8.2.7.5.7.1"><span class="term"><code class="systemitem">memcheck</code>
     </span></dt><dd><p>
       Detects memory errors. It helps you tune your programs to behave
       correctly.
      </p></dd><dt id="id-1.8.8.2.7.5.7.2"><span class="term"><code class="systemitem">cachegrind</code>
     </span></dt><dd><p>
       Profiles cache prediction. It helps you tune your programs to run
       faster.
      </p></dd><dt id="id-1.8.8.2.7.5.7.3"><span class="term"><code class="systemitem">callgrind</code>
     </span></dt><dd><p>
       Works in a similar way to <code class="systemitem">cachegrind</code> but
       also gathers additional cache-profiling information.
      </p></dd><dt id="id-1.8.8.2.7.5.7.4"><span class="term"><code class="systemitem">exp-drd</code>
     </span></dt><dd><p>
       Detects thread errors. It helps you tune your multi-threaded programs
       to behave correctly.
      </p></dd><dt id="id-1.8.8.2.7.5.7.5"><span class="term"><code class="systemitem">helgrind</code>
     </span></dt><dd><p>
       Another thread error detector. Similar to
       <code class="systemitem">exp-drd</code> but uses different techniques for
       problem analysis.
      </p></dd><dt id="id-1.8.8.2.7.5.7.6"><span class="term"><code class="systemitem">massif</code>
     </span></dt><dd><p>
       A heap profiler. Heap is an area of memory used for dynamic memory
       allocation. This tool helps you tune your program to use less memory.
      </p></dd><dt id="id-1.8.8.2.7.5.7.7"><span class="term"><code class="systemitem">lackey</code>
     </span></dt><dd><p>
       An example tool showing instrumentation basics.
      </p></dd></dl></div></section><section class="sect2" id="sec-tuning-tracing-valgrind-defopts" data-id-title="Default options"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.3.4 </span><span class="title-name">Default options</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-valgrind-defopts">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Valgrind can read options at start-up. There are three places which
    Valgrind checks:
   </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
      The file <code class="filename">.valgrindrc</code> in the home directory of the
      user who runs Valgrind.
     </p></li><li class="listitem"><p>
      The environment variable <code class="literal">$VALGRIND_OPTS</code>
     </p></li><li class="listitem"><p>
      The file <code class="filename">.valgrindrc</code> in the current directory
      where Valgrind is run from.
     </p></li></ol></div><p>
    These resources are parsed exactly in this order, while later given
    options take precedence over earlier processed options. Options specific
    to a particular Valgrind tool must be prefixed with the tool name and a
    colon. For example, if you want <code class="systemitem">cachegrind</code> to
    always write profile data to the
    <code class="filename">/tmp/cachegrind_<em class="replaceable">PID</em>.log</code>,
    add the following line to the <code class="filename">.valgrindrc</code> file in
    your home directory:
   </p><p>
    <code class="literal">--cachegrind:cachegrind-out-file=/tmp/cachegrind_%p.log</code>
   </p></section><section class="sect2" id="sec-tuning-tracing-valgrind-howorks" data-id-title="How Valgrind works"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.3.5 </span><span class="title-name">How Valgrind works</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-valgrind-howorks">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Valgrind takes control of your executable before it starts. It reads
    debugging information from the executable and related shared libraries.
    The executable's code is redirected to the selected Valgrind tool, and
    the tool adds its own code to handle its debugging. Then the code is
    handed back to the Valgrind core and the execution continues.
   </p><p>
    For example, <code class="systemitem">memcheck</code> adds its code, which
    checks every memory access. As a consequence, the program runs much
    slower than in the native execution environment.
   </p><p>
    Valgrind simulates every instruction of your program. Therefore, it not
    only checks the code of your program, but also all related libraries
    (including the C library), libraries used for graphical environment, and
    so on. If you try to detect errors with Valgrind, it also detects errors
    in associated libraries (like C, X11, or Gtk libraries). Because you
    do not need all these errors frequently, Valgrind can selectively suppress
    these error messages to suppression files. The
    <code class="option">--gen-suppressions=yes</code> tells Valgrind to report these
    suppressions which you can copy to a file.
   </p><p>
    You should supply a real executable (machine code) as a Valgrind
    argument. If your application is run, for example, from a shell or Perl
    script, you can by mistake get error reports related to
    <code class="command">/bin/sh</code> (or <code class="command">/usr/bin/perl</code>). In
    such cases, you can use
    <code class="option">--trace-children=yes</code> to work
    around this issue. However, using the executable itself avoids any
    confusion over this issue.
   </p></section><section class="sect2" id="sec-tuning-tracing-valgrind-messages" data-id-title="Messages"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.3.6 </span><span class="title-name">Messages</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-valgrind-messages">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    During its runtime, Valgrind reports messages with detailed errors and
    important events. The following example explains the messages:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>valgrind --tool=memcheck find ~ -name .bashrc
[...]
==6558== Conditional jump or move depends on uninitialised value(s)
==6558==    at 0x400AE79: _dl_relocate_object (in /lib64/ld-2.11.1.so)
==6558==    by 0x4003868: dl_main (in /lib64/ld-2.11.1.so)
[...]
==6558== Conditional jump or move depends on uninitialised value(s)
==6558==    at 0x400AE82: _dl_relocate_object (in /lib64/ld-2.11.1.so)
==6558==    by 0x4003868: dl_main (in /lib64/ld-2.11.1.so)
[...]
==6558== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 0 from 0)
==6558== malloc/free: in use at exit: 2,228 bytes in 8 blocks.
==6558== malloc/free: 235 allocs, 227 frees, 489,675 bytes allocated.
==6558== For counts of detected errors, rerun with: -v
==6558== searching for pointers to 8 not-freed blocks.
==6558== checked 122,584 bytes.
==6558==
==6558== LEAK SUMMARY:
==6558==    definitely lost: 0 bytes in 0 blocks.
==6558==      possibly lost: 0 bytes in 0 blocks.
==6558==    still reachable: 2,228 bytes in 8 blocks.
==6558==         suppressed: 0 bytes in 0 blocks.
==6558== Rerun with --leak-check=full to see details of leaked memory.</pre></div><p>
    The <code class="literal">==6558==</code> introduces Valgrind's messages and
    contains the process ID number (PID). You can easily distinguish
    Valgrind's messages from the output of the program itself, and decide
    which messages belong to a particular process.
   </p><p>
    To make Valgrind's messages more detailed, use <code class="option">-v</code> or
    even <code class="option">-v -v</code>.
   </p><p>
    You can make Valgrind send its messages to three different places:
   </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
      By default, Valgrind sends its messages to the file descriptor 2,
      which is the standard error output. You can tell Valgrind to send its
      messages to any other file descriptor with the
      <code class="option">--log-fd=<em class="replaceable">FILE_DESCRIPTOR_NUMBER</em></code>
      option.
     </p></li><li class="listitem"><p>
      The second, and a more useful way, is to send Valgrind's messages
      to a file with
      <code class="option">--log-file=<em class="replaceable">FILENAME</em></code>. This
      option accepts several variables, for example, <code class="literal">%p</code>
      gets replaced with the PID of the currently profiled process. This way
      you can send messages to different files based on their PID.
      <code class="literal">%q{env_var}</code> is replaced with the value of the
      related <code class="literal">env_var</code> environment variable.
     </p><p>
      The following example checks for possible memory errors during the
      Apache Web server restart, while following children processes and
      writing detailed Valgrind's messages to separate files distinguished
      by the current process PID:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>valgrind -v --tool=memcheck --trace-children=yes \
--log-file=valgrind_pid_%p.log systemctl restart apache2.service</pre></div><p>
      This process created 52 log files in the testing system, and took 75
      seconds instead of the usual 7 seconds needed to run <code class="command">sudo
       systemctl restart apache2.service</code> without Valgrind, which is
      approximately 10 times more.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ls -1 valgrind_pid_*log
valgrind_pid_11780.log
valgrind_pid_11782.log
valgrind_pid_11783.log
[...]
valgrind_pid_11860.log
valgrind_pid_11862.log
valgrind_pid_11863.log</pre></div></li><li class="listitem"><p>
      You may also prefer to send the Valgrind's messages over the network.
      You need to specify the <code class="literal">aa.bb.cc.dd</code> IP address and
      <code class="literal">port_num</code> port number of the network socket with the
      <code class="option">--log-socket=<em class="replaceable">AA.BB.CC.DD:PORT_NUM</em></code>
      option. If you omit the port number, 1500 is used.
     </p><p>
      It is useless to send Valgrind's messages to a network socket if no
      application is capable of receiving them on the remote machine. That
      is why <code class="command">valgrind-listener</code>, a simple listener, is
      shipped together with Valgrind. It accepts connections on the
      specified port and copies everything it receives to the standard
      output.
     </p></li></ol></div></section><section class="sect2" id="sec-tuning-tracing-valgrind-error" data-id-title="Error messages"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.3.7 </span><span class="title-name">Error messages</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-valgrind-error">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Valgrind remembers all error messages, and if it detects a new error,
    the error is compared against old error messages. This way Valgrind
    checks for duplicate error messages. In case of a duplicate error, it is
    recorded but no message is shown. This mechanism prevents you from being
    overwhelmed by millions of duplicate errors.
   </p><p>
    The <code class="option">-v</code> option adds a summary of all reports (sorted
    by their total count) to the end of the Valgrind's execution output.
    Moreover, Valgrind stops collecting errors if it detects either 1000
    different errors, or 10 000 000 errors in total. To suppress
    this limit and see all error messages, use
    <code class="option">--error-limit=no</code>.
   </p><p>
    Certain errors cause other errors. Therefore, fix errors in the same
    order as they appear and re-check the program continuously.
   </p></section></section><section class="sect1" id="sec-tuning-tracing-valgrind-moreinfo" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.4 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-tracing-valgrind-moreinfo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_tracing.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     For a complete list of options related to the described tracing tools,
     see the corresponding man page (<code class="command">man 1 strace</code>,
     <code class="command">man 1 ltrace</code>, and <code class="command">man 1
     valgrind</code>).
    </p></li><li class="listitem"><p>
     To describe advanced usage of Valgrind is beyond the scope of this
     document. It is well documented, see
     <a class="link" href="https://valgrind.org/docs/manual/manual.html" target="_blank">Valgrind
     User Manual</a>. These pages are indispensable if you need more
     advanced information on Valgrind or the usage and purpose of its
     standard tools.
    </p></li></ul></div></section></section><section class="chapter" id="cha-tuning-kexec" data-id-title="Kexec and Kdump"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">18 </span><span class="title-name">Kexec and Kdump</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kexec">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Kexec is a tool to boot to another kernel from the currently running one.
  You can perform faster system reboots without any hardware initialization.
  You can also prepare the system to boot to another kernel if the system
  crashes.
 </p><section class="sect1" id="cha-tuning-kexec-intro" data-id-title="Introduction"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.1 </span><span class="title-name">Introduction</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kexec-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   With Kexec, you can replace the running kernel with another one without a
   hard reboot. The tool is useful for several reasons:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Faster system rebooting
    </p><p>
     If you need to reboot the system frequently, Kexec can save you
     significant time.
    </p></li><li class="listitem"><p>
     Avoiding unreliable firmware and hardware
    </p><p>
     Computer hardware is complex and serious problems may occur during the
     system start-up. You cannot always replace unreliable hardware
     immediately. Kexec boots the kernel to a controlled environment with the
     hardware already initialized. The risk of unsuccessful system start is
     then minimized.
    </p></li><li class="listitem"><p>
     Saving the dump of a crashed kernel
    </p><p>
     Kexec preserves the contents of the physical memory. After the
     <span class="emphasis"><em>production</em></span> kernel fails, the
     <span class="emphasis"><em>capture</em></span> kernel (an additional kernel running in a
     reserved memory range) saves the state of the failed kernel. The saved
     image can help you with the subsequent analysis.
    </p></li><li class="listitem"><p>
     Booting without GRUB 2 configuration
    </p><p>
     When the system boots a kernel with Kexec, it skips the boot loader
     stage. The normal booting procedure can fail because of an error in the
     boot loader configuration. With Kexec, you do not depend on a working
     boot loader configuration.
    </p></li></ul></div></section><section class="sect1" id="cha-tuning-kexec-pkgs" data-id-title="Required packages"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.2 </span><span class="title-name">Required packages</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kexec-pkgs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To use Kexec on <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span> to speed up reboots or avoid potential
   hardware problems, make sure that the package
   <code class="systemitem">kexec-tools</code> is installed. It contains a script
   called <code class="command">kexec-bootloader</code>, which reads the boot loader
   configuration and runs Kexec using the same kernel options as the normal
   boot loader.
  </p><p>
   To set up an environment that helps you obtain debug information in case of
   a kernel crash, make sure that the package
   <code class="systemitem">makedumpfile</code> is installed.
  </p><p>
   The preferred method of using Kdump in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> is through the YaST
   Kdump module. To use the YaST module, make sure that the package
   <code class="literal">yast2-kdump</code> is installed.
  </p></section><section class="sect1" id="cha-tuning-kexec-internals" data-id-title="Kexec internals"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.3 </span><span class="title-name">Kexec internals</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kexec-internals">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The most important component of Kexec is the
   <code class="filename">/sbin/kexec</code> command. You can load a kernel with Kexec
   in two different ways:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Load the kernel to the address space of a production kernel for a regular
     reboot:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">kexec</code> <code class="option">-l</code> <em class="replaceable">KERNEL_IMAGE</em></pre></div><p>
     You can later boot to this kernel with <code class="command">kexec</code>
     <code class="option">-e</code>.
    </p></li><li class="listitem"><p>
     Load the kernel to a reserved area of memory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">kexec</code> <code class="option">-p</code> <em class="replaceable">KERNEL_IMAGE</em></pre></div><p>
     This kernel is booted automatically when the system crashes.
    </p></li></ul></div><p>
   To boot another kernel and preserve the data of the production
   kernel when the system crashes, you need to reserve a dedicated area of the
   system memory. The production kernel never loads to this area because it
   must be always available. It is used for the capture kernel so that the
   memory pages of the production kernel can be preserved.
  </p><p>
   To reserve the area, append the option <code class="option">crashkernel</code> to the
   boot command line of the production kernel. To determine the necessary
   values for <code class="option">crashkernel</code>, follow the instructions in
   <a class="xref" href="#sec-tuning-kexec-crashkernel" title="18.4. Calculating crashkernel allocation size">Section 18.4, “Calculating <code class="option">crashkernel</code> allocation size”</a>.
  </p><p>
   This is not a parameter of the capture kernel. The capture kernel
   does not use Kexec.
  </p><p>
   The capture kernel is loaded to the reserved area and waits for the kernel
   to crash. Then, Kdump tries to invoke the capture kernel because the
   production kernel is no longer reliable at this stage. This means that even
   Kdump can fail.
  </p><p>
   To load the capture kernel, you need to include the kernel boot parameters.
   In most cases, the initial RAM file system is used for booting. You can specify it
   with
   <code class="option">--initrd</code><code class="literal">=</code><em class="replaceable">FILENAME</em>.
   With
   <code class="option">--append</code><code class="literal">=</code><em class="replaceable">CMDLINE</em>,
   you append options to the command line of the kernel to boot.
  </p><p>
   It is required to include the command line of the production kernel. You can
   simply copy the command line with
   <code class="option">--append</code><code class="literal">=</code><em class="replaceable">"$(cat
   /proc/cmdline)"</em> or add more options with
   <code class="option">--append</code><code class="literal">=</code><em class="replaceable">"$(cat
   /proc/cmdline) more_options"</em>.
  </p><p>
   For example, to load the <code class="filename">/boot/vmlinuz-6.4.0-150600.9-default</code> kernel image
   with the command line of the currently running production kernel and the
   <code class="filename">/boot/initrd</code> file, run the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code> kexec -l /boot/vmlinuz-6.4.0-150600.9-default \
 --append="$(cat /proc/cmdline)" --initrd=/boot/initrd</pre></div><p>
   You can always unload the previously loaded kernel. To unload a kernel that
   was loaded with the <code class="option">-l</code> option, use the
   <code class="command">kexec</code> <code class="option">-u</code> command. To unload a crash
   kernel loaded with the <code class="option">-p</code> option, use
   <code class="command">kexec</code> <code class="option">-p</code> <code class="option">-u</code> command.
  </p></section><section class="sect1" id="sec-tuning-kexec-crashkernel" data-id-title="Calculating crashkernel allocation size"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.4 </span><span class="title-name">Calculating <code class="option">crashkernel</code> allocation size</span></span> <a title="Permalink" class="permalink" href="#sec-tuning-kexec-crashkernel">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To use Kexec with a capture kernel and to use Kdump in any way, RAM
   needs to be allocated for the capture kernel. The allocation size depends on
   the expected hardware configuration of the computer, therefore you need to
   specify it.
  </p><p>
   The allocation size also depends on the hardware architecture of your
   computer. Make sure to follow the procedure intended for your system
   architecture.
  </p><div class="procedure" id="id-1.8.8.3.7.4" data-id-title="Allocation size on AMD64/Intel 64"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 18.1: </span><span class="title-name">Allocation size on AMD64/Intel 64 </span></span><a title="Permalink" class="permalink" href="#id-1.8.8.3.7.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     To find out the base value for the computer, run the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">kdumptool</code> calibrate
Total: 49074
Low: 72
High: 180
MinLow: 72
MaxLow: 3085
MinHigh: 0
MaxHigh: 45824</pre></div><p>
     All values are given in megabytes.
    </p></li><li class="step"><p>
     Take note of the values of <code class="literal">Low</code> and
     <code class="literal">High</code>.
    </p><div id="id-1.8.8.3.7.4.3.2" data-id-title="Significance of Low and High values" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Significance of <code class="literal">Low</code> and <code class="literal">High</code> values</div><p>
      On AMD64/Intel 64 computers, the <code class="literal">High</code> value stands for the
      memory reservation for all available memory. The <code class="literal">Low</code>
      value stands for the memory reservation in the DMA32 zone, that is, all
      the memory up to the 4 GB mark.
      
     </p><p>
      
      SIZE_LOW is the amount of memory required by 32-bit-only devices. The
      kernel allocates 64M for DMA32 bounce buffers. If your server does
      not have any 32-bit-only devices, everything should work with the default
      allocation of 72M for <code class="literal">SIZE_LOW</code>. A possible exception
      to this is on NUMA machines, which may make it appear that more
      <code class="literal">Low</code> memory is needed. The Kdump kernel may be booted
      with <code class="literal">numa=off</code> to make sure normal kernel allocations
      do not use <code class="literal">Low</code> memory.
     </p></div></li><li class="step"><p>
     Adapt the <code class="literal">High</code> value from the previous step for the
     number of LUN kernel paths (paths to storage devices) attached to the
     computer. A sensible value in megabytes can be calculated using this
     formula:
    </p><div class="verbatim-wrap"><pre class="screen">SIZE_HIGH = <em class="replaceable">RECOMMENDATION</em> + (<em class="replaceable">LUNs</em> / 2)</pre></div><p>
     The following parameters are used in this formula:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title">SIZE_HIGH. </span>
        The resulting value for <code class="literal">High</code>.
       </p></li><li class="listitem"><p><span class="formalpara-title">RECOMMENDATION. </span>
        The value recommended by <code class="command">kdumptool calibrate</code> for
        <code class="literal">High</code>.
       </p></li><li class="listitem"><p><span class="formalpara-title">LUNs. </span>
        The maximum number of LUN kernel paths that you expect to ever create
        on the computer. Exclude multipath devices from this number, as these
        are ignored. To get the <span class="emphasis"><em>current</em></span> number of LUNs available on your
        system, run the following command:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code> cat /proc/scsi/scsi | grep Lun | wc -l</pre></div></li></ul></div></li><li class="step"><p>
     If the drivers for your device make many reservations in the DMA32 zone,
     the <code class="literal">Low</code> value also needs to be adjusted. However, there
     is no simple formula to calculate these. Finding the right size can
     therefore be a process of trial and error.
    </p><p>
     For the beginning, use the <code class="literal">Low</code> value recommended by
     <code class="command">kdumptool calibrate</code>.
    </p></li><li class="step"><p>
     The values now need to be set in the correct location.
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.8.3.7.4.6.2.1"><span class="term">If you are changing the kernel command line directly</span></dt><dd><p>
        Append the following kernel option to your boot loader configuration:
       </p><div class="verbatim-wrap"><pre class="screen">crashkernel=<em class="replaceable">SIZE_HIGH</em>,high crashkernel=<em class="replaceable">SIZE_LOW</em>,low</pre></div><p>
        Replace the placeholders <em class="replaceable">SIZE_HIGH</em> and
        <em class="replaceable">SIZE_LOW</em> with the appropriate value from the
        previous steps and append the letter <code class="literal">M</code> (for
        megabytes).
       </p><p>
        As an example, the following is valid:
       </p><div class="verbatim-wrap"><pre class="screen">crashkernel=<em class="replaceable">36M</em>,high crashkernel=<em class="replaceable">72M</em>,low</pre></div></dd><dt id="id-1.8.8.3.7.4.6.2.2"><span class="term">If you are using the YaST GUI:</span></dt><dd><p>
        Set <span class="guimenu">Kdump Low Memory</span> to the determined
        <code class="literal">Low</code> value.
       </p><p>
        Set <span class="guimenu">Kdump High Memory</span> to the determined
        <code class="literal">High</code> value.
       </p></dd><dt id="id-1.8.8.3.7.4.6.2.3"><span class="term">If you are using the YaST command line interface:</span></dt><dd><p>
        Use the following command:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>yast kdump startup enable alloc_mem=<em class="replaceable">LOW</em>,<em class="replaceable">HIGH</em></pre></div><p>
        Replace <em class="replaceable">LOW</em> with the determined
        <code class="literal">Low</code> value. Replace <em class="replaceable">HIGH</em>
        with the determined <code class="literal">HIGH</code> value.
       </p></dd></dl></div></li></ol></div></div><div id="id-1.8.8.3.7.5" data-id-title="Excluding unused and inactive CCW devices on IBM Z" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Excluding unused and inactive CCW devices on IBM Z</div><p>
    Depending on the number of available devices the calculated amount of
    memory specified by the <code class="option">crashkernel</code> kernel parameter may
    not be sufficient. Instead of increasing the value, you may alternatively
    limit the amount of devices visible to the kernel. This lowers the
    required amount of memory for the <span class="emphasis"><em>crashkernel</em></span> setting.
   </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
      To ignore devices you can run the <code class="command">cio_ignore</code> tool to
      generate an appropriate stanza to ignore all devices, except the ones
      currently active or in use.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> cio_ignore -u -k
cio_ignore=all,!da5d,!f500-f502</pre></div><p>
      When you run <code class="command">cio_ignore -u -k</code>, the blocklist becomes active and replaces any existing blocklist immediately. Unused
      devices are not being purged, so they still appear in the channel
      subsystem. But adding new channel devices (via CP ATTACH under z/VM or
      dynamic I/O configuration change in LPAR) treats them as blocked.
      To prevent this, preserve the original setting by running <code class="command">sudo
      cio_ignore -l</code> first and reverting to that state after running
      <code class="command">cio_ignore -u -k</code>. As an alternative, add the generated
      stanza to the regular kernel boot parameters.
     </p></li><li class="listitem"><p>
      Now add the <code class="option">cio_ignore</code> kernel parameter with the stanza
      from above to <code class="envar">KDUMP_CMDLINE_APPEND</code> in
      <code class="filename">/etc/sysconfig/kdump</code>, for example:
     </p><div class="verbatim-wrap"><pre class="screen">KDUMP_COMMANDLINE_APPEND="cio_ignore=all,!da5d,!f500-f502"</pre></div></li><li class="listitem"><p>
      Activate the setting by restarting
      <code class="systemitem">kdump</code>:
     </p><div class="verbatim-wrap"><pre class="screen">systemctl restart kdump.service</pre></div></li></ol></div></div></section><section class="sect1" id="cha-tuning-kexec-basic-usage" data-id-title="Basic Kexec usage"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.5 </span><span class="title-name">Basic Kexec usage</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kexec-basic-usage">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To use Kexec, ensure the respective service is enabled and running:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Make sure the Kexec service is loaded at system start:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable kexec-load.service</pre></div></li><li class="listitem"><p>
     Make sure the Kexec service is running:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start kexec-load.service</pre></div></li></ul></div><p>
   To verify if your Kexec environment works properly, try rebooting into a
   new Kernel with Kexec. Make sure no users are currently logged in and no
   important services are running on the system. Then run the following
   command:
  </p><div class="verbatim-wrap"><pre class="screen">systemctl kexec</pre></div><p>
   The new kernel previously loaded to the address space of the older kernel
   rewrites it and takes control immediately. It displays the usual start-up
   messages. When the new kernel boots, it skips all hardware and firmware
   checks. Make sure no warning messages appear.
  </p><div id="id-1.8.8.3.8.7" data-id-title="Using Kexec with the reboot command" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Using Kexec with the reboot command</div><p>
    To make <code class="command">reboot</code> use Kexec rather than performing a
    regular reboot, run the following command:
   </p><div class="verbatim-wrap"><pre class="screen">ln -s /usr/lib/systemd/system/kexec.target /etc/systemd/system/reboot.target</pre></div><p>
    You can revert this at any time by deleting
    <code class="filename">etc/systemd/system/reboot.target</code>.
   </p></div></section><section class="sect1" id="cha-tuning-kexec-config" data-id-title="How to configure Kexec for routine reboots"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.6 </span><span class="title-name">How to configure Kexec for routine reboots</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kexec-config">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Kexec is often used for frequent reboots. For example, if it takes a long
   time to run through the hardware detection routines or if the start-up is
   not reliable.
  </p><p>
   The firmware and the boot loader are not used when the system reboots
   with Kexec. Any changes you make to the boot loader configuration are ignored until the computer performs a hard reboot.
  </p></section><section class="sect1" id="cha-tuning-kdump-basic" data-id-title="Basic Kdump configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.7 </span><span class="title-name">Basic Kdump configuration</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kdump-basic">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can use Kdump to save kernel dumps. If the kernel crashes, it is
   useful to copy the memory image of the crashed environment to the file
   system. You can then debug the dump file to find the cause of the kernel
   crash. This is called <span class="quote">“<span class="quote">core dump</span>”</span>.
  </p><p>
   Kdump works similarly to Kexec (see <a class="xref" href="#cha-tuning-kexec" title="Chapter 18. Kexec and Kdump">Chapter 18, <em>Kexec and Kdump</em></a>).
   The capture kernel is executed after the running production kernel crashes.
   The difference is that Kexec replaces the production kernel with the
   capture kernel. With Kdump, you still have access to the memory space of
   the crashed production kernel. You can save the memory snapshot of the
   crashed kernel in the environment of the Kdump kernel.
  </p><div id="id-1.8.8.3.10.4" data-id-title="Dumps over network" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Dumps over network</div><p>
    In environments with limited local storage, you need to set up kernel dumps
    over the network. Kdump supports configuring the specified network
    interface and bringing it up via <code class="systemitem">initrd</code>. Both LAN
    and VLAN interfaces are supported. Specify the network interface and the
    mode (DHCP or static) either with YaST, or using the
    <code class="option">KDUMP_NETCONFIG</code> option in the
    <code class="filename">/etc/sysconfig/kdump</code> file.
   </p></div><div id="id-1.8.8.3.10.5" data-id-title="Target file system for Kdump must be mounted during configuration" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Target file system for Kdump must be mounted during configuration</div><p>
    When configuring Kdump, you can specify a location to which the dumped
    images are saved (default: <code class="filename">/var/crash</code>). This
    location must be mounted when configuring Kdump, otherwise the
    configuration fails.
   </p></div><section class="sect2" id="cha-tuning-kdump-basic-manual" data-id-title="Manual Kdump configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.7.1 </span><span class="title-name">Manual Kdump configuration</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kdump-basic-manual">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Kdump reads its configuration from the
    <code class="filename">/etc/sysconfig/kdump</code> file. To make sure that Kdump
    works on your system, its default configuration is sufficient. To use
    Kdump with the default settings, follow these steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Determine the amount of memory needed for Kdump by following the
      instructions in <a class="xref" href="#sec-tuning-kexec-crashkernel" title="18.4. Calculating crashkernel allocation size">Section 18.4, “Calculating <code class="option">crashkernel</code> allocation size”</a>. Make sure
      to set the kernel parameter <code class="option">crashkernel</code>.
     </p></li><li class="step"><p>
      Reboot the computer.
     </p></li><li class="step"><p>
      Enable the Kdump service:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">systemctl</code> enable kdump</pre></div></li><li class="step"><p>
      You can edit the options in <code class="filename">/etc/sysconfig/kdump</code>.
      Reading the comments helps you understand the meaning of individual
      options.
     </p></li><li class="step"><p>
      Execute the init script once with <code class="command">sudo systemctl start
      kdump</code>, or reboot the system.
     </p></li></ol></div></div><p>
    After configuring Kdump with the default values, check if it works as
    expected. Make sure that no users are currently logged in and no important
    services are running on your system. Then follow these steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Switch to the rescue target with <code class="command">systemctl isolate
      rescue.target</code>
     </p></li><li class="step"><p>
      Restart the Kdump service:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">systemctl</code> start kdump</pre></div></li><li class="step"><p>
      Unmount all the disk file systems except the root file system with:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">umount</code> -a</pre></div></li><li class="step"><p>
      Remount the root file system in read-only mode:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount</code> -o remount,ro /</pre></div></li><li class="step"><p>
      Invoke a <span class="quote">“<span class="quote">kernel panic</span>”</span> with the <code class="literal">procfs</code>
      interface to Magic SysRq keys:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">echo</code> c &gt; /proc/sysrq-trigger</pre></div></li></ol></div></div><div id="id-1.8.8.3.10.6.6" data-id-title="Size of kernel dumps" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Size of kernel dumps</div><p>
     The <code class="literal">KDUMP_KEEP_OLD_DUMPS</code> option controls the number of
     preserved kernel dumps (default is 5). Without compression, the size of
     the dump can take up to the size of the physical memory or RAM. Make sure you
     have sufficient space on the <code class="filename">/var</code> partition.
    </p></div><p>
    The capture kernel boots and the crashed kernel memory snapshot is saved to
    the file system. The save path is given by the
    <code class="literal">KDUMP_SAVEDIR</code> option and it defaults to
    <code class="filename">/var/crash</code>. If
    <code class="literal">KDUMP_IMMEDIATE_REBOOT</code> is set to <code class="literal">yes</code>
    , the system automatically reboots the production kernel. Log in and check
    that the dump has been created under <code class="filename">/var/crash</code>.
   </p></section><section class="sect2" id="cha-tuning-kdump-basic-yast" data-id-title="YaST configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.7.2 </span><span class="title-name">YaST configuration</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kdump-basic-yast">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To configure Kdump with YaST, you need to install the
    <code class="systemitem">yast2-kdump</code> package. Then either start the
    <span class="guimenu">Kernel Kdump</span> module in the <span class="guimenu">System</span>
    category of <span class="guimenu">YaST Control Center</span>, or enter <code class="command">yast2 kdump</code> in the
    command line as <code class="systemitem">root</code>.
   </p><div class="figure" id="fig-tuning-kdump-basic-yast-kdump1"><div class="figure-contents"><div class="mediaobject"><a href="images/yast2_kdump_startup.png"><img src="images/yast2_kdump_startup.png" width="70%" alt="Screenshot of the YaST Kdump Module" title="Screenshot of the YaST Kdump Module"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 18.1: </span><span class="title-name">YaST Kdump module: start-up page </span></span><a title="Permalink" class="permalink" href="#fig-tuning-kdump-basic-yast-kdump1">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div><p>
    In the <span class="guimenu">Start-Up</span> window, select <span class="guimenu">Enable
    Kdump</span>.
   </p><p>
    The values for <span class="guimenu">Kdump Memory</span> are automatically
    generated the first time you open the window. However, that does not mean
    that they are always sufficient. To set the right values, follow the
    instructions in <a class="xref" href="#sec-tuning-kexec-crashkernel" title="18.4. Calculating crashkernel allocation size">Section 18.4, “Calculating <code class="option">crashkernel</code> allocation size”</a>.
   </p><div id="id-1.8.8.3.10.7.6" data-id-title="After hardware changes, set Kdump memory values again" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: After hardware changes, set <span class="guimenu">Kdump memory</span> values again</div><p>
     If you have set up Kdump on a computer and later decide to change the
     amount of RAM or hard disks available to it, YaST continues to
     display and use outdated memory values.
    </p><p>
     To work around this, determine the necessary memory again, as described in
     <a class="xref" href="#sec-tuning-kexec-crashkernel" title="18.4. Calculating crashkernel allocation size">Section 18.4, “Calculating <code class="option">crashkernel</code> allocation size”</a>. Then set it manually in
     YaST.
    </p></div><p>
    Click <span class="guimenu">Dump Filtering</span> in the left pane, and check what
    pages to include in the dump. You do not need to include the following
    memory content to be able to debug kernel problems:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Pages filled with zero
     </p></li><li class="listitem"><p>
      Cache pages
     </p></li><li class="listitem"><p>
      User data pages
     </p></li><li class="listitem"><p>
      Free pages
     </p></li></ul></div><p>
    In the <span class="guimenu">Dump Target</span> window, select the type of the dump
    target and the URL where you want to save the dump. If you selected a
    network protocol, such as FTP or SSH, you need to enter relevant access
    information as well.
   </p><div id="id-1.8.8.3.10.7.10" data-id-title="Sharing the dump directory with other applications" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Sharing the dump directory with other applications</div><p>
     It is possible to specify a path for saving Kdump dumps where other
     applications also save their dumps. When cleaning its old dump files,
     Kdump safely ignores other applications' dump files.
    </p></div><p>
    Fill the <span class="guimenu">Email Notification</span> window information if you
    want Kdump to inform you about its events via e-mail and confirm your
    changes with <span class="guimenu">OK</span> after fine tuning Kdump in the
    <span class="guimenu">Expert Settings</span> window. Kdump is now configured.
   </p></section><section class="sect2" id="cha-tuning-kdump-ssh" data-id-title="Kdump over SSH"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.7.3 </span><span class="title-name">Kdump over SSH</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kdump-ssh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Dump files usually contain sensitive data which should be protected from
    unauthorized disclosure. To allow transmission of such data over an
    insecure network, Kdump can save dump files to a remote machine using the
    SSH protocol.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      The target host identity must be known to Kdump. This is needed to
      ensure that sensitive data is never sent to an imposter. When Kdump
      generates a new <code class="systemitem">initrd</code>, it runs
      <code class="command">ssh-keygen -F <em class="replaceable">TARGET_HOST</em></code>
      to query the target host's identity. This works only if
      <em class="replaceable">TARGET_HOST</em> public key is already known. An
      easy way to achieve that is to make an SSH connection to
      <em class="replaceable">TARGET_HOST</em> as <code class="systemitem">root</code> on the Kdump host.
     </p></li><li class="step"><p>
      Kdump must be able to authenticate to the target machine. Only public
      key authentication is currently available. By default, Kdump uses
      <code class="systemitem">root</code>'s private key, but it is advisable to make a separate key for
      Kdump. This can be done with <code class="command">ssh-keygen</code>:
     </p><ol type="a" class="substeps"><li class="step"><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">ssh-keygen</code> -f <em class="replaceable">~/.ssh/kdump_key</em></pre></div></li><li class="step"><p>
        Press <span class="keycap">Enter</span> when prompted for passphrase (that is,
        do not use any passphrase).
       </p></li><li class="step"><p>
        Open <code class="filename">/etc/sysconfig/kdump</code> and set
        <code class="literal">KDUMP_SSH_IDENTITY</code> to
        <em class="replaceable">kdump_key</em>. You can use full path to the file
        if it is not placed under <code class="filename">~/.ssh</code>.
       </p></li></ol></li><li class="step"><p>
      Set up the Kdump SSH key to authorize logins to the remote host.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">ssh-copy-id</code> -i <em class="replaceable">~/.ssh/kdump_key</em> <em class="replaceable">TARGET_HOST</em></pre></div></li><li class="step"><p>
      Set up <code class="literal">KDUMP_SAVEDIR</code>. There are two options:
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.8.3.10.8.3.4.2.1"><span class="term">Secure File Transfer Protocol (SFTP)</span></dt><dd><p>
         SFTP is the preferred method for transmitting files over SSH. The
         target host must enable the SFTP subsystem (<span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> default). Example:
        </p><div class="verbatim-wrap"><pre class="screen">KDUMP_SAVEDIR=sftp://<em class="replaceable">TARGET_HOST</em><em class="replaceable">/path/to/dumps</em></pre></div></dd><dt id="id-1.8.8.3.10.8.3.4.2.2"><span class="term">Secure Shell protocol (SSH)</span></dt><dd><p>
         Some other distributions use SSH to run certain commands on the target
         host. <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> can also use this method. The Kdump user on the
         target host must have a login shell that can execute these commands:
         <code class="command">mkdir</code>, <code class="command">dd</code> and
         <code class="command">mv</code>. Example:
        </p><div class="verbatim-wrap"><pre class="screen">KDUMP_SAVEDIR=ssh://<em class="replaceable">TARGET_HOST</em><em class="replaceable">/path/to/dumps</em></pre></div></dd></dl></div></li><li class="step"><p>
      Restart the Kdump service to use the new configuration.
     </p></li></ol></div></div></section></section><section class="sect1" id="cha-tuning-kdump-analyze" data-id-title="Analyzing the crash dump"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.8 </span><span class="title-name">Analyzing the crash dump</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kdump-analyze">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   After you obtain the dump, it is time to analyze it. There are several
   options.
  </p><p>
   The original tool to analyze the dumps is GDB. You can even use it in the
   latest environments, although it has several disadvantages and limitations:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     GDB was not specifically designed to debug kernel dumps.
    </p></li><li class="listitem"><p>
     GDB does not support ELF64 binaries on 32-bit platforms.
    </p></li><li class="listitem"><p>
     GDB does not understand other formats than ELF dumps (it cannot debug
     compressed dumps).
    </p></li></ul></div><p>
   That is why the <code class="command">crash</code> utility was implemented. It
   analyzes crash dumps and debugs the running system as well. It provides
   functionality specific to debugging the Linux kernel and is much more
   suitable for advanced debugging.
  </p><p>
   To debug the Linux kernel, install its debugging
   information package, too. Check if the package is installed on your
   system with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">zypper</code> se kernel | <code class="command">grep</code> debug</pre></div><div id="id-1.8.8.3.11.8" data-id-title="Repository for packages with debugging information" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Repository for packages with debugging information</div><p>
    If you subscribed your system for online updates, you can find
    <span class="quote">“<span class="quote">debuginfo</span>”</span> packages in the
    <code class="literal">*-Debuginfo-Updates</code> online installation repository
    relevant for <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP6</span></span>. Use YaST to enable the
    repository.
   </p></div><p>
   To open the captured dump in <code class="command">crash</code> on the machine that
   produced the dump, use a command like this:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="command">crash</code> <em class="replaceable">/boot/vmlinux-6.4.0-150600.9-default.gz</em> \
<em class="replaceable">/var/crash/2024-04-23-11\:17/vmcore</em></pre></div><p>
   The first parameter represents the kernel image. The second parameter is the
   dump file captured by Kdump. You can find this file under
   <code class="filename">/var/crash</code> by default.
  </p><div id="id-1.8.8.3.11.12" data-id-title="Getting basic information from a kernel crash dump" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Getting basic information from a kernel crash dump</div><p>
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> ships with the utility <code class="command">kdumpid</code> (included
    in a package with the same name) for identifying unknown kernel dumps. It
    can be used to extract basic information such as architecture and kernel
    release. It supports lkcd, diskdump, Kdump files and ELF dumps. When
    called with the <code class="option">-v</code> switch it tries to extract additional
    information such as machine type, kernel banner string and kernel
    configuration flavor.
   </p></div><section class="sect2" id="cha-tuning-kdump-analyze-binformat" data-id-title="Kernel binary formats"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.8.1 </span><span class="title-name">Kernel binary formats</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kdump-analyze-binformat">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The Linux kernel comes in Executable and Linkable Format (ELF). This file
    is called <code class="literal">vmlinux</code> and is directly generated in
    the compilation process. Not all boot loaders support ELF binaries,
    especially on the AMD64/Intel 64 architecture. The following solutions exist on
    different architectures supported by <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span>.
   </p><section class="sect3" id="cha-tuning-kdump-analyze-binformat-x86" data-id-title="AMD64/Intel 64"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">18.8.1.1 </span><span class="title-name">AMD64/Intel 64</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kdump-analyze-binformat-x86">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Kernel packages for AMD64/Intel 64 from SUSE contain two kernel files:
     <code class="filename">vmlinuz</code> and <code class="filename">vmlinux.gz</code>.
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title"><code class="filename">vmlinuz</code>. </span>
        This is the file executed by the boot loader.
       </p><p>
       The Linux kernel consists of two parts: the kernel itself
       (<code class="literal">vmlinux</code>) and the setup code run by the boot loader.
       These two parts are linked together to create
       <code class="filename">vmlinuz</code> (note the distinction: <code class="literal">z</code>
       compared to <code class="literal">x</code>).
      </p><p>
       In the kernel source tree, the file is called
       <code class="filename">bzImage</code>.
      </p></li><li class="listitem"><p><span class="formalpara-title"><code class="filename">vmlinux.gz</code>. </span>
        This is a compressed ELF image that can be used by
        <code class="command">crash</code> and GDB. The ELF image is never used by the
        boot loader itself on AMD64/Intel 64. Therefore, only a compressed version is
        shipped.
       </p></li></ul></div></section><section class="sect3" id="cha-tuning-kdump-analyze-binformat-ppc" data-id-title="POWER"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">18.8.1.2 </span><span class="title-name">POWER</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kdump-analyze-binformat-ppc">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The <code class="systemitem">yaboot</code> boot loader on POWER also supports
     loading ELF images, but not compressed ones. In the POWER kernel
     package, there is an ELF Linux kernel file <code class="filename">vmlinux</code>.
     Considering <code class="command">crash</code>, this is the easiest architecture.
    </p><p>
     If you decide to analyze the dump on another machine, you must check both
     the architecture of the computer and the files necessary for debugging.
    </p><p>
     You can analyze the dump on another computer only if it runs a Linux
     system of the same architecture. To check the compatibility, use the
     command <code class="command">uname</code> <code class="option">-i</code> on both computers and
     compare the outputs.
    </p><p>
     If you are going to analyze the dump on another computer, you also need
     the appropriate files from the <code class="systemitem">kernel</code> and
     <code class="systemitem">kernel debug</code> packages.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Put the kernel dump, the kernel image from <code class="filename">/boot</code>,
       and its associated debugging info file from
       <code class="filename">/usr/lib/debug/boot</code> into a single empty directory.
      </p></li><li class="step"><p>
       Additionally, copy the kernel modules from
       <code class="filename">/lib/modules/$(uname -r)/kernel/</code> and the associated
       debug info files from <code class="filename">/usr/lib/debug/lib/modules/$(uname
       -r)/kernel/</code> into a subdirectory named
       <code class="filename">modules</code>.
      </p></li><li class="step"><p>
       In the directory with the dump, the kernel image, its debug info file,
       and the <code class="filename">modules</code> subdirectory, start the
       <code class="command">crash</code> utility:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">crash</code> <em class="replaceable">VMLINUX-VERSION vmcore</em></pre></div></li></ol></div></div><p>
     Regardless of the computer on which you analyze the dump, the crash
     utility produces output similar to this:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">crash</code> <em class="replaceable">/boot/vmlinux-6.4.0-150600.9-default.gz</em> \
<em class="replaceable">/var/crash/2024-04-23-11\:17/vmcore</em>
crash 7.2.1
Copyright (C) 2002-2017  Red Hat, Inc.
Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
Copyright (C) 1999-2006  Hewlett-Packard Co
Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
Copyright (C) 2005, 2011  NEC Corporation
Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
This program is free software, covered by the GNU General Public License,
and you are welcome to change it and/or distribute copies of it under
certain conditions.  Enter "help copying" to see the conditions.
This program has absolutely no warranty.  Enter "help warranty" for details.

GNU gdb (GDB) 7.6
Copyright (C) 2013 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-unknown-linux-gnu".

      KERNEL: /boot/vmlinux-6.4.0-150600.9-default.gz
   DEBUGINFO: /usr/lib/debug/boot/vmlinux-6.4.0-150600.9-default.debug
    DUMPFILE: /var/crash/2024-04-23-11:17/vmcore
        CPUS: 2
        DATE: Thu Apr 23 13:17:01 2024
      UPTIME: 00:10:41
LOAD AVERAGE: 0.01, 0.09, 0.09
       TASKS: 42
    NODENAME: eros
     RELEASE: 6.4.0-150600.9-default
     VERSION: #1 SMP 2024-03-31 14:50:44 +0200
     MACHINE: x86_64  (2999 Mhz)
      MEMORY: 16 GB
       PANIC: "SysRq : Trigger a crashdump"
         PID: 9446
     COMMAND: "bash"
        TASK: ffff88003a57c3c0  [THREAD_INFO: ffff880037168000]
         CPU: 1
       STATE: TASK_RUNNING (SYSRQ)
<code class="prompt user">crash&gt; </code></pre></div><p>
     The command output prints first useful data: There were 42 tasks running
     at the moment of the kernel crash. The cause of the crash was a SysRq
     trigger invoked by the task with PID 9446. It was a Bash process because
     the <code class="command">echo</code> that has been used is an internal command of
     the Bash shell.
    </p><p>
     The <code class="command">crash</code> utility builds upon GDB and provides many
     additional commands. If you enter <code class="command">bt</code> without any
     parameters, the backtrace of the task running at the moment of the crash
     is printed:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">crash&gt; </code><code class="command">bt</code>
PID: 9446   TASK: ffff88003a57c3c0  CPU: 1   COMMAND: "bash"
 #0 [ffff880037169db0] crash_kexec at ffffffff80268fd6
 #1 [ffff880037169e80] __handle_sysrq at ffffffff803d50ed
 #2 [ffff880037169ec0] write_sysrq_trigger at ffffffff802f6fc5
 #3 [ffff880037169ed0] proc_reg_write at ffffffff802f068b
 #4 [ffff880037169f10] vfs_write at ffffffff802b1aba
 #5 [ffff880037169f40] sys_write at ffffffff802b1c1f
 #6 [ffff880037169f80] system_call_fastpath at ffffffff8020bfbb
    RIP: 00007fa958991f60  RSP: 00007fff61330390  RFLAGS: 00010246
    RAX: 0000000000000001  RBX: ffffffff8020bfbb  RCX: 0000000000000001
    RDX: 0000000000000002  RSI: 00007fa959284000  RDI: 0000000000000001
    RBP: 0000000000000002   R8: 00007fa9592516f0   R9: 00007fa958c209c0
    R10: 00007fa958c209c0  R11: 0000000000000246  R12: 00007fa958c1f780
    R13: 00007fa959284000  R14: 0000000000000002  R15: 00000000595569d0
    ORIG_RAX: 0000000000000001  CS: 0033  SS: 002b
<code class="prompt user">crash&gt; </code></pre></div><p>
     Now it is clear what happened: The internal <code class="command">echo</code>
     command of Bash shell sent a character to
     <code class="filename">/proc/sysrq-trigger</code>. After the corresponding handler
     recognized this character, it invoked the <code class="literal">crash_kexec()</code>
     function. This function called <code class="literal">panic()</code> and Kdump
     saved a dump.
    </p><p>
     In addition to the basic GDB commands and the extended version of
     <code class="command">bt</code>, the crash utility defines other commands related to
     the structure of the Linux kernel. These commands understand the internal
     data structures of the Linux kernel and present their contents in a human
     readable format. For example, you can list the tasks running at the moment
     of the crash with <code class="command">ps</code>. With <code class="command">sym</code>, you
     can list all the kernel symbols with the corresponding addresses, or
     inquire an individual symbol for its value. With <code class="command">files</code>,
     you can display all the open file descriptors of a process. With
     <code class="command">kmem</code>, you can display details about the kernel memory
     usage. With <code class="command">vm</code>, you can inspect the virtual memory of a
     process, even at the level of individual page mappings. The list of useful
     commands is long, and many of these accept a wide range of options.
    </p><p>
     The commands that we mentioned reflect the functionality of the common
     Linux commands, such as <code class="command">ps</code> and <code class="command">lsof</code>.
     To find out the exact sequence of events with the debugger, you need to
     know how to use GDB and to have strong debugging skills. Both of these are
     out of the scope of this document. Additionally, you need to understand the
     Linux kernel. Several useful reference information sources are given at
     the end of this document.
    </p></section></section></section><section class="sect1" id="cha-tuning-kdump-advanced" data-id-title="Advanced Kdump configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.9 </span><span class="title-name">Advanced Kdump configuration</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kdump-advanced">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The configuration for Kdump is stored in
   <code class="filename">/etc/sysconfig/kdump</code>. You can also use YaST to
   configure it. Kdump configuration options are available under
   <span class="guimenu">System</span> › <span class="guimenu">Kernel
   Kdump</span> in <span class="guimenu">YaST Control Center</span>. The following Kdump options may
   be useful for you.
  </p><p>
   You can change the directory for the kernel dumps with the
   <code class="option">KDUMP_SAVEDIR</code> option. Keep in mind that the size of kernel
   dumps can be large. Kdump refuses to save the dump if the free
   disk space, subtracted by the estimated dump size, drops below the value
   specified by the <code class="option">KDUMP_FREE_DISK_SIZE</code> option. <code class="option">KDUMP_SAVEDIR</code> understands the URL format
   <em class="replaceable">PROTOCOL://SPECIFICATION</em>, where
   <em class="replaceable">PROTOCOL</em> is one of <code class="option">file</code>,
   <code class="option">ftp</code>, <code class="option">sftp</code>, <code class="option">nfs</code> or
   <code class="option">cifs</code>, and <code class="option">specification</code> varies for each
   protocol. For example, to save kernel dump on an FTP server, use the
   following URL as a template:
   <code class="option">ftp://username:password@ftp.example.com:123/var/crash</code>.
  </p><p>
   Kernel dumps are large and contain many pages that are not necessary
   for analysis. With <code class="option">KDUMP_DUMPLEVEL</code> option, you can omit
   such pages. The option understands numeric value between 0 and 31. If you
   specify <em class="replaceable">0</em>, the dump size is the largest. If you
   specify <em class="replaceable">31</em>, it produces the smallest dump.
   For a complete table of possible values, see the manual page of
   <code class="command">kdump</code> (<code class="command">man 7 kdump</code>).
  </p><p>
   Sometimes it is useful to make the size of the kernel dump smaller. For
   example, you can do so to transfer the dump over the network or to
   save disk space in the dump directory. This can be done with
   <code class="option">KDUMP_DUMPFORMAT</code> set to <code class="literal">compressed</code>. The
   <code class="command">crash</code> utility supports dynamic decompression of the
   compressed dumps.
  </p><div id="id-1.8.8.3.12.6" data-id-title="Changes to the Kdump configuration file" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Changes to the Kdump configuration file</div><p>
    After making changes to the <code class="filename">/etc/sysconfig/kdump</code>
    file, you need to run <code class="command">systemctl restart kdump.service</code>.
    Otherwise, the changes only take effect next time you reboot the
    system.
   </p></div></section><section class="sect1" id="cha-tuning-kdump-moreinfo" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.10 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-kdump-moreinfo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kexec.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There is no single comprehensive reference to Kexec and Kdump usage.
   However, there are helpful resources that deal with certain aspects:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     For the Kexec utility usage, see the manual page of
     <code class="command">kexec</code> (<code class="command">man 8 kexec</code>).
    </p></li><li class="listitem"><p>
     You can find general information about Kexec at
     <a class="link" href="https://developer.ibm.com/technologies/linux/" target="_blank">https://developer.ibm.com/technologies/linux/</a>.
    </p></li><li class="listitem"><p>
     For more details on Kdump specific to <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, see
     <a class="link" href="https://ftp.suse.com/pub/people/tiwai/kdump-training/kdump-training.pdf" target="_blank">https://ftp.suse.com/pub/people/tiwai/kdump-training/kdump-training.pdf</a>
     .
    </p></li><li class="listitem"><p>
     An in-depth description of Kdump internals can be found at
     <a class="link" href="https://lse.sourceforge.net/kdump/documentation/ols2oo5-kdump-paper.pdf" target="_blank">https://lse.sourceforge.net/kdump/documentation/ols2oo5-kdump-paper.pdf</a>
     .
    </p></li></ul></div><p>
   For more details on <code class="command">crash</code> dump analysis and debugging
   tools, use the following resources:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     In addition to the info page of GDB (<code class="command">info gdb</code>), there
     are printable guides at
     <a class="link" href="https://sourceware.org/gdb/documentation/" target="_blank">https://sourceware.org/gdb/documentation/</a> .
    </p></li><li class="listitem"><p>
     The crash utility features a comprehensive online help. Use
     <code class="command">help</code> <em class="replaceable">COMMAND</em> to display the
     online help for <code class="command">command</code>.
    </p></li><li class="listitem"><p>
     If you have the necessary Perl skills, you can use Alicia to make the
     debugging easier. This Perl-based front-end to the crash utility can be
     found at <a class="link" href="https://alicia.sourceforge.net/" target="_blank">https://alicia.sourceforge.net/</a> .
    </p></li><li class="listitem"><p>
     If you prefer to use Python instead, you should install Pykdump. This
     package helps you control GDB through Python scripts.
    </p></li><li class="listitem"><p>
     A comprehensive overview of the Linux kernel internals is given in
     <em class="citetitle">Understanding the Linux Kernel</em> by Daniel P. Bovet
     and Marco Cesati (ISBN 978-0-596-00565-8).
    </p></li></ul></div></section></section><section class="chapter" id="cha-tuning-systemd-coredump" data-id-title="Using systemd-coredump to debug application crashes"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">19 </span><span class="title-name">Using <code class="systemitem">systemd-coredump</code> to debug application crashes</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-systemd-coredump">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemd_coredump.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  <code class="systemitem">systemd-coredump</code> collects and displays core dumps, for analyzing
  application crashes. The core dump contains an image of the process's
  memory at the time of termination. By default, when a process crashes (or all
  processes belonging to an application), it stores the core dump in the
  <code class="filename">/var/lib/systemd/coredump</code> file and logs the core
  dump to the <code class="systemitem">systemd</code> journal, including a backtrace if possible. You also have the option
  to examine the dump file with other tools such as <code class="command">gdb</code>
  or <code class="command">crash</code> (see <a class="xref" href="#cha-tuning-kdump-analyze" title="18.8. Analyzing the crash dump">Section 18.8, “Analyzing the crash dump”</a>).
 </p><p>
  Core dumps stored in <code class="filename">/var/lib/systemd/coredump</code>
  are deleted after three days (see the
  <code class="literal">d /var/lib/systemd/coredump</code> line in
  <code class="filename">/usr/lib/tmpfiles.d/systemd.conf</code>).
 </p><p>
  There is an option to not store core dumps, but to log only to the
  journal, which may be useful to minimize the collection and storage of
  sensitive information.
  </p><section class="sect1" id="sect-sys-coredump-default" data-id-title="Use and configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.1 </span><span class="title-name">Use and configuration</span></span> <a title="Permalink" class="permalink" href="#sect-sys-coredump-default">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemd_coredump.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="systemitem">systemd-coredump</code> is enabled and ready to run by default. The default
   configuration is in <code class="filename">/etc/systemd/coredump.conf</code>:
  </p><div class="verbatim-wrap"><pre class="screen">[Coredump]
#Storage=external
#Compress=yes
#ProcessSizeMax=2G
#ExternalSizeMax=2G
#JournalSizeMax=767M
#MaxUse=
#KeepFree=</pre></div><p>
   Size units are B, K, M, G, T, P, and E. <code class="literal">ExternalSizeMax</code> also supports a value of <code class="literal">infinity</code>.
   
  </p><p>
   The following example shows how to use Vim for simple testing, by creating a
   segfault to generate journal entries and a core dump.
  </p><div class="procedure" id="pro-test-coredump" data-id-title="Creating a core dump with Vim"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 19.1: </span><span class="title-name">Creating a core dump with Vim </span></span><a title="Permalink" class="permalink" href="#pro-test-coredump">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_systemd_coredump.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Enable the <code class="systemitem">debuginfo-pool</code> and
     <code class="systemitem">debuginfo-update</code> repositories
    </p></li><li class="step"><p>
     Install <span class="package">vim-debuginfo</span>
    </p></li><li class="step"><p>
     Launch <code class="command">vim testfile</code> and type a few characters
    </p></li><li class="step"><p>
     Get the PID and generate a segfault:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ps ax | grep vim
2345 pts/3    S+     0:00 vim testfile

<code class="prompt root"># </code>kill -s SIGSEGV 2345</pre></div><p>
    Vim emits error messages:
</p><div class="verbatim-wrap"><pre class="screen">Vim: Caught deadly signal SEGV
Vim: Finished.
Segmentation fault (core dumped)</pre></div></li><li class="step"><p>
     List your core dumps, then examine them:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>coredumpctl
TIME                        PID  UID  GID SIG PRESENT EXE
Wed 2019-11-12 11:56:47 PST 2345 1000 100 11  *       /bin/vim

<code class="prompt root"># </code>coredumpctl info
PID: 2345 (vim)
UID: 0 (root)
GID: 0 (root)
Signal: 11 (SEGV)
Timestamp: Wed 2019-11-12 11:58:05 PST
Command Line: vim testfile
Executable: /bin/vim
Control Group: /user.slice/user-1000.slice/session-1.scope
    Unit: session-1.scope
    Slice: user-1000.slice
    Session: 1
    Owner UID: 1000 (tux)
    Boot ID: b5c251b86ab34674a2222cef102c0c88
    Machine ID: b43c44a64696799b985cafd95dc1b698
    Hostname: linux-uoch
    Coredump: /var/lib/systemd/coredump/core.vim.0.b5c251b86ab34674a2222cef102
    Message: Process 2345 (vim) of user 0 dumped core.

         Stack trace of thread 2345:
         #0  0x00007f21dd87e2a7 kill (libc.so.6)
         #1  0x000000000050cb35 may_core_dump (vim)
         #2  0x00007f21ddbfec70 __restore_rt (libpthread.so.0)
         #3  0x00007f21dd92ea33 __select (libc.so.6)
         #4  0x000000000050b4e3 RealWaitForChar (vim)
         #5  0x000000000050b86b mch_inchar (vim)
[...]</pre></div></li></ol></div></div><p>
   When you have multiple core dumps, <code class="command">coredumpctl info</code>
   displays all of them. Filter them by <code class="literal">PID</code>,
   <code class="literal">COMM</code> (command), or <code class="literal">EXE</code> (full path to
   the executable). For example, all core dumps for Vim:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>coredumpctl info /bin/vim</pre></div><p>
   See a single core dump by <code class="literal">PID</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>coredumpctl info 2345</pre></div><p>
      Output the selected core to <code class="command">gdb</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>coredumpctl gdb 2345</pre></div><p>
   The asterisk in the <code class="literal">PRESENT</code> column indicates that a
   stored core dump is present. If the field is empty there is no stored core
   dump, and <code class="command">coredumpctl</code> retrieves crash information from
   the journal. You can control this behavior in
   <code class="filename">/etc/systemd/coredump.conf</code> with the
   <code class="literal">Storage</code> option:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="literal">Storage=none</code>—core dumps are logged in the journal, but
     not stored. This is useful to minimize collecting and storing sensitive
     information, for example for General Data Protection Regulation (GDPR)
     compliance.
    </p></li><li class="listitem"><p>
     <code class="literal">Storage=external</code>—cores are stored in
     <code class="filename">/var/lib/systemd/coredump</code>
    </p></li><li class="listitem"><p>
     <code class="literal">Storage=journal</code>—cores are stored in the <code class="systemitem">systemd</code>
     journal
    </p></li></ul></div><p>
   A new instance of <code class="systemitem">systemd-coredump</code> is invoked for every core dump, so
   configuration changes are applied with the next core dump, and there is no
   need to restart any services.
  </p><p>
   Core dumps are not preserved after a system restart. You may save them
   permanently with <code class="command">coredumpctl</code>. The following example
   filters by the <code class="literal">PID</code> and stores the core in
   <code class="filename">vim.dump</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>coredumpctl -o vim.dump dump 2345</pre></div><p>
   See <code class="command">man systemd-coredump</code>, <code class="command">man
   coredumpctl</code>, <code class="command">man core</code>, and
  <code class="command">man coredump.conf</code> for complete
   command and option listings.
  </p></section></section></div><div class="part" id="part-tuning-ptp" data-id-title="Synchronized clocks with Precision Time Protocol"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part VII </span><span class="title-name">Synchronized clocks with Precision Time Protocol </span></span><a title="Permalink" class="permalink" href="#part-tuning-ptp">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_tuning.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-tuning-ptp"><span class="title-number">20 </span><span class="title-name">Precision Time Protocol</span></a></span></li><dd class="toc-abstract"><p>For network environments, it is vital to keep the computer and other devices' clocks synchronized and accurate. There are several solutions to achieve synchronicity and accuracy, for example, the widely used Network Time Protocol (NTP) described in Book “Administration Guide”, Chapter 39 “Time synch…</p></dd></ul></div><section class="chapter" id="cha-tuning-ptp" data-id-title="Precision Time Protocol"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">20 </span><span class="title-name">Precision Time Protocol</span></span> <a title="Permalink" class="permalink" href="#cha-tuning-ptp">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  For network environments, it is vital to keep the computer and other devices'
  clocks synchronized and accurate. There are several solutions to achieve
  synchronicity and accuracy, for example, the widely used Network Time Protocol (NTP) described in
  <span class="intraxref">Book “Administration Guide”, Chapter 39 “Time synchronization with NTP”</span>.
 </p><p>
  The Precision Time Protocol (PTP) is a protocol capable of sub-microsecond accuracy, which is
  better than what NTP achieves. PTP support is divided between the kernel and
  user space. The kernel in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> includes support for PTP clocks,
  which are provided by network drivers.
 </p><section class="sect1" id="tuning-ptp-intro" data-id-title="Introduction to PTP"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.1 </span><span class="title-name">Introduction to PTP</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The clocks managed by PTP follow a master-slave hierarchy. The slaves are
   synchronized to their masters. The hierarchy is updated by the
   <span class="emphasis"><em>best master clock</em></span> (BMC) algorithm, which runs on every
   clock. The clock with only one port can be either master or slave. Such a
   clock is called an <span class="emphasis"><em>ordinary clock</em></span> (OC). A clock with
   multiple ports can be master on one port and slave on another. Such a clock
   is called a <span class="emphasis"><em>boundary clock</em></span> (BC). The top-level master
   is called the <span class="emphasis"><em>grandmaster clock</em></span>. The grandmaster clock
   can be synchronized with a Global Positioning System (GPS). This way
   disparate networks can be synchronized with a high degree of accuracy.
  </p><p>
   The hardware support is the main advantage of PTP. It is supported by
   several network switches and network interface controllers (NIC). While it
   is possible to use non-PTP enabled hardware within the network, having
   network components between all PTP clocks PTP hardware enabled achieves the
   best possible accuracy.
  </p><section class="sect2" id="tuning-ptp-linuxptp" data-id-title="PTP Linux implementation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.1.1 </span><span class="title-name">PTP Linux implementation</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-linuxptp">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    On <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, the implementation of PTP is provided by the
    <code class="systemitem">linuxptp</code> package. Install it with <code class="command">zypper
    install linuxptp</code>. It includes the <code class="command">ptp4l</code> and
    <code class="command">phc2sys</code> programs for clock synchronization.
    <code class="command">ptp4l</code> implements the PTP boundary clock and ordinary
    clock. When hardware time stamping is enabled, <code class="command">ptp4l</code>
    synchronizes the PTP hardware clock to the master clock. With software time
    stamping, it synchronizes the system clock to the master clock.
    <code class="command">phc2sys</code> is needed only with hardware time stamping to
    synchronize the system clock to the PTP hardware clock on the network
    interface card (NIC).
   </p></section></section><section class="sect1" id="tuning-ptp-using" data-id-title="Using PTP"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.2 </span><span class="title-name">Using PTP</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-using">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="tuning-ptp-driver-support" data-id-title="Network driver and hardware support"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.2.1 </span><span class="title-name">Network driver and hardware support</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-driver-support">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    PTP requires that the used kernel network driver supports either software
    or hardware time stamping. Moreover, the NIC must support time stamping in
    the physical hardware. You can verify the driver and NIC time stamping
    capabilities with <code class="command">ethtool</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ethtool -T eth0
Time stamping parameters for eth0:
Capabilities:
hardware-transmit     (SOF_TIMESTAMPING_TX_HARDWARE)
        software-transmit     (SOF_TIMESTAMPING_TX_SOFTWARE)
        hardware-receive      (SOF_TIMESTAMPING_RX_HARDWARE)
        software-receive      (SOF_TIMESTAMPING_RX_SOFTWARE)
        software-system-clock (SOF_TIMESTAMPING_SOFTWARE)
        hardware-raw-clock    (SOF_TIMESTAMPING_RAW_HARDWARE)
PTP Hardware Clock: 0
Hardware Transmit Timestamp Modes:
        off                   (HWTSTAMP_TX_OFF)
        on                    (HWTSTAMP_TX_ON)
Hardware Receive Filter Modes:
        none                  (HWTSTAMP_FILTER_NONE)
        all                   (HWTSTAMP_FILTER_ALL)</pre></div><p>
    Software time stamping requires the following parameters:
   </p><div class="verbatim-wrap"><pre class="screen">SOF_TIMESTAMPING_SOFTWARE
SOF_TIMESTAMPING_TX_SOFTWARE
SOF_TIMESTAMPING_RX_SOFTWARE</pre></div><p>
    Hardware time stamping requires the following parameters:
   </p><div class="verbatim-wrap"><pre class="screen">SOF_TIMESTAMPING_RAW_HARDWARE
SOF_TIMESTAMPING_TX_HARDWARE
SOF_TIMESTAMPING_RX_HARDWARE</pre></div></section><section class="sect2" id="tuning-ptp-ptp41" data-id-title="Using ptp4l"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.2.2 </span><span class="title-name">Using <code class="command">ptp4l</code></span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-ptp41">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">ptp4l</code> uses hardware time stamping by default. As
    <code class="systemitem">root</code>, you need to specify the network interface capable of hardware
    time stamping with the <code class="option">-i</code> option. The <code class="option">-m</code>
    tells <code class="command">ptp4l</code> to print its output to the standard output
    instead of the system's logging facility:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ptp4l -m -i eth0
selected eth0 as PTP clock
port 1: INITIALIZING to LISTENING on INITIALIZE
port 0: INITIALIZING to LISTENING on INITIALIZE
port 1: new foreign master 00a152.fffe.0b334d-1
selected best master clock 00a152.fffe.0b334d
port 1: LISTENING to UNCALIBRATED on RS_SLAVE
master offset -25937 s0 freq +0 path delay       12340
master offset -27887 s0 freq +0 path delay       14232
master offset -38802 s0 freq +0 path delay       13847
master offset -36205 s1 freq +0 path delay       10623
master offset  -6975 s2 freq -30575 path delay   10286
port 1: UNCALIBRATED to SLAVE on MASTER_CLOCK_SELECTED
master offset  -4284 s2 freq -30135 path delay    9892</pre></div><p>
    The <code class="literal">master offset</code> value represents the measured offset
    from the master (in nanoseconds).
   </p><p>
    The <code class="literal">s0</code>, <code class="literal">s1</code> and <code class="literal">s2</code>
    indicators show the different states of the clock servo:
    <code class="literal">s0</code> is unlocked, <code class="literal">s1</code> is clock step, and
    <code class="literal">s2</code> is locked. If the servo is in the locked state
    (<code class="literal">s2</code>), the clock is not stepped (only slowly
    adjusted) if the <code class="option">pi_offset_const</code> option is set to a
    negative value in the configuration file (see <code class="command">man 8
    ptp4l</code> for more information).
   </p><p>
    The <code class="literal">freq</code> value represents the frequency adjustment of
    the clock (in parts per billion, ppb).
   </p><p>
    The <code class="literal">path delay</code> value represents the estimated delay of
    the synchronization messages sent from the master (in nanoseconds).
   </p><p>
    Port 0 is a Unix domain socket used for local PTP management. Port 1 is the
    <code class="systemitem">eth0</code> interface.
   </p><p>
    <code class="literal">INITIALIZING</code>, <code class="literal">LISTENING</code>,
    <code class="literal">UNCALIBRATED</code> and <code class="literal">SLAVE</code> are examples
    of port states which change on <code class="literal">INITIALIZE</code>,
    <code class="literal">RS_SLAVE</code>, and <code class="literal">MASTER_CLOCK_SELECTED</code>
    events. When the port state changes from <code class="literal">UNCALIBRATED</code> to
    <code class="literal">SLAVE</code>, the computer has successfully synchronized with a
    PTP master clock.
   </p><p>
    You can enable software time stamping with the <code class="option">-S</code> option.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ptp4l -m -S -i eth3</pre></div><p>
    You can also run <code class="command">ptp4l</code> as a service:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start ptp4l</pre></div><p>
    In this case, <code class="command">ptp4l</code> reads its options from the
    <code class="filename">/etc/sysconfig/ptp4l</code> file. By default, this file tells
    <code class="command">ptp4l</code> to read the configuration options from
    <code class="filename">/etc/ptp4l.conf</code>. For more information on
    <code class="command">ptp4l</code> options and the configuration file settings, see
    <code class="command">man 8 ptp4l</code>.
   </p><p>
    To enable the <code class="command">ptp4l</code> service permanently, run the
    following:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable ptp4l</pre></div><p>
    To disable it, run
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl disable ptp4l</pre></div></section><section class="sect2" id="tuning-ptp-confile" data-id-title="ptp4l configuration file"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.2.3 </span><span class="title-name"><code class="command">ptp4l</code> configuration file</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-confile">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">ptp4l</code> can read its configuration from an optional
    configuration file. As no configuration file is used by default, you need
    to specify it with <code class="option">-f</code>.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ptp4l -f /etc/ptp4l.conf</pre></div><p>
    The configuration file is divided into sections. The global section
    (indicated as <code class="literal">[global]</code>) sets the program options, clock
    options and default port options. Other sections are port specific, and
    they override the default port options. The name of the section is the name
    of the configured port—for example, <code class="literal">[eth0]</code>. An
    empty port section can be used to replace the command line option.
   </p><div class="verbatim-wrap"><pre class="screen">[global]
verbose               1
time_stamping         software
[eth0]</pre></div><p>
    The example configuration file is an equivalent of the following command's
    options:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ptp4l -i eth0 -m -S</pre></div><p>
    For a complete list of <code class="command">ptp4l</code> configuration options, see
    <code class="command">man 8 ptp4l</code>.
   </p></section><section class="sect2" id="tuning-ptp-delay-measurement" data-id-title="Delay measurement"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.2.4 </span><span class="title-name">Delay measurement</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-delay-measurement">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">ptp4l</code> measures time delay in two different ways:
    <span class="emphasis"><em>peer-to-peer</em></span> (P2P) or <span class="emphasis"><em>end-to-end</em></span>
    (E2E).
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.9.2.6.6.3.1"><span class="term">P2P</span></dt><dd><p>
       This method is specified with <code class="option">-P</code>.
      </p><p>
       It reacts to changes in the network environment faster and is more
       accurate in measuring the delay. It is only used in networks where each
       port exchanges PTP messages with one other port. P2P needs to be
       supported by all hardware on the communication path.
      </p></dd><dt id="id-1.8.9.2.6.6.3.2"><span class="term">E2E</span></dt><dd><p>
       This method is specified with <code class="option">-E</code>. This is the default.
      </p></dd><dt id="id-1.8.9.2.6.6.3.3"><span class="term">Automatic method selection</span></dt><dd><p>
       This method is specified with <code class="option">-A</code>. The automatic option
       starts <code class="command">ptp4l</code> in E2E mode, and changes to P2P mode if
       a peer delay request is received.
      </p></dd></dl></div><div id="id-1.8.9.2.6.6.4" data-id-title="Common measurement method" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Common measurement method</div><p>
     All clocks on a single PTP communication path must use the same method to
     measure the time delay. A warning is printed if either a peer delay
     request is received on a port using the E2E mechanism, or an E2E delay
     request is received on a port using the P2P mechanism.
    </p></div></section><section class="sect2" id="tuning-ptp-pmc" data-id-title="PTP management client: pmc"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.2.5 </span><span class="title-name">PTP management client: <code class="command">pmc</code></span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-pmc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can use the <code class="command">pmc</code> client to obtain more detailed
    information about <code class="command">ptp41</code>. It reads from the standard
    input—or from the command line—actions specified by name and
    management ID. Then it sends the actions over the selected transport, and
    prints any received replies. There are three actions supported:
    <code class="command">GET</code> retrieves the specified information,
    <code class="command">SET</code> updates the specified information, and
    <code class="command">CMD</code> (or <code class="command">COMMAND</code>) initiates the
    specified event.
   </p><p>
    By default, the management commands are addressed to all ports. The
    <code class="command">TARGET</code> command can be used to select a particular clock
    and port for the subsequent messages. For a complete list of management
    IDs, run <code class="command">pmc help</code>.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> pmc -u -b 0 'GET TIME_STATUS_NP'
sending: GET TIME_STATUS_NP
        90f2ca.fffe.20d7e9-0 seq 0 RESPONSE MANAGEMENT TIME_STATUS_NP
                master_offset              283
                ingress_time               1361569379345936841
                cumulativeScaledRateOffset   +1.000000000
                scaledLastGmPhaseChange    0
                gmTimeBaseIndicator        0
                lastGmPhaseChange          0x0000'0000000000000000.0000
                gmPresent                  true
                gmIdentity                 00b058.feef.0b448a</pre></div><p>
    The <code class="option">-b</code> option specifies the boundary hops value in sent
    messages. Setting it to zero limits the boundary to the local
    <code class="command">ptp4l</code> instance. Increasing the value retrieves the
    messages also from PTP nodes that are further from the local instance. The
    returned information may include:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.9.2.6.7.6.1"><span class="term">stepsRemoved</span></dt><dd><p>
       The number of communication nodes to the grandmaster clock.
      </p></dd><dt id="id-1.8.9.2.6.7.6.2"><span class="term">offsetFromMaster, master_offset</span></dt><dd><p>
       The last measured offset of the clock from the master clock
       (nanoseconds).
      </p></dd><dt id="id-1.8.9.2.6.7.6.3"><span class="term">meanPathDelay</span></dt><dd><p>
       The estimated delay of the synchronization messages sent from the master
       clock (nanoseconds).
      </p></dd><dt id="id-1.8.9.2.6.7.6.4"><span class="term">gmPresent</span></dt><dd><p>
       If <code class="literal">true</code>, the PTP clock is synchronized to the master
       clock; the local clock is not the grandmaster clock.
      </p></dd><dt id="id-1.8.9.2.6.7.6.5"><span class="term">gmIdentity</span></dt><dd><p>
       This is the grandmaster's identity.
      </p></dd></dl></div><p>
    For a complete list of <code class="command">pmc</code> command line options, see
    <code class="command">man 8 pmc</code>.
   </p></section></section><section class="sect1" id="tuning-ptp-phc2sys" data-id-title="Synchronizing the clocks with phc2sys"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.3 </span><span class="title-name">Synchronizing the clocks with <code class="command">phc2sys</code></span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-phc2sys">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use <code class="command">phc2sys</code> to synchronize the system clock to the PTP
   hardware clock (PHC) on the network card. The system clock is considered a
   <span class="emphasis"><em>slave</em></span>, while the network card a
   <span class="emphasis"><em>master</em></span>. PHC itself is synchronized with
   <code class="command">ptp4l</code> (see <a class="xref" href="#tuning-ptp-using" title="20.2. Using PTP">Section 20.2, “Using PTP”</a>). Use
   <code class="option">-s</code> to specify the master clock by device or network
   interface. Use <code class="option">-w</code> to wait until <code class="command">ptp4l</code> is
   in a synchronized state.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> phc2sys -s eth0 -w</pre></div><p>
   PTP operates in <span class="emphasis"><em>International Atomic Time</em></span> (TAI), while
   the system clock uses <span class="emphasis"><em>Coordinated Universal Time</em></span> (UTC).
   If you do not specify <code class="option">-w</code> to wait for
   <code class="command">ptp4l</code> synchronization, you can specify the offset in
   seconds between TAI and UTC with <code class="option">-O</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> phc2sys -s eth0 -O -35</pre></div><p>
   You can run <code class="command">phc2sys</code> as a service as well:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start phc2sys</pre></div><p>
   In this case, <code class="command">phc2sys</code> reads its options from the
   <code class="filename">/etc/sysconfig/phc2sys</code> file. For more information on
   <code class="command">phc2sys</code> options, see <code class="command">man 8 phc2sys</code>.
  </p><p>
   To enable the <code class="command">phc2sys</code> service permanently, run the
   following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable phc2sys</pre></div><p>
   To disable it, run
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl disable phc2sys</pre></div><section class="sect2" id="tuning-ptp-phc2sys-verify" data-id-title="Verifying time synchronization"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.3.1 </span><span class="title-name">Verifying time synchronization</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-phc2sys-verify">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When PTP time synchronization is working properly and hardware time
    stamping is used, <code class="command">ptp4l</code> and <code class="command">phc2sys</code>
    output messages with time offsets and frequency adjustments periodically to
    the system log.
   </p><p>
    An example of the <code class="command">ptp4l</code> output:
   </p><div class="verbatim-wrap"><pre class="screen">ptp4l[351.358]: selected /dev/ptp0 as PTP clock
ptp4l[352.361]: port 1: INITIALIZING to LISTENING on INITIALIZE
ptp4l[352.361]: port 0: INITIALIZING to LISTENING on INITIALIZE
ptp4l[353.210]: port 1: new foreign master 00a069.eefe.0b442d-1
ptp4l[357.214]: selected best master clock 00a069.eefe.0b662d
ptp4l[357.214]: port 1: LISTENING to UNCALIBRATED on RS_SLAVE
ptp4l[359.224]: master offset       3304 s0 freq      +0 path delay      9202
ptp4l[360.224]: master offset       3708 s1 freq  -28492 path delay      9202
ptp4l[361.224]: master offset      -3145 s2 freq  -32637 path delay      9202
ptp4l[361.224]: port 1: UNCALIBRATED to SLAVE on MASTER_CLOCK_SELECTED
ptp4l[362.223]: master offset       -145 s2 freq  -30580 path delay      9202
ptp4l[363.223]: master offset       1043 s2 freq  -28436 path delay      8972
[...]
ptp4l[371.235]: master offset        285 s2 freq  -28511 path delay      9199
ptp4l[372.235]: master offset        -78 s2 freq  -28788 path delay      9204</pre></div><p>
    An example of the <code class="command">phc2sys</code> output:
   </p><div class="verbatim-wrap"><pre class="screen">phc2sys[616.617]: Waiting for ptp4l...
phc2sys[628.628]: phc offset     66341 s0 freq      +0 delay   2729
phc2sys[629.628]: phc offset     64668 s1 freq  -37690 delay   2726
[...]
phc2sys[646.630]: phc offset      -333 s2 freq  -37426 delay   2747
phc2sys[646.630]: phc offset       194 s2 freq  -36999 delay   2749</pre></div><p>
    <code class="command">ptp4l</code> normally writes messages with high frequency. You can
    reduce the frequency with the <code class="literal">summary_interval</code>
    directive. Its value is an exponent of the 2^N expression. For example, to
    reduce the output to every 1024 (which is equal to 2^10) seconds, add the
    following line to the <code class="filename">/etc/ptp4l.conf</code> file:
   </p><div class="verbatim-wrap"><pre class="screen">summary_interval 10</pre></div><p>
    You can also reduce the frequency of the <code class="command">phc2sys</code>
    command's updates with the <code class="option">-u
    <em class="replaceable">SUMMARY-UPDATES</em></code> option.
   </p></section></section><section class="sect1" id="tuning-ptp-examples" data-id-title="Examples of configurations"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.4 </span><span class="title-name">Examples of configurations</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-examples">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section includes several examples of <code class="command">ptp4l</code>
   configuration. The examples are not full configuration files but rather a
   minimal list of changes to be made to the specific files. The string
   <em class="replaceable">ethX</em> stands for the actual network interface name
   in your setup.
  </p><div class="complex-example"><div class="example" id="id-1.8.9.2.8.3" data-id-title="Slave clock using software time stamping"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 20.1: </span><span class="title-name">Slave clock using software time stamping </span></span><a title="Permalink" class="permalink" href="#id-1.8.9.2.8.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    No changes made to the distribution <code class="filename">/etc/ptp4l.conf</code>.
   </p></div></div></div><div class="complex-example"><div class="example" id="id-1.8.9.2.8.4" data-id-title="Slave clock using hardware time stamping"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 20.2: </span><span class="title-name">Slave clock using hardware time stamping </span></span><a title="Permalink" class="permalink" href="#id-1.8.9.2.8.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    <code class="filename">/etc/sysconfig/phc2sys</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-s ethX -w”</pre></div><p>
    No changes made to the distribution <code class="filename">/etc/ptp4l.conf</code>.
   </p></div></div></div><div class="complex-example"><div class="example" id="id-1.8.9.2.8.5" data-id-title="Master clock using hardware time stamping"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 20.3: </span><span class="title-name">Master clock using hardware time stamping </span></span><a title="Permalink" class="permalink" href="#id-1.8.9.2.8.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    <code class="filename">/etc/sysconfig/phc2sys</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-s CLOCK_REALTIME -c ethX -w”</pre></div><p>
    <code class="filename">/etc/ptp4l.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">priority1 127</pre></div></div></div></div><div class="complex-example"><div class="example" id="id-1.8.9.2.8.6" data-id-title="Master clock using software time stamping (not generally recommended)"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 20.4: </span><span class="title-name">Master clock using software time stamping (not generally recommended) </span></span><a title="Permalink" class="permalink" href="#id-1.8.9.2.8.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    <code class="filename">/etc/ptp4l.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">priority1 127</pre></div></div></div></div></section><section class="sect1" id="tuning-ptp-ntp" data-id-title="PTP and NTP"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.5 </span><span class="title-name">PTP and NTP</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-ntp">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   NTP and PTP time synchronization tools can coexist, synchronizing time from
   one to another in both directions.
  </p><section class="sect2" id="tuning-ptp-ntp2ptp" data-id-title="NTP to PTP synchronization"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.1 </span><span class="title-name">NTP to PTP synchronization</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-ntp2ptp">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When <code class="systemitem">chronyd</code> is used to synchronize the local system clock, you can
    configure the <code class="command">ptp4l</code> to be the grandmaster clock
    distributing the time from the local system clock via PTP. Include the
    <code class="option">priority1</code> option in <code class="filename">/etc/ptp4l.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">[global]
priority1 127
[eth0]</pre></div><p>
    Then run <code class="command">ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> ptp4l -f /etc/ptp4l.conf</pre></div><p>
    When hardware time stamping is used, you need to synchronize the PTP
    hardware clock to the system clock with <code class="command">phc2sys</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> phc2sys -c eth0 -s CLOCK_REALTIME -w</pre></div></section><section class="sect2" id="tuning-ptp-ptp2ntp" data-id-title="Configuring PTP-NTP bridge"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">20.5.2 </span><span class="title-name">Configuring PTP-NTP bridge</span></span> <a title="Permalink" class="permalink" href="#tuning-ptp-ptp2ntp">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_ptp.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If a highly accurate PTP grandmaster is available in a network without
    switches or routers with PTP support, a computer may operate as a PTP slave
    and a stratum-1 NTP server. Such a computer needs to have two or more
    network interfaces, and be close to the grandmaster or have a direct
    connection to it. This ensures highly accurate synchronization in the
    network.
   </p><p>
    Configure the <code class="command">ptp4l</code> and <code class="command">phc2sys</code>
    programs to use one network interface to synchronize the system clock using
    PTP. Then configure <code class="systemitem">chronyd</code> to provide the system time using the other
    interface:
   </p><div class="verbatim-wrap"><pre class="screen">bindaddress 192.0.131.47
hwtimestamp eth1
local stratum 1</pre></div><div id="id-1.8.9.2.9.4.5" data-id-title="NTP and DHCP" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: NTP and DHCP</div><p>
     When the DHCP client command <code class="command">dhclient</code> receives a list
     of NTP servers, it adds them to NTP configuration by default. To prevent
     this behavior, set
    </p><div class="verbatim-wrap"><pre class="screen">NETCONFIG_NTP_POLICY=""</pre></div><p>
     in the <code class="filename">/etc/sysconfig/network/config</code> file.
    </p></div></section></section></section></div><div class="legal-section"><section class="appendix" id="id-1.8.10" data-id-title="GNU licenses"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">A </span><span class="title-name">GNU licenses</span></span> <a title="Permalink" class="permalink" href="#id-1.8.10">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_legal.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This appendix contains the GNU Free Documentation License version 1.2.
 </p><section class="sect1" id="id-1.8.10.4" data-id-title="GNU Free Documentation License"><div class="titlepage"><div><div><div class="title-container"><h2 class="title legal"><span class="title-number-name"><span class="title-name">GNU Free Documentation License</span></span> <a title="Permalink" class="permalink" href="#id-1.8.10.4">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_license_gfdl1.2.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc. 51 Franklin St,
  Fifth Floor, Boston, MA 02110-1301 USA. Everyone is permitted to copy and
  distribute verbatim copies of this license document, but changing it is not
  allowed.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.4"><span class="name">
    0. PREAMBLE
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.4">#</a></h5></div><p>
  The purpose of this License is to make a manual, textbook, or other
  functional and useful document "free" in the sense of freedom: to assure
  everyone the effective freedom to copy and redistribute it, with or without
  modifying it, either commercially or non-commercially. Secondarily, this
  License preserves for the author and publisher a way to get credit for their
  work, while not being considered responsible for modifications made by
  others.
 </p><p>
  This License is a kind of "copyleft", which means that derivative works of
  the document must themselves be free in the same sense. It complements the
  GNU General Public License, which is a copyleft license designed for free
  software.
 </p><p>
  We have designed this License to use it for manuals for free software,
  because free software needs free documentation: a free program should come
  with manuals providing the same freedoms that the software does. But this
  License is not limited to software manuals; it can be used for any textual
  work, regardless of subject matter or whether it is published as a printed
  book. We recommend this License principally for works whose purpose is
  instruction or reference.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.8"><span class="name">
    1. APPLICABILITY AND DEFINITIONS
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.8">#</a></h5></div><p>
  This License applies to any manual or other work, in any medium, that
  contains a notice placed by the copyright holder saying it can be distributed
  under the terms of this License. Such a notice grants a world-wide,
  royalty-free license, unlimited in duration, to use that work under the
  conditions stated herein. The "Document", below, refers to any such manual or
  work. Any member of the public is a licensee, and is addressed as "you". You
  accept the license if you copy, modify or distribute the work in a way
  requiring permission under copyright law.
 </p><p>
  A "Modified Version" of the Document means any work containing the Document
  or a portion of it, either copied verbatim, or with modifications and/or
  translated into another language.
 </p><p>
  A "Secondary Section" is a named appendix or a front-matter section of the
  Document that deals exclusively with the relationship of the publishers or
  authors of the Document to the Document's overall subject (or to related
  matters) and contains nothing that could fall directly within that overall
  subject. (Thus, if the Document is in part a textbook of mathematics, a
  Secondary Section may not explain any mathematics.) The relationship could be
  a matter of historical connection with the subject or with related matters,
  or of legal, commercial, philosophical, ethical or political position
  regarding them.
 </p><p>
  The "Invariant Sections" are certain Secondary Sections whose titles are
  designated, as being those of Invariant Sections, in the notice that says
  that the Document is released under this License. If a section does not fit
  the above definition of Secondary then it is not allowed to be designated as
  Invariant. The Document may contain zero Invariant Sections. If the Document
  does not identify any Invariant Sections then there are none.
 </p><p>
  The "Cover Texts" are certain short passages of text that are listed, as
  Front-Cover Texts or Back-Cover Texts, in the notice that says that the
  Document is released under this License. A Front-Cover Text may be at most 5
  words, and a Back-Cover Text may be at most 25 words.
 </p><p>
  A "Transparent" copy of the Document means a machine-readable copy,
  represented in a format whose specification is available to the general
  public, that is suitable for revising the document straightforwardly with
  generic text editors or (for images composed of pixels) generic paint
  programs or (for drawings) some widely available drawing editor, and that is
  suitable for input to text formatters or for automatic translation to a
  variety of formats suitable for input to text formatters. A copy made in an
  otherwise Transparent file format whose markup, or absence of markup, has
  been arranged to thwart or discourage subsequent modification by readers is
  not Transparent. An image format is not Transparent if used for any
  substantial amount of text. A copy that is not "Transparent" is called
  "Opaque".
 </p><p>
  Examples of suitable formats for Transparent copies include plain ASCII
  without markup, Texinfo input format, LaTeX input format, SGML or XML using a
  publicly available DTD, and standard-conforming simple HTML, PostScript or
  PDF designed for human modification. Examples of transparent image formats
  include PNG, XCF and JPG. Opaque formats include proprietary formats that can
  be read and edited only by proprietary word processors, SGML or XML for which
  the DTD and/or processing tools are not generally available, and the
  machine-generated HTML, PostScript or PDF produced by some word processors
  for output purposes only.
 </p><p>
  The "Title Page" means, for a printed book, the title page itself, plus such
  following pages as are needed to hold, legibly, the material this License
  requires to appear in the title page. For works in formats which do not have
  any title page as such, "Title Page" means the text near the most prominent
  appearance of the work's title, preceding the beginning of the body of the
  text.
 </p><p>
  A section "Entitled XYZ" means a named subunit of the Document whose title
  either is precisely XYZ or contains XYZ in parentheses following text that
  translates XYZ in another language. (Here XYZ stands for a specific section
  name mentioned below, such as "Acknowledgements", "Dedications",
  "Endorsements", or "History".) To "Preserve the Title" of such a section when
  you modify the Document means that it remains a section "Entitled XYZ"
  according to this definition.
 </p><p>
  The Document may include Warranty Disclaimers next to the notice which states
  that this License applies to the Document. These Warranty Disclaimers are
  considered to be included by reference in this License, but only as regards
  disclaiming warranties: any other implication that these Warranty Disclaimers
  may have is void and has no effect on the meaning of this License.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.19"><span class="name">
    2. VERBATIM COPYING
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.19">#</a></h5></div><p>
  You may copy and distribute the Document in any medium, either commercially
  or non-commercially, provided that this License, the copyright notices, and
  the license notice saying this License applies to the Document are reproduced
  in all copies, and that you add no other conditions whatsoever to those of
  this License. You may not use technical measures to obstruct or control the
  reading or further copying of the copies you make or distribute. However, you
  may accept compensation in exchange for copies. If you distribute a large
  enough number of copies you must also follow the conditions in section 3.
 </p><p>
  You may also lend copies, under the same conditions stated above, and you may
  publicly display copies.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.22"><span class="name">
    3. COPYING IN QUANTITY
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.22">#</a></h5></div><p>
  If you publish printed copies (or copies in media that commonly have printed
  covers) of the Document, numbering more than 100, and the Document's license
  notice requires Cover Texts, you must enclose the copies in covers that
  carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the
  front cover, and Back-Cover Texts on the back cover. Both covers must also
  clearly and legibly identify you as the publisher of these copies. The front
  cover must present the full title with all words of the title equally
  prominent and visible. You may add other material on the covers in addition.
  Copying with changes limited to the covers, as long as they preserve the
  title of the Document and satisfy these conditions, can be treated as
  verbatim copying in other respects.
 </p><p>
  If the required texts for either cover are too voluminous to fit legibly, you
  should put the first ones listed (as many as fit reasonably) on the actual
  cover, and continue the rest onto adjacent pages.
 </p><p>
  If you publish or distribute Opaque copies of the Document numbering more
  than 100, you must either include a machine-readable Transparent copy along
  with each Opaque copy, or state in or with each Opaque copy a
  computer-network location from which the general network-using public has
  access to download using public-standard network protocols a complete
  Transparent copy of the Document, free of added material. If you use the
  latter option, you must take reasonably prudent steps, when you begin
  distribution of Opaque copies in quantity, to ensure that this Transparent
  copy will remain thus accessible at the stated location until at least one
  year after the last time you distribute an Opaque copy (directly or through
  your agents or retailers) of that edition to the public.
 </p><p>
  It is requested, but not required, that you contact the authors of the
  Document well before redistributing any large number of copies, to give them
  a chance to provide you with an updated version of the Document.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.27"><span class="name">
    4. MODIFICATIONS
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.27">#</a></h5></div><p>
  You may copy and distribute a Modified Version of the Document under the
  conditions of sections 2 and 3 above, provided that you release the Modified
  Version under precisely this License, with the Modified Version filling the
  role of the Document, thus licensing distribution and modification of the
  Modified Version to whoever possesses a copy of it. In addition, you must do
  these things in the Modified Version:
 </p><div class="orderedlist"><ol class="orderedlist" type="A"><li class="listitem"><p>
    Use in the Title Page (and on the covers, if any) a title distinct from
    that of the Document, and from those of previous versions (which should, if
    there were any, be listed in the History section of the Document). You may
    use the same title as a previous version if the original publisher of that
    version gives permission.
   </p></li><li class="listitem"><p>
    List on the Title Page, as authors, one or more persons or entities
    responsible for authorship of the modifications in the Modified Version,
    together with at least five of the principal authors of the Document (all
    of its principal authors, if it has fewer than five), unless they release
    you from this requirement.
   </p></li><li class="listitem"><p>
    State on the Title page the name of the publisher of the Modified Version,
    as the publisher.
   </p></li><li class="listitem"><p>
    Preserve all the copyright notices of the Document.
   </p></li><li class="listitem"><p>
    Add an appropriate copyright notice for your modifications adjacent to the
    other copyright notices.
   </p></li><li class="listitem"><p>
    Include, immediately after the copyright notices, a license notice giving
    the public permission to use the Modified Version under the terms of this
    License, in the form shown in the Addendum below.
   </p></li><li class="listitem"><p>
    Preserve in that license notice the full lists of Invariant Sections and
    required Cover Texts given in the Document's license notice.
   </p></li><li class="listitem"><p>
    Include an unaltered copy of this License.
   </p></li><li class="listitem"><p>
    Preserve the section Entitled "History", Preserve its Title, and add to it
    an item stating at least the title, year, new authors, and publisher of the
    Modified Version as given on the Title Page. If there is no section
    Entitled "History" in the Document, create one stating the title, year,
    authors, and publisher of the Document as given on its Title Page, then add
    an item describing the Modified Version as stated in the previous sentence.
   </p></li><li class="listitem"><p>
    Preserve the network location, if any, given in the Document for public
    access to a Transparent copy of the Document, and likewise the network
    locations given in the Document for previous versions it was based on.
    These may be placed in the "History" section. You may omit a network
    location for a work that was published at least four years before the
    Document itself, or if the original publisher of the version it refers to
    gives permission.
   </p></li><li class="listitem"><p>
    For any section Entitled "Acknowledgements" or "Dedications", Preserve the
    Title of the section, and preserve in the section all the substance and
    tone of each of the contributor acknowledgements and/or dedications given
    therein.
   </p></li><li class="listitem"><p>
    Preserve all the Invariant Sections of the Document, unaltered in their
    text and in their titles. Section numbers or the equivalent are not
    considered part of the section titles.
   </p></li><li class="listitem"><p>
    Delete any section Entitled "Endorsements". Such a section may not be
    included in the Modified Version.
   </p></li><li class="listitem"><p>
    Do not retitle any existing section to be Entitled "Endorsements" or to
    conflict in title with any Invariant Section.
   </p></li><li class="listitem"><p>
    Preserve any Warranty Disclaimers.
   </p></li></ol></div><p>
  If the Modified Version includes new front-matter sections or appendices that
  qualify as Secondary Sections and contain no material copied from the
  Document, you may at your option designate some or all of these sections as
  invariant. To do this, add their titles to the list of Invariant Sections in
  the Modified Version's license notice. These titles must be distinct from any
  other section titles.
 </p><p>
  You may add a section Entitled "Endorsements", provided it contains nothing
  but endorsements of your Modified Version by various parties--for example,
  statements of peer review or that the text has been approved by an
  organization as the authoritative definition of a standard.
 </p><p>
  You may add a passage of up to five words as a Front-Cover Text, and a
  passage of up to 25 words as a Back-Cover Text, to the end of the list of
  Cover Texts in the Modified Version. Only one passage of Front-Cover Text and
  one of Back-Cover Text may be added by (or through arrangements made by) any
  one entity. If the Document already includes a cover text for the same cover,
  previously added by you or by arrangement made by the same entity you are
  acting on behalf of, you may not add another; but you may replace the old
  one, on explicit permission from the previous publisher that added the old
  one.
 </p><p>
  The author(s) and publisher(s) of the Document do not by this License give
  permission to use their names for publicity for or to assert or imply
  endorsement of any Modified Version.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.34"><span class="name">
    5. COMBINING DOCUMENTS
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.34">#</a></h5></div><p>
  You may combine the Document with other documents released under this
  License, under the terms defined in section 4 above for modified versions,
  provided that you include in the combination all of the Invariant Sections of
  all of the original documents, unmodified, and list them all as Invariant
  Sections of your combined work in its license notice, and that you preserve
  all their Warranty Disclaimers.
 </p><p>
  The combined work need only contain one copy of this License, and multiple
  identical Invariant Sections may be replaced with a single copy. If there are
  multiple Invariant Sections with the same name but different contents, make
  the title of each such section unique by adding at the end of it, in
  parentheses, the name of the original author or publisher of that section if
  known, or else a unique number. Make the same adjustment to the section
  titles in the list of Invariant Sections in the license notice of the
  combined work.
 </p><p>
  In the combination, you must combine any sections Entitled "History" in the
  various original documents, forming one section Entitled "History"; likewise
  combine any sections Entitled "Acknowledgements", and any sections Entitled
  "Dedications". You must delete all sections Entitled "Endorsements".
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.38"><span class="name">
    6. COLLECTIONS OF DOCUMENTS
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.38">#</a></h5></div><p>
  You may make a collection consisting of the Document and other documents
  released under this License, and replace the individual copies of this
  License in the various documents with a single copy that is included in the
  collection, provided that you follow the rules of this License for verbatim
  copying of each of the documents in all other respects.
 </p><p>
  You may extract a single document from such a collection, and distribute it
  individually under this License, provided you insert a copy of this License
  into the extracted document, and follow this License in all other respects
  regarding verbatim copying of that document.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.41"><span class="name">
    7. AGGREGATION WITH INDEPENDENT WORKS
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.41">#</a></h5></div><p>
  A compilation of the Document or its derivatives with other separate and
  independent documents or works, in or on a volume of a storage or
  distribution medium, is called an "aggregate" if the copyright resulting from
  the compilation is not used to limit the legal rights of the compilation's
  users beyond what the individual works permit. When the Document is included
  in an aggregate, this License does not apply to the other works in the
  aggregate which are not themselves derivative works of the Document.
 </p><p>
  If the Cover Text requirement of section 3 is applicable to these copies of
  the Document, then if the Document is less than one half of the entire
  aggregate, the Document's Cover Texts may be placed on covers that bracket
  the Document within the aggregate, or the electronic equivalent of covers if
  the Document is in electronic form. Otherwise they must appear on printed
  covers that bracket the whole aggregate.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.44"><span class="name">
    8. TRANSLATION
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.44">#</a></h5></div><p>
  Translation is considered a kind of modification, so you may distribute
  translations of the Document under the terms of section 4. Replacing
  Invariant Sections with translations requires special permission from their
  copyright holders, but you may include translations of some or all Invariant
  Sections in addition to the original versions of these Invariant Sections.
  You may include a translation of this License, and all the license notices in
  the Document, and any Warranty Disclaimers, provided that you also include
  the original English version of this License and the original versions of
  those notices and disclaimers. In case of a disagreement between the
  translation and the original version of this License or a notice or
  disclaimer, the original version will prevail.
 </p><p>
  If a section in the Document is Entitled "Acknowledgements", "Dedications",
  or "History", the requirement (section 4) to Preserve its Title (section 1)
  will typically require changing the actual title.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.47"><span class="name">
    9. TERMINATION
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.47">#</a></h5></div><p>
  You may not copy, modify, sublicense, or distribute the Document except as
  expressly provided for under this License. Any other attempt to copy, modify,
  sublicense or distribute the Document is void, and will automatically
  terminate your rights under this License. However, parties who have received
  copies, or rights, from you under this License will not have their licenses
  terminated so long as such parties remain in full compliance.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.49"><span class="name">
    10. FUTURE REVISIONS OF THIS LICENSE
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.49">#</a></h5></div><p>
  The Free Software Foundation may publish new, revised versions of the GNU
  Free Documentation License from time to time. Such new versions will be
  similar in spirit to the present version, but may differ in detail to address
  new problems or concerns. See
  <a class="link" href="https://www.gnu.org/copyleft/" target="_blank">https://www.gnu.org/copyleft/</a>.
 </p><p>
  Each version of the License is given a distinguishing version number. If the
  Document specifies that a particular numbered version of this License "or any
  later version" applies to it, you have the option of following the terms and
  conditions either of that specified version or of any later version that has
  been published (not as a draft) by the Free Software Foundation. If the
  Document does not specify a version number of this License, you may choose
  any version ever published (not as a draft) by the Free Software Foundation.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.8.10.4.52"><span class="name">
    ADDENDUM: How to use this License for your documents
  </span><a title="Permalink" class="permalink" href="#id-1.8.10.4.52">#</a></h5></div><div class="verbatim-wrap"><pre class="screen">Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.</pre></div><p>
  If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
  replace the “with...Texts.” line with this:
 </p><div class="verbatim-wrap"><pre class="screen">with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</pre></div><p>
  If you have Invariant Sections without Cover Texts, or some other combination
  of the three, merge those two alternatives to suit the situation.
 </p><p>
  If your document contains nontrivial examples of program code, we recommend
  releasing these examples in parallel under your choice of free software
  license, such as the GNU General Public License, to permit their use in free
  software.
 </p></section></section></div></section></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>