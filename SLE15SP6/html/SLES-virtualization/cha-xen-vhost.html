<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLES 15 SP6 | Virtualization Guide | Setting up a virtual machine host</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Setting up a virtual machine host | SLES 15 SP6"/>
<meta name="description" content="This section documents how to set up and use SUSE Linux Enterprise Server 15 SP6 as a virtual machine host."/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="15 SP6"/>
<meta name="book-title" content="Virtualization Guide"/>
<meta name="chapter-title" content="Chapter 24. Setting up a virtual machine host"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Server 15 SP6"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Virtualization Guide"/>
<meta property="og:description" content="Learn all about virtualization and VM management"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Virtualization Guide"/>
<meta name="twitter:description" content="Learn all about virtualization and VM management"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Setting up a virtual machine host",
  
    "description": "Setting up a virtual machine host",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-06-26T00:00+02:00",
      
    "datePublished": "2024-06-26T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="part-virt-xen.html" title="Part IV. Managing virtual machines with Xen"/><link rel="next" href="cha-xen-network.html" title="Chapter 25. Virtual networking"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Virtualization Guide</a><span> / </span><a class="crumb" href="part-virt-xen.html">Managing virtual machines with Xen</a><span> / </span><a class="crumb" href="cha-xen-vhost.html">Setting up a virtual machine host</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Virtualization Guide</div><ol><li><a href="cha-kvm.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="part-virt-intro.html" class="has-children "><span class="title-number">I </span><span class="title-name">Introduction</span></a><ol><li><a href="chap-virtualization-introduction.html" class=" "><span class="title-number">1 </span><span class="title-name">Virtualization technology</span></a></li><li><a href="cha-virtualization-scenarios.html" class=" "><span class="title-number">2 </span><span class="title-name">Virtualization scenarios</span></a></li><li><a href="cha-xen-basics.html" class=" "><span class="title-number">3 </span><span class="title-name">Introduction to Xen virtualization</span></a></li><li><a href="cha-kvm-intro.html" class=" "><span class="title-number">4 </span><span class="title-name">Introduction to KVM virtualization</span></a></li><li><a href="cha-tools-intro.html" class=" "><span class="title-number">5 </span><span class="title-name">Virtualization tools</span></a></li><li><a href="cha-vt-installation.html" class=" "><span class="title-number">6 </span><span class="title-name">Installation of virtualization components</span></a></li><li><a href="cha-virt-support.html" class=" "><span class="title-number">7 </span><span class="title-name">Virtualization limits and support</span></a></li></ol></li><li><a href="part-virt-libvirt.html" class="has-children "><span class="title-number">II </span><span class="title-name">Managing virtual machines with <code class="systemitem">libvirt</code></span></a><ol><li><a href="cha-libvirt-overview.html" class=" "><span class="title-number">8 </span><span class="title-name"><code class="systemitem">libvirt</code> daemons</span></a></li><li><a href="cha-libvirt-host.html" class=" "><span class="title-number">9 </span><span class="title-name">Preparing the VM Host Server</span></a></li><li><a href="cha-kvm-inst.html" class=" "><span class="title-number">10 </span><span class="title-name">Guest installation</span></a></li><li><a href="cha-libvirt-managing.html" class=" "><span class="title-number">11 </span><span class="title-name">Basic VM Guest management</span></a></li><li><a href="cha-libvirt-connect.html" class=" "><span class="title-number">12 </span><span class="title-name">Connecting and authorizing</span></a></li><li><a href="cha-libvirt-storage.html" class=" "><span class="title-number">13 </span><span class="title-name">Advanced storage topics</span></a></li><li><a href="cha-libvirt-config-gui.html" class=" "><span class="title-number">14 </span><span class="title-name">Configuring virtual machines with Virtual Machine Manager</span></a></li><li><a href="cha-libvirt-config-virsh.html" class=" "><span class="title-number">15 </span><span class="title-name">Configuring virtual machines with <code class="command">virsh</code></span></a></li><li><a href="sec-libvirt-admin-migrate.html" class=" "><span class="title-number">16 </span><span class="title-name">Migrating VM Guests</span></a></li><li><a href="xen2kvm-migration.html" class=" "><span class="title-number">17 </span><span class="title-name">Xen to KVM migration guide</span></a></li></ol></li><li><a href="part-virt-common.html" class="has-children "><span class="title-number">III </span><span class="title-name">Hypervisor-independent features</span></a><ol><li><a href="cha-cachemodes.html" class=" "><span class="title-number">18 </span><span class="title-name">Disk cache modes</span></a></li><li><a href="sec-kvm-managing-clock.html" class=" "><span class="title-number">19 </span><span class="title-name">VM Guest clock settings</span></a></li><li><a href="chap-guestfs.html" class=" "><span class="title-number">20 </span><span class="title-name">libguestfs</span></a></li><li><a href="cha-qemu-ga.html" class=" "><span class="title-number">21 </span><span class="title-name">QEMU guest agent</span></a></li><li><a href="tpm.html" class=" "><span class="title-number">22 </span><span class="title-name">Software TPM emulator</span></a></li><li><a href="virt-crash-dump.html" class=" "><span class="title-number">23 </span><span class="title-name">Creating crash dumps of a VM Guest</span></a></li></ol></li><li class="active"><a href="part-virt-xen.html" class="has-children you-are-here"><span class="title-number">IV </span><span class="title-name">Managing virtual machines with Xen</span></a><ol><li><a href="cha-xen-vhost.html" class=" you-are-here"><span class="title-number">24 </span><span class="title-name">Setting up a virtual machine host</span></a></li><li><a href="cha-xen-network.html" class=" "><span class="title-number">25 </span><span class="title-name">Virtual networking</span></a></li><li><a href="cha-xen-manage.html" class=" "><span class="title-number">26 </span><span class="title-name">Managing a virtualization environment</span></a></li><li><a href="cha-xen-vbd.html" class=" "><span class="title-number">27 </span><span class="title-name">Block devices in Xen</span></a></li><li><a href="cha-xen-config.html" class=" "><span class="title-number">28 </span><span class="title-name">Virtualization: configuration options and settings</span></a></li><li><a href="cha-xen-admin.html" class=" "><span class="title-number">29 </span><span class="title-name">Administrative tasks</span></a></li><li><a href="cha-xen-xenstore.html" class=" "><span class="title-number">30 </span><span class="title-name">XenStore: configuration database shared between domains</span></a></li><li><a href="cha-xen-ha.html" class=" "><span class="title-number">31 </span><span class="title-name">Xen as a high-availability virtualization host</span></a></li><li><a href="pv-to-fv.html" class=" "><span class="title-number">32 </span><span class="title-name">Xen: converting a paravirtual (PV) guest into a fully virtual (FV/HVM) guest</span></a></li></ol></li><li><a href="part-virt-qemu.html" class="has-children "><span class="title-number">V </span><span class="title-name">Managing virtual machines with QEMU</span></a><ol><li><a href="cha-qemu-overview.html" class=" "><span class="title-number">33 </span><span class="title-name">QEMU overview</span></a></li><li><a href="cha-qemu-host.html" class=" "><span class="title-number">34 </span><span class="title-name">Setting up a KVM VM Host Server</span></a></li><li><a href="cha-qemu-guest-inst.html" class=" "><span class="title-number">35 </span><span class="title-name">Guest installation</span></a></li><li><a href="cha-qemu-running.html" class=" "><span class="title-number">36 </span><span class="title-name">Running virtual machines with qemu-system-ARCH</span></a></li><li><a href="cha-qemu-monitor.html" class=" "><span class="title-number">37 </span><span class="title-name">Virtual machine administration using QEMU monitor</span></a></li></ol></li><li><a href="part-virt-troubleshoot.html" class="has-children "><span class="title-number">VI </span><span class="title-name">Troubleshooting</span></a><ol><li><a href="cha-virt-help.html" class=" "><span class="title-number">38 </span><span class="title-name">Integrated help and package documentation</span></a></li><li><a href="cha-virt-logs.html" class=" "><span class="title-number">39 </span><span class="title-name">Gathering system information and logs</span></a></li></ol></li><li><a href="gloss-vt-glossary.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li><li><a href="app-vmdp-driver.html" class=" "><span class="title-number">A </span><span class="title-name">Virtual machine drivers</span></a></li><li><a href="app-gpu-passthru.html" class=" "><span class="title-number">B </span><span class="title-name">Configuring GPU Pass-Through for NVIDIA cards</span></a></li><li><a href="cha-xmtoxl.html" class=" "><span class="title-number">C </span><span class="title-name">XM, XL toolstacks, and the <code class="systemitem">libvirt</code> framework</span></a></li><li><a href="bk10apd.html" class=" "><span class="title-number">D </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-xen-vhost" data-id-title="Setting up a virtual machine host"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP6</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">24 </span><span class="title-name">Setting up a virtual machine host</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This section documents how to set up and use <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15 SP6</span></span>
    as a virtual machine host.
  </p><p>
    The hardware requirements for the Dom0 are often the same as those for
    the <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> operating system. Additional CPU, disk, memory and
    network resources should be added to accommodate the resource demands of
    all planned VM Guest systems.
  </p><div id="id-1.12.6.2.5" data-id-title="Resources" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Resources</div><p>
      Remember that VM Guest systems, like physical machines, perform better
      when they run on faster processors and have access to more system memory.
    </p></div><p>
    The virtual machine host requires several software packages and their
    dependencies to be installed. To install all necessary packages, run YaST
    <span class="guimenu">Software Management</span>, select
    <span class="guimenu">View</span> › <span class="guimenu">Patterns</span> and choose <span class="guimenu">Xen Virtual
    Machine Host Server</span> for installation. The installation can also
    be performed with YaST using the module
    <span class="guimenu">Virtualization</span> › <span class="guimenu">Install Hypervisor
    and Tools</span>.
  </p><p>
    After the Xen software is installed, restart the computer and, on the
    boot screen, choose the newly added option with the Xen kernel.
  </p><p>
    Updates are available through your update channel. To be sure to have the
    latest updates installed, run YaST <span class="guimenu">Online Update</span> after
    the installation has finished.
  </p><section class="sect1" id="sec-xen-vhost-best" data-id-title="Best practices and suggestions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.1 </span><span class="title-name">Best practices and suggestions</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#sec-xen-vhost-best">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      When installing and configuring the <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> operating system on the
      host, be aware of the following best practices and suggestions:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          If the host should always run as Xen host, run YaST <span class="guimenu">System</span> › <span class="guimenu">Boot Loader</span> and activate the Xen boot entry as default boot
          section.
        </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
              In YaST, click <span class="guimenu">System &gt; Boot Loader</span>.
            </p></li><li class="listitem"><p>
              Change the default boot to the <span class="guimenu">Xen</span> label,
              then click <span class="guimenu">Set as Default</span>.
            </p></li><li class="listitem"><p>
              Click <span class="guimenu">Finish</span>.
            </p></li></ul></div></li><li class="listitem"><p>
          For best performance, only the applications and processes required
          for virtualization should be installed on the virtual machine host.
        </p></li><li class="listitem"><p>
          If you intend to use a watchdog device attached to the Xen host,
          use only one at a time. It is recommended to use a driver with actual
          hardware integration over a generic software one.
        </p></li></ul></div><div id="id-1.12.6.2.9.4" data-id-title="Hardware monitoring" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Hardware monitoring</div><p>
        The Dom0 kernel is running virtualized, so tools like
        <code class="command">irqbalance</code> or <code class="command">lscpu</code> do not
        reflect the real hardware characteristics.
      </p></div><div id="id-1.12.6.2.9.5" data-id-title="Trusted boot not supported by Xen" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Trusted boot not supported by Xen</div><p>
        Trusted boot (Tboot) is not supported by Xen. To ensure that the Xen
        host boots correctly, verify that the <span class="guimenu">Enable Trusted Boot
        Support</span> option is deactivated in the GRUB 2 configuration
        dialog.
      </p></div></section><section class="sect1" id="sec-xen-vhost-memory" data-id-title="Managing Dom0 memory"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.2 </span><span class="title-name">Managing Dom0 memory</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#sec-xen-vhost-memory">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      In previous versions of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, the default memory allocation
      scheme of a Xen host was to allocate all host physical memory to Dom0
      and enable auto-ballooning. Memory was automatically ballooned from
      Dom0 when additional domains were started. This behavior has always
      been error prone and disabling it was strongly encouraged. Starting with
      <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="phrase">15
      SP1</span>, auto-ballooning has been
      disabled by default and Dom0 is given 10% of host physical memory +
      1 GB. For example, on a host with 32 GB of physical memory,
      4.2 GB of memory is allocated for Dom0.
    </p><p>
      The use of the <code class="option">dom0_mem</code> Xen command line option in
      <code class="filename">/etc/default/grub</code> is still supported and encouraged.
      You can restore the old behavior by setting <code class="option">dom0_mem</code> to
      the host physical memory size and enabling the
      <code class="option">autoballoon</code> setting in
      <code class="filename">/etc/xen/xl.conf</code>.
    </p><div id="id-1.12.6.2.10.4" data-id-title="Insufficient memory for Dom0" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Insufficient memory for Dom0</div><p>
        The amount of memory reserved for Dom0 is a function of the number of
        VM Guests running on the host since Dom0 provides back-end network
        and disk I/O services for each VM Guest. Other workloads running in
        Dom0 should also be considered when calculating Dom0 memory
        allocation. Memory sizing of Dom0 should be determined like any other
        virtual machine.
      </p></div><section class="sect2" id="sec-xen-vhost-maxmem" data-id-title="Setting Dom0 memory allocation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.2.1 </span><span class="title-name">Setting Dom0 memory allocation</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#sec-xen-vhost-maxmem">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
            Determine memory allocation required for Dom0.
          </p></li><li class="step"><p>
            At Dom0, type <code class="command">xl info</code> to view the amount of
            memory that is available on the machine. Dom0's current memory
            allocation can be determined with the <code class="command">xl list</code>
            command.
          </p></li><li class="step"><p>
            Edit <code class="filename">/etc/default/grub</code> and adjust the
            <code class="option">GRUB_CMDLINE_XEN</code> option so that it includes
            <code class="literal">dom0_mem=<em class="replaceable">MEM_AMOUNT</em></code>.
            Replace <em class="replaceable">MEM_AMOUNT</em> with the maximum
            amount of memory to allocate to Dom0. Add <code class="command">K</code>,
            <code class="command">M</code>, or <code class="command">G</code>, to specify the size
            unit. For example:
          </p><div class="verbatim-wrap"><pre class="screen">GRUB_CMDLINE_XEN="dom0_mem=2G"</pre></div></li><li class="step"><p>
            Restart the computer to apply the changes.
          </p></li></ol></div></div><div id="id-1.12.6.2.10.5.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
          Refer to <span class="intraxref">Book “Administration Guide”, Chapter 18 “The boot loader GRUB 2”, Section 18.2.2 “The file <code class="filename">/etc/default/grub</code>”</span> for more
          details about Xen-related boot configuration options.
        </p></div><div id="id-1.12.6.2.10.5.4" data-id-title="Xen Dom0 memory" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Xen Dom0 memory</div><p>
          When using the XL tool stack and the <code class="command">dom0_mem=</code>
          option for the Xen hypervisor in GRUB 2 you need to disable xl
          <span class="emphasis"><em>autoballoon</em></span> in
          <code class="filename">etc/xen/xl.conf</code>. Otherwise launching VMs fails
          with errors about not being able to balloon down Dom0. So add
          <span class="emphasis"><em>autoballoon=0</em></span> to <code class="filename">xl.conf</code> if
          you have the <code class="command">dom0_mem=</code> option specified for Xen.
          Also see
          <a class="link" href="https://wiki.xen.org/wiki/Xen_Best_Practices#Xen_dom0_dedicated_memory_and_preventing_dom0_memory_ballooning" target="_blank">Xen
          dom0 memory</a>
        </p></div></section></section><section class="sect1" id="sec-xen-vhost-netcard" data-id-title="Network card in fully virtualized guests"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.3 </span><span class="title-name">Network card in fully virtualized guests</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#sec-xen-vhost-netcard">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      In a fully virtualized guest, the default network card is an emulated
      Realtek network card. However, it also possible to use the split network
      driver to run the communication between Dom0 and a VM Guest. By
      default, both interfaces are presented to the VM Guest, because the
      drivers of certain operating systems require both to be present.
    </p><p>
      When using <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, only the paravirtualized network cards are
      available for the VM Guest by default. The following network options are
      available:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.2.11.4.1"><span class="term">emulated</span></dt><dd><p>
            To use an emulated network interface like an emulated Realtek card,
            specify <code class="literal">type=ioemu</code> in the <code class="literal">vif</code>
            device section of the domain xl configuration. An example
            configuration would look like:
          </p><div class="verbatim-wrap"><pre class="screen">vif = [ 'type=ioemu,mac=00:16:3e:5f:48:e4,bridge=br0' ]</pre></div><p>
            Find more details about the xl configuration in the
            <code class="filename">xl.conf</code> man page <code class="command">man 5
            xl.conf</code>.
          </p></dd><dt id="id-1.12.6.2.11.4.2"><span class="term">paravirtualized</span></dt><dd><p>
            When you specify <code class="literal">type=vif</code> and do not specify a
            model or type, the paravirtualized network interface is used:
          </p><div class="verbatim-wrap"><pre class="screen">vif = [ 'type=vif,mac=00:16:3e:5f:48:e4,bridge=br0,backen=0' ]</pre></div></dd><dt id="id-1.12.6.2.11.4.3"><span class="term">emulated and paravirtualized</span></dt><dd><p>
            If the administrator should be offered both options, simply specify
            both type and model. The xl configuration would look like:
          </p><div class="verbatim-wrap"><pre class="screen">vif = [ 'type=ioemu,mac=00:16:3e:5f:48:e4,model=rtl8139,bridge=br0' ]</pre></div><p>
            In this case, one of the network interfaces should be disabled on
            the VM Guest.
          </p></dd></dl></div></section><section class="sect1" id="sec-xen-vhost-start" data-id-title="Starting the virtual machine host"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.4 </span><span class="title-name">Starting the virtual machine host</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#sec-xen-vhost-start">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      If virtualization software is correctly installed, the computer boots to
      display the GRUB 2 boot loader with a <span class="guimenu">Xen</span> option on
      the menu. Select this option to start the virtual machine host.
    </p><div id="id-1.12.6.2.12.3" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning</div><p>
        When booting a Xen system, you may observe error messages in the
        /var/log/messages log file or <code class="systemitem">systemd</code> journal of dom0 similar to
        following:
      </p><div class="verbatim-wrap"><pre class="screen">isst_if_mbox_pci: probe of 0000:ff:1e.1 failed with error -5
isst_if_pci: probe of 0000:fe:00.1 failed with error -5</pre></div><p>
        Ignore them as they are harmless and are caused by the fact that the
        ISST driver does not provide any power or frequency scaling feature for
        virtual machines.
      </p></div><div id="id-1.12.6.2.12.4" data-id-title="Xen and Kdump" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Xen and Kdump</div><p>
        In Xen, the hypervisor manages the memory resource. If you need to
        reserve system memory for a recovery kernel in Dom0, this memory needs
        to be reserved by the hypervisor. Thus, it is necessary to add
         <code class="option">crashkernel=size</code> to the
        <code class="varname">GRUB_CMDLINE_XEN_DEFAULT</code> variable in the
        <code class="filename">/etc/dfault/grub</code> file, save it and run the
        following command:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> grub2-mkconfig -o /boot/grub2/grub.cfg</pre></div><p>
        For more information on the crashkernel parameter, see
        <span class="intraxref">Book “System Analysis and Tuning Guide”, Chapter 20 “Kexec and Kdump”, Section 20.4 “Calculating <code class="option">crashkernel</code> allocation size”</span>.
      </p></div><p>
      If the <span class="guimenu">Xen</span> option is not on the GRUB 2 menu, review
      the steps for installation and verify that the GRUB 2 boot loader has
      been updated. If the installation has been done without selecting the
      Xen pattern, run the YaST <span class="guimenu">Software Management</span>,
      select the filter <span class="guimenu">Patterns</span> and choose <span class="guimenu">Xen
      Virtual Machine Host Server</span> for installation.
    </p><p>
      After booting the hypervisor, the Dom0 virtual machine starts and
      displays its graphical desktop environment. If you did not install a
      graphical desktop, the command line environment appears.
    </p><div id="id-1.12.6.2.12.7" data-id-title="Graphics problems" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Graphics problems</div><p>
        Sometimes it may happen that the graphics system does not work
        properly. In this case, add <code class="literal">vga=ask</code> to the boot
        parameters. To activate permanent settings, use
        <code class="literal">vga=mode-0x???</code> where <code class="literal">???</code> is
        calculated as <code class="literal">0x100</code> + VESA mode from
        <a class="link" href="https://en.wikipedia.org/wiki/VESA_BIOS_Extensions" target="_blank">https://en.wikipedia.org/wiki/VESA_BIOS_Extensions</a>,
        for example, <code class="literal">vga=mode-0x361</code>.
      </p></div><p>
      Before starting to install virtual guests, make sure that the system time
      is correct. To do this, configure NTP (Network Time Protocol) on the
      controlling domain:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
          In YaST select <span class="guimenu">Network Services</span> › <span class="guimenu">NTP Configuration</span>.
        </p></li><li class="step"><p>
          Select the option to automatically start the NTP daemon during boot.
          Provide the IP address of an existing NTP time server, then click
          <span class="guimenu">Finish</span>.
        </p></li></ol></div></div><div id="id-1.12.6.2.12.10" data-id-title="Time services on virtual guests" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Time services on virtual guests</div><p>
        Hardware clocks are not precise. All modern operating systems try to
        correct the system time compared to the hardware time bvia an
        additional time source. To get the correct time on all VM Guest
        systems, also activate the network time services on each respective
        guest or make sure that the guest uses the system time of the host. For
        more about <code class="literal">Independent Wallclocks</code> in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>
        see <a class="xref" href="sec-kvm-managing-clock.html#sec-xen-guests-suse-time" title="19.2. Xen virtual machine clock settings">Section 19.2, “Xen virtual machine clock settings”</a>.
      </p></div><p>
      For more information about managing virtual machines, see
      <a class="xref" href="cha-xen-manage.html" title="Chapter 26. Managing a virtualization environment">Chapter 26, <em>Managing a virtualization environment</em></a>.
    </p></section><section class="sect1" id="sec-xen-vhost-pciback" data-id-title="PCI Pass-Through"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.5 </span><span class="title-name">PCI Pass-Through</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#sec-xen-vhost-pciback">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      To take full advantage of VM Guest systems, it is sometimes necessary to
      assign specific PCI devices to a dedicated domain. When using fully
      virtualized guests, this functionality is only available if the chipset
      of the system supports this feature, and if it is activated from the
      BIOS.
    </p><p>
      This feature is available from both AMD* and Intel*. For AMD machines,
      the feature is called <a class="xref" href="gloss-vt-glossary.html#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a>. In Intel
      speak, this is <a class="xref" href="gloss-vt-glossary.html#gloss-vt-acronym-vtd" title="VT-d">VT-d</a>. Be aware that
      Intel-VT technology is not sufficient to use this feature for fully
      virtualized guests. To make sure that your computer supports this
      feature, ask your supplier specifically to deliver a system that supports
      PCI Pass-Through.
    </p><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Limitations </span></span><a title="Permalink" class="permalink" href="cha-xen-vhost.html#id-1.12.6.2.13.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
          Certain graphics drivers use highly optimized ways to access DMA. This
          is not supported, and thus using graphics cards may be difficult.
        </p></li><li class="listitem"><p>
          When accessing PCI devices behind a
          <a class="xref" href="gloss-vt-glossary.html#gloss-vt-acronym-pcie" title="PCIe">PCIe</a> bridge, all the PCI devices
          must be assigned to a single guest. This limitation does not apply to
          <a class="xref" href="gloss-vt-glossary.html#gloss-vt-acronym-pcie" title="PCIe">PCIe</a> devices.
        </p></li><li class="listitem"><p>
          Guests with dedicated PCI devices cannot be migrated live to a
          different host.
        </p></li></ul></div><p>
      The configuration of PCI Pass-Through is twofold. First, the hypervisor must be
      informed at boot time that a PCI device should be available for
      reassigning. Second, the PCI device must be assigned to the VM Guest.
    </p><section class="sect2" id="config-hypervisor-pciback" data-id-title="Configuring the hypervisor for PCI Pass-Through"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.5.1 </span><span class="title-name">Configuring the hypervisor for PCI Pass-Through</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#config-hypervisor-pciback">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
            Select a device to reassign to a VM Guest. To do this, run
            <code class="command">lspci -k</code>, and read the device number and the
            name of the original module that is assigned to the device:
          </p><div class="verbatim-wrap"><pre class="screen">06:01.0 Ethernet controller: Intel Corporation Ethernet Connection I217-LM (rev 05)
        Subsystem: Dell Device 0617
        Kernel driver in use: e1000e
        Kernel modules: e1000e</pre></div><p>
            In this case, the PCI number is <code class="literal">(06:01.0)</code> and
            the dependent kernel module is <code class="literal">e1000e</code>.
          </p></li><li class="step"><p>
            Specify a module dependency to ensure that
            <code class="systemitem">xen_pciback</code> is the first module to control
            the device. Add the file named
            <code class="filename">/etc/modprobe.d/50-e1000e.conf</code> with the
            following content:
          </p><div class="verbatim-wrap"><pre class="screen">install e1000e /sbin/modprobe xen_pciback ; /sbin/modprobe \
 --first-time --ignore-install e1000e</pre></div></li><li class="step"><p>
            Instruct the <code class="systemitem">xen_pciback</code> module to control
            the device using the <code class="literal">hide</code> option. Edit or create
            <code class="filename">/etc/modprobe.d/50-xen-pciback.conf</code> with the
            following content:
          </p><div class="verbatim-wrap"><pre class="screen">options xen_pciback hide=(06:01.0)</pre></div></li><li class="step"><p>
            Reboot the system.
          </p></li><li class="step"><p>
            Check if the device is in the list of assignable devices with the
            command
          </p><div class="verbatim-wrap"><pre class="screen">xl pci-assignable-list</pre></div></li></ol></div></div><section class="sect3" id="config-hypervisor-pciback-xl" data-id-title="Dynamic assignment with xl"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">24.5.1.1 </span><span class="title-name">Dynamic assignment with xl</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#config-hypervisor-pciback-xl">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          To avoid restarting the host system, you can use dynamic assignment
          with xl to use PCI Pass-Through.
        </p><p>
          Begin by making sure that dom0 has the pciback module loaded:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> modprobe pciback</pre></div><p>
          Then make a device assignable by using <code class="command">xl
          pci-assignable-add</code>. For example, to make the device
          <span class="emphasis"><em>06:01.0</em></span> available for guests, run the command:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl pci-assignable-add 06:01.0</pre></div></section></section><section class="sect2" id="config-hypervisor-pciback-guests" data-id-title="Assigning PCI devices to VM Guest systems"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.5.2 </span><span class="title-name">Assigning PCI devices to VM Guest systems</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#config-hypervisor-pciback-guests">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        There are several possibilities to dedicate a PCI device to a
        VM Guest:
      </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.2.13.7.3.1"><span class="term">Adding the device while installing:</span></dt><dd><p>
              During installation, add the <code class="literal">pci</code> line to the
              configuration file:
            </p><div class="verbatim-wrap"><pre class="screen">pci=['06:01.0']</pre></div></dd><dt id="id-1.12.6.2.13.7.3.2"><span class="term">Hotplugging PCI devices to VM Guest systems</span></dt><dd><p>
              The command <code class="literal">xl</code> can be used to add or remove
              PCI devices on the fly. To add the device with number
              <code class="literal">06:01.0</code> to a guest with name
              <code class="literal">sles12</code> use:
            </p><div class="verbatim-wrap"><pre class="screen">xl pci-attach sles12 06:01.0</pre></div></dd><dt id="id-1.12.6.2.13.7.3.3"><span class="term">Adding the PCI device to Xend</span></dt><dd><p>
              To add the device to the guest permanently, add the following
              snippet to the guest configuration file:
            </p><div class="verbatim-wrap"><pre class="screen">pci = [ '06:01.0,power_mgmt=1,permissive=1' ]</pre></div></dd></dl></div><p>
        After assigning the PCI device to the VM Guest, the guest system must
        care for the configuration and device drivers for this device.
      </p></section><section class="sect2" id="config-hypervisor-vgaback" data-id-title="VGA Pass-Through"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.5.3 </span><span class="title-name">VGA Pass-Through</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#config-hypervisor-vgaback">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        Xen 4.0 and newer supports VGA graphics adapter pass-through on fully
        virtualized VM Guests. The guest can take full control of the graphics
        adapter with high-performance full 3D and video acceleration.
      </p><div class="itemizedlist"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Limitations </span></span><a title="Permalink" class="permalink" href="cha-xen-vhost.html#id-1.12.6.2.13.8.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p>
            VGA Pass-Through functionality is similar to PCI Pass-Through and as such also
            requires <a class="xref" href="gloss-vt-glossary.html#gloss-vt-acronym-iommu" title="IOMMU">IOMMU</a> (or Intel VT-d)
            support from the mainboard chipset and BIOS.
          </p></li><li class="listitem"><p>
            Only the primary graphics adapter (the one that is used when you
            power on the computer) can be used with VGA Pass-Through.
          </p></li><li class="listitem"><p>
            VGA Pass-Through is supported only for fully virtualized guests.
            Paravirtual guests (PV) are not supported.
          </p></li><li class="listitem"><p>
            The graphics card cannot be shared between multiple VM Guests
            using VGA Pass-Through—you can dedicate it to one guest only.
          </p></li></ul></div><p>
        To enable VGA Pass-Through, add the following settings to your fully
        virtualized guest configuration file:
      </p><div class="verbatim-wrap"><pre class="screen">gfx_passthru=1
pci=['yy:zz.n']</pre></div><p>
        where <code class="literal">yy:zz.n</code> is the PCI controller ID of the VGA
        graphics adapter as found with <code class="command">lspci -v</code> on Dom0.
      </p></section><section class="sect2" id="sec-xen-vm-known" data-id-title="Troubleshooting"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.5.4 </span><span class="title-name">Troubleshooting</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#sec-xen-vm-known">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        In certain circumstances, problems may occur during the installation of
        the VM Guest. This section describes several known problems and their
        solutions.
      </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.2.13.9.3.1"><span class="term">During boot, the system hangs</span></dt><dd><p>
              The software I/O translation buffer allocates a large chunk of
              low memory early in the bootstrap process. If the requests for
              memory exceed the size of the buffer, it may result in a hung
              boot process. To check if this is the case, switch to console 10
              and check the output there for a message similar to
            </p><div class="verbatim-wrap"><pre class="screen">kernel: PCI-DMA: Out of SW-IOMMU space for 32768 bytes at device 000:01:02.0</pre></div><p>
              In this case, you need to increase the size of the
              <code class="literal">swiotlb</code>. Add
              <code class="literal">swiotlb=<em class="replaceable">VALUE</em></code>
              (where <em class="replaceable">VALUE</em> is specified as the
              number of slab entries) on the command line of Dom0. The number
              can be adjusted up or down to find the optimal size for the
              machine.
            </p></dd></dl></div><div id="id-1.12.6.2.13.9.4" data-id-title="swiotlb a PV guest" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: swiotlb a PV guest</div><p>
          The <code class="literal">swiotlb=force</code> kernel parameter is required for
          DMA access to work for PCI devices on a PV guest. For more
          information about IOMMU and the <code class="literal">swiotlb</code> option see
          the file <code class="filename">boot-options.txt</code> from the package
          <code class="systemitem">kernel-source</code>.
        </p></div></section><section class="sect2" id="sec-xen-vm-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.5.5 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#sec-xen-vm-info">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        There are several resources on the Internet that provide interesting
        information about PCI Pass-Through:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            <a class="link" href="https://wiki.xenproject.org/wiki/VTd_HowTo" target="_blank">https://wiki.xenproject.org/wiki/VTd_HowTo</a>
          </p></li><li class="listitem"><p>
            <a class="link" href="https://software.intel.com/en-us/articles/intel-virtualization-technology-for-directed-io-vt-d-enhancing-intel-platforms-for-efficient-virtualization-of-io-devices/" target="_blank">https://software.intel.com/en-us/articles/intel-virtualization-technology-for-directed-io-vt-d-enhancing-intel-platforms-for-efficient-virtualization-of-io-devices/</a>
          </p></li><li class="listitem"><p>
            <a class="link" href="https://support.amd.com/TechDocs/48882_IOMMU.pdf" target="_blank">https://support.amd.com/TechDocs/48882_IOMMU.pdf</a>
          </p></li></ul></div></section></section><section class="sect1" id="sec-xen-vhost-usbpass" data-id-title="USB pass-through"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.6 </span><span class="title-name">USB pass-through</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#sec-xen-vhost-usbpass">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      There are two methods for passing through individual host USB devices to
      a guest. The first is via an emulated USB device controller, the second
      is using PVUSB.
    </p><section class="sect2" id="xen-usb-identify" data-id-title="Identify the USB device"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.6.1 </span><span class="title-name">Identify the USB device</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#xen-usb-identify">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        Before you can pass through a USB device to the VM Guest, you need to
        identify it on the VM Host Server. Use the <code class="command">lsusb</code> command
        to list the USB devices on the host system:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>lsusb
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 003: ID 0461:4d15 Primax Electronics, Ltd Dell Optical Mouse
Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub</pre></div><p>
        To pass through the Dell mouse, for example, specify either the device
        tag in the form <code class="literal">vendor_id:device_id</code> (0461:4d15) or
        the bus address in the form <code class="literal">bus.device</code> (2.3).
        Remember to remove leading zeros, otherwise <code class="command">xl</code> would
        interpret the numbers as octal values.
      </p></section><section class="sect2" id="xen-usb-emulated" data-id-title="Emulated USB device"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.6.2 </span><span class="title-name">Emulated USB device</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#xen-usb-emulated">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        In emulated USB, the device model (QEMU) presents an emulated USB
        controller to the guest. The USB device is then controlled from Dom0
        while USB commands are translated between the VM Guest and the host
        USB device. This method is only available to fully virtualized domains
        (HVM).
      </p><p>
        Enable the emulated USB hub with the <code class="option">usb=1</code> option.
        Then specify devices among the list of devices in the configuration
        file along with other emulated devices by using
        <code class="literal">host:USBID</code>. For example:
      </p><div class="verbatim-wrap"><pre class="screen">usb=1
usbdevice=['tablet','host:2.3','host:0424:460']</pre></div></section><section class="sect2" id="xen-usb-pv" data-id-title="Paravirtualized PVUSB"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.6.3 </span><span class="title-name">Paravirtualized PVUSB</span></span> <a title="Permalink" class="permalink" href="cha-xen-vhost.html#xen-usb-pv">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_virtualization_vhost.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        PVUSB is a new high performance method for USB Pass-Through from dom0
        to the virtualized guests. With PVUSB, there are two ways to add USB
        devices to a guest:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            via the configuration file at domain creation time
          </p></li><li class="listitem"><p>
            via hotplug while the VM is running
          </p></li></ul></div><p>
        PVUSB uses paravirtualized front- and back-end interfaces. PVUSB
        supports USB 1.1 and USB 2.0, and it works for both PV and HVM guests.
        To use PVUSB, you need usbfront in your guest OS, and usbback in dom0
        or usb back-end in qemu. On <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, the USB back-end comes with
        qemu.
        
      </p><p>
        As of Xen 4.7, <code class="command">xl</code> PVUSB support and hotplug support
        is introduced.
      </p><p>
        In the configuration file, specify USB controllers and USB host devices
        with <code class="literal">usbctrl</code> and <code class="literal">usbdev</code>. For
        example, in case of HVM guests:
      </p><div class="verbatim-wrap"><pre class="screen">usbctrl=['type=qusb,version=2,ports=4', 'type=qusb,version=1,ports=4', ]
usbdev=['hostbus=2, hostaddr=1, controller=0,port=1', ]</pre></div><div id="id-1.12.6.2.14.5.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
          It is important to specify <code class="literal">type=qusb</code> for the
          controller of HVM guests.
        </p></div><p>
        To manage hotplugging PVUSB devices, use the
        <code class="literal">usbctrl-attach</code>, <code class="literal">usbctrl-detach</code>,
        <code class="literal">usb-list</code>, <code class="literal">usbdev-attach</code> and
        <code class="literal">usb-detach</code> subcommands. For example:
      </p><p>
        Create a USB controller which is version USB 1.1 and has 8 ports:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>xl usbctrl-attach test_vm version=1 ports=8 type=qusb</pre></div><p>
        Find the first available controller:port in the domain, and attach USB
        device whose busnum:devnum is 2:3 to it; you can also specify
        <code class="literal">controller</code> and <code class="literal">port</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>xl usbdev-attach test_vm hostbus=2 hostaddr=3</pre></div><p>
        Show all USB controllers and USB devices in the domain:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>xl usb-list test_vm
Devid  Type   BE  state usb-ver ports
0      qusb   0   1     1       8
  Port 1: Bus 002 Device 003
  Port 2:
  Port 3:
  Port 4:
  Port 5:
  Port 6:
  Port 7:
  Port 8:</pre></div><p>
        Detach the USB device under controller 0 port 1:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>xl usbdev-detach test_vm 0 1</pre></div><p>
        Remove the USB controller with the indicated <code class="literal">dev_id</code>,
        and all USB devices under it:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>xl usbctrl-detach test_vm dev_id</pre></div><p>
        For more information, see
        <a class="link" href="https://wiki.xenproject.org/wiki/Xen_USB_Passthrough" target="_blank">https://wiki.xenproject.org/wiki/Xen_USB_Passthrough</a>.
      </p></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="part-virt-xen.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Part IV </span>Managing virtual machines with Xen</span></a> </div><div><a class="pagination-link next" href="cha-xen-network.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 25 </span>Virtual networking</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-xen-vhost.html#sec-xen-vhost-best"><span class="title-number">24.1 </span><span class="title-name">Best practices and suggestions</span></a></span></li><li><span class="sect1"><a href="cha-xen-vhost.html#sec-xen-vhost-memory"><span class="title-number">24.2 </span><span class="title-name">Managing Dom0 memory</span></a></span></li><li><span class="sect1"><a href="cha-xen-vhost.html#sec-xen-vhost-netcard"><span class="title-number">24.3 </span><span class="title-name">Network card in fully virtualized guests</span></a></span></li><li><span class="sect1"><a href="cha-xen-vhost.html#sec-xen-vhost-start"><span class="title-number">24.4 </span><span class="title-name">Starting the virtual machine host</span></a></span></li><li><span class="sect1"><a href="cha-xen-vhost.html#sec-xen-vhost-pciback"><span class="title-number">24.5 </span><span class="title-name">PCI Pass-Through</span></a></span></li><li><span class="sect1"><a href="cha-xen-vhost.html#sec-xen-vhost-usbpass"><span class="title-number">24.6 </span><span class="title-name">USB pass-through</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>