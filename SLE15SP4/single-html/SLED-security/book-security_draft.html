<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><title>SLED 15 SP4 | Security and Hardening Guide</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Security and Hardening Guide | SLED 15 SP4"/>
<meta name="description" content="How to implement system security and hardening using the security software included with the product"/>
<meta name="product-name" content="SUSE Linux Enterprise Desktop"/>
<meta name="product-number" content="15 SP4"/>
<meta name="book-title" content="Security and Hardening Guide"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Desktop 15 SP4"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Security and Hardening Guide"/>
<meta property="og:description" content="Implement system security and hardening for SLED"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Security and Hardening Guide"/>
<meta name="twitter:description" content="Implement system security and hardening for SLED"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Security and Hardening Guide",
  
    "description": "How to implement system security and hardening using the security software included with the product",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-05-27T00:00+02:00",
      
    "datePublished": "2022-06-21T00:00+02:00",
      

    "about": [
      {
        "@type": "Thing",
        "name": "Auditing"
      },
      {
        "@type": "Thing",
        "name": "Security"
      }
    ],
  
    "mentions": [
      
      { "@type": "SoftwareApplication",
        "name": "SUSE Linux Enterprise Desktop",
        "softwareVersion": "15 SP4",
        "applicationCategory": "Operating System",
        "operatingSystem": "Linux"
      }
      
    ],
    
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/book_security.xml"/></head><body class="draft single normal offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="#book-security">Security and Hardening Guide</a></div></div><main id="_content"><nav class="side-toc placebo" id="_side-toc-overall"> </nav><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section xml:lang="en" class="book" id="book-security" data-id-title="Security and Hardening Guide"><div class="titlepage"><div><div class="big-version-info"><span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP4</span></span></span></div><div class="title-container"><h1 class="title">Security and Hardening Guide</h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_security.xml" title="Edit source document"> </a></div></div><div class="abstract"><p> This guide introduces basic concepts of system
     security and describes the usage of security software included with the product,
     such as <span class="phrase">AppArmor</span>, SELinux, or the auditing system. The guide also supports system
     administrators in hardening an installation. </p></div><div><div class="titlepage-revhistory"><a aria-label="Revision History" hreflang="en" href="rh-book-security.html" target="_blank">Revision History: Security and Hardening Guide</a></div></div><div class="date"><span class="imprint-label">Publication Date: </span>October 10, 2024
</div></div></div><div class="toc"><ul><li><span class="preface"><a href="#preface-security"><span class="title-name">Preface</span></a></span><ul><li><span class="sect1"><a href="#id-1.7.2.3"><span class="title-name">Available documentation</span></a></span></li><li><span class="sect1"><a href="#id-1.7.2.4"><span class="title-name">Improving the documentation</span></a></span></li><li><span class="sect1"><a href="#id-1.7.2.5"><span class="title-name">Documentation conventions</span></a></span></li><li><span class="sect1"><a href="#id-1.7.2.6"><span class="title-name">Support</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security"><span class="title-number">1 </span><span class="title-name">Security and confidentiality</span></a></span><ul><li><span class="sect1"><a href="#sec-security-overview"><span class="title-number">1.1 </span><span class="title-name">Overview</span></a></span></li><li><span class="sect1"><a href="#sec-security-passwords"><span class="title-number">1.2 </span><span class="title-name">Passwords</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-backups"><span class="title-number">1.3 </span><span class="title-name">Backups</span></a></span></li><li><span class="sect1"><a href="#sec-security-integrity"><span class="title-number">1.4 </span><span class="title-name">System integrity</span></a></span></li><li><span class="sect1"><a href="#sec-security-file-access"><span class="title-number">1.5 </span><span class="title-name">File access</span></a></span></li><li><span class="sect1"><a href="#sec-security-network"><span class="title-number">1.6 </span><span class="title-name">Networking</span></a></span></li><li><span class="sect1"><a href="#sec-security-vulnerabilities"><span class="title-number">1.7 </span><span class="title-name">Software vulnerabilities</span></a></span></li><li><span class="sect1"><a href="#sec-security-malware"><span class="title-number">1.8 </span><span class="title-name">Malware</span></a></span></li><li><span class="sect1"><a href="#sec-security-tips"><span class="title-number">1.9 </span><span class="title-name">Important security tips</span></a></span></li><li><span class="sect1"><a href="#sec-security-general-report"><span class="title-number">1.10 </span><span class="title-name">Reporting security issues</span></a></span></li></ul></li><li><span class="part"><a href="#part-auth"><span class="title-number">I </span><span class="title-name">Authentication</span></a></span><ul><li><span class="chapter"><a href="#cha-pam"><span class="title-number">2 </span><span class="title-name">Authentication with PAM</span></a></span><ul><li><span class="sect1"><a href="#sec-security-pam-whatis"><span class="title-number">2.1 </span><span class="title-name">What is PAM?</span></a></span></li><li><span class="sect1"><a href="#sec-pam-struc-files"><span class="title-number">2.2 </span><span class="title-name">Structure of a PAM configuration file</span></a></span></li><li><span class="sect1"><a href="#sec-pam-struc-format"><span class="title-number">2.3 </span><span class="title-name">The PAM configuration of sshd</span></a></span></li><li><span class="sect1"><a href="#sec-pam-struc-conf"><span class="title-number">2.4 </span><span class="title-name">Configuration of PAM modules</span></a></span></li><li><span class="sect1"><a href="#sec-pam-pam-config"><span class="title-number">2.5 </span><span class="title-name">Configuring PAM using pam-config</span></a></span></li><li><span class="sect1"><a href="#sec-pam-manual-config"><span class="title-number">2.6 </span><span class="title-name">Manually configuring PAM</span></a></span></li><li><span class="sect1"><a href="#sec-pam-login"><span class="title-number">2.7 </span><span class="title-name">Configuring  U2F keys for local login</span></a></span></li><li><span class="sect1"><a href="#sec-pam-info"><span class="title-number">2.8 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-nis"><span class="title-number">3 </span><span class="title-name">Using NIS</span></a></span><ul><li><span class="sect1"><a href="#sec-nis-server-sled"><span class="title-number">3.1 </span><span class="title-name">Configuring NIS servers</span></a></span></li><li><span class="sect1"><a href="#sec-nis-client"><span class="title-number">3.2 </span><span class="title-name">Configuring NIS clients</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-auth"><span class="title-number">4 </span><span class="title-name">Setting up authentication clients using YaST</span></a></span><ul><li><span class="sect1"><a href="#sec-security-auth-yast-client"><span class="title-number">4.1 </span><span class="title-name">Configuring an authentication client with YaST</span></a></span></li><li><span class="sect1"><a href="#sec-security-auth-sssd"><span class="title-number">4.2 </span><span class="title-name">SSSD</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-ldap"><span class="title-number">5 </span><span class="title-name">LDAP with 389 Directory Server</span></a></span><ul><li><span class="sect1"><a href="#sec-security-ldap-tree"><span class="title-number">5.1 </span><span class="title-name">Structure of an LDAP directory tree</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-server-install"><span class="title-number">5.2 </span><span class="title-name">Installing 389 Directory Server</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-firewall"><span class="title-number">5.3 </span><span class="title-name">Firewall configuration</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-backup"><span class="title-number">5.4 </span><span class="title-name">Backing up and restoring 389 Directory Server</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-server-users"><span class="title-number">5.5 </span><span class="title-name">Managing LDAP users and groups</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-modules"><span class="title-number">5.6 </span><span class="title-name">Managing plug-ins</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-server-sssd"><span class="title-number">5.7 </span><span class="title-name">Using SSSD to manage LDAP authentication</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-migrate"><span class="title-number">5.8 </span><span class="title-name">Migrating to 389 Directory Server from OpenLDAP</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-server-ca"><span class="title-number">5.9 </span><span class="title-name">Importing TLS server certificates and keys</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-replication"><span class="title-number">5.10 </span><span class="title-name">Setting up replication</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-active-directory-sync"><span class="title-number">5.11 </span><span class="title-name">Synchronizing with Microsoft Active Directory</span></a></span></li><li><span class="sect1"><a href="#sec-security-ldap-info"><span class="title-number">5.12 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-kerberos"><span class="title-number">6 </span><span class="title-name">Network authentication with Kerberos</span></a></span><ul><li><span class="sect1"><a href="#sec-security-kerberos-overview"><span class="title-number">6.1 </span><span class="title-name">Conceptual overview</span></a></span></li><li><span class="sect1"><a href="#sec-security-kerberos-terms"><span class="title-number">6.2 </span><span class="title-name">Kerberos terminology</span></a></span></li><li><span class="sect1"><a href="#sec-security-kerberos-how"><span class="title-number">6.3 </span><span class="title-name">How Kerberos works</span></a></span></li><li><span class="sect1"><a href="#sec-security-kerberos-users"><span class="title-number">6.4 </span><span class="title-name">User view of Kerberos</span></a></span></li><li><span class="sect1"><a href="#sec-security-kerberos-nfs"><span class="title-number">6.5 </span><span class="title-name">Kerberos and NFS</span></a></span></li><li><span class="sect1"><a href="#sec-security-kerberos-info"><span class="title-number">6.6 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-ad"><span class="title-number">7 </span><span class="title-name">Active Directory support</span></a></span><ul><li><span class="sect1"><a href="#sec-security-ad-integrate"><span class="title-number">7.1 </span><span class="title-name">Integrating Linux and Active Directory environments</span></a></span></li><li><span class="sect1"><a href="#sec-security-ad-background"><span class="title-number">7.2 </span><span class="title-name">Background information for Linux Active Directory support</span></a></span></li><li><span class="sect1"><a href="#sec-security-ad-config"><span class="title-number">7.3 </span><span class="title-name">Configuring a Linux client for Active Directory</span></a></span></li><li><span class="sect1"><a href="#sec-security-ad-login"><span class="title-number">7.4 </span><span class="title-name">Logging in to an Active Directory domain</span></a></span></li><li><span class="sect1"><a href="#sec-security-ad-passwd"><span class="title-number">7.5 </span><span class="title-name">Changing passwords</span></a></span></li><li><span class="sect1"><a href="#sec-active-directory-certificate-auto-enrollment"><span class="title-number">7.6 </span><span class="title-name">Active Directory certificate auto-enrollment</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-freeradius"><span class="title-number">8 </span><span class="title-name">Setting up a freeRADIUS server</span></a></span><ul><li><span class="sect1"><a href="#sec-test-radiusd"><span class="title-number">8.1 </span><span class="title-name">Installation and testing on SUSE Linux Enterprise</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-local-security"><span class="title-number">II </span><span class="title-name">Local security</span></a></span><ul><li><span class="chapter"><a href="#cha-physical-security"><span class="title-number">9 </span><span class="title-name">Physical security</span></a></span><ul><li><span class="sect1"><a href="#sec-sec-prot-general-physical-locks"><span class="title-number">9.1 </span><span class="title-name">System locks</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-bios"><span class="title-number">9.2 </span><span class="title-name">Locking down the BIOS</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-bootloader"><span class="title-number">9.3 </span><span class="title-name">Security via the boot loaders</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-retiring"><span class="title-number">9.4 </span><span class="title-name">Retiring Linux servers with sensitive data</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-removable-media"><span class="title-number">9.5 </span><span class="title-name">Restricting access to removable media</span></a></span></li><li><span class="sect1"><a href="#sec-USBGuard"><span class="title-number">9.6 </span><span class="title-name">System protection with enforced USB device authorization via <span class="emphasis"><em>USBGuard</em></span></span></a></span></li></ul></li><li><span class="chapter"><a href="#sec-sec-software-management"><span class="title-number">10 </span><span class="title-name">Software management</span></a></span><ul><li><span class="sect1"><a href="#sec-sec-prot-general-remove-packs"><span class="title-number">10.1 </span><span class="title-name">Removing unnecessary software packages (RPMs)</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-patching"><span class="title-number">10.2 </span><span class="title-name">Patching Linux systems</span></a></span></li></ul></li><li><span class="chapter"><a href="#sec-sec-file-management"><span class="title-number">11 </span><span class="title-name">File management</span></a></span><ul><li><span class="sect1"><a href="#sec-sec-prot-general-partitions"><span class="title-number">11.1 </span><span class="title-name">Disk partitions</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-file-permissions"><span class="title-number">11.2 </span><span class="title-name">Modifying permissions of certain system files</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-home-permissions"><span class="title-number">11.3 </span><span class="title-name">Changing home directory permissions from 755 to 700</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-umask"><span class="title-number">11.4 </span><span class="title-name">Default umask</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-s-bit"><span class="title-number">11.5 </span><span class="title-name">SUID/SGID files</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-world-writable-files"><span class="title-number">11.6 </span><span class="title-name">World-writable files</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-orphaned"><span class="title-number">11.7 </span><span class="title-name">Orphaned or unowned files</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-cryptofs"><span class="title-number">12 </span><span class="title-name">Encrypting partitions and files</span></a></span><ul><li><span class="sect1"><a href="#sec-security-cryptofs-y2"><span class="title-number">12.1 </span><span class="title-name">Setting up an encrypted file system with YaST</span></a></span></li><li><span class="sect1"><a href="#sec-security-cryptofs-gpg"><span class="title-number">12.2 </span><span class="title-name">Encrypting files with GPG</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-configure-cryptctl"><span class="title-number">13 </span><span class="title-name">Storage encryption for hosted applications with cryptctl</span></a></span><ul><li><span class="sect1"><a href="#sec-configure-cryptctl-server"><span class="title-number">13.1 </span><span class="title-name">Setting up a <code class="command">cryptctl</code> server</span></a></span></li><li><span class="sect1"><a href="#sec-configure-cryptctl-client"><span class="title-number">13.2 </span><span class="title-name">Setting up a <code class="command">cryptctl</code> client</span></a></span></li><li><span class="sect1"><a href="#sec-cryptctl-luks-fstab"><span class="title-number">13.3 </span><span class="title-name">Configuring /etc/fstab for LUKS volumes</span></a></span></li><li><span class="sect1"><a href="#sec-configure-cryptctl-status"><span class="title-number">13.4 </span><span class="title-name">Checking partition unlock status using server-side commands</span></a></span></li><li><span class="sect1"><a href="#sec-configure-cryptctl-unlock"><span class="title-number">13.5 </span><span class="title-name">Unlocking encrypted partitions manually</span></a></span></li><li><span class="sect1"><a href="#sec-configure-cryptctl-lock"><span class="title-number">13.6 </span><span class="title-name">Maintenance downtime procedure</span></a></span></li><li><span class="sect1"><a href="#sec-configure-cryptctl-more"><span class="title-number">13.7 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#sec-sec-user-management"><span class="title-number">14 </span><span class="title-name">User management</span></a></span><ul><li><span class="sect1"><a href="#sec-sec-prot-general-accounts"><span class="title-number">14.1 </span><span class="title-name">Various account checks</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-pw-aging"><span class="title-number">14.2 </span><span class="title-name">Enabling password aging</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-pw-strength"><span class="title-number">14.3 </span><span class="title-name">Stronger password enforcement</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-general-pam"><span class="title-number">14.4 </span><span class="title-name">Password and login management with PAM</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-restrict-root"><span class="title-number">14.5 </span><span class="title-name">Restricting <code class="systemitem">root</code> logins</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-restrict-sudo"><span class="title-number">14.6 </span><span class="title-name">Restricting <code class="command">sudo</code> users</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-inactivity-logout"><span class="title-number">14.7 </span><span class="title-name">Setting an inactivity timeout for interactive shell sessions</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-dos"><span class="title-number">14.8 </span><span class="title-name">Preventing accidental denial of service</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-banners"><span class="title-number">14.9 </span><span class="title-name">Displaying login banners</span></a></span></li><li><span class="sect1"><a href="#sec-sec-prot-misc-account-utils"><span class="title-number">14.10 </span><span class="title-name">Connection accounting utilities</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-sec-cron-at"><span class="title-number">15 </span><span class="title-name">Restricting <code class="systemitem">cron</code> and <code class="systemitem">at</code></span></a></span><ul><li><span class="sect1"><a href="#id-1.7.5.8.3"><span class="title-number">15.1 </span><span class="title-name">Restricting the <code class="systemitem">cron</code> daemon</span></a></span></li><li><span class="sect1"><a href="#id-1.7.5.8.4"><span class="title-number">15.2 </span><span class="title-name">Restricting the <code class="systemitem">at</code> scheduler</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-spectre"><span class="title-number">16 </span><span class="title-name">Spectre/Meltdown checker</span></a></span><ul><li><span class="sect1"><a href="#sec-spectre-meltdown-options"><span class="title-number">16.1 </span><span class="title-name">Using <code class="command">spectre-meltdown-checker</code></span></a></span></li><li><span class="sect1"><a href="#sec-spectre-meltdown-resources"><span class="title-number">16.2 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-yast-security"><span class="title-number">17 </span><span class="title-name">Configuring security settings with YaST</span></a></span><ul><li><span class="sect1"><a href="#sec-security-yast-security-overview"><span class="title-number">17.1 </span><span class="title-name"><span class="guimenu">Security overview</span></span></a></span></li><li><span class="sect1"><a href="#sec-security-yast-security-predefined-configs"><span class="title-number">17.2 </span><span class="title-name"><span class="guimenu">Predefined security configurations</span></span></a></span></li><li><span class="sect1"><a href="#sec-security-yast-security-password"><span class="title-number">17.3 </span><span class="title-name"><span class="guimenu">Password settings</span></span></a></span></li><li><span class="sect1"><a href="#sec-security-yast-security-boot"><span class="title-number">17.4 </span><span class="title-name"><span class="guimenu">Boot settings</span></span></a></span></li><li><span class="sect1"><a href="#sec-security-yast-security-login"><span class="title-number">17.5 </span><span class="title-name"><span class="guimenu">Login settings</span></span></a></span></li><li><span class="sect1"><a href="#sec-security-yast-security-user"><span class="title-number">17.6 </span><span class="title-name"><span class="guimenu">User addition</span></span></a></span></li><li><span class="sect1"><a href="#sec-security-yast-security-misc"><span class="title-number">17.7 </span><span class="title-name"><span class="guimenu">Miscellaneous settings</span></span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-polkit"><span class="title-number">18 </span><span class="title-name">The Polkit authentication framework</span></a></span><ul><li><span class="sect1"><a href="#sec-security-polkit-oview"><span class="title-number">18.1 </span><span class="title-name">Conceptual overview</span></a></span></li><li><span class="sect1"><a href="#sec-security-polkit-types"><span class="title-number">18.2 </span><span class="title-name">Authorization types</span></a></span></li><li><span class="sect1"><a href="#sec-security-polkit-query"><span class="title-number">18.3 </span><span class="title-name">Querying Privileges</span></a></span></li><li><span class="sect1"><a href="#sec-security-polkit-change-modify-config"><span class="title-number">18.4 </span><span class="title-name">Modifying Polkit Configuration</span></a></span></li><li><span class="sect1"><a href="#sec-security-polkit-change-defaults"><span class="title-number">18.5 </span><span class="title-name">Restoring the SUSE default privileges</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-acls"><span class="title-number">19 </span><span class="title-name">Access control lists in Linux</span></a></span><ul><li><span class="sect1"><a href="#sec-security-acls-traditional"><span class="title-number">19.1 </span><span class="title-name">Traditional file permissions</span></a></span></li><li><span class="sect1"><a href="#sec-security-acls-intro"><span class="title-number">19.2 </span><span class="title-name">Advantages of ACLs</span></a></span></li><li><span class="sect1"><a href="#sec-security-acls-defs"><span class="title-number">19.3 </span><span class="title-name">Definitions</span></a></span></li><li><span class="sect1"><a href="#sec-security-acls-handle"><span class="title-number">19.4 </span><span class="title-name">Handling ACLs</span></a></span></li><li><span class="sect1"><a href="#sec-security-acls-future"><span class="title-number">19.5 </span><span class="title-name">ACL support in applications</span></a></span></li><li><span class="sect1"><a href="#sec-security-acls-info"><span class="title-number">19.6 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-aide"><span class="title-number">20 </span><span class="title-name">Intrusion detection with AIDE</span></a></span><ul><li><span class="sect1"><a href="#sec-aide-why"><span class="title-number">20.1 </span><span class="title-name">Why use AIDE?</span></a></span></li><li><span class="sect1"><a href="#sec-aide-setup"><span class="title-number">20.2 </span><span class="title-name">Setting up an AIDE database</span></a></span></li><li><span class="sect1"><a href="#sec-aide-check"><span class="title-number">20.3 </span><span class="title-name">Local AIDE checks</span></a></span></li><li><span class="sect1"><a href="#sec-aide-independent"><span class="title-number">20.4 </span><span class="title-name">System independent checking</span></a></span></li><li><span class="sect1"><a href="#sec-aide-more"><span class="title-number">20.5 </span><span class="title-name">More information</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-network-security"><span class="title-number">III </span><span class="title-name">Network security</span></a></span><ul><li><span class="chapter"><a href="#cha-xauth"><span class="title-number">21 </span><span class="title-name">X Window System and X authentication</span></a></span></li><li><span class="chapter"><a href="#cha-ssh"><span class="title-number">22 </span><span class="title-name">Securing network operations with OpenSSH</span></a></span><ul><li><span class="sect1"><a href="#sec-ssh-overview"><span class="title-number">22.1 </span><span class="title-name">OpenSSH overview</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-server-config"><span class="title-number">22.2 </span><span class="title-name">Server hardening</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-password-auth"><span class="title-number">22.3 </span><span class="title-name">Password authentication</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-authentic-gen-key"><span class="title-number">22.4 </span><span class="title-name">Managing user and host encryption keys</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-sshdserver-rotation"><span class="title-number">22.5 </span><span class="title-name">Rotating host keys</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-public-key-auth"><span class="title-number">22.6 </span><span class="title-name">Public key authentication</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-passphrase-less-auth"><span class="title-number">22.7 </span><span class="title-name">Passphrase-less public key authentication</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-certificate-auth"><span class="title-number">22.8 </span><span class="title-name">OpenSSH certificate authentication</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-gnome-keyring"><span class="title-number">22.9 </span><span class="title-name">Automated public key logins with gnome-keyring</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-ssh-agent"><span class="title-number">22.10 </span><span class="title-name">Automated public key logins in the console with ssh-agent</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-change-passphrase"><span class="title-number">22.11 </span><span class="title-name">Changing an SSH private key passphrase</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-get-key-fingerprint"><span class="title-number">22.12 </span><span class="title-name">Retrieving a key fingerprint</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-programm-x"><span class="title-number">22.13 </span><span class="title-name">Starting X11 applications on a remote host</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-programm-forwarding"><span class="title-number">22.14 </span><span class="title-name">Agent forwarding</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-copy"><span class="title-number">22.15 </span><span class="title-name"><code class="command">scp</code>—secure copy</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-sftp"><span class="title-number">22.16 </span><span class="title-name"><code class="command">sftp</code>—secure file transfer</span></a></span></li><li><span class="sect1"><a href="#sec-ssh-port-forwarding"><span class="title-number">22.17 </span><span class="title-name">Port forwarding (SSH tunneling)</span></a></span></li><li><span class="sect1"><a href="#sec-security-ssh-moreinfo"><span class="title-number">22.18 </span><span class="title-name">More information</span></a></span></li><li><span class="sect1"><a href="#sec-security-ssh-fail2ban"><span class="title-number">22.19 </span><span class="title-name">Stopping SSH Brute Force Attacks with Fail2Ban</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-firewall"><span class="title-number">23 </span><span class="title-name">Masquerading and firewalls</span></a></span><ul><li><span class="sect1"><a href="#sec-security-firewall-iptables"><span class="title-number">23.1 </span><span class="title-name">Packet filtering with iptables</span></a></span></li><li><span class="sect1"><a href="#sec-security-firewall-masq"><span class="title-number">23.2 </span><span class="title-name">Masquerading basics</span></a></span></li><li><span class="sect1"><a href="#sec-security-firewall-fw"><span class="title-number">23.3 </span><span class="title-name">Firewalling basics</span></a></span></li><li><span class="sect1"><a href="#sec-security-firewall-firewalld"><span class="title-number">23.4 </span><span class="title-name"><code class="systemitem">firewalld</code></span></a></span></li><li><span class="sect1"><a href="#sec-security-firewall-upgrade"><span class="title-number">23.5 </span><span class="title-name">Migrating from SuSEfirewall2</span></a></span></li><li><span class="sect1"><a href="#sec-security-firewall-info"><span class="title-number">23.6 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-vpnserver"><span class="title-number">24 </span><span class="title-name">Configuring a VPN server</span></a></span><ul><li><span class="sect1"><a href="#sec-security-vpn-overview"><span class="title-number">24.1 </span><span class="title-name">Conceptual overview</span></a></span></li><li><span class="sect1"><a href="#sec-security-vpn-simplest"><span class="title-number">24.2 </span><span class="title-name">Setting up a simple test scenario</span></a></span></li><li><span class="sect1"><a href="#sec-security-vpn-ca"><span class="title-number">24.3 </span><span class="title-name">Setting up your VPN server using a certificate authority</span></a></span></li><li><span class="sect1"><a href="#sec-security-vpn-moreinfo"><span class="title-number">24.4 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-xca"><span class="title-number">25 </span><span class="title-name">Managing a PKI with XCA, X certificate and key manager</span></a></span><ul><li><span class="sect1"><a href="#sec-security-xca-install"><span class="title-number">25.1 </span><span class="title-name">Installing XCA</span></a></span></li><li><span class="sect1"><a href="#sec-security-xca-start"><span class="title-number">25.2 </span><span class="title-name">Creating a new PKI</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-sec-sysctl"><span class="title-number">26 </span><span class="title-name">Improving network security with <code class="command">sysctl</code> variables</span></a></span></li></ul></li><li><span class="part"><a href="#part-compliance"><span class="title-number">IV </span><span class="title-name">Regulations and Compliance</span></a></span><ul><li><span class="chapter"><a href="#cha-common-criteria"><span class="title-number">27 </span><span class="title-name">Common Criteria</span></a></span><ul><li><span class="sect1"><a href="#sec-common-criteria-introduction"><span class="title-number">27.1 </span><span class="title-name">Introduction</span></a></span></li><li><span class="sect1"><a href="#sec-common-criteria-eal"><span class="title-number">27.2 </span><span class="title-name">Evaluation Assurance Level (EAL)</span></a></span></li><li><span class="sect1"><a href="#sec-common-criteria-principles"><span class="title-number">27.3 </span><span class="title-name">Generic guiding principles</span></a></span></li><li><span class="sect1"><a href="#sec-common-criteria-more"><span class="title-number">27.4 </span><span class="title-name">More information</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-security-fips"><span class="title-number">28 </span><span class="title-name">Enabling compliance with FIPS 140-3</span></a></span><ul><li><span class="sect1"><a href="#sec-fips-concept"><span class="title-number">28.1 </span><span class="title-name">FIPS overview</span></a></span></li><li><span class="sect1"><a href="#sec-fips-use-case"><span class="title-number">28.2 </span><span class="title-name">When to enable FIPS mode</span></a></span></li><li><span class="sect1"><a href="#sec-fips-samba-cifs"><span class="title-number">28.3 </span><span class="title-name">MD5 not supported in Samba/CIFS</span></a></span></li><li><span class="sect1"><a href="#sec-fips-more"><span class="title-number">28.4 </span><span class="title-name">More information</span></a></span></li></ul></li></ul></li><li><span class="part"><a href="#part-apparmor"><span class="title-number">V </span><span class="title-name">Confining privileges with <span class="phrase">AppArmor</span></span></a></span><ul><li><span class="chapter"><a href="#cha-apparmor-intro"><span class="title-number">29 </span><span class="title-name">Introducing <span class="phrase">AppArmor</span></span></a></span><ul><li><span class="sect1"><a href="#id-1.7.8.2.5"><span class="title-number">29.1 </span><span class="title-name"><span class="phrase">AppArmor</span> components</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-intro-background"><span class="title-number">29.2 </span><span class="title-name">Background information on <span class="phrase">AppArmor</span> profiling</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-apparmor-start"><span class="title-number">30 </span><span class="title-name">Getting started</span></a></span><ul><li><span class="sect1"><a href="#sec-apparmor-start-install"><span class="title-number">30.1 </span><span class="title-name">Installing <span class="phrase">AppArmor</span></span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-start-enable"><span class="title-number">30.2 </span><span class="title-name">Enabling and disabling <span class="phrase">AppArmor</span></span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-start-choose"><span class="title-number">30.3 </span><span class="title-name">Choosing applications to profile</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-start-build"><span class="title-number">30.4 </span><span class="title-name">Building and modifying profiles</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-start-update"><span class="title-number">30.5 </span><span class="title-name">Updating your profiles</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-apparmor-concept"><span class="title-number">31 </span><span class="title-name">Immunizing programs</span></a></span><ul><li><span class="sect1"><a href="#sec-apparmor-concept-tools"><span class="title-number">31.1 </span><span class="title-name">Introducing the <span class="phrase">AppArmor</span> framework</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-concept-determine"><span class="title-number">31.2 </span><span class="title-name">Determining programs to immunize</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-concept-cron"><span class="title-number">31.3 </span><span class="title-name">Immunizing <code class="systemitem">cron</code> jobs</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-concept-network"><span class="title-number">31.4 </span><span class="title-name">Immunizing network applications</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-apparmor-profiles"><span class="title-number">32 </span><span class="title-name">Profile components and syntax</span></a></span><ul><li><span class="sect1"><a href="#sec-apparmor-profiles-parts"><span class="title-number">32.1 </span><span class="title-name">Breaking an <span class="phrase">AppArmor</span> profile into its parts</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-types"><span class="title-number">32.2 </span><span class="title-name">Profile types</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-includes"><span class="title-number">32.3 </span><span class="title-name">Include statements</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-capabilities"><span class="title-number">32.4 </span><span class="title-name">Capability entries (POSIX.1e)</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-nac"><span class="title-number">32.5 </span><span class="title-name">Network access control</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-glob"><span class="title-number">32.6 </span><span class="title-name">Profile names, flags, paths, and globbing</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-perm"><span class="title-number">32.7 </span><span class="title-name">File permission access modes</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-mount"><span class="title-number">32.8 </span><span class="title-name">Mount rules</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-pivot-root"><span class="title-number">32.9 </span><span class="title-name">Pivot root rules</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-ptrace"><span class="title-number">32.10 </span><span class="title-name">PTrace rules</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-signal"><span class="title-number">32.11 </span><span class="title-name">Signal rules</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-exec"><span class="title-number">32.12 </span><span class="title-name">Execute modes</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-rlimit"><span class="title-number">32.13 </span><span class="title-name">Resource limit control</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-profiles-audit"><span class="title-number">32.14 </span><span class="title-name">Auditing rules</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-apparmor-repos"><span class="title-number">33 </span><span class="title-name"><span class="phrase">AppArmor</span> profile repositories</span></a></span></li><li><span class="chapter"><a href="#cha-apparmor-yast"><span class="title-number">34 </span><span class="title-name">Building and managing profiles with YaST</span></a></span><ul><li><span class="sect1"><a href="#sec-apparmor-yast-add"><span class="title-number">34.1 </span><span class="title-name">Manually adding a profile</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-yast-edit"><span class="title-number">34.2 </span><span class="title-name">Editing profiles</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-yast-del"><span class="title-number">34.3 </span><span class="title-name">Deleting a profile</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-yast-manage"><span class="title-number">34.4 </span><span class="title-name">Managing <span class="phrase">AppArmor</span></span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-apparmor-commandline"><span class="title-number">35 </span><span class="title-name">Building profiles from the command line</span></a></span><ul><li><span class="sect1"><a href="#sec-apparmor-commandline-status"><span class="title-number">35.1 </span><span class="title-name">Checking the <span class="phrase">AppArmor</span> status</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-commandline-build"><span class="title-number">35.2 </span><span class="title-name">Building <span class="phrase">AppArmor</span> profiles</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-commandline-add"><span class="title-number">35.3 </span><span class="title-name">Adding or creating an <span class="phrase">AppArmor</span> profile</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-commandline-edit"><span class="title-number">35.4 </span><span class="title-name">Editing an <span class="phrase">AppArmor</span> profile</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-commandline-unload"><span class="title-number">35.5 </span><span class="title-name">Unloading unknown <span class="phrase">AppArmor</span> profiles</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-commandline-del"><span class="title-number">35.6 </span><span class="title-name">Deleting an <span class="phrase">AppArmor</span> profile</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-commandline-profiling"><span class="title-number">35.7 </span><span class="title-name">Two methods of profiling</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-commandline-filenames"><span class="title-number">35.8 </span><span class="title-name">Important file names and directories</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-apparmor-hat"><span class="title-number">36 </span><span class="title-name">Profiling your Web applications using ChangeHat</span></a></span><ul><li><span class="sect1"><a href="#sec-apparmor-hat-config"><span class="title-number">36.1 </span><span class="title-name">Configuring Apache for <code class="systemitem">mod_apparmor</code></span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-hat-apache-managing"><span class="title-number">36.2 </span><span class="title-name">Managing ChangeHat-aware applications</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-apparmor-pam"><span class="title-number">37 </span><span class="title-name">Confining users with <code class="systemitem">pam_apparmor</code></span></a></span></li><li><span class="chapter"><a href="#cha-apparmor-managing"><span class="title-number">38 </span><span class="title-name">Managing profiled applications</span></a></span><ul><li><span class="sect1"><a href="#sec-apparmor-managing-react"><span class="title-number">38.1 </span><span class="title-name">Reacting to security event rejections</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-managing-maintain"><span class="title-number">38.2 </span><span class="title-name">Maintaining your security profiles</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-apparmor-support"><span class="title-number">39 </span><span class="title-name">Support</span></a></span><ul><li><span class="sect1"><a href="#sec-apparmor-support-updating"><span class="title-number">39.1 </span><span class="title-name">Updating <span class="phrase">AppArmor</span> online</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-support-man"><span class="title-number">39.2 </span><span class="title-name">Using the man pages</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-support-info"><span class="title-number">39.3 </span><span class="title-name">More information</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-support-trouble"><span class="title-number">39.4 </span><span class="title-name">Troubleshooting</span></a></span></li><li><span class="sect1"><a href="#sec-apparmor-support-bugs"><span class="title-number">39.5 </span><span class="title-name">Reporting bugs for <span class="phrase">AppArmor</span></span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-apparmor-glossary"><span class="title-number">40 </span><span class="title-name"><span class="phrase">AppArmor</span> glossary</span></a></span></li></ul></li><li><span class="part"><a href="#part-audit"><span class="title-number">VI </span><span class="title-name">The Linux Audit Framework</span></a></span><ul><li><span class="chapter"><a href="#cha-audit-comp"><span class="title-number">41 </span><span class="title-name">Understanding Linux audit</span></a></span><ul><li><span class="sect1"><a href="#sec-audit-bigpicture"><span class="title-number">41.1 </span><span class="title-name">Introducing the components of Linux audit</span></a></span></li><li><span class="sect1"><a href="#sec-audit-auditd"><span class="title-number">41.2 </span><span class="title-name">Configuring the audit daemon</span></a></span></li><li><span class="sect1"><a href="#sec-audit-auditctl"><span class="title-number">41.3 </span><span class="title-name">Controlling the audit system using <code class="command">auditctl</code></span></a></span></li><li><span class="sect1"><a href="#sec-audit-rules"><span class="title-number">41.4 </span><span class="title-name">Passing parameters to the audit system</span></a></span></li><li><span class="sect1"><a href="#sec-audit-aureport"><span class="title-number">41.5 </span><span class="title-name">Understanding the audit logs and generating reports</span></a></span></li><li><span class="sect1"><a href="#sec-audit-ausearch"><span class="title-number">41.6 </span><span class="title-name">Querying the audit daemon logs with <code class="command">ausearch</code></span></a></span></li><li><span class="sect1"><a href="#sec-audit-autrace"><span class="title-number">41.7 </span><span class="title-name">Analyzing processes with <code class="command">autrace</code></span></a></span></li><li><span class="sect1"><a href="#sec-audit-auviz"><span class="title-number">41.8 </span><span class="title-name">Visualizing audit data</span></a></span></li><li><span class="sect1"><a href="#sec-audit-audisp"><span class="title-number">41.9 </span><span class="title-name">Relaying audit event notifications</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-audit-setup"><span class="title-number">42 </span><span class="title-name">Setting up the Linux audit framework</span></a></span><ul><li><span class="sect1"><a href="#sec-audit-choose"><span class="title-number">42.1 </span><span class="title-name">Determining the components to audit</span></a></span></li><li><span class="sect1"><a href="#sec-audit-config"><span class="title-number">42.2 </span><span class="title-name">Configuring the audit daemon</span></a></span></li><li><span class="sect1"><a href="#sec-audit-syscall"><span class="title-number">42.3 </span><span class="title-name">Enabling audit for system calls</span></a></span></li><li><span class="sect1"><a href="#sec-audit-aurules"><span class="title-number">42.4 </span><span class="title-name">Setting up audit rules</span></a></span></li><li><span class="sect1"><a href="#sec-audit-aurepo"><span class="title-number">42.5 </span><span class="title-name">Configuring audit reports</span></a></span></li><li><span class="sect1"><a href="#sec-audit-viz"><span class="title-number">42.6 </span><span class="title-name">Configuring log visualization</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-audit-scenarios"><span class="title-number">43 </span><span class="title-name">Introducing an audit rule set</span></a></span><ul><li><span class="sect1"><a href="#sec-audit-scenbasic"><span class="title-number">43.1 </span><span class="title-name">Adding basic audit configuration parameters</span></a></span></li><li><span class="sect1"><a href="#sec-audit-scenauconf"><span class="title-number">43.2 </span><span class="title-name">Adding watches on audit log files and configuration files</span></a></span></li><li><span class="sect1"><a href="#sec-audit-scenfs"><span class="title-number">43.3 </span><span class="title-name">Monitoring file system objects</span></a></span></li><li><span class="sect1"><a href="#sec-audit-scensecurity"><span class="title-number">43.4 </span><span class="title-name">Monitoring security configuration files and databases</span></a></span></li><li><span class="sect1"><a href="#sec-audit-scenmisc"><span class="title-number">43.5 </span><span class="title-name">Monitoring miscellaneous system calls</span></a></span></li><li><span class="sect1"><a href="#sec-audit-scenipc"><span class="title-number">43.6 </span><span class="title-name">Filtering system call arguments</span></a></span></li><li><span class="sect1"><a href="#sec-audit-scenkeys"><span class="title-number">43.7 </span><span class="title-name">Managing audit event records using keys</span></a></span></li></ul></li><li><span class="chapter"><a href="#cha-audit-moreinfo"><span class="title-number">44 </span><span class="title-name">Useful resources</span></a></span></li></ul></li><li><span class="appendix"><a href="#id-1.7.10"><span class="title-number">A </span><span class="title-name">GNU licenses</span></a></span><ul><li><span class="sect1"><a href="#id-1.7.10.4"><span class="title-number">A.1 </span><span class="title-name">GNU Free Documentation License</span></a></span></li></ul></li></ul></div><div class="list-of-figures"><div class="toc-title">List of Figures</div><ul><li><span class="figure"><a href="#fig-inst-nisclient"><span class="number">3.1 </span><span class="name">Setting domain and address of a NIS server</span></a></span></li><li><span class="figure"><a href="#fig-ldap-tree"><span class="number">5.1 </span><span class="name">Structure of an LDAP directory</span></a></span></li><li><span class="figure"><a href="#fig-ad-schema"><span class="number">7.1 </span><span class="name">Schema of Winbind-based Active Directory authentication</span></a></span></li><li><span class="figure"><a href="#fig-security-logonmanagement"><span class="number">7.2 </span><span class="name">Main window of <span class="guimenu">User logon management</span></span></a></span></li><li><span class="figure"><a href="#fig-security-logonmanagement-enroll"><span class="number">7.3 </span><span class="name">Enrolling into a domain</span></a></span></li><li><span class="figure"><a href="#fig-security-logonmanagement-configure"><span class="number">7.4 </span><span class="name">Configuration window of <span class="guimenu">User logon management</span></span></a></span></li><li><span class="figure"><a href="#fig-ad-smbclient"><span class="number">7.5 </span><span class="name">Determining Windows domain membership</span></a></span></li><li><span class="figure"><a href="#fig-ad-join1"><span class="number">7.6 </span><span class="name">Providing administrator credentials</span></a></span></li><li><span class="figure"><a href="#fig-cryptctl-retrieve"><span class="number">13.1 </span><span class="name">Key retrieval with <code class="command">cryptctl</code> (model without connection to KMIP server)</span></a></span></li><li><span class="figure"><a href="#fig-spectre-meltdown-output"><span class="number">16.1 </span><span class="name">Output from spectre-meltdown-checker</span></a></span></li><li><span class="figure"><a href="#fig-yast-security-overview"><span class="number">17.1 </span><span class="name">YaST security center and hardening: security overview</span></a></span></li><li><span class="figure"><a href="#fig-acls-map-mini"><span class="number">19.1 </span><span class="name">Minimum ACL: ACL entries compared to permission bits</span></a></span></li><li><span class="figure"><a href="#fig-acls-map-ext"><span class="number">19.2 </span><span class="name">Extended ACL: ACL entries compared to permission bits</span></a></span></li><li><span class="figure"><a href="#fig-fail2ban-jail-local"><span class="number">22.1 </span><span class="name"><span class="emphasis"><em>jail.local </em></span>file settings</span></a></span></li><li><span class="figure"><a href="#fig-fire-table"><span class="number">23.1 </span><span class="name">iptables: a packet's possible paths</span></a></span></li><li><span class="figure"><a href="#fig-vpn-scenario-routed-1"><span class="number">24.1 </span><span class="name">Routed VPN</span></a></span></li><li><span class="figure"><a href="#fig-vpn-scenario-briged-1"><span class="number">24.2 </span><span class="name">Bridged VPN - scenario 1</span></a></span></li><li><span class="figure"><a href="#fig-vpn-scenario-briged-2"><span class="number">24.3 </span><span class="name">Bridged VPN - scenario 2</span></a></span></li><li><span class="figure"><a href="#fig-vpn-scenario-briged-3"><span class="number">24.4 </span><span class="name">Bridged VPN - scenario 3</span></a></span></li><li><span class="figure"><a href="#fig-xca-newdb"><span class="number">25.1 </span><span class="name">Create a new XCA database</span></a></span></li><li><span class="figure"><a href="#id-1.7.8.8.11.9.15.6"><span class="number">35.1 </span><span class="name"><code class="command">aa-notify Message in GNOME</code></span></a></span></li><li><span class="figure"><a href="#id-1.7.8.9.20.3.5.5.2"><span class="number">36.1 </span><span class="name">Adminer login page</span></a></span></li><li><span class="figure"><a href="#fig-audit-components"><span class="number">41.1 </span><span class="name">Introducing the components of Linux audit</span></a></span></li><li><span class="figure"><a href="#fig-audit-mkgraph"><span class="number">41.2 </span><span class="name">Flow graph—program versus system call relationship</span></a></span></li><li><span class="figure"><a href="#fig-audit-mkbar"><span class="number">41.3 </span><span class="name">Bar chart—common event types</span></a></span></li></ul></div><div class="list-of-tables"><div class="toc-title">List of Tables</div><ul><li><span class="table"><a href="#tab-ldap-schema"><span class="number">5.1 </span><span class="name">Commonly used object classes and attributes</span></a></span></li><li><span class="table"><a href="#id-1.7.5.7.6.7.4"><span class="number">14.1 </span><span class="name">Sample rules/constraints for password enforcement</span></a></span></li><li><span class="table"><a href="#tab-entrytype"><span class="number">19.1 </span><span class="name">ACL entry types</span></a></span></li><li><span class="table"><a href="#tab-mask"><span class="number">19.2 </span><span class="name">Masking access permissions</span></a></span></li><li><span class="table"><a href="#tab-aide-options"><span class="number">20.1 </span><span class="name">Important AIDE check boxes</span></a></span></li><li><span class="table"><a href="#tab-security-firewall-sysconfigports"><span class="number">23.1 </span><span class="name">Important sysconfig variables for static port configuration</span></a></span></li><li><span class="table"><a href="#id-1.7.8.12.5.3"><span class="number">39.1 </span><span class="name">Man pages: sections and categories</span></a></span></li><li><span class="table"><a href="#tab-audit-auditctl"><span class="number">41.1 </span><span class="name">Audit status flags</span></a></span></li></ul></div><div class="list-of-examples"><div class="toc-title">List of Examples</div><ul><li><span class="example"><a href="#dat-pam-sshd"><span class="number">2.1 </span><span class="name">PAM configuration for sshd (<code class="filename">/etc/pam.d/sshd</code>)</span></a></span></li><li><span class="example"><a href="#dat-pam-common-auth"><span class="number">2.2 </span><span class="name">Default configuration for the <code class="literal">auth</code> section (<code class="filename">common-auth</code>)</span></a></span></li><li><span class="example"><a href="#dat-pam-common-account"><span class="number">2.3 </span><span class="name">Default configuration for the <code class="literal">account</code> section (<code class="filename">common-account</code>)</span></a></span></li><li><span class="example"><a href="#dat-pam-common-password"><span class="number">2.4 </span><span class="name">Default configuration for the <code class="literal">password</code> section (<code class="filename">common-password</code>)</span></a></span></li><li><span class="example"><a href="#dat-pam-common-session"><span class="number">2.5 </span><span class="name">Default configuration for the <code class="literal">session</code> section (<code class="filename">common-session</code>)</span></a></span></li><li><span class="example"><a href="#dat-pam-pamenv"><span class="number">2.6 </span><span class="name">pam_env.conf</span></a></span></li><li><span class="example"><a href="#aus-ldap-schema-help"><span class="number">5.1 </span><span class="name">Excerpt from CN=schema</span></a></span></li><li><span class="example"><a href="#ex-ldap-389-ds-inf"><span class="number">5.2 </span><span class="name">Minimal 389 Directory Server instance configuration file</span></a></span></li><li><span class="example"><a href="#ex-security-ldap-server-credentials-local"><span class="number">5.3 </span><span class="name">A <code class="filename">.dsrc</code> file for local administration</span></a></span></li><li><span class="example"><a href="#ex-ldap-replication-two-replicas"><span class="number">5.4 </span><span class="name">Two supplier replicas</span></a></span></li><li><span class="example"><a href="#ex-ldap-replication-four-replicas"><span class="number">5.5 </span><span class="name">Four supplier replicas</span></a></span></li><li><span class="example"><a href="#ex-ldap-replication-six-replicas"><span class="number">5.6 </span><span class="name">Six replicas</span></a></span></li><li><span class="example"><a href="#ex-ldap-replication-six-replicas-read-only"><span class="number">5.7 </span><span class="name">Six replicas with read-only consumers</span></a></span></li><li><span class="example"><a href="#usbguard-config-file-ipcaccess"><span class="number">9.1 </span><span class="name">Configuration</span></a></span></li><li><span class="example"><a href="#ex-sshd-conf"><span class="number">22.1 </span><span class="name">Example sshd_config</span></a></span></li><li><span class="example"><a href="#ex-security-firewall-nfscallback"><span class="number">23.1 </span><span class="name">Callback port configuration for the <code class="literal">nfs</code> kernel module in <code class="filename">/etc/modprobe.d/60-nfs.conf</code></span></a></span></li><li><span class="example"><a href="#ex-security-firewall-newrpcservice"><span class="number">23.2 </span><span class="name">Commands to define a new <code class="systemitem">firewalld</code> RPC service for NFS</span></a></span></li><li><span class="example"><a href="#ex-vpn-serv-config"><span class="number">24.1 </span><span class="name">VPN server configuration file</span></a></span></li><li><span class="example"><a href="#id-1.7.6.6.5.7.3"><span class="number">24.2 </span><span class="name">VPN client configuration file</span></a></span></li><li><span class="example"><a href="#ex-unconfined"><span class="number">30.1 </span><span class="name">Output of <code class="command">aa-unconfined</code></span></a></span></li><li><span class="example"><a href="#ex-apparmor-commandline-profiling-summary-genprof-learn"><span class="number">35.1 </span><span class="name">Learning mode exception: controlling access to specific resources</span></a></span></li><li><span class="example"><a href="#ex-apparmor-commandline-profiling-summary-genprof-perms"><span class="number">35.2 </span><span class="name">Learning mode exception: defining permissions for an entry</span></a></span></li><li><span class="example"><a href="#id-1.7.9.3.8.3"><span class="number">41.1 </span><span class="name">Default /etc/audit/auditd.conf</span></a></span></li><li><span class="example"><a href="#ex-auditctl-status"><span class="number">41.2 </span><span class="name">Example output of <code class="command">auditctl</code> <code class="option">-s</code></span></a></span></li><li><span class="example"><a href="#ex-audit-rules-sysparam"><span class="number">41.3 </span><span class="name">Example audit rules—audit system parameters</span></a></span></li><li><span class="example"><a href="#ex-audit-rules-fs"><span class="number">41.4 </span><span class="name">Example audit rules—file system auditing</span></a></span></li><li><span class="example"><a href="#ex-audit-rules-syscall"><span class="number">41.5 </span><span class="name">Example audit rules—system call auditing</span></a></span></li><li><span class="example"><a href="#ex-audit-ruledel"><span class="number">41.6 </span><span class="name">Deleting audit rules and events</span></a></span></li><li><span class="example"><a href="#id-1.7.9.3.10.16"><span class="number">41.7 </span><span class="name">Listing rules with <code class="command">auditctl</code> <code class="option">-l</code></span></a></span></li><li><span class="example"><a href="#ex-audit-aureport-logtrail"><span class="number">41.8 </span><span class="name">A simple audit event—viewing the audit log</span></a></span></li><li><span class="example"><a href="#ex-audit-aureport-sshd"><span class="number">41.9 </span><span class="name">An advanced audit event—login via SSH</span></a></span></li><li><span class="example"><a href="#id-1.7.9.3.15.5"><span class="number">41.10 </span><span class="name">Example /etc/audit/auditd.conf</span></a></span></li><li><span class="example"><a href="#id-1.7.9.3.15.8"><span class="number">41.11 </span><span class="name">Example /etc/audit/plugins.d/syslog.conf</span></a></span></li></ul></div><div><div xml:lang="en" class="legalnotice" id="id-1.7.1.5"><p>
  Copyright © 2006–2024

  SUSE LLC and contributors. All rights reserved.
 </p><p>
  Permission is granted to copy, distribute and/or modify this document under
  the terms of the GNU Free Documentation License, Version 1.2 or (at your
  option) version 1.3; with the Invariant Section being this copyright notice
  and license. A copy of the license version 1.2 is included in the section
  entitled <span class="quote">“<span class="quote">GNU Free Documentation License</span>”</span>.
 </p><p>
  For SUSE trademarks, see
  <a class="link" href="https://www.suse.com/company/legal/" target="_blank">https://www.suse.com/company/legal/</a>. All
  third-party trademarks are the property of their respective owners. Trademark
  symbols (®, ™ etc.) denote trademarks of SUSE and its affiliates.
  Asterisks (*) denote third-party trademarks.
 </p><p>
  All information found in this book has been compiled with utmost attention to
  detail. However, this does not guarantee complete accuracy. Neither
  SUSE LLC, its affiliates, the authors nor the translators shall be
  held liable for possible errors or the consequences thereof.
 </p></div></div><section class="preface" id="preface-security" data-id-title="Preface"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number"> </span><span class="title-name">Preface</span></span> <a title="Permalink" class="permalink" href="#preface-security">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_intro.xml" title="Edit source document"> </a></div></div></div></div></div><section xml:lang="en" class="sect1" id="id-1.7.2.3" data-id-title="Available documentation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1 </span><span class="title-name">Available documentation</span></span> <a title="Permalink" class="permalink" href="#id-1.7.2.3">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_available_doc.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.2.3.3.1"><span class="term">Online documentation</span></dt><dd><p>
     Our documentation is available online at <a class="link" href="https://documentation.suse.com" target="_blank">https://documentation.suse.com</a>.
     Browse or download the documentation in various formats.
    </p><div id="id-1.7.2.3.3.1.2.2" data-id-title="Latest updates" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Latest updates</div><p>
      The latest updates are usually available in the English-language version of this documentation.
     </p></div></dd><dt id="id-1.7.2.3.3.2"><span class="term">SUSE Knowledgebase</span></dt><dd><p>
     If you have run into an issue, also check out the Technical Information
     Documents (TIDs) that are available online at <a class="link" href="https://www.suse.com/support/kb/" target="_blank">https://www.suse.com/support/kb/</a>.
     Search the SUSE Knowledgebase for known solutions driven by customer need.
     </p></dd><dt id="id-1.7.2.3.3.3"><span class="term">Release notes</span></dt><dd><p>
     For release notes, see
     <a class="link" href="https://www.suse.com/releasenotes/" target="_blank">https://www.suse.com/releasenotes/</a>.
    </p></dd><dt id="id-1.7.2.3.3.4"><span class="term">In your system</span></dt><dd><p>
      For offline use, the release notes are also available under
      <code class="filename">/usr/share/doc/release-notes</code> on your system.
      The documentation for individual packages is available at
      <code class="filename">/usr/share/doc/packages</code>.
    </p><p>
      Many commands are also described in their <span class="emphasis"><em>manual
      pages</em></span>. To view them, run <code class="command">man</code>, followed
      by a specific command name. If the <code class="command">man</code> command is
      not installed on your system, install it with <code class="command">sudo zypper
      install man</code>.
    </p></dd></dl></div></section><section xml:lang="en" class="sect1" id="id-1.7.2.4" data-id-title="Improving the documentation"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2 </span><span class="title-name">Improving the documentation</span></span> <a title="Permalink" class="permalink" href="#id-1.7.2.4">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_feedback.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Your feedback and contributions to this documentation are welcome.
  The following channels for giving feedback are available:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.2.4.4.1"><span class="term">Service requests and support</span></dt><dd><p>
     For services and support options available for your product, see
     <a class="link" href="https://www.suse.com/support/" target="_blank">https://www.suse.com/support/</a>.
    </p><p>
     To open a service request, you need a SUSE subscription registered at
     SUSE Customer Center.
     Go to <a class="link" href="https://scc.suse.com/support/requests" target="_blank">https://scc.suse.com/support/requests</a>, log
     in, and click <span class="guimenu">Create New</span>.
    </p></dd><dt id="id-1.7.2.4.4.2"><span class="term">Bug reports</span></dt><dd><p>
     Report issues with the documentation at <a class="link" href="https://bugzilla.suse.com/" target="_blank">https://bugzilla.suse.com/</a>.
    </p><p>
     To simplify this process, click the <span class="guimenu">Report
     an issue</span> icon next to a headline in the HTML
     version of this document. This preselects the right product and
     category in Bugzilla and adds a link to the current section.
     You can start typing your bug report right away.
    </p><p>
     A Bugzilla account is required.
    </p></dd><dt id="id-1.7.2.4.4.3"><span class="term">Contributions</span></dt><dd><p>
     To contribute to this documentation, click the <span class="guimenu">Edit source
     document</span> icon next to a headline in the HTML version of
     this document. This will take you to the source code on GitHub, where you
     can open a pull request.</p><p>
     A GitHub account is required.
    </p><div id="id-1.7.2.4.4.3.2.3" data-id-title="Edit source document only available for English" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <span class="guimenu">Edit source document</span> only available for English</div><p>
      The <span class="guimenu">Edit source document</span> icons are only available for the
      English version of each document. For all other languages, use the
      <span class="guimenu">Report an issue</span> icons instead.
     </p></div><p>
     For more information about the documentation environment used for this
     documentation, see the repository's README.
    </p></dd><dt id="id-1.7.2.4.4.4"><span class="term">Mail</span></dt><dd><p>
     You can also report errors and send feedback concerning the
     documentation to &lt;<a class="email" href="mailto:doc-team@suse.com">doc-team@suse.com</a>&gt;. Include the
     document title, the product version, and the publication date of the
     document. Additionally, include the relevant section number and title (or
     provide the URL) and provide a concise description of the problem.
    </p></dd></dl></div></section><section xml:lang="en" class="sect1" id="id-1.7.2.5" data-id-title="Documentation conventions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3 </span><span class="title-name">Documentation conventions</span></span> <a title="Permalink" class="permalink" href="#id-1.7.2.5">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_convention.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following notices and typographic conventions are used in this
  document:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    <code class="filename">/etc/passwd</code>: Directory names and file names
   </p></li><li class="listitem"><p>
    <em class="replaceable">PLACEHOLDER</em>: Replace
    <em class="replaceable">PLACEHOLDER</em> with the actual value
   </p></li><li class="listitem"><p>
    <code class="envar">PATH</code>: An environment variable
   </p></li><li class="listitem"><p>
    <code class="command">ls</code>, <code class="option">--help</code>: Commands, options, and
    parameters
   </p></li><li class="listitem"><p>
    <code class="systemitem">user</code>: The name of a user or group
   </p></li><li class="listitem"><p>
    <span class="package">package_name</span>: The name of a software package
   </p></li><li class="listitem"><p>
    <span class="keycap">Alt</span>, <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F1</span>: A key to press or a key combination. Keys
    are shown in uppercase as on a keyboard.
   </p></li><li class="listitem"><p>
    <span class="guimenu">File</span>, <span class="guimenu">File</span> › <span class="guimenu">Save
    As</span>: menu items, buttons
   </p></li><li class="listitem"><p>
    <em class="citetitle">Chapter 1, <span class="quote">“<span class="quote">Example chapter</span>”</span></em>:
    A cross-reference to another chapter in this guide.
   </p></li><li class="listitem"><p>
    Commands that must be run with <code class="systemitem">root</code> privileges. You can also
    prefix these commands with the <code class="command">sudo</code> command to run them
    as a non-privileged user:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">command</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">command</code></pre></div></li><li class="listitem"><p>
    Commands that can be run by non-privileged users:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">command</code></pre></div></li><li class="listitem"><p>
    Commands can be split into two or multiple lines by a backslash character
    (<code class="literal">\</code>) at the end of a line. The backslash informs the shell that
    the command invocation will continue after the line's end:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">echo</code> a b \
c d</pre></div></li><li class="listitem"><p>
     A code block that shows both the command (preceded by a prompt)
     and the respective output returned by the shell:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">command</code>
output</pre></div></li><li class="listitem"><p>
    Notices
   </p><div id="id-1.7.2.5.4.14.2" data-id-title="Warning notice" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Warning notice</div><p>
     Vital information you must be aware of before proceeding. Warns you about
     security issues, potential loss of data, damage to hardware, or physical
     hazards.
    </p></div><div id="id-1.7.2.5.4.14.3" data-id-title="Important notice" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Important notice</div><p>
     Important information you should be aware of before proceeding.
    </p></div><div id="id-1.7.2.5.4.14.4" data-id-title="Note notice" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Note notice</div><p>
     Additional information, for example about differences in software
     versions.
    </p></div><div id="id-1.7.2.5.4.14.5" data-id-title="Tip notice" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Tip notice</div><p>
     Helpful information, like a guideline or a piece of practical advice.
    </p></div></li><li class="listitem"><p>
    Compact Notices
   </p><div id="id-1.7.2.5.4.15.2" class="admonition note compact"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><p>
     Additional information, for example about differences in software
     versions.
    </p></div><div id="id-1.7.2.5.4.15.3" class="admonition tip compact"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><p>
     Helpful information, like a guideline or a piece of practical advice.
    </p></div></li></ul></div></section><section xml:lang="en" class="sect1" id="id-1.7.2.6" data-id-title="Support"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4 </span><span class="title-name">Support</span></span> <a title="Permalink" class="permalink" href="#id-1.7.2.6">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Find the support statement for <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> and general information about
  technology previews below.
  For details about the product lifecycle, see
  <a class="link" href="https://www.suse.com/lifecycle" target="_blank">https://www.suse.com/lifecycle</a>.
 </p><p>
  If you are entitled to support, find details on how to collect information
  for a support ticket at
  <a class="link" href="https://documentation.suse.com/sles-15/html/SLES-all/cha-adm-support.html" target="_blank">https://documentation.suse.com/sles-15/html/SLES-all/cha-adm-support.html</a>.
 </p><section class="sect2" id="id-1.7.2.6.5" data-id-title="Support statement for SUSE Linux Enterprise Desktop"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.1 </span><span class="title-name">Support statement for <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span></span> <a title="Permalink" class="permalink" href="#id-1.7.2.6.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To receive support, you need an appropriate subscription with SUSE.
   To view the specific support offers available to you, go to
   <a class="link" href="https://www.suse.com/support/" target="_blank">https://www.suse.com/support/</a> and select your product.
  </p><p>
   The support levels are defined as follows:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.2.6.5.4.1"><span class="term">L1</span></dt><dd><p>
      Problem determination, which means technical support designed to provide
      compatibility information, usage support, ongoing maintenance,
      information gathering and basic troubleshooting using available
      documentation.
     </p></dd><dt id="id-1.7.2.6.5.4.2"><span class="term">L2</span></dt><dd><p>
      Problem isolation, which means technical support designed to analyze
      data, reproduce customer problems, isolate a problem area and provide a
      resolution for problems not resolved by Level 1 or prepare for
      Level 3.
     </p></dd><dt id="id-1.7.2.6.5.4.3"><span class="term">L3</span></dt><dd><p>
      Problem resolution, which means technical support designed to resolve
      problems by engaging engineering to resolve product defects which have
      been identified by Level 2 Support.
     </p></dd></dl></div><p>
   For contracted customers and partners, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> is delivered with L3
   support for all packages, except for the following:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Technology previews.
    </p></li><li class="listitem"><p>
     Sound, graphics, fonts, and artwork.
    </p></li><li class="listitem"><p>
     Packages that require an additional customer contract.
    </p></li><li class="listitem"><p>
     Packages with names ending in <span class="package">-devel</span> (containing header
     files and similar developer resources) will only be supported together
     with their main packages.
    </p></li></ul></div><p>
   SUSE will only support the usage of original packages.
   That is, packages that are unchanged and not recompiled.
  </p></section><section class="sect2" id="id-1.7.2.6.6" data-id-title="Technology previews"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.2 </span><span class="title-name">Technology previews</span></span> <a title="Permalink" class="permalink" href="#id-1.7.2.6.6">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_intro_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Technology previews are packages, stacks, or features delivered by SUSE
   to provide glimpses into upcoming innovations.
   Technology previews are included for your convenience to give you a chance
   to test new technologies within your environment.
   We would appreciate your feedback.
   If you test a technology preview, please contact your SUSE representative
   and let them know about your experience and use cases.
   Your input is helpful for future development.
  </p><p>
   Technology previews have the following limitations:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Technology previews are still in development.
     Therefore, they may be functionally incomplete, unstable, or otherwise
     <span class="emphasis"><em>not</em></span> suitable for production use.
    </p></li><li class="listitem"><p>
     Technology previews are <span class="emphasis"><em>not</em></span> supported.
    </p></li><li class="listitem"><p>
     Technology previews may only be available for specific hardware
     architectures.
    </p></li><li class="listitem"><p>
     Details and functionality of technology previews are subject to change.
     As a result, upgrading to subsequent releases of a technology preview may
     be impossible and require a fresh installation.
    </p></li><li class="listitem"><p>
     SUSE may discover that a preview does not meet customer or market needs,
     or does not comply with enterprise standards.
     Technology previews can be removed from a product at any time.
     SUSE does not commit to providing a supported version of such
     technologies in the future.
    </p></li></ul></div><p>
   For an overview of technology previews shipped with your product, see the
   release notes at <a class="link" href="https://www.suse.com/releasenotes" target="_blank">https://www.suse.com/releasenotes</a>.
  </p></section></section></section><section class="chapter" id="cha-security" data-id-title="Security and confidentiality"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">1 </span><span class="title-name">Security and confidentiality</span></span> <a title="Permalink" class="permalink" href="#cha-security">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    This chapter introduces basic concepts of computer security.
    Threats and basic mitigation techniques are described. The chapter
    also provides references to other chapters, guides and Web sites with
    further information.
   </p></div></div></div></div><section class="sect1" id="sec-security-overview" data-id-title="Overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.1 </span><span class="title-name">Overview</span></span> <a title="Permalink" class="permalink" href="#sec-security-overview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   One main characteristic of Linux is its ability to handle multiple
   users at the same time (multiuser) and to allow these users to
   simultaneously perform tasks (multitasking) on the same computer.
   To users, there is no difference between working with data stored
   locally and data stored in the network.
  </p><p>
   Because of the multiuser capability, data from different users has to be stored
   separately to guarantee security and privacy. Also important is the ability
   to keep data available in spite of a lost or damaged data medium, for
   example a hard disk.
  </p><p>
   This chapter is primarily focused on confidentiality and privacy. But
   a comprehensive security concept includes a regularly updated,
   workable, and tested backup. Without a backup, restoring data after
   it has been tampered with or after a hardware failure is very hard.
  </p><p>
   Use a <span class="emphasis"><em>defense-in-depth</em></span> approach to security:
   Assume that no single threat mitigation can fully protect your
   systems and data, but multiple layers of defense will make an attack
   much harder. Components of a defense-in-depth strategy can be the
   following:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Hashing passwords (for example with PBKDF2, bcrypt, or scrypt) and
     salting them
    </p></li><li class="listitem"><p>Encrypting data (for example with AES)</p></li><li class="listitem"><p>Logging, monitoring, and intrusion detection</p></li><li class="listitem"><p>Firewall</p></li><li class="listitem"><p>Antivirus scanner</p></li><li class="listitem"><p>Defined and documented emergency procedures</p></li><li class="listitem"><p>Backups</p></li><li class="listitem"><p>Physical security</p></li><li class="listitem"><p>Audits, security scans, and intrusion tests</p></li></ul></div><p>
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> includes software that addresses the requirements of
   the list above. The following sections provide starting points for
   securing your system.
  </p></section><section class="sect1" id="sec-security-passwords" data-id-title="Passwords"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.2 </span><span class="title-name">Passwords</span></span> <a title="Permalink" class="permalink" href="#sec-security-passwords">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   On a Linux system, only hashes of passwords are stored. Hashes are
   one-way algorithms which scramble data to a digital fingerprint that
   is hard to reverse.
  </p><p>
   The hashes are stored in the file <code class="filename">/etc/shadow</code>,
   which cannot be read by normal users. Because restoring passwords is
   possible with powerful computers, hashed passwords should not be
   visible to regular users.
  </p><p>
   The <span class="emphasis"><em>National Institute of Standards and
   Technology</em></span> (<span class="emphasis"><em>NIST</em></span>) publishes a
   guideline for passwords, which is available at <a class="link" href="https://pages.nist.gov/800-63-3/sp800-63b.html#sec5" target="_blank">https://pages.nist.gov/800-63-3/sp800-63b.html#sec5</a>
  </p><p>
   For details about how to set a password policy, see <a class="xref" href="#sec-security-yast-security-password" title="17.3. Password settings">Section 17.3, “<span class="guimenu">Password settings</span>”</a>. For general
   information about authentication on Linux, see <a class="xref" href="#part-auth" title="Part I. Authentication">Part I, “Authentication”</a>.
  </p></section><section class="sect1" id="sec-sec-prot-general-backups" data-id-title="Backups"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.3 </span><span class="title-name">Backups</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-backups">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If your system is compromised, backups can be used to restore a prior
    system state. When bugs or accidents occur, backups can also be used to
    compare the current system against an older version. For production
    systems, it is very important to take some backups off-site for cases like
    disasters (for example, off-site storage of tapes/recordable media, or
    off-site initiated).
   </p><p>
    For legal reasons, some firms and organizations must be careful about
    backing up too much information and holding it too long. If your
    environment has a policy regarding the destruction of old paper files, you
    might need to extend this policy to Linux backup tapes as well.
   </p><p>
    The rules about physical security of servers apply to backups as well.
    Additionally, it is advisable to encrypt backup data. This can be done
    either per individual backup archive or for the complete backup file
    system, if applicable. Should a backup medium ever be lost, for example
    during transportation, the data will be protected against unauthorized
    access. The same applies if a backup system itself is compromised. To
    some extent encryption also ensures the integrity of the backups.  Keep
    in mind, however, that the appropriate people need to be able to decrypt
    backups in emergency situations. Also, the case that an encryption key
    itself is compromised and needs to be replaced should be considered.
   </p><p>
    If a system is known to be compromised or suspected to be compromised,
    then it is vital to determine the integrity status of backups. If a
    system compromise went undetected for a long period of time, then it is
    possible that backups already include manipulated configuration files or
    malicious programs. Keeping a long enough history of backups allows to
    inspect for possible unwarranted differences.
   </p><p>
    Even in the absence of any known security breach, a regular inspection of
    differences among important configuration files in backups can help with
    finding security issues (maybe even accidental misconfigurations). This
    approach is best suited for files and environments where the content
    does not change too frequently.
   </p></section><section class="sect1" id="sec-security-integrity" data-id-title="System integrity"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.4 </span><span class="title-name">System integrity</span></span> <a title="Permalink" class="permalink" href="#sec-security-integrity">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If it is possible to physically access a computer, the firmware and
   boot process can be manipulated to gain access when an
   authorized person boots the machine. While not all computers can be locked
   into inaccessible rooms, your first step should be physically locking the
   server room. 
  </p><p>
      Also remember that disposing of old equipment must be handled in a secure 
      manner. Securing the boot loader and restricting removable media also
      provide useful physical security. See 
      <a class="xref" href="#cha-physical-security" title="Chapter 9. Physical security">Chapter 9, <em>Physical security</em></a> for more information.
  </p><p>
   Consider taking the following additional measures:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Configure your system so it cannot be booted from a removable
     device.
    </p></li><li class="listitem"><p>
     Protect the boot process with a UEFI password, Secure Boot, and a GRUB2
     password.
    </p></li><li class="listitem"><p>
     Linux systems are started by a boot loader that usually allows
     passing additional options to the booted kernel. You can prevent others
     from using such parameters during boot by setting an additional
     password for the boot loader. This is crucial to system
     security. Not only does the kernel itself run with <code class="systemitem">root</code>
     permissions, but it is also the first authority to grant
     <code class="systemitem">root</code> permissions at system start-up.
    </p><p>
     For more information about setting a password in the boot loader, see
     <span class="intraxref">Book “Administration Guide”, Chapter 18 “The boot loader GRUB 2”, Section 18.2.6 “Setting a boot password”</span>.
    </p></li><li class="listitem"><p>
     Enable hard disk encryption. For more information, see
     <a class="xref" href="#cha-security-cryptofs" title="Chapter 12. Encrypting partitions and files">Chapter 12, <em>Encrypting partitions and files</em></a>.
    </p></li><li class="listitem"><p>
    Use <code class="command">cryptctl</code> to encrypt hosted storage. For more 
    information, see <a class="xref" href="#cha-configure-cryptctl" title="Chapter 13. Storage encryption for hosted applications with cryptctl">Chapter 13, <em>Storage encryption for hosted applications with cryptctl</em></a>.
    </p></li><li class="listitem"><p>
     Use AIDE to detect any changes in your system configuration. For
     more information, see <a class="xref" href="#cha-aide" title="Chapter 20. Intrusion detection with AIDE">Chapter 20, <em>Intrusion detection with AIDE</em></a>.
    </p></li></ul></div></section><section class="sect1" id="sec-security-file-access" data-id-title="File access"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.5 </span><span class="title-name">File access</span></span> <a title="Permalink" class="permalink" href="#sec-security-file-access">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Because of the <span class="emphasis"><em>everything is a file</em></span> approach in
   Linux, file permissions are important for controlling access to most
   resources. This means that by using file permissions, you can define
   access to regular files, directories, and hardware devices.
   By default, most hardware devices are only accessible for
   <code class="systemitem">root</code>. However, some devices, for example serial ports, can be
   accessible for normal users.
  </p><p>
   As a general rule, always work with the most restrictive privileges
   possible for a given task. For example, it is definitely not
   necessary to be <code class="systemitem">root</code> to read or write e-mail. If the mail
   program has a bug, this bug could be exploited for an attack that
   acts with exactly the permissions of the program at the time of the
   attack. By following the above rule, minimize the possible damage.
  </p><p>
   For details, see <a class="xref" href="#sec-security-acls-traditional" title="19.1. Traditional file permissions">Section 19.1, “Traditional file permissions”</a> and
   <a class="xref" href="#sec-security-acls-intro" title="19.2. Advantages of ACLs">Section 19.2, “Advantages of ACLs”</a>.
  </p><p>
   <span class="phrase">AppArmor</span> <span class="phrase">allows</span> you to set constraints for applications and
   users. For details, see <a class="xref" href="#part-apparmor" title="Part V. Confining privileges with AppArmor">Part V, “Confining privileges with <span class="phrase">AppArmor</span>”</a>.
  </p><p>
   If there is a chance that hard disks could be accessed outside of the
   installed operating system, for example by booting a live system or removing
   the hardware, encrypt the data. <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> allows you to encrypt
   partitions containing data and the operating system. For details, see <a class="xref" href="#cha-security-cryptofs" title="Chapter 12. Encrypting partitions and files">Chapter 12, <em>Encrypting partitions and files</em></a>.
  </p></section><section class="sect1" id="sec-security-network" data-id-title="Networking"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.6 </span><span class="title-name">Networking</span></span> <a title="Permalink" class="permalink" href="#sec-security-network">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Securing network services is a crucial task. Aim to secure
   as many layers of the <span class="emphasis"><em>OSI model</em></span> as possible.
  </p><p>
   All communication should be authenticated and encrypted with
   up-to-date cryptographic algorithms on the transport or application
   layer. Use a Virtual Private Network (VPN) as an additional secure
   layer on physical networks.
  </p><p>
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> provides many options for securing your network:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Use <code class="command">openssl</code> to create X509 certificates. These certificates can be
     used for encryption and authentication of many services.
     You can set up your own <span class="emphasis"><em>certificate authority</em></span>
     (<span class="emphasis"><em>CA</em></span>) and use it as a source of trust in your
     network. For details, see <code class="command">man openssl</code>.
    </p></li><li class="listitem"><p>
     Usually, at least parts of networks are exposed to the public
     Internet. Reduce attack surfaces by closing ports with firewall
     rules and by uninstalling or at least disabling services that are not
     required.
     For details, see <a class="xref" href="#cha-security-firewall" title="Chapter 23. Masquerading and firewalls">Chapter 23, <em>Masquerading and firewalls</em></a>.
    </p></li><li class="listitem"><p>
     Use OpenVPN to secure communication channels over insecure
     physical networks. For details, see <a class="xref" href="#cha-security-vpnserver" title="Chapter 24. Configuring a VPN server">Chapter 24, <em>Configuring a VPN server</em></a>.
    </p></li><li class="listitem"><p>
     Use strong authentication for network services. For details, see
     <a class="xref" href="#part-auth" title="Part I. Authentication">Part I, “Authentication”</a>.
    </p></li></ul></div></section><section class="sect1" id="sec-security-vulnerabilities" data-id-title="Software vulnerabilities"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.7 </span><span class="title-name">Software vulnerabilities</span></span> <a title="Permalink" class="permalink" href="#sec-security-vulnerabilities">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Software vulnerabilities are issues in software that can be
   exploited to obtain unauthorized access or misuse systems.
   Vulnerabilities are especially critical if they affect remote
   services, such as HTTP servers. Computer systems are very complex,
   therefore they always include certain vulnerabilities.
  </p><p>
   When such issues become known, they must usually be fixed in the
   software by software developers. The resulting update must then be
   installed by system administrators in a timely and safe manner on
   affected systems.
  </p><p>
   Vulnerabilities are usually announced on centralized
   databases, for example the <span class="emphasis"><em>National Vulnerability
   Database</em></span>, which is maintained by the US government.
   You can subscribe to feeds to stay informed about newly
   discovered vulnerabilities. In some cases the problems induced by
   the bugs can be mitigated until a software update is provided.
   Vulnerabilities are assigned a <span class="emphasis"><em>Common Vulnerabilities
   and Exposures</em></span> (<span class="emphasis"><em>CVE</em></span>) number and a
   <span class="emphasis"><em>Common Vulnerability Scoring System</em></span>
   (<span class="emphasis"><em>CVSS</em></span>) score. The score helps identify
   the severity of vulnerabilities.
  </p><p>
   SUSE provides a feed of security advisories. It is available at
   <a class="link" href="https://www.suse.com/en-us/support/update/" target="_blank">https://www.suse.com/en-us/support/update/</a>.
   There is also a list of security updates by CVE number available at
   <a class="link" href="https://www.suse.com/support/security/" target="_blank">https://www.suse.com/support/security/</a>.
  </p><div id="id-1.7.3.9.6" data-id-title="Backports and version numbers" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Backports and version numbers</div><p>
    SUSE employs the practice of applying the important source code
    fixes onto older stable versions of software
    (<span class="emphasis"><em>backporting</em></span>). Therefore, even if the version
    number of a software in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> is lower than that of the
    latest version number from the upstream project, the software
    version in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> may already contain the latest fixes for
    vulnerabilities.
   </p><p>
    For more information, see <span class="intraxref">Book “Upgrade Guide”, Chapter 7 “Backports of source code”</span>.
   </p></div><p>
   In general, administrators should be prepared for severe
   vulnerabilities in their systems. This includes hardening all
   computers as far as possible. Also, we recommend to have predefined
   procedures in place for quickly installing updates for severe
   vulnerabilities.
  </p><p>
   To reduce the damage of possible attacks, use restrictive file
   permissions. See <a class="xref" href="#sec-security-acls-traditional" title="19.1. Traditional file permissions">Section 19.1, “Traditional file permissions”</a>.
  </p><p>
   Other useful links:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <a class="link" href="http://lists.opensuse.org/opensuse-security-announce/" target="_blank">http://lists.opensuse.org/opensuse-security-announce/</a>,
     mailing list with openSUSE security announcements
    </p></li><li class="listitem"><p>
     <a class="link" href="https://nvd.nist.gov/" target="_blank">https://nvd.nist.gov/</a>, the National
     Vulnerability Database
    </p></li><li class="listitem"><p>
     <a class="link" href="https://cve.mitre.org/" target="_blank">https://cve.mitre.org/</a>, MITRE's CVE database
    </p></li><li class="listitem"><p><a class="link" href="https://www.bsi.bund.de/SiteGlobals/Forms/Suche/BSI/Sicherheitswarnungen/Sicherheitswarnungen_Formular.html" target="_blank">https://www.bsi.bund.de/SiteGlobals/Forms/Suche/BSI/Sicherheitswarnungen/Sicherheitswarnungen_Formular.html</a>, <span class="emphasis"><em>German Federal Office for Information
    Security</em></span> vulnerability feed</p></li><li class="listitem"><p>
    <a class="link" href="https://www.first.org/cvss/" target="_blank">https://www.first.org/cvss/</a>, information about the Common    Vulnerability Scoring System
    </p></li></ul></div></section><section class="sect1" id="sec-security-malware" data-id-title="Malware"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.8 </span><span class="title-name">Malware</span></span> <a title="Permalink" class="permalink" href="#sec-security-malware">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="emphasis"><em>Malware</em></span> is software that is intended to
   interrupt the normal functioning of a computer or steal data. This
   includes viruses, worms, ransomware, or rootkits. Sometimes malware
   uses software vulnerabilities to attack a computer. However, often
   it is accidentally executed by a user, especially when
   installing third-party software from unknown sources. <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>
   provides an extensive list of programs (packages) in its download
   repositories. This reduces the need to download third-party
   software. All packages provided by SUSE are signed. The package
   manager of <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> checks the signatures of packages after the
   download to verify their integrity.
  </p><p>
   The command <code class="command">rpm</code> <code class="option">--checksig
   <em class="replaceable">RPM_FILE</em></code> shows whether the
   checksum and the signature of a package are correct.
   You can find the signing key on the first DVD of <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> and
   on most key servers worldwide.
  </p><p>
   You can use the ClamAV antivirus software to detect malware on your
   system. ClamAV can be integrated into several services, for example
   mail servers and HTTP proxies. This can be used to filter malware
   before it reaches the user.
  </p><p>
   Restrictive user privileges can reduce the risk of accidental
   code execution.
  </p></section><section class="sect1" id="sec-security-tips" data-id-title="Important security tips"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.9 </span><span class="title-name">Important security tips</span></span> <a title="Permalink" class="permalink" href="#sec-security-tips">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following tips are a quick summary of the sections above:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Stay informed about the latest security issues. Get and install
     the updated packages recommended by security announcements as
     quickly as possible.
    </p></li><li class="listitem"><p>
     Avoid using <code class="systemitem">root</code> privileges whenever possible. Set
     restrictive file permissions.
    </p></li><li class="listitem"><p>
     Only use encrypted protocols for network communication.
    </p></li><li class="listitem"><p>
     Disable any network services you do not absolutely require.
    </p></li><li class="listitem"><p>
     Conduct regular security audits. For example, scan your network for
     open ports.
    </p></li><li class="listitem"><p>
     Monitor the integrity of files on your systems with
     <code class="literal">AIDE</code> (Advanced Intrusion Detection
     Environment).
    </p></li><li class="listitem"><p>
     Take proper care when installing any third-party software.
    </p></li><li class="listitem"><p>
     Check all your backups regularly.
    </p></li><li class="listitem"><p>
     Check your log files, for example with logwatch.
    </p></li><li class="listitem"><p>
     Configure the firewall to block all ports that are not explicitly
     whitelisted.
    </p></li><li class="listitem"><p>
     Design your security measures to be redundant.
    </p></li><li class="listitem"><p>
     Use encryption where possible, for example for hard disks of mobile
     computers.
    </p></li></ul></div></section><section class="sect1" id="sec-security-general-report" data-id-title="Reporting security issues"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">1.10 </span><span class="title-name">Reporting security issues</span></span> <a title="Permalink" class="permalink" href="#sec-security-general-report">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_preface.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you discover a security-related problem, first check the
   available update packages. If no update is available, write an
   e-mail to &lt;<a class="email" href="mailto:security@suse.de">security@suse.de</a>&gt;. Include a detailed
   description of the problem and the version number of the package
   concerned. We encourage you to encrypt e-mails with GPG.
  </p><p>
   You can find a current version of the SUSE GPG key at
   <a class="link" href="https://www.suse.com/support/security/contact/" target="_blank">https://www.suse.com/support/security/contact/</a>.
  </p></section></section><div class="part" id="part-auth" data-id-title="Authentication"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part I </span><span class="title-name">Authentication </span></span><a title="Permalink" class="permalink" href="#part-auth">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_security.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-pam"><span class="title-number">2 </span><span class="title-name">Authentication with PAM</span></a></span></li><dd class="toc-abstract"><p>
    Linux uses PAM (pluggable authentication modules) in the authentication
    process as a layer that mediates between user and application. PAM
    modules are available on a system-wide basis, so they can be requested by
    any application. This chapter describes how the modular authentication
    mechanism works and how it is configured.
   </p></dd><li><span class="chapter"><a href="#cha-nis"><span class="title-number">3 </span><span class="title-name">Using NIS</span></a></span></li><dd class="toc-abstract"><p>
    When multiple Unix systems in a network access common resources,
    it becomes imperative that all user and group identities are the same
    for all machines in that network. The network should be transparent to
    users: their environments should not vary, regardless of which machine
    they are actually using. This can be done by means of NIS and NFS
    services. 
   </p><p>
    NIS (Network Information Service) can be described as a database-like
    service that provides access to the contents of
    <code class="filename">/etc/passwd</code>, <code class="filename">/etc/shadow</code>, and
    <code class="filename">/etc/group</code> across networks. NIS can also be used
    for other purposes (making the contents of files like
    <code class="filename">/etc/hosts</code> or <code class="filename">/etc/services</code>
    available, for example), but this is beyond the scope of this
    introduction. People often refer to NIS as <span class="emphasis"><em>YP</em></span>,
    because it works like the network's <span class="quote">“<span class="quote">yellow pages.</span>”</span>
        </p></dd><li><span class="chapter"><a href="#cha-security-auth"><span class="title-number">4 </span><span class="title-name">Setting up authentication clients using YaST</span></a></span></li><dd class="toc-abstract"><p>
    Whereas Kerberos is used for authentication, LDAP is used for authorization
    and identification. Both can work together. For more information about LDAP, see
    <a class="xref" href="#cha-security-ldap" title="Chapter 5. LDAP with 389 Directory Server">Chapter 5, <em>LDAP with 389 Directory Server</em></a>, and about Kerberos, see
    <a class="xref" href="#cha-security-kerberos" title="Chapter 6. Network authentication with Kerberos">Chapter 6, <em>Network authentication with Kerberos</em></a>.
   </p></dd><li><span class="chapter"><a href="#cha-security-ldap"><span class="title-number">5 </span><span class="title-name">LDAP with 389 Directory Server</span></a></span></li><dd class="toc-abstract"><p>
    The Lightweight Directory Access Protocol (LDAP) is a protocol
    designed to access and maintain information directories. LDAP can be
    used for tasks such as user and group management, system configuration
    management, and address management. In <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP4</span></span> the
    LDAP service is provided by the 389 Directory Server, replacing OpenLDAP.
   </p></dd><li><span class="chapter"><a href="#cha-security-kerberos"><span class="title-number">6 </span><span class="title-name">Network authentication with Kerberos</span></a></span></li><dd class="toc-abstract"><p>
    Kerberos is a network authentication protocol which also provides encryption.
    This chapter describes how to set up Kerberos and integrate services like LDAP
    and NFS.
   </p></dd><li><span class="chapter"><a href="#cha-security-ad"><span class="title-number">7 </span><span class="title-name">Active Directory support</span></a></span></li><dd class="toc-abstract"><p>Active Directory* (AD) is a directory-service based on LDAP, Kerberos, and other services. It is used by Microsoft* Windows* to manage resources, services, and people. In a Microsoft Windows network, Active Directory provides information about these objects, restricts access to them, and enforces po…</p></dd><li><span class="chapter"><a href="#cha-security-freeradius"><span class="title-number">8 </span><span class="title-name">Setting up a freeRADIUS server</span></a></span></li><dd class="toc-abstract"><p>The RADIUS (Remote Authentication Dial-In User Service) protocol has long been a standard service for manage network access. It provides authentication, authorization, and accounting (AAA) for very large businesses such as Internet service providers and cellular network providers, and is also popula…</p></dd></ul></div><section class="chapter" id="cha-pam" data-id-title="Authentication with PAM"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">2 </span><span class="title-name">Authentication with PAM</span></span> <a title="Permalink" class="permalink" href="#cha-pam">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Linux uses PAM (pluggable authentication modules) in the authentication
    process as a layer that mediates between user and application. PAM
    modules are available on a system-wide basis, so they can be requested by
    any application. This chapter describes how the modular authentication
    mechanism works and how it is configured.
   </p></div></div></div></div><section class="sect1" id="sec-security-pam-whatis" data-id-title="What is PAM?"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.1 </span><span class="title-name">What is PAM?</span></span> <a title="Permalink" class="permalink" href="#sec-security-pam-whatis">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   System administrators and programmers often want to restrict access to
   certain parts of the system or to limit the use of certain functions of
   an application. Without PAM, applications must be adapted every time a
   new authentication mechanism, such as LDAP, Samba, or Kerberos, is
   introduced. However, this process is time-consuming and
   error-prone. One way to avoid these drawbacks is to separate applications
   from the authentication mechanism and delegate authentication to
   centrally managed modules. Whenever a newly required authentication
   scheme is needed, it is sufficient to adapt or write a suitable
   <span class="emphasis"><em>PAM module</em></span> for use by the program in question.
  </p><p>
   The PAM concept consists of:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <span class="emphasis"><em>PAM modules</em></span>, which are a set of shared libraries
     for a specific authentication mechanism.
    </p></li><li class="listitem"><p>
     A <span class="emphasis"><em>module stack</em></span> with of one or more PAM modules.
    </p></li><li class="listitem"><p>
     A PAM-aware <span class="emphasis"><em>service</em></span> which needs authentication by
     using a module stack or PAM modules. Usually a service is a familiar
     name of the corresponding application, like <code class="command">login</code> or
     <code class="command">su</code>. The service name <code class="literal">other</code> is a
     reserved word for default rules.
    </p></li><li class="listitem"><p>
     <span class="emphasis"><em>Module arguments</em></span>, with which the execution of a
     single PAM module can be influenced.
    </p></li><li class="listitem"><p>
     A mechanism evaluating each <span class="emphasis"><em>result</em></span> of a single PAM
     module execution. A positive value executes the next PAM module. The
     way a negative value is dealt with depends on the configuration:
     <span class="quote">“<span class="quote">no influence, proceed</span>”</span> up to <span class="quote">“<span class="quote">terminate
     immediately</span>”</span> and anything in between are valid options.
    </p></li></ul></div></section><section class="sect1" id="sec-pam-struc-files" data-id-title="Structure of a PAM configuration file"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.2 </span><span class="title-name">Structure of a PAM configuration file</span></span> <a title="Permalink" class="permalink" href="#sec-pam-struc-files">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   PAM can be configured in two ways:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.2.4.3.1"><span class="term">File based configuration (<code class="filename">/etc/pam.conf</code>)</span></dt><dd><p>
      The configuration of each service is stored in
      <code class="filename">/etc/pam.conf</code>. However, for maintenance and
      usability reasons, this configuration scheme is not used in
      <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>.
     </p></dd><dt id="id-1.7.4.2.4.3.2"><span class="term">Directory based configuration (<code class="filename">/etc/pam.d/</code>)</span></dt><dd><p>
      Every service (or program) that relies on the PAM mechanism has its
      own configuration file in the <code class="filename">/etc/pam.d/</code>
      directory. For example, the service for
      <code class="systemitem">sshd</code> can be found in the
      <code class="filename">/etc/pam.d/sshd</code> file.
     </p></dd></dl></div><p>
   The files under <code class="filename">/etc/pam.d/</code> define the PAM modules
   used for authentication. Each file consists of lines, which define a
   service, and each line consists of a maximum of four components:
  </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">TYPE</em>  <em class="replaceable">CONTROL</em>
 <em class="replaceable">MODULE_PATH</em>  <em class="replaceable">MODULE_ARGS</em></pre></div><p>
   The components have the following meaning:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.2.4.7.1"><span class="term"><em class="replaceable">TYPE</em>
    </span></dt><dd><p>
      Declares the type of the service. PAM modules are processed as stacks.
      Different types of modules have different purposes. For example, one
      module checks the password, another verifies the location from which
      the system is accessed, and yet another reads user-specific settings.
      PAM knows about four different types of modules:
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.2.4.7.1.2.2.1"><span class="term"><code class="literal">auth</code>
       </span></dt><dd><p>
         Check the user's authenticity, traditionally by querying a
         password. However, this can also be achieved with a
         chip card or through biometrics (for example, fingerprints or iris
         scan).
        </p></dd><dt id="id-1.7.4.2.4.7.1.2.2.2"><span class="term"><code class="literal">account</code>
       </span></dt><dd><p>
         Modules of this type check if the user has general permission to
         use the requested service. As an example, such a check should be
         performed to ensure that no one can log in with the user name of an
         expired account.
        </p></dd><dt id="id-1.7.4.2.4.7.1.2.2.3"><span class="term"><code class="literal">password</code>
       </span></dt><dd><p>
         The purpose of this type of module is to enable the change of an
         authentication token. Usually this is a password.
        </p></dd><dt id="id-1.7.4.2.4.7.1.2.2.4"><span class="term"><code class="literal">session</code>
       </span></dt><dd><p>
         Modules of this type are responsible for managing and configuring
         user sessions. They are started before and after authentication to
         log login attempts and configure the user's specific environment
         <span class="phrase">(mail accounts, home directory, system limits, etc.)</span>.
        </p></dd></dl></div></dd><dt id="id-1.7.4.2.4.7.2"><span class="term"><em class="replaceable">CONTROL</em>
    </span></dt><dd><p>
      Indicates the behavior of a PAM module. Each module can have the
      following control flags:
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.2.4.7.2.2.2.1"><span class="term"><code class="literal">required</code>
       </span></dt><dd><p>
         A module with this flag must be successfully processed before the
         authentication may proceed. After the failure of a module with the
         <code class="literal">required</code> flag, all other modules with the same
         flag are processed before the user receives a message about the
         failure of the authentication attempt.
        </p></dd><dt id="id-1.7.4.2.4.7.2.2.2.2"><span class="term"><code class="literal">requisite</code>
       </span></dt><dd><p>
         Modules having this flag must also be processed successfully, in
         much the same way as a module with the <code class="literal">required</code>
         flag. However, in case of failure a module with this flag gives
         immediate feedback to the user and no further modules are
         processed. In case of success, other modules are subsequently
         processed, like any modules with the <code class="literal">required</code>
         flag. The <code class="literal">requisite</code> flag can be used as a basic
         filter checking for the existence of certain conditions that are
         essential for a correct authentication.
        </p></dd><dt id="id-1.7.4.2.4.7.2.2.2.3"><span class="term"><code class="literal">sufficient</code>
       </span></dt><dd><p>
         After a module with this flag has been successfully processed, the
         requesting application receives an immediate message about the
         success and no further modules are processed, provided there was no
         preceding failure of a module with the <code class="literal">required</code>
         flag. The failure of a module with the
         <code class="literal">sufficient</code> flag has no direct consequences, in
         the sense that any subsequent modules are processed in their
         respective order.
        </p></dd><dt id="id-1.7.4.2.4.7.2.2.2.4"><span class="term"><code class="literal">optional</code>
       </span></dt><dd><p>
         The failure or success of a module with this flag does not have any
         direct consequences. This can be useful for modules that are only
         intended to display a message (for example, to tell the user that
         mail has arrived) without taking any further action.
        </p></dd><dt id="id-1.7.4.2.4.7.2.2.2.5"><span class="term"><code class="literal">include</code>
       </span></dt><dd><p>
         If this flag is given, the file specified as argument is inserted
         at this place.
        </p></dd></dl></div></dd><dt id="id-1.7.4.2.4.7.3"><span class="term"><em class="replaceable">MODULE_PATH</em>
    </span></dt><dd><p>
      Contains a full file name of a PAM module. It does not need to be
      specified explicitly, as long as the module is located in the default
      directory <code class="filename">/lib/security</code> (for all 64-bit platforms
      supported by <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span>, the directory is
      <code class="filename">/lib64/security</code>).
     </p></dd><dt id="id-1.7.4.2.4.7.4"><span class="term"><em class="replaceable">MODULE_ARGS</em>
    </span></dt><dd><p>
      Contains a space-separated list of options to influence the behavior
      of a PAM module, such as <code class="option">debug</code> (enables debugging) or
      <code class="option">nullok</code> (allows the use of empty passwords).
     </p></dd></dl></div><p>
   In addition, there are global configuration files for PAM modules under
   <code class="filename">/etc/security</code>, which define the exact behavior of
   these modules (examples include <code class="filename">pam_env.conf</code> and
   <code class="filename">time.conf</code>). Every application that uses a PAM module
   actually calls a set of PAM functions, which then process the information
   in the various configuration files and return the result to the
   requesting application.
  </p><p>
   To simplify the creation and maintenance of PAM modules, common default
   configuration files for the types <code class="literal">auth</code>,
   <code class="literal">account</code>, <code class="literal">password</code>, and
   <code class="literal">session</code> modules have been introduced. These are
   retrieved from every application's PAM configuration. Updates to the
   global PAM configuration modules in <code class="filename">common-*</code> are
   thus propagated across all PAM configuration files without requiring the
   administrator to update every single PAM configuration file.
  </p><p>
   The global PAM configuration files are maintained using the
   <code class="command">pam-config</code> tool. This tool automatically adds new
   modules to the configuration, changes the configuration of existing ones
   or deletes modules (or options) from the configurations. Manual
   intervention in maintaining PAM configurations is minimized or no longer
   required.
  </p><div id="id-1.7.4.2.4.11" data-id-title="64-bit and 32-bit mixed installations" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: 64-bit and 32-bit mixed installations</div><p>
    When using a 64-bit operating system, it is possible to also include a
    runtime environment for 32-bit applications. In this case, make sure
    that you also install the 32-bit version of the PAM modules.
   </p></div></section><section class="sect1" id="sec-pam-struc-format" data-id-title="The PAM configuration of sshd"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.3 </span><span class="title-name">The PAM configuration of sshd</span></span> <a title="Permalink" class="permalink" href="#sec-pam-struc-format">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Consider the PAM configuration of sshd as an example:
  </p><div class="example" id="dat-pam-sshd" data-id-title="PAM configuration for sshd (/etc/pam.d/sshd)"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 2.1: </span><span class="title-name">PAM configuration for sshd (<code class="filename">/etc/pam.d/sshd</code>) </span></span><a title="Permalink" class="permalink" href="#dat-pam-sshd">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">#%PAM-1.0 <span class="callout" id="co-security-pam-sshd-pam-line">1</span>
auth     requisite      pam_nologin.so                              <span class="callout" id="co-security-pam-sshd-pam-nologin">2</span>
auth     include        common-auth                                 <span class="callout" id="co-security-pam-sshd-common-auth">3</span>
account  requisite      pam_nologin.so                              <a class="xref" href="#co-security-pam-sshd-pam-nologin"><span class="callout">2</span></a>
account  include        common-account                              <a class="xref" href="#co-security-pam-sshd-common-auth"><span class="callout">3</span></a>
password include        common-password                             <a class="xref" href="#co-security-pam-sshd-common-auth"><span class="callout">3</span></a>
session  required       pam_loginuid.so                             <span class="callout" id="co-security-pam-sshd-pam-loginuid">4</span>
session  include        common-session                              <a class="xref" href="#co-security-pam-sshd-common-auth"><span class="callout">3</span></a>
session  optional       pam_lastlog.so   silent noupdate showfailed <span class="callout" id="co-security-pam-sshd-lastlog">5</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-security-pam-sshd-pam-line"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Declares the version of this configuration file for PAM 1.0. This is
      merely a convention, but could be used in the future to check the
      version.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-security-pam-sshd-pam-nologin"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Checks, if <code class="filename">/etc/nologin</code> exists. If it does, no
      user other than <code class="systemitem">root</code> may log
      in.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-security-pam-sshd-common-auth"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Refers to the configuration files of four module types:
      <code class="filename">common-auth</code>, <code class="filename">common-account</code>,
      <code class="filename">common-password</code>, and
      <code class="filename">common-session</code>. These four files hold the default
      configuration for each module type.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-security-pam-sshd-pam-loginuid"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Sets the login UID process attribute for the process that was
      authenticated.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-security-pam-sshd-lastlog"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Displays information about the last login of a user.
     </p></td></tr></table></div></div></div><p>
   By including the configuration files instead of adding each module
   separately to the respective PAM configuration, you automatically get an
   updated PAM configuration when an administrator changes the defaults.
   Formerly, you needed to adjust all configuration files manually for all
   applications when changes to PAM occurred or a new application was
   installed. Now the PAM configuration is made with central configuration
   files and all changes are automatically inherited by the PAM
   configuration of each service.
  </p><p>
   The first include file (<code class="filename">common-auth</code>) calls three
   modules of the <code class="literal">auth</code> type:
   <code class="systemitem">pam_env.so</code>,
   <code class="systemitem">pam_gnome_keyring.so</code> and
   <code class="systemitem">pam_unix.so</code>. See
   <a class="xref" href="#dat-pam-common-auth" title="Default configuration for the auth section (common-auth)">Example 2.2, “Default configuration for the <code class="literal">auth</code> section (<code class="filename">common-auth</code>)”</a>.
  </p><div class="example" id="dat-pam-common-auth" data-id-title="Default configuration for the auth section (common-auth)"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 2.2: </span><span class="title-name">Default configuration for the <code class="literal">auth</code> section (<code class="filename">common-auth</code>) </span></span><a title="Permalink" class="permalink" href="#dat-pam-common-auth">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">auth  required  pam_env.so                   <span class="callout" id="co-security-pam-sshd-pam-env">1</span>
auth  optional  pam_gnome_keyring.so         <span class="callout" id="co-security-pam-sshd-gnome">2</span>
auth  required  pam_unix.so  try_first_pass <span class="callout" id="co-security-pam-sshd-pam-unix">3</span></pre></div></div></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-security-pam-sshd-pam-env"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     <code class="systemitem">pam_env.so</code> loads
     <code class="filename">/etc/security/pam_env.conf</code> to set the environment
     variables as specified in this file. It can be used to set the
     <code class="envar">DISPLAY</code> variable to the correct value, because the
     <code class="systemitem">pam_env</code> module knows about the
     location from which the login is taking place.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-security-pam-sshd-gnome"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     <code class="systemitem">pam_gnome_keyring.so</code> checks
     the user's login and password against the GNOME key ring
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-security-pam-sshd-pam-unix"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     <code class="systemitem">pam_unix</code> checks the user's
     login and password against <code class="filename">/etc/passwd</code> and
     <code class="filename">/etc/shadow</code>.
    </p></td></tr></table></div><p>
   The whole stack of <code class="literal">auth</code> modules is processed before
   <code class="systemitem">sshd</code> gets any feedback about
   whether the login has succeeded. All modules of the stack having the
   <code class="literal">required</code> control flag must be processed successfully
   before <code class="systemitem">sshd</code> receives a message
   about the positive result. If one of the modules is not successful, the
   entire module stack is still processed and only then is
   <code class="systemitem">sshd</code> notified about the negative
   result.
  </p><p>
   When all modules of the <code class="literal">auth</code> type have been
   successfully processed, another include statement is processed, in this
   case, that in <a class="xref" href="#dat-pam-common-account" title="Default configuration for the account section (common-account)">Example 2.3, “Default configuration for the <code class="literal">account</code> section (<code class="filename">common-account</code>)”</a>.
   <code class="filename">common-account</code> contains only one module,
   <code class="literal">pam_unix</code>. If <code class="literal">pam_unix</code> returns the
   result that the user exists, sshd receives a message announcing this
   success and the next stack of modules (<code class="literal">password</code>) is
   processed, shown in <a class="xref" href="#dat-pam-common-password" title="Default configuration for the password section (common-password)">Example 2.4, “Default configuration for the <code class="literal">password</code> section (<code class="filename">common-password</code>)”</a>.
  </p><div class="example" id="dat-pam-common-account" data-id-title="Default configuration for the account section (common-account)"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 2.3: </span><span class="title-name">Default configuration for the <code class="literal">account</code> section (<code class="filename">common-account</code>) </span></span><a title="Permalink" class="permalink" href="#dat-pam-common-account">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">account  required  pam_unix.so  try_first_pass</pre></div></div></div><div class="example" id="dat-pam-common-password" data-id-title="Default configuration for the password section (common-password)"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 2.4: </span><span class="title-name">Default configuration for the <code class="literal">password</code> section (<code class="filename">common-password</code>) </span></span><a title="Permalink" class="permalink" href="#dat-pam-common-password">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">password  requisite  pam_cracklib.so
password  optional   pam_gnome_keyring.so  use_authtok
password  required   pam_unix.so  use_authtok nullok shadow try_first_pass</pre></div></div></div><p>
   Again, the PAM configuration of
   <code class="systemitem">sshd</code> involves only an include
   statement referring to the default configuration for
   <code class="literal">password</code> modules located in
   <code class="filename">common-password</code>. These modules must successfully be
   completed (control flags <code class="literal">requisite</code> and
   <code class="literal">required</code>) whenever the application requests the change
   of an authentication token.
  </p><p>
   Changing a password or another authentication token requires a security
   check. This is achieved with the <code class="filename">pam_cracklib</code>
   module. The <code class="filename">pam_unix</code> module used afterward carries
   over any old and new passwords from <code class="filename">pam_cracklib</code>, so
   the user does not need to authenticate again after changing the password.
   This procedure makes it impossible to circumvent the checks carried out
   by <code class="filename">pam_cracklib</code>. Whenever the
   <code class="literal">account</code> or the <code class="literal">auth</code> type are
   configured to complain about expired passwords, the
   <code class="literal">password</code> modules should also be used.
  </p><div class="example" id="dat-pam-common-session" data-id-title="Default configuration for the session section (common-session)"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 2.5: </span><span class="title-name">Default configuration for the <code class="literal">session</code> section (<code class="filename">common-session</code>) </span></span><a title="Permalink" class="permalink" href="#dat-pam-common-session">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">session  required  pam_limits.so
session  required  pam_unix.so  try_first_pass
session  optional  pam_umask.so
session  optional  pam_systemd.so
session  optional  pam_gnome_keyring.so auto_start only_if=gdm,gdm-password,lxdm,lightdm
session  optional  pam_env.so</pre></div></div></div><p>
   As the final step, the modules of the <code class="literal">session</code> type
   (bundled in the <code class="filename">common-session</code> file) are called to
   configure the session according to the settings for the user in question.
   The <code class="filename">pam_limits</code> module loads the file
   <code class="filename">/etc/security/limits.conf</code>, which may define limits
   on the use of certain system resources. The <code class="filename">pam_unix</code>
   module is processed again. The <code class="filename">pam_umask</code> module can
   be used to set the file mode creation mask. Since this module carries the
   <code class="literal">optional</code> flag, a failure of this module would not
   affect the successful completion of the entire session module stack. The
   <code class="literal">session</code> modules are called a second time when the user
   logs out.
  </p></section><section class="sect1" id="sec-pam-struc-conf" data-id-title="Configuration of PAM modules"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.4 </span><span class="title-name">Configuration of PAM modules</span></span> <a title="Permalink" class="permalink" href="#sec-pam-struc-conf">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Some PAM modules are configurable. The configuration files are
   located in <code class="filename">/etc/security</code>. This section briefly
   describes the configuration files relevant to the sshd
   example—<code class="filename">pam_env.conf</code> and
   <code class="filename">limits.conf</code>.
  </p><section class="sect2" id="sec-pam-struc-conf-pamenv" data-id-title="pam_env.conf"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.4.1 </span><span class="title-name">pam_env.conf</span></span> <a title="Permalink" class="permalink" href="#sec-pam-struc-conf-pamenv">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="filename">pam_env.conf</code> can be used to define a standardized
    environment for users that is set whenever the
    <code class="systemitem">pam_env</code> module is called. With it, preset
    environment variables using the following syntax:
   </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">VARIABLE</em>  [DEFAULT=<em class="replaceable">VALUE</em>]  [OVERRIDE=<em class="replaceable">VALUE</em>]</pre></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.2.6.3.4.1"><span class="term"><em class="replaceable">VARIABLE</em>
     </span></dt><dd><p>
       Name of the environment variable to set.
      </p></dd><dt id="id-1.7.4.2.6.3.4.2"><span class="term"><code class="systemitem">[DEFAULT=&lt;value&gt;]</code>
     </span></dt><dd><p>
       Default <em class="replaceable">VALUE</em> the administrator wants to
       set.
      </p></dd><dt id="id-1.7.4.2.6.3.4.3"><span class="term"><code class="systemitem">[OVERRIDE=&lt;value&gt;]</code>
     </span></dt><dd><p>
       Values that may be queried and set by
       <code class="systemitem">pam_env</code>, overriding the default value.
      </p></dd></dl></div><p>
    A typical example of how <code class="systemitem">pam_env</code> can be used is
    the adaptation of the <code class="envar">DISPLAY</code> variable, which is changed
    whenever a remote login takes place. This is shown in
    <a class="xref" href="#dat-pam-pamenv" title="pam_env.conf">Example 2.6, “pam_env.conf”</a>.
   </p><div class="example" id="dat-pam-pamenv" data-id-title="pam_env.conf"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 2.6: </span><span class="title-name">pam_env.conf </span></span><a title="Permalink" class="permalink" href="#dat-pam-pamenv">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">REMOTEHOST  DEFAULT=localhost          OVERRIDE=@{PAM_RHOST}
DISPLAY     DEFAULT=${REMOTEHOST}:0.0  OVERRIDE=${DISPLAY}</pre></div></div></div><p>
    The first line sets the value of the <code class="envar">REMOTEHOST</code> variable
    to <code class="literal">localhost</code>, which is used whenever
    <code class="filename">pam_env</code> cannot determine any other value. The
    <code class="envar">DISPLAY</code> variable in turn contains the value of
    <code class="envar">REMOTEHOST</code>. Find more information in the comments in
    <code class="filename">/etc/security/pam_env.conf</code>.
   </p></section><section class="sect2" id="sec-pam-struc-conf-pammount" data-id-title="pam_mount.conf.xml"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.4.2 </span><span class="title-name">pam_mount.conf.xml</span></span> <a title="Permalink" class="permalink" href="#sec-pam-struc-conf-pammount">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The purpose of <code class="systemitem">pam_mount</code> is to mount user home
    directories during the login process, and to unmount them during logout
    in an environment where a central file server keeps all the home
    directories of users. With this method, it is not necessary to mount a
    complete <code class="filename">/home</code> directory where all the user home
    directories would be accessible. Instead, only the home directory of the
    user who is about to log in, is mounted.
   </p><p>
    After installing <code class="systemitem">pam_mount</code>, a template for
    <code class="filename">pam_mount.conf.xml</code> is available in
    <code class="filename">/etc/security</code>. The description of the various
    elements can be found in the manual page <code class="command">man 5
    pam_mount.conf</code>.
   </p><p>
    A basic configuration of this feature can be done with YaST. Select
    <span class="guimenu">Network Settings</span> › <span class="guimenu">Windows Domain
      Membership</span> › <span class="guimenu">Expert Settings</span> to
    add the file server.
   </p><div id="id-1.7.4.2.6.4.5" data-id-title="LUKS2 support" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: LUKS2 support</div><p>
     LUKS2 support was added to <code class="command">cryptsetup</code>
     2.0, and <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> has included support for LUKS2 in
     <code class="systemitem">pam_mount</code> since <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> 12 SP3.
    </p></div></section><section class="sect2" id="sec-pam-struc-pamlimits" data-id-title="limits.conf"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.4.3 </span><span class="title-name">limits.conf</span></span> <a title="Permalink" class="permalink" href="#sec-pam-struc-pamlimits">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    System limits can be set on a user or group basis in
    <code class="filename">limits.conf</code>, which is read by the
    <code class="systemitem">pam_limits</code> module. The file allows you to set
    hard limits, which may not be exceeded, and soft limits, which
    may be exceeded temporarily. For more information about the syntax and
    the options, see the comments in
    <code class="filename">/etc/security/limits.conf</code>.
   </p></section></section><section class="sect1" id="sec-pam-pam-config" data-id-title="Configuring PAM using pam-config"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.5 </span><span class="title-name">Configuring PAM using pam-config</span></span> <a title="Permalink" class="permalink" href="#sec-pam-pam-config">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="command">pam-config</code> tool helps you configure the global PAM
   configuration files (<code class="filename">/etc/pam.d/common-*</code>) and
   several selected application configurations. For a list of supported
   modules, use the <code class="command">pam-config --list-modules</code> command.
   Use the <code class="command">pam-config</code> command to maintain your PAM
   configuration files. Add new modules to your PAM configurations, delete
   other modules or modify options to these modules. When changing global
   PAM configuration files, no manual tweaking of the PAM setup for
   individual applications is required.
  </p><p>
   A simple use case for <code class="command">pam-config</code> involves the
   following:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p><span class="formalpara-title">Auto-generate a fresh unix-style PAM configuration.</span>
      Let pam-config create the simplest possible setup which you can extend
      later on. The <code class="command">pam-config --create</code> command creates a
      simple Unix authentication configuration. Pre-existing configuration
      files not maintained by pam-config are overwritten, but backup copies
      are kept as <code class="literal">*.pam-config-backup</code>.
     </p></li><li class="step"><p><span class="formalpara-title">Add a new authentication method.</span>
      Adding a new authentication method (for example, SSSD) to your stack
      of PAM modules comes down to a simple <code class="command">pam-config --add
      --sss</code> command. SSSD is added wherever appropriate across
      all <code class="filename">common-*-pc</code> PAM configuration files.
     </p></li><li class="step"><p><span class="formalpara-title">Add debugging for test purposes.</span>
      To make sure the new authentication procedure works as planned, turn
      on debugging for all PAM-related operations. The <code class="command">pam-config
      --add --sss-debug</code> command turns on debugging for SSSD-related PAM
      operations.<span class="phrase"> Find the debugging output in the <code class="systemitem">systemd</code> journal (see
      <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: Query the <code class="systemitem">systemd</code> journal”</span>).</span>
      <span class="phrase">To configure SSSD, refer to <a class="xref" href="#sec-security-ldap-server-sssd" title="5.7. Using SSSD to manage LDAP authentication">Section 5.7, “Using SSSD to manage LDAP authentication”</a>. </span>
     </p></li><li class="step"><p><span class="formalpara-title">Query your setup.</span>
      Before you finally apply your new PAM setup, check if it contains all
      the options you wanted to add. The <code class="command">pam-config --query
      --</code><em class="replaceable">MODULE</em> command lists both the type and
      the options for the queried PAM module.
     </p></li><li class="step"><p><span class="formalpara-title">Remove the debug options.</span>
      Finally, remove the debug option from your setup when you are entirely
      satisfied with its performance. The <code class="command">pam-config --delete
      --sss-debug</code> command turns off debugging for the <code class="literal">pam_ssh.so</code> module.
      In case you had debugging options added for other
      modules, use similar commands to turn these off.
     </p></li></ol></div></div><p>
   For more information on the <code class="command">pam-config</code> command and the
   options available, refer to the manual page of
   <code class="command">pam-config(8)</code>.
  </p></section><section class="sect1" id="sec-pam-manual-config" data-id-title="Manually configuring PAM"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.6 </span><span class="title-name">Manually configuring PAM</span></span> <a title="Permalink" class="permalink" href="#sec-pam-manual-config">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you prefer to manually create or maintain your PAM configuration
   files, make sure to disable <code class="command">pam-config</code> for these
   files.
  </p><p>
   When you create your PAM configuration files from scratch using the
   <code class="command">pam-config --create</code> command, it creates symbolic links
   from the <code class="filename">common-<em class="replaceable">*</em></code> to the
   <code class="filename">common-<em class="replaceable">*</em>-pc</code> files.
   <code class="command">pam-config</code> only modifies the
   <code class="filename">common-<em class="replaceable">*</em>-pc</code> configuration
   files. Removing these symbolic links effectively disables pam-config,
   because pam-config only operates on the
   <code class="filename">common-<em class="replaceable">*</em>-pc</code> files and
   these files are not put into effect without the symbolic links.
  </p><div id="id-1.7.4.2.8.4" data-id-title="Include pam_systemd.so in configuration" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Include <code class="filename">pam_systemd.so</code> in configuration</div><p>
    If you are creating your own PAM configuration, make sure to include
    <code class="literal">pam_systemd.so</code> configured as <code class="literal">session
    optional</code>. Not including the <code class="literal">pam_systemd.so</code> can
    cause problems with <code class="systemitem">systemd</code> task limits. For details, refer to the man
    page of <code class="literal">pam_systemd.so</code>.
   </p></div></section><section class="sect1" id="sec-pam-login" data-id-title="Configuring U2F keys for local login"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.7 </span><span class="title-name">Configuring  U2F keys for local login</span></span> <a title="Permalink" class="permalink" href="#sec-pam-login">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/slemicro_pam_login.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  To provide more security during the local login , you can configure
  two-factor authentication using the <code class="literal">pam-u2f</code> framework and
  the U2F feature on Yubikeys and Security Keys.
 </p><p>
  To set up U2F on your  system, you need to associate your key with your
  account . After that, configure your system to use the key. The
  procedure is described in the following sections.
 </p><section class="sect2" id="sec-attach-account" data-id-title="Associating the U2F key with your account"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.7.1 </span><span class="title-name">Associating the U2F key with your account</span></span> <a title="Permalink" class="permalink" href="#sec-attach-account">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/slemicro_pam_login.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To associate your U2F key with your account proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Log in to your machine.
    </p></li><li class="step"><p>
     Insert your U2F key.
    </p></li><li class="step"><p>
     Create a directory for the U2F key configuration:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mkdir -p ~/.config/Yubico</pre></div></li><li class="step"><p>
     Run the <code class="command">pamu2fcfg</code> that outputs configuration lines:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> pamu2fcfg &gt; ~/.config/Yubico/u2f_keys</pre></div></li><li class="step"><p>
     When your device begins flashing, touch the metal contact to confirm the
     association.
    </p></li></ol></div></div><p>
   We recommend using a backup U2F device, which you can set up by running the
   following commands:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Run:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> pamu2fcfg -n &gt;&gt; ~/.config/Yubico/u2f_keys</pre></div></li><li class="step"><p>
     When your device begins flashing, touch the metal contact to confirm the
     association.
    </p></li></ol></div></div><p>
   You can move the output file from the default location to a directory that
   requires the <code class="literal">sudo</code> permission to modify the file to
   increase security, for example, to the <code class="filename">/etc</code> directory.
   To do so, follow the steps:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Create a directory in <code class="filename">/etc</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mkdir /etc/Yubico</pre></div></li><li class="step"><p>
     Move the created file:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mv ~/.config/Yubico/u2f_keys /etc/Yubico/u2f_keys</pre></div></li></ol></div></div><div id="id-1.7.4.2.9.4.8" data-id-title="Placing the u2f_keys to a non-default location" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Placing the <code class="filename">u2f_keys</code> to a non-default location</div><p>
    If you move the output file to a different directory than is the default
    (<code class="filename">$HOME/.config/Yubico/u2f_keys</code>), you need to add the
    path to the <code class="filename">/etc/pam.d/login</code> file as described in
    <a class="xref" href="#sec-reconfiguring-pam" title="2.7.2. Updating the PAM configuration">Section 2.7.2, “Updating the PAM configuration”</a>.
   </p></div></section><section class="sect2" id="sec-reconfiguring-pam" data-id-title="Updating the PAM configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.7.2 </span><span class="title-name">Updating the PAM configuration</span></span> <a title="Permalink" class="permalink" href="#sec-reconfiguring-pam">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/slemicro_pam_login.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   After you have created the U2F keys configuration, you need to adjust the
   PAM configuration on your system.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Open the file <code class="filename">/etc/pam.d/login</code>.
    </p></li><li class="step"><p>
     Add the line <code class="literal">auth required pam_u2f.so</code> to the file as
     follows:
    </p><div class="verbatim-wrap"><pre class="screen">#%PAM-1.0
auth      include    common-auth
<span class="bold"><strong>auth      required   pam_u2f.so</strong></span>
account   include    common-account
password  include    common-password
session   optional   pam_keyinit.so revoke
session   include    common-session
#session  optional   pam_xauth.so</pre></div></li><li class="step"><p>
     If you placed the <code class="filename">u2f_keys</code> file to a different
     location than <code class="filename">$HOME/.config/Yubico/u2f_keys</code>, you need
     to use the <code class="literal">authfile</code> option in the
     <code class="filename">/etc/pam.d/login</code> PAM file as follows:
    </p><div class="verbatim-wrap"><pre class="screen">#%PAM-1.0
auth     requisite pam_nologin.so
auth     include   common-auth
<span class="bold"><strong>auth  required pam_u2f.so authfile=<em class="replaceable">&lt;PATH_TO_u2f_keys&gt;</em></strong></span>
...</pre></div><p>
     where <em class="replaceable">&lt;PATH_TO_u2f_keys&gt;</em> is the absolute
     path to the <code class="filename">u2f_keys</code> file.
    </p></li></ol></div></div></section></section><section class="sect1" id="sec-pam-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.8 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-pam-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In the <code class="filename">/usr/share/doc/packages/pam</code> directory after
   installing the <code class="systemitem">pam-doc</code> package, find the
   following additional documentation:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.2.10.3.1"><span class="term">READMEs</span></dt><dd><p>
      In the top level of this directory, there is the
      <code class="filename">modules</code> subdirectory holding README files about
      the available PAM modules.
     </p></dd><dt id="id-1.7.4.2.10.3.2"><span class="term">The Linux-PAM System Administrators' Guide</span></dt><dd><p>
      This document comprises everything that the system administrator
      should know about PAM. It discusses a range of topics, from the syntax
      of configuration files to the security aspects of PAM.
     </p></dd><dt id="id-1.7.4.2.10.3.3"><span class="term">The Linux-PAM Module Writers' Manual</span></dt><dd><p>
      This document summarizes the topic from the developer's point of view,
      with information about how to write standard-compliant PAM modules.
     </p></dd><dt id="id-1.7.4.2.10.3.4"><span class="term">The Linux-PAM Application Developers' Guide</span></dt><dd><p>
      This document comprises everything needed by an application developer
      who wants to use the PAM libraries.
     </p></dd><dt id="id-1.7.4.2.10.3.5"><span class="term">The PAM manual pages</span></dt><dd><p>
      PAM in general and the individual modules come with manual
      pages that provide a good overview of the functionality of all the
      components.
     </p></dd></dl></div></section></section><section class="chapter" id="cha-nis" data-id-title="Using NIS"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">3 </span><span class="title-name">Using NIS</span></span> <a title="Permalink" class="permalink" href="#cha-nis">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_nis.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    When multiple Unix systems in a network access common resources,
    it becomes imperative that all user and group identities are the same
    for all machines in that network. The network should be transparent to
    users: their environments should not vary, regardless of which machine
    they are actually using. This can be done by means of NIS and NFS
    services. 
   </p><p>
    NIS (Network Information Service) can be described as a database-like
    service that provides access to the contents of
    <code class="filename">/etc/passwd</code>, <code class="filename">/etc/shadow</code>, and
    <code class="filename">/etc/group</code> across networks. NIS can also be used
    for other purposes (making the contents of files like
    <code class="filename">/etc/hosts</code> or <code class="filename">/etc/services</code>
    available, for example), but this is beyond the scope of this
    introduction. People often refer to NIS as <span class="emphasis"><em>YP</em></span>,
    because it works like the network's <span class="quote">“<span class="quote">yellow pages.</span>”</span>
        </p></div></div></div></div><section class="sect1" id="sec-nis-server-sled" data-id-title="Configuring NIS servers"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.1 </span><span class="title-name">Configuring NIS servers</span></span> <a title="Permalink" class="permalink" href="#sec-nis-server-sled">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_nis.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For configuring NIS servers, see the SUSE Linux Enterprise Server Administration Guide.
  </p></section><section class="sect1" id="sec-nis-client" data-id-title="Configuring NIS clients"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">3.2 </span><span class="title-name">Configuring NIS clients</span></span> <a title="Permalink" class="permalink" href="#sec-nis-client">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_nis.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To use NIS on a workstation, do the following:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Start <span class="guimenu">YaST</span> › <span class="guimenu">Network
     Services</span> › <span class="guimenu">NIS Client</span>.
    </p></li><li class="step"><p>
     Activate the <span class="guimenu">Use NIS</span> button.
    </p></li><li class="step"><p>
     Enter the NIS domain. This is usually a domain name given by your
     administrator or a static IP address received by DHCP.
     
    </p><div class="figure" id="fig-inst-nisclient"><div class="figure-contents"><div class="mediaobject"><a href="images/yast2_inst_nisclient.png"><img src="images/yast2_inst_nisclient.png" width="75%" alt="Setting domain and address of a NIS server" title="Setting domain and address of a NIS server"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 3.1: </span><span class="title-name">Setting domain and address of a NIS server </span></span><a title="Permalink" class="permalink" href="#fig-inst-nisclient">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_nis.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
     Enter your NIS servers and separate their addresses by spaces. If you
     do not know your NIS server, click <span class="guimenu">Find</span> to let
     YaST search for any NIS servers in your domain. Depending on the
     size of your local network, this may be a time-consuming process.
     <span class="guimenu">Broadcast</span> asks for a NIS server in the local network
     after the specified servers fail to respond.
    </p></li><li class="step"><p>
     Depending on your local installation, you may also want to activate the
     automounter. This option also installs additional software if required.
    </p></li><li class="step"><p>
     If you do not want other hosts to be able to query which server your
     client is using, go to the <span class="guimenu">Expert</span> settings and
     disable <span class="guimenu">Answer Remote Hosts</span>. By checking
     <span class="guimenu">Broken Server</span>, the client is enabled to receive
     replies from a server communicating through an unprivileged port. For
     further information, see
     <code class="command">man</code> <code class="option">ypbind</code>.
    </p></li><li class="step"><p>
     Click <span class="guimenu">Finish</span> to save them and return to the
     YaST control center. Your client is now configured with NIS.
    </p></li></ol></div></div></section></section><section class="chapter" id="cha-security-auth" data-id-title="Setting up authentication clients using YaST"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">4 </span><span class="title-name">Setting up authentication clients using YaST</span></span> <a title="Permalink" class="permalink" href="#cha-security-auth">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_auth.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Whereas Kerberos is used for authentication, LDAP is used for authorization
    and identification. Both can work together. For more information about LDAP, see
    <a class="xref" href="#cha-security-ldap" title="Chapter 5. LDAP with 389 Directory Server">Chapter 5, <em>LDAP with 389 Directory Server</em></a>, and about Kerberos, see
    <a class="xref" href="#cha-security-kerberos" title="Chapter 6. Network authentication with Kerberos">Chapter 6, <em>Network authentication with Kerberos</em></a>.
   </p></div></div></div></div><section class="sect1" id="sec-security-auth-yast-client" data-id-title="Configuring an authentication client with YaST"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.1 </span><span class="title-name">Configuring an authentication client with YaST</span></span> <a title="Permalink" class="permalink" href="#sec-security-auth-yast-client">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_auth.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   YaST allows setting up authentication to clients using different
   modules:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">User logon management</span>. </span>
    Use both an identity service (usually LDAP) and a user authentication
    service (usually Kerberos). This option is based on SSSD and in the
    majority of cases is best suited for joining Active Directory domains.
   </p><p>
   This module is described in
   <a class="xref" href="#sec-security-ad-sssd" title="7.3.2. Joining Active Directory using User logon management">Section 7.3.2, “Joining Active Directory using <span class="guimenu">User logon management</span>”</a>.
  </p></li><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">Windows domain membership</span>. </span>
    Join an Active Directory (which entails use of Kerberos and LDAP). This option is
    based on <code class="command">winbind</code> and is best suited for joining an
    Active Directory domain if support for NTLM or cross-forest trusts is necessary.
   </p><p>
   This module is described in
   <a class="xref" href="#sec-security-ad-winbind" title="7.3.3. Joining Active Directory using Windows domain membership">Section 7.3.3, “Joining Active Directory using <span class="guimenu">Windows domain membership</span>”</a>.
  </p></li></ul></div></section><section class="sect1" id="sec-security-auth-sssd" data-id-title="SSSD"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.2 </span><span class="title-name">SSSD</span></span> <a title="Permalink" class="permalink" href="#sec-security-auth-sssd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_auth.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Two of the YaST modules are based on SSSD: <span class="guimenu">User Logon
   Management</span> and <span class="guimenu">LDAP and Kerberos
   Authentication</span>.
  </p><p>
   SSSD stands for System Security Services Daemon. SSSD talks to remote
   directory services that provide user data and provides various
   authentication methods, such as LDAP, Kerberos, or Active Directory (AD). It also
   provides an NSS (Name Service Switch) and PAM (Pluggable Authentication
   Module) interface.
  </p><p>
   SSSD can locally cache user data and then allow users to use the data,
   even if the real directory service is (temporarily) unreachable.
  </p><section class="sect2" id="sec-security-auth-sssd-status" data-id-title="Checking the status"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.2.1 </span><span class="title-name">Checking the status</span></span> <a title="Permalink" class="permalink" href="#sec-security-auth-sssd-status">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_auth.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    After running one of the YaST authentication modules, you can check
    whether SSSD is running with:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">systemctl status sssd</code>
sssd.service - System Security Services Daemon
   Loaded: loaded (/usr/lib/systemd/system/sssd.service; enabled)
   Active: active (running) since Thu 2015-10-23 11:03:43 CEST; 5s ago
   [...]</pre></div></section><section class="sect2" id="sec-security-auth-sssd-cache" data-id-title="Caching"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.2.2 </span><span class="title-name">Caching</span></span> <a title="Permalink" class="permalink" href="#sec-security-auth-sssd-cache">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_auth.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To allow logging in when the authentication back-end is unavailable, SSSD
    will use its cache even if it was invalidated. This happens until the
    back-end is available again.
   </p><p>
    To invalidate the cache, run <code class="command">sss_cache -E</code> (the
    command <code class="command">sss_cache</code> is part of the package
    <span class="package">sssd-tools</span>).
   </p><p>
    To completely remove the SSSD cache, run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl stop sssd</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">rm -f /var/lib/sss/db/*</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl start sssd</code></pre></div></section></section></section><section class="chapter" id="cha-security-ldap" data-id-title="LDAP with 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">5 </span><span class="title-name">LDAP with 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="#cha-security-ldap">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    The Lightweight Directory Access Protocol (LDAP) is a protocol
    designed to access and maintain information directories. LDAP can be
    used for tasks such as user and group management, system configuration
    management, and address management. In <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP4</span></span> the
    LDAP service is provided by the 389 Directory Server, replacing OpenLDAP.
   </p></div></div></div></div><p>
   Ideally, a central server stores the data in a directory and distributes
   it to all clients using a well-defined protocol. The structured data allow
   a wide range of applications to access them. A central repository reduces
   the necessary administrative effort. The use of an open and standardized
   protocol such as LDAP ensures that as many client applications as
   possible can access such information.
  </p><p>
   A directory in this context is a type of database optimized for quick and
   effective reading and searching. The type of data stored in a directory tends
   to be long lived and changes infrequently. This allows the LDAP service to be
   optimized for high performance concurrent reads, whereas conventional databases
   are optimized for accepting many writes to data in a short time.
  </p><section class="sect1" id="sec-security-ldap-tree" data-id-title="Structure of an LDAP directory tree"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.1 </span><span class="title-name">Structure of an LDAP directory tree</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-tree">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_directory_tree.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section introduces the layout of an LDAP directory tree, and provides
   the basic terminology used with regard to LDAP. 
  </p><p>
   An LDAP directory has a tree structure. All entries (called objects) of
   the directory have a defined position within this hierarchy. This
   hierarchy is called the <span class="emphasis"><em>directory information tree</em></span>
   (DIT). The complete path to the desired entry, which unambiguously
   identifies it, is called the <span class="emphasis"><em>distinguished name</em></span> or
   DN. An object in the tree is identified by its <span class="emphasis"><em>relative distinguished
   name</em></span> (RDN). The distinguished name is built from the RDNs of all
   entries on the path to the entry.
  </p><p>
   The relations within an LDAP directory tree become more evident in the
   following example, shown in <a class="xref" href="#fig-ldap-tree" title="Structure of an LDAP directory">Figure 5.1, “Structure of an LDAP directory”</a>.
  </p><div class="figure" id="fig-ldap-tree"><div class="figure-contents"><div class="mediaobject"><a href="images/ldap_tree.png"><img src="images/ldap_tree.png" width="85%" alt="Structure of an LDAP directory" title="Structure of an LDAP directory"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 5.1: </span><span class="title-name">Structure of an LDAP directory </span></span><a title="Permalink" class="permalink" href="#fig-ldap-tree">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_directory_tree.xml" title="Edit source document"> </a></div></div></div><p>
   The complete diagram is a fictional directory information tree. The
   entries on three levels are depicted. Each entry corresponds to one box
   in the image. The complete, valid <span class="emphasis"><em>distinguished name</em></span>
   for the fictional employee <code class="systemitem">Geeko
   Linux</code>, in this case, is <code class="literal">cn=Geeko
   Linux,ou=doc,dc=example,dc=com</code>. It is composed by adding the
   RDN <code class="literal">cn=Geeko Linux</code> to the DN of the preceding entry
   <code class="literal">ou=doc,dc=example,dc=com</code>.
  </p><p>
   The types of objects that can be stored in the DIT are globally
   determined following a <span class="emphasis"><em>Schema</em></span>. The type of an object
   is determined by the <span class="emphasis"><em>object class</em></span>. The object class
   determines what attributes the relevant object must or may be assigned.
   The Schema contains all object classes and attributes which can be used by
   the LDAP server. Attributes are a structured data type. Their syntax, ordering
   and other behavior is defined by the Schema. LDAP servers supply a core set of
   Schemas which can work in a broad variety of environments. If a custom Schema
   is required, you can upload it to an LDAP server.
  </p><p>
   <a class="xref" href="#tab-ldap-schema" title="Commonly used object classes and attributes">Table 5.1, “Commonly used object classes and attributes”</a> offers a small overview of the object
   classes from <code class="filename">00core.ldif</code> and
   <code class="filename">06inetorgperson.ldif</code> used in the example, including
   required attributes (Req. Attr.) and valid attribute values. After installing
   389 Directory Server, these can be found in
   <code class="filename">/usr/share/dirsrv/schema</code>.

  </p><div class="table" id="tab-ldap-schema" data-id-title="Commonly used object classes and attributes"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 5.1: </span><span class="title-name">Commonly used object classes and attributes </span></span><a title="Permalink" class="permalink" href="#tab-ldap-schema">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_directory_tree.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/><col class="c4"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Object Class
       </p>
      </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Meaning
       </p>
      </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Example Entry
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Req. Attr.
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">domain</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        name components of the domain
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        example
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        displayName
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">organizationalUnit</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        organizational unit
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">documentationdept</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="literal">ou</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        <code class="literal">nsPerson</code>
       </p>
      </td><td style="border-right: 1px solid ; ">
       <p>
        person-related data for the
        intranet or Internet
       </p>
      </td><td style="border-right: 1px solid ; ">
       <p>
        <code class="literal">Tux Linux</code>
       </p>
      </td><td>
       <p>
        <code class="literal">cn</code>
       </p>
      </td></tr></tbody></table></div></div><p>
   <a class="xref" href="#aus-ldap-schema-help" title="Excerpt from CN=schema">Example 5.1, “Excerpt from CN=schema”</a> shows an excerpt from a Schema
   directive with explanations.
  </p><div class="example" id="aus-ldap-schema-help" data-id-title="Excerpt from CN=schema"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.1: </span><span class="title-name">Excerpt from CN=schema </span></span><a title="Permalink" class="permalink" href="#aus-ldap-schema-help">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_directory_tree.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">attributetype (1.2.840.113556.1.2.102 NAME 'memberOf' <span class="callout" id="co-ldap-schema-core-att-type">1</span>
       DESC 'Group that the entry belongs to' <span class="callout" id="co-ldap-schema-core-desc">2</span>
       SYNTAX 1.3.6.1.4.1.1466.115.121.1.12 <span class="callout" id="co-ldap-schema-core-syntax">3</span>
       X-ORIGIN 'Netscape Delegated Administrator') <span class="callout" id="co-ldap-schema-core-xorigin">4</span>

objectclass (2.16.840.1.113730.3.2.333 NAME 'nsPerson' <span class="callout" id="co-ldap-schema-core-oc">5</span>
       DESC 'A representation of a person in a directory server' <span class="callout" id="co-ldap-schema-core-desc-oc">6</span>
       SUP top STRUCTURAL <span class="callout" id="co-ldap-schema-core-sup-oc">7</span>
       MUST ( displayName $ cn ) <span class="callout" id="co-ldap-schema-core-must-oc">8</span>
       MAY ( userPassword $ seeAlso $ description $ legalName $ mail \
             $ preferredLanguage ) <span class="callout" id="co-ldap-schema-core-may-oc">9</span>
       X-ORIGIN '389 Directory Server Project'
  ...</pre></div></div></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-att-type"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The name of the attribute, its unique <span class="emphasis"><em>object
     identifier</em></span> (OID, numerical), and the abbreviation of the
     attribute.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-desc"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     A brief description of the attribute with <code class="literal">DESC</code>. The
     corresponding RFC, on which the definition is based, may also mentioned
     here.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-syntax"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      The type of data that can be held in the attribute. In this case, it is a
      case-insensitive directory string.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-xorigin"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The source of the schema element (for example, the name of the project).
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-oc"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The definition of the object class <code class="literal">nsPerson</code> begins with
     an OID and the name of the object class (like the definition of
     the attribute).
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-desc-oc"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     A brief description of the object class.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-sup-oc"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The <code class="literal">SUP top</code> entry indicates that this object class
     is not subordinate to another object class.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-must-oc"><span class="callout">8</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     With <code class="literal">MUST</code>, list all attribute types that must be used
     with an object of the type
     <code class="literal">nsPerson</code>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-may-oc"><span class="callout">9</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     With <code class="literal">MAY</code>, list all attribute types that are optionally
     permitted with this object class.
    </p></td></tr></table></div></section><section class="sect1" id="sec-security-ldap-server-install" data-id-title="Installing 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.2 </span><span class="title-name">Installing 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-server-install">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Install 389 Directory Server with the following command:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">zypper install 389-ds</code></pre></div><p>
  After installation, set up the server 
 </p><section class="sect2" id="sec-security-ldap-server" data-id-title="Setting up a new 389 Directory Server instance"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.1 </span><span class="title-name">Setting up a new 389 Directory Server instance</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-server">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You will use the <code class="command">dscreate</code> command to create new 389 Directory Server
   instances, and the <code class="command">dsctl</code> command to cleanly remove them.
  </p><p>
   There are two ways to configure and create a new instance: from a custom
   configuration file, and from an auto-generated template file. You can use
   the auto-generated template without changes for a test instance, though for
   a production system you must carefully review it and make any necessary
   changes.
  </p><p>
   Then you will set up administration credentials, manage users and groups,
   and configure identity services.
  </p><p>
   The 389 Directory Server is controlled by three primary commands:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.5.6.5.6.1"><span class="term"><code class="command">dsctl</code></span></dt><dd><p>
      Manages a local instance and requires <code class="systemitem">root</code> permissions. Requires
      you to be connected to a terminal which is running the directory server
      instance. Used for starting, stopping, backing up the database, and more.
     </p></dd><dt id="id-1.7.4.5.6.5.6.2"><span class="term"><code class="command">dsconf</code></span></dt><dd><p>
      The primary tool used for administration and configuration of the server.
      Manages an instance's configuration via its external interfaces. This
      allows you to make configuration changes remotely on the instance.
     </p></dd><dt id="id-1.7.4.5.6.5.6.3"><span class="term"><code class="command">dsidm</code></span></dt><dd><p>
      Used for identity management (managing users, groups, passwords, etc.).
      The permissions are granted by access controls, so, for example, users
      can reset their own password or change details of their own account.
     </p></dd></dl></div><p>
   Follow these steps to set up a simple instance for testing and development,
   populated with a small set of sample entries.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>

     <a class="xref" href="#sec-security-ldap-server-instance" title="5.2.2. Creating a 389 Directory Server instance with a custom configuration file">Creating a 389 Directory Server instance with a custom configuration file</a>
    </p></li><li class="step"><p>

     <a class="xref" href="#sec-security-ldap-server-template" title="5.2.3. Creating a 389 Directory Server instance from a template">Creating a 389 Directory Server instance from a template</a>
    </p></li><li class="step"><p>

     <a class="xref" href="#sec-security-ldap-server-credentials" title="5.2.5. Configuring admin credentials for local administration">Configuring admin credentials for local administration</a>
    </p></li><li class="step"><p>

     <a class="xref" href="#sec-security-ldap-server-users" title="5.5. Managing LDAP users and groups">Managing LDAP users and groups</a>
    </p></li><li class="step"><p>

     <a class="xref" href="#sec-security-ldap-server-sssd" title="5.7. Using SSSD to manage LDAP authentication">Using SSSD to manage LDAP authentication</a>
    </p></li><li class="step"><p>

     <a class="xref" href="#sec-security-ldap-modules" title="5.6. Managing plug-ins">Managing plug-ins</a>
    </p></li><li class="step"><p>

     <a class="xref" href="#sec-security-ldap-server-ca" title="5.9. Importing TLS server certificates and keys">Importing TLS server certificates and keys</a>
    </p></li></ol></div></div></section><section class="sect2" id="sec-security-ldap-server-instance" data-id-title="Creating a 389 Directory Server instance with a custom configuration file"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.2 </span><span class="title-name">Creating a 389 Directory Server instance with a custom configuration file</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-server-instance">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can create a new 389 Directory Server instance from a simple custom configuration
   file. This file must be in the INF format, and you can name it anything you
   like.
  </p><p>
   The default instance name is <code class="literal">localhost</code>. The instance name
   cannot be changed after it has been created. It is better to create your own
   instance name, rather than using the default, to avoid confusion and to
   enable a better understanding of how it all works. The following examples
   use the <em class="replaceable">LDAP1</em> instance name, and a suffix of
   dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em>.
  </p><p>
   <a class="xref" href="#ex-ldap-389-ds-inf" title="Minimal 389 Directory Server instance configuration file">Example 5.2</a> shows an
   example configuration file that you can use to create a new 389 Directory Server
   instance. You can copy and use this file without changes.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Copy the following example file, <code class="filename">LDAP1.inf</code>, to your
     home directory:
    </p><div class="example" id="ex-ldap-389-ds-inf" data-id-title="Minimal 389 Directory Server instance configuration file"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.2: </span><span class="title-name">Minimal 389 Directory Server instance configuration file </span></span><a title="Permalink" class="permalink" href="#ex-ldap-389-ds-inf">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"># <em class="replaceable">LDAP1.inf</em>

[general]
config_version = 2 <span class="callout" id="co-ldap-389-ds-config-version">1</span>

[slapd]
root_password = <em class="replaceable">PASSWORD</em><span class="callout" id="co-ldap-389-ds-rootpasswd">2</span>
self_sign_cert = True <span class="callout" id="co-ldap-389-ds-cert">3</span>
instance_name = <em class="replaceable">LDAP1</em>

[backend-userroot]
sample_entries = yes <span class="callout" id="co-ldap-389-ds-sample-entries">4</span>
suffix = dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-389-ds-config-version"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        This line is required, indicating that this is a version 2 setup INF
        file.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-389-ds-rootpasswd"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Create a strong <code class="varname">root_password</code> for the ldap user
        <code class="literal">cn=Directory Manager</code>. This user is for connecting
        (binding) to the directory.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-389-ds-cert"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Create self-signed server certificates in
        <code class="filename">/etc/dirsrv/slapd-<em class="replaceable">LDAP1</em></code>.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-389-ds-sample-entries"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Populate the new instance with sample user and group entries.
       </p></td></tr></table></div></div></div></li><li class="step"><p>
     To create the 389 Directory Server instance from
     <a class="xref" href="#ex-ldap-389-ds-inf" title="Minimal 389 Directory Server instance configuration file">Example 5.2</a>, run the
     following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dscreate -v from-file <em class="replaceable">LDAP1.inf</em> |</code> \
<code class="command">tee <em class="replaceable">LDAP1-OUTPUT.txt</em></code></pre></div><p>
     This shows all activity during the instance creation, stores all the
     messages in
     <code class="filename"><em class="replaceable">LDAP1-OUTPUT.txt</em></code>, and
     creates a working LDAP server in about a minute. The verbose output
     contains a lot of useful information. If you do not want to save it, then
     delete the <code class="literal">| tee
     <em class="replaceable">LDAP1-OUTPUT.txt</em></code> portion of the
     command.
    </p></li><li class="step"><p>
     If the <code class="command">dscreate</code> command should fail, the messages will
     tell you why. After correcting any issues, remove the instance (see
     <a class="xref" href="#sec-security-ldap-server-remove" title="Step 5">Step 5</a>) and create a new
     instance.
    </p></li><li class="step"><p>
     A successful installation reports "<code class="literal">Completed installation for
     <em class="replaceable">LDAP1</em></code>". Check the status of your new
     server:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> status</code>
Instance "LDAP1" is running</pre></div></li><li class="step" id="sec-security-ldap-server-remove"><p>
     The following commands are for cleanly removing the instance. The first
     command performs a dry run and does not remove the instance. When you are
     sure you want to remove it, use the second command with the
     <code class="command">--do-it</code> option:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> remove</code>
Not removing: if you are sure, add --do-it

<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl<em class="replaceable">LDAP1</em> remove --do-it</code></pre></div><p>
     This command also removes partially installed or corrupted instances. You
     can reliably create and remove instances as often as you want.
    </p></li></ol></div></div><p>
   If you forget the name of your instance, use <code class="command">dsctl</code> to
   list all instances:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo dsctl -l</code>
slapd-<em class="replaceable">LDAP1</em></pre></div></section><section class="sect2" id="sec-security-ldap-server-template" data-id-title="Creating a 389 Directory Server instance from a template"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.3 </span><span class="title-name">Creating a 389 Directory Server instance from a template</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-server-template">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can auto-create a template for a new 389 Directory Server instance with the
   <code class="command">dscreate</code> command. This creates a template that you can
   use without making any changes, for testing. For production systems, review
   and change it to suit your own requirements. All of the defaults are
   documented in the template file, and commented out. To make changes,
   uncomment the default and enter your own value. All options are well
   documented.
  </p><p>
   The following example prints the template to stdout:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo dscreate create-template</code></pre></div><p>
   This is good for a quick review of the template, but you must create a file
   to use in creating your new 389 Directory Server instance. You can name this file
   anything you want:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo dscreate create-template <em class="replaceable">TEMPLATE.txt</em></code></pre></div><p>
   This is a snippet from the new file:
  </p><div class="verbatim-wrap"><pre class="screen"># full_machine_name (str)
# Description: Sets the fully qualified hostname (FQDN) of this system. When
# installing this instance with GSSAPI authentication behind a load balancer, set
# this parameter to the FQDN of the load balancer and, additionally, set
# "strict_host_checking" to "false".
# Default value: ldapserver1.test.net
;full_machine_name = ldapserver1.test.net

# selinux (bool)
# Description: Enables SELinux detection and integration during the installation
# of this instance. If set to "True", dscreate auto-detects whether SELinux is
# enabled. Set this parameter only to "False" in a development environment.
# Default value: True
;selinux = True</pre></div><p>
   It automatically configures some options from your existing environment; for
   example, the system's fully-qualified domain name, which is called
   <code class="literal">full_machine_name</code> in the template. Use this file with no
   changes to create a new instance:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dscreate from-file <em class="replaceable">TEMPLATE.txt</em></code></pre></div><p>
   This creates a new instance named <code class="literal">localhost</code>, and
   automatically starts it after creation:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl localhost status</code>
Instance "localhost" is running</pre></div><p>
   The default values create a fully operational instance, but there are some
   values you might want to change.
  </p><p>
   The instance name cannot be changed after it has been created. It is better
   to create your own instance name, rather than using the default, to avoid
   confusion and to enable a better understanding of how it all works. To do
   this, uncomment the <code class="literal">;instance_name = localhost</code> line and
   change <code class="literal">localhost</code> to your chosen name. In the following
   examples, the instance name is <em class="replaceable">LDAP1</em>.
  </p><p>
   Another useful change is to populate your new instance with sample users and
   groups. Uncomment <code class="literal">;sample_entries = no</code> and change
   <code class="literal">no</code> to <code class="literal">yes</code>. This creates the
   <code class="literal">demo_user</code> and <code class="literal">demo_group</code>.
  </p><p>
   Set your own password by uncommenting <code class="literal">;root_password</code>, and
   replacing the default password with your own.
  </p><p>
   The template does not create a default suffix, so you should configure your
   own on the <code class="literal">suffix</code> line, like the following example:
  </p><div class="verbatim-wrap"><pre class="screen">suffix = dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em></pre></div><p>
   You can cleanly remove any instance and start over with
   <code class="command">dsctl</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> remove --do-it</code></pre></div></section><section class="sect2" id="sec-security-ldap-server-stop-start" data-id-title="Stopping and starting 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.4 </span><span class="title-name">Stopping and starting 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-server-stop-start">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following examples use <code class="literal">LDAP1</code> as the instance name.
   Use <code class="systemitem">systemd</code> to manage your 389 Directory Server instance. Get the status of your
   instance:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">systemctl status --no-pager --full dirsrv@LDAP1.service</code>
   ● dirsrv@LDAP1.service - 389 Directory Server LDAP1.
     Loaded: loaded (/usr/lib/systemd/system/dirsrv@.service; enabled; vendor preset: disabled)
     Active: active (running) since Thu 2021-03-11 08:55:28 PST; 2h 7min ago
    Process: 4451 ExecStartPre=/usr/lib/dirsrv/ds_systemd_ask_password_acl
       /etc/dirsrv/slapd-LDAP1/dse.ldif (code=exited, status=0/SUCCESS)
   Main PID: 4456 (ns-slapd)
     Status: "slapd started: Ready to process requests"
      Tasks: 26
     CGroup: /system.slice/system-dirsrv.slice/dirsrv@LDAP1.service
             └─4456 /usr/sbin/ns-slapd -D /etc/dirsrv/slapd-LDAP1 -i /run/dirsrv/slapd-LDAP1.pid</pre></div><p>
   Start, stop, and restart your LDAP server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl start <em class="replaceable">dirsrv@LDAP1.service</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl stop <em class="replaceable">dirsrv@LDAP1.service</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl restart <em class="replaceable">dirsrv@LDAP1.service</em></code></pre></div><p>
   See <span class="intraxref">Book “Administration Guide”, Chapter 19 “The <code class="systemitem">systemd</code> daemon”</span> for more information on using
   <code class="command">systemctl</code>.
  </p><p>
   The <code class="command">dsctl</code> command also starts and stops your server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> status</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> stop</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> restart</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> start</code></pre></div></section><section class="sect2" id="sec-security-ldap-server-credentials" data-id-title="Configuring admin credentials for local administration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.5 </span><span class="title-name">Configuring admin credentials for local administration</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-server-credentials">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For local administration of the 389 Directory Server, you can create a
   <code class="filename">.dsrc</code> configuration file in the
   <code class="filename">/root</code> directory, allowing root and sudo users to
   administer the server without typing connection details with every command.
   <a class="xref" href="#ex-security-ldap-server-credentials-local" title="A .dsrc file for local administration">Example 5.3</a>
   shows an example for local administration on the server, using
   <em class="replaceable">LDAP1</em> and <em class="replaceable">com</em> for the
   suffix.
  </p><p>
   After creating your <code class="filename">/root/.dsrc</code> file, try a few
   administration commands, such as creating new users (see
   <a class="xref" href="#sec-security-ldap-server-users" title="5.5. Managing LDAP users and groups">Section 5.5, “Managing LDAP users and groups”</a>).
  </p><div class="example" id="ex-security-ldap-server-credentials-local" data-id-title="A .dsrc file for local administration"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.3: </span><span class="title-name">A <code class="filename">.dsrc</code> file for local administration </span></span><a title="Permalink" class="permalink" href="#ex-security-ldap-server-credentials-local">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"># /root/.dsrc file for administering the LDAP1 instance

[<em class="replaceable">LDAP1</em>] <span class="callout" id="co-ldap-server-dsrc-instance-name">1</span>

uri = ldapi://<em class="replaceable">%%2fvar%%2frun%%2fslapd-LDAP1.socket</em> <span class="callout" id="co-ldap-server-dsrc-remote-ldapi">2</span>
basedn = dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em>
binddn = cn=Directory Manager</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-server-dsrc-instance-name"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      This must specify your exact instance name.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-server-dsrc-remote-ldapi"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      <code class="literal">ldapi</code> detects the UID and GID of the user attempting
      to log in to the server. If the UID/GID are <code class="literal">0/0</code> or
      <code class="literal">dirsrv:dirsrv</code>, <code class="literal">ldapi</code> binds the user
      as the directory server root dn, which is <code class="literal">cn=Directory
      Manager</code>.
     </p><p>
      In the URI, the slashes are replaced with <code class="literal">%%2f</code>, so in
      this example the path is
      <code class="filename">/var/run/slapd-<em class="replaceable">LDAP1</em>.socket</code>.
     </p></td></tr></table></div></div></div><div id="id-1.7.4.5.6.9.5" data-id-title="New negation feature in sudoers.ldap" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: New negation feature in sudoers.ldap</div><p>
         In <span class="package">sudo</span> versions older than 1.9.9,
         negation in sudoers.ldap does
         not work for the <code class="literal">sudoUser</code>,
         <code class="literal">sudoRunAsUser</code>, or
         <code class="literal">sudoRunAsGroup</code> attributes. For example:
       </p><div class="verbatim-wrap"><pre class="screen"> # does not match all but joe
# instead, it does not match anyone
sudoUser: !joe

# does not match all but joe
# instead, it matches everyone including Joe
sudoUser: ALL
sudoUser: !joe</pre></div></div><p>
    In <code class="command">sudo</code> version 1.9.9 and higher, negation is
    enabled for the <code class="literal">sudoUser</code> attribute. See
    <code class="command">man 5 sudoers.ldap</code> for more information.
  </p></section></section><section class="sect1" id="sec-security-ldap-firewall" data-id-title="Firewall configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.3 </span><span class="title-name">Firewall configuration</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-firewall">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      The default TCP ports for 389 Directory Server are 389 and 636. TCP 389 is for unencrypted
      connections, and STARTTLS. 636 is for encrypted connections over TLS.
  </p><p>
      <code class="systemitem">firewalld</code> is the default firewall manager for SUSE Linux Enterprise. The following rules
      activate the <code class="literal">ldap</code> and <code class="literal">ldaps</code> firewall
      services:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">firewall-cmd --add-service=ldap --zone=<em class="replaceable">internal</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">firewall-cmd --add-service=ldaps --zone=<em class="replaceable">internal</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">firewall-cmd --runtime-to-permanent</code></pre></div><p>
      Replace the zone with the appropriate zone for your server. See
      <a class="xref" href="#sec-security-ldap-server-ca" title="5.9. Importing TLS server certificates and keys">Section 5.9, “Importing TLS server certificates and keys”</a> for information on securing
          your connections with TLS, and
          <a class="xref" href="#sec-security-firewall-fw" title="23.3. Firewalling basics">Section 23.3, “Firewalling basics”</a> to learn about <code class="systemitem">firewalld</code>.
  </p></section><section class="sect1" id="sec-security-ldap-backup" data-id-title="Backing up and restoring 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.4 </span><span class="title-name">Backing up and restoring 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-backup">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_backups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  389 Directory Server supports making offline and online backups. The
  <code class="command">dsctl</code> command makes offline database backups, and the
  <code class="command">dsconf</code> command makes online database backups. Back up the
  LDAP server configuration directory to enable complete restoration in case
  of a major failure.
 </p><section class="sect2" id="sec-security-ldap-backup-config" data-id-title="Backing up the LDAP server configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.4.1 </span><span class="title-name">Backing up the LDAP server configuration</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-backup-config">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_backups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Your LDAP server configuration is in the directory
   <code class="filename">/etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em></code>.
   This directory contains certificates, keys, and the <code class="filename">dse.ldif</code>
   file. Make a compressed backup of this directory with the
   <code class="command">tar</code> command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">tar caf \</code>
<code class="command">config_slapd-<em class="replaceable">INSTANCE_NAME</em>-$(date +%Y-%m-%d_%H-%M-%S).tar.gz \</code>
<code class="command">/etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/</code></pre></div><div id="id-1.7.4.5.8.3.4" data-id-title="Harmless tar error message" class="admonition note compact"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Harmless tar error message</div><p>
    When running <code class="command">tar</code>, you may see the harmless informational
    message <code class="literal">tar: Removing leading `/' from member names</code>.
   </p></div><p>
   To restore a previous configuration, unpack it to the same directory:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p><span class="step-optional">(Optional)</span> 
     To avoid overwriting an existing configuration, move it:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">old /etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/</code></pre></div></li><li class="step"><p>
     Unpack the backup archive:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">tar -xvzf</code> \
<code class="command">config_slapd-<em class="replaceable">INSTANCE_NAME-DATE</em>.tar.gz</code></pre></div></li><li class="step"><p>
     Copy it to
     <code class="filename">/etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em></code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">cp -r etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em></code> \
<code class="command">/etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em></code></pre></div></li></ol></div></div></section><section class="sect2" id="sec-security-ldap-offline-backup" data-id-title="Creating an offline backup of the LDAP database and restoring from it"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.4.2 </span><span class="title-name">Creating an offline backup of the LDAP database and restoring from it</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-offline-backup">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_backups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="command">dsctl</code> command makes offline backups. Stop the server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> stop</code>
Instance "<em class="replaceable">INSTANCE_NAME</em>" has been stopped</pre></div><p>
   Then make the backup using your instance name. The following example
   creates a backup archive at
   <em class="replaceable">/var/lib/dirsrv/slapd-INSTANCE_NAME/bak/INSTANCE_NAME-DATE</em>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> db2bak</code>
db2bak successful</pre></div><p>
  For example, on a test instance named ldap1 it looks like this:
</p><div class="verbatim-wrap"><pre class="screen"><code class="filename">/var/lib/dirsrv/slapd-ldap1/bak/ldap1-2021_10_25_13_03_17</code></pre></div><p>
   Restore from this backup, naming the directory containing the backup
   archive:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> bak2db</code> \
<code class="command">/var/lib/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/bak/<em class="replaceable">INSTANCE_NAME-DATE</em>/</code>
bak2db successful</pre></div><p>
   Then start the server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> start</code>
Instance "INSTANCE_NAME" has been started</pre></div><p>
   You can also create LDIF backups:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> db2ldif --replication userRoot</code>
ldiffile: /var/lib/dirsrv/slapd-INSTANCE_NAME/ldif/INSTANCE_NAME-userRoot-DATE.ldif
db2ldif successful</pre></div><p>
   Restore an LDIF backup with the name of the archive, then start the server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl ldif2db userRoot</code> \
<code class="command">/var/lib/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/ldif/<em class="replaceable">INSTANCE_NAME</em>-userRoot-<em class="replaceable">DATE</em>.ldif</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> start</code></pre></div></section><section class="sect2" id="sec-security-ldap-online-backup" data-id-title="Creating an online backup of the LDAP database and restoring from it"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.4.3 </span><span class="title-name">Creating an online backup of the LDAP database and restoring from it</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-online-backup">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_backups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use the <code class="command">dsconf</code> to make an online backup of your LDAP
   database:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> backup create</code>
The backup create task has finished successfully</pre></div><p>
   This creates
   <code class="filename">/var/lib/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/bak/<em class="replaceable">INSTANCE_NAME-DATE</em></code>.
  </p><p>
   Restore it:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> backup restore</code> \
<code class="command">/var/lib/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/bak/<em class="replaceable">INSTANCE_NAME-DATE</em></code></pre></div></section></section><section class="sect1" id="sec-security-ldap-server-users" data-id-title="Managing LDAP users and groups"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.5 </span><span class="title-name">Managing LDAP users and groups</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-server-users">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Use the <code class="command">dsidm</code> command to create, remove, and manage 
  users and groups.  
 </p><section class="sect2" id="sec-security-ldap-list-users-groups" data-id-title="Querying existing LDAP users and groups"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.5.1 </span><span class="title-name">Querying existing LDAP users and groups</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-list-users-groups">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following examples show how to list your existing users and groups. The
  examples use the instance name <em class="replaceable">LDAP1</em>. Replace 
  this with your instance name:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> user list</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group list</code></pre></div><p>
  List all information on a single user:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> user get <em class="replaceable">USER</em></code></pre></div><p>
  List all information on a single group:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group get <em class="replaceable">GROUP</em></code></pre></div><p>
  List members of a group:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group members <em class="replaceable">GROUP</em></code></pre></div></section><section class="sect2" id="sec-security-ldap-create-users-passwords" data-id-title="Creating users and managing passwords"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.5.2 </span><span class="title-name">Creating users and managing passwords</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-create-users-passwords">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  In the following example, we create one user, <code class="systemitem">wilber</code>. The
  example server instance is named <em class="replaceable">LDAP1</em>, and the
  instance's suffix is <em class="replaceable">dc=LDAP1,dc=COM</em>.
 </p><div class="procedure" id="pro-security-ldap-server-users" data-id-title="Creating LDAP users"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 5.1: </span><span class="title-name">Creating LDAP users </span></span><a title="Permalink" class="permalink" href="#pro-security-ldap-server-users">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
   The following example creates the user Wilber Fox on your 
   389 DS instance:
  </p><ol class="procedure" type="1"><li class="step"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> user create --uid wilber \</code>
  <code class="command">--cn wilber --displayName 'Wilber Fox' --uidNumber 1001 --gidNumber 101 \</code>
 <code class="command"> --homeDirectory /home/wilber</code></pre></div></li><li class="step"><p>
    Verify by looking up your new user's <code class="literal">distinguished name</code>
    (fully qualified name to the directory object, which is guaranteed unique):
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> user get wilber</code>
dn: <em class="replaceable">uid=wilber,ou=people,dc=LDAP1,dc=COM</em>
[...]</pre></div><p>
    You need the distinguished name for actions such as changing the password
    for a user.
   </p></li><li class="step"><p>
    Create a password for new user <code class="systemitem">wilber</code>:
   </p><ol type="a" class="substeps"><li class="step"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> account reset_password \</code>
  <code class="command">uid=<em class="replaceable">wilber,ou=people,dc=LDAP1,dc=COM</em></code></pre></div></li><li class="step"><p>
      Enter the new password for <code class="systemitem">wilber</code> twice.
     </p><p>
      If the action was successful, you get the following message:
     </p><div class="verbatim-wrap"><pre class="screen">reset password for uid=<em class="replaceable">wilber,ou=people,dc=LDAP1,dc=COM</em></pre></div><p>
      Use the same command to change an existing password.
     </p></li></ol></li><li class="step"><p>
    Verify that the user's password works:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ldapwhoami -D <em class="replaceable">uid=wilber,ou=people,dc=LDAP1,dc=COM</em> -W</code>
Enter LDAP Password: <em class="replaceable">PASSWORD</em>
dn: <em class="replaceable">uid=wilber,ou=people,dc=LDAP1,dc=COM</em></pre></div></li></ol></div></div></section><section class="sect2" id="sec-security-ldap-create-groups" data-id-title="Creating and managing groups"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.5.3 </span><span class="title-name">Creating and managing groups</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-create-groups">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    After creating users, you can create groups, and then assign
    users to them. In the following examples, we create a group,
   <em class="replaceable">server_admins</em>, and assign the user
   <code class="systemitem">wilber</code> to this group. The example server instance is named
   <em class="replaceable">LDAP1</em>, and the instance's suffix is
   <em class="replaceable">dc=LDAP1,dc=COM</em>.
  </p><div class="procedure" id="pro-security-ldap-server-groups" data-id-title="Creating LDAP groups and assigning users to them"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 5.2: </span><span class="title-name">Creating LDAP groups and assigning users to them </span></span><a title="Permalink" class="permalink" href="#pro-security-ldap-server-groups">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
    Create the group:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group create</code></pre></div><p>
    You will be prompted for a group name. Enter your chosen group name, which
    in the following example is <em class="replaceable">SERVER_ADMINS</em>:
   </p><div class="verbatim-wrap"><pre class="screen">Enter value for cn : <em class="replaceable">SERVER_ADMINS</em></pre></div></li><li class="step"><p>
     Add the user <code class="systemitem">wilber</code> 
     (created in <a class="xref" href="#pro-security-ldap-server-users" title="Creating LDAP users">Procedure 5.1, “Creating LDAP users”</a>) to the 
     group:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group add_member <em class="replaceable">SERVER_ADMINS</em></code> \
<code class="command">uid=wilber,<em class="replaceable">ou=people,dc=LDAP1,dc=COM</em></code>
added member: uid=<em class="replaceable">wilber,ou=people,dc=LDAP1,dc=COM</em></pre></div></li></ol></div></div></section><section class="sect2" id="sec-security-ldap-delete-users-groups" data-id-title="Deleting users and groups, and removing users from groups"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.5.4 </span><span class="title-name">Deleting users and groups, and removing users from groups</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-delete-users-groups">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use the <code class="command">dsidm</code> command to delete users, remove users 
   from groups, and delete groups. The following example removes our
   example user wilber from the server_admins group:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group remove_member <em class="replaceable">SERVER_ADMINS</em></code> \
<code class="command">uid=<em class="replaceable">wilber,ou=people,dc=LDAP1,dc=COM</em></code></pre></div><p>
   Delete a user:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> user delete</code> \
<code class="command"><em class="replaceable">uid=wilber,ou=people,dc=LDAP1,dc=COM</em></code></pre></div><p>
     Delete a group:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group delete <em class="replaceable">SERVER_ADMINS</em></code></pre></div></section></section><section class="sect1" id="sec-security-ldap-modules" data-id-title="Managing plug-ins"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.6 </span><span class="title-name">Managing plug-ins</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-modules">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_modules.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use the following command to list all available plug-ins, enabled and
    disabled. Use your server's hostname rather than the instance name
    of your 389 Directory Server, like the following example hostname of
    <em class="replaceable">LDAPSERVER1</em>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf -D "cn=Directory Manager" ldap://<em class="replaceable">LDAPSERVER1</em> plugin list</code>
Enter password for cn=Directory Manager on ldap://<em class="replaceable">LDAPSERVER1</em>: <em class="replaceable">PASSWORD</em>

7-bit check
Account Policy Plugin
Account Usability Plugin
ACL Plugin
ACL preoperation
[...]</pre></div><p>
    The following command enables the <code class="literal">MemberOf</code> plug-in referenced in
    <a class="xref" href="#sec-security-ldap-server-sssd" title="5.7. Using SSSD to manage LDAP authentication">Section 5.7, “Using SSSD to manage LDAP authentication”</a>. <code class="literal">MemberOf</code> simplifies
    user searches, by returning the user and any groups the user
    belongs to, with a single command. Without <code class="literal">MemberOf</code>, a client must
    run multiple lookups to find a user's group memberships.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf -D "cn=Directory Manager" ldap://<em class="replaceable">LDAPSERVER1</em> plugin memberof enable</code></pre></div><p>
    Note that the plug-in names used in commands are lowercase, so they
    are different from how
    they appear when you list them. If you make a mistake with a plug-in
    name, you will see a helpful error message:
  </p><div class="verbatim-wrap"><pre class="screen">dsconf instance plugin: error: invalid choice: 'MemberOf' (choose from
'memberof', 'automember', 'referential-integrity', 'root-dn', 'usn',
'account-policy', 'attr-uniq', 'dna', 'linked-attr', 'managed-entries',
'pass-through-auth', 'retro-changelog', 'posix-winsync', 'contentsync', 'list',
'show', 'set')</pre></div><p>
    After enabling a plug-in, it is necessary to restart the server:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl restart dirsrv@<em class="replaceable">LDAPSERVER1</em>.service</code></pre></div><p>
 Next, configure the plug-in. The following example enables <code class="literal">MemberOf</code> to
 search all entries. Use your instance name rather than the server's
 hostname:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">LDAP1 plugin memberOf set --scope dc=example,dc=com</em></code>
Successfully changed the cn=MemberOf Plugin,cn=plugins,cn=config</pre></div><p>
 After the <code class="literal">MemberOf</code> plug-in is enabled and configured, all new groups and
 users are automatically <code class="literal">MemberOf</code> targets. However, any
 users and groups that exist before it is enabled are not. They must be
 marked manually:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm LDAP1 user modify suzanne add:objectclass:nsmemberof</code>
Successfully modified uid=suzanne,ou=people,dc=ldap1,dc=com</pre></div><p>
 Now suzanne information and group membership are listed
 with a single command:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm LDAP1 user get suzanne</code>
dn: uid=suzanne,ou=people,dc=ldap1,dc=com
cn: suzanne
displayName: Suzanne Geeko
gidNumber: 102
homeDirectory: /home/suzanne
memberOf: cn=SERVER_ADMINS,ou=groups,dc=ldap1,dc=com</pre></div><p>
 Modifying a larger number of users is a lot of work. The following
 example shows how to make all legacy users <code class="literal">MemberOf</code> targets with one
 <code class="command">fixup</code> command:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf LDAP1 plugin memberof fixup -f '(objectClass=*)' dc=LDAP1,dc=COM</code></pre></div><section class="sect2" id="sec-security-ldap-modules-unsupported-plugins" data-id-title="Unsupported plug-ins on 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.6.1 </span><span class="title-name">Unsupported plug-ins on 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-modules-unsupported-plugins">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_modules.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following plug-ins are not supported on 389 Directory Server:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Distributed Numeric Assignment (DNA) plug-in
   </p></li><li class="listitem"><p>
    Managed Entries Plug-in (MEP)
   </p></li><li class="listitem"><p>
    Posix Winsync plug-in
   </p></li></ul></div></section></section><section class="sect1" id="sec-security-ldap-server-sssd" data-id-title="Using SSSD to manage LDAP authentication"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.7 </span><span class="title-name">Using SSSD to manage LDAP authentication</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-server-sssd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_sssd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The System Security Services Daemon (SSSD) manages authentication,
    identification, and access controls for remote users. This section
    describes how to use SSSD to manage authentication and identification
    for your 389 Directory Server.
  </p><p>
    SSSD mediates between your LDAP server and clients. It supports several
    provider back-ends, such as LDAP, Active Directory, and
    Kerberos. SSSD supports services, including SSH, PAM, NSS, and sudo.
    SSSD provides performance benefits and resilience through caching user
    IDs and credentials. Caching reduces the number of requests to your
    389 DS server, and provides authentication and identity services
    when the back-ends are unavailable.
  </p><p>
    If the Name Services Caching Daemon (nscd) is running on your network,
    you should disable or remove it. nscd caches only the common name
    service  requests, such as passwd, group, hosts, service, and netgroup,
    and will conflict with SSSD.
  </p><p>
    Your LDAP server is the provider, and your SSSD instance is the client
    of the provider. You may install SSSD on your 389 DS server, but
    installing it on a separate machine provides some resilience in case the
    389 DS server becomes unavailable. Use the following procedure to
    install and configure an SSSD client. The example 389 DS instance name
    is <em class="replaceable">LDAP1</em>:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
    Install the <code class="systemitem">sssd</code> and <code class="systemitem">sssd-ldap</code> packages:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">zypper in sssd sssd-ldap</code></pre></div></li><li class="step"><p>
    Back up the <code class="filename">/etc/sssd/sssd.conf</code> file, if it exists:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">old /etc/sssd/sssd.conf</code></pre></div></li><li class="step"><p>
     Create your new SSSD configuration template. The allowed output file
     names are <code class="literal">sssd.conf</code> and
     <code class="literal">ldap.conf</code>.
     <code class="literal">display</code> sends the output to stdout. The following
     example creates a client configuration in
     <code class="filename">/etc/sssd/sssd.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">cd /etc/sssd</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> client_config sssd.conf</code></pre></div></li><li class="step"><p>
      Review the output and make any necessary changes to suit your
      environment. The following <code class="filename">/etc/sssd/sssd.conf</code>
      file demonstrates a working example.
    </p><div id="id-1.7.4.5.11.6.4.2" data-id-title="MemberOf" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: MemberOf</div><p>
      The LDAP access filter relies on <code class="literal">MemberOf</code> being
      configured. For details, see <a class="xref" href="#sec-security-ldap-modules" title="5.6. Managing plug-ins">Section 5.6, “Managing plug-ins”</a>.
     </p></div><div class="verbatim-wrap"><pre class="screen">[sssd]
services = nss, pam, ssh, sudo
config_file_version = 2
domains = default

[nss]
homedir_substring = <em class="replaceable">/home</em>

[domain/default]
# If you have large groups (for example, 50+ members),
# you should set this to True
ignore_group_members = False
debug_level=3
cache_credentials = True
id_provider = ldap
auth_provider = ldap
access_provider = ldap
chpass_provider = ldap

ldap_schema = rfc2307bis
ldap_search_base = <em class="replaceable">dc=example,dc=com</em>
# We strongly recommend ldaps
ldap_uri = <em class="replaceable">ldaps://ldap.example.com</em>
ldap_tls_reqcert = demand
ldap_tls_cacert = /etc/openldap/ldap.crt
ldap_access_filter = (|(memberof=cn=&lt;login group&gt;,ou=Groups,dc=example,dc=com))
enumerate = false
access_provider = ldap

ldap_user_member_of = memberof
ldap_user_gecos = cn
ldap_user_uuid = nsUniqueId
ldap_group_uuid = nsUniqueId
ldap_account_expire_policy = rhds
ldap_access_order = filter, expire
# add these lines to /etc/ssh/sshd_config
#  AuthorizedKeysCommand /usr/bin/sss_ssh_authorizedkeys
#  AuthorizedKeysCommandUser nobody
ldap_user_ssh_public_key = nsSshPublicKey</pre></div></li><li class="step"><p>
      Set file ownership to root, and restrict read-write permissions to root:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">chown root:root /etc/sssd/sssd.conf</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">chmod 600 /etc/sssd/sssd.conf</code></pre></div></li><li class="step"><p>
      Edit the
      <code class="filename">/etc/nsswitch.conf</code> configuration file on
      the SSSD server to include the following lines:
    </p><div class="verbatim-wrap"><pre class="screen">passwd: compat sss
group:  compat sss
shadow: compat sss</pre></div></li><li class="step"><p>
    Edit the PAM configuration on the SSSD server, modifying <code class="filename">common-account-pc</code>,
    <code class="filename">common-auth-pc</code>,
<code class="filename">common-password-pc</code>, and
<code class="filename">common-session-pc</code>. SUSE Linux Enterprise provides a command to
modify all of these files at once, <code class="command">pam-config</code>:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">pam-config -a --sss</code></pre></div></li><li class="step"><p>
      Verify the modified configuration:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">pam-config -q --sss</code>
auth:
account:
password:
session:</pre></div></li><li class="step"><p>
      Copy <code class="filename">/etc/dirsrv/slapd-<em class="replaceable">LDAP1/</em>ca.crt</code>
      from the 389 DS server to <code class="filename">/etc/openldap/certs</code> on your SSSD server, then rehash it:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">c_rehash /etc/openldap/certs</code></pre></div></li><li class="step"><p>
     Enable and start SSSD:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl enable --now sssd</code></pre></div></li></ol></div></div><p>
    See <a class="xref" href="#cha-security-auth" title="Chapter 4. Setting up authentication clients using YaST">Chapter 4, <em>Setting up authentication clients using YaST</em></a> for information on managing the
    sssd.service with systemctl.
  </p><section class="sect2" id="sec-security-ldap-server-sssd-unsupported-password-hash" data-id-title="Unsupported password hashes and authentication schemes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.7.1 </span><span class="title-name">Unsupported password hashes and authentication schemes</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-server-sssd-unsupported-password-hash">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_sssd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following are not supported as configuration values in <code class="systemitem">dse.ldif</code> for
    the settings <code class="systemitem">nsslapd-rootpwstoragescheme</code> or
    <code class="systemitem">passwordStorageScheme</code>, or as a value of
    <code class="systemitem">passwordStorageScheme</code> in the account policy objects:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>SHA</p></li><li class="listitem"><p>SSHA</p></li><li class="listitem"><p>SHA256</p></li><li class="listitem"><p>SSHA256</p></li><li class="listitem"><p>SHA384</p></li><li class="listitem"><p>SSHA384</p></li><li class="listitem"><p>SHA512</p></li><li class="listitem"><p>SSHA512</p></li><li class="listitem"><p>NS-MTA-MD5</p></li><li class="listitem"><p>clear</p></li><li class="listitem"><p>MD5</p></li><li class="listitem"><p>SMD5</p></li></ul></div><div id="id-1.7.4.5.11.8.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      Database imports that contain these values are supported if
      <code class="systemitem">nsslapd-enable-upgrade-hash</code> is set to <code class="systemitem">on</code>
      (defaults to <code class="systemitem">on</code>).
    </p></div></section></section><section class="sect1" id="sec-security-ldap-migrate" data-id-title="Migrating to 389 Directory Server from OpenLDAP"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.8 </span><span class="title-name">Migrating to 389 Directory Server from OpenLDAP</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-migrate">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_migrate_test.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     OpenLDAP is deprecated<span class="phrase"> and no longer supported as of
     SUSE Linux Enterprise 15 SP3</span>.
     It has been replaced by 389 Directory Server. SUSE provides the
     <code class="command">openldap_to_ds</code> utility to assist with migration, included
     in the <span class="package">389-ds</span> package.
   </p><p>
     The <code class="command">openldap_to_ds</code> utility is designed to automate as
     much of the migration as possible. However, every LDAP deployment is
     different, and it is not possible to write a tool that satisfies all
     situations. It is likely there will be some manual steps to perform, and
     you should test your migration procedure thoroughly before attempting a
     production migration.
   </p><section class="sect2" id="sec-security-ldap-migrate-test" data-id-title="Testing migration from OpenLDAP"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.8.1 </span><span class="title-name">Testing migration from OpenLDAP</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-migrate-test">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_migrate_test.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     There are enough differences between OpenLDAP and 389 Directory Server that
     migration will probably involve repeated testing and adjustments.
     It can be helpful to do a quick migration test to get an idea of what
     steps will be necessary for a successful migration.
   </p><p>
     Prerequisites:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        A running 389 Directory Server instance.
     </p></li><li class="listitem"><p>
       An OpenLDAP <code class="filename">slapd</code> configuration file or directory
       in dynamic ldif format.
     </p></li><li class="listitem"><p>
        An ldif file backup of your OpenLDAP database.
     </p></li></ul></div><p>
     If your slapd configuration is not in dynamic ldif format, create a
     dynamic copy with <code class="command">slaptest</code>. Create a
     <code class="filename">slapd.d</code> directory, for example 
     <code class="filename">/root/slapd.d/</code>, then run the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">slaptest -f /etc/openldap/slapd.conf -F /root/slapd.d</code></pre></div><p>
       This results in several files similar to the following example:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ls /root/slapd.d/*</code>

/root/slapd.d/cn=config.ldif

/root/slapd.d/cn=config:
cn=module{0}.ldif  cn=schema.ldif                 olcDatabase={0}config.ldif
cn=schema          olcDatabase={-1}frontend.ldif  olcDatabase={1}mdb.ldif</pre></div><p>
     Create one ldif file per suffix. In the following examples, the suffix
     is 
     dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em>. If you are using the
     <code class="filename">/etc/openldap/slapd.conf</code>
     format, use the following command to create the ldif backup file:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">slapcat -f /etc/openldap/slapd.conf -b dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em></code> \
<code class="command">-l <em class="replaceable">/root/LDAP1-COM</em>.ldif</code></pre></div><p>
     Use <code class="command">openldap_to_ds</code> to analyze the configuration and
     files, and show a migration plan without changing anything:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">openldap_to_ds <em class="replaceable">LDAP1</em></code>\
<code class="command">/root/slapd.d <em class="replaceable">/root/LDAP1-COM</em>.ldif.ldif</code></pre></div><p>
     This performs a dry run and does not change anything. The output looks
     like this:
   </p><div class="verbatim-wrap"><pre class="screen">Examining OpenLDAP Configuration ...
Completed OpenLDAP Configuration Parsing.
Examining Ldifs ...
Completed Ldif Metadata Parsing.
The following migration steps will be performed:
 * Schema Skip Unsupported Attribute -&gt; otherMailbox (0.9.2342.19200300.100.1.22)
 * Schema Skip Unsupported Attribute -&gt; dSAQuality (0.9.2342.19200300.100.1.49)
 * Schema Skip Unsupported Attribute -&gt; singleLevelQuality (0.9.2342.19200300.100.1.50)
 * Schema Skip Unsupported Attribute -&gt; subtreeMinimumQuality (0.9.2342.19200300.100.1.51)
 * Schema Skip Unsupported Attribute -&gt; subtreeMaximumQuality (0.9.2342.19200300.100.1.52)
 * Schema Create Attribute -&gt; suseDefaultBase (SUSE.YaST.ModuleConfig.Attr:2)
 * Schema Create Attribute -&gt; suseNextUniqueId (SUSE.YaST.ModuleConfig.Attr:3)
[...]
 * Schema Create ObjectClass -&gt; suseDhcpConfiguration (SUSE.YaST.ModuleConfig.OC:10)
 * Schema Create ObjectClass -&gt; suseMailConfiguration (SUSE.YaST.ModuleConfig.OC:11)
 * Database Reindex -&gt; dc=example,dc=com
 * Database Import Ldif -&gt; dc=example,dc=com from example.ldif - 
excluding entry attributes = [{'structuralobjectclass', 'entrycsn'}]
No actions taken. To apply migration plan, use '--confirm'</pre></div><p>
     The following example performs the migration, and the output looks
     different from the dry run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">openldap_to_ds <em class="replaceable">LDAP1</em> /root/slapd.d <em class="replaceable">/root/LDAP1-COM</em>.ldif --confirm</code>
Starting Migration ... This may take some time ...
migration: 1 / 40 complete ...
migration: 2 / 40 complete ...
migration: 3 / 40 complete ...
[...]
Index task index_all_05252021_120216 completed successfully
post: 39 / 40 complete ...
post: 40 / 40 complete ...
🎉 Migration complete!
----------------------
You should now review your instance configuration and data:
 * [ ] - Create/Migrate Database Access Controls (ACI)
 * [ ] - Enable and Verify TLS (LDAPS) Operation
 * [ ] - Schedule Automatic Backups
 * [ ] - Verify Accounts Can Bind Correctly
 * [ ] - Review Schema Inconistent ObjectClass -&gt; pilotOrganization (0.9.2342.19200300.100.4.20)
 * [ ] - Review Database Imported Content is Correct -&gt; dc=ldap1,dc=com</pre></div><p>
     When the migration is complete, <code class="command">openldap_to_ds</code>
     creates a checklist of post-migration tasks that must be completed.
     It is a best practice to document all of your post-migration steps,
     so that you can reproduce them in your post-production procedures.
     Then test clients and application integrations to the migrated 389 Directory Server
     instance.
   </p><div id="id-1.7.4.5.12.4.18" data-id-title="Develop a rollback plan" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Develop a rollback plan</div><p>
       It is essential to develop a rollback plan in case of any failures.
       This plan should define a successful migration, the tests to determine
       what worked and what needs to be fixed, which steps are critical, what
       can be deferred until later, how to decide when to undo any changes,
       how to undo them with minimal disruption, and which other teams need to be involved.
     </p></div><p>
     Due to the variability of deployments, it is difficult to provide
     a recipe for a successful production migration. Once you have
     thoroughly tested the migration process and verified that you will
     get good results, there are some general steps that will help:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        Lower all hostname/DNS TTLs to 5 minutes 48 hours before the change, to 
        allow a fast rollback to your existing OpenLDAP deployment.
      </p></li><li class="listitem"><p>
        Pause all data synchronization and incoming data processes, so that data 
        in the OpenLDAP environment does not change during the migration process.
      </p></li><li class="listitem"><p>
        Have all 389 Directory Server hosts ready for deployment before the migration.
      </p></li><li class="listitem"><p>
        Have your test migration documentation readily available.
      </p></li></ul></div></section><section class="sect2" id="sec-security-ldap-migrate-plan" data-id-title="Planning your migration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.8.2 </span><span class="title-name">Planning your migration</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-migrate-plan">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_migrate_test.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   As OpenLDAP is a <span class="quote">“<span class="quote">box of parts</span>”</span> and highly customizable, it is
   not possible to prescribe a <span class="quote">“<span class="quote">one size fits all</span>”</span> migration.
   It is necessary to assess your
   current environment and configuration with OpenLDAP and other integrations.
   This includes, and is not limited to:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Replication topology
    </p></li><li class="listitem"><p>
     High availability and load balancer configurations
    </p></li><li class="listitem"><p>
     External data flows (IGA, HR, AD, etc.)
    </p></li><li class="listitem"><p>
     Configured overlays (plug-ins in 389 Directory Server)
    </p></li><li class="listitem"><p>
     Client configuration and expected server features
    </p></li><li class="listitem"><p>
     Customized schema
    </p></li><li class="listitem"><p>
     TLS configuration
    </p></li></ul></div><p>
   Plan what your 389 Directory Server deployment will look like in the end. This includes
   the same list, except replace overlays with plugins. Once you have assessed
   your current environment, and planned what your 389 Directory Server environment will
   look like, you can then form a migration plan. We recommended building
   the 389 Directory Server environment in parallel to your OpenLDAP environment to allow
   switching between them.
  </p><p>
   Migrating from OpenLDAP to 389 Directory Server is a one-way migration. There are enough
   differences between the two that they cannot interoperate, and there is not
   a migration path from 389 Directory Server to OpenLDAP. The following table highlights
   the major similarities and differences.
  </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Feature</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">OpenLDAP</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">389 Directory Server</th><th style="border-bottom: 1px solid ; ">Compatible</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Two-way replication</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SyncREPL</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">389 DS-specific system</td><td style="border-bottom: 1px solid ; ">No</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MemberOf</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Overlay</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Plug-in</td><td style="border-bottom: 1px solid ; ">Yes, simple configurations only</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">External Auth</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Proxy</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-</td><td style="border-bottom: 1px solid ; ">No</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Active Directory Synchronization</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Winsync Plug-in</td><td style="border-bottom: 1px solid ; ">No</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Inbuilt Schema</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OLDAP Schemas</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">389 Schemas</td><td style="border-bottom: 1px solid ; ">Yes, supported by migration tool</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Custom Schema</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OLDAP Schemas</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">389 Schemas</td><td style="border-bottom: 1px solid ; ">Yes, supported by migration tool</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Database Import</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">LDIF</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">LDIF</td><td style="border-bottom: 1px solid ; ">Yes, supported by migration tool</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Password hashes</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Varies</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Varies</td><td style="border-bottom: 1px solid ; ">Yes, all formats supported excluding Argon2</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OpenLDAP to 389 DS replication</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-</td><td style="border-bottom: 1px solid ; ">No mechanism to replicate to 389 DS is possible</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Time-based one-time password (TOTP)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">TOTP overlay</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-</td><td style="border-bottom: 1px solid ; ">No, currently not supported</td></tr><tr><td style="border-right: 1px solid ; ">entryUUID</td><td style="border-right: 1px solid ; ">Part of OpenLDAP</td><td style="border-right: 1px solid ; ">Plug-in</td><td>Yes</td></tr></tbody></table></div></section></section><section class="sect1" id="sec-security-ldap-server-ca" data-id-title="Importing TLS server certificates and keys"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.9 </span><span class="title-name">Importing TLS server certificates and keys</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-server-ca">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_ca.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  You can manage your CA certificates and keys for 389 Directory Server with the following
  command line tools: <code class="command">certutil</code>, <code class="command">openssl</code>, and
  <code class="command">pk12util</code>.
 </p><p>
  For testing purposes, you can use the self-signed certificate that
  <code class="command">dscreate</code> creates when you create a new 389 DS
  instance. Find the certificate at
  <code class="filename">/etc/dirsrv/slapd-<em class="replaceable">INSTANCE-NAME</em>/ca.crt</code>.
  </p><p>
    For production environments, it is a best practice to use a third-party
    certificate authority, such as Let's Encrypt, CAcert.org, SSL.com, or
    whatever CA you choose. Request a server certificate, a client
    certificate, and a root certificate.
  </p><div class="procedure"><div class="procedure-contents"><div id="id-1.7.4.5.13.5.1" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
  The Mozilla NSS (Network Security Services ) toolkit uses nicknames for certificates in the certificate store.
  The server certificate uses the nickname <span class="emphasis"><em>Server-Cert</em></span>.
  </p></div><ol class="procedure" type="1"><li class="step"><p>
   Use the following commands to remove the Self-Signed-CA and Server-Cert from the instance:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> tls remove-cert Self-Signed-CA</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> tls remove-cert Server-Cert
</code></pre></div><p>
   Replace <em class="replaceable">INSTANCE_NAME</em> with the instance name of the directory server.
   This is LDAP1 in the previous sections.
  </p></li><li class="step"><p>
    Import the CA that has signed your certificate.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">sudo dsctl <em class="replaceable">INSTANCE_NAME</em> tls import-ca
   /path/to/CA/in/PEM/format/CA.pem  <em class="replaceable">NICKNAME_FOR_CA</em>
</code></pre></div><p>Replace <code class="literal">INSTANCE_NAME</code> with the instance name of the directory server.
Replace <code class="literal">/path/to/CA/in/PEM/format/CA.pem</code> with the full path to the CA certificate file in the PEM format.
Replace <code class="literal">NICKNAME_FOR_CA </code> with a nickname for the CA. </p></li><li class="step"><p>
   Import the server certificate and the key for the certificate.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> tls import-server-key-cert
  <em class="replaceable">/path/to/SERVER.pem</em> <em class="replaceable">/path/to/SERVER.key</em></code></pre></div><p> Replace <code class="literal">INSTANCE_NAME</code> with the instance name of the directory server.
Replace <code class="literal">/path/to/SERVER.pem</code> with the full path to the server certificate in PEM format.
Replace <code class="literal">/path/to/SERVER.key</code> with the full path to the server certificate key file in the PEM format.
</p></li><li class="step"><p>
   Restart the instance so that the new certificates are used.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl restart dirsrv@<em class="replaceable">INSTANCE-NAME.</em>.service
</code></pre></div><p>Replace  <code class="literal">INSTANCE_NAME</code> with the instance name of the directory server.</p></li></ol></div></div></section><section class="sect1" id="sec-security-ldap-replication" data-id-title="Setting up replication"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.10 </span><span class="title-name">Setting up replication</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  389 Directory Server supports replicating its database content between multiple servers.
  According to the type of replication, this provides:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Faster performance and response times
   </p></li><li class="listitem"><p>
    Fault tolerance and failover
   </p></li><li class="listitem"><p>
    Load balancing
   </p></li><li class="listitem"><p>
    High availability
   </p></li></ul></div><p>
   A database is the smallest unit of a directory that can be replicated. You
   can replicate an entire database, but not a subtree within a database.
   One database must correspond to one suffix. You cannot replicate a suffix
   that is distributed over two or more databases.
 </p><p>
   A replica that sends data to another replica is a supplier. A replica
   that receives data from a supplier is a consumer. Replication is always
   initiated by the supplier, and a single supplier can send data to multiple
   consumers. Usually the supplier
   is a read-write replica, and the consumer is read-only, except in the
   case of multi-supplier replication. In multi-supplier replication the
   suppliers are both suppliers and consumers of the same data.
 </p><section class="sect2" id="sec-security-ldap-replication-async" data-id-title="Asynchronous writes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.1 </span><span class="title-name">Asynchronous writes</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-async">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   389 DS manages replication differently than other databases. Replication
   is asynchronous, and eventually consistent. This means:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Any write or change to a single server is immediately accepted.
    </p></li><li class="listitem"><p>
     There is a delay between a write finishing on one
     server, and then replicating and being visible on other servers.
    </p></li><li class="listitem"><p>
     If that write conflicts with writes on other servers, it may be rolled
     back at some point in the future.
    </p></li><li class="listitem"><p>
     Not all servers may show identical content at the same time due to
     replication delay.
    </p></li></ul></div><p>
   In general, as LDAP is "low-write", these factors mean that all servers are
   at least up to a common baseline of a known consistent state. Small changes
   occur on top of this baseline, so many of these aspects of delayed
   replication are not perceived in day to day usage.
  </p></section><section class="sect2" id="sec-security-ldap-replication-topology" data-id-title="Designing your topology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.2 </span><span class="title-name">Designing your topology</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-topology">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Consider the following factors when you are designing your replication
   topology.
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     The need for replication: high availability, geo-location, read scaling,
     or a combination of all.
    </p></li><li class="listitem"><p>
     How many replicas (nodes, servers) you plan to have in your topology.
    </p></li><li class="listitem"><p>
     Direction of data flows, both inside of the topology, and data flowing
     into the topology.
    </p></li><li class="listitem"><p>
     How clients will balance across nodes of the topology for their requests
     (multiple ldap URIs, SRV records, load balancers).
    </p></li></ul></div><p>
   These factors all affect how you may create your topology. (See
   <a class="xref" href="#sec-security-ldap-replication-topologies" title="5.10.3. Example replication topologies">Section 5.10.3, “Example replication topologies”</a> for some
   topology examples.)
  </p></section><section class="sect2" id="sec-security-ldap-replication-topologies" data-id-title="Example replication topologies"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.3 </span><span class="title-name">Example replication topologies</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-topologies">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following sections provide examples of replication topologies, using two
   to six 389 Directory Server nodes. The maximum number of supported supplier replicas in
   a topology is 20. Operational experience shows the optimal number for
   replication efficiency is a maximum of eight.
  </p><section class="sect3" id="sec-security-ldap-replication-two-replicas" data-id-title="Two replicas"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.3.1 </span><span class="title-name">Two replicas</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-two-replicas">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><div class="example" id="ex-ldap-replication-two-replicas" data-id-title="Two supplier replicas"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.4: </span><span class="title-name">Two supplier replicas </span></span><a title="Permalink" class="permalink" href="#ex-ldap-replication-two-replicas">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">┌────┐       ┌────┐
│ S1 │◀─────▶│ S2 │
└────┘       └────┘</pre></div></div></div><p>
    In <a class="xref" href="#ex-ldap-replication-two-replicas" title="Two supplier replicas">Example 5.4, “Two supplier replicas”</a> there are two replicas,
    S1 and S2, which replicate bi-directionally between each other, so they
    are both suppliers and consumers. S1 and S2
    could be in separate data centers, or in the same data center. Clients can
    balance across the servers using LDAP URIs, a load balancer, or DNS SRV
    records. This is the simplest topology for high availability. Note that
    each server needs to be able to provide 100% of client load, in case the
    other server is offline for any reason. A two-node replication is
    generally not adequate for horizontal read scaling, as a single node will
    handle all read requests if the other node is offline.
   </p><div id="id-1.7.4.5.14.8.3.4" data-id-title="Default topology" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Default topology</div><p>
       The two-node topology should be considered the default topology,
       because it is the simplest to manage. You can expand your toplogy,
       over time, as necessary.
     </p></div></section><section class="sect3" id="sec-security-ldap-replication-four-replicas" data-id-title="Four supplier replicas"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.3.2 </span><span class="title-name">Four supplier replicas</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-four-replicas">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><div class="example" id="ex-ldap-replication-four-replicas" data-id-title="Four supplier replicas"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.5: </span><span class="title-name">Four supplier replicas </span></span><a title="Permalink" class="permalink" href="#ex-ldap-replication-four-replicas">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">┌────┐       ┌────┐
│ S1 │◀─────▶│ S2 │
└────┘       └────┘
   ▲            ▲
   │            │
   ▼            ▼
┌────┐       ┌────┐
│ S3 │◀─────▶│ S4 │
└────┘       └────┘</pre></div></div></div><p>
    <a class="xref" href="#ex-ldap-replication-four-replicas" title="Four supplier replicas">Example 5.5, “Four supplier replicas”</a> has four supplier
    replicas, which all synchronize to each other. These
    could be in four datacenters, or two servers per datacenter. In the case of
    one node per data center, each node should be able to support 100% of
    client load. When there are two per datacenter, each one only needs to
    scale to 50% of the client load.
   </p></section><section class="sect3" id="sec-security-ldap-replication-six-replicas" data-id-title="Six replicas"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.3.3 </span><span class="title-name">Six replicas</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-six-replicas">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><div class="example" id="ex-ldap-replication-six-replicas" data-id-title="Six replicas"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.6: </span><span class="title-name">Six replicas </span></span><a title="Permalink" class="permalink" href="#ex-ldap-replication-six-replicas">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">                  ┌────┐       ┌────┐
                  │ S1 │◀─────▶│ S2 │
                  └────┘       └────┘
                     ▲            ▲
                     │            │
   ┌────────────┬────┴────────────┴─────┬────────────┐
   │            │                       │            │
   ▼            ▼                       ▼            ▼
┌────┐       ┌────┐                  ┌────┐       ┌────┐
│ S3 │◀─────▶│ S4 │                  │ S5 │◀─────▶│ S6 │
└────┘       └────┘                  └────┘       └────┘</pre></div></div></div><p>
    In <a class="xref" href="#ex-ldap-replication-six-replicas" title="Six replicas">Example 5.6, “Six replicas”</a>, each pair is in a
    separate location. S1 and S2 are the suppliers, and S3, S4, S5, and
    S6 are consumers of S1 and S2. Each pair of servers replicate to each
    other. S3, S4, S5, and S6 can accept writes, though most of the
    replication is done through S1 and S2. This setup provides geographic
    separation for high availability and scaling.
   </p></section><section class="sect3" id="sec-security-ldap-replication-six-replicas-read-only" data-id-title="Six replicas with read-only consumers"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.3.4 </span><span class="title-name">Six replicas with read-only consumers</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-six-replicas-read-only">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><div class="example" id="ex-ldap-replication-six-replicas-read-only" data-id-title="Six replicas with read-only consumers"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.7: </span><span class="title-name">Six replicas with read-only consumers </span></span><a title="Permalink" class="permalink" href="#ex-ldap-replication-six-replicas-read-only">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">             ┌────┐       ┌────┐
             │ S1 │◀─────▶│ S2 │
             └────┘       └────┘
                │            │
                │            │
   ┌────────────┼────────────┼────────────┐
   │            │            │            │
   ▼            ▼            ▼            ▼
┌────┐       ┌────┐       ┌────┐       ┌────┐
│ S3 │       │ S4 │       │ S5 │       │ S6 │
└────┘       └────┘       └────┘       └────┘</pre></div></div></div><p>
    In <a class="xref" href="#ex-ldap-replication-six-replicas-read-only" title="Six replicas with read-only consumers">Example 5.7, “Six replicas with read-only consumers”</a>, S1 and S2 are the suppliers, and the other four
    servers are read-only consumers. All changes occur on S1 and S2, and are
    propagated to the four replicas. Read-only consumers can be configured to
    store only a subset of the database, or partial entries, to limit data
    exposure. You could have a fractional read-only server in a DMZ, for
    example, so that if data is exposed, changes can not propagate back to
    the other replicas.
   </p></section></section><section class="sect2" id="sec-security-ldap-replication-terminology" data-id-title="Terminology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.4 </span><span class="title-name">Terminology</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-terminology">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In the example topologies we have seen that 389 DS can take on a
   number of roles in a topology. The following list clarifies the terminology.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.5.14.9.3.1"><span class="term">Replica</span></dt><dd><p>
      An instance of 389 DS with an attached database.
     </p></dd><dt id="id-1.7.4.5.14.9.3.2"><span class="term">Read-write replica</span></dt><dd><p>
      A replica with a full copy of a database, that accepts read and write
      operations.
     </p></dd><dt id="id-1.7.4.5.14.9.3.3"><span class="term">Read-only replica</span></dt><dd><p>
      A replica with a full copy of a database, that only accepts read
      operations.
     </p></dd><dt id="id-1.7.4.5.14.9.3.4"><span class="term">Fractional read-only replica</span></dt><dd><p>
      A replica with a partial copy of a database, that only accepts read-
      only operations.
     </p></dd><dt id="id-1.7.4.5.14.9.3.5"><span class="term">Supplier</span></dt><dd><p>
      A replica that supplies data from its database to another replica.
     </p></dd><dt id="id-1.7.4.5.14.9.3.6"><span class="term">Consumer</span></dt><dd><p>
      A replica that receives data from another replica to write into its
      database.
     </p></dd><dt id="id-1.7.4.5.14.9.3.7"><span class="term">Replication agreement</span></dt><dd><p>
      The configuration of a server defining its supplier and consumer relation
      to another replica.
     </p></dd><dt id="id-1.7.4.5.14.9.3.8"><span class="term">Topology</span></dt><dd><p>
      A set of replicas connected via replication agreements.
     </p></dd><dt id="id-1.7.4.5.14.9.3.9"><span class="term">Replica ID</span></dt><dd><p>
      A unique identifier of the 389 Directory Server instance within the replication
      topology.
     </p></dd><dt id="id-1.7.4.5.14.9.3.10"><span class="term">Replication manager</span></dt><dd><p>
      An account with replication rights in the directory.
     </p></dd></dl></div></section><section class="sect2" id="sec-security-ldap-replication-configuration" data-id-title="Configuring replication"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.5 </span><span class="title-name">Configuring replication</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-configuration">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The first example sets up a two node bi-directional replication with a
   single read-only server, as a minimal starting example. In the following
   examples, the host names of the two read-write nodes are RW1 and RW2, and
   the read-only server is RO1. (Of course you must use your own host names.)
   </p><p>
   All servers should have a backend with an identical suffix. Only one server,
   RW1, needs an initial copy of the database.
  </p><section class="sect3" id="sec-security-ldap-replication-two-nodes" data-id-title="Configuring two-node replication"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.5.1 </span><span class="title-name">Configuring two-node replication</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-two-nodes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following commands configure the read-write replicas in a two-node setup
    (<a class="xref" href="#ex-ldap-replication-two-replicas" title="Two supplier replicas">Example 5.4, “Two supplier replicas”</a>), with the hostnames
    RW1 and RW2. (Remember to use your own hostnames.)
  </p><div id="id-1.7.4.5.14.10.4.3" data-id-title="Create a strong replication manager password" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Create a strong replication manager password</div><p>
    The replication manager should be considered equivalent to the
    directory manager, in terms of security and access, and should
    have a very strong password.
  </p><p>
    If you create different replication manager passwords for each server,
    be sure to keep track of which password belongs to which server. For
    example, when you configure the outbound connection in RW1's replication agreement,
    you need to set the replication manager password to the RW2 replication manager password.
  </p></div><p>
First, configure RW1:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> replication create-manager</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> replication enable</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em></code> \
<code class="command">--role supplier --replica-id <em class="replaceable">1</em> --bind-dn "cn=replication manager,cn=config"</code></pre></div><p>
   Configure RW2:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> replication create-manager</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> replication enable</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em></code> \
<code class="command">--role supplier --replica-id <em class="replaceable">2</em> --bind-dn "cn=replication manager,cn=config"</code></pre></div><p>
   This will create the replication metadata required on RW1 and RW2. Note the
   difference in the <code class="option">replica-id</code> between the two servers. This
   also creates the replication manager account, which is an account with
   replication rights for authenticating between the two nodes.
  </p><p>
   RW1 and RW2 are now both configured to have replication metadata. The next
   step is to create the first agreement for outbound data from RW1 to RW2.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-agmt create</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em></code> \
<code class="command">--host=<em class="replaceable">RW2</em> --port=636 --conn-protocol LDAPS --bind-dn "cn=replication manager,cn=config"</code> \
<code class="command">--bind-passwd <em class="replaceable">PASSWORD</em> --bind-method SIMPLE <em class="replaceable">RW1_to_RW2</em></code></pre></div><p>
   Data will not flow from RW1 to RW2 until after a full synchronization
   of the database, which is called an initialization or reinit. This will
   reset all database content on RW2 to match the content of RW1. Run the
   following command to trigger a reinit of the data:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-agmt init</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em> <em class="replaceable">RW1_to_RW2</em></code></pre></div><p>
   Check the status by running this command on RW1:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-agmt init-status</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em> <em class="replaceable">RW1_to_RW2</em></code></pre></div><p>
   When it is finished, you should see an "Agreement successfully initialized"
   message. If you get an error message, check the errors log. Otherwise, you
   should see the identical content from RW1 on RW2.
  </p><p>
   Finally, to make this bi-directional, configure a replication agreement
   from RW2 outbound to RW1:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-agmt create</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em></code> \
<code class="command">--host=<em class="replaceable">RW1</em> --port=636 --conn-protocol LDAPS</code> \
<code class="command">--bind-dn "cn=replication manager,cn=config" --bind-passwd <em class="replaceable">PASSWORD</em></code> \
<code class="command">--bind-method SIMPLE <em class="replaceable">RW2_to_RW1</em></code></pre></div><p>
   Changes made on either RW1 or RW2 will now be replicated to the other. Check
   replication status on either server with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-agmt status</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em></code> \
<code class="command">--bind-dn "cn=replication manager,cn=config"</code> \
<code class="command">--bind-passwd <em class="replaceable">PASSWORD</em> <em class="replaceable">RW2_to_RW1</em></code></pre></div></section><section class="sect3" id="sec-security-ldap-replication-four-nodes" data-id-title="Configuring a read-only node"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.5.2 </span><span class="title-name">Configuring a read-only node</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-four-nodes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To create a read-only node, start by creating the replication
   manager account and metadata. The hostname of the example server
   is RO3:
 </p><div id="id-1.7.4.5.14.10.5.3" data-id-title="Create a strong replication manager password" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Create a strong replication manager password</div><p>
    The replication manager should be considered equivalent to the
    directory manager, in terms of security and access, and should
    have a very strong password.
  </p><p>
    If you create different replication manager passwords for each server,
    be sure to keep track of which password belongs to which server. For
    example, when you configure the outbound connection in RW1's replication agreement,
    you need to set the replication manager password to the RW2 replication manager password.
  </p></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> replication create-manager</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command"> dsconf <em class="replaceable">INSTANCE_NAME</em></code> \
<code class="command">replication enable --suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em></code> \
<code class="command">--role consumer --bind-dn "cn=replication manager,cn=config"</code></pre></div><p>
  Note that for a read-only replica, you do not provide a replica-id, and the
  role is set to <code class="literal">consumer</code>. This allocates a
  special read-only replica-id for all read-only replicas. After the read-only
  replica is created, add the replication agreements from RW1 and RW2
  to the read-only instance. The following example is on RW1:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em></code> \
<code class="command">repl-agmt create --suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em></code> \
<code class="command">--host=<em class="replaceable">RO3</em> --port=636 --conn-protocol LDAPS</code> \
<code class="command">--bind-dn "cn=replication manager,cn=config" --bind-passwd <em class="replaceable">PASSWORD</em></code>
<code class="command">--bind-method SIMPLE <em class="replaceable">RW1_to_RO3</em></code></pre></div><p>
  The following example, on RW2, configures the replication agreement between RW2 and
  RO3:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt create</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em></code> \
<code class="command">--host=<em class="replaceable">RO3</em> --port=636 --conn-protocol LDAPS</code> \
<code class="command">--bind-dn "cn=replication manager,cn=config" --bind-passwd <em class="replaceable">PASSWORD</em></code> \
<code class="command">--bind-method SIMPLE <em class="replaceable">RW2_to_RO3</em></code></pre></div><p>
  After these steps are completed, you can use either RW1 or RW2 to perform
  the initialization of the database on RO3. The following example
  initalizes RO3 from RW2:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt init</code>
<code class="command">--suffix dc=<em class="replaceable">EXAMPLE,dc=COM</em> <em class="replaceable">RW2_to_RO3</em></code></pre></div></section></section><section class="sect2" id="sec-security-ldap-replication-monitoring-healthcheck" data-id-title="Monitoring and healthcheck"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.6 </span><span class="title-name">Monitoring and healthcheck</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-monitoring-healthcheck">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The <code class="command">dsconf</code> command includes a monitoring option. You can check the status of each
  replica status directly on the replicas, or from other hosts. The following example commands are run on RW1,
  checking the status on two remote replicas, and then on itself:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf -D "cn=Directory Manager" ldap://<em class="replaceable">RW2</em> replication monitor</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf -D "cn=Directory Manager" ldap://<em class="replaceable">RO3</em> replication monitor</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf -D "cn=Directory Manager" ldap://<em class="replaceable">RW1</em> replication monitor</code></pre></div><p>
  The <code class="command">dsctl</code> command has a <code class="option">healthcheck</code> option. The following
  example runs a replication healthcheck on the local 389 DS instance:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> healthcheck --check replication</code></pre></div><p>
  Use the <code class="option">-v</code> option for verbosity, to see what the healthcheck examines:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl -v <em class="replaceable">INSTANCE_NAME</em> healthcheck --check replication</code></pre></div><p>
  Run <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> healthcheck</code>
  with no options for a general health check.
</p><p>
  Run the following command to see a list of the checks that healthcheck
  performs:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> healthcheck --list-checks</code>
config:hr_timestamp
config:passwordscheme
backends:userroot:cl_trimming
backends:userroot:mappingtree
backends:userroot:search
backends:userroot:virt_attrs
encryption:check_tls_version
fschecks:file_perms
[...]</pre></div><p>
  You can run one or more of the individual checks:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> healthcheck</code> \
<code class="command">--check monitor-disk-space:disk_space tls:certificate_expiration</code></pre></div></section><section class="sect2" id="sec-security-ldap-replication-backups" data-id-title="Making backups"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.7 </span><span class="title-name">Making backups</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-backups">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When replication is
   enabled, you need to adjust your 389 Directory Server backup strategy
   (see <a class="xref" href="#sec-security-ldap-backup" title="5.4. Backing up and restoring 389 Directory Server">Section 5.4, “Backing up and restoring 389 Directory Server”</a> to learn about
   making backups). If you are using
   <code class="command">db2ldif</code>, you must add the <code class="option">--replication</code> flag
   to ensure that replication
   metadata is backed up. You should backup all servers in the topology. When
   restoring from backup, start by restoring a single node of the topology, then
   reinitialize all other nodes as new instances.
 </p></section><section class="sect2" id="sec-security-ldap-replication-pause-resume" data-id-title="Pausing and resuming replication"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.8 </span><span class="title-name">Pausing and resuming replication</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-pause-resume">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can pause replication during maintenance windows, or anytime you need to
    stop it. A node of the topology can only be offline for a maximum of days
    up to the limit of the changelog
    (see <a class="xref" href="#sec-security-ldap-replication-changelog" title="5.10.9.  Changelog max-age">Section 5.10.9, “ Changelog max-age”</a>).
  </p><p>
    Use the <code class="command">repl-agmt</code> command to pause replication. The
    following example is on RW2:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt disable</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> <em class="replaceable">RW2_to_RW1</em></code></pre></div><p>
  The following example re-enables replication:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt enable</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> <em class="replaceable">RW2_to_RW1</em></code></pre></div></section><section class="sect2" id="sec-security-ldap-replication-changelog" data-id-title="Changelog max-age"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.9 </span><span class="title-name"> Changelog max-age</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-changelog">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A replica can be offline for up to the length of time defined by
   the changelog <code class="option">max-age</code> option. <code class="option">max-age</code>
   defines the maximum age of any entry in the changelog. Any items older
   than the <code class="option">max-age</code> value are automatically removed.
 </p><p>
   After the replica comes back online, it will synchronize with the other
   replicas. If it is offline for longer than the <code class="option">max-age</code> value,
   the replica will need to be re-initialised, and will refuse to accept or
   provide changes to other nodes, as they may be inconsistent. The following
   example sets the <code class="option">max-age</code> to seven days:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em></code> \
<code class="command">replication set-changelog --max-age 7d</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em></code></pre></div></section><section class="sect2" id="sec-security-ldap-replication-remove-replica" data-id-title="Removing a replica"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.10 </span><span class="title-name">Removing a replica</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-remove-replica">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To remove a replica, first fence the node to prevent any incoming changes
   or reads. Then, find all servers that have incoming replication agreements
   with the node you are removing, and remove them. The following example
   removes RW2. Start by disabling the outbound replication agreement on RW1:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt delete</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> <em class="replaceable">RW1_to_RW2</em></code></pre></div><p>
  On the replica you are removing, which in the following example is RW2, remove all outbound agreements:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt delete</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> <em class="replaceable">RW2_to_RW1</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt delete</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> <em class="replaceable">RW2_to_RO3</em></code></pre></div><p>
  Stop the instance on RW2:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl stop dirsrv@<em class="replaceable">INSTANCE_NAME</em>.service</code></pre></div><p>
  Then run the <code class="command">cleanallruv</code> command to remove the replica ID from the topology.
  The following example is run on RW1:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-tasks cleanallruv</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> --replica-id <em class="replaceable">2</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-tasks list-cleanruv-tasks</code></pre></div></section><section class="sect2" id="sec-security-ldap-replication-limits" data-id-title="Limitations on replication of 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.11 </span><span class="title-name">Limitations on replication of 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-replication-limits">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The use of 389 Directory Server is supported within the following replication limits:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     A maximum of 8 read-write nodes
    </p></li><li class="listitem"><p>
     A maximum of 20 replication hubs
    </p></li><li class="listitem"><p>
     A maximum of 100 read-only servers
    </p></li><li class="listitem"><p>
     A maximum of 1 Winsync Active Directory consumer as a read-write node member
    </p></li></ul></div></section></section><section class="sect1" id="sec-security-ldap-active-directory-sync" data-id-title="Synchronizing with Microsoft Active Directory"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.11 </span><span class="title-name">Synchronizing with Microsoft Active Directory</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-active-directory-sync">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_active_directory_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    389 Directory Server supports synchronizing some user and group content
    from Microsoft's Active Directory, so that Linux clients can use
    389 DS for their identity information without the normally required
    domain join process. This also allows 389 DS to extend and use its
    other features with the data synchronised from Active Directory.
  </p><section class="sect2" id="sec-security-ldap-synchronization-planning" data-id-title="Planning your synchronization topology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.11.1 </span><span class="title-name">Planning your synchronization topology</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-synchronization-planning">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_active_directory_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Due to how the synchronization works, only a single 389 Directory Server and
    Active Directory server are involved. The Active Directory server must be a full Domain
    Controller, and not a Read Only Domain Controller (RODC).
    The Global Catalog is not required on the DC that is synchronized, as
    389 DS only replicates the content of a single forest in a domain.
  </p><p>
    You must first chooose the direction of your data flow. There are three
    options: from AD to 389 DS, from 389 DS to AD, or bi-
    directional.
  </p><div id="id-1.7.4.5.15.3.4" data-id-title="No password synchronization" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: No password synchronization</div><p>
      Passwords cannot be synchronised between 389 DS and Active Directory.
      This may change in the future, to support Active Directory to 389 DS password
      flow.
    </p></div><p>
      Your topology will look like the following diagram. The 389 Directory Server and
      Active Directory topologies may differ, but the most important factor is to have
      only a single connection between 389 DS and Active Directory. It is very
      important to account for this in your disaster recovery and backup
      plans for both 389 DS and AD, to ensure that you correctly restore
      only a single replication connection between these topologies.
    </p><div class="verbatim-wrap"><pre class="screen">┌────────┐     ┌────────┐         ┌────────┐     ┌────────┐
│        │     │        │         │        │     │        │
│ 389-ds │◀───▶│ 389-ds │◀ ─ ─ ─ ▶│   AD   │◀───▶│   AD   │
│        │     │        │         │        │     │        │
└────────┘     └────────┘         └────────┘     └────────┘
    ▲               ▲                  ▲             ▲
    │               │                  │             │
    ▼               ▼                  ▼             ▼
┌────────┐     ┌────────┐         ┌────────┐     ┌────────┐
│        │     │        │         │        │     │        │
│ 389-ds │◀───▶│ 389-ds │         │   AD   │◀───▶│   AD   │
│        │     │        │         │        │     │        │
└────────┘     └────────┘         └────────┘     └────────┘</pre></div></section><section class="sect2" id="sec-security-ldap-synchronization-ad-prerequisites" data-id-title="Prerequisites for Active Directory"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.11.2 </span><span class="title-name">Prerequisites for Active Directory</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-synchronization-ad-prerequisites">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_active_directory_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A security group that is granted the "Replicating Directory Changes"
    permission is required. For example, you have created a group named
    "Directory Server Sync". Follow the steps in the "How to grant the
    'Replicating Directory Changes' permission for the Microsoft Metadirectory Services ADMA service account"
    (<a class="link" href="https://docs.microsoft.com/en-US/troubleshoot/windows-server/windows-security/grant-replicating-directory-changes-permission-adma-service" target="_blank">https://docs.microsoft.com/en-US/troubleshoot/windows-server/windows-security/grant-replicating-directory-changes-permission-adma-service</a> to set this up.
  </p><div id="id-1.7.4.5.15.4.3" data-id-title="Strong security needed" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Strong security needed</div><p>
      You should consider members of this group to be of equivalent security
      importance to Domain Administrators. Members of this group have the
      ability to read sensitive content from the Active Directory
      environment, so you should use strong, randomly-generated service
      account passwords for these accounts, and carefully audit membership to this group.
    </p></div><p>
    You should also create a service account that is a member of this group.
  </p><p>
    Your Active Directory environment must have certificates configured for LDAPS to
    ensure that authentication between 389 DS and AD is secure.
    Authentication with Generic Security Services API/Kerberos (GSSAPI/KRB)
    cannot be used.
  </p></section><section class="sect2" id="sec-security-ldap-synchronization-389ds-prerequisites" data-id-title="Prerequisites for 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.11.3 </span><span class="title-name">Prerequisites for 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-synchronization-389ds-prerequisites">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_active_directory_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The 389 Directory Server must have a backend database already configured with
    Organization Units (OUs) for entries to be synchronised into.
  </p><p>
    The 389 Directory Server must have a replica ID configured as though the server
    is a read-write replica. (For details about setting up replication see
    <a class="xref" href="#sec-security-ldap-replication" title="5.10. Setting up replication">Section 5.10, “Setting up replication”</a>).
  </p></section><section class="sect2" id="sec-security-ldap-synchronization-agreement" data-id-title="Creating an agreement from Active Directory to 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.11.4 </span><span class="title-name">Creating an agreement from Active Directory to 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-synchronization-agreement">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_active_directory_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following example command, which is run on the 389 Directory Server,
    creates a replication agreement from Active Directory to 389 Directory Server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt create --suffix <em class="replaceable">dc=example,dc=com</em></code> \
  <code class="command">--host <em class="replaceable">AD-HOSTNAME</em> --port 636 --conn-protocol LDAPS</code> \
  --bind-dn <code class="command">"<em class="replaceable">cn=SERVICE-ACCOUNT,cn=USERS,dc=AD,dc=EXAMPLE,dc=COM</em>"</code> \
  <code class="command">--bind-passwd "<em class="replaceable">PASSWORD</em>" --win-subtree "<em class="replaceable">cn=USERS,dc=AD,dc=EXAMPLE,dc=COM</em>"</code> \
  <code class="command">--ds-subtree <em class="replaceable">ou=AD,dc=EXAMPLE,dc=COM</em> --one-way-sync fromWindows</code> \
  <code class="command">--sync-users=on --sync-groups=on --move-action delete</code> \
  <code class="command">--win-domain <em class="replaceable">AD-DOMAIN</em> adsync_agreement</code></pre></div><p>
  Once the agreement has been created, you must perform an initial resynchronization:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt init --suffix <em class="replaceable">dc=example,dc=com</em> adsync_agreement</code></pre></div><p>
  Use the following command to check the status of the initialization:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt init-status --suffix <em class="replaceable">dc=example,dc=com</em> adsync_agreement</code></pre></div><div id="id-1.7.4.5.15.6.8" data-id-title="Some entries are not synchronized" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Some entries are not synchronized</div><p>
    In some cases, an entry may not be synchronized, even if the init status reports success. Check your 389 DS log files in
    <code class="filename">/var/log/dirsrv/slapd-INSTANCE-NAME/errors</code>.
  </p></div><p>
    Check the status of the agreement with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt status --suffix <em class="replaceable">dc=example,dc=com</em> adsync_agreement</code></pre></div><p>
    Whe you are performing maintenance on the Active Directory or 389 Directory Server topology, you
    can pause the agreement with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt disable --suffix <em class="replaceable">dc=example,dc=com</em> adsync_agreement</code></pre></div><p>
    Resume the agreement with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt enable --suffix <em class="replaceable">dc=example,dc=com</em> adsync_agreement</code></pre></div></section></section><section class="sect1" id="sec-security-ldap-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.12 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-security-ldap-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For more information about 389 Directory Server, see:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The upstream documentation at
      <a class="link" href="https://www.port389.org/docs/389ds/documentation.html" target="_blank">https://www.port389.org/docs/389ds/documentation.html</a>.
    </p></li><li class="listitem"><p>
      man dsconf
    </p></li><li class="listitem"><p>
      man dsctl
    </p></li><li class="listitem"><p>
      man dsidm
    </p></li><li class="listitem"><p>
      man dscreate
    </p></li></ul></div></section></section><section class="chapter" id="cha-security-kerberos" data-id-title="Network authentication with Kerberos"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">6 </span><span class="title-name">Network authentication with Kerberos</span></span> <a title="Permalink" class="permalink" href="#cha-security-kerberos">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Kerberos is a network authentication protocol which also provides encryption.
    This chapter describes how to set up Kerberos and integrate services like LDAP
    and NFS.
   </p></div></div></div></div><section class="sect1" id="sec-security-kerberos-overview" data-id-title="Conceptual overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.1 </span><span class="title-name">Conceptual overview</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-overview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   An open network provides no means of ensuring that a workstation can
   identify its users properly, except through the usual password mechanisms.
   In common installations, the user must enter the password each time a
   service inside the network is accessed. Kerberos provides an authentication
   method with which a user registers only once and is trusted in the complete
   network for the rest of the session. To have a secure network, the following
   requirements must be met:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Have all users prove their identity for each desired service and make sure
     that no one can take the identity of someone else.
    </p></li><li class="listitem"><p>
     Make sure that each network server also proves its identity. Otherwise an
     attacker might be able to impersonate the server and obtain sensitive
     information transmitted to the server. This concept is called
     <span class="emphasis"><em>mutual authentication</em></span>, because the client
     authenticates to the server and vice versa.
    </p></li></ul></div><p>
   Kerberos helps you meet these requirements by providing strongly encrypted
   authentication. Only the basic principles of Kerberos are discussed here. For
   detailed technical instruction, refer to the Kerberos documentation.
  </p></section><section class="sect1" id="sec-security-kerberos-terms" data-id-title="Kerberos terminology"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.2 </span><span class="title-name">Kerberos terminology</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-terms">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following glossary defines some Kerberos terminology.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.6.4.3.1"><span class="term">credential</span></dt><dd><p>
      Users or clients need to present some kind of credentials that authorize
      them to request services. Kerberos knows two kinds of
      credentials—tickets and authenticators.
     </p></dd><dt id="id-1.7.4.6.4.3.2"><span class="term">ticket</span></dt><dd><p>
      A ticket is a per-server credential used by a client to authenticate at a
      server from which it is requesting a service. It contains the name of the
      server, the client's name, the client's Internet address, a time stamp, a
      lifetime, and a random session key. All this data is encrypted using the
      server's key.
     </p></dd><dt id="id-1.7.4.6.4.3.3"><span class="term">authenticator</span></dt><dd><p>
      Combined with the ticket, an authenticator is used to prove that the
      client presenting a ticket is really the one it claims to be. An
      authenticator is built using the client's name, the workstation's IP
      address, and the current workstation's time, all encrypted with the
      session key known only to the client and the relevant server. An
      authenticator can only be used once, unlike a ticket. A client can build
      an authenticator itself.
     </p></dd><dt id="id-1.7.4.6.4.3.4"><span class="term">principal</span></dt><dd><p>
      A Kerberos principal is a unique entity (a user or service) to which it can
      assign a ticket. A principal consists of the following components:
     </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">USER</em>/<em class="replaceable">INSTANCE</em>@<em class="replaceable">REALM</em></pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title">primary:</span>
         The first part of the principal. In the case of users, this is usually
         the same as the user name.
        </p></li><li class="listitem"><p><span class="formalpara-title">instance <span class="emphasis"><em>(optional)</em></span>:</span>
         Additional information characterizing the
         <span class="emphasis"><em>primary</em></span>. This string is separated from the
         <span class="emphasis"><em>primary</em></span> by a <code class="literal">/</code>.
        </p><p>
        <code class="literal">tux@example.org</code> and
        <code class="literal">tux/admin@example.org</code> can both exist on the same
        Kerberos system and are treated as different principals.
       </p></li><li class="listitem"><p><span class="formalpara-title">realm:</span>
         Specifies the Kerberos realm. Normally, your realm is your domain name in
         uppercase letters.
        </p></li></ul></div></dd><dt id="id-1.7.4.6.4.3.5"><span class="term">mutual authentication</span></dt><dd><p>
      Kerberos ensures that both client and server can be sure of each other's
      identity. They share a session key, which they can use to communicate
      securely.
     </p></dd><dt id="id-1.7.4.6.4.3.6"><span class="term">session key</span></dt><dd><p>
      Session keys are temporary private keys generated by Kerberos. They are
      known to the client and used to encrypt the communication between the
      client and the server for which it requested and received a ticket.
     </p></dd><dt id="id-1.7.4.6.4.3.7"><span class="term">replay</span></dt><dd><p>
      Almost all messages sent in a network can be eavesdropped, stolen, and
      resent. In the Kerberos context, this would be most dangerous if an attacker
      manages to obtain your request for a service containing your ticket and
      authenticator. The attacker could then try to resend it
      (<span class="emphasis"><em>replay</em></span>) to impersonate you. However, Kerberos
      implements several mechanisms to deal with this problem.
     </p></dd><dt id="id-1.7.4.6.4.3.8"><span class="term">server or service</span></dt><dd><p>
      <span class="emphasis"><em>Service</em></span> is used to refer to a specific action to
      perform. The process behind this action is called a
      <span class="emphasis"><em>server</em></span>.
     </p></dd></dl></div></section><section class="sect1" id="sec-security-kerberos-how" data-id-title="How Kerberos works"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.3 </span><span class="title-name">How Kerberos works</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-how">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Kerberos is often called a third-party trusted authentication service, which
   means all its clients trust Kerberos's judgment of another client's identity.
   Kerberos keeps a database of all its users and their private keys.
  </p><p>
   To ensure Kerberos is working correctly, run both the authentication and
   ticket-granting server on a dedicated machine. Make sure that only the
   administrator can access this machine physically and over the network.
   Reduce the (networking) services running on it to the absolute
   minimum—do not even run <code class="systemitem">sshd</code>.
  </p><section class="sect2" id="sec-security-kerberos-how-contact" data-id-title="First contact"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.3.1 </span><span class="title-name">First contact</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-how-contact">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Your first contact with Kerberos is quite similar to any login procedure at a
    normal networking system. Enter your user name. This piece of information
    and the name of the ticket-granting service are sent to the authentication
    server (Kerberos). If the authentication server knows you, it generates a
    random session key for further use between your client and the
    ticket-granting server. Now the authentication server prepares a ticket for
    the ticket-granting server. The ticket contains the following
    information—all encrypted with a session key only the authentication
    server and the ticket-granting server know:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The names of both, the client and the ticket-granting server
     </p></li><li class="listitem"><p>
      The current time
     </p></li><li class="listitem"><p>
      A lifetime assigned to this ticket
     </p></li><li class="listitem"><p>
      The client's IP address
     </p></li><li class="listitem"><p>
      The newly-generated session key
     </p></li></ul></div><p>
    This ticket is then sent back to the client together with the session key,
    again in encrypted form, but this time the private key of the client is
    used. This private key is only known to Kerberos and the client, because it is
    derived from your user password. Now that the client has received this
    response, you are prompted for your password. This password is converted
    into the key that can decrypt the package sent by the authentication
    server. The package is <span class="quote">“<span class="quote">unwrapped</span>”</span> and password and key are
    erased from the workstation's memory. As long as the lifetime given to the
    ticket used to obtain other tickets does not expire, your workstation can
    prove your identity.
   </p></section><section class="sect2" id="sec-security-kerberos-how-request" data-id-title="Requesting a service"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.3.2 </span><span class="title-name">Requesting a service</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-how-request">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To request a service from any server in the network, the client application
    needs to prove its identity to the server. Therefore, the application
    generates an authenticator. An authenticator consists of the following
    components:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The client's principal
     </p></li><li class="listitem"><p>
      The client's IP address
     </p></li><li class="listitem"><p>
      The current time
     </p></li><li class="listitem"><p>
      A checksum (chosen by the client)
     </p></li></ul></div><p>
    All this information is encrypted using the session key that the client has
    already received for this special server. The authenticator and the ticket
    for the server are sent to the server. The server uses its copy of the
    session key to decrypt the authenticator, which gives it all the
    information needed about the client requesting its service, to compare it
    to that contained in the ticket. The server checks if the ticket and the
    authenticator originate from the same client.
   </p><p>
    Without any security measures implemented on the server side, this stage of
    the process would be an ideal target for replay attacks. Someone could try
    to resend a request stolen off the net some time before. To prevent this,
    the server does not accept any request with a time stamp and ticket
    received previously. In addition to that, a request with a time stamp
    differing too much from the time the request is received is ignored.
   </p></section><section class="sect2" id="sec-security-kerberos-how-mutual" data-id-title="Mutual authentication"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.3.3 </span><span class="title-name">Mutual authentication</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-how-mutual">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Kerberos authentication can be used in both directions. It is not only a
    question of the client being the one it claims to be. The server should
    also be able to authenticate itself to the client requesting its service.
    Therefore, it sends an authenticator itself. It adds one to the checksum it
    received in the client's authenticator and encrypts it with the session
    key, which is shared between it and the client. The client takes this
    response as a proof of the server's authenticity and they both start
    cooperating.
   </p></section><section class="sect2" id="sec-security-kerberos-how-tgs" data-id-title="Ticket granting—contacting all servers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.3.4 </span><span class="title-name">Ticket granting—contacting all servers</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-how-tgs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Tickets are designed to be used for one server at a time. Therefore, you
    need to get a new ticket each time you request another service. Kerberos
    implements a mechanism to obtain tickets for individual servers. This
    service is called the <span class="quote">“<span class="quote">ticket-granting service</span>”</span>. The
    ticket-granting service is a service (like any other service mentioned
    before) and uses the same access protocols that have already been outlined.
    Any time an application needs a ticket that has not already been requested,
    it contacts the ticket-granting server. This request consists of the
    following components:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The requested principal
     </p></li><li class="listitem"><p>
      The ticket-granting ticket
     </p></li><li class="listitem"><p>
      An authenticator
     </p></li></ul></div><p>
    Like any other server, the ticket-granting server now checks the
    ticket-granting ticket and the authenticator. If they are considered valid,
    the ticket-granting server builds a new session key to be used between the
    original client and the new server. Then the ticket for the new server is
    built, containing the following information:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The client's principal
     </p></li><li class="listitem"><p>
      The server's principal
     </p></li><li class="listitem"><p>
      The current time
     </p></li><li class="listitem"><p>
      The client's IP address
     </p></li><li class="listitem"><p>
      The newly-generated session key
     </p></li></ul></div><p>
    The new ticket has a lifetime, which is either the remaining lifetime of
    the ticket-granting ticket or the default for the service. The lesser of
    both values is assigned. The client receives this ticket and the session
    key, which are sent by the ticket-granting service. But this time the
    answer is encrypted with the session key that came with the original
    ticket-granting ticket. The client can decrypt the response without
    requiring the user's password when a new service is contacted. Kerberos can
    thus acquire ticket after ticket for the client without bothering the user.
   </p></section></section><section class="sect1" id="sec-security-kerberos-users" data-id-title="User view of Kerberos"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.4 </span><span class="title-name">User view of Kerberos</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-users">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Ideally, a user only contact with Kerberos happens during login at the
   workstation. The login process includes obtaining a ticket-granting ticket.
   At logout, a user's Kerberos tickets are automatically destroyed, which makes
   it difficult for anyone else to impersonate this user.
  </p><p>
   The automatic expiration of tickets can lead to a situation when a user's
   login session lasts longer than the maximum lifespan given to the
   ticket-granting ticket (a reasonable setting is 10 hours). However, the user
   can get a new ticket-granting ticket by running <code class="command">kinit</code>.
   Enter the password again and Kerberos obtains access to desired services
   without additional authentication. To get a list of all the tickets silently
   acquired for you by Kerberos, run <code class="command">klist</code>.
  </p><p>
   Here is a short list of applications that use Kerberos authentication. These
   applications can be found under <code class="filename">/usr/lib/mit/bin</code> or
   <code class="filename">/usr/lib/mit/sbin</code> after installing the package
   <code class="systemitem">krb5-apps-clients</code>. They all have the full
   functionality of their common Unix and Linux brothers plus the additional
   bonus of transparent authentication managed by Kerberos:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="command">telnet</code>, <code class="systemitem">telnetd</code>
    </p></li><li class="listitem"><p>
     <code class="command">rlogin</code>
    </p></li><li class="listitem"><p>
     <code class="command">rsh</code>, <code class="command">rcp</code>,
     <code class="systemitem">rshd</code>
    </p></li><li class="listitem"><p>
     <code class="command">ftp</code>, <code class="systemitem">ftpd</code>
    </p></li></ul></div><p>
   You no longer need to enter your password for using these applications
   because Kerberos has already proven your identity. <code class="command">ssh</code>, if
   compiled with Kerberos support, can even forward all the tickets acquired for
   one workstation to another one. If you use <code class="command">ssh</code> to log in
   to another workstation, <code class="command">ssh</code> makes sure that the encrypted
   contents of the tickets are adjusted to the new situation. Simply copying
   tickets between workstations is not sufficient because the ticket contains
   workstation-specific information (the IP address). XDM and GDM offer Kerberos
   support, too. Read more about the Kerberos network applications in
   <em class="citetitle">Kerberos V5 UNIX User's Guide</em> at
   <a class="link" href="https://web.mit.edu/kerberos" target="_blank">https://web.mit.edu/kerberos</a>.
  </p></section><section class="sect1" id="sec-security-kerberos-nfs" data-id-title="Kerberos and NFS"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.5 </span><span class="title-name">Kerberos and NFS</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-nfs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Most NFS servers can export file systems using any combination of the
   default <span class="quote">“<span class="quote">trust the network</span>”</span> form of security, known as
   <code class="option">sec=sys</code>, and three different levels of Kerberos-based
   security, <code class="option">sec=krb5</code>, <code class="option">sec=krb5i</code>, and
   <code class="option">sec=krb5p</code>. The <code class="option">sec</code> option is set as a
   mount option on the client. It is often the case that the NFS service will
   first be configured and used with <code class="option">sec=sys</code>, and then Kerberos
   can be imposed afterwards. In this case it is likely that the server will be
   configured to support both <code class="option">sec=sys</code> and one of the Kerberos
   levels, and then after all clients have transitioned, the
   <code class="option">sec=sys</code> support will be removed, thus achieving true
   security. The transition to Kerberos should be fairly transparent if done in an
   orderly manner. However there is one subtle detail of NFS behavior that
   works differently when Kerberos is used, and the implications of this need to
   be understood and possibly addressed. See
   <a class="xref" href="#sec-security-kerberos-overview-group" title="6.5.1. Group membership">Section 6.5.1, “Group membership”</a>.
  </p><p>
   The three Kerberos levels indicate different levels of security. With more
   security comes a need for more processor power to encrypt and decrypt
   messages. Choosing the right balance is an important consideration when
   planning a roll-out of Kerberos for NFS.
  </p><p>
   <code class="literal">krb5</code> provides only authentication. The server can know
   who sent a request, and the client can know that the server sent a reply. No
   security is provided for the content of the request or reply, so an attacker
   with physical network access could transform the request or reply, or both,
   in various ways to deceive either server or client. They cannot directly
   read or change any file that the authenticated user could not read or
   change, but almost anything is theoretically possible.
  </p><p>
   <code class="literal">krb5i</code> adds integrity checks to all messages. With
   <code class="literal">krb5i</code>, an attacker cannot modify any request or reply,
   but they can view all the data exchanged, and so could discover the content
   of any file that is read.
  </p><p>
   <code class="literal">krb5p</code> adds privacy to the protocol. As well as reliable
   authentication and integrity checking, messages are fully encrypted so an
   attacker can only know that messages were exchanged between client and
   server, and cannot extract other information directly from the message.
   Whether information can be extracted from message timing is a separate
   question that Kerberos does not address.
  </p><section class="sect2" id="sec-security-kerberos-overview-group" data-id-title="Group membership"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.1 </span><span class="title-name">Group membership</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-overview-group">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The one behavioral difference between <code class="option">sec=sys</code> and the
    various Kerberos security levels that might be visible is related to group
    membership. In Unix and Linux, each file system access comes from a process
    that is owned by a particular user and has a particular group owner and several
    supplemental groups. Access rights to files can vary based on the
    owner and the various groups.
   </p><p>
    With <code class="option">sec=sys</code>, the user-id, group-id, and a list of up to
    16 supplementary groups are sent to the server in each request.
   </p><p>
    If a user is a member of more than 16 supplementary groups, the extra
    groups are lost and some files may not be accessible over NFS that the user
    would normally expect to have access to. For this reason, most sites that
    use NFS find a way to limit all users to at most 16 supplementary groups.
   </p><p>
    If the user runs the <code class="command">newgrp</code> command or runs a
    set-group-id program, either of which can change the list of groups they
    are a member of, these changes take effect immediately and provide
    different accesses over NFS.
   </p><p>
    With Kerberos, group information is not sent in requests. Only the user
    is identified (using a Kerberos <span class="quote">“<span class="quote">principal</span>”</span>), and the server
    performs a lookup to determine the user ID and group list for that
    principal. This means that if the user is a member of more than 16 groups,
    all of these group memberships will be used in determining file access
    permissions. However it also means that if the user changes a group-id on
    the client in some way, the server will not notice the change and will not
    take it into account in determining access rights.
   </p><p>
    Usually the improvement of having access to more groups brings a
    real benefit, and the loss of not being able to change groups is not
    noticed as it is not widely used. A site administrator considering the use
    of Kerberos should be aware of the difference though and ensure that it will
    not actually cause problems.
   </p></section><section class="sect2" id="sec-security-kerberos-overview-performance" data-id-title="Performance and scalability"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.2 </span><span class="title-name">Performance and scalability</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-overview-performance">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Using Kerberos for security requires extra CPU power for encrypting and
    decrypting messages. How much extra CPU power is required and whether the
    difference is noticeable will vary with different hardware and different
    applications. If the server or client are already saturating the available
    CPU power, it is likely that a performance drop will be measurable when
    switching from <code class="literal">sec=sys</code> to Kerberos. If there is spare CPU
    capacity available, it is quite possible that the transition will not
    result in any throughput change. The only way to be sure how much impact
    the use of Kerberos will have is to test your load on your hardware.
   </p><p>
    The only configuration options that might reduce the load will also reduce
    the quality of the protection offered. <code class="option">sec=krb5</code> should
    produce noticeably less load than <code class="option">sec=krb5p</code> but, as
    discussed above, it does not produce very strong security. Similarly it is
    possible to adjust the list of ciphers that Kerberos can choose from, and this
    might change the CPU requirement. However the defaults are carefully chosen
    and should not be changed without similar careful consideration.
   </p><p>
    The other possible performance issue when configuring NFS to use Kerberos
    involves availability of the Kerberos authentication servers, known as the KDC
    or Key Distribution Center.
   </p><p>
    The use of NFS adds load to such servers to the same degree that adding the
    use of Kerberos for any other services adds some load. Every time a given user
    (Kerberos principal) establishes a session with a service, for example by
    accessing files exported by a particular NFS server, the client needs to
    negotiate with the KDC. Once a session key has been negotiated, the client
    server can communicate without further help for many hours, depending on
    details of the Kerberos configuration, particularly the
    <code class="option">ticket_lifetime</code> setting.
   </p><p>
    The concerns most likely to affect the provisioning of Kerberos KDC servers
    are availability and peak usage.
   </p><p>
    As with other core services such as DNS, LDAP or similar name-lookup
    services, having two servers that are reasonably "close" to every client
    provides good availability for modest resources. Kerberos allows for multiple
    KDC servers with flexible models for database propagation, so distributing
    servers as needed around campuses, buildings, and even cabinets is fairly
    straightforward. The best mechanism to ensure each client finds a nearby
    Kerberos server is to use split-horizon DNS with each building (or similar)
    getting different details from the DNS server. If this is not possible,
    then managing the <code class="filename">/etc/krb5.conf</code> file to be different
    at different locations is a suitable alternative.
   </p><p>
    As access to the Kerberos KDC is infrequent, load is only likely to be a
    problem at peak times. If thousands of people all log in between 9:00 and
    9:05, then the servers will receive many more requests-per-minute than they
    might in the middle of the night. The load on the Kerberos server is likely to
    be more than that on an LDAP server, but not orders of magnitude more. A
    sensible guideline is to provision Kerberos replicas in the same manner that
    you provision LDAP replicas, and then monitor performance to determine if
    demand ever exceeds capacity.
   </p></section><section class="sect2" id="sec-security-kerberos-overview-kdc" data-id-title="Master KDC, multiple domains, and trust relationships"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.3 </span><span class="title-name">Master KDC, multiple domains, and trust relationships</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-overview-kdc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    One service of the Kerberos KDC that is not easily distributed is the handling
    of updates, such as password changes and new user creation. These must
    happen at a single master KDC.
   </p><p>
    These updates are not likely to happen with such frequency that any
    significant load will be generated, but availability could be an issue. It
    can be annoying to create a new user or change a password, and
    the master KDC on the other side of the world is temporarily unavailable.
   </p><p>
    When an organization is geographically distributed and has a policy of
    handling administration tasks locally at each site, it can be beneficial to
    create multiple Kerberos domains, one for each administrative center. Each
    domain would then have its own master KDC which would be geographically
    local. Users in one domain can still get access to resources in another
    domain by setting up trust relationships between domains.
   </p><p>
    The easiest arrangement for multiple domains is to have a global
    domain (for example, EXAMPLE.COM) and various local domains (for example,
    ASIA.EXAMPLE.COM, EUROPE.EXAMPLE.COM). If the global domain is
    configured to trust each local domain, and each local domain is
    configured to trust the global domain, then fully transitive trust
    is available between any pair of domains, and any principal can
    establish a secure connection with any service. Ensuring
    appropriate access rights to resources, for example files provided
    by that service, will be dependent on the user name lookup service
    used, and the functionality of the NFS file server, and is beyond
    the scope of this document.
   </p></section></section><section class="sect1" id="sec-security-kerberos-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.6 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-security-kerberos-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The official site of MIT Kerberos is
   <a class="link" href="https://web.mit.edu/kerberos" target="_blank">https://web.mit.edu/kerberos</a>. There, find links to any
   other relevant resource concerning Kerberos, including Kerberos installation,
   user, and administration guides.
  </p><p>
   The book <span class="emphasis"><em>Kerberos—A Network Authentication System</em></span>
   by Brian Tung (ISBN 0-201-37924-4) offers extensive information.
  </p></section></section><section class="chapter" id="cha-security-ad" data-id-title="Active Directory support"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">7 </span><span class="title-name">Active Directory support</span></span> <a title="Permalink" class="permalink" href="#cha-security-ad">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Active Directory* (AD) is a directory-service based on LDAP, Kerberos, and
  other services. It is used by Microsoft* Windows* to manage
  resources, services, and people. In a Microsoft Windows network, Active Directory provides
  information about these objects, restricts access to them, and enforces
  policies.
  <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span> lets you join existing Active Directory domains and integrate your
  Linux machine into a Windows environment.
 </p><section class="sect1" id="sec-security-ad-integrate" data-id-title="Integrating Linux and Active Directory environments"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.1 </span><span class="title-name">Integrating Linux and Active Directory environments</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-integrate">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   With a Linux client (configured as an Active Directory client) that is
   joined to an existing Active Directory domain, benefit from various
   features not available on a pure <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> Linux client:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.7.4.3.1"><span class="term">Browsing shared files and directories with SMB</span></dt><dd><p>
      GNOME Files (previously called Nautilus) supports browsing shared resources
      through SMB.
     </p></dd><dt id="id-1.7.4.7.4.3.2"><span class="term">Sharing files and directories with SMB</span></dt><dd><p>
      GNOME Files supports sharing directories and files as in Windows.
     </p></dd><dt id="id-1.7.4.7.4.3.3"><span class="term">Accessing and manipulating user data on the Windows server</span></dt><dd><p>
      Through GNOME Files, users can access their Windows user data and
      can edit, create, and delete files and directories on the Windows
      server. Users can access their data without having to enter their
      password multiple times.
     </p></dd><dt id="id-1.7.4.7.4.3.4"><span class="term">Offline authentication</span></dt><dd><p>
      Users can log in and access their local data on the Linux
      machine even if they are offline or the Active Directory server is unavailable for
      other reasons.
     </p></dd><dt id="id-1.7.4.7.4.3.5"><span class="term">Windows password change</span></dt><dd><p>
      This port of Active Directory support in Linux enforces corporate password policies
      stored in Active Directory. The display managers and console support
      password change messages and accept your input. You can even use the
      Linux <code class="command">passwd</code> command to set Windows passwords.
     </p></dd><dt id="id-1.7.4.7.4.3.6"><span class="term">Single-sign-on through kerberized applications</span></dt><dd><p>
      
      Many desktop applications are Kerberos-enabled
      (<span class="emphasis"><em>kerberized</em></span>), which means they can transparently
      handle authentication for the user without the need for password
      reentry at Web servers, proxies, groupware applications, or other
      locations.
     </p></dd></dl></div><div id="id-1.7.4.7.4.4" data-id-title="Managing Unix attributes from Windows Server* 2016 and later" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Managing Unix attributes from Windows Server* 2016 and later</div><p>
    In Windows Server 2016 and later, Microsoft has removed the role
    <span class="emphasis"><em>IDMU/NIS Server</em></span> and along with it the
    <span class="emphasis"><em>Unix Attributes</em></span> plug-in for the
    <span class="emphasis"><em>Active Directory Users and Computers</em></span> MMC snap-in.
   </p><p>
    However, Unix attributes can still be managed manually when
    <span class="guimenu">Advanced Options</span> are enabled in the
    <span class="emphasis"><em>Active Directory Users and Computers</em></span> MMC snap-in.
    For more information, see
    <a class="link" href="https://blogs.technet.microsoft.com/activedirectoryua/2016/02/09/identity-management-for-unix-idmu-is-deprecated-in-windows-server/" target="_blank">https://blogs.technet.microsoft.com/activedirectoryua/2016/02/09/identity-management-for-unix-idmu-is-deprecated-in-windows-server/</a>.
   </p><p>
    Alternatively, use the method described in
    <a class="xref" href="#pro-security-ad-join-sssd" title="Joining an Active Directory domain using User logon management">Procedure 7.1, “Joining an Active Directory domain using <span class="guimenu">User logon management</span>”</a> to complete
    attributes on the client side (in particular, see
    <a class="xref" href="#st-security-sssd-home-dir" title="Step 6.c">Step 6.c</a>).
   </p></div><p>
   The following section contains technical background for most of the
   previously named features.
   <span class="phrase">For more information about file and
   printer sharing using Active Directory, see <span class="intraxref">Book “GNOME User Guide”</span>.</span>
  </p></section><section class="sect1" id="sec-security-ad-background" data-id-title="Background information for Linux Active Directory support"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.2 </span><span class="title-name">Background information for Linux Active Directory support</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-background">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Many system components need to interact flawlessly to integrate
   a Linux client into an existing Windows Active Directory domain. The following
   sections focus on the underlying processes of the key events in Active Directory
   server and client interaction.
  </p><p>
   To communicate with the directory service, the client needs to share at
   least two protocols with the server:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.7.5.4.1"><span class="term">LDAP</span></dt><dd><p>
      LDAP is a protocol optimized for managing directory information. A
      Windows domain controller with Active Directory can use the LDAP protocol to
      exchange directory information with the clients. To learn more about
      LDAP in general, refer
      to <a class="xref" href="#cha-security-ldap" title="Chapter 5. LDAP with 389 Directory Server">Chapter 5, <em>LDAP with 389 Directory Server</em></a>.
     </p></dd><dt id="id-1.7.4.7.5.4.2"><span class="term">Kerberos</span></dt><dd><p> Kerberos is a third-party trusted authentication service.
            All its clients trust Kerberos authorization of another
            client's identity, enabling kerberized single-sign-on (SSO)
            solutions. Windows supports a Kerberos implementation,
            making Kerberos SSO possible even with Linux clients. To
            learn more about Kerberos in Linux, refer to <a class="xref" href="#cha-security-kerberos" title="Chapter 6. Network authentication with Kerberos">Chapter 6, <em>Network authentication with Kerberos</em></a>. </p></dd></dl></div><p>
   Depending on which YaST module you use to set up Kerberos authentication,
   different client components process account and authentication data:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.7.5.6.1"><span class="term">Solutions based on SSSD</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        The <code class="systemitem">sssd</code> daemon is the
        central part of this solution. It handles all communication with the
        Active Directory server.
       </p></li><li class="listitem"><p>
        To gather name service information,
        <code class="systemitem">sssd_nss</code> is used.
       </p></li><li class="listitem"><p>
        To authenticate users, the
        <code class="systemitem">pam_sss</code> module for PAM
        is used. The creation of user homes for the Active Directory users on the Linux
        client is handled by <code class="filename">pam_mkhomedir</code>.
       </p><p>
        For more information about PAM, see <a class="xref" href="#cha-pam" title="Chapter 2. Authentication with PAM">Chapter 2, <em>Authentication with PAM</em></a>.
       </p></li></ul></div></dd><dt id="id-1.7.4.7.5.6.2"><span class="term">Solution based on Winbind (Samba)</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        The <code class="systemitem">winbindd</code> daemon is the
        central part of this solution. It handles all communication with the
        Active Directory server.
       </p></li><li class="listitem"><p>
        To gather name service information,
        <code class="systemitem">nss_winbind</code> is used.
       </p></li><li class="listitem"><p>
        To authenticate users, the
        <code class="systemitem">pam_winbind</code> module for PAM
        is used. The creation of user homes for the Active Directory users on the Linux
        client is handled by <code class="filename">pam_mkhomedir</code>.
       </p><p>
        For more information about PAM, see <a class="xref" href="#cha-pam" title="Chapter 2. Authentication with PAM">Chapter 2, <em>Authentication with PAM</em></a>.
       </p></li></ul></div><p>
      <a class="xref" href="#fig-ad-schema" title="Schema of Winbind-based Active Directory authentication">Figure 7.1, “Schema of Winbind-based Active Directory authentication”</a> highlights the most prominent
      components of Winbind-based Active Directory authentication.
     </p><div class="figure" id="fig-ad-schema"><div class="figure-contents"><div class="mediaobject"><a href="images/sled10_ad_schema.png"><img src="images/sled10_ad_schema.png" width="75%" alt="Schema of Winbind-based Active Directory authentication" title="Schema of Winbind-based Active Directory authentication"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 7.1: </span><span class="title-name">Schema of Winbind-based Active Directory authentication </span></span><a title="Permalink" class="permalink" href="#fig-ad-schema">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></dd></dl></div><p>
   Applications that are PAM-aware, like the login routines and the GNOME
   display manager, interact with the PAM and NSS layer to authenticate
   against the Windows server. Applications supporting Kerberos
   authentication (such as file managers, Web browsers, or e-mail clients)
   use the Kerberos credential cache to access user's Kerberos tickets,
   making them part of the SSO framework.
  </p><section class="sect2" id="sec-security-ad-background-domain-join" data-id-title="Domain join"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.2.1 </span><span class="title-name">Domain join</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-background-domain-join">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    During domain join, the server and the client establish a secure
    relation. On the client, the following tasks need to be performed to
    join the existing LDAP and Kerberos SSO environment provided by the
    Windows domain controller. The entire join process is handled by the
    YaST Domain Membership module, which can be run during installation
    or in the installed system:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      The Windows domain controller providing both LDAP and KDC (Key
      Distribution Center) services is located.
     </p></li><li class="step"><p>
      A machine account for the joining client is created in the directory
      service.
     </p></li><li class="step"><p>
      An initial ticket granting ticket (TGT) is obtained for the client and
      stored in its local Kerberos credential cache. The client needs this
      TGT to get further tickets allowing it to contact other services, like
      contacting the directory server for LDAP queries.
     </p></li><li class="step"><p>
      NSS and PAM configurations are adjusted to enable the client to
      authenticate against the domain controller.
     </p></li></ol></div></div><p>
    During client boot, the winbind daemon is started and retrieves the
    initial Kerberos ticket for the machine account. winbindd automatically
    refreshes the machine's ticket to keep it valid. To keep track of the
    current account policies, winbindd periodically queries the domain
    controller.
   </p></section><section class="sect2" id="sec-security-ad-background-logon" data-id-title="Domain login and user homes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.2.2 </span><span class="title-name">Domain login and user homes</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-background-logon">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The login manager of GNOME (GDM) has been extended to allow the handling
    of Active Directory domain login. Users can choose to log in to the primary domain the
    machine has joined or to one of the trusted domains with which the
    domain controller of the primary domain has established a trust
    relationship.
   </p><p>
    User authentication is mediated by several PAM modules as described
    in <a class="xref" href="#sec-security-ad-background" title="7.2. Background information for Linux Active Directory support">Section 7.2, “Background information for Linux Active Directory support”</a>. If there are errors, the
    error codes are translated into user-readable error messages that PAM
    gives at login through any of the supported methods (GDM, console, and
    SSH):
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.7.5.9.4.1"><span class="term"><code class="literal">Password has expired</code>
     </span></dt><dd><p>
       The user sees a message stating that the password has expired and
       needs to be changed. The system prompts for a new password and
       informs the user if the new password does not comply with corporate
       password policies (for example the password is too short, too simple,
       or already in the history). If a user's password change fails, the
       reason is shown and a new password prompt is given.
      </p></dd><dt id="id-1.7.4.7.5.9.4.2"><span class="term"><code class="literal">Account disabled</code>
     </span></dt><dd><p>
       The user sees an error message stating that the account has been
       disabled and to contact the system administrator.
      </p></dd><dt id="id-1.7.4.7.5.9.4.3"><span class="term"><code class="literal">Account locked out</code>
     </span></dt><dd><p>
       The user sees an error message stating that the account has been
       locked and to contact the system administrator.
      </p></dd><dt id="id-1.7.4.7.5.9.4.4"><span class="term"><code class="literal">Password has to be changed</code>
     </span></dt><dd><p>
       The user can log in but receives a warning that the password needs to
       be changed soon. This warning is sent three days before that password
       expires. After expiration, the user cannot log in.
      </p></dd><dt id="id-1.7.4.7.5.9.4.5"><span class="term"><code class="literal">Invalid workstation</code>
     </span></dt><dd><p>
       When a user is restricted to specific workstations and the current
       <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> machine is not among them, a message appears that
       this user cannot log in from this workstation.
      </p></dd><dt id="id-1.7.4.7.5.9.4.6"><span class="term"><code class="literal">Invalid logon hours</code>
     </span></dt><dd><p>
       When a user is only allowed to log in during working hours and tries
       to log in outside working hours, a message informs the user that
       logging in is not possible at that time.
      </p></dd><dt id="id-1.7.4.7.5.9.4.7"><span class="term"><code class="literal">Account expired</code>
     </span></dt><dd><p>
       An administrator can set an expiration time for a specific user
       account. If that user tries to log in after expiration, the user gets
       a message that the account has expired and cannot be used to log in.
      </p></dd></dl></div><p>
    During a successful authentication, the client
    acquires a ticket granting ticket (TGT) from the Kerberos server of
    Active Directory and stores it in the user's credential cache. It also
    renews the TGT in the background, requiring no user interaction.
   </p><p>
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> supports local home directories for Active Directory users. If
    configured through YaST as described in
    <a class="xref" href="#sec-security-ad-config" title="7.3. Configuring a Linux client for Active Directory">Section 7.3, “Configuring a Linux client for Active Directory”</a>, user home directories are
    created when a Windows/Active Directory user first logs in to the Linux client. These
    home directories look and feel identical to standard Linux user home
    directories and work independently of the Active Directory Domain Controller.
   </p><p>
    Using a
    local user home, it is possible to access a user's data on this machine
    (even when the Active Directory server is disconnected) as long as the Linux client
    has been configured to perform offline authentication.
   </p></section><section class="sect2" id="sec-security-ad-background-offline" data-id-title="Offline service and policy support"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.2.3 </span><span class="title-name">Offline service and policy support</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-background-offline">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Users in a corporate environment must have the ability to become roaming
    users (for example, to switch networks or even work disconnected for
    some time). To enable users to log in to a disconnected machine,
    extensive caching was integrated into the winbind daemon. The winbind
    daemon enforces password policies even in the offline state. It tracks
    the number of failed login attempts and reacts according to the policies
    configured in Active Directory. Offline support is disabled by default
    and must be explicitly enabled in the YaST Domain Membership
    module.
   </p><p>
    When the domain controller has become unavailable, the user can still
    access network resources (other than the Active Directory server itself) with valid
    Kerberos tickets that have been acquired before losing the connection
    (as in Windows). Password changes cannot be processed unless the domain
    controller is online. While disconnected from the Active Directory server, a user
    cannot access any data stored on this server. When a workstation has
    become disconnected from the network entirely and connects to the
    corporate network again later, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> acquires a new Kerberos
    ticket when the user has locked and unlocked the desktop (for
    example, using a desktop screen saver).
   </p></section></section><section class="sect1" id="sec-security-ad-config" data-id-title="Configuring a Linux client for Active Directory"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.3 </span><span class="title-name">Configuring a Linux client for Active Directory</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-config">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Before your client can join an Active Directory domain, some adjustments must be made
   to your network setup to ensure the flawless interaction of client and
   server.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.7.6.3.1"><span class="term">DNS</span></dt><dd><p>
      Configure your client machine to use a DNS server that can forward DNS
      requests to the Active Directory DNS server. Alternatively, configure your machine
      to use the Active Directory DNS server as the name service data source.
     </p></dd><dt id="id-1.7.4.7.6.3.2"><span class="term">NTP</span></dt><dd><p>
      To succeed with Kerberos authentication, the client must have its time
      set accurately. It is highly recommended to use a central NTP time
      server for this purpose (this can be also the NTP server running on
      your Active Directory domain controller). If the clock skew between
      your Linux host and the domain controller exceeds a certain limit,
      Kerberos authentication fails and the client is logged in using the
      weaker NTLM (NT LAN Manager) authentication. For more details about
      using Active Directory for time synchronization, see
      <a class="xref" href="#proc-ad-join" title="Joining an Active Directory domain using Windows domain membership">Procedure 7.2, “Joining an Active Directory domain using <span class="guimenu">Windows domain membership</span>”</a>.
     </p></dd><dt id="id-1.7.4.7.6.3.3"><span class="term">Firewall</span></dt><dd><p>
      To browse your network neighborhood, either disable the firewall
      entirely or mark the interface used for browsing as part of the
      internal zone.
     </p><p>
      
      To change the firewall settings on your client, log in as
      <code class="systemitem">root</code> and start the YaST firewall module. Select
      <span class="guimenu">Interfaces</span>. Select your network interface from the
      list of interfaces and click <span class="guimenu">Change</span>. Select
      <span class="guimenu">Internal Zone</span> and apply your settings with
      <span class="guimenu">OK</span>. Leave the firewall settings with <span class="guimenu">Next</span> › <span class="guimenu">Finish</span>. To
      disable the firewall, check the <span class="guimenu">Disable Firewall Automatic
      Starting</span> option, and leave the firewall module with
      <span class="guimenu">Next</span> › <span class="guimenu">Finish</span>.
     </p></dd><dt id="id-1.7.4.7.6.3.4"><span class="term">Active Directory account</span></dt><dd><p>
      You cannot log in to an Active Directory domain unless the Active Directory administrator has
      provided you with a valid user account for that domain. Use the Active Directory
      user name and password to log in to the Active Directory domain from your Linux
      client.
     </p></dd></dl></div><section class="sect2" id="sec-security-ad-configure-choose" data-id-title="Choosing which YaST module to use for connecting to Active Directory"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.3.1 </span><span class="title-name">Choosing which YaST module to use for connecting to Active Directory</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-configure-choose">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    YaST contains multiple modules that allow connecting to an Active Directory:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">User logon management</span>. </span>
    Use both an identity service (usually LDAP) and a user authentication
    service (usually Kerberos). This option is based on SSSD and in the
    majority of cases is best suited for joining Active Directory domains.
   </p><p>
   This module is described in
   <a class="xref" href="#sec-security-ad-sssd" title="7.3.2. Joining Active Directory using User logon management">Section 7.3.2, “Joining Active Directory using <span class="guimenu">User logon management</span>”</a>.
  </p></li><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">Windows domain membership</span>. </span>
    Join an Active Directory (which entails use of Kerberos and LDAP). This option is
    based on <code class="command">winbind</code> and is best suited for joining an
    Active Directory domain if support for NTLM or cross-forest trusts is necessary.
   </p><p>
   This module is described in
   <a class="xref" href="#sec-security-ad-winbind" title="7.3.3. Joining Active Directory using Windows domain membership">Section 7.3.3, “Joining Active Directory using <span class="guimenu">Windows domain membership</span>”</a>.
  </p></li></ul></div></section><section class="sect2" id="sec-security-ad-sssd" data-id-title="Joining Active Directory using User logon management"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.3.2 </span><span class="title-name">Joining Active Directory using <span class="guimenu">User logon management</span></span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-sssd">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The YaST module <span class="guimenu">User Logon Management</span> supports
    authentication at an Active Directory. Additionally, it also supports the following
    related authentication and identification providers:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.7.6.5.3.1"><span class="term">Identification providers</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">Delegate to third-party software library</span>. </span>
          Support for legacy NSS providers via a proxy.
         </p></li><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">FreeIPA</span>. </span>
          FreeIPA and Red Hat Enterprise Identity Management provider.
         </p></li><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">Generic directory service (LDAP)</span>. </span>
         An LDAP provider. For more information about configuring LDAP, see
         <code class="command">man 5 sssd-ldap</code>.
        </p></li><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">Local SSSD file database</span>. </span>
          An SSSD-internal provider for local users.
         </p></li></ul></div></dd><dt id="id-1.7.4.7.6.5.3.2"><span class="term">Authentication providers</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">Delegate to third-party software library</span>. </span>
          Relay authentication to another PAM target via a proxy.
         </p></li><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">FreeIPA</span>. </span>
          FreeIPA and Red Hat Enterprise Identity Management provider.
         </p></li><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">Generic Kerberos service</span>. </span>
          An LDAP provider.
         </p></li><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">Generic directory service (LDAP)</span>. </span>
          Kerberos authentication.
         </p></li><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">Local SSSD file database</span>. </span>
          An SSSD-internal provider for local users.
         </p></li><li class="listitem"><p><span class="formalpara-title"><span class="guimenu">This domain does not provide authentication service</span>. </span>
          Disables authentication explicitly.
         </p></li></ul></div></dd></dl></div><p>
    To join an Active Directory domain using SSSD and the
    <span class="guimenu">User Logon Management</span> module of YaST, proceed as
    follows:
   </p><div class="procedure" id="pro-security-ad-join-sssd" data-id-title="Joining an Active Directory domain using User logon management"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 7.1: </span><span class="title-name">Joining an Active Directory domain using <span class="guimenu">User logon management</span> </span></span><a title="Permalink" class="permalink" href="#pro-security-ad-join-sssd">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Open YaST.
     </p></li><li class="step"><p>
      To be able to use DNS auto-discovery later, set up the Active Directory Domain
      Controller (the Active Directory server) as the name server for your client.
     </p><ol type="a" class="substeps"><li class="step"><p>
        In YaST, click <span class="guimenu">Network Settings</span>.
       </p></li><li class="step"><p>
        Select <span class="guimenu">Hostname/DNS</span>, then enter the IP address of
        the Active Directory Domain Controller into the text box <span class="guimenu">Name Server
        1</span>.
       </p><p>
        Save the setting with <span class="guimenu">OK</span>.
       </p></li></ol></li><li class="step"><p>
      From the YaST main window, start the module <span class="guimenu">User Logon
      Management</span>.
     </p><p>
      The module opens with an overview showing different network properties
      of your computer and the authentication method currently in use.
     </p><div class="figure" id="fig-security-logonmanagement"><div class="figure-contents"><div class="mediaobject"><a href="images/ad-overview.png"><img src="images/ad-overview.png" alt="Overview window showing the computer name, IP address, and its authentication setting." title="Overview window showing the computer name, IP address, and its authentication setting."/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 7.2: </span><span class="title-name">Main window of <span class="guimenu">User logon management</span> </span></span><a title="Permalink" class="permalink" href="#fig-security-logonmanagement">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
      To start editing, click <span class="guimenu">Change Settings</span>.
     </p></li><li class="step"><p>
      Now join the domain.
     </p><ol type="a" class="substeps"><li class="step"><p>
        Click <span class="guimenu">Add Domain</span>.
       </p></li><li class="step"><p>
        In the appearing dialog, specify the correct
        <span class="guimenu">Domain name</span>. Then specify the services to use for
        identity data and authentication: Select <span class="guimenu">Microsoft Active
        Directory</span> for both.
       </p><p>
        Ensure that <span class="guimenu">Enable the domain</span> is activated.
       </p><p>
        Click <span class="guimenu">OK</span>.
       </p></li><li class="step"><p><span class="step-optional">(Optional)</span> 
        Usually, you can keep the default settings in the
        following dialog. However, there are reasons to make changes:
       </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title">If the local host name does not match the host name set on the
           domain controller. </span>
           Find out if the host name of your computer matches what the name
           your computer is known as to the Active Directory Domain Controller. In a
           terminal, run the command <code class="command">hostname</code>, then compare
           its output to the configuration of the Active Directory Domain Controller.
          </p><p>
          If the values differ, specify the host name from the Active Directory
          configuration under <span class="guimenu">AD hostname</span>. Otherwise, leave
          the appropriate text box empty.
         </p></li><li class="listitem"><p><span class="formalpara-title">If you do not want to use DNS auto-discovery. </span>
           Specify the <span class="guimenu">Host names of Active Directory
           servers</span> that you want to use. If there are multiple
           Domain Controllers, separate their host names with commas.
          </p></li></ul></div></li><li class="step"><p>
        To continue, click <span class="guimenu">OK</span>.
       </p><p>
        If not all software is installed already, the computer will now
        install missing software. It will then check whether the configured
        Active Directory Domain Controller is available.
       </p></li><li class="step"><p>
        If everything is correct, the following dialog should now show that
        it has discovered an <span class="guimenu">Active Directory Server</span> but
        that you are <span class="guimenu">Not yet enrolled</span>.
       </p><p>
        In the dialog, specify the <span class="guimenu">Username</span> and
        <span class="guimenu">Password</span> of the Active Directory administrator account
        (usually <code class="literal">Administrator</code>).
       </p><p>
        To make sure that the current domain is enabled for Samba, activate
        <span class="guimenu">Overwrite Samba configuration to work with this AD</span>.
       </p><p>
        To enroll, click <span class="guimenu">OK</span>.
       </p><div class="figure" id="fig-security-logonmanagement-enroll"><div class="figure-contents"><div class="mediaobject"><a href="images/ad-enroll.png"><img src="images/ad-enroll.png" alt="" title=""/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 7.3: </span><span class="title-name">Enrolling into a domain </span></span><a title="Permalink" class="permalink" href="#fig-security-logonmanagement-enroll">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
        You should now see a message confirming that you have enrolled
        successfully. Finish with <span class="guimenu">OK</span>.
       </p></li></ol></li><li class="step"><p>
      After enrolling, configure the client using the window
      <span class="guimenu">Manage Domain User Logon</span>.
     </p><div class="figure" id="fig-security-logonmanagement-configure"><div class="figure-contents"><div class="mediaobject"><a href="images/ad-config.png"><img src="images/ad-config.png" alt="" title=""/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 7.4: </span><span class="title-name">Configuration window of <span class="guimenu">User logon management</span> </span></span><a title="Permalink" class="permalink" href="#fig-security-logonmanagement-configure">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div><ol type="a" class="substeps"><li class="step"><p>
        To allow logging in to the computer using login data provided by Active Directory,
        activate <span class="guimenu">Allow Domain User Logon</span>.
       </p></li><li class="step"><p><span class="step-optional">(Optional)</span> 
        Optionally, under <span class="guimenu">Enable domain data source</span>,
        activate additional data sources such as information on which users are
        allowed to use <code class="command">sudo</code> or which network drives are
        available.
       </p></li><li class="step" id="st-security-sssd-home-dir"><p>
        To allow Active Directory users to have home directories, activate
        <span class="guimenu">Create Home Directories</span>. The path for home
        directories can be set in multiple ways—on the client, on
        the server, or both ways:
       </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          To configure the home directory paths on the Domain Controller, set
          an appropriate value for the attribute
          <code class="literal">UnixHomeDirectory</code> for each user. Additionally,
          make sure that this attribute replicated to the global catalog. For
          information on achieving that under Windows, see
          <a class="link" href="https://support.microsoft.com/en-us/kb/248717" target="_blank">https://support.microsoft.com/en-us/kb/248717</a>.
         </p></li><li class="listitem"><p>
          To configure home directory paths on the client in such a way that
          precedence will be given to the path set on the domain controller,
          use the option <code class="literal">fallback_homedir</code>.
         </p></li><li class="listitem"><p>
          To configure home directory paths on the client in such a way that
          the client setting will override the server setting, use
          <code class="literal">override_homedir</code>.
         </p></li></ul></div><p>
        As settings on the Domain Controller are outside of the scope of this
        documentation, only the configuration of the client-side options will be
        described in the following.
       </p><p>
        From the side bar, select
        <span class="guimenu">Service Options</span> › <span class="guimenu">Name switch</span>, then click
        <span class="guimenu">Extended Options</span>. From that window, select either
        <code class="literal">fallback_homedir</code> or
        <code class="literal">override_homedir</code>, then click <span class="guimenu">Add</span>.
       </p><p>
        Specify a value. To have home directories follow the format
        <code class="filename">/home/<em class="replaceable">USER_NAME</em></code>, use
        <code class="literal">/home/%u</code>.
        For more information about possible variables, see the man page
        <code class="literal">sssd.conf</code> (<code class="command">man 5 sssd.conf</code>),
        section
        <em class="citetitle">override_homedir</em>.
       </p><p>
        Click <span class="guimenu">OK</span>.
       </p></li></ol></li><li class="step"><p>
      Save the changes by clicking <span class="guimenu">OK</span>. Then make sure that
      the values displayed now are correct. To leave the dialog, click
      <span class="guimenu">Cancel</span>.
     </p></li></ol></div></div></section><section class="sect2" id="sec-security-ad-winbind" data-id-title="Joining Active Directory using Windows domain membership"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.3.3 </span><span class="title-name">Joining Active Directory using <span class="guimenu">Windows domain membership</span></span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-winbind">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To join an Active Directory domain using <code class="command">winbind</code> and the
    <span class="guimenu">Windows Domain Membership</span> module of YaST, proceed as
    follows:
   </p><div class="procedure" id="proc-ad-join" data-id-title="Joining an Active Directory domain using Windows domain membership"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 7.2: </span><span class="title-name">Joining an Active Directory domain using <span class="guimenu">Windows domain membership</span> </span></span><a title="Permalink" class="permalink" href="#proc-ad-join">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Log in as <code class="systemitem">root</code> and start YaST.
    </p></li><li class="step"><p>
     Start <span class="guimenu">Network Services</span> › <span class="guimenu">Windows
     Domain Membership</span>.
    </p></li><li class="step"><p>
     Enter the domain to join at <span class="guimenu">Domain or Workgroup</span> in
     the <span class="guimenu">Windows Domain Membership</span> screen (see
     <a class="xref" href="#fig-ad-smbclient" title="Determining Windows domain membership">Figure 7.5, “Determining Windows domain membership”</a>). If the DNS settings on your host
     are properly integrated with the Windows DNS server, enter the Active Directory
     domain name in its DNS format
     (<code class="literal">mydomain.mycompany.com</code>). If you enter the short
     name of your domain (also known as the pre–Windows 2000 domain
     name), YaST must rely on NetBIOS name resolution instead of DNS to
     find the correct domain controller.

    </p><div class="figure" id="fig-ad-smbclient"><div class="figure-contents"><div class="mediaobject"><a href="images/ad_sambaclient.png"><img src="images/ad_sambaclient.png" width="75%" alt="Determining Windows domain membership" title="Determining Windows domain membership"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 7.5: </span><span class="title-name">Determining Windows domain membership </span></span><a title="Permalink" class="permalink" href="#fig-ad-smbclient">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></li><li class="step"><p>
     To use the SMB source for Linux authentication, activate
     <span class="guimenu">Also Use SMB Information for Linux Authentication</span>.
    </p></li><li class="step"><p>
     To automatically create a local home directory for Active Directory users on the
     Linux machine, activate <span class="guimenu">Create Home Directory on
     Login</span>.
    </p></li><li class="step"><p>
     Check <span class="guimenu">Offline Authentication</span> to allow your domain
     users to log in even if the Active Directory server is temporarily unavailable, or if
     you do not have a network connection.
    </p></li><li class="step"><p>
     To change the UID and GID ranges for the Samba users and groups, select
     <span class="guimenu">Expert Settings</span>. Let DHCP retrieve
     the WINS server only if you need it. This is the case when some
     machines are resolved only by the WINS system.
    </p></li><li class="step"><p>
     Configure NTP time synchronization for your Active Directory environment by selecting
     <span class="guimenu">NTP Configuration</span> and entering an appropriate server
     name or IP address. This step is obsolete if you have already entered
     the appropriate settings in the stand-alone YaST NTP configuration
     module.
    </p></li><li class="step"><p>
     Click <span class="guimenu">OK</span> and confirm the domain join when prompted
     for it.
    </p></li><li class="step"><p>
     Provide the password for the Windows administrator on the Active Directory server and
     click <span class="guimenu">OK</span> (see <a class="xref" href="#fig-ad-join1" title="Providing administrator credentials">Figure 7.6, “Providing administrator credentials”</a>).
    </p><div class="figure" id="fig-ad-join1"><div class="figure-contents"><div class="mediaobject"><a href="images/ad_join1.png"><img src="images/ad_join1.png" width="30%" alt="Providing administrator credentials" title="Providing administrator credentials"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 7.6: </span><span class="title-name">Providing administrator credentials </span></span><a title="Permalink" class="permalink" href="#fig-ad-join1">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></li></ol></div></div><p>
   After you have joined the Active Directory domain, you can log in to it from your
   workstation using the display manager of your desktop or the console.
  </p><div id="id-1.7.4.7.6.6.5" data-id-title="Domain name" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Domain name</div><p>
    Joining a domain may not succeed if the domain name ends with
    <code class="literal">.local</code>. Names ending in <code class="literal">.local</code>
    cause conflicts with Multicast DNS (MDNS) where
    <code class="literal">.local</code> is reserved for link-local host names.
   </p></div><div id="id-1.7.4.7.6.6.6" data-id-title="Only administrators can enroll a computer" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Only administrators can enroll a computer</div><p>
    Only a domain administrator account, such as
    <code class="literal">Administrator</code>, can join <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> into Active
    Directory.
   </p></div></section><section class="sect2" id="sec-security-ad-connection" data-id-title="Checking Active Directory connection status"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.3.4 </span><span class="title-name">Checking Active Directory connection status</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-connection">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To check whether you are successfully enrolled in an Active Directory domain,
    use the following commands:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="command">klist</code> shows whether the current user has a valid
      Kerberos ticket.
     </p></li><li class="listitem"><p>
      <code class="command">getent passwd</code> shows published LDAP data for all
      users.
     </p></li></ul></div></section></section><section class="sect1" id="sec-security-ad-login" data-id-title="Logging in to an Active Directory domain"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.4 </span><span class="title-name">Logging in to an Active Directory domain</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-login">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Provided your machine has been configured to authenticate against Active
   Directory and you have a valid Windows user identity, you can log in to
   your machine using the Active Directory credentials. Login is supported for GNOME, the
   console, SSH, and any other PAM-aware application.
  </p><div id="id-1.7.4.7.7.3" data-id-title="Offline authentication" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Offline authentication</div><p>
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> supports offline authentication, allowing you to log in
    to your client machine even when it is offline. See
    <a class="xref" href="#sec-security-ad-background-offline" title="7.2.3. Offline service and policy support">Section 7.2.3, “Offline service and policy support”</a> for details.
   </p></div><section class="sect2" id="sec-security-ad-login-gui" data-id-title="GDM"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.4.1 </span><span class="title-name">GDM</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-login-gui">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To authenticate a GNOME client machine against an Active Directory server, proceed as
    follows:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Click <span class="guimenu">Not listed</span>.
     </p></li><li class="step"><p>
      In the text box <span class="guimenu">Username</span>,
      enter the domain name and the Windows user name in this form:
      <code class="literal"><em class="replaceable">DOMAIN_NAME</em>\<em class="replaceable">USER_NAME</em></code>.
     </p></li><li class="step"><p>
      Enter your Windows password.
     </p></li></ol></div></div><p>
    If configured to do so, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> creates a user home directory
    on the local machine on the first login of each user authenticated via Active Directory.
    This allows you to benefit from the Active Directory support of <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> while
    still having a fully functional Linux machine at your disposal.
   </p></section><section class="sect2" id="sec-security-ad-login-console" data-id-title="Console login"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.4.2 </span><span class="title-name">Console login</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-login-console">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Besides logging in to the Active Directory client machine using a graphical front-end,
    you can log in using the text-based console or even remotely using SSH.
   </p><p>
    To log in to your Active Directory client from a console, enter
    <code class="literal"><em class="replaceable">DOMAIN_NAME</em>\<em class="replaceable">USER_NAME</em></code>
    at the <code class="literal">login:</code> prompt and provide the password.
   </p><p>
    To remotely log in to your Active Directory client machine using SSH, proceed as
    follows:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      At the login prompt, enter:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ssh <em class="replaceable">DOMAIN_NAME</em>\\<em class="replaceable">USER_NAME</em>@<em class="replaceable">HOST_NAME</em></pre></div><p>
      The <code class="literal">\</code> domain and login delimiter is escaped with
      another <code class="literal">\</code> sign.
     </p></li><li class="step"><p>
      Provide the user's password.
     </p></li></ol></div></div></section></section><section class="sect1" id="sec-security-ad-passwd" data-id-title="Changing passwords"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.5 </span><span class="title-name">Changing passwords</span></span> <a title="Permalink" class="permalink" href="#sec-security-ad-passwd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> helps the user choose a suitable new
   password that meets the corporate security policy. The underlying PAM
   module retrieves the current password policy settings from the domain
   controller, informing the user about the specific password quality
   requirements a user account typically has by means of a message on login.
   Like its Windows counterpart, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> presents a message
   describing:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Password history settings
    </p></li><li class="listitem"><p>
     Minimum password length requirements
    </p></li><li class="listitem"><p>
     Minimum password age
    </p></li><li class="listitem"><p>
     Password complexity
    </p></li></ul></div><p>
   The password change process cannot succeed unless all requirements have
   been successfully met. Feedback about the password status is given both
   through the display managers and the console.
  </p><p>
   GDM provides feedback about password expiration and the prompt for new
   passwords in an interactive mode. To change passwords in the display
   managers, provide the password information when prompted.
  </p><p>
   To change your Windows password, you can use the standard Linux utility,
   <code class="command">passwd</code>, instead of having to manipulate this data on
   the server. To change your Windows password, proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Log in at the console.
    </p></li><li class="step"><p>
     Enter <code class="literal">passwd</code>.
    </p></li><li class="step"><p>
     Enter your current password when prompted.
    </p></li><li class="step"><p>
     Enter the new password.
    </p></li><li class="step"><p>
     Reenter the new password for confirmation. If your new password does
     not comply with the policies on the Windows server, this feedback is
     given to you and you are prompted for another password.
    </p></li></ol></div></div><p>
   To change your Windows password from the GNOME desktop, proceed as
   follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Click the <span class="guimenu">Computer</span> icon on the left edge of the
     panel.
    </p></li><li class="step"><p>
     Select <span class="guimenu">Control Center</span>.
    </p></li><li class="step"><p>
     From the <span class="guimenu">Personal</span> section, select
     <span class="guimenu">About Me</span> › <span class="guimenu">Change
     Password</span>.
    </p></li><li class="step"><p>
     Enter your old password.
    </p></li><li class="step"><p>
     Enter and confirm the new password.
    </p></li><li class="step"><p>
     Leave the dialog with <span class="guimenu">Close</span> to apply your settings.
    </p></li></ol></div></div></section><section class="sect1" id="sec-active-directory-certificate-auto-enrollment" data-id-title="Active Directory certificate auto-enrollment"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.6 </span><span class="title-name">Active Directory certificate auto-enrollment</span></span> <a title="Permalink" class="permalink" href="#sec-active-directory-certificate-auto-enrollment">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Certificate auto-enrollment enables network devices to automatically
   enroll certificates from Active Directory Certificate Services, including
   SUSE Linux Enterprise Server devices, with no user intervention. This is managed by Active Directory's
   Group Policy, using Samba's <code class="command">samba-gpupdate</code> command.
  </p><section class="sect2" id="sec-active-directory-auto-enrollment-server-configuration" data-id-title="Configuring certificate auto-enrollment on the server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.6.1 </span><span class="title-name">Configuring certificate auto-enrollment on the server</span></span> <a title="Permalink" class="permalink" href="#sec-active-directory-auto-enrollment-server-configuration">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The Windows server roles <code class="literal">Certification Authority</code>,
    <code class="literal">Certificate Enrollment Policy Web Service</code>,
    <code class="literal">Certificate Enrollment Web Service</code>, and
    <code class="literal">Network Device Enrollment Service</code> all must be installed
    and configured on the Active Directory server.
   </p><p>
    Configure Group Policy auto-enrollment as described in this Microsoft
    documentation: <a class="link" href="https://docs.microsoft.com/en-us/windows-server/networking/core-network-guide/cncg/server-certs/configure-server-certificate-autoenrollment#configure-server-certificate-auto-enrollment" target="_blank">https://docs.microsoft.com/en-us/windows-server/networking/core-network-guide/cncg/server-certs/configure-server-certificate-autoenrollment#configure-server-certificate-auto-enrollment</a>.
   </p></section><section class="sect2" id="sec-active-directory-auto-enrollment-client-configuration" data-id-title="Enable certificate auto-enrollment on the client"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.6.2 </span><span class="title-name">Enable certificate auto-enrollment on the client</span></span> <a title="Permalink" class="permalink" href="#sec-active-directory-auto-enrollment-client-configuration">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ad_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Follow the steps in the following procedure to enable certificate on
    your clients.
   </p><div class="procedure" id="pro-enable-certification-auto-enrollment-client"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Install the <span class="package">samba-gpupdate</span> package. This will
     automatically install the <span class="package">certmonger</span>,
     <span class="package">cepces</span>, and <span class="package">sscep</span> dependencies.
     Samba uses <code class="command">sscep</code> to download the Certificate
     Authority root chain, then uses the
     <code class="systemitem">certmonger</code>
     paired with <code class="systemitem">cepces</code> to monitor the host
     certificate templates.
     </p></li><li class="step"><p>
      Join to an Active Directory domain (one where the CA has been
      previously configured as explained in <a class="xref" href="#sec-active-directory-auto-enrollment-server-configuration" title="7.6.1. Configuring certificate auto-enrollment on the server">Section 7.6.1, “Configuring certificate auto-enrollment on the server”</a>).
     </p></li><li class="step"><p>
      On Winbind-joined machines, set the <code class="filename">smb.conf</code>
      global parameter by adding the line
      <code class="literal">apply group policies = yes</code>.
     </p></li><li class="step"><p>
     For SSSD-joined machines, install <span class="package">oddjob-gpupdate</span>
     from <a class="link" href="https://github.com/openSUSE/oddjob-gpupdate" target="_blank">https://github.com/openSUSE/oddjob-gpupdate</a>.
    </p></li><li class="step"><p>
     Then verify that certificate auto-enrollment is correctly configured by
     running the following command on the client:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">/usr/sbin/samba-gpupdate --rsop</code></pre></div><p>
    If you see output like the following example, it is correctly
    configured:
   </p><div class="verbatim-wrap"><pre class="screen">Resultant Set of Policy
Computer Policy
GPO: Default Domain Policy
==========================================================
CSE: gp_cert_auto_enroll_ext
-----------------------------------------------------------
Policy Type: Auto Enrollment Policy
-----------------------------------------------------------
[ &lt;<em class="replaceable">CA NAME</em>&gt; ] =
[ CA Certificate ] =
----BEGIN CERTIFICATE----
&lt;<em class="replaceable">CERTIFICATE</em>&gt;
----END CERTIFICATE----
[ Auto Enrollment Server ] = &lt;<em class="replaceable">DNS NAME</em>&gt;</pre></div></li><li class="step"><p>
       Use the following command to display installed certificates:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">getcert list</code>
 Number of certificates and requests being tracked: 1.
 Request ID 'Machine':
 status: MONITORING
 stuck: no
 key pair storage: type=FILE,location='/var/lib/samba/private/certs/Machine.key'
 certificate: type=FILE,location='/var/lib/samba/certs/Machine.crt'
 CA: &lt;<em class="replaceable">CA NAME</em>&gt;
 issuer: CN=&lt;<em class="replaceable">CA NAME</em>&gt;
 subject: CN=&lt;<em class="replaceable">HOSTNAME</em>&gt;
 expires: 2017-08-15 17:37:02 UTC
 dns: &lt;<em class="replaceable">hostname</em>&gt;
 key usage: digitalSignature,keyEncipherment
 eku: id-kp-clientAuth,id-kp-serverAuth
 certificate template/profile: Machine</pre></div></li></ol></div></div><p>
    Certificates are installed in <code class="filename">/var/lib/samba/certs</code>
    and private keys are installed in
    <code class="filename">/var/lib/samba/private</code>/certs.
   </p><p>
    For more information, see <code class="command">man samba-gpupdate</code>.
   </p></section></section></section><section class="chapter" id="cha-security-freeradius" data-id-title="Setting up a freeRADIUS server"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">8 </span><span class="title-name">Setting up a freeRADIUS server</span></span> <a title="Permalink" class="permalink" href="#cha-security-freeradius">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_freeradius.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The RADIUS (Remote Authentication Dial-In User Service) protocol has 
        long been a standard service for manage network access. It provides 
        authentication, authorization, and accounting (AAA) for very 
        large businesses such as Internet service providers and cellular 
        network providers, and is also popular for small networks. It 
        authenticates users and devices, authorizes those users and
        devices for certain network services, and tracks use of services for
        billing and auditing. You do not have to use all three of the AAA 
        protocols, but only the ones you need. For example, you may not need 
        accounting but only client authentication, or perhaps all you want is accounting, and client authorization is managed by something else.
    </p><p>
        It is extremely efficient and manages thousands of requests on modest 
        hardware. Of course, it works for all network protocols and not just 
        dial-up, but the name remains the same.
    </p><p>
        RADIUS operates in a distributed architecture, sitting separately 
        from the Network Access Server (NAS). User access data is stored on a 
        central RADIUS server that is available to multiple NAS. The NAS 
        provide the physical access to the network, such as a managed 
        Ethernet switch, or wireless access point.
    </p><p>
        FreeRADIUS is the open source RADIUS implementation, and is the most 
        widely-used RADIUS server. In this chapter you will learn how to 
        install and test a FreeRADIUS server. Because of the numerous 
        possible use cases, after your initial setup is working correctly 
        your next stop is the official documentation,
        which is detailed and thorough (see
        <a class="link" href="https://freeradius.org/documentation/" target="_blank">https://freeradius.org/documentation/</a>).
    </p><section class="sect1" id="sec-test-radiusd" data-id-title="Installation and testing on SUSE Linux Enterprise"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.1 </span><span class="title-name">Installation and testing on SUSE Linux Enterprise</span></span> <a title="Permalink" class="permalink" href="#sec-test-radiusd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_freeradius.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The following steps set up a simple test system. When you have 
        verified that the server is operating correctly and you are ready to 
        create a production configuration, you will have several undo steps 
        to perform before starting your production configuration.
    </p><p>
        First install the <code class="systemitem">freeradius-server</code> and 
        <code class="systemitem">freeradius-server-utils</code> 
        packages. Then enter <code class="filename">/etc/raddb/certs</code> and run 
        the <code class="filename">bootstrap</code> script to create a set of test 
        certificates:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">zypper in freeradius-server freeradius-server-utils</code>
<code class="prompt root"># </code><code class="command">cd /etc/raddb/certs</code>
<code class="prompt root"># </code><code class="command">./bootstrap</code></pre></div><p>
        The README in the <code class="filename">certs</code> directory contains a 
        great deal of useful information. When the 
        <code class="filename">bootstrap</code> script has completed, start the server
        in debugging mode:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">radiusd -X</code>
[...]
Listening on auth address * port 1812 bound to server default
Listening on acct address * port 1813 bound to server default
Listening on auth address :: port 1812 bound to server default
Listening on acct address :: port 1813 bound to server default
Listening on auth address 127.0.0.1 port 18120 bound to server inner-tunnel
Listening on proxy address * port 54435
Listening on proxy address :: port 58415
Ready to process requests</pre></div><p>
        When you see the "Listening" and "Ready to process requests" lines, 
        your server has started correctly. If it does not start, read the 
        output carefully because it tells you what went wrong. You may direct 
        the output to a text file with <code class="command">tee</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">radiusd -X | tee radiusd.text</code></pre></div><p>
        The next step is to test authentication with a test client and user.
        The client is a client of the RADIUS server, such as a wireless 
        access point or switch. Clients are configured in
        <code class="filename">/etc/raddb/client.conf</code>. Human users are 
        configured in 
        <code class="filename">/etc/raddb/mods-config/files/authorize</code>.
    </p><p>
        Open
        <code class="filename">/etc/raddb/mods-config/files/authorize</code> and 
        uncomment the following lines:
    </p><div class="verbatim-wrap"><pre class="screen">bob   Cleartext-Password := "hello"
Reply-Message := "Hello, %{User-Name}"</pre></div><p>
        A test client, <code class="literal">client localhost</code>, is provided in
        <code class="filename">/etc/raddb/client.conf</code>, with a secret of
        <code class="literal">testing123</code>. Open a second terminal, and as an
        unprivileged user use the <code class="command">radtest</code> command to log 
        in as bob:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">radtest bob hello 127.0.0.1 0 testing123</code>
Sent Access-Request Id 241 from 0.0.0.0:35234 to 127.0.0.1:1812 length 73
        User-Name = "bob"
        User-Password = "hello"
        NAS-IP-Address = 127.0.0.1
        NAS-Port = 0
        Message-Authenticator = 0x00
        Cleartext-Password = "hello"
Received Access-Accept Id 241 from 127.0.0.1:1812 to 0.0.0.0:0 length 20</pre></div><p>
        In your <code class="literal">radius -X</code> terminal, a successful login looks
        like this:
    </p><div class="verbatim-wrap"><pre class="screen">(3) pap: Login attempt with password
(3) pap: Comparing with "known good" Cleartext-Password
(3) pap: User authenticated successfully
(3)     [pap] = ok
[...]
(3) Sent Access-Accept Id 241 from 127.0.0.1:1812 to 127.0.0.1:35234 length 0
(3) Finished request
Waking up in 4.9 seconds.
(3) Cleaning up request packet ID 241 with timestamp +889</pre></div><p>
        Now run one more login test from a different computer on your 
        network. Create a client configuration on your server by uncommenting 
        and modifying the following entry in 
        <code class="filename">clients.conf</code>, using the IP address of your test
        machine:
    </p><div class="verbatim-wrap"><pre class="screen">client private-network-1 }
  ipaddr          = <em class="replaceable">192.0.2.0/24</em>
  secret          = testing123-1
  {</pre></div><p>
        On the client machine, install 
        <code class="systemitem">freeradius-server-utils</code>. Try logging in from the client as <code class="literal">bob</code>, using the <code class="command">radtest</code> command. It 
        is better to use the IP address of the RADIUS server rather than the 
        hostname because it is faster:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">radtest bob hello 192.168.2.100 0 testing123-1</code></pre></div><p>
        If your test logins fail, review all the output to learn what went 
        wrong. There are several test users and test clients provided. The 
        configuration files are full of useful information, and we recommend 
        studying them. When you are satisfied with your testing and ready to 
        create a production configuration, remove all the test certificates 
        in <code class="filename">/etc/raddb/certs</code> and replace them with your 
        own certificates, comment out all the test users and clients, and 
        stop <code class="command">radiusd</code> by pressing
        <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">C</span>. Manage
        the <code class="literal">radiusd.service</code> with 
        <code class="command">systemctl</code>, just like any other service.
    </p><p>
        To learn how to fit a FreeRADIUS server in your network, see
        <a class="link" href="https://freeradius.org/documentation/" target="_blank">https://freeradius.org/documentation/</a>
        and
        <a class="link" href="https://networkradius.com/freeradius-documentation/" target="_blank">https://networkradius.com/freeradius-documentation/</a>
        for in-depth references and howtos.
    </p></section></section></div><div class="part" id="part-local-security" data-id-title="Local security"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part II </span><span class="title-name">Local security </span></span><a title="Permalink" class="permalink" href="#part-local-security">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_security.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-physical-security"><span class="title-number">9 </span><span class="title-name">Physical security</span></a></span></li><dd class="toc-abstract"><p>
    Physical security should be one of the utmost concerns. Linux production
    servers should be in locked data centers accessible only to people that
    have passed security checks. Depending on the environment and
    circumstances, you can also consider boot loader passwords.
   </p></dd><li><span class="chapter"><a href="#sec-sec-software-management"><span class="title-number">10 </span><span class="title-name">Software management</span></a></span></li><dd class="toc-abstract"><p>A very important step in securing a Linux system is to determine the primary function(s) or role(s) of the Linux server. Otherwise, it can be difficult to understand what needs to be secured and securing these Linux systems can prove ineffective. Therefore, it is critical to look at the default list…</p></dd><li><span class="chapter"><a href="#sec-sec-file-management"><span class="title-number">11 </span><span class="title-name">File management</span></a></span></li><dd class="toc-abstract"><p>
    Servers should have separate file systems for at least
    <code class="filename">/</code>, <code class="filename">/boot</code>,
    <code class="filename">/var</code>,
    <code class="filename">/tmp</code>, and <code class="filename">/home</code>. This prevents,
    for example, logging space and temporary space under
    <code class="filename">/var</code> and <code class="filename">/tmp</code> from filling up
    the root partition. Third-party applications should be on separate file
    systems as well, for example under <code class="filename">/opt</code>.
   </p></dd><li><span class="chapter"><a href="#cha-security-cryptofs"><span class="title-number">12 </span><span class="title-name">Encrypting partitions and files</span></a></span></li><dd class="toc-abstract"><p>
  Encrypting files, partitions, and entire disks prevents unauthorized access to your data and protects your confidential files and documents.
 </p></dd><li><span class="chapter"><a href="#cha-configure-cryptctl"><span class="title-number">13 </span><span class="title-name">Storage encryption for hosted applications with cryptctl</span></a></span></li><dd class="toc-abstract"><p>
    Databases and similar applications are often hosted on external
    servers that are serviced by third-party staff. Certain data center
    maintenance tasks require third-party staff to directly access affected
    systems. In such cases, privacy requirements necessitate disk encryption.
   </p></dd><li><span class="chapter"><a href="#sec-sec-user-management"><span class="title-number">14 </span><span class="title-name">User management</span></a></span></li><dd class="toc-abstract"><p>It is important that all system and vendor accounts that are not used for logins are locked. To get a list of unlocked accounts on your system, you can check for accounts that do not have an encrypted password string starting with ! or * in the /etc/shadow file. If you lock an account using either p…</p></dd><li><span class="chapter"><a href="#cha-sec-cron-at"><span class="title-number">15 </span><span class="title-name">Restricting <code class="systemitem">cron</code> and <code class="systemitem">at</code></span></a></span></li><dd class="toc-abstract"><p>
    This chapter explains how to restrict access to the <code class="systemitem">cron</code> and <code class="systemitem">at</code> daemons to improve the security of a system.
   </p></dd><li><span class="chapter"><a href="#cha-spectre"><span class="title-number">16 </span><span class="title-name">Spectre/Meltdown checker</span></a></span></li><dd class="toc-abstract"><p>
    <code class="command">spectre-meltdown-checker</code> is a shell script to test if
    your system is vulnerable to the several speculative execution
    vulnerabilities that are in nearly all CPUs manufactured in the
    past 20 years. This is a hardware flaw that potentially allows an attacker
    to read all data on the system. On cloud computing services, where multiple
    virtual machines are on a single physical host, an attacker can gain access
    to all virtual machines. Fixing these vulnerabilities requires redesigning
    and replacing CPUs. Until this happens, there are several software patches
    that mitigate these vulnerabilities. If you have kept your SUSE systems
    updated, all of these patches should already be installed.
   </p><p>
    <code class="command">spectre-meltdown-checker</code> generates a detailed report. It
    is impossible to guarantee that your system is secure, but it shows you
    which mitigations are in place, and potential vulnerabilities.
   </p></dd><li><span class="chapter"><a href="#cha-security-yast-security"><span class="title-number">17 </span><span class="title-name">Configuring security settings with YaST</span></a></span></li><dd class="toc-abstract"><p>
    The YaST module <span class="guimenu">Security Center</span>
    provides a central control panel for configuring security-related settings
    for <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. Use it to configure security aspects such as
    settings for the login procedure and for password creation, for boot
    permissions, user creation, or for default file permissions. Launch it
    from the YaST control center with <span class="guimenu">Security and Users</span> › <span class="guimenu">Security Center</span>. The 
    <span class="guimenu">Security Center</span> dialog opens to
    the <span class="guimenu">Security Overview</span>, with additional
    configuration dialogs in the left and right panes.
   </p></dd><li><span class="chapter"><a href="#cha-security-polkit"><span class="title-number">18 </span><span class="title-name">The Polkit authentication framework</span></a></span></li><dd class="toc-abstract"><p>
         Polkit is an authentication framework used in graphical Linux desktop
         environments, for fine-grained management of access rights on the
         system. Traditionally, there is a strong separation of
         privileges on Linux between the <code class="systemitem">root</code> user as the fully-authorized
         administrator account, and all other accounts and groups on the
         system. These non-administrator accounts may have certain additional
         privileges, like accessing sound hardware through an
         <code class="literal">audio</code> group. This kind of
         privilege is fixed, however, and cannot be granted only in certain
         specific situations, or for a certain duration of time.
        </p><p>
         Instead of fully switching to the <code class="systemitem">root</code> user (using programs
         such as <code class="command">sudo</code>) for gaining higher privileges,
         Polkit grants specific privileges to a user or group on an
         as-needed basis. This is controlled by configuration files that
         describe individual actions that need to be authorized
	        in a dynamic context.
        </p></dd><li><span class="chapter"><a href="#cha-security-acls"><span class="title-number">19 </span><span class="title-name">Access control lists in Linux</span></a></span></li><dd class="toc-abstract"><p>
    POSIX ACLs (access control lists) can be used as an expansion of the
    traditional permission concept for file system objects. With ACLs,
    permissions can be defined more flexibly than with the traditional
    permission concept.
   </p></dd><li><span class="chapter"><a href="#cha-aide"><span class="title-number">20 </span><span class="title-name">Intrusion detection with AIDE</span></a></span></li><dd class="toc-abstract"><p>
    Securing your systems is a mandatory task for any mission-critical
    system administrator. Because it is impossible to always guarantee that
    the system is not compromised, it is very important to do extra checks
    regularly (for example with
    <code class="systemitem">cron</code>) to ensure that the system
    is still under your control. This is where AIDE, the
    <span class="emphasis"><em>Advanced Intrusion Detection Environment</em></span>, comes
    into play.
   </p></dd></ul></div><section class="chapter" id="cha-physical-security" data-id-title="Physical security"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">9 </span><span class="title-name">Physical security</span></span> <a title="Permalink" class="permalink" href="#cha-physical-security">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Physical security should be one of the utmost concerns. Linux production
    servers should be in locked data centers accessible only to people that
    have passed security checks. Depending on the environment and
    circumstances, you can also consider boot loader passwords.
   </p><p>
    Additionally, consider questions like:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Who has direct physical access to the host?
     </p></li><li class="listitem"><p>
      Of those that do, should they?
     </p></li><li class="listitem"><p>
      Can the host be protected from tampering and should it be?
     </p></li></ul></div><p>
    The amount of physical security needed on a particular system depends on
    the situation, and can also vary widely depending on available funds.
   </p><section class="sect1" id="sec-sec-prot-general-physical-locks" data-id-title="System locks"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.1 </span><span class="title-name">System locks</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-physical-locks">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Most server racks in data centers include a locking feature. Usually this
     will be a hasp/cylinder lock on the front of the rack that allows you to
     turn an included key to a locked or unlocked position—granting or
     denying entry. Cage locks can help prevent someone from tampering or
     stealing devices/media from the servers, or opening the cases and
     directly manipulating/sabotaging the hardware. Preventing system reboots
     or the booting from alternate devices is also important (for example
     CD, DVDs, flash disks, etc.).
    </p><p>
     Some servers also have case locks. These locks can do different things
     according to the designs of the system vendor and construction. Many
     systems are designed to self-disable if attempts are made to open the
     system without unlocking. Others have device covers that will not let you
     plug in or unplug keyboards or mice. While locks are sometimes a useful
     feature, they are usually lower quality and easily defeated by attackers
     with ill intent.
    </p></section><section class="sect1" id="sec-sec-prot-general-bios" data-id-title="Locking down the BIOS"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.2 </span><span class="title-name">Locking down the BIOS</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-bios">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.5.2.8.2" data-id-title="Secure boot" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Secure boot</div><p>
     This section describes only basic methods to secure the boot process. To
     find out about more advanced boot protection using UEFI and the
     secure boot feature, see <span class="intraxref">Book “Administration Guide”, Chapter 17 “UEFI (Unified Extensible Firmware Interface)”, Section 17.1 “Secure boot”</span>.
    </p></div><p>
    The BIOS (Basic Input/Output System) or its successor UEFI (Unified
    Extensible Firmware Interface) is the lowest level of software/firmware
    on PC class systems. Other hardware types (POWER, IBM Z) that run
    Linux also have low-level firmware that performs similar functions as the
    PC BIOS. When this document references the BIOS, it usually means BIOS
    and/or UEFI.
    The BIOS dictates system configuration, puts the system into a well
    defined state and provides routines for accessing low-level hardware.
    The BIOS executes the configured Linux boot loader (like GRUB 2) to
    boot the host.
   </p><p>
    Most BIOS implementations can be configured to prevent unauthorized users
    from manipulating system and boot settings. This is typically done by
    setting a BIOS admin or boot password. The admin password only needs to
    be entered for changing the system configuration but the boot password
    will be required during every normal boot. For most use cases it is
    enough to set an admin password and restrict booting to the built-in
    hard disk. This way an attacker will not be able to simply boot a Linux
    live CD or flash drive, for example. Although this does not provide a
    high level of security (a BIOS can be reset, removed or
    modified—assuming case access), it can be another deterrent.
   </p><p>
    Many BIOS firmware implementations have various other security-related
    settings. Check with the system vendor, the system documentation, or examine
    the BIOS during a system boot to find out more.
   </p><div id="id-1.7.5.2.8.6" data-id-title="Booting when a BIOS boot password is set" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Booting when a BIOS boot password is set</div><p>
     If a system has been set up with a boot password, the host will not boot
     up unattended (for example, in case of a system reboot or power failure).
     This is a trade-off.
    </p></div><div id="id-1.7.5.2.8.7" data-id-title="Losing the BIOS admin password" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Losing the BIOS admin password</div><p>
     Once a system is set up for the first time, the BIOS admin password will
     not be required often. Do not forget the password or you will need to clear
     the BIOS memory via hardware manipulation to get access again.
    </p></div></section><section class="sect1" id="sec-sec-prot-general-bootloader" data-id-title="Security via the boot loaders"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.3 </span><span class="title-name">Security via the boot loaders</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-bootloader">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The Linux boot loader GRUB 2, which is used by default in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>,
    can have a boot password set. It also provides a password feature, so
    that only administrators can start the interactive operations (for example
    editing menu entries and entering the command line interface). If a
    password is specified, GRUB 2 will disallow any interactive control until
    you press the key <span class="keycap">C</span> and <span class="keycap">E</span> and enter a
    correct password.
   </p><p>
    You can refer to the GRUB 2 man page for examples.
   </p><p>
    It is very important to keep in mind that when setting these passwords
    they will need to be remembered! Also, enabling these passwords might
    merely slow an intrusion, not necessarily prevent it. Again, someone could
    boot from a removable device, and mount your root partition. If you are
    using BIOS-level security and a boot loader, it is a good practice to
    disable the ability to boot from removable devices in your computer's
    BIOS, and then password-protect the BIOS itself.
   </p><p>
    Also keep in mind that the boot loader configuration files will need to be
    protected by changing their mode to <code class="literal">600</code> (read/write for
    <code class="systemitem">root</code> only), or others will be able to read your passwords or hashes!
   </p></section><section class="sect1" id="sec-sec-prot-general-retiring" data-id-title="Retiring Linux servers with sensitive data"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.4 </span><span class="title-name">Retiring Linux servers with sensitive data</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-retiring">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>

    Security policies usually contain some procedures for the treatment of
    storage media that is going to be retired or disposed of. Disk and media
    wipe procedures are frequently prescribed, as is complete destruction of
    the media. You can find several free tools on the Internet. A search for
    <span class="quote">“<span class="quote">dod disk wipe utility</span>”</span> will yield several variants. To
    retire servers with sensitive data, it is important to ensure that data
    cannot be recovered from the hard disks. To ensure that all traces of data
    are removed, a wipe utility—such as
    <code class="command">scrub</code>—can be used. Many wipe utilities overwrite
    the data several times. This assures that even sophisticated methods are
    not able to retrieve any parts of the wiped data. Some tools can even be
    operated from a bootable removable device and remove data according to the
    U.S. Department of Defense (DoD) standards. Note that many government
    agencies specify their own standards for data security. Some standards are
    stronger than others, yet may require more time to implement.
   </p><div id="id-1.7.5.2.10.3" data-id-title="Wiping wear leveling devices" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Wiping wear leveling devices</div><p>
     Some devices, like SSDs, use wear leveling and do not necessarily write
     new data in the same physical locations. Such devices usually provide
     their own erasing functionality.
    </p></div><section class="sect2" id="sec-sec-prot-general-retiring-scrub" data-id-title="scrub: disk overwrite utility"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.4.1 </span><span class="title-name">scrub: disk overwrite utility</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-retiring-scrub">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">scrub</code> overwrites hard disks, files, and other devices
     with repeating patterns intended to make recovering data from these
     devices more difficult. It operates in three basic modes: on a character
     or block device, on a file, or on a specified directory. For more
     information, see the manual page <code class="command">man 1 scrub</code>.
    </p><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">Supported scrub methods </span></span><a title="Permalink" class="permalink" href="#id-1.7.5.2.10.4.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.7.5.2.10.4.3.2"><span class="term">nnsa</span></dt><dd><p>
        4-pass NNSA Policy Letter NAP-14.1-C (XVI-8) for sanitizing removable
        and non-removable hard disks, which requires overwriting all locations
        with a pseudo-random pattern twice and then with a known pattern: 
        random (x2), 0x00, verify.
       </p></dd><dt id="id-1.7.5.2.10.4.3.3"><span class="term">dod</span></dt><dd><p>
        4-pass DoD 5220.22-M section 8-306 procedure (d) for sanitizing
        removable and non-removable rigid disks, which requires overwriting all
        addressable locations with a character, its complement, a random
        character, then verifying. Note: scrub performs the random pass first to
        make verification easier: random, 0x00, 0xff, verify.
       </p></dd><dt id="id-1.7.5.2.10.4.3.4"><span class="term">bsi</span></dt><dd><p>
        9-pass method recommended by the German Center of Security in
        Information Technologies
        (<a class="link" href="http://www.bsi.bund.de" target="_blank">http://www.bsi.bund.de</a>): 0xff, 0xfe, 0xfd, 0xfb,
        0xf7, 0xef, 0xdf, 0xbf, 0x7f.
       </p></dd><dt id="id-1.7.5.2.10.4.3.5"><span class="term">gutmann</span></dt><dd><p>
        The canonical 35-pass sequence described in Gutmann's paper cited
        below.
       </p></dd><dt id="id-1.7.5.2.10.4.3.6"><span class="term">schneier</span></dt><dd><p>
        7-pass method described by Bruce Schneier in "Applied Cryptography"
        (1996): 0x00, 0xff, random (x5)
       </p></dd><dt id="id-1.7.5.2.10.4.3.7"><span class="term">pfitzner7</span></dt><dd><p>
        Roy Pfitzner's 7-random-pass method: random (x7).
       </p></dd><dt id="id-1.7.5.2.10.4.3.8"><span class="term">pfitzner33</span></dt><dd><p>
        Roy Pfitzner's 33-random-pass method: random (x33).
       </p></dd><dt id="id-1.7.5.2.10.4.3.9"><span class="term">usarmy</span></dt><dd><p>
        US Army AR380-19 method: 0x00, 0xff, random. (Note: identical to DoD
        522.22-M section 8-306 procedure (e) for sanitizing magnetic core
        memory).
       </p></dd><dt id="id-1.7.5.2.10.4.3.10"><span class="term">fillzero</span></dt><dd><p>
        1-pass pattern: 0x00.
       </p></dd><dt id="id-1.7.5.2.10.4.3.11"><span class="term">fillff</span></dt><dd><p>
        1-pass pattern: 0xff.
       </p></dd><dt id="id-1.7.5.2.10.4.3.12"><span class="term">random</span></dt><dd><p>
        1-pass pattern: random (x1).
       </p></dd><dt id="id-1.7.5.2.10.4.3.13"><span class="term">random2</span></dt><dd><p>
        2-pass pattern: random (x2).
       </p></dd><dt id="id-1.7.5.2.10.4.3.14"><span class="term">old</span></dt><dd><p>
        6-pass pre-version 1.7 scrub method: 0x00, 0xff, 0xaa, 0x00, 0x55,
        verify.
       </p></dd><dt id="id-1.7.5.2.10.4.3.15"><span class="term">fastold</span></dt><dd><p>
        5-pass pattern: 0x00, 0xff, 0xaa, 0x55, verify.
       </p></dd><dt id="id-1.7.5.2.10.4.3.16"><span class="term">custom=string</span></dt><dd><p>
        1-pass custom pattern. String may contain C-style numerical escapes:
        \nnn (octal) or \xnn (hex).
       </p></dd></dl></div></section></section><section class="sect1" id="sec-sec-prot-general-removable-media" data-id-title="Restricting access to removable media"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.5 </span><span class="title-name">Restricting access to removable media</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-removable-media">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     In some environments, it is required to restrict access to removable
     media such as USB storage or optical devices. The tools included with the
     <code class="systemitem">udisks2</code> package help with such a
     configuration.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Create a user group whose users will be allowed to mount and eject
       removable devices, for example <em class="replaceable">mmedia_all</em>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> groupadd <em class="replaceable">mmedia_all</em></pre></div></li><li class="step"><p>
       Add a specific user <code class="systemitem">tux</code> to the new group:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> usermod -a -G <em class="replaceable">mmedia_all</em> <code class="systemitem">tux</code></pre></div></li><li class="step"><p>
       Create the <code class="filename">/etc/polkit-1/rules.d/10-mount.rules</code>
       file with the following content:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cat /etc/polkit-1/rules.d/10-mount.rules
polkit.addRule(function(action, subject) {
 if (action.id =="org.freedesktop.udisks2.eject-media"
  &amp;&amp; subject.isInGroup("<em class="replaceable">mmedia_all</em>")) {
   return polkit.Result.YES;
  }
});

polkit.addRule(function(action, subject) {
 if (action.id =="org.freedesktop.udisks2.filesystem-mount"
  &amp;&amp; subject.isInGroup("<em class="replaceable">mmedia_all</em>")) {
   return polkit.Result.YES;
  }
});</pre></div><div id="id-1.7.5.2.11.3.3.3" data-id-title="Naming of the rules file" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Naming of the rules file</div><p>
        The name of a rules file must start with a digit, otherwise it
        will be ignored.
       </p><p>
        Rules files are processed in alphabetical order. Functions are called
        in the order they were added until one of the functions returns a
        value. Therefore, to add an authorization rule that is processed before
        other rules, put it in a file in /etc/polkit-1/rules.d with a name
        that sorts before other rules files, for example
        <code class="filename">/etc/polkit-1/rules.d/10-mount.rules</code>. Each function
        should return a value from <code class="literal">polkit.Result</code>.
       </p></div></li><li class="step"><p>
       Restart <code class="systemitem">udisks2</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl restart udisks2</pre></div></li><li class="step"><p>
       Restart <code class="systemitem">polkit</code>
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl restart polkit</pre></div></li></ol></div></div></section><section class="sect1" id="sec-USBGuard" data-id-title="System protection with enforced USB device authorization via USBGuard"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.6 </span><span class="title-name">System protection with enforced USB device authorization via <span class="emphasis"><em>USBGuard</em></span></span></span> <a title="Permalink" class="permalink" href="#sec-USBGuard">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The USBGuard software framework helps to protect your system with enforced USB device authorization.
  It implements allowlist and blocklist capabilities based on the device attributes.
</p><p>The USBGuard provides the following features:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    A command-line interface to interact with a running USBGuard daemon
    </p></li><li class="listitem"><p>The daemon component with an inter-process communication (IPC)
    interface for dynamic interaction and policy enforcement</p></li><li class="listitem"><p>The rule language for writing USB device authorization policies</p></li><li class="listitem"><p>The C++ API for interacting with the daemon component implemented in a shared library</p></li></ul></div><section class="sect2" id="sec-installing-usbguard" data-id-title="Installing USBGuard"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.6.1 </span><span class="title-name">Installing USBGuard</span></span> <a title="Permalink" class="permalink" href="#sec-installing-usbguard">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p> The USBGuard daemon decides which USB device to authorize based on a set of rules defined in the policy.
      To install and configure USBGuard, use the following commands:</p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>To install USBGuard:</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code>  zypper install usbguard</pre></div><p>USBGuard and the required dependencies are installed. If you want to interact with the USBGuard service, you can
      install <code class="literal">usbguard-tools</code>.</p></li><li class="step"><p>To generate a rule set based on currently connected USB devices, switch to <code class="systemitem">root</code>: </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>usbguard generate-policy &gt; /etc/usbguard/rules.conf</pre></div><div id="id-1.7.5.2.12.5.3.2.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>You can customize USBGuard by editing the <code class="filename">/etc/usbguard/rules.conf</code>
      file.
      </p></div></li><li class="step"><p> You can start the USBGuard daemon or ensure automatic enablement at
      system start by switching to <code class="systemitem">root</code>:</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl enable --now usbguard.service</pre></div></li><li class="step"><p> You can either authorize or deauthorize a device from interacting with the system. Note that
      this depends on the value of the <code class="literal">ImplicitPolicyTarget</code> option in the <code class="filename">usbguard-daemon.conf
      </code> file. This option is used to treat devices that do not match any rule in the policy.
    </p><div class="verbatim-wrap"><pre class="screen">usbguard allow-device 6</pre></div><div class="verbatim-wrap"><pre class="screen">usbguard block-device 6</pre></div><p> You can also use the <code class="command">reject-device</code>option to deauthorize and
        remove a device from the system.
              </p><div id="id-1.7.5.2.12.5.3.4.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>Use the <code class="command">usbguard --help </code> command to see all the options.</p></div></li></ol></div></div></section><section class="sect2" id="sec-how-to-use-usbguard" data-id-title="How to use USBGuard"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.6.2 </span><span class="title-name">How to use USBGuard</span></span> <a title="Permalink" class="permalink" href="#sec-how-to-use-usbguard">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>You can configure a security policy to protect your system with enforced USB device authorization
  by implementing <span class="emphasis"><em>allow</em></span> and <span class="emphasis"><em>block</em></span> lists based on the device attributes.
</p><section class="sect3" id="id-1.7.5.2.12.6.3" data-id-title="The USBGuard configuration file"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.6.2.1 </span><span class="title-name">The USBGuard configuration file </span></span> <a title="Permalink" class="permalink" href="#id-1.7.5.2.12.6.3">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>The USBGuard daemon loads the <code class="filename">usbguard-daemon.conf</code> file after the command-line
  options are parsed and are used to configure the runtime parameters of the daemon. The file is by default, located at
<code class="filename">/etc/usbguard/usbguard-daemon.conf</code>. Some options in the file include:</p><div class="variablelist"><div class="title-container"><div class="variablelist-title-wrap"><div class="variablelist-title"><span class="title-number-name"><span class="title-name">Options </span></span><a title="Permalink" class="permalink" href="#id-1.7.5.2.12.6.3.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div><dl class="variablelist"><dt id="id-1.7.5.2.12.6.3.3.2"><span class="term"><code class="option">RuleFile=<em class="replaceable">PATH</em></code></span></dt><dd><p>The USBGuard daemon uses this file to load the policy rule set from it and to write
      new rules received through the IPC (inter-process communication) interface.
      The default is <code class="filename">%sysconfdir%/usbguard/rules.conf</code>.</p></dd><dt id="id-1.7.5.2.12.6.3.3.3"><span class="term"><code class="option">ImplicitPolicyTarget= <em class="replaceable">TARGET</em></code></span></dt><dd><p> How to treat devices that do not match any rule in the policy, for example: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>allow - authorize every present device</p></li><li class="listitem"><p>block - deauthorize every present device</p></li><li class="listitem"><p>reject - logically remove the device node from the system</p></li></ul></div></dd><dt id="id-1.7.5.2.12.6.3.3.4"><span class="term"><code class="option">PresentDevicePolicy= <em class="replaceable">POLICY</em></code></span></dt><dd><p>How to treat devices that are already connected when the daemon starts.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>allow - authorize every present device</p></li><li class="listitem"><p>block - deauthorize every present device</p></li><li class="listitem"><p>reject - remove every present device</p></li><li class="listitem"><p>keep - sync the internal state </p></li><li class="listitem"><p>apply-policy - evaluate the rule set for all present devices </p></li></ul></div></dd><dt id="id-1.7.5.2.12.6.3.3.5"><span class="term"><code class="option">IPCAllowedUsers= <em class="replaceable">USERNAME</em></code></span></dt><dd><p>A space-delimited list of user names that the daemon accepts IPC connections from.</p></dd><dt id="id-1.7.5.2.12.6.3.3.6"><span class="term"><code class="option">IPCAllowedGroups= <em class="replaceable">GROUPNAME</em></code></span></dt><dd><p>A space-delimited list of group names that the daemon accepts IPC connections from.</p></dd><dt id="id-1.7.5.2.12.6.3.3.7"><span class="term"><code class="option">IPCAccessControlFiles= <em class="replaceable">PATH</em></code></span></dt><dd><p>Path to files that are interpreted by the daemon as IPC access control definition files.</p></dd></dl></div><div class="complex-example"><div class="example" id="usbguard-config-file-ipcaccess" data-id-title="Configuration"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 9.1: </span><span class="title-name">Configuration </span></span><a title="Permalink" class="permalink" href="#usbguard-config-file-ipcaccess">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">IPCAllowedUsers=root joe
IPCAllowedGroups=wheel</pre></div><p>The example allows full IPC access to the users <code class="literal">root</code>,<code class="literal">joe</code>
and to the members of the group <code class="literal">wheel</code>.</p></div></div></div></section></section><section class="sect2" id="sec-more-information-usbguard" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.6.3 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-more-information-usbguard">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/physical_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>To know more about USBGuard, see: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The upstream documentation at
      <a class="link" href="https://usbguard.github.io/" target="_blank">https://usbguard.github.io/</a>
    </p></li><li class="listitem"><p>
      man <span class="emphasis"><em>usbguard</em></span>
    </p></li><li class="listitem"><p>
      man <span class="emphasis"><em>usbguard-rules.conf</em></span>
    </p></li><li class="listitem"><p>
      man <span class="emphasis"><em>usbguard-daemon</em></span>
    </p></li><li class="listitem"><p>
      man <span class="emphasis"><em>usbguard-daemon.conf</em></span>
    </p></li></ul></div></section></section></section><section class="chapter" id="sec-sec-software-management" data-id-title="Software management"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">10 </span><span class="title-name">Software management</span></span> <a title="Permalink" class="permalink" href="#sec-sec-software-management">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/software_management.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="sec-sec-prot-general-remove-packs" data-id-title="Removing unnecessary software packages (RPMs)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.1 </span><span class="title-name">Removing unnecessary software packages (RPMs)</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-remove-packs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/software_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A very important step in securing a Linux system is to determine the
    primary function(s) or role(s) of the Linux server. Otherwise, it can be
    difficult to understand what needs to be secured and securing these Linux
    systems can prove ineffective. Therefore, it is critical to look at the
    default list of software packages and remove any unnecessary packages or
    packages that do not comply with your defined security policies.
   </p><p>
    Generally, an RPM software package consists of the following:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The package's meta data that is written to the RPM database upon
      installation.
     </p></li><li class="listitem"><p>
      The package's files and directories.
     </p></li><li class="listitem"><p>
      Scripts that are being executed before and after installation and removal.
     </p></li></ul></div><p>
    Packages generally do not impose any security risk to
    the system <span class="emphasis"><em>unless</em></span> they contain:
   </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
      setuid or setgid bits on any of the installed files
     </p></li><li class="listitem"><p>
      group- or world-writable files or directories
     </p></li><li class="listitem"><p>
      a service that is activated upon installation, or by default
     </p></li></ol></div><p>
    Assuming that none of the three conditions above apply, a package is merely
    a collection of files. Neither installation nor uninstallation of such
    packages has any influence on the security value of the system.
   </p><p>
    Nevertheless, it is useful to restrict the installed packages in your system
    to a minimum. Doing this will result in fewer packages that require updates and will
    simplify maintenance efforts when security alerts and patches are
    released. It is a best practice not to install, among others, development
    packages or desktop software packages (for example, an X Server) on
    production servers. If you do not need them, you should also not install,
    for example, the Apache Web server or Samba file sharing server.
   </p><div id="id-1.7.5.3.3.9" data-id-title="Requirements of third-party installers" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Requirements of third-party installers</div><p>
     Many third-party vendors like Oracle and IBM require a desktop
     environment and development libraries to run installers. To prevent this
     from having an impact on the security of their production servers, many
     organizations work around this by creating a silent installation
     (response file) in a development lab.
    </p></div><p>
    Also, other packages like FTP and Telnet daemons should not be installed
    unless there is a justified business reason for it.
    <code class="command">ssh</code>, <code class="command">scp</code> or <code class="command">sftp</code>
    should be used as replacements.
   </p><p>
    One of the first action items should be to create a Linux image that
    <span class="emphasis"><em>only</em></span> contains RPMs needed by the system and
    applications, and those needed for maintenance and troubleshooting
    purposes. A good approach is to start with a minimum list of RPMs and then
    add packages as needed.
   </p><div id="id-1.7.5.3.3.12" data-id-title="SLES Minimal VM" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: SLES Minimal VM</div><p>
     The SUSE Linux Enterprise Server download page offers preconfigured and ready-to-run SLES Minimal VM virtual machine images. SLES Minimal VM has a small footprint and can be customized to fit specific needs of a system developer. SLES Minimal VM is designed for use in virtual machines and for virtual software appliance development. The key benefits of SLES Minimal VM are efficiency and simplified management. More information about SLES Minimal VM is available in the dedicated guide. If SLES Minimal VM does not meet your requirements, consider the minimal installation pattern.
    </p></div><p>
    To generate a list of all installed packages, use the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>zypper packages -i</pre></div><p>
    To retrieve details about a particular package, run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>zypper info <em class="replaceable">PACKAGE_NAME</em></pre></div><p>
    To check for and report potential conflicts and dependencies when deleting
    a package, run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>zypper rm -D <em class="replaceable">PACKAGE_NAME</em></pre></div><p>
    This can be very useful, as running the removal command without a test can
    often yield a lot of complaints and require manual recursive dependency
    hunting.
   </p><div id="id-1.7.5.3.3.20" data-id-title="Removal of essential system packages" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Removal of essential system packages</div><p>
     When removing packages, be careful not to remove any essential system
     packages. This could put your system into a broken state in which it can
     no longer be booted or repaired. If you are uncertain about this, then it
     is best to do a complete backup of your system before you start to
     remove any packages.
    </p></div><p>
    For the final removal of one or more packages use the following
    <code class="command">zypper</code> command with the added <span class="quote">“<span class="quote">-u</span>”</span>
    switch, which removes any unused dependencies:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>zypper rm -u <em class="replaceable">PACKAGE_NAME</em></pre></div></section><section class="sect1" id="sec-sec-prot-general-patching" data-id-title="Patching Linux systems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">10.2 </span><span class="title-name">Patching Linux systems</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-patching">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/software_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Building an infrastructure for patch management is another very important
    part of a proactive and secure Linux production environment.
   </p><p>
    It is recommended to have a written security policy and procedure to
    handle Linux security updates and issues. For example, a security policy
    should detail the time frame for assessment, testing, and roll out of
    patches. Network related security vulnerabilities should get the highest
    priority and should be addressed immediately within a short time frame.
    The assessment phase should occur within a testing lab, and initial
    rollout should occur on development systems first.
   </p><p>
    A separate security log file should contain details on which Linux
    security announcements have been received, which patches have been
    researched and assessed, when patches were applied, and so on.
   </p><p>
    SUSE releases patches in three categories: security, recommended,
    and optional. There are a few options that can be used to keep systems
    patched, up to date, and secure. Each system can register and then retrieve
    updates via the SUSE Update Web site using the included YaST
    tool—YaST Online Update. SUSE has also created the Repository Mirroring Tool
    (RMT), an efficient way to maintain a local repository of
    available/released patches/updates/fixes that systems can then pull from
    (reducing Internet traffic). SUSE also offers SUSE Manager for the
    maintenance, patching, reporting, and centralized management of Linux
    systems, not only SUSE, but other distributions as well.
   </p><section class="sect2" id="sec-sec-prot-general-patching-you" data-id-title="YaST Online Update"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.2.1 </span><span class="title-name">YaST Online Update</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-patching-you">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/software_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     On a per-server basis, installation of important updates and improvements
     is possible using the YaST Online Update tool. Current updates for the
     SUSE Linux Enterprise family are available from the product specific update catalogs
     containing patches. Installation of updates and improvements is
     accomplished using YaST and selecting <span class="guimenu">Online Update</span>
     in the <span class="guimenu">Software</span> group. All new patches (except the
     optional ones) that are currently available for your system will already
     be marked for installation. Clicking <span class="guimenu">Accept</span> will then
     automatically install these patches.
    </p></section><section class="sect2" id="sec-sec-prot-general-patching-auto" data-id-title="Automatic Online Update"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.2.2 </span><span class="title-name">Automatic Online Update</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-patching-auto">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/software_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     YaST also offers the possibility to set up an automatic update. Select
     <span class="guimenu">Software</span> › <span class="guimenu"> Automatic Online
     Update</span>. Configure a Daily or a Weekly update. Some
     patches, such as kernel updates, require user interaction, which would
     cause the automatic update procedure to stop. Check <span class="guimenu">Skip
     Interactive Patches</span> for the update procedure to proceed
     automatically.
    </p><p>
     In this case, run a manual Online Update from time to install patches
     that require interaction.
    </p><p>
     When <span class="guimenu">Only Download Patches</span> is checked, the patches are
     downloaded at the specified time but not installed. They must be
     installed manually using <code class="command">rpm</code>or
     <code class="command">zypper</code>.
    </p></section><section class="sect2" id="sec-sec-prot-general-patching-smt" data-id-title="Repository Mirroring Tool—RMT"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.2.3 </span><span class="title-name">Repository Mirroring Tool—RMT</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-patching-smt">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/software_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The Repository Mirroring Tool for SUSE Linux Enterprise goes one step further than the Online Update
     process by establishing a proxy system with repository and registration
     targets. This helps customers centrally manage software updates within
     the firewall on a per-system basis, while maintaining their corporate
     security policies and regulatory compliance.
    </p><p>
     The RMT
     (<a class="link" href="https://documentation.suse.com/sles/15-SP4/html/SLES-all/book-rmt.html" target="_blank">https://documentation.suse.com/sles/15-SP4/html/SLES-all/book-rmt.html</a>)
     is integrated with SUSE Customer Center (<a class="link" href="https://scc.suse.com/" target="_blank">https://scc.suse.com/</a>) and provides a
     repository and registration target that is synchronized with it. This can
     be very helpful in tracking entitlements in large deployments. The RMT
     maintains all the capabilities of SUSE Customer Center, while allowing a more secure
     centralized deployment. It is included with every SUSE Linux Enterprise subscription and
     is therefore fully supported.
    </p><p>
     The RMT provides an alternative to the default configuration, which
     requires opening the firewall to outbound connections for each device to
     receive updates. That requirement often violates corporate security
     policies and can be seen as a threat to regulatory compliance by some
     organizations. Through its integration with SUSE Customer Center, the RMT ensures that
     each device can receive its appropriate updates without the need to open
     the firewall, and without any redundant bandwidth requirements.
    </p><p>
     The RMT also enables customers to locally track their SUSE Linux Enterprise devices
     (that is, servers, desktops, or Point of Service terminals) throughout
     their enterprise. Now they can easily determine how many entitlements are
     in need of renewal at the end of a billing cycle without having to
     physically walk through the data center to manually update spreadsheets.
    </p><p>
     The RMT informs the SUSE Linux Enterprise devices of any available software updates.
     Each device then obtains the required software updates from the RMT.
     The introduction of the RMT improves the interaction among SUSE Linux Enterprise
     devices within the network and simplifies how they receive their system
     updates. The RMT enables an infrastructure for several hundred SUSE Linux Enterprise
     devices per instance of each installation (depending on the specific
     usage profile). This offers more accurate and efficient server tracking.
    </p><p>
     In a nutshell, the Repository Mirroring Tool for SUSE Linux Enterprise provides customers with:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       Assurance of firewall and regulatory compliance
      </p></li><li class="listitem"><p>
       Reduced bandwidth usage during software updates
      </p></li><li class="listitem"><p>
       Full support under active subscription from SUSE
      </p></li><li class="listitem"><p>
       Maintenance of existing customer interface with SUSE Customer Center
      </p></li><li class="listitem"><p>
       Accurate server entitlement tracking and effective measurement of
       subscription usage
      </p></li><li class="listitem"><p>
       Automated process to easily tally entitlement totals (no more
       spreadsheets!)
      </p></li><li class="listitem"><p>
       Simple installation process that automatically synchronizes server
       entitlement with SUSE Customer Center
      </p></li></ul></div></section><section class="sect2" id="sec-sec-prot-general-patching-suma" data-id-title="SUSE Manager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">10.2.4 </span><span class="title-name">SUSE Manager</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-patching-suma">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/software_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     SUSE Manager automates Linux server management, allowing you to provision
     and maintain your servers faster and more accurately. It monitors the
     health of each Linux server from a single console so you can identify
     server performance issues before they impact your business. And it lets
     you comprehensively manage your Linux servers across physical, virtual,
     and cloud environments while improving data center efficiency. SUSE Manager
     delivers complete lifecycle management for Linux:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       Asset management
      </p></li><li class="listitem"><p>
       Provisioning
      </p></li><li class="listitem"><p>
       Package management
      </p></li><li class="listitem"><p>
       Patch management
      </p></li><li class="listitem"><p>
       Configuration management
      </p></li><li class="listitem"><p>
       Redeployment
      </p></li></ul></div><p>
     For more information on SUSE Manager, refer to
     <a class="link" href="https://www.suse.com/products/suse-manager/" target="_blank">https://www.suse.com/products/suse-manager/</a>.
    </p></section></section></section><section class="chapter" id="sec-sec-file-management" data-id-title="File management"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">11 </span><span class="title-name">File management</span></span> <a title="Permalink" class="permalink" href="#sec-sec-file-management">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/file_management.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="sec-sec-prot-general-partitions" data-id-title="Disk partitions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.1 </span><span class="title-name">Disk partitions</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-partitions">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/file_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Servers should have separate file systems for at least
    <code class="filename">/</code>, <code class="filename">/boot</code>,
    <code class="filename">/var</code>,
    <code class="filename">/tmp</code>, and <code class="filename">/home</code>. This prevents,
    for example, logging space and temporary space under
    <code class="filename">/var</code> and <code class="filename">/tmp</code> from filling up
    the root partition. Third-party applications should be on separate file
    systems as well, for example under <code class="filename">/opt</code>.
   </p><p>
    Another advantage of separate file systems is the possibility of choosing
    special mount options that are only suitable for certain regions in the
    file system hierarchy. A number of interesting mount options are:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="literal">noexec</code>: prevents execution of files.
     </p></li><li class="listitem"><p>
      <code class="literal">nodev</code>: prevents character or block special devices
      from being usable.
     </p></li><li class="listitem"><p>
      <code class="literal">nosuid</code>: prevents the <code class="literal">set-user-ID</code>
      or <code class="literal">set-group-ID</code> bits from being effective.
     </p></li><li class="listitem"><p>
      <code class="literal">ro</code>: mounts the file system
      <code class="literal">read-only</code>.
     </p></li></ul></div><p>
    Each of these options needs to be carefully considered before applying
    it to a partition mount. Applications may stop working, or the support
    status may be violated. When applied correctly, mount options can help
    against some types of security attacks or misconfigurations. For
    example, there should be no need for <code class="literal">set-user-ID</code>
    binaries to be placed in <code class="filename">/tmp</code>.
   </p><p>
    You are advised to review <a class="xref" href="#cha-common-criteria" title="Chapter 27. Common Criteria">Chapter 27, <em>Common Criteria</em></a>. It is
    important to understand the need to separate the partitions that could
    impact a running system (for example, log files filling up
    <code class="filename">/var/log</code> are a good reason to separate
    <code class="filename">/var</code> from the <code class="filename">/</code> partition).
    Another thing to keep in mind is that you will likely need to leverage LVM
    or another volume manager or at the very least the extended partition type
    to work around the limit of four primary partitions on PC class systems.
   </p><p>
    Another capability in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> is encrypting a partition or even a
    single directory or file as a container. Refer to
    <a class="xref" href="#cha-security-cryptofs" title="Chapter 12. Encrypting partitions and files">Chapter 12, <em>Encrypting partitions and files</em></a> for details.
   </p></section><section class="sect1" id="sec-sec-prot-general-file-permissions" data-id-title="Modifying permissions of certain system files"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.2 </span><span class="title-name">Modifying permissions of certain system files</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-file-permissions">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/file_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Many files—especially in the <code class="filename">/etc</code>
   directory—are world-readable, which means that unprivileged users can
   read their contents. Normally this is not a problem, but if you want to take
   extra care, you can remove the world-readable or group-readable bits for
   sensitive files.
  </p><p>
   SUSE Linux Enterprise provides the <span class="package">permissions</span> package to easily apply
   file permissions. The package comes with three pre-defined system profiles:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.4.4.4.1"><span class="term">easy</span></dt><dd><p>
      Profile for systems that require user-friendly graphical user interaction.
      This is the default profile.
     </p></dd><dt id="id-1.7.5.4.4.4.2"><span class="term">secure</span></dt><dd><p>
      Profile for server systems without fully-fledged graphical user
      interfaces.
     </p></dd><dt id="id-1.7.5.4.4.4.3"><span class="term">paranoid</span></dt><dd><p>
      Profile for maximum security. In addition to the <code class="literal">secure</code>
      profile, it removes <span class="emphasis"><em>all</em></span> special permissions like
      setuid/setgid and capability bits.
     </p><div id="id-1.7.5.4.4.4.3.2.2" data-id-title="Unusable system for non-privileged users" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Unusable system for non-privileged users</div><p>
       Except for simple tasks like changing passwords, a system without special
       permissions might be unusable for non-privileged users.
      </p><p>
       Do not use the <code class="literal">paranoid</code> profile is as-is, but as a
       template for custom permissions. More information can be found in the
       <code class="filename">permissions.paranoid</code> file.
      </p></div></dd></dl></div><p>
   To define custom file permissions, edit
   <code class="filename">/etc/permissions.local</code> or create a drop-in file in the
   <code class="filename">/etc/permissions.d/</code> directory.
  </p><div class="verbatim-wrap"><pre class="screen"># Additional custom hardening
/etc/security/access.conf       root:root       0400
/etc/sysctl.conf                root:root       0400
/root/                          root:root       0700</pre></div><p>
   The first column specifies the file name; note that directory names must end with a
   slash. The second column specifies the owner and group, and the third column
   specifies the mode.
   For more information about the configuration file format, refer to
   <code class="command">man permissions</code>.
  </p><p>
   Select the profile in <code class="filename">/etc/sysconfig/security</code>. To use
   the <code class="literal">easy</code> profile and custom permissions from
   <code class="filename">/etc/permissions.local</code>, set:
  </p><div class="verbatim-wrap"><pre class="screen">PERMISSION_SECURITY="<em class="replaceable">easy local</em>"</pre></div><p>
   To apply the setting, run <code class="command">chkstat --system --set</code>.
  </p><p>
   The permissions will also be applied during package updates via
   <code class="command">zypper</code>. You could also call <code class="command">chkstat</code>
   regularly via <code class="systemitem">cron</code> or a <code class="systemitem">systemd</code>
   timer.
  </p><div id="id-1.7.5.4.4.12" data-id-title="Custom file permissions" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Custom file permissions</div><p>
    While the system profiles are well tested, custom permissions can break
    standard applications. SUSE cannot provide support for such scenarios.
   </p><p>
    Always test custom file permissions before applying them with
    <code class="command">chkstat</code> to make sure everything works as desired.
   </p></div></section><section class="sect1" id="sec-sec-prot-general-home-permissions" data-id-title="Changing home directory permissions from 755 to 700"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.3 </span><span class="title-name">Changing home directory permissions from 755 to 700</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-home-permissions">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/file_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   By default, home directories of users are accessible (read, execute) by all
   by users on the system. As this is a potential information leak, home
   directories should only be accessible by their owners.
  </p><p>
   The following commands will set the permissions to <code class="literal">700</code>
   (directory only accessible for the owner) for all existing home directories
   in <code class="filename">/home</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> chmod 755 /home
<code class="prompt user">&gt; </code><code class="command">sudo</code> bash -c 'for dir in /home/*; do \
echo "Changing permissions of directory $dir"; chmod 700 "$dir"; done'</pre></div><p>
   To ensure newly created home directories will be created with secure
   permissions, edit <code class="filename">/etc/login.defs</code> and set
   <code class="varname">HOME_MODE</code> to <code class="literal">700</code>.
  </p><div class="verbatim-wrap"><pre class="screen"># HOME_MODE is used by useradd(8) and newusers(8) to set the mode for new
# home directories.
# If HOME_MODE is not set, the value of UMASK is used to create the mode.
HOME_MODE      0700</pre></div><p>
   If you do not set <code class="varname">HOME_MODE</code>, permissions will be calculated
   from the default umask. Please note that <code class="varname">HOME_MODE</code>
   specifies the permissions used, not a mask used to remove access like umask.
   For more information about umask, refer to <a class="xref" href="#sec-sec-prot-general-umask" title="11.4. Default umask">Section 11.4, “Default umask”</a>.
  </p><p>
   You can verify the configuration change by creating a new user with
   <code class="command">useradd -m testuser</code>. Check the permissions of the
   directories with <code class="command">ls -l /home</code>. Afterwards, remove the user
   created for this test.
  </p><div id="id-1.7.5.4.5.9" data-id-title="Test permission changes" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Test permission changes</div><p>
    Users are no longer allowed to access other users' home directories. This
    may be unexpected for users and software.
   </p><p>
    Test this change before using it in production and notify users affected by
    the change.
   </p></div></section><section class="sect1" id="sec-sec-prot-general-umask" data-id-title="Default umask"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.4 </span><span class="title-name">Default umask</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-umask">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/file_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="command">umask</code> (user file-creation mode mask) command is a
    shell built-in command that determines the default file permissions for
    newly created files and directories. This can be overwritten by system calls
    but many programs and utilities use <code class="command">umask</code>.
   </p><p>
    By default, <code class="command">umask</code> is set to <code class="literal">022</code>.
    This umask is subtracted from the access mode <code class="literal">777</code> if at
    least one bit is set.
   </p><p>
    To determine the active umask, use the <code class="command">umask</code>
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>umask
022</pre></div><p>
    With the default umask, you see the behavior most users expect to see on a
    Linux system.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>touch a
<code class="prompt user">&gt; </code>mkdir b
<code class="prompt user">&gt; </code>ls -on
total 16
-rw-r--r--. 1 17086    0 Nov 29 15:05 a
drwxr-xr-x. 2 17086 4096 Nov 29 15:05 b</pre></div><p>
    You can specify arbitrary umask values, depending on your needs.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>umask 111
<code class="prompt user">&gt; </code>touch c
<code class="prompt user">&gt; </code>mkdir d
<code class="prompt user">&gt; </code>ls -on
total 16
-rw-rw-rw-. 1 17086    0 Nov 29 15:05 c
drw-rw-rw-. 2 17086 4096 Nov 29 15:05 d</pre></div><p>
    Based on your threat model, you can use a stricter umask such as
    <code class="literal">037</code> to prevent accidental data leakage.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>umask 037
<code class="prompt user">&gt; </code>touch e
<code class="prompt user">&gt; </code>mkdir f
<code class="prompt user">&gt; </code>ls -on
total 16
-rw-r-----. 1 17086    0 Nov 29 15:06 e
drwxr-----. 2 17086 4096 Nov 29 15:06 f</pre></div><div id="id-1.7.5.4.6.12" data-id-title="Maximum security" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Maximum security</div><p>
     For maximum security, use a umask of <code class="literal">077</code>. This will
     force newly created files and directories to be created with no
     permissions for the group and other users.
    </p><p>
     Please note that this can be unexpected for users and software and might
     cause additional load for your support team.
    </p></div><section class="sect2" id="sec-sec-prot-general-umask-adjust" data-id-title="Adjusting the default umask"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">11.4.1 </span><span class="title-name">Adjusting the default umask</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-umask-adjust">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/file_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can modify the umask globally for all users by changing the
     <code class="varname">UMASK</code> value in <code class="filename">/etc/login.defs</code>.
    </p><div class="verbatim-wrap"><pre class="screen"># Default initial "umask" value used by login(1) on non-PAM enabled systems.
# Default "umask" value for pam_umask(8) on PAM enabled systems.
# UMASK is also used by useradd(8) and newusers(8) to set the mode for new
# home directories.
# 022 is the default value, but 027, or even 077, could be considered
# for increased privacy. There is no One True Answer here: each sysadmin
# must make up their mind.
UMASK           022</pre></div><p>
     For individual users, add the umask to the 'gecos' field in
     <code class="filename">/etc/passwd</code> like this:
    </p><div class="verbatim-wrap"><pre class="screen">tux:x:1000:100:Tux Linux,UMASK=<em class="replaceable">022</em>:/home/tux:/bin/bash</pre></div><p>
     You can do the same with <code class="command">yast users</code> by adding
     <code class="literal">UMASK=<em class="replaceable">022</em></code> to a user's
     <span class="guimenu">Details</span> › <span class="guimenu">Additional User
     Information</span>.
    </p><p>
     The settings made in <code class="filename">/etc/login.defs</code> and
     <code class="filename">/etc/passwd</code> are applied by the PAM module
     <code class="filename">pam_umask.so</code>. For additional configuration options,
     refer to <code class="command">man pam_umask</code>.
    </p><p>
     In order for the changes to take effect, users need to log out and back in
     again. Afterwards, use the <code class="command">umask</code> command to verify the
     umask is set correctly.
    </p></section></section><section class="sect1" id="sec-sec-prot-general-s-bit" data-id-title="SUID/SGID files"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.5 </span><span class="title-name">SUID/SGID files</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-s-bit">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/file_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When the SUID (set user ID) or SGID (set group ID) bits are set on an
    executable, it executes with the UID or GID of the owner of the executable
    rather than that of the person executing it. This means that, for example,
    all executables that have the SUID bit set and are owned by <code class="systemitem">root</code> are
    executed with the UID of <code class="systemitem">root</code>. A good example is the <code class="command">passwd</code> command that
    allows ordinary users to update the password field in the <code class="filename">/etc/shadow</code> file,
    which is owned by <code class="systemitem">root</code>.
   </p><p>
    But SUID/SGID bits can be misused when the executable has a
    security hole. Therefore, you should search the entire system for
    SUID/SGID executables and document them. To search the entire system for SUID or SGID files, you can run the
    following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>find /bin /boot /etc /home /lib /lib64 /opt /root /sbin \
  /srv /tmp /usr /var -type f -perm '/6000' -ls</pre></div><p>
    You might need to extend the list of directories that are searched if you
    have a different file system structure.
   </p><p>
    SUSE only sets the SUID/SGID bit on binary if it is really necessary.
    Ensure that code
    developers do not set SUID/SGID bits on their programs if it is not an
    absolute requirement. Very often you can use workarounds like removing the
    executable bit for world/others. However, a better approach is to change
    the design of the software or use capabilities.
   </p><p>
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> supports file capabilities to allow more fine-grained
    privileges to be given to programs rather than the full power of <code class="systemitem">root</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>getcap -v /usr/bin/ping
/usr/bin/ping = cap_new_raw+eip</pre></div><p>
    The previous command only grants the <code class="literal">CAP_NET_RAW</code> capability
    to whoever executes <code class="command">ping</code>. In case of vulnerabilities
    inside <code class="command">ping</code>, an attacker can gain, at most, this
    capability in contrast with full <code class="systemitem">root</code>.  Whenever possible, file
    capabilities should be chosen in favor of the SUID bit. But this only
    applies when the binary is SUID to <code class="systemitem">root</code>, not to other users such as
    <code class="literal">news</code>, <code class="literal">lp</code> and similar.
   </p></section><section class="sect1" id="sec-sec-prot-general-world-writable-files" data-id-title="World-writable files"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.6 </span><span class="title-name">World-writable files</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-world-writable-files">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/file_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    World-writable files are a security risk since they can be modified by any
    user on the system. Additionally, world-writable directories allow anyone to add or
    delete files. To locate world-writable files and directories, you can use
    the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>find /bin /boot /etc /home /lib /lib64 /opt /root /sbin \
  /srv /tmp /usr /var -type f -perm -2 ! -type l -ls</pre></div><p>
   You might need to extend the list of directories that are searched if you
   have a different file system structure.
   </p><p>
    The <code class="option">! -type l</code> parameter skips all symbolic links since
    symbolic links are always world-writable. However, this is not a problem
    as long as the target of the link is not world-writable, which is checked
    by the above find command.
   </p><p>
    World-writable directories with the sticky bit such as the <code class="filename">/tmp</code>
    directory do not allow anyone except the owner of a file to delete or rename it in
    this directory.
    The sticky bit makes files stick to the user who created them, and
    prevents other users from deleting or renaming the files. Therefore,
    depending on the purpose of the directory, world-writable directories with
    the sticky bit are usually not an issue. An example is the
    <code class="filename">/tmp</code> directory:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ls -ld /tmp
drwxrwxrwt 18 root root 16384 Dec 23 22:20 /tmp</pre></div><p>
    The <code class="literal">t</code> mode bit in the output denotes the sticky bit.
   </p></section><section class="sect1" id="sec-sec-prot-general-orphaned" data-id-title="Orphaned or unowned files"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">11.7 </span><span class="title-name">Orphaned or unowned files</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-orphaned">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/file_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Files not owned by any user or group might not necessarily be a security
    problem in itself. However, unowned files could pose a security problem in
    the future. For example, if a new user is created and the new user
    happens to get the same UID as the unowned files have, then this new user
    will automatically become the owner of these files.
   </p><p>
    To locate files not owned by any user or group, use the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>find /bin /boot /etc /home /lib /lib64 /opt /root /sbin /srv /tmp /usr /var -nouser -o -nogroup</pre></div><p>
   You might need to extend the list of directories that are searched if you
   have a different file system structure.
   </p><p>
    A different problem is files that were not installed via the packaging
    system and therefore do not receive updates. You can check for such files
    with the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>find /bin /lib /lib64 /usr -path /usr/local -prune -o -type f -a -exec /bin/sh -c "rpm -qf {} &amp;&gt; /dev/null || echo {}" \;</pre></div><p>
    Run this command as an untrusted user (for example nobody) since crafted
    file names might lead to command
    execution. This shouldn't be a problem since these directories should only be writeable by <code class="systemitem">root</code>, but
    it is still a good security precaution.
   </p><p>
    This will show you all files under <code class="filename">/bin</code>,
    <code class="filename">/lib</code>, <code class="filename">/lib64</code> and
    <code class="filename">/usr</code> (with the
    exception of files in <code class="filename">/usr/local</code>) that are not tracked
    by the package manager. These files might not represent a security issue, but
    you should be aware of what is not tracked and take the necessary precautions to
    keep these files up to date.
   </p></section></section><section class="chapter" id="cha-security-cryptofs" data-id-title="Encrypting partitions and files"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">12 </span><span class="title-name">Encrypting partitions and files</span></span> <a title="Permalink" class="permalink" href="#cha-security-cryptofs">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptofs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Encrypting files, partitions, and entire disks prevents unauthorized access to your data and protects your confidential files and documents.
 </p><p>
  You can choose between the following encryption options:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.5.5.1"><span class="term">Encrypting a hard disk partition</span></dt><dd><p>
     It is possible to create an encrypted partition with YaST during
     installation or in an already installed system. For further info, see
     <a class="xref" href="#sec-security-cryptofs-y2-part-inst" title="12.1.1. Creating an encrypted partition during installation">Section 12.1.1, “Creating an encrypted partition during installation”</a> and
     <a class="xref" href="#sec-security-cryptofs-y2-part-run" title="12.1.2. Creating an encrypted partition on a running system">Section 12.1.2, “Creating an encrypted partition on a running system”</a>. This
     option can also be used for removable media, such as external hard
     disks, as described in
     <a class="xref" href="#sec-security-cryptofs-y2-removables" title="12.1.3. Encrypting the content of removable media">Section 12.1.3, “Encrypting the content of removable media”</a>.
    </p></dd><dt id="id-1.7.5.5.5.2"><span class="term">Encrypting single files with GPG</span></dt><dd><p>
     To quickly encrypt one or more files, you can use the GPG tool. See
     <a class="xref" href="#sec-security-cryptofs-gpg" title="12.2. Encrypting files with GPG">Section 12.2, “Encrypting files with GPG”</a> for more information.
    </p></dd></dl></div><div id="id-1.7.5.5.6" data-id-title="Encryption offers limited protection" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Encryption offers limited protection</div><p>
   Encryption methods described in this chapter cannot protect your running
   system from being compromised. After the encrypted volume is successfully
   mounted, everybody with appropriate permissions can access it. However,
   encrypted media are useful in case of loss or theft of your computer, or to
   prevent unauthorized individuals from reading your confidential data.
  </p></div><section class="sect1" id="sec-security-cryptofs-y2" data-id-title="Setting up an encrypted file system with YaST"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.1 </span><span class="title-name">Setting up an encrypted file system with YaST</span></span> <a title="Permalink" class="permalink" href="#sec-security-cryptofs-y2">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptofs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use YaST to encrypt partitions or parts of your file system during
   installation or in an already installed system. However, encrypting a
   partition in an already-installed system is more difficult, because you
   need to resize and change existing partitions. In such cases, it may be
   more convenient to create an encrypted file of a defined size, in which
   to <span class="emphasis"><em>store</em></span> other files or parts of your file system.
   To encrypt an entire partition, dedicate a partition for encryption in
   the partition layout. The standard partitioning proposal, as suggested by
   YaST, does not include an encrypted partition by default. Add an
   encrypted partition manually in the partitioning dialog.
  </p><section class="sect2" id="sec-security-cryptofs-y2-part-inst" data-id-title="Creating an encrypted partition during installation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.1.1 </span><span class="title-name">Creating an encrypted partition during installation</span></span> <a title="Permalink" class="permalink" href="#sec-security-cryptofs-y2-part-inst">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptofs.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.5.5.7.3.2" data-id-title="Password input" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Password input</div><p>
     Make sure to memorize the password for your encrypted partitions well.
     Without that password, you cannot access or restore the encrypted data.
    </p></div><p>
    The YaST expert dialog for partitioning offers the options needed
    for creating an encrypted partition. To create a new encrypted partition
    proceed as follows:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Run the YaST Expert Partitioner with <span class="guimenu">System</span> › <span class="guimenu">Partitioner</span>.
     </p></li><li class="step"><p>
      Select a hard disk, click <span class="guimenu">Add</span>, and select a primary
      or an extended partition.
     </p></li><li class="step"><p>
      Select the partition size or the region to use on the disk.
     </p></li><li class="step"><p>
      Select the file system, and mount point of this partition.
     </p></li><li class="step"><p>
      Activate the <span class="guimenu">Encrypt device</span> check box.
     </p><div id="id-1.7.5.5.7.3.4.5.2" data-id-title="Additional software required" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Additional software required</div><p>
       After checking <span class="guimenu">Encrypt device</span>, a pop-up window
       asking for installing additional software may appear. Confirm to
       install all the required packages to ensure that the encrypted
       partition works well.
      </p></div></li><li class="step"><p>
      If the encrypted file system needs to be mounted only when necessary,
      enable <span class="guimenu">Do not mount partition</span> in the <span class="guimenu">Fstab
      Options</span>. otherwise enable <span class="guimenu">Mount partition</span>
      and enter the mount point.
     </p></li><li class="step"><p>
      Click <span class="guimenu">Next</span> and enter a password which is used to
      encrypt this partition. This password is not displayed. To prevent
      typing errors, you need to enter the password twice.
     </p></li><li class="step"><p>
      Complete the process by clicking <span class="guimenu">Finish</span>. The
      newly-encrypted partition is now created.
     </p></li></ol></div></div><p>
    During the boot process, the operating system asks for the password
    before mounting any encrypted partition which is set to be auto-mounted
    in <code class="filename">/etc/fstab</code>. Such a partition is then available
    to all users when it has been mounted.
   </p><p>
    To skip mounting the encrypted partition during start-up, press
    <span class="keycap">Enter</span> when prompted for the password. Then decline
    the offer to enter the password again. In this case, the encrypted file
    system is not mounted and the operating system continues booting,
    blocking access to your data.
   </p><p>
    To mount an encrypted partition which is not mounted
    during the boot process, open a file manager and click the partition
    entry in the pane listing common places on your file system. You will be
    prompted for a password and the partition will be mounted.
   </p><p>
    When you are installing your system on a machine where partitions
    already exist, you can also decide to encrypt an existing partition
    during installation. In this case follow the description in
    <a class="xref" href="#sec-security-cryptofs-y2-part-run" title="12.1.2. Creating an encrypted partition on a running system">Section 12.1.2, “Creating an encrypted partition on a running system”</a> and be aware that
    this action destroys all data on the existing partition.
   </p></section><section class="sect2" id="sec-security-cryptofs-y2-part-run" data-id-title="Creating an encrypted partition on a running system"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.1.2 </span><span class="title-name">Creating an encrypted partition on a running system</span></span> <a title="Permalink" class="permalink" href="#sec-security-cryptofs-y2-part-run">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptofs.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.5.5.7.4.2" data-id-title="Activating encryption on a running system" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Activating encryption on a running system</div><p>
     It is also possible to create encrypted partitions on a running system.
     However, encrypting an existing partition destroys all data on it, and
     requires re-sizing and restructuring of existing partitions.
    </p></div><p>
    On a running system, select <span class="guimenu">System</span> › <span class="guimenu">Partitioner</span> in the YaST control
    center. Click <span class="guimenu">Yes</span> to proceed. In the <span class="guimenu">Expert
    Partitioner</span>, select the partition to encrypt and click
    <span class="guimenu">Edit</span>. The rest of the procedure is the same as
    described in <a class="xref" href="#sec-security-cryptofs-y2-part-inst" title="12.1.1. Creating an encrypted partition during installation">Section 12.1.1, “Creating an encrypted partition during installation”</a>.
   </p></section><section class="sect2" id="sec-security-cryptofs-y2-removables" data-id-title="Encrypting the content of removable media"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">12.1.3 </span><span class="title-name">Encrypting the content of removable media</span></span> <a title="Permalink" class="permalink" href="#sec-security-cryptofs-y2-removables">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptofs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    YaST treats removable media (like external hard disks or flash
    disks) the same as any other storage device. Virtual disks or partitions on
    external media can be encrypted as described above. However, you should disable
    mounting at boot time, because removable media is usually connected only
    when the system is up and running.
   </p><p>
    If you encrypted your removable device with YaST, the GNOME desktop
    automatically recognizes the encrypted partition and prompts for the
    password when the device is detected. If you plug in a FAT-formatted
    removable device when running GNOME, the desktop user entering the
    password automatically becomes the owner of the device.
    For devices with a file system other than FAT, change the
    ownership explicitly for users other than <code class="systemitem">root</code> to give them
    read-write access to the device.
   </p></section></section><section class="sect1" id="sec-security-cryptofs-gpg" data-id-title="Encrypting files with GPG"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">12.2 </span><span class="title-name">Encrypting files with GPG</span></span> <a title="Permalink" class="permalink" href="#sec-security-cryptofs-gpg">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptofs.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   GNU Privacy Guard (GPG) encryption software can be used to encrypt individual files and documents.
  </p><p>
   To encrypt a file with GPG, you need to generate a key pair first. To do
   this, run the <code class="command">gpg --gen-key</code> and follow the on-screen
   instructions. When generating the key pair, GPG creates a user ID (UID) to
   identify the key based on your real name, comments, and email address. You
   need this UID (or just a part of it like your first name or email address)
   to specify the key you want to use to encrypt a file. To find the UID of 
   an existing key, use the <code class="command">gpg --list-keys</code> command. To 
   encrypt a file use the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>gpg -e -a --cipher-algo AES256 -r <em class="replaceable">UID</em> <em class="replaceable">FILE</em></pre></div><p>
    Replace <em class="replaceable">UID</em> with part of the UID (for example,
    your first name) and <em class="replaceable">FILE</em> with the file you 
    want to encrypt. For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>gpg -e -a --cipher-algo AES256 -r Tux secret.txt</pre></div><p>
    This command creates an encrypted version of the specified file
    recognizable by the <code class="filename">.asc</code> file extension (in
    this example, it is <code class="filename">secret.txt.asc</code>).
  </p><p>
    <code class="command">-a</code> formats the file as ASCII text, if you want the 
    contents to be copy-able. Omit <code class="command">-a</code> to create a binary
    file, which in the above example would be <code class="filename">secret.txt.gpg</code>.
  </p><p>
    To decrypt an encrypted file, use the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>gpg -d -o <em class="replaceable">DECRYPTED_FILE</em> <em class="replaceable">ENCRYPTED_FILE</em></pre></div><p>
    Replace <em class="replaceable">DECRYPTED_FILE</em> with the desired name for
    the decrypted file and <em class="replaceable">ENCRYPTED_FILE</em> with the
    encrypted file you want to decrypt.
  </p><p>
    Keep in mind that the encrypted file can be only decrypted using the same
    key that was used for encryption. If you want to share an encrypted file
    with another person, you have to use that person's public key to encrypt
    the file.
  </p></section></section><section class="chapter" id="cha-configure-cryptctl" data-id-title="Storage encryption for hosted applications with cryptctl"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">13 </span><span class="title-name">Storage encryption for hosted applications with cryptctl</span></span> <a title="Permalink" class="permalink" href="#cha-configure-cryptctl">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptctl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Databases and similar applications are often hosted on external
    servers that are serviced by third-party staff. Certain data center
    maintenance tasks require third-party staff to directly access affected
    systems. In such cases, privacy requirements necessitate disk encryption.
   </p><p>
    <code class="command">cryptctl</code> allows encrypting sensitive directories using
    LUKS and offers the following additional features:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Encryption keys are located on a central server, which can be located on
      customer premises.
     </p></li><li class="listitem"><p>
      Encrypted partitions are automatically remounted after an unplanned
      reboot.
     </p></li></ul></div><p>
   <code class="command">cryptctl</code> consists of two components:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     A client is a machine that has one or more encrypted partitions but does
     not permanently store the necessary key to decrypt those partitions.
     For example, clients can be cloud or otherwise hosted machines.
    </p></li><li class="listitem"><p>
     The server holds encryption keys that can be requested by clients to
     unlock encrypted partitions.
    </p><p>
     You can also set up the <code class="command">cryptctl</code> server to store
     encryption keys on a KMIP 1.3-compatible (Key Management
     Interoperability Protocol) server. In that case, the
     <code class="command">cryptctl</code> server will not store the encryption keys of
     clients and is dependent upon the KMIP-compatible server to provide
     these.
    </p></li></ul></div><div id="id-1.7.5.6.7" data-id-title="cryptctl Server maintenance" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: <code class="command">cryptctl</code> Server maintenance</div><p>
    Since the <code class="command">cryptctl</code> server manages timeouts for the
    encrypted disks and, depending on the configuration, can also hold
    encryption keys, it
    should be under your direct control and managed only by trusted
    personnel.
   </p><p>
    Additionally, it should be backed up regularly. Losing the server's data
    means losing access to encrypted partitions on the clients.
   </p></div><p>
   To handle encryption, <code class="command">cryptctl</code> uses LUKS with
   aes-xts-256 encryption and 512-bit keys. Encryption keys are transferred
   using TLS with certificate verification.
  </p><div class="figure" id="fig-cryptctl-retrieve"><div class="figure-contents"><div class="mediaobject"><a href="images/cryptctl-keyretrieval.png"><img src="images/cryptctl-keyretrieval.png" alt="The client asks the server for the disk decryption key, the server responds" title="The client asks the server for the disk decryption key, the server responds"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 13.1: </span><span class="title-name">Key retrieval with <code class="command">cryptctl</code> (model without connection to KMIP server) </span></span><a title="Permalink" class="permalink" href="#fig-cryptctl-retrieve">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptctl.xml" title="Edit source document"> </a></div></div></div><div id="id-1.7.5.6.10" data-id-title="Install cryptctl" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Install <code class="command">cryptctl</code></div><p>
    Before continuing, make sure the package <span class="package">cryptctl</span> is
    installed on all machines you intend to set up as servers or clients.
   </p></div><section class="sect1" id="sec-configure-cryptctl-server" data-id-title="Setting up a cryptctl server"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.1 </span><span class="title-name">Setting up a <code class="command">cryptctl</code> server</span></span> <a title="Permalink" class="permalink" href="#sec-configure-cryptctl-server">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptctl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Before you can define a machine as a <code class="command">cryptctl</code> client,
    you need to set up a machine as a <code class="command">cryptctl</code> server.
   </p><p>
    Before beginning, choose whether to use a self-signed certificate to
    secure communication between the server and clients. If not, generate a
    TLS certificate for the server and have it signed by a certificate
    authority.
   </p><p>
    Additionally, you can have clients authenticate to the server using
    certificates signed by a certificate authority. To use this extra
    security measure, make sure to have a CA certificate at hand before
    starting this procedure.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      As <code class="systemitem">root</code>, run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">cryptctl init-server</code></pre></div></li><li class="step"><p>
      Answer each of the following prompts and press <span class="keycap">Enter</span>
      after every answer. If there is a default answer, it is shown in square
      brackets at the end of the prompt.
     </p><ol type="a" class="substeps"><li class="step"><p>
        Create a very strong password, and protect it well. This password
        will unlock all partitions that are registered on the server.
       </p></li><li class="step"><p>
        Specify the path to a PEM-encoded TLS certificate or certificate chain
        file or leave the field empty to create a self-signed certificate. If
        you specify a path, use an absolute path.
       </p></li><li class="step"><p>
        If you want the server to be identified by a host name other than the
        default shown, specify a host name. <code class="command">cryptctl</code> will
        then generate certificates which include the host name.
       </p></li><li class="step"><p>
        Specify the IP address that belongs to the network interface that you
        want to listen on for decryption requests from the clients, then set
        a port number (the default is port 3737).
       </p><p>
        The default IP address setting,
        <code class="systemitem">0.0.0.0</code> means that
        <code class="command">cryptctl</code> will listen on
        all network interfaces for client requests using IPv4.
       </p></li><li class="step"><p>
        Specify a directory on the server that will hold the decryption keys
        for clients.
       </p></li><li class="step"><p>
        Specify whether clients need to authenticate to the server using a
        TLS certificate. If you choose <span class="guimenu">No</span>, this means that
        clients authenticate using disk UUIDs only. (However, communication
        will be encrypted using the server certificate in any case.)
       </p><p>
        If you choose <span class="guimenu">Yes</span>, pick a PEM-encoded certificate
        authority to use for signing client certificates.
       </p></li><li class="step"><p>
        Specify whether to use a KMIP 1.3-compatible server (or multiple such
        servers) to store encryption keys of clients. If you choose this
        option, provide the host names and ports for one or multiple
        KMIP-compatible servers.
       </p><p>
        Additionally, provide a user name, password, a CA certificate for the
        KMIP server, and a client identity certificate for the
        <code class="command">cryptctl</code> server.
       </p><div id="id-1.7.5.6.11.5.2.2.7.3" data-id-title="No easy reconfiguration of KMIP setting" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: No easy reconfiguration of KMIP setting</div><p>
         The setting to use a KMIP server cannot easily be changed later. To
         change this setting, both the <code class="command">cryptctl</code> server and
         its clients need to be configured afresh.
        </p></div></li><li class="step"><p>
        Finally, configure an SMTP server for e-mail notifications for
        encryption and decryption requests or leave the prompt empty to skip
        setting up e-mail notifications.
       </p><div id="id-1.7.5.6.11.5.2.2.8.2" data-id-title="Password-protected servers" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Password-protected servers</div><p>
         <code class="command">cryptctl</code> currently cannot send e-mail using
         authentication-protected SMTP servers. If that is necessary, set up
         a local SMTP proxy.
        </p></div></li><li class="step"><p>
        When asked whether to start the <code class="command">cryptctl</code> server,
        enter <code class="literal">y</code>.
       </p></li></ol></li><li class="step"><p>
      To check the status of the service
      <code class="systemitem">cryptctl-server</code>, use:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">systemctl status cryptctl-server</code></pre></div></li></ol></div></div><p>
    To reconfigure the server later, do either of the following:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Run the command <code class="command">cryptctl init-server</code> again.
      <code class="command">cryptctl</code> will then propose the existing settings as
      the defaults, so that you only need to specify the values that you want
      to change.
     </p></li><li class="listitem"><p>
      Make changes directly in the configuration file
      <code class="filename">/etc/sysconfig/cryptctl-server</code>.
     </p><p>
      However, to avoid issues, do not change the settings
      <code class="option">AUTH_PASSWORD_HASH</code> and
      <code class="option">AUTH_PASSWORD_SALT</code> manually. The values of these
      options need to be calculated correctly.
     </p></li></ul></div></section><section class="sect1" id="sec-configure-cryptctl-client" data-id-title="Setting up a cryptctl client"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.2 </span><span class="title-name">Setting up a <code class="command">cryptctl</code> client</span></span> <a title="Permalink" class="permalink" href="#sec-configure-cryptctl-client">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptctl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following interactive setup of <code class="command">cryptctl</code> is
    currently the only setup method.
   </p><p>
    Make sure the following preconditions are fulfilled:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      A <code class="command">cryptctl</code> server is available over the network.
     </p></li><li class="listitem"><p>
      There is a directory to encrypt.
     </p></li><li class="listitem"><p>
      The client machine has an empty partition available that is large
      enough to fit the directory to encrypt.
     </p></li><li class="listitem"><p>
      When using a self-signed certificate, the certificate
      (<code class="filename">*.crt</code> file) generated on the server is
      available locally on the client. Otherwise, the certificate authority
      of the server certificate must be trusted by the client.
     </p></li><li class="listitem"><p>
      If you set up the server to require clients to authenticate using a
      client certificate, prepare a TLS certificate for the client which is
      signed by the CA certificate you chose for the server.
     </p></li></ul></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      As <code class="systemitem">root</code>, run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">cryptctl encrypt</code></pre></div></li><li class="step"><p>
      Answer each of the following prompts and press <span class="keycap">Enter</span>
      after every answer. If there is a default answer, it is shown in square
      brackets at the end of the prompt.
     </p><ol type="a" class="substeps"><li class="step"><p>
        Specify the host name and port to connect to on the
        <code class="command">cryptctl</code> server.
       </p></li><li class="step"><p>
        If you configured the server to have clients authenticate to it using a
        TLS certificate, specify a certificate and a key file for the client.
        The client certificate must be signed by the certificate
        authority chosen when setting up the server.
       </p></li><li class="step"><p>
        Specify the absolute path to the server certificate (the
        <code class="filename">*.crt</code> file).
       </p></li><li class="step"><p>
        Enter the encryption password that you specified when setting up the
        server.
       </p></li><li class="step"><p>
        Specify the path to the directory to encrypt. Specify the path to the
        empty partition that will contain the encrypted content of the
        directory.
       </p></li><li class="step"><p>
        Specify the number of machines that are allowed to decrypt the
        partition simultaneously.
       </p><p>
        Then specify the timeout in seconds before additional machines are
        allowed to decrypt the partition after the last vital sign was
        received from the client or clients.
       </p><p>
        When a machine unexpectedly stops working and then reboots, it needs to
        be able to unlock its partitions again. That means this timeout
        should be set to a time slightly shorter than the reboot time of the
        client.
       </p><div id="id-1.7.5.6.12.5.2.2.6.4" data-id-title="Timeout length" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Timeout length</div><p>
         If the time is set too long, the machine cannot decrypt
         encrypted partitions on the first try. <code class="command">cryptctl</code> will
         then continue to periodically check whether the encryption key has
         become available. However, this will introduce a delay.
        </p><p>
         If the timeout is set too short, machines with a copy of
         the encrypted partition have an increased chance of unlocking the
         partition first.
        </p></div></li></ol></li><li class="step"><p>
      To start encryption, enter <code class="literal">yes</code>.
     </p><p>
      <code class="command">cryptctl</code> will now encrypt the specified directory to
      the previously empty partition and then mount the newly encrypted
      partition. The file system type will be of the same type as the
      original unencrypted file system.
     </p><p>
      Before creating the encrypted partition,
      <code class="command">cryptctl</code> moves the unencrypted content of the
      original directory to a location prefixed with
      <code class="literal">cryptctl-moved-</code>.
     </p></li><li class="step"><p>
      To check that the directory is indeed mounted correctly, use:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">lsblk -o NAME,MOUNTPOINT,UUID</code>
NAME                        MOUNTPOINT          UUID
[...]
sdc
└─sdc1                                          <em class="replaceable">PARTITION_UUID</em>
  └─cryptctl-unlocked-sdc1  /secret-partition   <em class="replaceable">UNLOCKED_UUID</em></pre></div><p>
      <code class="command">cryptctl</code> identifies the encrypted partition by its
      UUID. For the previous example, that is the UUID displayed next to
      <code class="literal">sdc1</code>.
     </p><p>
      On the server, you can check whether the directory was decrypted using
      <code class="command">cryptctl</code>.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">cryptctl list-keys</code></pre></div><p>
      For a successfully decrypted partition, you will see output like:
     </p><div class="verbatim-wrap"><pre class="screen">2019/06/06 15:50:00 ReloadDB: successfully loaded database of 1 records
Total: 1 records (date and time are in zone EDT)
Used By     When                 UUID  Max.Users  Num.Users  Mount Point
<em class="replaceable">IP_ADDRESS</em>  2019-06-06 15:00:50  <em class="replaceable">UUID</em>  1          1          /secret-partition</pre></div><p>
      For a partition not decrypted successfully, you will see output like:
     </p><div class="verbatim-wrap"><pre class="screen">2019/06/06 15:50:00 ReloadDB: successfully loaded database of 1 records
Total: 1 records (date and time are in zone EDT)
Used By      When                 UUID  Max.Users  Num.Users  Mount Point
             2019-06-06 15:00:50  <em class="replaceable">UUID</em>  1          1          /secret-partition</pre></div><p>See the difference in the empty <code class="literal">Used by</code> column.</p><p>
      Verify that the UUID shown is that of the previously encrypted partition.
     </p></li><li class="step"><p>
      After verifying that the encrypted partition works, delete the
      unencrypted content from the client. For example, use <code class="command">rm</code>.
      For more
      safety, overwrite the content of the files before deleting them, for
      example, using <code class="command">shred -u</code>.
     </p><div id="id-1.7.5.6.12.5.5.2" data-id-title="shred does not guarantee that data is completely erased" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: <code class="command">shred</code> does not guarantee that data is completely erased</div><p>
       Depending on the type of storage media, using
       <code class="command">shred</code> is not a guarantee that all data is
       completely removed. In particular, SSDs usually employ wear leveling
       strategies that render <code class="command">shred</code> ineffective.
      </p></div></li></ol></div></div><p>
    The configuration for the connection from client to server is stored in
    <code class="filename">/etc/sysconfig/cryptctl-client</code> and can be edited
    manually.
   </p><p>
    The server stores an encryption key for the client partition in
    <code class="filename">/var/lib/cryptctl/keydb/<em class="replaceable">PARTITION_UUID</em></code>.
   </p></section><section class="sect1" id="sec-cryptctl-luks-fstab" data-id-title="Configuring /etc/fstab for LUKS volumes"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.3 </span><span class="title-name">Configuring /etc/fstab for LUKS volumes</span></span> <a title="Permalink" class="permalink" href="#sec-cryptctl-luks-fstab">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptctl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When configuring the mount point for a new file system encrypted with
    LUKS, YaST will use, by default, the name of the encrypted device
    in <code class="filename">/etc/fstab</code>.
    (For example, <code class="filename">/dev/mapper/cr_sda1</code>.) Using the
    device name, rather than the UUID or volume label, results in a more robust
    operation of systemd generators and other related tools.
   </p><p>
    You have the option to adjust that default behavior for each device,
    either with the Expert Partitioner in the installer, or via AutoYaST.
   </p><p>
    This change does not affect upgrades or any other scenario in which the
    mount points are already defined in <code class="filename">/etc/fstab</code>.
    Only newly created mount points are affected, such as during the
    installation of a new system, or creating new partitions on running
    systems.
   </p></section><section class="sect1" id="sec-configure-cryptctl-status" data-id-title="Checking partition unlock status using server-side commands"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.4 </span><span class="title-name">Checking partition unlock status using server-side commands</span></span> <a title="Permalink" class="permalink" href="#sec-configure-cryptctl-status">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptctl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When a <code class="command">cryptctl</code> client is active, it will send a
    <span class="quote">“<span class="quote">heartbeat</span>”</span> to the <code class="command">cryptctl</code> server every
    10 seconds. If the server does not receive a heartbeat from the client
    for the length of the timeout configured during the client setup, the
    server will assume that the client is offline. It will then allow another
    client to connect (or allow the same client to reconnect after a reboot).
   </p><p>
    To see the usage status of all keys, use:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">cryptctl list-keys</code></pre></div><p>
    The information under <code class="literal">Num. Users</code> shows whether the key
    is currently in use. To see more detail on a single key, use:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">cryptctl show-key <em class="replaceable">UUID</em></code></pre></div><p>
    This command will show information about mount point, mount options,
    usage options, the last retrieval of the key, and the last three
    heartbeats from clients.
   </p><p>
    Additionally, you can use <code class="command">journalctl</code> to find logs of
    when keys were retrieved.
   </p></section><section class="sect1" id="sec-configure-cryptctl-unlock" data-id-title="Unlocking encrypted partitions manually"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.5 </span><span class="title-name">Unlocking encrypted partitions manually</span></span> <a title="Permalink" class="permalink" href="#sec-configure-cryptctl-unlock">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptctl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There are two ways of unlocking a partition manually, both of which are run
    on a client:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title">Online unlocking. </span>
       Online unlocking allows circumventing timeout or user limitations.
       This method can be used when there is a network connection between
       client and server but the client could not (yet) unlock the partition
       automatically. This method will unlock all encrypted
       partitions on a machine.
      </p><p>
      To use it, run <code class="command">cryptctl online-unlock</code>. Be prepared to
      enter the password specified when setting up the server.
     </p></li><li class="listitem"><p><span class="formalpara-title">Offline unlocking. </span>
       This method can be used when a client cannot or must not be brought
       online to communicate with its server. The encryption key from the
       server must still be available. This method is meant as a last resort
       only and can only unlock a single partition at a time.
      </p><p>
      To use it, run <code class="command">cryptctl offline-unlock</code>. The
      server's key file for the requisite partition
      (<code class="filename">/var/lib/cryptctl/keydb/<em class="replaceable">PARTITION_UUID</em></code>)
      needs to be available on the client.
     </p></li></ul></div></section><section class="sect1" id="sec-configure-cryptctl-lock" data-id-title="Maintenance downtime procedure"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.6 </span><span class="title-name">Maintenance downtime procedure</span></span> <a title="Permalink" class="permalink" href="#sec-configure-cryptctl-lock">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptctl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To ensure that partitions cannot be decrypted during a maintenance
    downtime, turn off the client and disable the
    <code class="command">cryptctl</code> server. You can do so by either:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Stopping the service
      <code class="systemitem">cryptctl-server</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">systemctl stop cryptctl-server</code></pre></div></li><li class="listitem"><p>
      Unplugging the <code class="command">cryptctl</code> server from the network.
     </p></li></ul></div></section><section class="sect1" id="sec-configure-cryptctl-more" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.7 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-configure-cryptctl-more">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cryptctl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For more information, also see the project home page
   <a class="link" href="https://github.com/SUSE/cryptctl/" target="_blank">https://github.com/SUSE/cryptctl/</a>.
  </p></section></section><section class="chapter" id="sec-sec-user-management" data-id-title="User management"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">14 </span><span class="title-name">User management</span></span> <a title="Permalink" class="permalink" href="#sec-sec-user-management">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="sec-sec-prot-general-accounts" data-id-title="Various account checks"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.1 </span><span class="title-name">Various account checks</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-accounts">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-sec-prot-general-accounts-unlocked" data-id-title="Unlocked accounts"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.1.1 </span><span class="title-name">Unlocked accounts</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-accounts-unlocked">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     It is important that all system and vendor accounts that are not used for
     logins are locked. To get a list of unlocked accounts on your system, you
     can check for accounts that do <span class="emphasis"><em>not</em></span> have an encrypted
     password string starting with <code class="literal">!</code> or
     <code class="literal">*</code> in the <code class="filename">/etc/shadow</code> file. If you
     lock an account using either <code class="command">passwd</code> <code class="option">-l</code> or
     <code class="command">usermod</code> <code class="option">-L</code>, it
     puts a <code class="literal">!</code> in front of the encrypted password,
     effectively disabling the password. Many system and
     shared accounts are locked by default by having a
     <code class="literal">*</code> ,<code class="literal">!!</code> or <code class="literal">!*</code> as the password field which
     renders the encrypted password into an invalid string. Hence, to get a
     list of all unlocked (encryptable) accounts, run the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>egrep -v ':\*|:\!' /etc/shadow | awk -F: '{print $1}'</pre></div><p>
     Also make sure all accounts have an <code class="literal">x</code> in the password
     field in <code class="filename">/etc/passwd</code>. The following command lists
     all accounts that do not have a <code class="literal">x</code> in the password
     field:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>grep -v ':x:' /etc/passwd</pre></div><p>
     An <code class="literal">x</code> in the password field means that the password
     has been shadowed, for example, the encrypted password needs to be looked
     up in the <code class="filename">/etc/shadow</code> file. If the password field in
     <code class="filename">/etc/passwd</code> is empty, then the system will not look
     up the shadow file and it will not prompt the user for a password at the
     login prompt.
    </p></section><section class="sect2" id="sec-sec-prot-general-accounts-unused" data-id-title="Unused accounts"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.1.2 </span><span class="title-name">Unused accounts</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-accounts-unused">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     All system or vendor accounts that are not being used by users,
     applications, by the system or by daemons should be removed from the
     system. You can use the following command to find out if there are any
     files owned by a specific account:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>find / -path /proc -prune -o -user <em class="replaceable">ACCOUNT</em> -ls</pre></div><p>
     The <code class="option">-prune</code> option in this example is used to skip the
     /proc file system. If you are sure that an account can be deleted, you
     can remove the account using the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>userdel -r <em class="replaceable">ACCOUNT</em></pre></div><p>
     Without the <code class="option">-r</code> option, <code class="command">userdel</code> will
     not delete the user's home directory and mail spool
     (<code class="filename">/var/spool/mail/<em class="replaceable">USER</em></code>).
     Note that many system accounts have no home directory.
    </p></section></section><section class="sect1" id="sec-sec-prot-general-pw-aging" data-id-title="Enabling password aging"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.2 </span><span class="title-name">Enabling password aging</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-pw-aging">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Password expiration is a general best practice, but might need to
    be excluded for some system and shared accounts (for example, Oracle). Expiring passwords on those accounts could lead to system outages if
    the application account expires.
   </p><p>
    Typically a corporate policy should be developed that dictates
    rules/procedures regarding password changes for system and shared
    accounts. However, normal user account passwords should expire
    automatically. The following example shows how password expiration can be
    set up for individual user accounts.
   </p><p>
    The following files and parameters in the table can be used when a new
    account is created with the <code class="command">useradd</code> command. Settings
    such as these are stored for each user account in the
    <code class="filename">/etc/shadow</code> file. If using the YaST tool
    (<span class="guimenu">User and Group Management</span>) to add users, the settings
    are available on a per-user basis. Here are the various
    settings, some of which can also be system-wide (for example,
    modification of <code class="filename">/etc/login.defs</code> and
    <code class="filename">/etc/default/useradd</code>):
   </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/><col/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="filename">/etc/login.defs</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">PASS_MAX_DAYS</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Maximum number of days a password is valid.
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="filename">/etc/login.defs</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">PASS_MIN_DAYS</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Minimum number of days before a user can change the password since
         the last change.
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="filename">/etc/login.defs</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">PASS_WARN_AGE</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Number of days between the last password change and the next
         password change reminder.
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="filename">/etc/default/useradd</code>
        </p>
       </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">INACTIVE</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
          Number of days after password expiration until the account is
          disabled.
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="filename">/etc/default/useradd</code>
        </p>
       </td><td style="border-right: 1px solid ; ">
        <p>
         <code class="literal">EXPIRE</code>
        </p>
       </td><td>
        <p>
         Account expiration date in the format YYYY-MM-DD.
        </p>
       </td></tr></tbody></table></div><div id="id-1.7.5.7.4.6" data-id-title="Existing users not affected" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Existing users not affected</div><p>
     Users created prior to these modifications will not be affected.
    </p></div><p>
    Ensure that the above parameters are changed in the
    <code class="filename">/etc/login.defs</code> and
    <code class="filename">/etc/default/useradd</code> files. Review of the
    <code class="filename">/etc/shadow</code> file will show how these settings are
    stored after adding a user.
   </p><p>
    To create a new user account, execute the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>useradd -c "<em class="replaceable">TEST_USER</em>" -g <em class="replaceable">USERS</em> <em class="replaceable">TEST</em></pre></div><p>
    The <code class="option">-g</code> option specifies the primary group for this
    account:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>id <em class="replaceable">TEST</em>
uid=509(test) gid=100(users) groups=100(users)</pre></div><p>
    The settings in <code class="filename">/etc/login.defs</code> and
    <code class="filename">/etc/default/useradd</code> are recorded for the test user
    in the <code class="filename">/etc/shadow</code> file as follows:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>grep <em class="replaceable">TEST</em> /etc/shadow
test:!!:12742:7:60:7:14::</pre></div><p>
    Password aging can be modified at any time by use of the
    <code class="command">chage</code> command. To disable password aging for system and
    shared accounts, you can run the following <code class="command">chage</code>
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>chage -M -1 <em class="replaceable">SYSTEM_ACCOUNT_NAME</em></pre></div><p>
    To get password expiration information:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>chage -l <em class="replaceable">SYSTEM_ACCOUNT_NAME</em></pre></div><p>
    For example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>chage -l <em class="replaceable">TEST</em>
Minimum: 7
Maximum: 60
Warning: 7
Inactive: 14
Last Change: Jan 11, 2015
Password Expires: Mar 12, 2015
Password Inactive: Mar 26, 2015
Account Expires: Never</pre></div></section><section class="sect1" id="sec-sec-prot-general-pw-strength" data-id-title="Stronger password enforcement"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.3 </span><span class="title-name">Stronger password enforcement</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-pw-strength">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    On an audited system, it is important to restrict people from using simple
    passwords that can be cracked too easily. Writing down complex passwords
    is all right as long as they are stored securely. Some will argue that
    strong passwords protect you against dictionary attacks, and those types of
    attacks can be defeated by locking accounts after a few failed attempts.
    However, this is not always an option. If set up like this, locking system
    accounts could bring down your applications and systems, which would be
    nothing short of a denial-of-service attack—another issue.
   </p><p>
    At any rate, it is important to practice effective password management
    security. Most companies require that passwords have, at the very least, a
    number, one lowercase letter, and one uppercase letter. Policies vary, but
    maintaining a balance between password strength/complexity and management
    can be difficult.
   </p></section><section class="sect1" id="sec-sec-prot-general-pam" data-id-title="Password and login management with PAM"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.4 </span><span class="title-name">Password and login management with PAM</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-pam">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/hardening_pam_stack.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Linux-PAM (Pluggable Authentication Modules for Linux) is a suite of
     shared libraries that enable the local system administrator to choose
     how applications authenticate users.
    </p><p>
     It is strongly recommended to familiarize oneself with the capabilities
     of PAM and how this architecture can be leveraged to provide the
     best authentication setup for an environment. This configuration can be
     done once, and implemented across all systems (a standard), or can be
     enhanced for individual hosts (enhanced security—by
     host/service/application).
     The key is to realize how flexible the architecture is.
    </p><p>
     To learn more about the PAM architecture, find PAM documentation in
     the <code class="filename">/usr/share/doc/packages/pam</code> directory (in
     a variety of formats).
    </p><p>
     The following discussions are examples of how to modify the default PAM
     stacks—specifically around password policies—for
     example password strength, password re-use, and account locking. While
     these are only a few of the possibilities, they serve as a good start
     and demonstrate PAM's flexibility.
    </p><div id="id-1.7.5.7.6.6" data-id-title="pam-config limitations" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: <code class="command">pam-config</code> limitations</div><p>
            The <code class="command">pam-config</code> tool can be used to configure the 
            common-{account,auth,password,session} PAM configuration files, which
            contain global options. These files include the following comment:
        </p><div class="verbatim-wrap"><pre class="screen"># This file is autogenerated by pam-config. All changes
# will be overwritten.</pre></div><p>
            Individual service files, such as <code class="filename">login, password, sshd</code>, 
            and <code class="filename">su</code> must be edited directly. You can elect to edit 
            all files directly, and not use <code class="command">pam-config</code>, though
            <code class="command">pam-config</code> includes useful features such as converting
            an older configuration, updating your current configuration, and sanity checks. 
            For more information, see <code class="command">man 8 pam-config</code>.
        </p></div><section class="sect2" id="sec-sec-prot-general-pam-pw-strength" data-id-title="Password strength"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.4.1 </span><span class="title-name">Password strength</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-pam-pw-strength">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/hardening_pam_stack.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> can leverage the
      <code class="systemitem">pam_cracklib</code> library to test
      for weak passwords—and to suggest using a stronger one if it
      determines obvious weakness. The following parameters represent an
      example that could be part of a corporate password policy or something
      required because of audit constraints.
     </p><p>
      The PAM libraries follow a defined flow. The best way to design the
      perfect stack usually is to consider all of the requirements and
      policies and draw out a flow chart.
     </p><div class="table" id="id-1.7.5.7.6.7.4" data-id-title="Sample rules/constraints for password enforcement"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 14.1: </span><span class="title-name">Sample rules/constraints for password enforcement </span></span><a title="Permalink" class="permalink" href="#id-1.7.5.7.6.7.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/hardening_pam_stack.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/><col/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
          <p>
           <code class="systemitem">pam_cracklib.so</code>
          </p>
         </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
          <p>
           <code class="literal">minlen=8</code>
          </p>
         </td><td style="border-bottom: 1px solid ; ">
          <p>
           Minimum length of password is 8
          </p>
         </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
          <p>
           <code class="systemitem">pam_cracklib.so</code>
          </p>
         </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
          <p>
           <code class="literal">lcredit=-1</code>
          </p>
         </td><td style="border-bottom: 1px solid ; ">
          <p>
           Minimum number of lowercase letters is 1
          </p>
         </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
          <p>
           <code class="systemitem">pam_cracklib.so</code>
          </p>
         </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
          <p>
           <code class="literal">ucredit=-1</code>
          </p>
         </td><td style="border-bottom: 1px solid ; ">
          <p>
           Minimum number of uppercase letters is 1
          </p>
         </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
          <p>
           <code class="systemitem">pam_cracklib.so</code>
          </p>
         </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
          <p>
           <code class="literal">dcredit=-1</code>
          </p>
         </td><td style="border-bottom: 1px solid ; ">
          <p>
           Minimum number of digits is 1
          </p>
         </td></tr><tr><td style="border-right: 1px solid ; ">
          <p>
           <code class="systemitem">pam_cracklib.so</code>
          </p>
         </td><td style="border-right: 1px solid ; ">
          <p>
           <code class="literal">ocredit=-1</code>
          </p>
         </td><td>
          <p>
           Minimum number of other characters is 1
          </p>
         </td></tr></tbody></table></div></div><p>
      To set up these password restrictions, use the
      <code class="command">pam-config</code> tool to specify the parameters you want
      to configure. For example, the minimum length parameter could be
      modified like this:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> pam-config -a --cracklib-minlen=8 --cracklib-retry=3 \
--cracklib-lcredit=-1 --cracklib-ucredit=-1 --cracklib-dcredit=-1 \
--cracklib-ocredit=-1 --cracklib</pre></div><p>
      Now verify that the new password restrictions work for new passwords.
      Log in to a non-root account and change the password using the
      <code class="command">passwd</code> command. Note that the above requirements
      are not enforced if you run the <code class="command">passwd</code> command
      under root.
     </p></section><section class="sect2" id="sec-sec-prot-general-pam-pw-previous" data-id-title="Restricting use of previous passwords"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.4.2 </span><span class="title-name">Restricting use of previous passwords</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-pam-pw-previous">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/hardening_pam_stack.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      The pam_pwhistory module can be used to configure the number of
      previous passwords that cannot be reused. The following command
      implements password restrictions on a system so that a password cannot
      be reused for at least six months:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> pam-config -a --pwhistory --pwhistory-remember=26</pre></div><p>
      Recall that in the section
      <a class="xref" href="#sec-sec-prot-general-pw-aging" title="14.2. Enabling password aging">Section 14.2, “Enabling password aging”</a> we set
      <code class="literal">PASS_MIN_DAYS</code> to <code class="literal">7</code>, which
      specifies the minimum number of days allowed between password changes.
      Therefore, if <code class="systemitem">pam_unix</code> is configured to
      remember <code class="literal">26</code> passwords, then the previously used
      passwords cannot be reused for at least six months (26*7 days).
     </p><p>
      The PAM configuration (<code class="filename">/etc/pam.d/common-password</code>)
      resulting from the <code class="command">pam-config</code> command looks like the
      following:
     </p><div class="verbatim-wrap"><pre class="screen">auth      required   pam_env.so
auth      required   pam_unix.so     try_first_pass
account   required   pam_unix.so     try_first_pass
password  requisit   pam_cracklib.so
password  required   pam_pwhistory.so        remember=26
password  optional   pam_gnome_keyring.so    use_authtok
password  required   pam_unix.so     use_authtok nullok shadow try_first_pass
session   required   pam_limits.so
session   required   pam_unix.so     try_first_pass
session   optional   pam_umask.so</pre></div></section><section class="sect2" id="sec-sec-prot-general-pam-lock-accounts" data-id-title="Locking user accounts after too many login failures"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.4.3 </span><span class="title-name">Locking user accounts after too many login failures</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-general-pam-lock-accounts">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/hardening_pam_stack.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Locking accounts after a defined number of failed ssh, login, su, or sudo
      attempts is a common security practice. However, this could lead to
      outages if an application, admin, or <code class="systemitem">root</code> user is locked out.
     </p><div id="id-1.7.5.7.6.9.3" data-id-title="Denial-of-service attacks" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Denial-of-service attacks</div><p>
       Password failure counts can easily be abused to cause denial-of-service
       attacks by deliberately creating login failures.
      </p><p>
       Only use password failure counts if you have to. Restrict locking to the
       necessary minimum, and do not lock critical accounts. Keep in mind that
       locking not only applies to human users but also to system accounts used
       to provide services.
      </p></div><p>
      <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> does not lock accounts by default, but provides PAM module
      <code class="command">pam_tally2</code> to easily implement password failure counts.
      Add the following line to the top of <code class="filename">/etc/pam.d/login</code>
      to lock out all users (except for <code class="systemitem">root</code>) after six failed logins, and
      to automatically unlock the accounts after ten minutes:
     </p><div class="verbatim-wrap"><pre class="screen">auth required pam_tally2.so deny=6 unlock_time=600</pre></div><p>
         This is an example of a complete <code class="filename">/etc/pam.d/login</code> file:
     </p><div class="verbatim-wrap"><pre class="screen">#%PAM-1.0
auth     requisite      pam_nologin.so
auth     include        common-auth
auth     required       pam_tally2.so deny=6 unlock_time=600
account  include        common-account
account  required       pam_tally2.so
password include        common-password
session  required       pam_loginuid.so
session  include        common-session
#session  optional       pam_lastlog.so nowtmp showfailed
session  optional       pam_mail.so standard</pre></div><p>
      You can also lock out <code class="systemitem">root</code>, though obviously you must be very
      certain you want to do this:
     </p><div class="verbatim-wrap"><pre class="screen">auth required pam_tally2.so deny=6 even_deny_root unlock_time=600</pre></div><p>
      You can define a different lockout time for root:
     </p><div class="verbatim-wrap"><pre class="screen">auth required pam_tally2.so deny=6 root_unlock_time=120  unlock_time=600</pre></div><p>
     If you want to require the administrator to unlock accounts, leave out the
     <code class="literal">unlock_time</code> option. The next two example commands
     display the number of failed login attempts and how to unlock a user
     account:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">pam_tally2 -u <em class="replaceable">username</em></code>
Login           Failures Latest failure     From
username            6    12/17/19 13:49:43  pts/1

<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">pam_tally2 -r -u <em class="replaceable">username</em></code></pre></div><p>
      The default location for attempted accesses is recorded in
      <code class="filename">/var/log/tallylog</code>.
     </p><p>
      If the user succeeds in logging in after the login timeout expires, or
      after the administrator resets their account, the counter resets to 0.
     </p><p>
      Configure other login services to use <code class="command">pam_tally2</code> in
      their individual configuration files in <code class="filename">/etc/pam.d/</code>:
      <code class="filename">sshd, su, sudo, sudo-i</code>, and <code class="filename">su-l</code>.
     </p></section></section><section class="sect1" id="sec-sec-prot-restrict-root" data-id-title="Restricting root logins"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.5 </span><span class="title-name">Restricting <code class="systemitem">root</code> logins</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-restrict-root">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    By default, the <code class="systemitem">root</code> user is assigned a password
    and can log in using various methods—for example, on a local
    terminal, in a graphical session, or remotely via SSH. These methods
    should be restricted as far as possible. Shared usage of the root account
    should be avoided. Instead, individual administrators should use tools such as
    <code class="literal">su</code> or <code class="literal">sudo</code> (for more information,
    type <code class="command">man 1 su</code> or <code class="command">man 8 sudo</code>) to obtain elevated
    privileges. This allows associating <code class="systemitem">root</code> logins with particular
    users. This also adds another layer of security; not only the <code class="systemitem">root</code>
    password, but both the <code class="systemitem">root</code> <span class="emphasis"><em>and</em></span> the password of
    an administrator's regular account would need to be compromised to gain full root
    access. This section explains how to limit direct root logins on the different
    levels of the system.
   </p><section class="sect2" id="sec-sec-prot-restrict-root-tty" data-id-title="Restricting local text console logins"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.5.1 </span><span class="title-name">Restricting local text console logins</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-restrict-root-tty">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     TTY devices provide text-mode system access via the console. For desktop
     systems these are accessed via the local keyboard or—in case of server
     systems—via input devices connected to a KVM switch or a remote
     management card (for example, ILO and DRAC).
     By default, Linux offers six different consoles, which can be switched to
     via the key combinations
     <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F1</span> to
     <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F6</span>, when
     running in text mode, or
     <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F1</span> to
     <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F6</span>
      when running in a graphical session. The
      associated terminal devices are named <code class="literal">tty1</code> to <code class="literal">tty6</code>.
    </p><p>
     The following steps restrict root access to the first TTY. Even this
     access method is only meant for emergency access to the system and should
     never be used for everyday system administration tasks.
    </p><div id="id-1.7.5.7.7.3.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      The steps shown here are tailored towards PC architectures (x86 and
      AMD64/Intel 64). On architectures such as POWER, different terminal
      device names than <code class="literal">tty1</code> can be used. Be careful not to
      lock yourself out completely by specifying wrong terminal device names.
      You can determine the device name of the terminal you are currently
      logged in to by running the <code class="literal">tty</code> command. Be careful
      not to do this in a virtual terminal, such as via SSH or in a graphical
      session (device names <code class="filename">/dev/pts/<em class="replaceable">N</em></code>),
      but only from an actual login terminal reachable via
      <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F<em class="replaceable">N</em></span>.
     </p></div><div class="procedure" id="id-1.7.5.7.7.3.5" data-id-title="Restricting root logins on local TTYs"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 14.1: </span><span class="title-name">Restricting root logins on local TTYs </span></span><a title="Permalink" class="permalink" href="#id-1.7.5.7.7.3.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Ensure that the PAM stack configuration file <code class="filename">/etc/pam.d/login</code>
       contains the <code class="literal">pam_securetty</code> module in the <code class="literal">auth</code> block:
      </p><div class="verbatim-wrap"><pre class="screen">auth     requisite      pam_nologin.so
 auth     [user_unknown=ignore success=ok ignore=ignore auth_err=die default=bad] pam_securetty.so noconsole
 auth     include        common-auth</pre></div><p>
        This will include the <code class="literal">pam_securetty</code> module during the
        authentication process on local consoles, which restricts <code class="systemitem">root</code> to logging in
        only on TTY devices that are listed in the file <code class="filename">/etc/securetty</code>.
      </p></li><li class="step"><p>
       Remove all entries from <code class="filename">/etc/securetty</code> except one.
       This limits the access to TTY devices for root.
      </p><div class="verbatim-wrap"><pre class="screen">#
# This file contains the device names of tty lines (one per line,
# without leading /dev/) on which root is allowed to login.
#
tty1</pre></div></li><li class="step"><p>
       Check whether logins to other terminals will be rejected for
       <code class="systemitem">root</code>. A login on <code class="literal">tty2</code>, for example, should be
       rejected immediately, without even querying the account password.
       Also make sure that you can still successfully log in to
       <code class="literal">tty1</code> and thus that <code class="systemitem">root</code> is not locked out of
       the system completely.
      </p></li></ol></div></div><div id="id-1.7.5.7.7.3.6" data-id-title="Do not add pam_securetty module" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Do not add pam_securetty module</div><p>
      Do not add the <code class="literal">pam_securetty</code> module to the
      <code class="filename">/etc/pam.d/common-auth</code> file. This would
      break the <code class="command">su</code> and <code class="command">sudo</code> commands,
      because these tools would then also reject <code class="systemitem">root</code> authentications.
     </p></div><div id="id-1.7.5.7.7.3.7" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
      These configuration changes will also cause root logins on serial
      consoles such as <code class="filename">/dev/ttyS0</code> to be denied. In case you
      require such use cases, you need to list the respective TTY devices
      additionally in the <code class="filename">/etc/securetty</code> file.
     </p></div></section><section class="sect2" id="sec-sec-prot-retrict-root-graphical" data-id-title="Restricting graphical session logins"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.5.2 </span><span class="title-name">Restricting graphical session logins</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-retrict-root-graphical">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     To improve security on your server, avoid using graphical
     environments at all. Graphical programs are often
     not designed to be run as <code class="systemitem">root</code> and are more likely to
     contain security issues than console programs. If you require a graphical
     login, use a non-<code class="systemitem">root</code> login. Configure your system to disallow
     <code class="systemitem">root</code> from logging in to graphical sessions.
    </p><p>
     To prevent <code class="systemitem">root</code> from logging in to graphical sessions, you
     can apply the same basic steps as outlined in
     <a class="xref" href="#sec-sec-prot-restrict-root-tty" title="14.5.1. Restricting local text console logins">Section 14.5.1, “Restricting local text console logins”</a>.
     Just add the <code class="literal">pam_securetty</code> module to the PAM
     stack file belonging to the display manager—for example,
     <code class="filename">/etc/pam.d/gdm</code> for GDM. The graphical
     session also runs on a TTY device: by default, <code class="literal">tty7</code>.
     Therefore, if you restrict <code class="systemitem">root</code> logins to <code class="literal">tty1</code>,
     then <code class="systemitem">root</code> will be denied login in the graphical session.
    </p></section><section class="sect2" id="sec-sec-prot-restrict-root-ssh" data-id-title="Restricting SSH logins"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.5.3 </span><span class="title-name">Restricting SSH logins</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-restrict-root-ssh">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     By default, the <code class="systemitem">root</code> user is also allowed to log
     in to a machine remotely via the SSH network protocol (if the SSH port is
     not blocked by the firewall). To restrict this, make the following
     change to the OpenSSH configuration:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>Edit <code class="filename">/etc/ssh/sshd_config</code> and adjust the following parameter:</p><div class="verbatim-wrap"><pre class="screen">PermitRootLogin no</pre></div></li><li class="step"><p>Restart the <code class="systemitem">sshd</code> service to make the changes effective:</p><div class="verbatim-wrap"><pre class="screen">systemctl restart sshd.service</pre></div></li></ol></div></div><div id="id-1.7.5.7.7.5.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      Using the PAM <code class="literal">pam_securetty</code> module is not suitable in
      case of OpenSSH, because not all SSH logins go through the PAM
      stack during authorization (for example, when using SSH public-key authentication).
      In addition, an attacker could differentiate between a wrong password
      and a successful login that was only rejected later on by policy.
     </p></div></section></section><section class="sect1" id="sec-sec-prot-restrict-sudo" data-id-title="Restricting sudo users"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.6 </span><span class="title-name">Restricting <code class="command">sudo</code> users</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-restrict-sudo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="command">sudo</code> command allows users to execute commands in the
    context of another user, typically the <code class="systemitem">root</code> user. The
    <code class="command">sudo</code> configuration consists of a rule-set that defines
    the mappings between commands to execute and their allowed source and target
    users and groups. The configuration is stored in the file
    <code class="filename">/etc/sudoers</code>.
    
    <span class="phrase">For more information about <code class="command">sudo</code>,
     refer to <span class="intraxref">Book “Administration Guide”, Chapter 2 “<code class="command">sudo</code> basics”</span>.</span>
   </p><p>
    By default, <code class="command">sudo</code> asks for the <code class="systemitem">root</code> password on
    SUSE systems. Unlike <code class="command">su</code> however,
    <code class="command">sudo</code> remembers the password and allows further commands
    to be executed as <code class="systemitem">root</code> without asking for the password again for five
    minutes. Therefore, <code class="command">sudo</code> should be enabled for selected
    administrator users only.
   </p><div class="procedure" id="id-1.7.5.7.8.4" data-id-title="Restricting sudo for normal users"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 14.2: </span><span class="title-name">Restricting <code class="command">sudo</code> for normal users </span></span><a title="Permalink" class="permalink" href="#id-1.7.5.7.8.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Edit file <code class="filename">/etc/sudoers</code>, for example by executing
      <code class="command">visudo</code>.
     </p></li><li class="step"><p>
      Comment out the line that allows every user to run every command as
      long as they know the password of the user they want to use. Afterwards,
      it should look like this:
     </p><div class="verbatim-wrap"><pre class="screen">#ALL ALL=(ALL) ALL # WARNING! Only use this together with 'Defaults targetpw'!</pre></div></li><li class="step"><p>
      Uncomment the following line:
     </p><div class="verbatim-wrap"><pre class="screen">%wheel ALL=(ALL) ALL</pre></div><p>
      This limits the functionality described above to members of the group
      <code class="systemitem">wheel</code>. You can use a different
      group as <code class="systemitem">wheel</code> might have other
      implications that may not be suitable depending on your setup.
     </p></li><li class="step"><p>
      Add users that should be allowed to use <code class="command">sudo</code> to the
      chosen group. To add the user <code class="systemitem">tux</code> to the group
      <code class="systemitem">wheel</code>, use:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="command">usermod -aG <em class="replaceable">wheel</em> <em class="replaceable">tux</em></code></pre></div><p>
      To get the new group membership, users have to log out and back in again.
     </p></li><li class="step"><p>
      Verify the change by running a command with a user not in the group you
      have chosen for access control. You should see the error message:
     </p><div class="verbatim-wrap"><pre class="screen">wilber is not in the sudoers file.  This incident will be reported.</pre></div><p>
      Next, try the same with a member of the group. They should still be able
      to execute commands via <code class="command">sudo</code>.
     </p></li></ol></div></div><p>
    Please note that this configuration only limits the <code class="command">sudo</code>
    functionality. The <code class="command">su</code> command is still available to all
    users. If there are other ways to access the system, users with knowledge of
    the <code class="systemitem">root</code> password can easily execute commands via this vector.
   </p></section><section class="sect1" id="sec-sec-prot-inactivity-logout" data-id-title="Setting an inactivity timeout for interactive shell sessions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.7 </span><span class="title-name">Setting an inactivity timeout for interactive shell sessions</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-inactivity-logout">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    It can be a good idea to terminate an interactive shell session after a
    certain period of inactivity. For example, to prevent open, unguarded sessions,
    or to avoid wasting system resources.
   </p><p>
    By default, there is no inactivity timeout for shells. Nothing will
    happen if a shell stays open and unused for days or even years. However,
    it is possible
    to configure most shells so that idle sessions terminate
    automatically after a certain amount of time. The following example
    shows how to set an inactivity timeout for a number of
    common types of shells.
   </p><p>
    The inactivity timeout can be configured for login shells only or for all
    interactive shells. In the latter case, the inactivity timeout runs
    individually for each shell instance. This means that timeouts will
    accumulate. When a sub- or child-shell is started, a new timeout begins for
    the sub- or child-shell, and only afterwards will the
    timeout of the parent continue running.
   </p><p>
    The following table contains configuration details for a selection of
    common shells shipped with <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>:
   </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/><col class="col_4"/><col class="col_5"/><col class="col_6"/><col class="col_7"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">package</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">shell personalities</th><th style="text-align: center; border-right: 1px solid ; border-bottom: 1px solid ; ">shell variable</th><th style="text-align: center; border-right: 1px solid ; border-bottom: 1px solid ; ">time unit</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">readonly setting</th><th style="text-align: center; border-right: 1px solid ; border-bottom: 1px solid ; ">config path (only login shell)</th><th style="text-align: center; border-bottom: 1px solid ; ">config path (all shells)</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">bash</code></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">bash, sh</code></p></td><td style="text-align: center; border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">TMOUT</code></p></td><td style="text-align: center; border-right: 1px solid ; border-bottom: 1px solid ; "><p>seconds</p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">read-only TMOUT=</code></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">/etc/profile.local</code>, <code class="filename">/etc/profile.d/</code></p></td><td style="border-bottom: 1px solid ; "><p><code class="filename">/etc/bash.bashrc</code></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">mksh</code></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">ksh, lksh, mksh, pdksh</code></p></td><td style="text-align: center; border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">TMOUT</code></p></td><td style="text-align: center; border-right: 1px solid ; border-bottom: 1px solid ; "><p>seconds</p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">read-only TMOUT=</code></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">/etc/profile.local</code>, <code class="filename">/etc/profile.d/</code></p></td><td style="border-bottom: 1px solid ; "><p><code class="filename">/etc/ksh.kshrc.local</code></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">tcsh</code></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">csh, tcsh</code></p></td><td style="text-align: center; border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">autologout</code></p></td><td style="text-align: center; border-right: 1px solid ; border-bottom: 1px solid ; "><p>minutes</p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="literal">set -r autologout=</code></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p><code class="filename">/etc/csh.login.local</code></p></td><td style="border-bottom: 1px solid ; "><p><code class="filename">/etc/csh.cshrc.local</code></p></td></tr><tr><td style="border-right: 1px solid ; "><p><code class="literal">zsh</code></p></td><td style="border-right: 1px solid ; "><p><code class="literal">zsh</code></p></td><td style="text-align: center; border-right: 1px solid ; "><p><code class="literal">TMOUT</code></p></td><td style="text-align: center; border-right: 1px solid ; "><p>seconds</p></td><td style="border-right: 1px solid ; "><p><code class="literal">readonly TMOUT=</code></p></td><td style="border-right: 1px solid ; "><p><code class="filename">/etc/profile.local</code>, <code class="filename">/etc/profile.d/</code></p></td><td><p><code class="filename">/etc/zsh.zshrc.local</code></p></td></tr></tbody></table></div><p>
    Every listed shell supports an internal timeout shell variable that can be
    set to a specific time value to cause the inactivity timeout. If you want
    to prevent users from overriding the timeout setting, you can mark the
    corresponding shell timeout variable as read-only. The corresponding variable
    declaration syntax is also found in the table above.
   </p><div id="id-1.7.5.7.9.8" data-id-title="No protection from hostile users" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: No protection from hostile users</div><p>
     This feature is only helpful for avoiding risks if a user is forgetful or follows
     unsafe practices. It does not protect against hostile users. The timeout
     only applies to interactive wait states of a shell. A malicious user can always
     find ways to circumvent the timeout and keep their session open regardless.
    </p></div><p>
    To configure the inactivity timeout, you need to add the matching timeout
    variable declaration to each shell's start-up script. Use either the path for
    login shells only, or the one for all shells, as listed in the table. The
    following example uses paths and settings that are suitable for
    <code class="command">bash</code> and <code class="command">ksh</code>
    to set up a read-only login shell timeout that cannot be overridden by users.
    Create the file <code class="filename">/etc/profile.d/timeout.sh</code> with the
    following content:
   </p><div class="verbatim-wrap"><pre class="screen"># /etc/profile.d/timeout.sh for SUSE Linux
#
# Timeout in seconds until the bash/ksh session is terminated
# in case of inactivity.
# 24h = 86400 sec
readonly TMOUT=86400</pre></div><div id="id-1.7.5.7.9.11" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     We recommend using the <code class="command">screen</code> tool in order to
     detach sessions before logging out. <code class="command">screen</code> sessions
     are not terminated and can be re-attached whenever required. An active
     session can be locked without logging out (read about <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">A</span><span class="key-connector">–</span><span class="keycap">X</span> / <code class="command">lockscreen</code> in
     <code class="command">man screen</code> for details).
    </p></div></section><section class="sect1" id="sec-sec-prot-dos" data-id-title="Preventing accidental denial of service"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.8 </span><span class="title-name">Preventing accidental denial of service</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-dos">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Linux allows you to set limits on the amount of system resources that
    users and groups can consume. This is also very handy if bugs in programs
    cause them to use up too many resources (for example, memory leaks), slow
    down the machine, or even render the system unusable. Incorrect settings
    can allow programs to use too many resources, which may make the server
    unresponsive to new connections or even local logins (for example, if a
    program uses up all available file handles on the host). This can also be
    a security concern if someone is allowed to consume all system resources
    and therefore cause a denial-of-service attack—either unplanned, or
    worse, planned. Setting resource limits for users and groups may be an
    effective way to protect systems, depending on the environment.
   </p><section class="sect2" id="sec-sec-prot-dos-restrict-ressources" data-id-title="Example for restricting system resources"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">14.8.1 </span><span class="title-name">Example for restricting system resources</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-dos-restrict-ressources">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The following example demonstrates the practical usage of setting or
     restricting system resource consumption for an Oracle user account. For a
     list of system resource settings, see
     <code class="filename">/etc/security/limits.conf</code> or <code class="command">man
     limits.conf</code>.
    </p><p>
     Most shells, such as Bash, provide control over various resources (for
     example, the maximum allowable number of open file descriptors or the
     maximum number of processes) that are available on a per-user basis. To
     examine all current limits in the shell, execute:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ulimit -a</pre></div><p>
     For more information on <code class="command">ulimit</code> for the Bash shell,
     examine the Bash man pages.
    </p><div id="id-1.7.5.7.10.3.6" data-id-title="Setting limits for SSH sessions" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Setting limits for SSH sessions</div><p>
      Setting <span class="quote">“<span class="quote">hard</span>”</span> and <span class="quote">“<span class="quote">soft</span>”</span> limits might not have
      the expected results when using an SSH session. To see valid behavior, it
      may be necessary to log in as root, and then <code class="command">su</code> to the
      ID with limits (for example, <code class="literal">Oracle</code> in these examples).
      Resource limits should also work assuming the application was started
      automatically during the boot process. It may be necessary to set
      <code class="option">UsePrivilegeSeparation</code> in
      <code class="filename">/etc/ssh/sshd_config</code> to <code class="literal">no</code> and
      restart the SSH daemon (<code class="command">systemctl restart sshd</code>)
      if it seems that the  changes to resource limits are not working (via
      SSH). However, this is not generally recommended, as it weakens a system's
      security.
     </p></div><div id="id-1.7.5.7.10.3.7" data-id-title="Disabling password logins via ssh" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Disabling password logins via <code class="command">ssh</code></div><p>
      You can add some extra security to your server by disabling password
      authentication for SSH. Remember that you need to have SSH keys
      configured, otherwise you cannot access the server. To disable password
      login, add the following lines to
      <code class="filename">/etc/ssh/sshd_config</code>:
     </p><div class="verbatim-wrap"><pre class="screen">UseLogin no
UsePAM no
PasswordAuthentication no
PubkeyAuthentication yes</pre></div></div><p>
     In this example, a change to the number of file handles or open files
     that the user <code class="literal">oracle</code> can use is made by editing
     <code class="filename">/etc/security/limits.conf</code> as <code class="systemitem">root</code> making the
     following changes:
    </p><div class="verbatim-wrap"><pre class="screen">oracle           soft    nofile          4096
oracle           hard    nofile          63536</pre></div><p>
     The soft limit in the first line defines the limit on the number of file
     handles (open files) that the
     <code class="systemitem">oracle</code> user will have after
     login. If the user sees error messages about running out of file handles,
     then the user can increase the number of file handles like in this
     example up to the hard limit (in this example 63536) by executing:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ulimit -n 63536</pre></div><p>
     You can set the soft and hard limits higher if necessary.
    </p><div id="id-1.7.5.7.10.3.13" data-id-title="Caution with using ulimits" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Caution with using ulimits</div><p>
      It is important to be judicious with the usage of ulimits. Allowing a
      <span class="quote">“<span class="quote">hard</span>”</span> limit for <code class="literal">nofile</code> for a user that
      is equal to the kernel limit (<code class="filename">/proc/sys/fs/file-max</code>)
      is very bad! If the user consumes all the available file handles, the
      system cannot initiate new logins, since it will not be possible to access
      the PAM modules required to perform a login.
     </p></div><p>
     You also need to ensure that <code class="literal">pam_limits</code> is either
     configured globally in <code class="filename">/etc/pam.d/common-auth</code>, or
     for individual services like SSH, su, login, and telnet in:
    </p><table style="border: 0; " class="simplelist"><tr><td><code class="filename">/etc/pam.d/sshd</code> (for SSH)</td></tr><tr><td><code class="filename">/etc/pam.d/su</code> (for su)</td></tr><tr><td><code class="filename">/etc/pam.d/login</code> (local logins and telnet)</td></tr></table><p>
     If you do not want to enable it for all logins, there is a specific PAM
     module that will read the <code class="filename">/etc/security/limits.conf</code>
     file. Entries in PAM configuration directives will have entries like:
    </p><div class="verbatim-wrap"><pre class="screen">session     required      /lib/security/pam_limits.so
session     required      /lib/security/pam_unix.so</pre></div><p>
     It is important to note that changes are not immediate and require a new
     login session:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>su - oracle
<code class="prompt user">&gt; </code>ulimit -n
4096</pre></div><p>
     Note that these examples are specific to the Bash shell;
     <code class="command">ulimit</code> options are different for other shells. The
     default limit for the user <code class="literal">oracle</code> is
     <code class="literal">4096</code>. To increase the number of file handles the user
     <code class="literal">oracle</code> can use to <code class="literal">63536</code>, execute:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>su - oracle
<code class="prompt user">&gt; </code>ulimit -n
4096
<code class="prompt user">&gt; </code>ulimit -n 63536
<code class="prompt user">&gt; </code>ulimit -n
63536</pre></div><p>
     Making this permanent requires the addition of the setting,
     <code class="command">ulimit -n 63536</code>, (again, for Bash) to the user's
     profile (<code class="filename">~/.bashrc</code> or
     <code class="filename">~/.profile</code> file), which is the user start-up file for
     the Bash shell on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> (to verify your shell, run:
     <code class="command">echo $SHELL</code>). To do this you could run the following commands for the
     Bash shell of the user <code class="literal">oracle</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>su - oracle
<code class="prompt user">&gt; </code>cat &gt;&gt; ~oracle/.bash_profile &lt;&lt; EOF
ulimit -n 63536
EOF</pre></div></section></section><section class="sect1" id="sec-sec-prot-banners" data-id-title="Displaying login banners"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.9 </span><span class="title-name">Displaying login banners</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-banners">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    It is often necessary to place a banner on login screens on all servers
    for legal/audit policy reasons or to give security instructions to
    users.
   </p><p>
    If you want to print a login banner <span class="emphasis"><em>after</em></span> a user
    logs in on a text based terminal, for example, using SSH or on a local
    console, you can use the file <code class="filename">/etc/motd</code> (motd =
    message of the day). The file exists by default on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, but
    it is empty. Simply add content to the file that is applicable/required
    by the organization.
   </p><div id="id-1.7.5.7.11.4" data-id-title="Banner length" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Banner length</div><p>
     Try to keep the login banner content to a single terminal page (or
     less), as it will scroll the screen if it does not fit, making it more
     difficult to read.
    </p></div><p>
    You can also have a login banner printed <span class="emphasis"><em>before</em></span> a
    user logs in on a text based terminal. For local console
    logins, you can edit the <code class="filename">/etc/issue</code> file, which will
    cause the banner to be displayed before the login prompt. For logins via
    SSH, you can edit the <span class="quote">“<span class="quote">Banner</span>”</span> parameter in the
    <code class="filename">/etc/ssh/sshd_config</code> file, which will then
    appropriately display the banner text before the SSH login prompt.
   </p><p>
    For graphical logins via GDM, you can follow
    <a class="link" href="https://help.gnome.org/admin/system-admin-guide/stable/login-banner.html.en" target="_blank">
    the GNOME admin guide</a> to set up a login banner. Furthermore,
    you can make the following changes to require a user to acknowledge the
    legal banner by selecting <span class="guimenu">Yes</span> or <span class="guimenu">No</span>.
    Edit the <code class="filename">/etc/gdm/Xsession</code> file and add the
    following lines at the <span class="emphasis"><em>beginning</em></span> of the script:
   </p><div class="verbatim-wrap"><pre class="screen">if ! /usr/bin/gdialog --yesno '\n<em class="replaceable">This system is classified...</em>\n' 10 10; then
    /usr/bin/gdialog --infobox 'Aborting login'
    exit 1;
fi</pre></div><p>
    The text <em class="replaceable">This system is classified...</em> needs to
    be replaced with the desired banner text. It is important to note that
    this dialog will not prevent a login from progressing. For more
    information about GDM scripting, refer to the
    <a class="link" href="https://help.gnome.org/admin/gdm/stable/configuration.html.en#scripting" target="_blank">
    GDM Admin Manual</a>.
   </p></section><section class="sect1" id="sec-sec-prot-misc-account-utils" data-id-title="Connection accounting utilities"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">14.10 </span><span class="title-name">Connection accounting utilities</span></span> <a title="Permalink" class="permalink" href="#sec-sec-prot-misc-account-utils">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/user_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Here is a list of commands you can use to get data about user logins:
    </p><p><span class="formalpara-title"><code class="command">who</code>. </span>
      Lists currently logged in users.
     </p><p><span class="formalpara-title"><code class="command">w</code>. </span>
      Shows who is logged in and what they are doing.
     </p><p><span class="formalpara-title"><code class="command">last</code>. </span>
      Shows a list of the most recent logged in users, including login time, logout time,
      login IP address, etc.
     </p><p><span class="formalpara-title"><code class="command">lastb</code>. </span>
      Same as <code class="command">last</code>, except that by default it shows
      <code class="filename">/var/log/btmp</code>, which contains all the bad login
      attempts.
     </p><p><span class="formalpara-title"><code class="command">lastlog</code>. </span>
      This command reports data maintained in
      <code class="filename">/var/log/lastlog</code>, which is a record of the last
      time a user logged in.
     </p><p><span class="formalpara-title"><code class="command">ac</code>. </span>
      Available after installing the <code class="systemitem">acct</code> package.
      Prints the connect time in hours on a per-user basis or daily basis,
      etc. This command reads <code class="filename">/var/log/wtmp</code>.
     </p><p><span class="formalpara-title"><code class="command">dump-utmp</code>. </span>
      Converts raw data from /var/run/utmp or
      <code class="filename">/var/log/wtmp</code> into ASCII-parseable format.
     </p><p>
     Also check the <code class="filename">/var/log/messages</code> file, or the output
     of <code class="command">journalctl</code> if no logging facility is running. See
     <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: Query the <code class="systemitem">systemd</code> journal”</span> for more information on the <code class="systemitem">systemd</code>
     journal.
    </p></section></section><section class="chapter" id="cha-sec-cron-at" data-id-title="Restricting cron and at"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">15 </span><span class="title-name">Restricting <code class="systemitem">cron</code> and <code class="systemitem">at</code></span></span> <a title="Permalink" class="permalink" href="#cha-sec-cron-at">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cron_at.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    This chapter explains how to restrict access to the <code class="systemitem">cron</code> and <code class="systemitem">at</code> daemons to improve the security of a system.
   </p></div></div></div></div><section class="sect1" id="id-1.7.5.8.3" data-id-title="Restricting the cron daemon"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.1 </span><span class="title-name">Restricting the <code class="systemitem">cron</code> daemon</span></span> <a title="Permalink" class="permalink" href="#id-1.7.5.8.3">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cron_at.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="systemitem">cron</code> system is used to automatically run commands in the background at
   predefined times. For more information about <code class="systemitem">cron</code>, refer to the <span class="intraxref">Book “Administration Guide”, Chapter 30 “Special system features”, Section 30.1.2 “The <span class="phrase">cron</span> package”</span>.
  </p><p>
   The <code class="filename">cron.allow</code> file specifies a list of users that are
   allowed to execute jobs via <code class="systemitem">cron</code>. The file does not exist by default, so
   all users can create <code class="systemitem">cron</code> jobs—except for those listed in
   <code class="filename">cron.deny</code>.
  </p><div class="procedure"><div class="procedure-contents"><p>
    To prevent users except for <code class="systemitem">root</code> from creating <code class="systemitem">cron</code> jobs, perform
    the following steps.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Create an empty file <code class="filename">/etc/cron.allow</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">touch</code> /etc/cron.allow</pre></div></li><li class="step"><p>
     Allow users to create <code class="systemitem">cron</code> jobs by adding their usernames to the file:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">echo</code> "tux" &gt;&gt; /etc/cron.allow</pre></div></li><li class="step"><p>
     To verify, try creating a <code class="systemitem">cron</code> job as non-root user listed in
     <code class="filename">cron.allow</code>. You should see the message:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">crontab -e</code>
no crontab for tux - using an empty one</pre></div><p>
     Quit the crontab editor and try the same with a user
     <span class="emphasis"><em>not</em></span> listed in the file (or before adding them in step
     2 of this procedure):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">wilber &gt; </code><code class="command">crontab -e</code>
You (wilber) are not allowed to use this program (crontab)
See crontab(1) for more information</pre></div></li></ol></div></div><div id="id-1.7.5.8.3.5" data-id-title="Existing cron jobs" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Existing <code class="systemitem">cron</code> jobs</div><p>
    Implementing <code class="function">cron.allow</code> only prevents users from
    creating new <code class="systemitem">cron</code> jobs. Existing jobs will still be run, even for users
    listed in <code class="filename">cron.deny</code>. To prevent this, create the file
    as described and remove existing user crontabs from the directory
    <code class="filename">/var/spool/cron/tabs</code> to ensure they are not run
    anymore.
   </p></div><div id="id-1.7.5.8.3.6" data-id-title="Switching to systemd timer units" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Switching to <code class="systemitem">systemd</code> timer units</div><p>
    You should also consider switching to <code class="systemitem">systemd</code> timer units, as they allow
    for more powerful and reliable task execution. By default, users cannot use
    them to run code when they are not logged in. This limits the way users can
    interact with the system while not being connected to it.
   </p><p>
    For more information about <code class="systemitem">systemd</code> timer units, refer to <span class="intraxref">Book “Administration Guide”, Chapter 19 “The <code class="systemitem">systemd</code> daemon”, Section 19.7 “<code class="systemitem">systemd</code> timer units”</span>.
   </p></div></section><section class="sect1" id="id-1.7.5.8.4" data-id-title="Restricting the at scheduler"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.2 </span><span class="title-name">Restricting the <code class="systemitem">at</code> scheduler</span></span> <a title="Permalink" class="permalink" href="#id-1.7.5.8.4">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_cron_at.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="systemitem">at</code> job execution system allows
   users to scheduled one-time running jobs. The <code class="filename">at.allow</code>
   file specifies a list of users that are allowed to schedule jobs via
   <code class="systemitem">at</code>. The file does not exist by
   default, so all users can schedule <code class="systemitem">at</code>
   jobs—except for those listed in <code class="filename">at.deny</code>)
  </p><div class="procedure"><div class="procedure-contents"><p>
    To prevent users except for <code class="systemitem">root</code> from scheduling jobs with <code class="systemitem">at</code>, perform the following steps.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Create an empty file <code class="filename">/etc/at.allow</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">touch</code> /etc/at.allow</pre></div></li><li class="step"><p>
     Allow users to schedule jobs with <code class="systemitem">at</code> by adding their usernames to the file:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">echo</code> "tux" &gt;&gt; /etc/at.allow</pre></div></li><li class="step"><p>
     To verify, try scheduling a job as non-root user listed in
     <code class="filename">at.allow</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">at 00:00</code>
at&gt;</pre></div><p>
     Quit the <code class="systemitem">at</code>prompt with
     <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">C</span> and
     try the same with a user <span class="emphasis"><em>not</em></span> listed in the file (or
     before adding them in step 2 of this procedure):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">wilber &gt; </code><code class="command">at 00:00</code>
You do not have permission to use at.</pre></div></li></ol></div></div><div id="id-1.7.5.8.4.4" data-id-title="Uninstalling at" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Uninstalling <code class="systemitem">at</code></div><p>
    <code class="systemitem">at</code> is not widely used anymore.
    If you do not have valid use cases, consider uninstalling the daemon instead
    of just restricting its access.
   </p></div></section></section><section class="chapter" id="cha-spectre" data-id-title="Spectre/Meltdown checker"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">16 </span><span class="title-name">Spectre/Meltdown checker</span></span> <a title="Permalink" class="permalink" href="#cha-spectre">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_spectre_meltdown_checker.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    <code class="command">spectre-meltdown-checker</code> is a shell script to test if
    your system is vulnerable to the several speculative execution
    vulnerabilities that are in nearly all CPUs manufactured in the
    past 20 years. This is a hardware flaw that potentially allows an attacker
    to read all data on the system. On cloud computing services, where multiple
    virtual machines are on a single physical host, an attacker can gain access
    to all virtual machines. Fixing these vulnerabilities requires redesigning
    and replacing CPUs. Until this happens, there are several software patches
    that mitigate these vulnerabilities. If you have kept your SUSE systems
    updated, all of these patches should already be installed.
   </p><p>
    <code class="command">spectre-meltdown-checker</code> generates a detailed report. It
    is impossible to guarantee that your system is secure, but it shows you
    which mitigations are in place, and potential vulnerabilities.
   </p></div></div></div></div><section class="sect1" id="sec-spectre-meltdown-options" data-id-title="Using spectre-meltdown-checker"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">16.1 </span><span class="title-name">Using <code class="command">spectre-meltdown-checker</code></span></span> <a title="Permalink" class="permalink" href="#sec-spectre-meltdown-options">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_spectre_meltdown_checker.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Install the script, and then run it as root without any options:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>zypper in spectre-meltdown-checker
<code class="prompt root"># </code>spectre-meltdown-checker.sh</pre></div><p>
   You will see colorful output like
   <a class="xref" href="#fig-spectre-meltdown-output" title="Output from spectre-meltdown-checker">Figure 16.1, “Output from spectre-meltdown-checker”</a>:
  </p><div class="figure" id="fig-spectre-meltdown-output"><div class="figure-contents"><div class="mediaobject"><a href="images/spectre-meltdown.png"><img src="images/spectre-meltdown.png" width="100%" alt="Partial output of spectre-meltdown-checker.sh" title="Partial output of spectre-meltdown-checker.sh"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 16.1: </span><span class="title-name">Output from spectre-meltdown-checker </span></span><a title="Permalink" class="permalink" href="#fig-spectre-meltdown-output">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_spectre_meltdown_checker.xml" title="Edit source document"> </a></div></div></div><p>
   <code class="command">spectre-meltdown-checker.sh --help</code> lists all options. It
   is useful to pipe plain text output, with no colors, to a file:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>spectre-meltdown-checker.sh --no-color| tee <em class="replaceable">filename.txt</em></pre></div><p>
   The previous examples are on a running system, which is the default. You may
   also run <code class="command">spectre-meltdown-checker</code> offline by specifying
   the paths to the kernel, config, and System.map files:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cd /boot
<code class="prompt root"># </code>spectre-meltdown-checker.sh \
--no-color \
--kernel <em class="replaceable">vmlinuz-4.12.14-lp151.28.13-default</em> \
--config <em class="replaceable">config-4.12.14-lp151.28.13-default</em> \
--map <em class="replaceable">System.map-4.12.14-lp151.28.13-default</em>| tee <em class="replaceable">filename.txt</em></pre></div><p>
   Other useful options are:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.9.3.11.1"><span class="term">--verbose, -v</span></dt><dd><p>
      Increase verbosity; repeat for more verbosity, for example <code class="command">-v -v
      -v</code>
     </p></dd><dt id="id-1.7.5.9.3.11.2"><span class="term">--explain</span></dt><dd><p>
      Print human-readable explanations
     </p></dd><dt id="id-1.7.5.9.3.11.3"><span class="term">--batch [short] [json] [nrpe] [prometheus]</span></dt><dd><p>
      Format output in various machine-readable formats
     </p></dd></dl></div><div id="id-1.7.5.9.3.12" data-id-title="--disclaimer option" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: --disclaimer option</div><p>
    <code class="command">spectre-meltdown-checker.sh --disclaimer</code> provides
    important information about what the script does, and does not do.
   </p></div></section><section class="sect1" id="sec-spectre-meltdown-resources" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">16.2 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-spectre-meltdown-resources">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_spectre_meltdown_checker.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For more information, see the following references:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     SUSE Knowledge Base article #7022937, <em class="citetitle">Security Vulnerability:
     Spectre Variant 4 (Speculative Store Bypass) aka
     CVE-2018-3639</em>:
     <a class="link" href="https://www.suse.com/support/kb/doc/?id=7022937" target="_blank">https://www.suse.com/support/kb/doc/?id=7022937</a>
    </p></li><li class="listitem"><p>
     <em class="citetitle">speed47/spectre-meltdown-checker</em> source code on
     GitHub, with detailed references to relevant 
     Common Vulnerabilities and Exposures (CVE):
     <a class="link" href="https://github.com/speed47/spectre-meltdown-checker" target="_blank">https://github.com/speed47/spectre-meltdown-checker</a>
    </p></li><li class="listitem"><p>
     SUSE Blog article, <em class="citetitle">Meltdown and Spectre
     Performance</em>:
     <a class="link" href="https://www.suse.com/c/meltdown-spectre-performance/" target="_blank">https://www.suse.com/c/meltdown-spectre-performance/</a>
    </p></li><li class="listitem"><p>
     SUSE Knowledge Base article #7022512, providing information on
     architectures, CVEs, and mitigations:
     <a class="link" href="https://www.suse.com/support/kb/doc/?id=7022512" target="_blank">https://www.suse.com/support/kb/doc/?id=7022512</a>
    </p></li></ul></div></section></section><section class="chapter" id="cha-security-yast-security" data-id-title="Configuring security settings with YaST"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">17 </span><span class="title-name">Configuring security settings with YaST</span></span> <a title="Permalink" class="permalink" href="#cha-security-yast-security">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_yast2_security.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    The YaST module <span class="guimenu">Security Center</span>
    provides a central control panel for configuring security-related settings
    for <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. Use it to configure security aspects such as
    settings for the login procedure and for password creation, for boot
    permissions, user creation, or for default file permissions. Launch it
    from the YaST control center with <span class="guimenu">Security and Users</span> › <span class="guimenu">Security Center</span>. The 
    <span class="guimenu">Security Center</span> dialog opens to
    the <span class="guimenu">Security Overview</span>, with additional
    configuration dialogs in the left and right panes.
   </p></div></div></div></div><section class="sect1" id="sec-security-yast-security-overview" data-id-title="Security overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.1 </span><span class="title-name"><span class="guimenu">Security overview</span></span></span> <a title="Permalink" class="permalink" href="#sec-security-yast-security-overview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_yast2_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <span class="guimenu">Security Overview</span> displays a comprehensive list of
   the most important security settings for your system. The security status
   of each entry in the list is clearly visible. A green check mark
   indicates a secure setting while a red cross indicates an entry as being
   insecure. Click <span class="guimenu">Help</span> to open an overview of the
   setting and information on how to make it secure. To change a setting,
   click the corresponding link in the Status column. Depending on the
   setting, the following entries are available:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.10.3.3.1"><span class="term"><span class="guimenu">Enabled</span>/<span class="guimenu">Disabled</span>
    </span></dt><dd><p>
      Click this entry to toggle the status of the setting to either enabled
      or disabled.
     </p></dd><dt id="id-1.7.5.10.3.3.2"><span class="term"><span class="guimenu">Configure</span>
    </span></dt><dd><p>
      Click this entry to launch another YaST module for configuration.
      You will return to the Security Overview when leaving the module.
     </p></dd><dt id="id-1.7.5.10.3.3.3"><span class="term"><span class="guimenu">Unknown</span>
    </span></dt><dd><p>
      A setting's status is set to unknown when the associated service is
      not installed. Such a setting does not represent a potential security
      risk.
     </p></dd></dl></div><div class="figure" id="fig-yast-security-overview"><div class="figure-contents"><div class="mediaobject"><a href="images/yast2_security_overview.png"><img src="images/yast2_security_overview.png" alt="YaST security center and hardening: security overview" title="YaST security center and hardening: security overview"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 17.1: </span><span class="title-name">YaST security center and hardening: security overview </span></span><a title="Permalink" class="permalink" href="#fig-yast-security-overview">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_yast2_security.xml" title="Edit source document"> </a></div></div></div></section><section class="sect1" id="sec-security-yast-security-predefined-configs" data-id-title="Predefined security configurations"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.2 </span><span class="title-name"><span class="guimenu">Predefined security configurations</span></span></span> <a title="Permalink" class="permalink" href="#sec-security-yast-security-predefined-configs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_yast2_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> includes three <span class="guimenu">Predefined Security
   Configurations</span>. These configurations affect all the settings
   available in the <span class="guimenu">Security Center</span> module. Click
   <span class="guimenu">Predefined Security Configurations</span> in the left pane
   to see the predefined configurations. Click the one you want to apply,
   then the module closes. If you wish to modify the predefined settings,
   re-open the <span class="guimenu">Security Center</span> module, click 
   <span class="guimenu">Predefined Security Configurations</span>, then click
   <span class="guimenu">Custom Settings</span> in the right pane. Any changes you
   make are applied to your selected predefined configuration.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.10.4.3.1"><span class="term"><span class="guimenu">Workstation</span>
    </span></dt><dd><p>
      A configuration for a workstation with any kind of network connection
      (including a connection to the Internet).
     </p></dd><dt id="id-1.7.5.10.4.3.2"><span class="term"><span class="guimenu">Roaming device</span>
    </span></dt><dd><p>
      This setting is designed for a laptop or tablet that connects to
      different networks.
     </p></dd><dt id="id-1.7.5.10.4.3.3"><span class="term"><span class="guimenu">Network server</span>
    </span></dt><dd><p>
      Security settings designed for a machine providing network services
      such as a Web server, file server, name server, etc. This set provides
      the most secure configuration of the predefined settings.
     </p></dd><dt id="id-1.7.5.10.4.3.4"><span class="term"><span class="guimenu">Custom settings</span>
    </span></dt><dd><p>
      Select <span class="guimenu">Custom Settings</span> to modify any of the three
      predefined configurations after they have been applied.
     </p></dd></dl></div></section><section class="sect1" id="sec-security-yast-security-password" data-id-title="Password settings"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.3 </span><span class="title-name"><span class="guimenu">Password settings</span></span></span> <a title="Permalink" class="permalink" href="#sec-security-yast-security-password">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_yast2_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Passwords that are easy to guess are a major security issue. The
   <span class="guimenu">Password Settings</span> dialog provides the means to ensure
   that only secure passwords can be used.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.10.5.3.1"><span class="term"><span class="guimenu">Check new passwords</span>
    </span></dt><dd><p>
      By activating this option, a warning will be issued if new passwords
      appear in a dictionary, or if they are proper names (proper nouns).
     </p></dd><dt id="id-1.7.5.10.5.3.2"><span class="term"><span class="guimenu">Minimum acceptable password length</span>
    </span></dt><dd><p>
      If the user chooses a password with a length shorter than specified
      here, a warning will be issued.
     </p></dd><dt id="id-1.7.5.10.5.3.3"><span class="term"><span class="guimenu">Number of passwords to remember</span>
    </span></dt><dd><p>
      When password expiration is activated (via <span class="guimenu">Password
      Age</span>), this setting stores the given number of a user's
      previous passwords, preventing their reuse.
     </p></dd><dt id="id-1.7.5.10.5.3.4"><span class="term"><span class="guimenu">Password encryption method</span>
    </span></dt><dd><p>
      Choose a password encryption algorithm. Normally there is no need to
      change the default (Blowfish).
     </p></dd><dt id="id-1.7.5.10.5.3.5"><span class="term"><span class="guimenu">Password age</span>
    </span></dt><dd><p>
      Activate password expiration by specifying a minimum and a maximum
      time limit (in days). By setting the minimum age to a value greater
      than <code class="literal">0</code> days, you can prevent users from immediately
      changing their passwords again (and in doing so circumventing the
      password expiration). Use the values <code class="literal">0</code> and
      <code class="literal">99999</code> to deactivate password expiration.
     </p></dd><dt id="id-1.7.5.10.5.3.6"><span class="term"><span class="guimenu">Days before password expires warning</span>
    </span></dt><dd><p>
      When a password expires, the user receives a warning in advance.
      Specify the number of days prior to the expiration date that the
      warning should be issued.
     </p></dd></dl></div></section><section class="sect1" id="sec-security-yast-security-boot" data-id-title="Boot settings"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.4 </span><span class="title-name"><span class="guimenu">Boot settings</span></span></span> <a title="Permalink" class="permalink" href="#sec-security-yast-security-boot">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_yast2_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Configure which users can shut down the machine via the
   graphical login manager in this dialog. You can also specify how
   <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">Del</span> will be interpreted and who
   can hibernate the system.
  </p></section><section class="sect1" id="sec-security-yast-security-login" data-id-title="Login settings"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.5 </span><span class="title-name"><span class="guimenu">Login settings</span></span></span> <a title="Permalink" class="permalink" href="#sec-security-yast-security-login">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_yast2_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This dialog lets you configure security-related login settings:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.10.7.3.1"><span class="term"><span class="guimenu">Delay after incorrect login attempt</span>
    </span></dt><dd><p>
      To make it difficult to guess a user's password by repeatedly
      logging in, it is recommended to delay the display of the login prompt
      that follows an incorrect login. Specify the value in seconds. Make
      sure that users who have mistyped their passwords do not need to wait
      too long.
     </p></dd><dt id="id-1.7.5.10.7.3.2"><span class="term"><span class="guimenu">Allow remote graphical login</span>
    </span></dt><dd><p>
      When checked, the graphical login manager (GDM) can be accessed from
      the network. This is a potential security risk.
     </p></dd></dl></div></section><section class="sect1" id="sec-security-yast-security-user" data-id-title="User addition"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.6 </span><span class="title-name"><span class="guimenu">User addition</span></span></span> <a title="Permalink" class="permalink" href="#sec-security-yast-security-user">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_yast2_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Set minimum and maximum values for user and group IDs. These default
   settings would rarely need to be changed.
  </p></section><section class="sect1" id="sec-security-yast-security-misc" data-id-title="Miscellaneous settings"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.7 </span><span class="title-name"><span class="guimenu">Miscellaneous settings</span></span></span> <a title="Permalink" class="permalink" href="#sec-security-yast-security-misc">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_yast2_security.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Other security settings that do not fit the above-mentioned categories are
   listed here:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.10.9.3.1"><span class="term"><span class="guimenu">File permissions</span>
    </span></dt><dd><p>
      <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> comes with three predefined sets of file permissions
      for system files. These permission sets define whether a regular user
      can read log files or start certain programs. <span class="guimenu">Easy</span>
      file permissions are suitable for stand-alone machines. These settings
      allow regular users to, for example, read most system files. See the
      file <code class="filename">/etc/permissions.easy</code> for the complete
      configuration. The <span class="guimenu">Secure</span> file permissions are
      designed for multiuser machines with network access. A thorough
      explanation of these settings can be found in
      <code class="filename">/etc/permissions.secure</code>. The
      <span class="guimenu">Paranoid</span> settings are the most restrictive ones and
      should be used with care. See
      <code class="filename">/etc/permissions.paranoid</code> for more information.
     </p></dd><dt id="id-1.7.5.10.9.3.2"><span class="term"><span class="guimenu">User launching updatedb</span>
    </span></dt><dd><p>
      The program <code class="command">updatedb</code> scans the system and creates a
      database of all files, which can be queried with the command
      <code class="command">locate</code>. When <code class="command">updatedb</code> is run as
      user nobody, only world-readable files will be added to the database.
      When run as user <code class="systemitem">root</code>, almost all files (except the ones root
      is not allowed to read) will be added.
     </p></dd><dt id="id-1.7.5.10.9.3.3"><span class="term"><span class="guimenu">Enable magic SysRq keys</span>
    </span></dt><dd><p>
      The magic SysRq key is a key combination that enables you to have some
      control over the system even when it has crashed. The complete
      documentation can be found at <a class="link" href="https://www.kernel.org/doc/html/latest/admin-guide/sysrq.html" target="_blank">https://www.kernel.org/doc/html/latest/admin-guide/sysrq.html</a>.
     </p></dd></dl></div></section></section><section class="chapter" id="cha-security-polkit" data-id-title="The Polkit authentication framework"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">18 </span><span class="title-name">The Polkit authentication framework</span></span> <a title="Permalink" class="permalink" href="#cha-security-polkit">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
         Polkit is an authentication framework used in graphical Linux desktop
         environments, for fine-grained management of access rights on the
         system. Traditionally, there is a strong separation of
         privileges on Linux between the <code class="systemitem">root</code> user as the fully-authorized
         administrator account, and all other accounts and groups on the
         system. These non-administrator accounts may have certain additional
         privileges, like accessing sound hardware through an
         <code class="literal">audio</code> group. This kind of
         privilege is fixed, however, and cannot be granted only in certain
         specific situations, or for a certain duration of time.
        </p><p>
         Instead of fully switching to the <code class="systemitem">root</code> user (using programs
         such as <code class="command">sudo</code>) for gaining higher privileges,
         Polkit grants specific privileges to a user or group on an
         as-needed basis. This is controlled by configuration files that
         describe individual actions that need to be authorized
	        in a dynamic context.
        </p></div></div></div></div><section class="sect1" id="sec-security-polkit-oview" data-id-title="Conceptual overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.1 </span><span class="title-name">Conceptual overview</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-oview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Polkit consists of multiple components. <code class="command">polkitd</code> is a
   privileged central background service that performs authentication checks
   based on the existing Polkit configuration. Polkit-enabled applications
   forward specific authentication requests to the
   <code class="command">polkitd</code> daemon. A Polkit authentication agent running in
   the unprivileged user context is responsible for displaying
   authentication requests on behalf of the <code class="command">polkitd</code>
   daemon, and providing the credentials that have been entered interactively by
   the user.
  </p><p>
   A Polkit <span class="emphasis"><em>action</em></span> represents a single activity that is
   subject to Polkit's authorization rules. For example, the intent to reboot the
   computer can be modeled as a single action in Polkit. Each action has a unique
   identifier, for the reboot example the action is called
   <code class="literal">org.freedesktop.login1.reboot</code>.
  </p><section class="sect2" id="sec-security-polkit-agents" data-id-title="The authentication agent"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.1.1 </span><span class="title-name">The authentication agent</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-agents">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When a user starts a graphical session in a fully-featured desktop
    environment, an authentication agent is typically started automatically,
    running in the background. You will only notice it when an authentication
    prompt appears in response to an application requesting authorization for a
    certain action. Using Polkit in text mode or via SSH is not easily possible,
    therefore this document focuses on its use in a graphical session context.
   </p></section><section class="sect2" id="sec-security-polkit-structure" data-id-title="Configuration of Polkit"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.1.2 </span><span class="title-name">Configuration of Polkit</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-structure">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Polkit's configuration consists of <span class="emphasis"><em>actions</em></span> and
    <span class="emphasis"><em>authorization rules</em></span>:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.11.3.5.3.1"><span class="term">Actions (file extension <code class="filename">*.policy</code>)</span></dt><dd><p>
       Actions are defined in XML files that are located in
       <code class="filename">/usr/share/polkit-1/actions</code>. Each file defines
       one or more actions for a certain application domain, and each action
       contains human-readable descriptions and its default authorization
       settings. Although a system administrator can write their own rules, these
       default policy files must not be edited directly.
      </p></dd><dt id="id-1.7.5.11.3.5.3.2"><span class="term">Authorization rules (file extension <code class="filename">*.rules</code>)</span></dt><dd><p>
       Rules are written in the JavaScript programming language, and are located
       in two places: <code class="filename">/usr/share/polkit-1/rules.d </code> is used
       by system packages, and <code class="filename">/etc/polkit-1/rules.d</code> is for
       locally adminstered configurations. The rule files contain more complex
       logic on top of the default action authorization settings. For example,
       a rule file could overrule a restrictive action and allow some users
       to use it even without authorization.
      </p></dd></dl></div></section><section class="sect2" id="sec-security-polkit-oview-commands" data-id-title="Polkit Utilities"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.1.3 </span><span class="title-name">Polkit Utilities</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-oview-commands">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Polkit provides a number of utilities for specific tasks (see also their
    respective man pages for further details):
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.11.3.6.3.1"><span class="term"><code class="command">pkaction</code>
     </span></dt><dd><p>
       Get details about a defined action. See
       <a class="xref" href="#sec-security-polkit-query" title="18.3. Querying Privileges">Section 18.3, “Querying Privileges”</a> for more
       information.
      </p></dd><dt id="id-1.7.5.11.3.6.3.2"><span class="term"><code class="command">pkcheck</code>
     </span></dt><dd><p>
       Checks whether a process is authorized for a specific Polkit action.
      </p></dd><dt id="id-1.7.5.11.3.6.3.3"><span class="term"><code class="command">pkexec</code>
     </span></dt><dd><p>
       Allows executing programs as a different user based on Polkit authorization
       settings. This is similar to <code class="command">su</code> or <code class="command">sudo</code>.
      </p></dd><dt id="id-1.7.5.11.3.6.3.4"><span class="term"><code class="command">pkttyagent</code>
     </span></dt><dd><p>
       Starts a textual authentication agent. This agent is used if a
       desktop environment does not have its own authentication agent.
      </p></dd></dl></div></section></section><section class="sect1" id="sec-security-polkit-types" data-id-title="Authorization types"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.2 </span><span class="title-name">Authorization types</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-types">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Every time a Polkit enabled application carries out a privileged operation,
   Polkit is asked whether the user is entitled to do so. The answer can be
   <code class="literal">yes</code>, <code class="literal">no</code>, or
   <code class="literal">authentication needed</code>. In the latter case an authentication
   dialog is displayed for the user to enter the necessary credentials.
  </p><section class="sect2" id="sec-security-polkit-policies-implicit" data-id-title="Implicit Authorizations"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.2.1 </span><span class="title-name">Implicit Authorizations</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-policies-implicit">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When no dedicated Polkit JavaScript rules exist for a given action, the outcome
    depends on the implicit authorizations settings that are defined for each
    action in a Polkit policy file. There are three authorization categories:
    <code class="literal">allow_active</code>,
    <code class="literal">allow_inactive</code>, and <code class="literal">allow_any</code>.
    <code class="literal">allow_active</code> is applied to users in an active session. An
    active session is a local login on the text mode console or in a graphical
    user environment. The session becomes inactive when you switch to another
    console, for example, in which case the category
    <code class="literal">allow_inactive</code> is relevant. <code class="literal">allow_any</code>
    is used for all other contexts, for example for remote users logged in via
    SSH or VNC. Each of these categories has one of the following authorization
    settings assigned:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.11.4.3.3.1"><span class="term">no</span></dt><dd><p>
       The user is never granted authorization of the desired action.
      </p></dd><dt id="id-1.7.5.11.4.3.3.2"><span class="term">yes</span></dt><dd><p>
       The user is always granted authorization without the need to enter any credentials.
      </p></dd><dt id="id-1.7.5.11.4.3.3.3"><span class="term">auth_self</span></dt><dd><p>
       The user needs to enter their own password for the action to be
       authorized.
      </p></dd><dt id="id-1.7.5.11.4.3.3.4"><span class="term">auth_self_keep</span></dt><dd><p>
       Like <code class="literal">auth_self</code>, but the authorization is cached for a
       certain duration, for example, if the same action is executed by the same
       application again, then it is not necessary to re-enter the password.
      </p></dd><dt id="id-1.7.5.11.4.3.3.5"><span class="term">auth_admin</span></dt><dd><p>
       The user needs to enter the administrator (<code class="systemitem">root</code>) password for the action to be authorized.
      </p></dd><dt id="id-1.7.5.11.4.3.3.6"><span class="term">auth_admin_keep</span></dt><dd><p>
       Similar to <code class="literal">auth_self_keep</code>, only requiring the administrator (<code class="systemitem">root</code>) password.
      </p></dd></dl></div></section><section class="sect2" id="sec-security-polkit-policies-default" data-id-title="SUSE default privileges"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.2.2 </span><span class="title-name">SUSE default privileges</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-policies-default">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The implicit authorization settings found in Polkit policy files described so
    far are from the upstream developers of the respective applications.
    We will call these settings the <span class="emphasis"><em>upstream defaults</em></span>. These
    upstream defaults are not necessarily the same defaults that are used on
    SUSE systems. <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> comes with a predefined set of privileges that
    override the upstream defaults. These settings come in three different
    flavors (profiles) of which only one can be active at any time:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.11.4.4.3.1"><span class="term"><code class="filename">/etc/polkit-default-privs.easy</code>
     </span></dt><dd><p>
       Authorization settings tailored towards single-user desktop systems where
       the administrator is also the only active interactive user. It offers
       somewhat reduced security in favor of improved user experience.
      </p></dd><dt id="id-1.7.5.11.4.4.3.2"><span class="term"><code class="filename">/etc/polkit-default-privs.standard</code>
     </span></dt><dd><p>
       Balanced settings suitable for most systems.
      </p></dd><dt id="id-1.7.5.11.4.4.3.3"><span class="term"><code class="filename">/etc/polkit-default-privs.restrictive</code>
     </span></dt><dd><p>
       More conservative authorization settings that reduce possible attack
       surface at the expense of user experience in some areas.
      </p></dd></dl></div><p>
    To switch the active polkit profile, edit
    <code class="filename">/etc/sysconfig/security</code>
    and adjust the value of <code class="varname">POLKIT_DEFAULT_PRIVS</code> to one of
    <code class="literal">easy</code>, <code class="literal">standard</code>, or
    <code class="literal">restrictive</code>.
    Then run the command <code class="command">set_polkit_default_privs</code> as <code class="systemitem">root</code>.
   </p><p>
    Do not modify the profile settings in the files listed above. To define your
    own custom Polkit settings, use
    <code class="filename">/etc/polkit-default-privs.local</code>. For details, refer to
    <a class="xref" href="#sec-security-polkit-change-modify-config-implicit" title="18.4.3. Modifying the SUSE default privileges">Section 18.4.3, “Modifying the SUSE default privileges”</a>.
   </p></section></section><section class="sect1" id="sec-security-polkit-query" data-id-title="Querying Privileges"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.3 </span><span class="title-name">Querying Privileges</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-query">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To query privileges, use the command <code class="command">pkaction</code> included
   in Polkit.
  </p><p>
   Polkit comes with command-line tools for changing privileges and
   executing commands as another user (see
   <a class="xref" href="#sec-security-polkit-oview-commands" title="18.1.3. Polkit Utilities">Section 18.1.3, “Polkit Utilities”</a> for a short
   overview). Each existing policy has a unique name with which it
   can be identified. List all available policies with the command
   <code class="command">pkaction</code>. See <code class="command">man pkaction</code> for more
   information.
  </p><p>
   To display the needed authorization for a given policy (for
   example, <code class="literal">org.freedesktop.login1.reboot</code>), use
   <code class="command">pkaction</code> as follows:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">pkaction -v --action-id=org.freedesktop.login1.reboot</code>
org.freedesktop.login1.reboot:
  description:       Reboot the system
  message:           Authentication is required to allow rebooting the system
  vendor:            The systemd Project
  vendor_url:        http://www.freedesktop.org/wiki/Software/systemd
  icon:
  implicit any:      auth_admin_keep
  implicit inactive: auth_admin_keep
  implicit active:   yes</pre></div><div id="id-1.7.5.11.5.6" data-id-title="Restrictions of pkaction on SUSE Linux Enterprise Desktop" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Restrictions of <code class="command">pkaction</code> on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></div><p>
    <code class="command">pkaction</code> only takes the upstream defaults into account.
    It is not aware of the SUSE default privileges that are overriding the
    upstream defaults. Therefore be careful about interpreting this output.
   </p></div></section><section class="sect1" id="sec-security-polkit-change-modify-config" data-id-title="Modifying Polkit Configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.4 </span><span class="title-name">Modifying Polkit Configuration</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-change-modify-config">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Adjusting Polkit settings is useful when you want to deploy the same set of
   policies to different machines, for example to the computers of a specific
   team. Customization of Polkit authorization settings can also be used to harden
   security for specific actions, or to improve the user experience by reducing
   the amount of password prompts for frequently-used actions. Note, however,
   that granting certain Polkit actions without authentication
   can be a security hazard that may grant a regular user full <code class="systemitem">root</code>
   privileges. Only lower Polkit authentication requirements when you are certain
   it doesn't violate the system security in your specific environment.
  </p><section class="sect2" id="sec-security-polkit-change-modify-config-actions" data-id-title="Overriding Polkit policy files"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.4.1 </span><span class="title-name">Overriding Polkit policy files</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-change-modify-config-actions">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The list of available Polkit actions depends on the packages that you have
    installed on your system. For a quick overview, use
    <code class="command">pkaction</code> to list all actions Polkit knows about.
   </p><p>
    For the purposes of this example we will show how the command
    <code class="command">gparted</code> (<span class="quote">“<span class="quote">GNOME Partition Editor</span>”</span>)
    is integrated into Polkit.
   </p><p>
    The file
    <code class="filename">/usr/share/polkit-1/actions/org.opensuse.policykit.gparted.policy</code>
    has the following content:
   </p><div class="verbatim-wrap"><pre class="screen">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE policyconfig PUBLIC
 "-//freedesktop//DTD PolicyKit Policy Configuration 1.0//EN"
 "http://www.freedesktop.org/standards/PolicyKit/1.0/policyconfig.dtd"&gt;
&lt;policyconfig&gt; <span class="callout" id="co-polkit-actions-policyconfig">1</span>

  &lt;action id="org-opensuse-polkit-gparted"&gt; <span class="callout" id="co-polkit-actions-action">2</span>
    &lt;message&gt;Authentication is required to run the GParted Partition Editor&lt;/message&gt;
    &lt;icon_name&gt;gparted&lt;/icon_name&gt;
    &lt;defaults&gt; <span class="callout" id="co-polkit-actions-defaults">3</span>
      &lt;allow_any&gt;auth_admin&lt;/allow_any&gt;
      &lt;allow_inactive&gt;auth_admin&lt;/allow_inactive&gt;
     &lt; allow_active&gt;auth_admin&lt;/allow_active&gt;
    &lt;/defaults&gt;
    &lt;annotate <span class="callout" id="co-polkit-actions-annotate">4</span>
      key="org.freedesktop.policykit.exec.path"&gt;/usr/sbin/gparted&lt;/annotate&gt;
    &lt;annotate <a class="xref" href="#co-polkit-actions-annotate"><span class="callout">4</span></a>
      key="org.freedesktop.policykit.exec.allow_gui"&gt;true&lt;/annotate&gt;
  &lt;/action&gt;

&lt;/policyconfig&gt;</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-polkit-actions-policyconfig"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Root XML element of the policy file.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-polkit-actions-action"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Start of the definition of the only action in this policy.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-polkit-actions-defaults"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Here the implicit authorization settings as described above are found.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-polkit-actions-annotate"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      The <code class="literal">annotate</code> element contains additional information
      regarding how Polkit performs an action. In this case, it contains
      the path to the gparted executable and a setting that this program is
      allowed to access the graphical display. These annotations are necessary
      for the use of an action in conjunction with the Polkit tool <code class="command">pkexec</code>.
     </p></td></tr></table></div><p>
    To add your own policy, create a <code class="filename">.policy</code> file with
    the structure above, add the appropriate action name into the
    <code class="literal">id</code> attribute, and define the desired override implicit
    authorization settings.
   </p><div id="id-1.7.5.11.6.3.8" data-id-title="Deprecated name PolicyKit" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Deprecated name PolicyKit</div><p>
     The Polkit authorization framework was formerly named PolicyKit. In some
     places, like in the XML document preamble above, this old name still
     appears.
    </p></div></section><section class="sect2" id="sec-security-polkit-change-modify-config-authrules" data-id-title="Adding JavaScript authorization rules"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.4.2 </span><span class="title-name">Adding JavaScript authorization rules</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-change-modify-config-authrules">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Authorization rules overrule the implicit authorization settings.
    To add your own rules, store your files under <code class="filename">/etc/polkit-1/rules.d/</code>.
   </p><p>
    The files in this directory usually start with a two-digit number, a dash, a
    descriptive name, and end with <code class="filename">.rules</code>. Functions
    inside these files are executed in the lexicographical order of the filenames
    in the directory. For example, <code class="filename">00-foo.rules</code> is ordered
    (and hence executed) before <code class="filename">60-bar.rules</code> or even
    <code class="filename">90-default-privs.rules</code>.
   </p><p>
    Inside the rule file, the script typically checks for the action ID to be
    authorized. For example, if you want to allow the command
    <code class="command">gparted</code> to be executed by
    any member of the <code class="systemitem">admin</code>
    group, check for the action ID <code class="literal">org.opensuse.policykit.gparted</code>:
   </p><div class="verbatim-wrap"><pre class="screen">/* Allow users in admin group to run GParted without authentication */
polkit.addRule(function(action, subject) {
    if (action.id == "org.opensuse.policykit.gparted" &amp;&amp;
        subject.isInGroup("admin")) {
        return polkit.Result.YES;
    }
});</pre></div><p>
    Find the description of all classes and methods of the functions in the
    Polkit API at
    <a class="link" href="http://www.freedesktop.org/software/polkit/docs/latest/ref-api.html" target="_blank">http://www.freedesktop.org/software/polkit/docs/latest/ref-api.html</a>.
   </p></section><section class="sect2" id="sec-security-polkit-change-modify-config-implicit" data-id-title="Modifying the SUSE default privileges"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.4.3 </span><span class="title-name">Modifying the SUSE default privileges</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-change-modify-config-implicit">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As described in <a class="xref" href="#sec-security-polkit-policies-default" title="18.2.2. SUSE default privileges">Section 18.2.2, “SUSE default privileges”</a>,
    SUSE ships different override profiles for the Polkit implicit authorization
    settings defined by the upstream developers. Custom privileges can be defined
    in <code class="filename">/etc/polkit-default-privs.local</code>. Privileges defined
    here will always take precedence over the predefined profile settings.
    To add a custom privilege setting, do the following:
   </p><div class="procedure" id="pro-custom-privileges" data-id-title="Modifying default privileges"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 18.1: </span><span class="title-name">Modifying default privileges </span></span><a title="Permalink" class="permalink" href="#pro-custom-privileges">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Edit <code class="filename">/etc/polkit-default-privs.local</code>. To define a
      privilege, add a line for each action in the following format:
     </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">&lt;action-id&gt;</em>     <em class="replaceable">&lt;auth_any&gt;</em>:<em class="replaceable">&lt;auth_inactive&gt;</em>:<em class="replaceable">&lt;auth_active&gt;</em></pre></div><p>
      Alternatively, if all three categories will receive the same value, you can also specify only a single value:
     </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">&lt;action-id&gt;</em>     <em class="replaceable">&lt;auth_all&gt;</em></pre></div><p>
      For example:
     </p><div class="verbatim-wrap"><pre class="screen">org.freedesktop.color-manager.modify-profile     auth_admin_keep</pre></div></li><li class="step"><p>
      Run this tool as <code class="systemitem">root</code> for the changes to take effect:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">/sbin/set_polkit_default_privs</code></pre></div></li></ol></div></div><p>
   Refer to <code class="command">man polkit-default-privs</code> for the full
   documentation of the SUSE Polkit default privileges.
   </p></section></section><section class="sect1" id="sec-security-polkit-change-defaults" data-id-title="Restoring the SUSE default privileges"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.5 </span><span class="title-name">Restoring the SUSE default privileges</span></span> <a title="Permalink" class="permalink" href="#sec-security-polkit-change-defaults">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To restore the SUSE default authorization settings follow these steps:
  </p><div class="procedure" id="pro-restore-polkit-defaults" data-id-title="Restoring the SUSE Linux Enterprise Desktop defaults"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 18.2: </span><span class="title-name">Restoring the <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> defaults </span></span><a title="Permalink" class="permalink" href="#pro-restore-polkit-defaults">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_polkit.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Choose the desired profile as described in <a class="xref" href="#sec-security-polkit-policies-default" title="18.2.2. SUSE default privileges">Section 18.2.2, “SUSE default privileges”</a>
    </p></li><li class="step"><p>
     Remove any overrides from <code class="filename">/etc/polkit-default-privs.local</code>.
    </p></li><li class="step"><p>
     Run <code class="command">set_polkit_default_privs</code> to regenerate the default rules.
    </p></li></ol></div></div></section></section><section class="chapter" id="cha-security-acls" data-id-title="Access control lists in Linux"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">19 </span><span class="title-name">Access control lists in Linux</span></span> <a title="Permalink" class="permalink" href="#cha-security-acls">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    POSIX ACLs (access control lists) can be used as an expansion of the
    traditional permission concept for file system objects. With ACLs,
    permissions can be defined more flexibly than with the traditional
    permission concept.
   </p></div></div></div></div><p>
  The term <span class="emphasis"><em>POSIX ACL</em></span> suggests that this is a true POSIX
  (<span class="emphasis"><em>portable operating system interface</em></span>) standard. The
  respective draft standards POSIX 1003.1e and POSIX 1003.2c have been
  withdrawn for several reasons. Nevertheless, ACLs (as found on many
  systems belonging to the Unix family) are based on these drafts and the
  implementation of file system ACLs (as described in this chapter) follows
  these two standards.
 </p><section class="sect1" id="sec-security-acls-traditional" data-id-title="Traditional file permissions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.1 </span><span class="title-name">Traditional file permissions</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-traditional">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The permissions of all files included in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> are
   carefully chosen. When installing additional software or files,
   take great care when setting the permissions. Always use the
   <code class="option">-l</code> option with the command <code class="command">ls</code>
   to detect any incorrect file permissions immediately. An incorrect
   file attribute does not only mean that files could be changed or
   deleted. Modified files could be executed by <code class="systemitem">root</code> or
   services could be hijacked by modifying configuration files. This
   significantly increases the danger of an attack.
  </p><p>
   A <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span> system includes the files
   <code class="filename">permissions</code>,
   <code class="filename">permissions.easy</code>,
   <code class="filename">permissions.secure</code>, and
   <code class="filename">permissions.paranoid</code>, all in the directory
   <code class="filename">/etc</code>. The purpose of these files is to define
   special permissions, such as world-writable directories or, for
   files, the setuser ID bit. Programs with the setuser ID bit set do
   not run with the permissions of the user that launched it, but
   with the permissions of the file owner, usually <code class="systemitem">root</code>. An
   administrator can use the file
   <code class="filename">/etc/permissions.local</code> to add their own
   settings.
  </p><p>
   To define one of the available profiles, select <span class="guimenu">Local
   Security</span> in the <span class="guimenu">Security and Users</span>
   section of YaST. To learn more about the topic, read the
   comments in <code class="filename">/etc/permissions</code> or consult
   <code class="command">man chmod</code>.
  </p><p>
   Find detailed information about the traditional file permissions in the
   GNU Coreutils Info page, Node <span class="emphasis"><em>File permissions</em></span>
   (<code class="command">info coreutils "File permissions"</code>). More advanced
   features are the setuid, setgid, and sticky bit.
  </p><section class="sect2" id="sec-security-acls-traditional-setuid" data-id-title="The setuid bit"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.1.1 </span><span class="title-name">The setuid bit</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-traditional-setuid">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    In certain situations, the access permissions may be too restrictive.
    Therefore, Linux has additional settings that enable the temporary
    change of the current user and group identity for a specific action. For
    example, the <code class="command">passwd</code> program normally requires root
    permissions to access <code class="filename">/etc/passwd</code>. This file
    contains some important information, like the home directories of users
    and user and group IDs. Thus, a normal user would not be able to change
    <code class="filename">passwd</code>, because it would be too dangerous to grant
    all users direct access to this file. A possible solution to this
    problem is the <span class="emphasis"><em>setuid</em></span> mechanism. setuid (set user
    ID) is a special file attribute that instructs the system to execute
    programs marked accordingly under a specific user ID. Consider the
    <code class="command">passwd</code> command:
   </p><div class="verbatim-wrap"><pre class="screen">-rwsr-xr-x  1 root shadow 80036 2004-10-02 11:08 /usr/bin/passwd</pre></div><p>
    You can see the <code class="literal">s</code> that denotes that the setuid bit is
    set for the user permission. By means of the setuid bit, all users
    starting the <code class="command">passwd</code> command execute it as
    <code class="systemitem">root</code>.
   </p></section><section class="sect2" id="sec-security-acls-traditional-setgid" data-id-title="The setgid bit"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.1.2 </span><span class="title-name">The setgid bit</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-traditional-setgid">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The setuid bit applies to users. However, there is also an equivalent
    property for groups: the <span class="emphasis"><em>setgid</em></span> bit. A program for
    which this bit was set runs under the group ID under which it was saved,
    no matter which user starts it. Therefore, in a directory with the
    setgid bit, all newly created files and subdirectories are assigned to
    the group to which the directory belongs. Consider the following example
    directory:
   </p><div class="verbatim-wrap"><pre class="screen">drwxrws--- 2 tux archive 48 Nov 19 17:12  backup</pre></div><p>
    You can see the <code class="literal">s</code> that denotes that the setgid bit is
    set for the group permission. The owner of the directory and members of
    the group <code class="systemitem">archive</code> can access
    this directory. Users that are not members of this group are
    <span class="quote">“<span class="quote">mapped</span>”</span> to the respective group. The effective group ID of
    all written files will be
    <code class="systemitem">archive</code>. For example, a
    backup program that runs with the group ID
    <code class="systemitem">archive</code> can access
    this directory even without root privileges.
   </p></section><section class="sect2" id="sec-security-acls-traditional-sticky" data-id-title="The sticky bit"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.1.3 </span><span class="title-name">The sticky bit</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-traditional-sticky">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There is also the <span class="emphasis"><em>sticky bit</em></span>. It makes a difference
    whether it belongs to an executable program or a directory. If it
    belongs to a program, a file marked in this way is loaded to RAM to
    avoid needing to get it from the hard disk each time it is used. This
    attribute is used rarely, because modern hard disks are fast enough. If
    this bit is assigned to a directory, it prevents users from deleting
    each other's files. Typical examples include the
    <code class="filename">/tmp</code> and <code class="filename">/var/tmp</code> directories:
   </p><div class="verbatim-wrap"><pre class="screen">drwxrwxrwt 2 root root 1160 2002-11-19 17:15 /tmp</pre></div></section></section><section class="sect1" id="sec-security-acls-intro" data-id-title="Advantages of ACLs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.2 </span><span class="title-name">Advantages of ACLs</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Traditionally, three permission sets are defined for each file object on
   a Linux system. These sets include the read (<code class="literal">r</code>), write
   (<code class="literal">w</code>), and execute (<code class="literal">x</code>) permissions
   for each of three types of users—the file owner, the group, and
   other users. In addition to that, it is possible to set the <span class="emphasis"><em>set
   user id</em></span>, the <span class="emphasis"><em>set group id</em></span>, and the
   <span class="emphasis"><em>sticky</em></span> bit. This lean concept is fully adequate for
   most practical cases. However, for more complex scenarios or advanced
   applications, system administrators formerly needed to use several
   workarounds to circumvent the limitations of the traditional permission
   concept.
  </p><p>
   ACLs can be used as an extension of the traditional file permission
   concept. They allow the assignment of permissions to individual users or
   groups even if these do not correspond to the original owner or the
   owning group. Access control lists are a feature of the Linux kernel and
   are currently supported by Ext2, Ext3, Ext4, JFS, and XFS. Using
   ACLs, complex scenarios can be realized without implementing complex
   permission models on the application level.
  </p><p>
   The advantages of ACLs are evident if you want to replace a Windows
   server with a Linux server. Some connected workstations may
   continue to run under Windows even after the migration. The Linux system
   offers file and print services to the Windows clients with Samba. With
   Samba supporting access control lists, user permissions can be configured
   both on the Linux server and in Windows with a graphical user interface
   (only Windows NT and later). With <code class="command">winbindd</code>, part of
   the Samba suite, it is even possible to assign permissions to users only
   existing in the Windows domain without any account on the Linux server.
  </p></section><section class="sect1" id="sec-security-acls-defs" data-id-title="Definitions"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.3 </span><span class="title-name">Definitions</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-defs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.5.12.6.2.1"><span class="term">User class</span></dt><dd><p>
      The conventional POSIX permission concept uses three
      <span class="emphasis"><em>classes</em></span> of users for assigning permissions in the
      file system: the owner, the owning group, and other users. Three
      permission bits can be set for each user class, giving permission to
      read (<code class="literal">r</code>), write (<code class="literal">w</code>), and execute
      (<code class="literal">x</code>).
     </p></dd><dt id="id-1.7.5.12.6.2.2"><span class="term">ACL</span></dt><dd><p>
      The user and group access permissions for all kinds of
      file system objects (files and directories) are determined by means of
      ACLs.
     </p></dd><dt id="id-1.7.5.12.6.2.3"><span class="term">Default ACL</span></dt><dd><p>
      Default ACLs can only be applied to directories. They determine the
      permissions a file system object inherits from its parent directory
      when it is created.
     </p></dd><dt id="id-1.7.5.12.6.2.4"><span class="term">ACL entry</span></dt><dd><p>
      Each ACL consists of a set of ACL entries. An ACL entry contains a
      type, a qualifier for the user or group to which the entry refers, and
      a set of permissions. For some entry types, the qualifier for the
      group or users is undefined.
     </p></dd></dl></div></section><section class="sect1" id="sec-security-acls-handle" data-id-title="Handling ACLs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.4 </span><span class="title-name">Handling ACLs</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-handle">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <a class="xref" href="#tab-entrytype" title="ACL entry types">Table 19.1, “ACL entry types”</a> summarizes the six possible types of ACL
   entries, each defining permissions for a user or a group of users. The
   <span class="emphasis"><em>owner</em></span> entry defines the permissions of the user
   owning the file or directory. The <span class="emphasis"><em>owning group</em></span> entry
   defines the permissions of the file's owning group. The superuser can
   change the owner or owning group with <code class="command">chown</code> or
   <code class="command">chgrp</code>, in which case the owner and owning group
   entries refer to the new owner and owning group. Each <span class="emphasis"><em>named
   user</em></span> entry defines the permissions of the user specified in
   the entry's qualifier field. Each <span class="emphasis"><em>named group</em></span> entry
   defines the permissions of the group specified in the entry's qualifier
   field. Only the named user and named group entries have a qualifier field
   that is not empty. The <span class="emphasis"><em>other</em></span> entry defines the
   permissions of all other users.
  </p><p>
   The <span class="emphasis"><em>mask</em></span> entry further limits the permissions
   granted by named user, named group, and owning group entries by defining
   which of the permissions in those entries are effective and which are
   masked. If permissions exist in one of the mentioned entries and
   in the mask, they are effective. Permissions contained only in the mask
   or only in the actual entry are not effective—meaning the
   permissions are not granted. All permissions defined in the owner and
   owning group entries are always effective. The example in
   <a class="xref" href="#tab-mask" title="Masking access permissions">Table 19.2, “Masking access permissions”</a> demonstrates this mechanism.
  </p><p>
   There are two basic classes of ACLs: A <span class="emphasis"><em>minimum</em></span> ACL
   contains only the entries for the types owner, owning group, and other,
   which correspond to the conventional permission bits for files and
   directories. An <span class="emphasis"><em>extended</em></span> ACL goes beyond this. It
   must contain a mask entry and may contain several entries of the named
   user and named group types.
  </p><div class="table" id="tab-entrytype" data-id-title="ACL entry types"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 19.1: </span><span class="title-name">ACL entry types </span></span><a title="Permalink" class="permalink" href="#tab-entrytype">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Type
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Text Form
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        owner
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="literal">user::rwx</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        named user
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="literal">user:name:rwx</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        owning group
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="literal">group::rwx</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        named group
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="literal">group:name:rwx</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        mask
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="literal">mask::rwx</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        other
       </p>
      </td><td>
       <p>
        <code class="literal">other::rwx</code>
       </p>
      </td></tr></tbody></table></div></div><div class="table" id="tab-mask" data-id-title="Masking access permissions"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 19.2: </span><span class="title-name">Masking access permissions </span></span><a title="Permalink" class="permalink" href="#tab-mask">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Entry Type
       </p>
      </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Text Form
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Permissions
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        named user
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">user:geeko:r-x</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="literal">r-x</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        mask
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">mask::rw-</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="literal">rw-</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       
      </td><td style="border-right: 1px solid ; ">
       <p>
        effective permissions:
       </p>
      </td><td>
       <p>
        <code class="literal">r--</code>
       </p>
      </td></tr></tbody></table></div></div><section class="sect2" id="sec-security-acls-handle-fmbits" data-id-title="ACL entries and file mode permission bits"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.4.1 </span><span class="title-name">ACL entries and file mode permission bits</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-handle-fmbits">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <a class="xref" href="#fig-acls-map-mini" title="Minimum ACL: ACL entries compared to permission bits">Figure 19.1, “Minimum ACL: ACL entries compared to permission bits”</a> and
    <a class="xref" href="#fig-acls-map-ext" title="Extended ACL: ACL entries compared to permission bits">Figure 19.2, “Extended ACL: ACL entries compared to permission bits”</a> illustrate the two cases of a minimum
    ACL and an extended ACL. The figures are structured in three
    blocks—the left block shows the type specifications of the ACL
    entries, the center block displays an example ACL, and the right block
    shows the respective permission bits according to the conventional
    permission concept (for example, as displayed by <code class="command">ls</code>
    <code class="option">-l</code>). In both cases, the <span class="emphasis"><em>owner
    class</em></span> permissions are mapped to the ACL entry owner.
    <span class="emphasis"><em>Other class</em></span> permissions are mapped to the
    respective ACL entry. However, the mapping of the <span class="emphasis"><em>group
    class</em></span> permissions is different in the two cases.
   </p><div class="figure" id="fig-acls-map-mini"><div class="figure-contents"><div class="mediaobject"><a href="images/acls_map_mini.png"><img src="images/acls_map_mini.png" width="75%" alt="Minimum ACL: ACL entries compared to permission bits" title="Minimum ACL: ACL entries compared to permission bits"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 19.1: </span><span class="title-name">Minimum ACL: ACL entries compared to permission bits </span></span><a title="Permalink" class="permalink" href="#fig-acls-map-mini">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div><p>
    In the case of a minimum ACL—without mask—the group
    class permissions are mapped to the ACL entry owning group. This is
    shown in <a class="xref" href="#fig-acls-map-mini" title="Minimum ACL: ACL entries compared to permission bits">Figure 19.1, “Minimum ACL: ACL entries compared to permission bits”</a>. In the case of an extended
    ACL—with mask—the group class permissions are mapped
    to the mask entry. This is shown in <a class="xref" href="#fig-acls-map-ext" title="Extended ACL: ACL entries compared to permission bits">Figure 19.2, “Extended ACL: ACL entries compared to permission bits”</a>.
   </p><div class="figure" id="fig-acls-map-ext"><div class="figure-contents"><div class="mediaobject"><a href="images/acls_map_ext.png"><img src="images/acls_map_ext.png" width="75%" alt="Extended ACL: ACL entries compared to permission bits" title="Extended ACL: ACL entries compared to permission bits"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 19.2: </span><span class="title-name">Extended ACL: ACL entries compared to permission bits </span></span><a title="Permalink" class="permalink" href="#fig-acls-map-ext">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div><p>
    This mapping approach ensures the smooth interaction of applications,
    regardless of whether they have ACL support. The access permissions that
    were assigned by means of the permission bits represent the upper limit
    for all other <span class="quote">“<span class="quote">fine adjustments</span>”</span> made with an ACL. Changes
    made to the permission bits are reflected by the ACL and vice versa.
   </p></section><section class="sect2" id="sec-security-acls-handle-accacl" data-id-title="A directory with an ACL"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.4.2 </span><span class="title-name">A directory with an ACL</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-handle-accacl">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    With <code class="command">getfacl</code> and <code class="command">setfacl</code> on the
    command line, you can access ACLs. The usage of these commands is
    demonstrated in the following example.
   </p><p>
    Before creating the directory, use the <code class="command">umask</code> command
    to define which access permissions should be masked each time a file
    object is created. The command <code class="command">umask</code>
    <code class="option">027</code> sets the default permissions by giving the owner
    the full range of permissions (<code class="literal">0</code>), denying the group
    write access (<code class="literal">2</code>), and giving other users no
    permissions (<code class="literal">7</code>). <code class="command">umask</code>
    actually masks the corresponding permission bits or turns them off. For
    details, refer to <a class="xref" href="#sec-sec-prot-general-umask" title="11.4. Default umask">Section 11.4, “Default umask”</a> or the
    <code class="command">umask</code> man page.
   </p><p>
    <code class="command">mkdir mydir</code> creates the <code class="filename">mydir</code>
    directory with the default permissions as set by
    <code class="command">umask</code>. Use <code class="command">ls</code> <code class="option">-dl
    mydir</code> to check whether all permissions were assigned correctly.
    The output for this example is:
   </p><div class="verbatim-wrap"><pre class="screen">drwxr-x--- ... tux project3 ... mydir</pre></div><p>
    With <code class="command">getfacl</code> <code class="option">mydir</code>, check the
    initial state of the ACL. This gives information like:
   </p><div class="verbatim-wrap"><pre class="screen"># file: mydir
# owner: tux
# group: project3
user::rwx
group::r-x
other::---</pre></div><p>
    The first three output lines display the name, owner, and
    owning group of the directory. The next three lines contain the three
    ACL entries owner, owning group, and other. In fact, in the case of this
    minimum ACL, the <code class="command">getfacl</code> command does not produce any
    information you could not have obtained with <code class="command">ls</code>.
   </p><p>
    Modify the ACL to assign read, write, and execute permissions to an
    additional user <code class="literal">geeko</code> and an additional group
    <code class="literal">mascots</code> with:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>setfacl -m user:geeko:rwx,group:mascots:rwx mydir</pre></div><p>
    The option <code class="option">-m</code> prompts <code class="command">setfacl</code> to
    modify the existing ACL. The following argument indicates the ACL
    entries to modify (multiple entries are separated by commas). The final
    part specifies the name of the directory to which these modifications
    should be applied. Use the <code class="command">getfacl</code> command to take a
    look at the resulting ACL.
   </p><div class="verbatim-wrap"><pre class="screen"># file: mydir
# owner: tux
# group: project3
user::rwx
user:geeko:rwx
group::r-x
group:mascots:rwx
mask::rwx
other::---</pre></div><p>
    In addition to the entries initiated for the user
    <code class="literal">geeko</code> and the group <code class="literal">mascots</code>, a
    mask entry has been generated. This mask entry is set automatically so
    that all permissions are effective. <code class="command">setfacl</code>
    automatically adapts existing mask entries to the settings modified,
    unless you deactivate this feature with <code class="literal">-n</code>. The mask
    entry defines the maximum effective access permissions for all entries
    in the group class. This includes named user, named group, and owning
    group. The group class permission bits displayed by
    <code class="command">ls</code> <code class="option">-dl mydir</code> now correspond to the
    <code class="literal">mask</code> entry.
   </p><div class="verbatim-wrap"><pre class="screen">drwxrwx---+ ... tux project3 ... mydir</pre></div><p>
    The first column of the output contains an additional
    <code class="literal">+</code> to indicate that there is an
    <span class="emphasis"><em>extended</em></span> ACL for this item.
   </p><p>
    According to the output of the <code class="command">ls</code> command, the
    permissions for the mask entry include write access. Traditionally, such
    permission bits would mean that the owning group (here
    <code class="literal">project3</code>) also has write access to the directory
    <code class="filename">mydir</code>.
   </p><p>
    However, the effective access permissions for the owning group
    correspond to the overlapping portion of the permissions defined for the
    owning group and for the mask—which is <code class="literal">r-x</code>
    in our example (see <a class="xref" href="#tab-mask" title="Masking access permissions">Table 19.2, “Masking access permissions”</a>). As far as the effective
    permissions of the owning group in this example are concerned, nothing
    has changed even after the addition of the ACL entries.
   </p><p>
    Edit the mask entry with <code class="command">setfacl</code> or
    <code class="command">chmod</code>. For example, use <code class="command">chmod</code>
    <code class="option">g-w mydir</code>. <code class="command">ls</code> <code class="option">-dl
    mydir</code> then shows:
   </p><div class="verbatim-wrap"><pre class="screen">drwxr-x---+ ... tux project3 ... mydir</pre></div><p>
    <code class="command">getfacl</code> <code class="option">mydir</code> provides the following
    output:
   </p><div class="verbatim-wrap"><pre class="screen"># file: mydir
# owner: tux
# group: project3
user::rwx
user:geeko:rwx          # effective: r-x
group::r-x
group:mascots:rwx       # effective: r-x
mask::r-x
other::---</pre></div><p>
    After executing <code class="command">chmod</code> to remove the write
    permission from the group class bits, the output of
    <code class="command">ls</code> is sufficient to see that the mask bits
    must have changed accordingly: Write permission is again limited to the
    owner of <code class="filename">mydir</code>. The output of the
    <code class="command">getfacl</code> confirms this. This output includes a comment
    for all those entries in which the effective permission bits do not
    correspond to the original permissions, because they are filtered
    according to the mask entry. The original permissions can be restored at
    any time with <code class="command">chmod g+w mydir</code>.
   </p></section><section class="sect2" id="sec-security-acls-handle-defacl" data-id-title="A directory with a default ACL"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.4.3 </span><span class="title-name">A directory with a default ACL</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-handle-defacl">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Directories can have a default ACL, which is a special kind of ACL
    defining the access permissions that objects in the directory inherit
    when they are created. A default ACL affects both subdirectories and
    files.
   </p><section class="sect3" id="sec-security-acls-handle-defacl-eff" data-id-title="Effects of a default ACL"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">19.4.3.1 </span><span class="title-name">Effects of a default ACL</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-handle-defacl-eff">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     There are two ways in which the permissions of a directory's default
     ACL are passed to the files and subdirectories:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       A subdirectory inherits the default ACL of the parent directory both
       as its default ACL and as an ACL.
      </p></li><li class="listitem"><p>
       A file inherits the default ACL as its ACL.
      </p></li></ul></div><p>
     All system calls that create file system objects use a
     <code class="literal">mode</code> parameter that defines the access permissions
     for the newly created file system object. If the parent directory does
     not have a default ACL, the permission bits as defined by the
     <code class="literal">umask</code> are subtracted from the permissions as passed
     by the <code class="literal">mode</code> parameter, with the result being
     assigned to the new object. If a default ACL exists for the parent
     directory, the permission bits assigned to the new object correspond to
     the overlapping portion of the permissions of the
     <code class="literal">mode</code> parameter and those that are defined in the
     default ACL. The <code class="literal">umask</code> is disregarded in this case.
    </p></section><section class="sect3" id="sec-security-acls-handle-defacl-prac" data-id-title="Application of default ACLs"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">19.4.3.2 </span><span class="title-name">Application of default ACLs</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-handle-defacl-prac">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The following three examples show the main operations for directories
     and default ACLs:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       Add a default ACL to the existing directory
       <code class="filename">mydir</code> with:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>setfacl -d -m group:mascots:r-x mydir</pre></div><p>
       The option <code class="literal">-d</code> of the <code class="command">setfacl</code>
       command prompts <code class="command">setfacl</code> to perform the following
       modifications (option <code class="literal">-m</code>) in the default ACL.
      </p><p>
       Take a closer look at the result of this command:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>getfacl mydir

# file: mydir
# owner: tux
# group: project3
user::rwx
user:geeko:rwx
group::r-x
group:mascots:rwx
mask::rwx
other::---
default:user::rwx
default:group::r-x
default:group:mascots:r-x
default:mask::r-x
default:other::---</pre></div><p>
       <code class="command">getfacl</code> returns both the ACL and the default ACL.
       The default ACL is formed by all lines that start with
       <code class="literal">default</code>. Although you merely executed the
       <code class="command">setfacl</code> command with an entry for the
       <code class="literal">mascots</code> group for the default ACL,
       <code class="command">setfacl</code> automatically copied all other entries
       from the ACL to create a valid default ACL. Default ACLs do not have
       an immediate effect on access permissions. They only come into play
       when file system objects are created. These new objects inherit
       permissions only from the default ACL of their parent directory.
      </p></li><li class="listitem"><p>
       In the next example, use <code class="command">mkdir</code> to create a
       subdirectory in <code class="filename">mydir</code>, which inherits the
       default ACL.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>mkdir mydir/mysubdir

getfacl mydir/mysubdir

# file: mydir/mysubdir
# owner: tux
# group: project3
user::rwx
group::r-x
group:mascots:r-x
mask::r-x
other::---
default:user::rwx
default:group::r-x
default:group:mascots:r-x
default:mask::r-x
default:other::---</pre></div><p>
       As expected, the newly created subdirectory
       <code class="filename">mysubdir</code> has the permissions from the default
       ACL of the parent directory. The ACL of <code class="filename">mysubdir</code>
       is an exact reflection of the default ACL of
       <code class="filename">mydir</code>. The default ACL that this directory will
       hand down to its subordinate objects is also the same.
      </p></li><li class="listitem"><p>
       Use <code class="command">touch</code> to create a file in the
       <code class="filename">mydir</code> directory, for example,
       <code class="command">touch</code> <code class="option">mydir/myfile</code>.
       <code class="command">ls</code> <code class="option">-l mydir/myfile</code> then shows:
      </p><div class="verbatim-wrap"><pre class="screen">-rw-r-----+ ... tux project3 ... mydir/myfile</pre></div><p>
       The output of <code class="command">getfacl</code>
       <code class="option">mydir/myfile</code> is:
      </p><div class="verbatim-wrap"><pre class="screen"># file: mydir/myfile
# owner: tux
# group: project3
user::rw-
group::r-x          # effective:r--
group:mascots:r-x   # effective:r--
mask::r--
other::---</pre></div><p>
       <code class="command">touch</code> uses a <code class="literal">mode</code> with the
       value <code class="literal">0666</code> when creating new files, which means
       that the files are created with read and write permissions for all
       user classes, provided no other restrictions exist in
       <code class="command">umask</code> or in the default ACL (see
       <a class="xref" href="#sec-security-acls-handle-defacl-eff" title="19.4.3.1. Effects of a default ACL">Section 19.4.3.1, “Effects of a default ACL”</a>). In effect,
       this means that all access permissions not contained in the
       <code class="literal">mode</code> value are removed from the respective ACL
       entries. Although no permissions were removed from the ACL entry of
       the group class, the mask entry was modified to mask permissions not
       set in <code class="literal">mode</code>.
      </p><p>
       This approach ensures the smooth interaction of applications (such as
       compilers) with ACLs. You can create files with restricted access
       permissions and subsequently mark them as executable. The
       <code class="command">mask</code> mechanism guarantees that the right users and
       groups can execute them as desired.
      </p></li></ol></div></section></section><section class="sect2" id="sec-security-acls-handle-alg" data-id-title="The ACL check algorithm"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">19.4.4 </span><span class="title-name">The ACL check algorithm</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-handle-alg">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A check algorithm is applied before any process or application is
    granted access to an ACL-protected file system object. As a basic rule,
    the ACL entries are examined in the following sequence: owner, named
    user, owning group or named group, and other. The access is handled in
    accordance with the entry that best suits the process. Permissions do
    not accumulate.
   </p><p>
    Things are more complicated if a process belongs to more than one group
    and would potentially suit several group entries. An entry is randomly
    selected from the suitable entries with the required permissions. It is
    irrelevant which of the entries triggers the final result <span class="quote">“<span class="quote">access
    granted</span>”</span>. Likewise, if none of the suitable group entries contain
    the required permissions, a randomly selected entry triggers the final
    result <span class="quote">“<span class="quote">access denied</span>”</span>.
   </p></section></section><section class="sect1" id="sec-security-acls-future" data-id-title="ACL support in applications"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.5 </span><span class="title-name">ACL support in applications</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-future">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   ACLs can be used to implement very complex permission scenarios that meet
   the requirements of modern applications. The traditional permission
   concept and ACLs can be combined in a smart manner. The basic file
   commands (<code class="command">cp</code>, <code class="command">mv</code>,
   <code class="command">ls</code>, etc.) support ACLs, as do Samba and Nautilus.
  </p><p>
   Vi/Vim and emacs both fully support ACLs by preserving the permissions on
   writing files including backups. Unfortunately, many editors and file
   managers still lack ACL support.  When modifying files with an editor, the
   ACLs of files are sometimes preserved and sometimes not, depending on the
   backup mode of the editor used. If the editor writes the changes to the
   original file, the ACL is preserved. If the editor saves the updated
   contents to a new file that is subsequently renamed to the old file name,
   the ACLs may be lost, unless the editor supports ACLs. Except for the
   <code class="command">star</code> archiver, there are currently no backup applications
   that preserve ACLs.
  </p></section><section class="sect1" id="sec-security-acls-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">19.6 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-security-acls-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_acls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For more information about ACLs, see the man pages for
   <code class="command">getfacl(1)</code>, <code class="command">acl(5)</code>, and
   <code class="command">setfacl(1)</code>.
  </p></section></section><section class="chapter" id="cha-aide" data-id-title="Intrusion detection with AIDE"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">20 </span><span class="title-name">Intrusion detection with AIDE</span></span> <a title="Permalink" class="permalink" href="#cha-aide">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_aide.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Securing your systems is a mandatory task for any mission-critical
    system administrator. Because it is impossible to always guarantee that
    the system is not compromised, it is very important to do extra checks
    regularly (for example with
    <code class="systemitem">cron</code>) to ensure that the system
    is still under your control. This is where AIDE, the
    <span class="emphasis"><em>Advanced Intrusion Detection Environment</em></span>, comes
    into play.
   </p></div></div></div></div><section class="sect1" id="sec-aide-why" data-id-title="Why use AIDE?"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.1 </span><span class="title-name">Why use AIDE?</span></span> <a title="Permalink" class="permalink" href="#sec-aide-why">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_aide.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   An easy check that often can reveal unwanted changes can be done by means
   of RPM. The package manager has a built-in verify function that checks
   all the managed files in the system for changes. To verify of all files,
   run the command <code class="command">rpm -Va</code>. However, this command will
   also display changes in configuration files and you will need to do some
   filtering to detect important changes.
  </p><p>
   An additional problem to the method with RPM is that an intelligent
   attacker will modify <code class="command">rpm</code> itself to hide any changes
   that might have been done by some kind of root-kit which allows the
   attacker to mask its intrusion and gain root privilege. To solve this,
   you should implement a secondary check that can also be run completely
   independent of the installed system.
  </p></section><section class="sect1" id="sec-aide-setup" data-id-title="Setting up an AIDE database"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.2 </span><span class="title-name">Setting up an AIDE database</span></span> <a title="Permalink" class="permalink" href="#sec-aide-setup">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_aide.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.5.13.4.2" data-id-title="Initialize AIDE database after installation" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Initialize AIDE database after installation</div><p>
    Before you install your system, verify the checksum of your medium (see
    <span class="intraxref">Book “Deployment Guide”, Chapter 8 “Troubleshooting”, Section 8.1 “Checking media”</span>) to make sure you do not use
    a compromised source. After you have installed the system, initialize
    the AIDE database. To make sure that all went well during and
    after the installation, do an installation directly on the console,
    without any network attached to the computer. Do not leave the computer
    unattended or connected to any network before AIDE creates its
    database.
   </p></div><p>
   AIDE is not installed by default on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. To install it,
   either use <span class="guimenu">Computer</span> › <span class="guimenu">Install
   Software</span>, or enter <code class="literal">zypper install
   aide</code> on the command line as <code class="systemitem">root</code>.
  </p><p>
   To tell AIDE which attributes of which files should be checked, use
   the <code class="filename">/etc/aide.conf</code> configuration file. It must be
   modified to become the actual configuration. The first section handles
   general parameters like the location of the AIDE database file. More
   relevant for local configurations are the <code class="systemitem">Custom
   Rules</code> and the <code class="systemitem">Directories and Files</code>
   sections. A typical rule looks like the following:
  </p><div class="verbatim-wrap"><pre class="screen">Binlib     = p+i+n+u+g+s+b+m+c+md5+sha1</pre></div><p>
   After defining the variable <code class="literal">Binlib</code>, the respective
   check boxes are used in the files section. Important options include the
   following:
  </p><div class="table" id="tab-aide-options" data-id-title="Important AIDE check boxes"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 20.1: </span><span class="title-name">Important AIDE check boxes </span></span><a title="Permalink" class="permalink" href="#tab-aide-options">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_aide.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Option
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Description
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        p
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check for the file permissions of the selected files or directories.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        i
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check for the inode number. Every file name has a unique inode
        number that should not change.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        n
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check for the number of links pointing to the relevant file.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        u
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check if the owner of the file has changed.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        g
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check if the group of the file has changed.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        s
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check if the file size has changed.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        b
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check if the block count used by the file has changed.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        m
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check if the modification time of the file has changed.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        c
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check if the files access time has changed.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        S
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check for a changed file size.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        I
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Ignore changes of the file name.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        md5
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check if the md5 checksum of the file has changed. We recommend
        to use sha256 or sha512.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        sha1
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check if the sha1 (160 Bit) checksum of the file has changed. We
        recommend to use sha256 or sha512.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        sha256
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Check if the sha256 checksum of the file has changed.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        sha512
       </p>
      </td><td>
       <p>
        Check if the sha512 checksum of the file has changed.
       </p>
      </td></tr></tbody></table></div></div><p>
   This is a configuration that checks for all files in
   <code class="filename">/sbin</code> with the options defined in
   <code class="literal">Binlib</code> but omits the
   <code class="filename">/sbin/conf.d/</code> directory:
  </p><div class="verbatim-wrap"><pre class="screen">/sbin  Binlib
!/sbin/conf.d</pre></div><p>
   To create the AIDE database, proceed as follows:
  </p><div class="procedure" id="pro-aide-setup-db"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Open <code class="filename">/etc/aide.conf</code>.
    </p></li><li class="step"><p>
     Define which files should be checked with which check boxes. For a
     complete list of available check boxes, see
     <code class="filename">/usr/share/doc/packages/aide/manual.html</code>. The
     definition of the file selection needs some knowledge about regular
     expressions. Save your modifications.
    </p></li><li class="step"><p>
     To check whether the configuration file is valid, run:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>aide --config-check</pre></div><p>
     Any output of this command is a hint that the configuration is not
     valid. For example, if you get the following output:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>aide --config-check
35:syntax error:!
35:Error while reading configuration:!
Configuration error</pre></div><p>
     The error is to be expected in line 36 of
     <code class="filename">/etc/aide.conf</code>. Note that the error message
     contains the last successfully read line of the configuration file.
    </p></li><li class="step"><p>
     Initialize the AIDE database. Run the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>aide -i</pre></div></li><li class="step"><p>
     Copy the generated database to a save location like a CD-R or DVD-R, a
     remote server or a flash disk for later use.
    </p><div id="id-1.7.5.13.4.11.5.2" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
      This step is essential as it avoids compromising your database. It is
      recommended to use a medium which can be written only once to prevent
      the database being modified. <span class="emphasis"><em>Never</em></span> leave the
      database on the computer which you want to monitor.
     </p></div></li></ol></div></div></section><section class="sect1" id="sec-aide-check" data-id-title="Local AIDE checks"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.3 </span><span class="title-name">Local AIDE checks</span></span> <a title="Permalink" class="permalink" href="#sec-aide-check">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_aide.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To perform a file system check, proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Rename the database:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db</pre></div></li><li class="step"><p>
     After any configuration change, you always need to re-initialize the
     AIDE database and subsequently move the newly generated database.
     It is also a good idea to make a backup of this database. See
     <a class="xref" href="#sec-aide-setup" title="20.2. Setting up an AIDE database">Section 20.2, “Setting up an AIDE database”</a> for more information.
    </p></li><li class="step"><p>
     Perform the check with the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>aide --check</pre></div></li></ol></div></div><p>
   If the output is empty, everything is fine. If AIDE found changes,
   it displays a summary of changes, for example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>aide --check
AIDE found differences between database and filesystem!!

Summary:
  Total number of files:        1992
  Added files:                  0
  Removed files:                0
  Changed files:                1</pre></div><p>
   To learn about the actual changes, increase the verbose level of the
   check with the parameter <code class="literal">-V</code>. For the previous example,
   this could look like the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>aide --check -V
AIDE found differences between database and filesystem!!
Start timestamp: 2009-02-18 15:14:10

Summary:
  Total number of files:        1992
  Added files:                  0
  Removed files:                0
  Changed files:                1


---------------------------------------------------
Changed files:
---------------------------------------------------

changed: /etc/passwd

--------------------------------------------------
Detailed information about changes:
---------------------------------------------------


File: /etc/passwd
  Mtime    : 2009-02-18 15:11:02              , 2009-02-18 15:11:47
  Ctime    : 2009-02-18 15:11:02              , 2009-02-18 15:11:47</pre></div><p>
   In this example, the file <code class="filename">/etc/passwd</code> was touched to
   demonstrate the effect.
  </p></section><section class="sect1" id="sec-aide-independent" data-id-title="System independent checking"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.4 </span><span class="title-name">System independent checking</span></span> <a title="Permalink" class="permalink" href="#sec-aide-independent">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_aide.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To avoid risk, it is advisable to also run the AIDE binary from a
   trusted source. This excludes the risk that some attacker also modified
   the aide binary to hide its traces.
  </p><p>
   To accomplish this task, AIDE must be run from a rescue system that
   is independent of the installed system. With <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> it is
   relatively easy to extend the rescue system with arbitrary programs, and
   thus add the needed functionality.
  </p><p>
   Before you can start using the rescue system, you need to provide two
   packages to the system. These are included with the same syntax as you
   would add a driver update disk to the system. For a detailed description
   about the possibilities of linuxrc that are used for this purpose, see
   <a class="link" href="https://en.opensuse.org/SDB:Linuxrc" target="_blank">https://en.opensuse.org/SDB:Linuxrc</a>. In the
   following, one possible way to accomplish this task is discussed.
  </p><div class="procedure" id="id-1.7.5.13.6.5" data-id-title="Starting a rescue system with AIDE"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 20.1: </span><span class="title-name">Starting a rescue system with AIDE </span></span><a title="Permalink" class="permalink" href="#id-1.7.5.13.6.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_aide.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Provide an FTP server as a second machine.
    </p></li><li class="step"><p>
     Copy the packages <code class="systemitem">aide</code> and
     <code class="systemitem">mhash</code> to the FTP server directory, in our case
     <code class="filename">/srv/ftp/</code>. Replace the placeholders
     <em class="replaceable">ARCH</em> and <em class="replaceable">VERSION</em>
     with the corresponding values:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cp DVD1/suse/<em class="replaceable">ARCH</em>/aide<em class="replaceable">VERSION</em>.<em class="replaceable">ARCH</em>.rpm /srv/ftp
<code class="prompt root"># </code>cp DVD1/suse/<em class="replaceable">ARCH</em>/mhash<em class="replaceable">VERSION</em>.<em class="replaceable">ARCH</em>.rpm /srv/ftp</pre></div></li><li class="step"><p>
     Create an info file <code class="filename">/srv/ftp/info.txt</code> that
     provides the needed boot parameters for the rescue system:
    </p><div class="verbatim-wrap"><pre class="screen">dud:ftp://ftp.example.com/aide<em class="replaceable">VERSION</em>.<em class="replaceable">ARCH</em>.rpm
dud:ftp://ftp.example.com/mhash<em class="replaceable">VERSION</em>.<em class="replaceable">ARCH</em>.rpm</pre></div><p>
     Replace your FTP domain name, <em class="replaceable">VERSION</em> and
     <em class="replaceable">ARCH</em> with the values used on your system.
    </p></li><li class="step"><p>
     Restart the server that needs to go through an AIDE check with the
     Rescue system from your DVD. Add the following string to the boot
     parameters:
    </p><div class="verbatim-wrap"><pre class="screen">info=ftp://ftp.example.com/info.txt</pre></div><p>
     This parameter tells <code class="command">linuxrc</code> to also read in all
     information from the <code class="filename">info.txt</code> file.
    </p></li></ol></div></div><p>
   After the rescue system has booted, the AIDE program is ready for
   use.
  </p></section><section class="sect1" id="sec-aide-more" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">20.5 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-aide-more">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_aide.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Information about AIDE is available at the following places:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     The home page of AIDE:
     <a class="link" href="https://aide.github.io/" target="_blank">https://aide.github.io/</a>
    </p></li><li class="listitem"><p>
     In the documented template configuration
     <code class="filename">/etc/aide.conf</code>.
    </p></li><li class="listitem"><p>
     In several files below
     <code class="filename">/usr/share/doc/packages/aide</code> after installing the
     <code class="systemitem">aide</code> package.
    </p></li><li class="listitem"><p>
     On the AIDE user mailing list at
     <a class="link" href="https://www.ipi.fi/mailman/listinfo/aide" target="_blank">https://www.ipi.fi/mailman/listinfo/aide</a>.
    </p></li></ul></div></section></section></div><div class="part" id="part-network-security" data-id-title="Network security"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part III </span><span class="title-name">Network security </span></span><a title="Permalink" class="permalink" href="#part-network-security">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_security.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-xauth"><span class="title-number">21 </span><span class="title-name">X Window System and X authentication</span></a></span></li><dd class="toc-abstract"><p>Network transparency is one of the central characteristics of a Unix system. X, the windowing system of Unix operating systems, can use this feature in an impressive way. With X, it is no problem to log in to a remote host and start a graphical program that is then sent over the network to be displa…</p></dd><li><span class="chapter"><a href="#cha-ssh"><span class="title-number">22 </span><span class="title-name">Securing network operations with OpenSSH</span></a></span></li><dd class="toc-abstract"><p>
    OpenSSH is the SSH (secure shell) implementation that ships with SUSE Linux Enterprise Server,
    for securing network operations such as remote administration, file
    transfers, and tunneling insecure protocols. SSH encrypts all traffic
    between two hosts, including authentication, to protect against
    eavesdropping and connection hijacking. This chapter covers basic
    operations, plus host key rotation and certificate authentication, which
    are useful for managing larger SSH deployments.
   </p></dd><li><span class="chapter"><a href="#cha-security-firewall"><span class="title-number">23 </span><span class="title-name">Masquerading and firewalls</span></a></span></li><dd class="toc-abstract"><p>Whenever Linux is used in a network environment, you can use the kernel functions that allow the manipulation of network packets to maintain a separation between internal and external network areas. The Linux netfilter framework provides the means to establish an effective firewall that keeps differ…</p></dd><li><span class="chapter"><a href="#cha-security-vpnserver"><span class="title-number">24 </span><span class="title-name">Configuring a VPN server</span></a></span></li><dd class="toc-abstract"><p>
    Today, Internet connections are cheap and available almost
    everywhere. However, not all connections are secure.
    Using a Virtual Private Network (VPN), you can create a secure network
    within an insecure network such as the Internet or Wi-Fi. It can be
    implemented in different ways and serves several purposes. In this chapter,
    we focus on the
    <a class="link" href="https://openvpn.net" target="_blank">OpenVPN</a> implementation
    to link branch offices via secure wide area networks (WANs).

        </p></dd><li><span class="chapter"><a href="#cha-security-xca"><span class="title-number">25 </span><span class="title-name">Managing a PKI with XCA, X certificate and key manager</span></a></span></li><dd class="toc-abstract"><p>
        Managing your own public key infrastructure (PKI) is traditionally
        done with the <code class="command">openssl</code> utility. For admins who
        prefer a graphical tool, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP4</span></span> includes XCA,
        the X Certificate and Key management tool
        (<a class="link" href="http://hohnstaedt.de/xca" target="_blank">http://hohnstaedt.de/xca</a>).
      </p><p>
        XCA creates and manages X.509 certificates, certificate requests,
        RSA, DSA, and EC private keys, Smartcards, and certificate revocation
        lists (CRLs). XCA supports everything you need to create and manage
        your own certificate authority (CA). XCA includes customizable
        templates that can be used for certificate or request generation.
        This chapter describes a basic setup.
      </p></dd><li><span class="chapter"><a href="#cha-sec-sysctl"><span class="title-number">26 </span><span class="title-name">Improving network security with <code class="command">sysctl</code> variables</span></a></span></li><dd class="toc-abstract"><p>Sysctl (system control) variables control certain kernel parameters that influence the behavior of different parts of the operating system, for example the Linux network stack. These parameters can be looked up in the proc file system, in /proc/sys. Many kernel parameters can be changed directly by …</p></dd></ul></div><section class="chapter" id="cha-xauth" data-id-title="X Window System and X authentication"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">21 </span><span class="title-name">X Window System and X authentication</span></span> <a title="Permalink" class="permalink" href="#cha-xauth">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_xforwarding.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Network transparency is one of the
  central characteristics of a Unix system. X, the windowing system of
  Unix operating systems, can use this feature in an impressive
  way. With X, it is no problem to log in to a remote host and start a
  graphical program that is then sent over the network to be displayed on
  your computer.
 </p><p>
  When an X client needs to be displayed remotely using an X server,
  the latter should protect the resource managed by it (the display)
  from unauthorized access. In more concrete terms, certain permissions
  must be given to the client program. With the X Window System, there
  are two ways to do this, called host-based access control and
  cookie-based access control. The former relies on the IP address of
  the host where the client should run. The program to control this is
  <code class="command">xhost</code>. <code class="command">xhost</code> enters the IP
  address of a legitimate client into a database belonging to the X
  server. However, relying on IP addresses for authentication is not
  very secure. For example, if there were a second user working on the
  host sending the client program, that user would have access to the X
  server as well—like someone spoofing the IP address. Because of
  these shortcomings, this authentication method is not described in
  more detail here, but you can learn about it with
  <code class="command">man</code> <code class="option">xhost</code>.
 </p><p>
  In the case of cookie-based access control, a character string is
  generated that is only known to the X server and to the legitimate
  user, like an ID card of some kind. This cookie is stored on login in
  the file <code class="filename">.Xauthority</code> in the user's home directory
  and is available to any X client wanting to use the X server to display
  a window. The file <code class="filename">.Xauthority</code> can be examined by
  the user with the tool <code class="command">xauth</code>. If you rename
  <code class="filename">.Xauthority</code>, or if you delete the file from your
  home directory by accident, you cannot open any new
  windows or X clients.
 </p><p>
  SSH (secure shell) can be used to encrypt a network connection and
  forward it to an X server transparently. This is also called X
  forwarding. X forwarding is achieved by simulating an X server on the
  server side and setting a DISPLAY variable for the shell on the
  remote host. Further details about SSH can be found in <a class="xref" href="#cha-ssh" title="Chapter 22. Securing network operations with OpenSSH">Chapter 22, <em>Securing network operations with OpenSSH</em></a>.
 </p><div id="id-1.7.6.3.7" data-id-title="X forwarding can be insecure" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: X forwarding can be insecure</div><p>
   If you do not consider the computer where you log in to be a secure host,
   do not use X forwarding. If X forwarding is enabled, an attacker could
   authenticate via your SSH connection. The attacker could then intrude
   on your X server and, for example, read your keyboard input.
  </p></div></section><section xml:lang="en" class="chapter" id="cha-ssh" data-id-title="Securing network operations with OpenSSH"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">22 </span><span class="title-name">Securing network operations with OpenSSH</span></span> <a title="Permalink" class="permalink" href="#cha-ssh">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    OpenSSH is the SSH (secure shell) implementation that ships with SUSE Linux Enterprise Server,
    for securing network operations such as remote administration, file
    transfers, and tunneling insecure protocols. SSH encrypts all traffic
    between two hosts, including authentication, to protect against
    eavesdropping and connection hijacking. This chapter covers basic
    operations, plus host key rotation and certificate authentication, which
    are useful for managing larger SSH deployments.
   </p></div></div></div></div><section class="sect1" id="sec-ssh-overview" data-id-title="OpenSSH overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.1 </span><span class="title-name">OpenSSH overview</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-overview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   SSH is a network protocol that provides end-to-end protection for
   communications between the computers on your network, or between
   computers on your network and systems outside your network. You may
   open an SSH session to any other computer, as long as you have a login
   and the correct authentication methods for the remote computer.
  </p><p>
   SSH is a client-server protocol. Any host running the
   <code class="systemitem">sshd</code>
   daemon can accept SSH connections from any other host. Every host running
   <code class="systemitem">sshd</code> can have their own
   custom configurations, such as limiting who can have access, and which
   authentication methods are allowed.
  </p><p>
   Authentication and encryption are provided by encryption key pairs. Each
   key pair has a public key and a private key. Public keys encrypt, and
   private keys decrypt. Public keys are meant to be freely shared, while
   private keys must be protected and not shared. When a private key is
   compromised, anyone who has possession of it can masquerade as the
   original key owner.
  </p><p>
   SSH provides very strong protection, because the server and client
   must both authenticate to each other. When a client first attempts to
   open an SSH session, the server presents its public host key. If the
   client already possesses a copy of this key (stored in
   <code class="filename">~/.ssh/known_hosts</code> on the client machine), the
   client knows to trust the server. If the client does not have the
   appropriate host key, it is asked whether it should trust the server:
  </p><div class="verbatim-wrap"><pre class="screen">The authenticity of host '192.168.22.219 (192.168.22.219)'
   can't be established. ECDSA key fingerprint is
   SHA256:yXf6pjV26N0fegvEYIt3HgG95s3Q1X6WYRhtHLF99pUo.
   Are you sure you want to continue connecting (yes/no/[fingerprint])?</pre></div><p>
   The user can type yes, no, or paste their copy of the host key
   fingerprint for comparison.
  </p><div id="id-1.7.6.4.3.8" data-id-title="Matching host key fingerprints" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Matching host key fingerprints</div><p>
    Distributing copies of your host key fingerprints to your users
    enables them to verify that they are receiving the correct host
    keys. When they paste their copy of a host key fingerprint,
    <code class="command">ssh</code> compares the fingerprints, and accepts the
    offered host key when the fingerprints match. This ensures a more
    accurate match than a visual comparison.
   </p><p>
    You can't rely on users to use correct verification methods. If the
    fingerprints do not match, the user can still type
    <code class="literal">yes</code>, or copy the fingerprint in the message, and
    complete the connection. A stronger alternative is to use
    certificate authentication, which provides a global authentication
    mechansism, and does not require perfect behavior from users
    (see <a class="xref" href="#sec-ssh-certificate-auth" title="22.8. OpenSSH certificate authentication">Section 22.8, “OpenSSH certificate authentication”</a>).
   </p></div><p>
   If the public keys of a host have changed, the connection is denied with
   a scary warning:
  </p><div class="verbatim-wrap"><pre class="screen">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint for the ECDSA key sent by the remote host is
SHA256:keNu/rJFWmpQu9B0SjIuo8NLjbeDY/x3Tktpl7oDJqo.
Please contact your system administrator.
Add correct host key in /home/geeko/.ssh/known_hosts to get rid of this message.
Offending ECDSA key in /home/geeko/.ssh/known_hosts:210
You can use following command to remove the offending key:
ssh-keygen -R 192.168.121.219 -f /home/geeko/.ssh/known_hosts
ECDSA host key for 192.168.121.219 has changed and you have requested strict
checking.
Host key verification failed.</pre></div><p>
   The remedy is to delete the offending key from
   <code class="filename">~/.ssh/known_hosts</code> with the command given
   in the scary warning, then re-connect and accept the new host key.
   
  </p><p>
   The <span class="package">openssh</span> package installs the server, client,
   file transfer commands, and some utilities.
  </p><p>
   OpenSSH supports several different types of authentication:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.4.3.14.1"><span class="term">Password authentication</span></dt><dd><p>
      Uses any system login and password on the remote machine. This is the
      simplest and most flexible authentication because you can open an SSH
      session from anywhere, on any machine. It is also the least secure,
      because it is vulnerable to password-cracking and keystroke logging.
      </p></dd><dt id="id-1.7.6.4.3.14.2"><span class="term">Public key authentication</span></dt><dd><p>
      Authenticates with your personal SSH keys, rather than a login and
      password. This is less flexible than password authentication,
      because you can open SSH sessions only from a machine that holds
      your private identity key. It is much stronger because it is not
      vulnerable to password cracking or keystroke logging; an attacker must
      possess your private key and know its passphrase.
     </p><p>
       See <a class="xref" href="#sec-ssh-gnome-keyring" title="22.9. Automated public key logins with gnome-keyring">Section 22.9, “Automated public key logins with gnome-keyring”</a> to learn how to use
       <code class="command">gnome-keyring</code> for automated public key
       authentication in GNOME sessions.
      </p><p>
       See <a class="xref" href="#sec-ssh-authentic-agent" title="22.10.1. Using ssh-agent in an X session">Section 22.10.1, “Using <code class="command">ssh-agent</code> in an X session”</a> to learn how to use
       <code class="literal">ssh-agent</code> for automated public key
       authentication in console sessions.
      </p></dd><dt id="id-1.7.6.4.3.14.3"><span class="term">Passphrase-less public key authentication</span></dt><dd><p>
       Public key authentication, paired with private identity keys that do
       not have passphrases. This is useful for automated services, like
       scripts and cron jobs. You must protect private keys, because anyone
       who gains access to them can easily masquerade as the key owner.
      </p></dd><dt id="id-1.7.6.4.3.14.4"><span class="term">Certificate authentication</span></dt><dd><p>
       OpenSSH supports certification authentication, for easier key
       management, stronger authentication, and large-scale SSH deployments.
      </p></dd></dl></div><p>
  <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> installs the OpenSSH package by default, providing the
  following commands:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.4.3.16.1"><span class="term"><code class="command">ssh</code></span></dt><dd><p>
     The client command for initiating an SSH connection to a remote host.
    </p></dd><dt id="id-1.7.6.4.3.16.2"><span class="term"><code class="command">scp</code></span></dt><dd><p>
     Secure file copy from or to a remote host.
    </p></dd><dt id="id-1.7.6.4.3.16.3"><span class="term"><code class="command">sftp</code></span></dt><dd><p>
     Secure file transfer between a client and an SFTP server.
     (Note that the SFTP protocol (SSH FTP) is not related to FTPS or
     FTPES (FTP over SSL/TLS), but was written independently.)
    </p></dd><dt id="id-1.7.6.4.3.16.4"><span class="term"><code class="command">ssh-add</code></span></dt><dd><p>
     Add private key identities to the authentication agent,
     <code class="literal">ssh-agent</code>.
    </p></dd><dt id="id-1.7.6.4.3.16.5"><span class="term"><code class="command">ssh-agent</code></span></dt><dd><p>
     Manages a user's private identity keys and their passphrases, for
     public key authentication. <code class="literal">ssh-agent</code> holds the
     passphrases in memory and applies them as needed, so that users do not
     have to re-type their passphrases to authenticate.
    </p></dd><dt id="id-1.7.6.4.3.16.6"><span class="term"><code class="command">ssh-copy-id</code></span></dt><dd><p>
     Securely transfer a public key to a remote host, to set up
     public key authentication.
    </p></dd></dl></div></section><section class="sect1" id="sec-ssh-server-config" data-id-title="Server hardening"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.2 </span><span class="title-name">Server hardening</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-server-config">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  OpenSSH ships with a usable default server configuration, but there are
  additional steps you can take to secure your server.
 </p><div id="id-1.7.6.4.4.3" data-id-title="Maintaining access to a remote SSH server" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Maintaining access to a remote SSH server</div><p>
   When you make changes to any SSH server, either have physical
   access to the machine, or keep an active root SSH session open until
   you have tested your changes, and everything works correctly. Then you can revert or correct your changes if something goes wrong.
  </p></div><p>
  The default server configuration file, <code class="filename">/etc/ssh/sshd_config</code>,
  contains the default configuration, and all the defaults are commented
  out. Override any default item by entering your own configuration item,
  uncommented, like the following example that sets a different listening
  port, and specifies the listening IPv4 address on a multi-homed host:
 </p><div class="verbatim-wrap"><pre class="screen">#Port 22
Port <em class="replaceable">2022</em>

#ListenAddress 0.0.0.0
ListenAddress <em class="replaceable">192.168.10.100</em></pre></div><div id="id-1.7.6.4.4.6" data-id-title="Update /etc/services" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Update /etc/services</div><p>
  When you use non-standard listening ports, first check the
  <code class="filename">/etc/services</code> file for unused ports.
  Select any unused port above 1024. Then document the ports you are using
  in <code class="filename">/etc/services</code>.
 </p></div><p>
  It is a best practice to disallow root logins. Instead, log into the
  remote machine as an unprivileged user, then use <code class="command">sudo</code>
  to run commands as root. If you really want to allow root logins, the
  following server configuration example shows how to configure the server
  to accept only public-key authentication
  (<a class="xref" href="#sec-ssh-public-key-auth" title="22.6. Public key authentication">Section 22.6, “Public key authentication”</a>) for the root user with the
  <code class="literal">PermitRootLogin prohibit-password</code> and
  <code class="literal">PasswordAuthentication</code> options.
 </p><p>
  The following settings for <code class="filename">/etc/ssh/sshd_config</code>
  strengthen access controls:
 </p><div class="example" id="ex-sshd-conf" data-id-title="Example sshd_config"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 22.1: </span><span class="title-name">Example sshd_config </span></span><a title="Permalink" class="permalink" href="#ex-sshd-conf">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="programlisting"># Check if the file modes and ownership of the user’s files and
# home directory are correct before allowing them to login
StrictModes yes

# If your machine has more than one IP address, define which address or
# addresses it listens on
ListenAddress <em class="replaceable">192.168.10.100</em>

# Allow only members of the listed groups to log in
AllowGroups <em class="replaceable">ldapadmins backupadmins</em>

# Or, deny certain groups. If you use both, DenyGroups is read first
DenyGroups <em class="replaceable">users</em>

# Allow or deny certain users. If you use both, DenyUsers is read first
AllowUsers <em class="replaceable">user1 user2@example.com user3</em>
DenyUsers <em class="replaceable">user4 user5@192.168.10.10</em>

# Allow root logins only with public key authentication
PermitRootLogin prohibit-password

# Disable password authentication and allow only public key authentication
# for all users
PasswordAuthentication no

# Length of time the server waits for a user to log in and complete the
# connection. The default is 120 seconds:
LoginGraceTime <em class="replaceable">60</em>

# Limit the number of failed connection attempts. The default is 6
MaxAuthTries <em class="replaceable">4</em></pre></div></div></div><p>
  After changing <code class="filename">/etc/ssh/sshd_config</code>, run the syntax
  checker:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">sshd -t</code></pre></div><p>
  The syntax checker only checks for correct syntax, and does not find
  configuration errors. When you are finished, reload the configuration:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl reload sshd.service</code></pre></div><p>
  Check the server's key directories for correct permissions.
 </p><p>
  <code class="filename">/etc/ssh</code> should be mode 0755/drwxr-xr-x, owned by
  root:root.
 </p><p>
  Private keys should be 0600/-rw-------, owned by root:root.
 </p><p>
  Public keys should be 0644/-rw-r--r--, owned by root:root.
 </p></section><section class="sect1" id="sec-ssh-password-auth" data-id-title="Password authentication"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.3 </span><span class="title-name">Password authentication</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-password-auth">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   With password authentication, all you need is the login and password of
   a user on the remote machine, and
   <code class="systemitem">sshd</code> set up and running on the
   remote machine. You do not need any personal SSH keys. In the following
   example, user suzanne opens an SSH session to the host
   sun:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh suzanne@sun</code></pre></div><p>
   suzanne will be prompted to enter the remote password.
   Type <code class="literal">exit</code> and press <span class="keycap">Enter</span> to close an
   SSH session.
  </p><p>
   If the user name is the same on both machines, you can omit it, and then
   using <code class="command">ssh <em class="replaceable">HOST_NAME</em></code> is
   sufficient. After a successful authentication, you can work on the
   command line or use interactive applications, such as YaST in text
   mode.
  </p><p>
   You may also run non-interactive commands (log in, run the command, then
   the session closes all in one command) on remote systems using the
   <code class="command">ssh <em class="replaceable">USER_NAME HOST COMMAND</em></code>
   syntax.
   <em class="replaceable">COMMAND</em> must be properly quoted. Multiple
   commands can be concatenated as on a local shell:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh suzanne@sun "df -h &amp;&amp; du -sh  /home"</code>
<code class="prompt user">&gt; </code><code class="command">ssh suzanne@sun "sudo nano /etc/ssh/sshd_config"</code></pre></div><p>
   When you run <code class="command">sudo</code> on the remote machine, you will be
   prompted for the <code class="command">sudo</code> password.
  </p></section><section class="sect1" id="sec-ssh-authentic-gen-key" data-id-title="Managing user and host encryption keys"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.4 </span><span class="title-name">Managing user and host encryption keys</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-authentic-gen-key">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     There are several key types to choose from: DSA, RSA, ECDSA, ECDSA-SK,
     Ed25519, and Ed25519-SK. DSA was deprecated several years ago, and was
     disabled in OpenSSH 7.0 and should not be used. RSA is the most
     universal as it is older, and more widely used. (As of OpenSSH
     8.2, RSA is deprecated for host keys. Use ECDSA or Ed25519 for host
     keys.)
   </p><p>
     Ed25519 and ECDSA are stronger and faster. Ed25519 is
     considered to be the strongest. If you must support older clients
     that do not support Ed25519 or ECDSA, create host keys in all three
     formats.
   </p><div id="id-1.7.6.4.6.4" data-id-title="Older clients are unsafe" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Older clients are unsafe</div><p>
       Some older SSH clients do not support ECDSA and ED25519. ECDSA and
       ED25519 were released with OpenSSH 6.5 in 2014. It is
       important to keep security services updated, and, if possible,
       to not allow unsafe old clients.
     </p></div><p>
     SSH keys serve two purposes: authenticating servers to clients, and
     authenticating clients to servers (see
     <a class="xref" href="#sec-ssh-public-key-auth" title="22.6. Public key authentication">Section 22.6, “Public key authentication”</a>). Server host keys are stored
     in <code class="filename">/etc/ssh</code>. Users' personal keys are stored in
     <code class="filename">/home/<em class="replaceable">user</em>/.ssh</code>.
    </p><p>
     <code class="filename">/home/<em class="replaceable">user</em>/.ssh</code> is
     created when the user creates a new SSH key.
   </p><p>
     Host keys must not have passphrases.
   </p><p>
     In most cases, private user keys should have strong passphrases.
   </p><section class="sect2" id="sec-create-ssh-key-client" data-id-title="Creating user SSH key pairs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.4.1 </span><span class="title-name">Creating user SSH key pairs</span></span> <a title="Permalink" class="permalink" href="#sec-create-ssh-key-client">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
       The following procedure shows how to create user OpenSSH encryption
       keys.
      </p><div class="procedure" id="pro-create-ssh-client-keys" data-id-title="Creating default and customized keys"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 22.1: </span><span class="title-name">Creating default and customized keys </span></span><a title="Permalink" class="permalink" href="#pro-create-ssh-client-keys">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      To generate a user key pair with the default parameters (RSA, 3072
      bits), use the <code class="command">ssh-keygen</code> command with no options.
      Protect your private key with a strong passphrase:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-keygen</code>
Generating public/private rsa key pair.
Enter file in which to save the key (/home/tux/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in id_rsa
Your public key has been saved in id_rsa.pub
The key fingerprint is:
SHA256:z0uJIuc7Doy07bFTe1ppZHLVrkD/bWWlBAF/PcHjblU user@host2
The key's randomart image is:
+---[RSA 3072]----+
|          ..o... |
|           o . +E|
|        . . o +.=|
|       . o . o o+|
|  .   . S . . o +|
| . =  .= * + . = |
|  o *.o.= * . +  |
|   ..Bo+.. . .   |
|    oo==  .      |
+----[SHA256]-----+</pre></div></li><li class="step"><p>
        Create an RSA key pair with a longer bit length:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-keygen -b 4096</code></pre></div><p>
        OpenSSH RSA keys can be a maximum of 16,384 bits. However, longer bit
        lengths are not necessarily more desirable. See the GnuPG FAQ for
        more information, <a class="link" href="https://www.gnupg.org/faq/gnupg-faq.html#no_default_of_rsa4096" target="_blank">https://www.gnupg.org/faq/gnupg-faq.html#no_default_of_rsa4096</a>.
      </p></li><li class="step"><p>
       You may create as many user keys as you want, for accessing
       different servers. Each key pair must have a unique name, and  optionally, a comment. These help you remember what each
       key pair is for. Create an RSA key pair with a custom name and a
       comment:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-keygen -f <em class="replaceable">backup-server-key -C "infrastructure backup server"</em></code></pre></div></li><li class="step"><p>
       Create an Ed25519 key pair with a custom name and a comment:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-keygen -t ed25519 -f <em class="replaceable">ldap-server-key -C "Internal LDAP server"</em></code></pre></div><p>
       Ed25519 keys are fixed at 256 bits, which is equivalent in
       cryptographic strength to RSA 4096.
     </p></li></ol></div></div></section><section class="sect2" id="sec-create-ssh-host-keys" data-id-title="Creating SSH server host keys"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.4.2 </span><span class="title-name">Creating SSH server host keys</span></span> <a title="Permalink" class="permalink" href="#sec-create-ssh-host-keys">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Host keys are managed a little differently. A host key must not
      have a passphrase, and the key pairs are stored in
      <code class="filename">/etc/ssh</code>.
      OpenSSH automatically generates a set of host keys when it is
      installed, like the following example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ls -l /etc/ssh</code>
total 608
-rw------- 1 root root 577834 2021-05-06 04:48 moduli
-rw-r--r-- 1 root root   2403 2021-05-06 04:48 ssh_config
-rw-r----- 1 root root   3420 2021-05-06 04:48 sshd_config
-rw------- 1 root root   1381 2022-02-10 06:55 ssh_host_dsa_key
-rw-r--r-- 1 root root    604 2022-02-10 06:55 ssh_host_dsa_key.pub
-rw------- 1 root root    505 2022-02-10 06:55 ssh_host_ecdsa_key
-rw-r--r-- 1 root root    176 2022-02-10 06:55 ssh_host_ecdsa_key.pub
-rw------- 1 root root    411 2022-02-10 06:55 ssh_host_ed25519_key
-rw-r--r-- 1 root root     96 2022-02-10 06:55 ssh_host_ed25519_key.pub
-rw------- 1 root root   2602 2022-02-10 06:55 ssh_host_rsa_key
-rw-r--r-- 1 root root    568 2022-02-10 06:55 ssh_host_rsa_key.pub</pre></div><p>
      <code class="command">ssh-keygen</code> has a special option, <code class="option">-A</code>,
      for creating new host keys. This creates new keys for each of the key
      types for which host keys do not exist, with the default key file
      path, an empty passphrase, default bit size for the key type, and an
      empty comment. The following example creates a complete new
      set of host keys by first deleting the existing keys, then creating a
      new set:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">rm /etc/ssh/ssh_host*</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ssh-keygen -A</code></pre></div><p>
      You can replace selected key pairs by first deleting only the
      keys you want to replace, because <code class="command">ssh-keygen -A</code>
      does not replace existing keys.
    </p><div id="id-1.7.6.4.6.10.7" data-id-title="Do not use DSA keys" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Do not use DSA keys</div><p>
        <code class="command">ssh-keygen -A</code> creates DSA keys, even though
        they have been deprecated as unsafe for several years. In OpenSSH
        7.0 they are still created, but disabled by not being listed in
        <code class="filename">sshd_config</code>. You may safely delete DSA keys.
      </p></div><p>
     When you want to rotate host keys
     (see <a class="xref" href="#sec-ssh-sshdserver-rotation" title="22.5. Rotating host keys">Section 22.5, “Rotating host keys”</a>), you must create
     the new keys individually, because they must exist at the same time as
     your old host keys. Your users will authenticate with the old keys,
     and then receive the list of new keys. They need unique names,
     to not conflict with the old keys. The following example creates new
     RSA and Ed25519 host keys, labeled with the year and month they were
     created. Remember, the new host keys must not have passphrases:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">cd /etc/ssh</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ssh-keygen -b 4096 -f "<em class="replaceable">SSH_HOST_RSA_2022_02</em>"</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ssh-keygen -t ed25519 -f "<em class="replaceable">SSH_HOST_ED25519_2022_02</em>"</code></pre></div><p>
      You may name your new keys whatever you want.
    </p></section></section><section class="sect1" id="sec-ssh-sshdserver-rotation" data-id-title="Rotating host keys"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.5 </span><span class="title-name">Rotating host keys</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-sshdserver-rotation">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As of version 6.8, OpenSSH includes a protocol extension that
    supports host key rotation. SSH server admins must periodically
    retire old host keys and create new keys, for example if a key has been
    compromised, or it is time to upgrade to stronger keys. Before OpenSSH
    6.8, if <code class="literal">StrictHostKeyChecking</code>
    was set to <code class="literal">yes</code> in <code class="filename">ssh_config</code>
    on user machines, users would see a warning that the host key had
    changed, and were not allowed to connect. Then the users would have to
    manually delete the server's public key from their
    <code class="filename">known_hosts</code> file, reconnect, and manually accept the
    new key. Any automated SSH connections, such as scheduled backups, would
    fail.
   </p><p>
     The new host key rotation scheme provides a method to distribute new
     keys without service interruptions. When clients connect, the server
     sends them a list of new keys. Then the next time they log in they are
     asked if they wish to accept the changes. Give users a few days to
     connect and receive the new keys, and then you can remove the old keys.
     The users' <code class="filename">known_hosts</code> files are automatically
     updated, with new keys added and the old keys removed.
   </p><p>
      Setting up host key rotations requires creating new keys on the server,
      some changes to <code class="filename">/etc/ssh/sshd_config</code> on the
      server, and to <code class="filename">/etc/ssh/ssh_config</code> on the clients.
   </p><p>
     First, create your new key or keys. The following example creates a new
     RSA key and a new Ed25519 key, with unique names and comments. A useful
     convention is to name them with the creation date. Remember, a host key
     must not have a passphrase:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">ssh-keygen -t rsa -f ssh_host_rsa_2022-01 -C "main server"</code>
Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in ssh_host_rsa_2022-01
Your public key has been saved in ssh_host_rsa_2022-01.pub
The key fingerprint is:
SHA256:F1FIF2aqOz7D3mGdsjzHpH/kjUWZehBN3uG7FM4taAQ main server
The key's randomart image is:
+---[RSA 3072]----+
|         .Eo*.oo |
|          .B .o.o|
|          o . .++|
|         . o ooo=|
|        S . o +*.|
|         o o.oooo|
|       .o ++oo.= |
|       .+=o+o + .|
|       .oo++..   |
+----[SHA256]-----+

<code class="prompt root"># </code><code class="command">ssh-keygen -t ed25519 -f ssh_host_ed25519_2022-01 -C "main server"</code>
Generating public/private ed25519 key pair.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in ssh_host_ed25519_2022-01
Your public key has been saved in ssh_host_ed25519_2022-01.pub
The key fingerprint is:
SHA256:2p9K0giXv7WsRnLjwjs4hJ8EFcoX1FWR4nQz6fxnjxg main server
The key's randomart image is:
+--[ED25519 256]--+
|   .+o ...o+     |
| . .... o *      |
|  o..  o = o     |
|  ..   .. o      |
|   o. o S  .     |
|  . oo.*+   E o  |
|   + ++==..  = o |
|    = +oo= o. . .|
|     ..=+o=      |
+----[SHA256]-----+</pre></div><p>
     Record the fingerprints, for users to verify the new keys.
   </p><p>
     Add the new key names to <code class="filename">/etc/ssh/sshd_config</code>, and
     uncomment any existing keys that are in use:
   </p><div class="verbatim-wrap"><pre class="screen">## Old keys
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ed25519_key
HostKey /etc/ssh/ssh_host_ecdsa_key

## New replacement keys
HostKey /etc/ssh/ssh_host_rsa_2022-01
HostKey /etc/ssh/ssh_host_ed25519_2022-01</pre></div><p>
      Save your changes, then restart <code class="systemitem">sshd</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">systemctl restart sshd.service</code></pre></div><p>
      The <code class="filename">/etc/ssh/ssh_config</code> file on user machines must
      include the following settings:
    </p><div class="verbatim-wrap"><pre class="screen">UpdateHostKeys ask
StrictHostKeyChecking yes</pre></div><p>
      Test connecting from a client by opening an SSH session to the server
      to receive the new keys list. Log out, then log back in. When you log
      back in you should see something like the following message:
    </p><div class="verbatim-wrap"><pre class="screen">The server has updated its host keys.
These changes were verified by the server's existing trusted key.
Deprecating obsolete hostkey: ED25519
SHA256:V28d3VpHgjsCoV04RBCZpLo5c0kEslCZDVdIUnCvqPI
Deprecating obsolete hostkey:
RSA SHA256:+NR4DVdbsUNsqJPIhISzx+eqD4x/awCCwijZ4a9eP8I
Accept updated hostkeys? (yes/no):yes</pre></div><p>
      You may set <code class="literal">UpdateHostKeys ask</code> to
      <code class="literal">UpdateHostKeys yes</code> to apply the changes
      automatically, and avoid asking users to approve the changes.
    </p><p>
      For more information:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        <a class="xref" href="#sec-ssh-authentic-gen-key" title="22.4. Managing user and host encryption keys">Section 22.4, “Managing user and host encryption keys”</a>
      </p></li><li class="listitem"><p>
      <a class="link" href="http://blog.djm.net.au/2015/02/key-rotation-in-openssh-68.html" target="_blank">http://blog.djm.net.au/2015/02/key-rotation-in-openssh-68.html</a>
     </p></li><li class="listitem"><p>
       man 5 ssh_config, man 5 sshd_config
     </p></li></ul></div></section><section class="sect1" id="sec-ssh-public-key-auth" data-id-title="Public key authentication"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.6 </span><span class="title-name">Public key authentication</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-public-key-auth">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Public key authentication uses your own personal identity key to
   authenticate, rather than a user account password.
  </p><p>
   The following example shows how to create a new personal
   RSA key pair with a comment, so you know what it is for. First change to
   your <code class="filename">~/.ssh</code> directory (or create it if it does not
   exist), then create the new key pair. Give it a strong passphrase, and
   write the passphrase in a safe place:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">cd ~/.ssh</code>
<code class="prompt user">&gt; </code><code class="command">ssh-keygen -C <em class="replaceable">"web server1"</em> -f <em class="replaceable">id-web1</em> -t rsa -b <em class="replaceable">4096</em></code></pre></div><p>
   Next, copy your new public key to the machine you want access to. You
   must already have a user account on this machine, and SSH access to
   copy it over the network:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-copy-id -i <em class="replaceable">id-web1 user@web1</em></code></pre></div><p>
   Then try logging in with your new key:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh -i <em class="replaceable">id-web1 user@web1</em></code>
Enter passphrase for key 'id-web1':
Last login: Sat Jul 11 11:09:53 2022 from 192.168.10.122
Have a lot of fun...</pre></div><p>
   You should be asked for your private key passphrase, and not the
   password for your user account.
  </p><p>
   To be effective, public key authentication should be enforced on
   the remote machine, and password authentication not allowed (see
   <a class="xref" href="#ex-sshd-conf" title="Example sshd_config">Example 22.1, “Example sshd_config”</a>). If you do not have public key
   authentication access on the remote machine already, you cannot copy your
   new public key with <code class="command">ssh-copy-id</code>, and must use other
   means, such as manually copying it from a USB stick to the
   <code class="filename">~/.ssh/authorized_keys</code> file of the remote
   user account.
  </p></section><section class="sect1" id="sec-ssh-passphrase-less-auth" data-id-title="Passphrase-less public key authentication"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.7 </span><span class="title-name">Passphrase-less public key authentication</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-passphrase-less-auth">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This is public key authentication without a passphrase. Create
    your new private identity keys without a passphrase, and then use them
    the same way as passphrase-protected keys. This is useful for automated
    services, such as scripts and cron jobs. However, anyone who succeeds in
    stealing the private key can easily masquerade as you, so you need to be
    very protective of a passphrase-less private key.
  </p><p>
   An alternative to using keys without passphrases is
   <code class="literal">gnome-keyring</code>, which
   remembers and applies your private keys and passphrases for you.
   <code class="literal">gnome-keyring</code> is for GNOME desktop sessions
   (<a class="xref" href="#sec-ssh-gnome-keyring" title="22.9. Automated public key logins with gnome-keyring">Section 22.9, “Automated public key logins with gnome-keyring”</a>).
  </p><p>
   For console sessions, use <code class="literal">ssh-agent</code>
   (<a class="xref" href="#sec-ssh-authentic-agent" title="22.10.1. Using ssh-agent in an X session">Section 22.10.1, “Using <code class="command">ssh-agent</code> in an X session”</a>).
  </p></section><section class="sect1" id="sec-ssh-certificate-auth" data-id-title="OpenSSH certificate authentication"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.8 </span><span class="title-name">OpenSSH certificate authentication</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-certificate-auth">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   OpenSSH introduced certificate authentication in OpenSSH 5.4.
   Certificate authentication is similar to public key authentication,
   except hosts and users authenticate to each other with digitally-signed
   encryption certificates instead of encryption keys. Certificate
   authentication provides central management for server and user
   certificates, eliminating the need to manually copy user public keys to
   multiple hosts. It increases security by giving more control to
   administrators, and less to users.
  </p><p>
   Certificates consist of a public encryption key, a user-defined identity
   string, zero or more user names or host names, and other options.
   User and host public keys are signed by a Certificate Authority (CA)
   private signing key to create an encryption certificate. Users and hosts
   trust the public CA key, rather than trusting individual user and host
   public encryption keys.
  </p><p>
   Traditional OpenSSH public key authentication requires copying user
   public keys to every SSH server they need access to (to the appropriate
   <code class="filename">~/.ssh/authorized_keys</code> files), and relying on
   users to verify new SSH server host keys before accepting them (stored
   in <code class="filename">~/.ssh/known_hosts</code>). This is
   error-prone and complicated to manage. Another disadvantage is OpenSSH
   keys never expire. When you need to revoke a particular public key, you
   have to find and remove all of its copies on your network.
  </p><p>
   Automating the whole process (for example, with Ansible) is virtually a
   necessity. Large organizations, such as Meta
   (see <a class="link" href="https://engineering.fb.com/2016/09/12/security/scalable-and-secure-access-with-ssh/" target="_blank">https://engineering.fb.com/2016/09/12/security/scalable-and-secure-access-with-ssh/</a>),
   automate the process completely, so they can revoke and replace
   certificates, and even certificate authorities, as often as they want
   without disrupting operations.
  </p><p>
   A prerequisite is the ability to open SSH sessions to all hosts on your
   network, and perform tasks like editing configuration files and restarting <code class="systemitem">sshd</code>.
  </p><p>
   Setting up an OpenSSH certificate authority involves the following steps:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
   Set up a secure trusted server to host your certificate authority,
   for signing host and user keys. Create a new key pair for signing
   keys. The private key signs user and host keys, and the public key is
   copied to all users who are allowed access to the server.
  </p></li><li class="listitem"><p>
   Receive and sign host public keys, then distribute the new host
   certificates to their respective hosts. Host certificates go in
   <code class="filename">/etc/ssh</code>, just like host keys.
  </p></li><li class="listitem"><p>
   Receive and sign user public keys, then distribute the new user
   certificates to their owners. User certificates go in
   <code class="filename">~/.ssh</code>, just like user keys.
  </p></li><li class="listitem"><p>
     Edit configuration files on servers and users' machines, and stop and
     start <code class="systemitem">sshd</code> on hosts as
     necessary.
   </p></li><li class="listitem"><p>
   Revoke certificates as needed, for example when you suspect a certificate
   has been compromised, a user has left your organization, or a server has
   been retired. Revoking a certificate is considerably simpler than finding
   and removing all relevant public key copies.
  </p></li></ul></div><p>
    Users and server admins create and protect their own OpenSSH keys. It is
    safe to freely share public keys. It is safe to transfer the new
    certificates by insecure methods, such as email, because they require
    their private keys to validate.
   </p><p>
   Note that SSH certificates follow the OpenPGP standard, rather than
   SSL/TLS, and that the certificate format is OpenPGP, not X.509.
  </p><section class="sect2" id="sec-ssh-certificate-create-signing-keys" data-id-title="Setting up a new certificate authority"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.8.1 </span><span class="title-name">Setting up a new certificate authority</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-certificate-create-signing-keys">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes how to set up a new certificate
   authority (CA). Give careful consideration to organizing
   your CA, to keep it manageable and efficient.
  </p><div id="id-1.7.6.4.10.11.3" data-id-title="Protect your certificate authority" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Protect your certificate authority</div><p>
    It is extremely important to protect the machine that hosts
    your certificate authority. Your CA is literally the key to
    your entire network. Anyone who gains access to your CA can
    create their own certificates and freely access your network
    resources, or even compromise your servers and the CA itself.
    A common practice is to use a dedicated machine that is started only
    when you need to sign keys.
   </p></div><p>
    It is a best practice to create one signing key for servers,
    and another signing key for clients. If you have a large number of
    certificates to manage, it can be helpful to create your
    CAs for hosts and clients on separate machines. If you prefer
    using a single machine, give each CA its own directory.
    The examples in this section use <code class="filename">/ca-ssh-hosts</code>
    and <code class="filename">/ca-ssh-users</code>. The example machine is
    <em class="replaceable">ca.example.com</em>.
   </p><p>
    If your security policy requires
    keeping copies of users' and host's public keys, store them in their own
    subdirectories, for easier tracking and avoiding key name collisions.
   </p><div id="id-1.7.6.4.10.11.6" data-id-title="RSA signing keys deprecated" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: RSA signing keys deprecated</div><p>
     OpenSSH 8.2, released February 2020, deprecates RSA signing keys.
     Use Ed25519 or ECDSA.
    </p></div><p>
    The following examples create two signing keys, one for signing
    host keys, and one for user keys. Give them strong passphrases:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ssh-keygen -t ed25519 -f <em class="replaceable">/ca-ssh-hosts/ca-host-sign-key -C "signing key for host certificates"</em></code>
Generating public/private ed25519 key pair.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in ca-host-sign-key
Your public key has been saved in ca-host-sign-key.pub
The key fingerprint is:
SHA256:STuQ7HgDrPcEa7ybNIW0n6kPbj28X5HN8GgwllBbAt0
 signing key for host certificates
The key's randomart image is:
+--[ED25519 256]--+
|      o+o..      |
|   . . o.=E      |
|    = + B .      |
|   + O + = B     |
|  . O * S = +    |
|   o B + o .     |
|    =o=   .      |
|   o.*+  .       |
|   .=.o+.        |
+----[SHA256]-----+</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ssh-keygen -t ed25519 -f <em class="replaceable">/ca-ssh-users/ca-user-sign-key -C "signing key for user certificates"</em></code>
Generating public/private ed25519 key pair.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in ca-user-sign-key
Your public key has been saved in ca-user-sign-key.pub
The key fingerprint is:
SHA256:taYj8tTnjkzgfHRvQ6HTj8a37PY6rwv96V1x+GHRjIk signing key for user certificates
The key's randomart image is:
+--[ED25519 256]--+
|                 |
|             . +.|
|          . E o.o|
|         . + . ..|
|      . S * o .+.|
|     o + + = +..+|
|    . = * . O + o|
|     + = = o =oo+|
|      . o.o  oOX=|
+----[SHA256]-----+</pre></div><p>
  Copy your public user signing key (be sure you are copying the PUBLIC
  key) to <code class="filename">/etc/ssh</code> on all hosts running SSH servers.
  Then enter the full path of the public user signing key to
  <code class="filename">/etc/ssh/sshd_config</code> on the hosts:
 </p><div class="verbatim-wrap"><pre class="screen">TrustedUserCAKeys <em class="replaceable">/etc/ssh/ca-user-sign-key.pub</em></pre></div><p>
  Then restart <code class="systemitem">sshd</code>.
 </p></section><section class="sect2" id="sec-ssh-certificate-create-host-certs" data-id-title="Creating host certificates"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.8.2 </span><span class="title-name">Creating host certificates</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-certificate-create-host-certs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following example signs a host public key to create a host
   certificate for a database server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ssh-keygen -s <em class="replaceable">/ca-ssh-hosts/ca-host-sign-key</em></code> \
   <code class="command">-n <em class="replaceable">venus,venus.example.com</em> -I <em class="replaceable">"db-server host cert"</em></code> \
   <code class="command">-h -V +4w <em class="replaceable">/etc/ssh/ssh_host_ed25519_key.pub</em></code>
Enter passphrase:
Signed host key /etc/ssh/ssh_host_ed25519_key-cert.pub: id
"db-server host cert" serial 0 for venus,venus.example.com
valid from 2022-08-08T14:20:00 to 2022-09-05T15:21:19</pre></div><p>
       If there is more than one host key on a server, sign all of them.
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <code class="option">-s</code> is your private signing key.
      </p></li><li class="listitem"><p>
       <code class="option">-n</code> is your list of principals. For host
       certificates, the principals are the machine's host name
       and fully-qualified domain name.
      </p></li><li class="listitem"><p>
       <code class="option">-I</code> is the identity string. This is any
       comment or description you want. The string is logged, to help you
       quickly find relevant log entries.
      </p></li><li class="listitem"><p>
       <code class="option">-h</code> creates a host certificate.
     </p></li><li class="listitem"><p>
      <code class="option">-V</code> sets the expiration date for the certificate. In
      the example, the certificate expires in four weeks. (See
      the "-V validity_interval" section of
      <code class="command">man 1 ssh-keygen</code> for allowed time formats.)
     </p></li></ul></div><p>
    Verify that your new certificate is built the way you want:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-keygen -Lf /etc/ssh/ssh_host_ed25519_key-cert.pub</code>
 /etc/ssh/ssh_host_ed25519_key-cert.pub:
        Type: ssh-ed25519-cert-v01@openssh.com host certificate
        Public key: ED25519-CERT SHA256:/
         U7C+qABXYyuvueUuhFKzzVINq3d7IULRLwBstvVC+Q
        Signing CA: ED25519 SHA256:
         STuQ7HgDrPcEa7ybNIW0n6kPbj28X5HN8GgwllBbAt0 (using ssh-ed25519)
        Key ID: "db-server host cert"
        Serial: 0
        Valid: from 2022-08-08T14:20:00 to 2022-09-05T15:21:19
        Principals:
                venus
                venus.example.com
        Critical Options: (none)
        Extensions: (none)</pre></div><p>
    Add the full path of the new host certificate to
    <code class="filename">/etc/ssh/sshd_config</code>, to make it
    available to clients:
   </p><div class="verbatim-wrap"><pre class="screen">HostCertificate <em class="replaceable">/etc/ssh/ssh_host_ed25519_key-cert.pub</em></pre></div><p>
    Restart <code class="systemitem">sshd</code> to load your
    changes:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl restart sshd.service</code></pre></div><p>
    See
    <a class="xref" href="#sec-ssh-certificate-user-config" title="22.8.3. CA configuration for users">Section 22.8.3, “CA configuration for users”</a> to learn how to
    configure clients to accept host certificates.
   </p></section><section class="sect2" id="sec-ssh-certificate-user-config" data-id-title="CA configuration for users"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.8.3 </span><span class="title-name">CA configuration for users</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-certificate-user-config">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following example shows how to configure clients to trust your CA
    rather than individual keys. The example grants access to a single
    server. This entry must be on a single unbroken  line in your users'
    <code class="filename">~/.ssh/known_hosts</code> files. Move the original
    <code class="filename">~/.ssh/known_hosts</code> file, and create a new
    file that contains only the CA configuration. Or, create a global
    configuration in <code class="filename">/etc/ssh/ssh_known_hosts</code>, which
    has the advantage of being un-editable by unprivileged users:
   </p><div class="verbatim-wrap"><pre class="screen">@cert-authority db,db.example.com ssh-ed25519
 AAAAC3NzaC1lZDI1NTE5AAAAIH1pF6DN4BdsfUKWuyiGt/leCvuZ/fPu
 YxY7+4V68Fz0 signing key for user certificates</pre></div><p>
     List each server the user is allowed to access in a comma-delimited
     list, for example
     <code class="literal"><em class="replaceable">venus,venus.example.com,saturn,saturn.example.com</em></code>. You may also
     grant access to all servers in domains with wildcards, for example
     <code class="literal">*.example.com,*.example2.com</code>.
    </p><p>
     Try connecting to the server. You should be prompted for the password
     of the remote account, without being prompted to verify the host
     certificate.
    </p></section><section class="sect2" id="sec-ssh-certificate-user-certs" data-id-title="Creating user certificates"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.8.4 </span><span class="title-name">Creating user certificates</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-certificate-user-certs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Sign the user's public key:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ssh-keygen <em class="replaceable">/ca-ssh-hosts/ca-user-sign-key -I "suzanne's cert" -n suzanne -V +52w user-key.pub</em></code>
 Signed user key .ssh/ed25519key-cert.pub: id "suzanne's cert" serial 0
 for suzanne valid from 2022-09-14T12:57:00 to 2023-09-13T12:58:21</pre></div><p>
    The principal on user certificates is always the username. Store the
    user's certificate in <code class="filename">~/.ssh</code> on the user's machine.
   </p><p>
    User certificates replace the <code class="filename">~/.ssh/authorized_keys</code> files. Remove this file from a user account on the remote
    machine, then try opening an SSH session to that account. You should be
    able to log  in without being prompted for a password. (Remember, the
    server should have a
    <code class="literal">TrustedUserCAKeys /etc/ssh/<em class="replaceable">ca-user-sign-key.pub</em></code>
    line in its
    <code class="filename">/etc/ssh/sshd_config</code> file, so that the server
    knows to trust your certificate authority.)
   </p><p>
    Additionally, look for <code class="literal">Accepted publickey for
     <em class="replaceable">suzanne</em></code> messages in
    your log files.
    </p></section><section class="sect2" id="sec-ssh-certificate-revoke-host-keys" data-id-title="Revoking host keys"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.8.5 </span><span class="title-name">Revoking host keys</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-certificate-revoke-host-keys">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When you need to revoke a certificate because a server has been
    compromised or retired, add the certificate's corresponding
    public key to a file on every client, for example
    <code class="filename">/etc/ssh/revoked_keys</code>:
   </p><div class="verbatim-wrap"><pre class="screen">ssh-ed25519-cert-v01@openssh.com
    AAAAIHNzaC1lZDI1NTE5LWNlcnQtdjAxQG9wZW5zc2guY29tAAAAIK6hyvFAhFI+0hkKehF/
    506fD1VdcW29ykfFJn1CPK9lAAAAIAawaXbbEFiQOAe5LGclrCHSLWbEeUauK5+CAuhTJyz0
    AAAAAAAAAAAAAAACAAAAE2RiLXNlcnZlciBob3N0IGNlcnQAAAAeAAAABXZlbnVzAAAAEXZl
    bnVzLmV4YW1wbGUuY29tAAAAAGMabhQAAAAAYz9YgQAAAAAAAAAAAAAAAAAAADMAAAALc3No
    LWVkMjU1MTkAAAAgfWkXoM3gF2x9Qpa7KIa3+V4K+5n98+5jFjv7hXrwXPQAAABTAAAAC3Nz
    aC1lZDI1NTE5AAAAQI+mbJsQjt/9bLiURse8DF3yTa6Yk3HpoE2uf9FW/
    KeLsw2wPeDv0d6jv49Wgr5T3xHYPf+VPJQW35ntFiHTlQg= root@db</pre></div><p>
    This file must be named in <code class="filename">/etc/ssh/sshd_config</code>:
   </p><div class="verbatim-wrap"><pre class="screen">RevokedKeys /etc/ssh/revoked_keys</pre></div></section></section><section class="sect1" id="sec-ssh-gnome-keyring" data-id-title="Automated public key logins with gnome-keyring"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.9 </span><span class="title-name">Automated public key logins with gnome-keyring</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-gnome-keyring">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <span class="package">gnome-keyring</span> package is installed and enabled
   by default when the GNOME desktop environment is installed.
   <code class="literal">gnome-keyring</code> is integrated with your
   system login, automatically unlocking your secrets storage at login.
   When you change your login password, <code class="literal">gnome-keyring</code>
   automatically updates itself with your new password.
  </p><p>
   <code class="literal">gnome-keyring</code> automatically loads all key pairs in
   <code class="filename">~/.ssh</code>, for each pair that has a
   <code class="filename">*.pub</code> file. You may manually load other keys with
   the <code class="command">ssh-add</code> command, for example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-add <em class="replaceable">~/.otherkeys/my_key</em></code></pre></div><p>
   List all loaded keys:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-add -L</code></pre></div><p>
   When you start up your system and then open an SSH session, you will be
   prompted for your private key passphrase.
  </p><p>
    <code class="literal">gnome-keyring</code> will remember the passphrase for the rest of your
    session. You will not have to re-enter the passphrase until after a system
    restart.
   </p></section><section class="sect1" id="sec-ssh-ssh-agent" data-id-title="Automated public key logins in the console with ssh-agent"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.10 </span><span class="title-name">Automated public key logins in the console with ssh-agent</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-ssh-agent">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <span class="package">openssh</span> package
    provides the <code class="command">ssh-agent</code> utility, which retains your
    private keys and passphrases, and automatically applies your passphrases
    for you during the current session.
   </p><p>
    Configure <code class="command">ssh-agent</code> to start automatically and load
    your keys by entering the following lines in your
    <code class="filename">~/.profile</code> file:
   </p><div class="verbatim-wrap"><pre class="screen">eval "$(ssh-agent)"
ssh-add</pre></div><p>
    The first line starts <code class="command">ssh-agent</code>, and the second line
    loads all the keys in your <code class="filename">~/.ssh</code> folder.
    When you open an SSH session that requires public key authentication,
    you will be prompted for the passphrase. After the passphrase has been
    provided once, you will not have to enter it again, until after you
    restart your system.
   </p><p>
    You may configure <code class="filename">~/.profile</code> to load only
    specific keys, like the following example that loads
    <code class="filename">id_rsa</code> and <code class="filename">id_ed25519</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ssh-add <em class="replaceable">id_rsa id_ed25519</em></pre></div><section class="sect2" id="sec-ssh-authentic-agent" data-id-title="Using ssh-agent in an X session"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.10.1 </span><span class="title-name">Using <code class="command">ssh-agent</code> in an X session</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-authentic-agent">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     On <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, <code class="command">ssh-agent</code> is automatically
     started by the GNOME display manager. To also invoke
     <code class="command">ssh-add</code> to add your keys to the agent at the
     beginning of an X session, do the following:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Log in as the desired user and check whether the file
       <code class="filename">~/.xinitrc</code> exists.
      </p></li><li class="step"><p>
       If it does not exist, use an existing template or copy it from
       <code class="filename">/etc/skel</code>:
      </p><div class="verbatim-wrap"><pre class="screen">if [ -f ~/.xinitrc.template ]; then mv ~/.xinitrc.template ~/.xinitrc; \
else cp /etc/skel/.xinitrc.template ~/.xinitrc; fi</pre></div></li><li class="step"><p>
       If you have copied the template, search for the following lines and
       uncomment them. If <code class="filename">~/.xinitrc</code> already existed,
       add the following lines (without comment signs).
      </p><div class="verbatim-wrap"><pre class="screen"># if test -S "$SSH_AUTH_SOCK" -a -x "$SSH_ASKPASS"; then
#       ssh-add &lt; /dev/null
# fi</pre></div></li><li class="step"><p>
       When starting a new X session, you will be prompted for your SSH
       passphrase.
      </p></li></ol></div></div></section></section><section class="sect1" id="sec-ssh-change-passphrase" data-id-title="Changing an SSH private key passphrase"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.11 </span><span class="title-name">Changing an SSH private key passphrase</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-change-passphrase">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You may change or remove the passphrase from a private key with
   <code class="command">ssh-keygen</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-keygen -pf ~/.ssh/<em class="replaceable">server1</em></code>
Enter old passphrase:
Key has comment 'shared videos server1'
Enter new passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved with the new passphrase.</pre></div></section><section class="sect1" id="sec-ssh-get-key-fingerprint" data-id-title="Retrieving a key fingerprint"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.12 </span><span class="title-name">Retrieving a key fingerprint</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-get-key-fingerprint">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use the <code class="command">ssh-keygen</code> to display the public key
   fingerprint. The following example prints the SHA256 hash for a
   ED25519 key:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-keygen -lf <em class="replaceable">ldap-server</em></code>
256 SHA256:W45lbmj24ZoASbrqW0q9+NhF04muvfKZ+FkRa2cCiqo comment (ED25519)</pre></div><p>
   Add the <code class="command">-v</code> flag to display the ASCII art
   representation of the key:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh-keygen -lvf <em class="replaceable">ldap-server</em></code>
256 SHA256:W45lbmj24ZoASbrqW0q9+NhF04muvfKZ+FkRa2cCiqo comment (ED25519)
+--[ED25519 256]--+
|                 |
|                 |
|    .. .         |
|  .o..+ +        |
| ...o+ BSo+      |
|. ..o.o =X       |
|...o o..* =      |
|o.*.* =+ = .     |
|E*o*+O. o.o      |
+----[SHA256]-----+</pre></div></section><section class="sect1" id="sec-ssh-programm-x" data-id-title="Starting X11 applications on a remote host"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.13 </span><span class="title-name">Starting X11 applications on a remote host</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-programm-x">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can run graphical applications that are installed on a
    remote machine on your local computer.
    <code class="literal">X11Forwarding Yes</code> must be set in the
    <code class="filename">/etc/ssh/sshd_config</code> file on the remote machine.
    Then, when you run <code class="command">ssh</code> with the <code class="option">-X</code>
    option, the <code class="envar">DISPLAY</code> variable is automatically set on the
    remote machine, and all X output is exported to the local machine over
    the SSH connection. At the same time, X applications started remotely
    cannot be intercepted by unauthorized users.
   </p><p>
    A quick test is to run a simple game from the remote machine, such as
    GNOME Mines:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ssh wilber@sun</code>
Password:
Last login: Tue May 10 11:29:06 2022 from 192.168.163.13
Have a lot of fun...

wilber@sun<code class="prompt user">&gt; </code> <code class="command">gnome-mines</code></pre></div><p>
     The remote application should appear on your local machine just as
     though it were installed locally. (Note that network lag will affect
     performance.) Close the remote application in the usual way, such as
     clicking the close button. This closes only the application, and your
     SSH session remains open.
   </p><div id="id-1.7.6.4.15.6" data-id-title="X11 forwarding does not work on Wayland" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: X11 forwarding does not work on Wayland</div><p>
     X11 forwarding requires the X Windows System, which is the default on
     SLE, and not the Wayland display server protocol. The X Windows
     System has built-in networking, while Wayland does not. Wayland is not
     supported on SLE.
    </p><p>
     Use the following command to learn if your system runs X or Wayland:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">echo $XDG_SESSION_TYPE</code>
x11</pre></div><p>
     If Wayland is in use, it looks like the following example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">echo $XDG_SESSION_TYPE</code>
wayland</pre></div><p>
     The systemd way is to query with <code class="command">loginctl</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">loginctl show-session "$XDG_SESSION_ID" -p Type</code>
Type=x11

<code class="prompt user">&gt; </code><code class="command">loginctl show-session "$XDG_SESSION_ID" -p Type</code>
Type=wayland</pre></div></div></section><section class="sect1" id="sec-ssh-programm-forwarding" data-id-title="Agent forwarding"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.14 </span><span class="title-name">Agent forwarding</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-programm-forwarding">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    By adding the <code class="option">-A</code> option, the ssh-agent authentication
    mechanism is carried over to the next machine. This way, you can work
    from different machines without having to enter a password, but only if
    you have distributed your public key to the destination hosts and
    properly saved it there. (Refer to
    <a class="xref" href="#sec-ssh-public-key-auth" title="22.6. Public key authentication">Section 22.6, “Public key authentication”</a> to learn how
    to copy your public keys to other hosts.)
   </p><p>
    <code class="literal">AllowAgentForwarding yes</code> is the default in
    <code class="filename">/etc/ssh/sshd_config</code>. Change it to
    <code class="literal">No</code> to disable it.
   </p></section><section class="sect1" id="sec-ssh-copy" data-id-title="scp—secure copy"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.15 </span><span class="title-name"><code class="command">scp</code>—secure copy</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-copy">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">scp</code> copies files to or from a remote machine.  If
   the user name on jupiter is different than the user name on
   sun, specify the latter using the
   <code class="option"><em class="replaceable">USER_NAME</em>&amp;host</code> format. If
   the file should be copied into a directory other than the remote
   user's home directory, specify it as
   sun:<em class="replaceable">DIRECTORY</em>. The following
   examples show how to copy a file from a local to a remote machine and
   vice versa.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>scp ~/MyLetter.tex tux@sun:/tmp <span class="callout" id="co-scp-local-remote">1</span>
<code class="prompt user">&gt; </code>scp tux@sun:/tmp/MyLetter.tex ~ <span class="callout" id="co-scp-remote-local">2</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-scp-local-remote"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>local to remote</p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-scp-remote-local"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>remote to local</p></td></tr></table></div><div id="id-1.7.6.4.17.5" data-id-title="The -l option" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: The <code class="option">-l</code> option</div><p>
    With the <code class="command">ssh</code> command, the option
    <code class="option">-l</code> can be used to specify a remote user (as an
    alternative to the
    <code class="option"><em class="replaceable">USER_NAME</em>&amp;host</code>
    format). With <code class="command">scp</code> the option <code class="option">-l</code>
    is used to limit the bandwidth consumed by <code class="command">scp</code>.
   </p></div><p>
   After the correct password is entered, <code class="command">scp</code> starts the
   data transfer. It displays a progress bar and the time remaining for each
   file that is copied. Suppress all output with the <code class="option">-q</code>
   option.
  </p><p>
   <code class="command">scp</code> also provides a recursive copying feature for
   entire directories. The command
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>scp -r src/ sun:backup/</pre></div><p>
   copies the entire contents of the directory <code class="filename">src</code>
   including all subdirectories to the <code class="filename">~/backup</code>
   directory on the host sun. If this subdirectory does not
   exist, it is created automatically.
  </p><p>
   The <code class="option">-p</code> option tells <code class="command">scp</code> to leave the
   time stamp of files unchanged. <code class="option">-C</code> compresses the data
   transfer. This minimizes the data volume to transfer, but creates a
   heavier burden on the processors of both machines.
  </p></section><section class="sect1" id="sec-ssh-sftp" data-id-title="sftp—secure file transfer"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.16 </span><span class="title-name"><code class="command">sftp</code>—secure file transfer</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-sftp">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-ssh-sftp-using" data-id-title="Using sftp"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.16.1 </span><span class="title-name">Using <code class="command">sftp</code></span></span> <a title="Permalink" class="permalink" href="#sec-ssh-sftp-using">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If you want to copy several files from or to different locations,
   <code class="command">sftp</code> is a convenient alternative to
   <code class="command">scp</code>. It opens a shell with a set of commands similar
   to a regular FTP shell. Type <code class="command">help</code> at the sftp-prompt
   to get a list of available commands. More details are available from the
   <code class="command">sftp</code> man page.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>sftp sun
Enter passphrase for key '/home/tux/.ssh/id_rsa':
Connected to sun.
sftp&gt; help
Available commands:
bye                                Quit sftp
cd path                            Change remote directory to 'path'
[...]</pre></div></section><section class="sect2" id="sec-ssh-sftp-perms" data-id-title="Setting permissions for file uploads"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.16.2 </span><span class="title-name">Setting permissions for file uploads</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-sftp-perms">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As with a regular FTP server, a user can download and upload files to a
    remote machine running an SFTP server
    by using the <code class="command">put</code> command. By default the
    files will be uploaded to the remote host with the same
    permissions as on the local host. There are two options to
    automatically alter these permissions:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.4.18.3.3.1"><span class="term">Setting a umask</span></dt><dd><p>
       A umask works as a filter against the permissions of the original
       file on the local host. It can only withdraw permissions:
      </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/><col class="3"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
           <p>
            permissions original
           </p>
          </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
           <p>
            umask
           </p>
          </th><th style="border-bottom: 1px solid ; ">
           <p>
            permissions uploaded
           </p>
          </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
           <p>
            0666
           </p>
          </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
           <p>
            0002
           </p>
          </td><td style="border-bottom: 1px solid ; ">
           <p>
            0664
           </p>
          </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
           <p>
            0600
           </p>
          </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
           <p>
            0002
           </p>
          </td><td style="border-bottom: 1px solid ; ">
           <p>
            0600
           </p>
          </td></tr><tr><td style="border-right: 1px solid ; ">
           <p>
            0775
           </p>
          </td><td style="border-right: 1px solid ; ">
           <p>
            0025
           </p>
          </td><td>
           <p>
            0750
           </p>
          </td></tr></tbody></table></div><p>
       To apply a umask on an SFTP server, edit the file
       <code class="filename">/etc/ssh/sshd_configuration</code>. Search for the line
       beginning with <code class="literal">Subsystem sftp</code> and add the
       <code class="option">-u</code> parameter with the desired setting, for example:
      </p><div class="verbatim-wrap"><pre class="screen">Subsystem sftp /usr/lib/ssh/sftp-server -u 0002</pre></div></dd><dt id="id-1.7.6.4.18.3.3.2"><span class="term">Explicitly setting the permissions</span></dt><dd><p>
       Explicitly setting the permissions sets the same permissions for all
       files uploaded via SFTP. Specify a three-digit pattern such as
       <code class="literal">600</code>, <code class="literal">644</code>, or
       <code class="literal">755</code> with <code class="option">-u</code>. When both
       <code class="option">-m</code> and <code class="option">-u</code> are specified,
       <code class="literal">-u</code> is ignored.
      </p><p>
       To apply explicit permissions for uploaded files on an SFTP server,
       edit the file <code class="filename">/etc/ssh/sshd_config</code>.
       Search for the line beginning with <code class="literal">Subsystem sftp</code>
       and add the <code class="option">-m</code> parameter with the desired setting,
       for example:
      </p><div class="verbatim-wrap"><pre class="screen">Subsystem sftp /usr/lib/ssh/sftp-server -m 600</pre></div></dd></dl></div><div id="id-1.7.6.4.18.3.4" data-id-title="Viewing the SSH daemon log file" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Viewing the SSH daemon log file</div><p>
    To watch the log entries from the <code class="systemitem">sshd</code> use the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> journalctl -u sshd</pre></div></div></section></section><section class="sect1" id="sec-ssh-port-forwarding" data-id-title="Port forwarding (SSH tunneling)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.17 </span><span class="title-name">Port forwarding (SSH tunneling)</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-port-forwarding">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">ssh</code> can also be used to redirect TCP/IP connections.
   This feature, also called <code class="literal">SSH tunneling</code>, redirects TCP
   connections to a certain port to another machine via an encrypted
   channel.
  </p><p>
   With the following command, any connection directed to jupiter port 25
   (SMTP) is redirected to the SMTP port on sun. This is
   especially useful for those using SMTP servers without SMTP-AUTH or
   POP-before-SMTP features. From any arbitrary location connected to a
   network, e-mail can be transferred to the <span class="quote">“<span class="quote">home</span>”</span> mail server
   for delivery.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ssh -L 25:sun:25 jupiter</pre></div><p>
   Similarly, all POP3 requests (port 110) on jupiter can be
   forwarded to the POP3 port of sun with this command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>ssh -L 110:sun:110 jupiter</pre></div><p>
   Both commands must be executed as <code class="systemitem">root</code>, because the connection
   is made to privileged local ports. E-mail is sent and retrieved by
   normal users in an existing SSH connection. The SMTP and POP3 host
   must be set to <code class="literal">localhost</code> for this to
   work. Additional information can be found in the manual pages for
   each of the programs described above and in the OpenSSH package
   documentation under
   <code class="filename">/usr/share/doc/packages/openssh</code>.
  </p></section><section class="sect1" id="sec-security-ssh-moreinfo" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.18 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-security-ssh-moreinfo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.4.20.3.1"><span class="term"><a class="link" href="https://www.openssh.com" target="_blank">https://www.openssh.com</a>
    </span></dt><dd><p>
      The home page of OpenSSH
     </p></dd><dt id="id-1.7.6.4.20.3.2"><span class="term"><a class="link" href="https://en.wikibooks.org/wiki/OpenSSH" target="_blank">https://en.wikibooks.org/wiki/OpenSSH</a>
    </span></dt><dd><p>
      The OpenSSH Wikibook
     </p></dd><dt id="id-1.7.6.4.20.3.3"><span class="term"><code class="command">man sshd</code>
    </span></dt><dd><p>
      The man page of the OpenSSH daemon
     </p></dd><dt id="id-1.7.6.4.20.3.4"><span class="term"><code class="command">man ssh_config</code>
    </span></dt><dd><p>
      The man page of the OpenSSH SSH client configuration files
     </p></dd><dt id="id-1.7.6.4.20.3.5"><span class="term"><code class="command">man scp</code>
    , </span><span class="term"><code class="command">man sftp</code>
    , </span><span class="term"><code class="command">man ssh</code>
    , </span><span class="term"><code class="command">man ssh-add</code>
    , </span><span class="term"><code class="command">man ssh-copy-id</code>
    , </span><span class="term"><code class="command">man ssh-keygen</code>
    </span></dt><dd><p>
      Man pages of several binary files to securely copy files
      (<code class="command">scp</code>, <code class="command">sftp</code>), to log in
      (<code class="command">slogin</code>, <code class="command">ssh</code>), and to manage
      keys.
     </p></dd><dt id="id-1.7.6.4.20.3.6"><span class="term">
     <code class="filename">/usr/share/doc/packages/openssh-common/README.SUSE</code>
    , </span><span class="term">
     <code class="filename">/usr/share/doc/packages/openssh-common/README.FIPS</code>
    </span></dt><dd><p>
      SUSE package specific documentation; changes in defaults with
      respect to upstream, notes on FIPS mode etc.
     </p></dd></dl></div></section><section class="sect1" id="sec-security-ssh-fail2ban" data-id-title="Stopping SSH Brute Force Attacks with Fail2Ban"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">22.19 </span><span class="title-name">Stopping SSH Brute Force Attacks with Fail2Ban</span></span> <a title="Permalink" class="permalink" href="#sec-security-ssh-fail2ban">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p> An SSH brute force attack involves repeat trials of user name and
    password combinations until the attacker gains access to the remote server.
    The attacker uses automated tools that test various user name and password combinations
    to compromise a server.
 </p><p>You can use Fail2Ban software to limit intrusion attempts.
  Fail2Ban scans the system logs to detect attacks and trigger an action,
  such as blocking the IPs via the firewall. Fail2Ban is used only to protect
  services that require a user name and password authentication.</p><section class="sect2" id="sec-ssh-what-fail2ban" data-id-title="What is Fail2Ban?"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.19.1 </span><span class="title-name">What is Fail2Ban?</span></span> <a title="Permalink" class="permalink" href="#sec-ssh-what-fail2ban">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>Fail2Ban scans the log files in <code class="filename">/var/log/apache/error_log</code>
    and bans the IPs that indicate malicious signs, such as too many password attempts etc.
    You can then use Fail2Ban to update firewall rules to reject the IP addresses
    for a specified amount of time.</p><p>Fail2Ban comes with filters for various services, such as Apache,SSH,Courier etc.
    You can use Fail2Ban to minimize the rate of incorrect authentication attempts.</p></section><section class="sect2" id="sec-security-ssh-fail2ban-use" data-id-title="Using Fail2Ban to stop an SSH brute force attack"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">22.19.2 </span><span class="title-name">Using Fail2Ban to stop an SSH brute force attack</span></span> <a title="Permalink" class="permalink" href="#sec-security-ssh-fail2ban-use">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div></div></div><p>You can install and configure Fail2Ban to protect
      the server against SSH brute force attacks.
    </p><div class="procedure" id="id-1.7.6.4.21.5.3" data-id-title="Using Fail2Ban to stop an SSH brute force attack"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 22.2: </span><span class="title-name">Using Fail2Ban to stop an SSH brute force attack </span></span><a title="Permalink" class="permalink" href="#id-1.7.6.4.21.5.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>To install Fail2Ban, execute: </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>sudo zypper -n in fail2ban firewalld</pre></div></li><li class="step"><p>When you install Fail2Ban, a default configuration file
        <code class="filename">jail.conf</code> is also installed. This file gets overwritten
        when you upgrade Fail2Ban. To retain any customizations you make to the file,
        you can add the modifications to a file called <span class="emphasis"><em>jail.local</em></span>.
        Fail2Ban automatically reads both files.
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local</pre></div></li><li class="step"><p> Open the file in your editor.
    </p><div class="verbatim-wrap"><pre class="screen">vi /etc/fail2ban/jail.local</pre></div></li><li class="step"><p> Take a look at the four settings that you need to know about.
</p><div class="figure" id="fig-fail2ban-jail-local"><div class="figure-contents"><div class="mediaobject"><a href="images/fail2ban.png"><img src="images/fail2ban.png" alt="Fail2Ban settings" title="Fail2Ban settings"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 22.1: </span><span class="title-name"><span class="emphasis"><em>jail.local </em></span>file settings </span></span><a title="Permalink" class="permalink" href="#fig-fail2ban-jail-local">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ssh.xml" title="Edit source document"> </a></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.4.21.5.3.5.3.1"><span class="term"><span class="emphasis"><em>ignoreip</em></span></span></dt><dd><p>A list of whitelisted IPs that will never be banned.
  The local host IP address <span class="emphasis"><em>127.0.0.1</em></span> is in the list by default,
  along with the IPv6 equivalent <span class="emphasis"><em>::1</em></span>. You can use this setting
  to add a list of IP addresses that you know should not be banned. </p></dd><dt id="id-1.7.6.4.21.5.3.5.3.2"><span class="term"><span class="emphasis"><em>bantime</em></span></span></dt><dd><p>The duration in minutes for which an IP address is banned. When you do not
    enter a value ending in <span class="emphasis"><em>m</em></span> or <span class="emphasis"><em>h</em></span>, it is treated as seconds.
    If you enter a value of <span class="emphasis"><em>-1</em></span>, an IP address is permanently banned.</p></dd><dt id="id-1.7.6.4.21.5.3.5.3.3"><span class="term"><span class="emphasis"><em>findtime</em></span></span></dt><dd><p>The duration of time where too many failed connection attempts result in an IP being banned.
      </p></dd><dt id="id-1.7.6.4.21.5.3.5.3.4"><span class="term"><span class="emphasis"><em>maxretry</em></span></span></dt><dd><p> The limit for the number of failed attempts.
        </p></dd></dl></div><div id="id-1.7.6.4.21.5.3.5.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>If a connection from the same IP address makes <span class="emphasis"><em>maxretry</em></span>
  failed connection attempts within the <span class="emphasis"><em>findtime</em></span> period, they are banned
  for the duration of the <span class="emphasis"><em>bantime</em></span>. The only exceptions are the IP addresses
  in the <span class="emphasis"><em>ignoreip</em></span> list.</p></div><p> Fail2Ban supports different types of jails and each jail has
  different settings for the connection types.</p></li><li class="step"><p> You can use the Fail2Ban service with the following:</p><p>To enable:</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code> systemctl enable fail2ban</pre></div><p>To start:</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code> systemctl start fail2ban</pre></div><p>To check the service status:</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code> systemctl status fail2ban.service</pre></div><div id="id-1.7.6.4.21.5.3.6.8" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>You must restart Fail2Ban each time you make a configuration change.
  </p></div></li></ol></div></div></section></section></section><section class="chapter" id="cha-security-firewall" data-id-title="Masquerading and firewalls"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">23 </span><span class="title-name">Masquerading and firewalls</span></span> <a title="Permalink" class="permalink" href="#cha-security-firewall">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Whenever Linux is used in a network environment, you can use the
  kernel functions that allow the manipulation of network packets to
  maintain a separation between internal and external network areas. The
  Linux <code class="systemitem">netfilter</code> framework provides the means
  to establish an effective firewall that keeps different networks
  apart. Using iptables—a generic table structure for the
  definition of rule sets—precisely controls the packets allowed to
  pass a network interface. Such a packet filter can be set up using
  <code class="systemitem">firewalld</code> and its graphical interface <code class="command">firewall-config</code>.
 </p><p>
  <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="phrase">15 GA</span>
  introduces <code class="systemitem">firewalld</code> as the new default software firewall, replacing
  SuSEfirewall2.
  This chapter provides guidance for configuring <code class="systemitem">firewalld</code>, and migrating
  from SuSEfirewall2 for users who have upgraded from older <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>
  releases.
 </p><section class="sect1" id="sec-security-firewall-iptables" data-id-title="Packet filtering with iptables"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.1 </span><span class="title-name">Packet filtering with iptables</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-iptables">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section discusses the low-level details of packet filtering. The
   components <code class="systemitem">netfilter</code> and
   <code class="systemitem">iptables</code> are responsible for the filtering and
   manipulation of network packets and for network address translation (NAT).
   The filtering criteria and any actions associated with them are stored in
   chains, which must be matched one after another by individual network
   packets as they arrive. The chains to match are stored in tables. The
   <code class="command">iptables</code> command allows you to alter these tables and
   rule sets.
  </p><p>
   The Linux kernel maintains three tables, each for a particular category
   of functions of the packet filter:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.5.5.4.1"><span class="term">filter</span></dt><dd><p>
      This table holds the bulk of the filter rules, because it implements
      the <span class="emphasis"><em>packet filtering</em></span> mechanism in the stricter
      sense, which determines whether packets are let through
      (<code class="literal">ACCEPT</code>) or discarded (<code class="literal">DROP</code>),
      for example.
     </p></dd><dt id="id-1.7.6.5.5.4.2"><span class="term">nat</span></dt><dd><p>
      This table defines any changes to the source and target addresses of
      packets. Using these functions also allows you to implement
      <span class="emphasis"><em>masquerading</em></span>, which is a special case of NAT used
      to link a private network with the Internet.
     </p></dd><dt id="id-1.7.6.5.5.4.3"><span class="term">mangle</span></dt><dd><p>
      The rules held in this table make it possible to manipulate values
      stored in IP headers (such as the type of service).
     </p></dd></dl></div><p>
   These tables contain several predefined chains to match packets:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.5.5.6.1"><span class="term">PREROUTING</span></dt><dd><p>
      This chain is applied to all incoming packets.
     </p></dd><dt id="id-1.7.6.5.5.6.2"><span class="term">INPUT</span></dt><dd><p>
      This chain is applied to packets destined for the system's internal
      processes.
     </p></dd><dt id="id-1.7.6.5.5.6.3"><span class="term">FORWARD</span></dt><dd><p>
      This chain is applied to packets that are only routed through the
      system.
     </p></dd><dt id="id-1.7.6.5.5.6.4"><span class="term">OUTPUT</span></dt><dd><p>
      This chain is applied to packets originating from the system itself.
     </p></dd><dt id="id-1.7.6.5.5.6.5"><span class="term">POSTROUTING</span></dt><dd><p>
      This chain is applied to all outgoing packets.
     </p></dd></dl></div><p>
   <a class="xref" href="#fig-fire-table" title="iptables: a packet's possible paths">Figure 23.1, “iptables: a packet's possible paths”</a> illustrates the paths along which a
   network packet may travel on a given system. For the sake of simplicity,
   the figure lists tables as parts of chains, but in reality these chains
   are held within the tables themselves.
  </p><p>
   In the simplest case, an incoming packet destined for the system itself
   arrives at the <code class="literal">eth0</code> interface. The packet is first
   referred to the <code class="literal">PREROUTING</code> chain of the
   <code class="literal">mangle</code> table then to the <code class="literal">PREROUTING</code>
   chain of the <code class="literal">nat</code> table. The following step, concerning
   the routing of the packet, determines that the actual target of the
   packet is a process of the system itself. After passing the
   <code class="literal">INPUT</code> chains of the <code class="literal">mangle</code> and the
   <code class="literal">filter</code> table, the packet finally reaches its target,
   provided that the rules of the <code class="literal">filter</code> table allow this.
  </p><div class="figure" id="fig-fire-table"><div class="figure-contents"><div class="mediaobject"><a href="images/fire_tables.png"><img src="images/fire_tables.png" width="65%" alt="iptables: a packet's possible paths" title="iptables: a packet's possible paths"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 23.1: </span><span class="title-name">iptables: a packet's possible paths </span></span><a title="Permalink" class="permalink" href="#fig-fire-table">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></section><section class="sect1" id="sec-security-firewall-masq" data-id-title="Masquerading basics"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.2 </span><span class="title-name">Masquerading basics</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-masq">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Masquerading is the Linux-specific form of NAT (network address
   translation) and can be used to connect a small LAN with the
   Internet.  LAN hosts use IP
   addresses from the private range (see
   <span class="intraxref">Book “Administration Guide”, Chapter 23 “Basic networking”, Section 23.1.2 “Netmasks and routing”</span>) and on the Internet
   official IP addresses are used. To be able to connect
   to the Internet, a LAN host's private address is translated to an official
   one. This is done on the router, which acts as the gateway between the
   LAN and the Internet. The underlying principle is a simple one: The
   router has more than one network interface, typically a network card and
   a separate interface connecting with the Internet. While the latter links
   the router with the outside world, one or several others link it with the
   LAN hosts. With these hosts in the local network connected to the network
   card (such as <code class="literal">eth0</code>) of the router, they can send any
   packets not destined for the local network to their default gateway or
   router.
  </p><div id="id-1.7.6.5.6.3" data-id-title="Using the correct network mask" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Using the correct network mask</div><p>
    When configuring your network, make sure both the broadcast address and
    the netmask are the same for all local hosts. Failing to do so prevents
    packets from being routed properly.
   </p></div><p>
   As mentioned, whenever one of the LAN hosts sends a packet destined for
   an Internet address, it goes to the default router. However, the router
   must be configured before it can forward such packets. For security
   reasons, this is not enabled in a default installation. To enable it, add
   the line <code class="literal">net.ipv4.ip_forward = 1</code> in the file
   <code class="filename">/etc/sysctl.conf</code>. Alternatively do this via YaST,
   for example by calling <code class="command">yast routing ip-forwarding on</code>.
  </p><p>
   The target host of the connection can see your router, but knows nothing
   about the host in your internal network where the packets originated.
   This is why the technique is called masquerading. Because of the address
   translation, the router is the first destination of any reply packets.
   The router must identify these incoming packets and translate their
   target addresses, so packets can be forwarded to the correct host in the
   local network.
  </p><p>
   With the routing of inbound traffic depending on the masquerading table,
   there is no way to open a connection to an internal host from the
   outside. For such a connection, there would be no entry in the table. In
   addition, any connection already established has a status entry assigned
   to it in the table, so the entry cannot be used by another connection.
  </p><p>
   As a consequence of all this, you might experience some problems with
   several application protocols, such as ICQ, cucme, IRC (DCC, CTCP), and
   FTP (in PORT mode). Web browsers, the standard FTP program, and many
   other programs use the PASV mode. This passive mode is much less
   problematic as far as packet filtering and masquerading are concerned.
  </p></section><section class="sect1" id="sec-security-firewall-fw" data-id-title="Firewalling basics"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.3 </span><span class="title-name">Firewalling basics</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-fw">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="emphasis"><em>Firewall</em></span> is probably the term most widely used to
   describe a mechanism that controls the data flow between networks.
   Strictly speaking, the mechanism described in this section is called a
   <span class="emphasis"><em>packet filter</em></span>. A packet filter regulates the data flow
   according to certain criteria, such as protocols, ports, and IP addresses.
   This allows you to block packets that, according to their addresses, are
   not supposed to reach your network. To allow public access to your Web
   server, for example, explicitly open the corresponding port. However, a
   packet filter does not scan the contents of packets with legitimate
   addresses, such as those directed to your Web server. For example, if
   incoming packets were intended to compromise a CGI program on your Web
   server, the packet filter would still let them through.
  </p><p>
   A more effective but more complex mechanism is the combination of several
   types of systems, such as a packet filter interacting with an application
   gateway or proxy. In this case, the packet filter rejects any packets
   destined for disabled ports. Only packets directed to the application
   gateway are accepted. This gateway or proxy pretends to be the actual
   client of the server. In a sense, such a proxy could be considered a
   masquerading host on the protocol level used by the application. One
   example for such a proxy is Squid, an HTTP and FTP proxy server. To use
   Squid, the browser must be configured to communicate via the proxy. Any
   HTTP pages or FTP files requested are served from the proxy cache and
   objects not found in the cache are fetched from the Internet by the
   proxy.
  </p><p>
   The following section focuses on the packet filter that comes with
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. For further information about packet filtering and
   firewalling, read the <a class="link" href="http://www.tldp.org/HOWTO/Firewall-HOWTO.html" target="_blank">Firewall
   HOWTO</a>.
  </p></section><section class="sect1" id="sec-security-firewall-firewalld" data-id-title="firewalld"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.4 </span><span class="title-name"><code class="systemitem">firewalld</code></span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-firewalld">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.6.5.8.2" data-id-title="firewalld replaces SuSEfirewall2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">firewalld</code> replaces SuSEfirewall2</div><p>

    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="phrase">15 GA</span>
    introduces <code class="systemitem">firewalld</code> as the new default software firewall, replacing
    SuSEfirewall2. If you are upgrading from a release older than <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>
    <span class="phrase">15 GA</span>,
    SuSEfirewall2 will be unchanged and you must manually upgrade to
    <code class="systemitem">firewalld</code> (see <a class="xref" href="#sec-security-firewall-upgrade" title="23.5. Migrating from SuSEfirewall2">Section 23.5, “Migrating from SuSEfirewall2”</a>).
   </p></div><p>
   <code class="systemitem">firewalld</code> is a daemon that maintains the system's
   <code class="command">iptables</code> rules and offers a D-Bus interface for
   operating on them. It comes with a command line utility
   <code class="command">firewall-cmd</code> and a graphical user interface
   <code class="command">firewall-config</code> for interacting with it. Since
   <code class="systemitem">firewalld</code> is running in the background and provides a well defined
   interface it allows other applications to request changes to the iptables
   rules, for example to set up virtual machine networking.
  </p><p>
   <code class="systemitem">firewalld</code> implements different security zones. Several predefined
   zones like <code class="literal">internal</code> and <code class="literal">public</code> exist.
   The administrator can define additional custom zones if desired. Each
   zone contains its own set of iptables rules. Each network interface is a
   member of exactly one zone. Individual connections can also be assigned to
   a zone based on the source addresses.
  </p><p>
   Each zone represents a certain level of trust. For example the
   <code class="literal">public</code> zone is not trusted, because other computers in
   this network are not under your control (suitable for Internet or wireless
   hotspot connections). On the other hand the <code class="literal">internal</code> zone
   is used for networks that <span class="emphasis"><em>are</em></span> under your control, like a
   home or company network. By utilizing zones this way, a host can offer
   different kinds of services to trusted networks and untrusted networks in a
   defined way.
  </p><p>
   For more information about the predefined zones and their meaning in
   <code class="systemitem">firewalld</code>, refer to its manual at
   <a class="link" href="http://www.firewalld.org/documentation/zone/predefined-zones.html" target="_blank">http://www.firewalld.org/documentation/zone/predefined-zones.html</a>.
  </p><div id="id-1.7.6.5.8.7" data-id-title="No zone assigned behavior" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: No zone assigned behavior</div><p>
     The initial state for network interfaces is to be assigned to no zone at
     all. In this case the network interface will be implicitly handled in the
     default zone, which can be determined by calling <code class="command">firewall-cmd
      --get-default-zone</code>. If not configured otherwise, the default
     zone is the <code class="literal">public</code> zone.
    </p></div><p>
   The <code class="systemitem">firewalld</code> packet filtering model allows any outgoing connections to
   pass. Outgoing connections are connections that are actively established by
   the local host. Incoming connections that are established by remote hosts are
   blocked if the respective service is not allowed in the zone in
   question. Therefore, each of the interfaces with incoming traffic must be
   placed in a suitable zone to allow for the desired services to be
   accessible. For each of the zones, define the services or protocols you
   need.
  </p><p>
   An important concept of <code class="systemitem">firewalld</code> is the distinction between two separate
   configurations: the <span class="emphasis"><em>runtime</em></span> and the
   <span class="emphasis"><em>permanent</em></span> configuration. The runtime configuration
   represents the currently active rules, while the permanent configuration
   represents the saved rules that will be applied when restarting
   <code class="systemitem">firewalld</code>. This allows to add temporary rules that will be discarded after
   restarting <code class="systemitem">firewalld</code>, or to experiment with new rules while being able to
   revert back to the original state. When you are changing the configuration,
   you need to be aware of which configuration you are editing. How this is done
   is discussed in <a class="xref" href="#sec-security-firewall-firewalld-configurations" title="23.4.3.2. Runtime versus permanent configuration">Section 23.4.3.2, “Runtime versus permanent configuration”</a>.
  </p><p>
   To perform the <code class="systemitem">firewalld</code> configuration using the graphical
   user interface <code class="command">firewall-config</code> refer to its <a class="link" href="http://www.firewalld.org/documentation/utilities/firewall-config.html" target="_blank">documentation</a>.
   In the following section we will be looking at how to perform typical
   <code class="systemitem">firewalld</code> configuration tasks using <code class="command">firewall-cmd</code> on the
   command line.
  </p><section class="sect2" id="sec-security-firewall-firewalld-nm" data-id-title="Configuring the firewall with NetworkManager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.4.1 </span><span class="title-name">Configuring the firewall with NetworkManager</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-firewalld-nm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The NetworkManager supports a basic configuration of <code class="systemitem">firewalld</code>
    by selecting zones.
   </p><p>
    When editing a wired or wireless connection, go to the
    <span class="emphasis"><em>Identity</em></span> tab in the configuration window and
    use the <code class="literal">Firewall Zone</code> drop-down box.
   </p></section><section class="sect2" id="sec-security-firewall-firewalld-yast" data-id-title="Configuring the Firewall with YaST"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.4.2 </span><span class="title-name">Configuring the Firewall with YaST</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-firewalld-yast">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The <code class="command">yast firewall</code> module supports a basic 
     configuration of <code class="systemitem">firewalld</code>. It provides a zone 
     selector, services selector, and ports selector. It does not support
     creating custom iptables rules, and limits zone creation and 
     customization to selecting services and ports.
   </p><div id="id-1.7.6.5.8.12.3" data-id-title="Changing settings in running mode" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Changing settings in running mode</div><p>
     YaST respects the settings in <code class="filename">/etc/firewalld/firewalld.conf</code>,
     where the default value for <code class="option">FlushAllOnReload</code> is set to
     <code class="literal">no</code>. Therefore, YaST does not change settings in running mode.
     For example, if you have assigned an interface to a different zone with YaST,
     restart the firewalld daemon for the change to take effect.
    </p></div></section><section class="sect2" id="sec-security-firewall-firewalld-cmd" data-id-title="Configuring the firewall on the command line"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.4.3 </span><span class="title-name">Configuring the firewall on the command line</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-firewalld-cmd">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect3" id="id-1.7.6.5.8.13.2" data-id-title="Firewall start-up"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.1 </span><span class="title-name">Firewall start-up</span></span> <a title="Permalink" class="permalink" href="#id-1.7.6.5.8.13.2">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">firewalld</code> will be installed and enabled by default. It is a regular
     <code class="systemitem">systemd</code> service that can be configured via <code class="command">systemctl</code>
     or the YaST Services Manager.
    </p><div id="id-1.7.6.5.8.13.2.3" data-id-title="Automatic firewall configuration" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Automatic firewall configuration</div><p> After the installation, YaST automatically starts <code class="systemitem">firewalld</code> and
     leaves all interfaces in the default <code class="literal">public</code> zone. If a
     server application is configured and activated on the system, YaST can
     adjust the firewall rules via the options <span class="guimenu">Open Ports on Selected
     Interface in Firewall</span> or <span class="guimenu">Open Ports on
     Firewall</span> in the server configuration modules. Some server module
     dialogs include a <span class="guimenu">Firewall Details</span> button for
     activating additional services and ports.
     </p></div></section><section class="sect3" id="sec-security-firewall-firewalld-configurations" data-id-title="Runtime versus permanent configuration"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.2 </span><span class="title-name">Runtime versus permanent configuration</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-firewalld-configurations">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     By default all <code class="command">firewall-cmd</code> commands operate on the
     runtime configuration. You can apply most operations to the permanent
     configuration <span class="emphasis"><em>only</em></span> by adding the
     <code class="literal">--permanent</code> parameter. When doing so the change will
     only affect the permanent configuration and will not be effective
     immediately in the runtime configuration. There is currently no way to add
     a rule to both runtime and permanent configurations in a single invocation.
     To achieve this you can apply all necessary changes to the runtime
     configuration and when all is working as expected issue the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --runtime-to-permanent</code></pre></div><p>
     This will write all current runtime rules into the permanent configuration.
     Any temporary modifications you or other programs may have made to the
     firewall in other contexts are made permanent this way. If you are unsure
     about this, you can also take the opposite approach to be on the safe side:
     Add new rules to the permanent configuration and reload <code class="systemitem">firewalld</code> to
     make them active.
    </p><div id="id-1.7.6.5.8.13.3.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      Some configuration items, like the default zone, are shared by both the
      runtime and permanent configurations. Changing them will reflect in both
      configurations at once.
     </p></div><p>
     To revert the runtime configuration to the permanent configuration and
     thereby discard any temporary changes, two possibilities exist, either via
     the <code class="systemitem">firewalld</code> command line interface or via <code class="systemitem">systemd</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --reload</code></pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">systemctl reload firewalld</code></pre></div><p>
     For brevity the examples in the following sections will always operate on
     the runtime configuration, if applicable. Adjust them accordingly to make
     them permanent.
    </p></section><section class="sect3" id="id-1.7.6.5.8.13.4" data-id-title="Assignment of interfaces to zones"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.3 </span><span class="title-name">Assignment of interfaces to zones</span></span> <a title="Permalink" class="permalink" href="#id-1.7.6.5.8.13.4">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can list all network interfaces currently assigned to a zone like this:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --zone=public --list-interfaces</code>
eth0</pre></div><p>
     Similarly you can query which zone a specific interface is assigned to:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --get-zone-of-interface=eth0</code>
public</pre></div><p>
     The following command lines assign an interface to a zone. The variant
     using <code class="literal">--add-interface</code> will only work if
     <code class="literal">eth0</code> is not already assigned to another zone. The
     variant using <code class="literal">--change-interface</code> will always work,
     removing <code class="literal">eth0</code> from its current zone if necessary:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --zone=internal --add-interface=eth0</code>
<code class="prompt root"># </code><code class="command">firewall-cmd --zone=internal --change-interface=eth0</code></pre></div><p>
      Any operations without an explicit <code class="literal">--zone</code> argument will
      implicitly operate on the default zone. This pair of commands can be used
      for getting and setting the default zone assignment:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --get-default-zone</code>
dmz
<code class="prompt root"># </code><code class="command">firewall-cmd --set-default-zone=public</code></pre></div><div id="id-1.7.6.5.8.13.4.10" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
      Any network interfaces not explicitly assigned to a zone will be
      automatically part of the default zone. Changing the default zone will
      reassign all those network interfaces immediately for the permanent and
      runtime configurations. You should never use a trusted zone like
      <code class="literal">internal</code> as the default zone, to avoid unexpected
      exposure to threats. For example hotplugged network interfaces like USB
      Ethernet interfaces would automatically become part of the trusted zone in
      such cases.
     </p><p>
      Also note that interfaces that are not explicitly part of any zone will
      not appear in the zone interface list. There is currently no command to
      list unassigned interfaces. Due to this it is best to avoid unassigned
      network interfaces during regular operation.
     </p></div></section><section class="sect3" id="sec-security-firewall-firewalld-cmd-ports" data-id-title="Making network services accessible"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.4 </span><span class="title-name">Making network services accessible</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-firewalld-cmd-ports">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">firewalld</code> has a concept of <span class="emphasis"><em>services</em></span>. A service
     consists of definitions of ports and protocols. These definitions
     logically belong together in the context of a given network service like
     a Web or mail server protocol. The following commands can be used to get
     information about predefined services and their details:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --get-services</code>
[...] dhcp dhcpv6 dhcpv6-client dns docker-registry [...]
<code class="prompt root"># </code><code class="command">firewall-cmd --info-service dhcp</code>
dhcp
  ports: 67/udp
  protocols:
  source-ports:
  modules:
  destination:</pre></div><p>
     These service definitions can be used for easily making the associated
     network functionality accessible in a zone. This command line will open the
     HTTP Web server port in the internal zone, for example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --add-service=http --zone=internal</code></pre></div><p>
     The removal of a service from a zone is performed using the counterpart
     command <code class="literal">--remove-service</code>. You can also define custom
     services using the <code class="literal">--new-service</code> subcommand. Refer to
     <a class="link" href="http://www.firewalld.org/documentation/howto/add-a-service.html" target="_blank">http://www.firewalld.org/documentation/howto/add-a-service.html</a>
     for more details on how to do this.
    </p><p>
     If you just want to open a single port by number, you can use the following
     approach. This will open TCP port 8000 in the internal zone:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --add-port=8000/tcp --zone=internal</code></pre></div><p>
     For removal use the counterpart command <code class="literal">--remove-port</code>.
    </p><div id="id-1.7.6.5.8.13.5.10" data-id-title="Temporarily opening a service or port" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Temporarily opening a service or port</div><p>
      <code class="systemitem">firewalld</code> supports a <code class="literal">--timeout</code> parameter that allows
      to open a service or port for a limited time duration. This can be helpful
      for quick testing and makes sure that closing the service or port will not
      be forgotten. To allow the <code class="literal">imap</code> service in the
      <code class="literal">internal</code> zone for 5 minutes, you would call
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --add-service=imap --zone=internal --timeout=5m</code></pre></div></div></section><section class="sect3" id="id-1.7.6.5.8.13.6" data-id-title="Lockdown mode"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.5 </span><span class="title-name">Lockdown mode</span></span> <a title="Permalink" class="permalink" href="#id-1.7.6.5.8.13.6">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">firewalld</code> offers a <span class="emphasis"><em>lockdown mode</em></span> that prevents
     changes to the firewall rules while it is active. Since applications can
     automatically change the firewall rules via the D-Bus interface, and
     depending on the PolicyKit rules regular users may be able to do the same,
     it can be helpful to prevent changes in some situations. You can find more
     information about this at
     <a class="link" href="https://fedoraproject.org/wiki/Features/FirewalldLockdown" target="_blank">https://fedoraproject.org/wiki/Features/FirewalldLockdown</a>.
    </p><p>
     It is important to understand that the lockdown mode feature
     provides no real security, but merely protection against accidental or
     benign attempts to change the firewall. The way the lockdown mode is
     currently implemented in <code class="systemitem">firewalld</code> provides no security against malicious
     intent, as is pointed out at
     <a class="link" href="http://seclists.org/oss-sec/2017/q3/139" target="_blank">http://seclists.org/oss-sec/2017/q3/139</a>.
    </p></section><section class="sect3" id="id-1.7.6.5.8.13.7" data-id-title="Adding custom iptables rules"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.6 </span><span class="title-name">Adding custom <code class="command">iptables</code> rules</span></span> <a title="Permalink" class="permalink" href="#id-1.7.6.5.8.13.7">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">firewalld</code> claims exclusive control over the host's
     <code class="systemitem">netfilter</code> rules. You should never modify
     firewall rules using other tools like <code class="command">iptables</code>. Doing
     so could confuse <code class="systemitem">firewalld</code> and break security or functionality.
    </p><p>
     If you need to add custom firewall rules that aren't covered by
     <code class="systemitem">firewalld</code> features then there are two ways to do so. To directly pass
     raw <code class="command">iptables</code> syntax you can use the
     <code class="literal">--direct</code> option. It expects the table, chain, and
     priority as initial arguments and the rest of the command line is passed
     as is to <code class="command">iptables</code>. The following example adds a
     connection tracking rule for the forwarding filter table:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd  --direct --add-rule ipv4 filter FORWARD 0 -i eth0 -o eth1 \
    -p tcp --dport 80 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT</code></pre></div><p>
     Additionally, <code class="systemitem">firewalld</code> implements so called <span class="emphasis"><em>rich
     rules</em></span>, an extended syntax for specifying
     <code class="command">iptables</code> rules in an easier way. You can find the
     syntax specification at
     <a class="link" href="http://www.firewalld.org/documentation/man-pages/firewalld.richlanguage.html" target="_blank">http://www.firewalld.org/documentation/man-pages/firewalld.richlanguage.html</a>.
     The following example drops all IPv4 packets originating from a certain
     source address:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --zone=public --add-rich-rule='rule family="ipv4" \
    source address="192.168.2.4" drop'</code></pre></div></section><section class="sect3" id="id-1.7.6.5.8.13.8" data-id-title="Routing, forwarding, and masquerading"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.7 </span><span class="title-name">Routing, forwarding, and masquerading</span></span> <a title="Permalink" class="permalink" href="#id-1.7.6.5.8.13.8">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">firewalld</code> is not designed to run as a fully fledged router. The
     basic functionality for typical home router setups is available. For a
     corporate production router you should not use <code class="systemitem">firewalld</code>, however, but
     use dedicated router and firewall devices instead. The following provides
     just a few pointers on what to look for to utilize routing in <code class="systemitem">firewalld</code>:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       First of all IP forwarding needs to be enabled as outlined in
       <a class="xref" href="#sec-security-firewall-masq" title="23.2. Masquerading basics">Section 23.2, “Masquerading basics”</a>.
      </p></li><li class="listitem"><p>
       To enable IPv4 masquerading, for example in the
       <code class="literal">internal</code> zone, issue the following command.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --zone=internal --add-masquerade</code></pre></div></li><li class="listitem"><p>
       <code class="systemitem">firewalld</code> can also enable port forwarding. The following command will
       forward local TCP connections on port 80 to another host:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --zone=public \
    --add-forward-port=port=80:proto=tcp:toport=80:toaddr=192.168.1.10</code></pre></div></li></ul></div></section></section><section class="sect2" id="sec-security-firewall-firewalld-rpcports" data-id-title="Accessing services listening on dynamic ports"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.4.4 </span><span class="title-name">Accessing services listening on dynamic ports</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-firewalld-rpcports">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Some network services do not listen on predefined port numbers. Instead
    they operate based on the <code class="literal">portmapper</code> or
    <code class="literal">rpcbind</code> protocol. We will use the term
    <code class="literal">rpcbind</code> from here on. When one of these services
    starts, it chooses a random local port and talks to
    <code class="literal">rpcbind</code> to make the port number known.
    <code class="literal">rpcbind</code> itself is listening on a well known port.
    Remote systems can then query <code class="literal">rpcbind</code> about the network
    services it knows about and on which ports they are listening. Not many
    programs use this approach anymore today. Popular examples are
    Network Information Services (NIS; <code class="command">ypserv</code> and
    <code class="command">ypbind</code>) and the Network File System (NFS) version 3.
   </p><div id="id-1.7.6.5.8.14.3" data-id-title="About NFSv4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: About NFSv4</div><p>
     The newer NFSv4 only requires the single well known
     TCP port 2049. For protocol version 4.0 the kernel parameter
     <code class="literal">fs.nfs.nfs_callback_tcpport</code> may need to be set
     to a static port (see <a class="xref" href="#ex-security-firewall-nfscallback" title="Callback port configuration for the nfs kernel module in /etc/modprobe.d/60-nfs.conf">Example 23.1, “Callback port configuration for the <code class="literal">nfs</code> kernel module in <code class="filename">/etc/modprobe.d/60-nfs.conf</code>”</a>).
     Starting with protocol version 4.1 this setting has also become
     unnecessary.
    </p></div><p>
    The dynamic nature of the <code class="literal">rpcbind</code> protocol makes
    it difficult to make the affected services behind the firewall accessible.
    <code class="systemitem">firewalld</code> does not support these services by itself. For manual configuration,
    see <a class="xref" href="#sec-security-firewall-firewalld-rpcports-static" title="23.4.4.1. Configuring static ports">Section 23.4.4.1, “Configuring static ports”</a>.
    Alternatively, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> provides a helper script. For details, see
    <a class="xref" href="#sec-security-firewall-firewalld-rpcports-helper" title="23.4.4.2. Using firewall-rpcbind-helper for configuring static ports">Section 23.4.4.2, “Using <span class="package">firewall-rpcbind-helper</span> for configuring static ports”</a>.
   </p><section class="sect3" id="sec-security-firewall-firewalld-rpcports-static" data-id-title="Configuring static ports"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.4.1 </span><span class="title-name">Configuring static ports</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-firewalld-rpcports-static">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     One possibility is to configure all involved network services to use
     fixed port numbers. Once this is done, the fixed ports can be opened in
     <code class="systemitem">firewalld</code> and everything should work. The actual port numbers used are
     at your discretion but should not clash with any well known port numbers
     assigned to other services. See <a class="xref" href="#tab-security-firewall-sysconfigports" title="Important sysconfig variables for static port configuration">Table 23.1, “Important sysconfig variables for static port configuration”</a>
     for a list of the available configuration items for NIS and NFSv3
     services. Note that depending on your actual NIS or NFS configuration,
     not all of these ports may be required for your setup.
    </p><div class="table" id="tab-security-firewall-sysconfigports" data-id-title="Important sysconfig variables for static port configuration"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 23.1: </span><span class="title-name">Important sysconfig variables for static port configuration </span></span><a title="Permalink" class="permalink" href="#tab-security-firewall-sysconfigports">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/><col class="3"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         <p>
          File Path
         </p>
        </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         <p>
          Variable Name
         </p>
        </th><th style="border-bottom: 1px solid ; ">
         <p>
          Example Value
         </p>
        </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " rowspan="5">
         <code class="filename">
          /etc/sysconfig/nfs
         </code>
        </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         MOUNTD_PORT
        </td><td style="border-bottom: 1px solid ; ">
         21001
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         STATD_PORT
        </td><td style="border-bottom: 1px solid ; ">
         21002
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         LOCKD_TCPPORT
        </td><td style="border-bottom: 1px solid ; ">
         21003
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         LOCKD_UDPPORT
        </td><td style="border-bottom: 1px solid ; ">
         21003
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         RQUOTAD_PORT
        </td><td style="border-bottom: 1px solid ; ">
         21004
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         <code class="filename">
          /etc/sysconfig/ypbind
         </code>
        </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         YPBIND_OPTIONS
        </td><td style="border-bottom: 1px solid ; ">
         -p 24500
        </td></tr><tr><td style="border-right: 1px solid ; " rowspan="3">
         <code class="filename">
          /etc/sysconfig/ypserv
         </code>
        </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         YPXFRD_ARGS
        </td><td style="border-bottom: 1px solid ; ">
         -p 24501
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         YPSERV_ARGS
        </td><td style="border-bottom: 1px solid ; ">
         -p 24502
        </td></tr><tr><td style="border-right: 1px solid ; ">
         YPPASSWDD_ARGS
        </td><td>
         --port 24503
        </td></tr></tbody></table></div></div><p>
     You will need to restart any related services that are affected by these
     static port configurations for the changes to take effect. You can see
     the currently assigned rpcbind ports by using the command
     <code class="command">rpcinfo -p</code>. On success only the statically configured
     ports should show up there.
    </p><p>
     Apart from the port configuration for network services running in
     userspace there are also ports that are used by the Linux kernel directly
     when it comes to NFS. One of these ports is
     <code class="literal">nfs_callback_tcpport</code>. It is only required for NFS
     protocol versions older than 4.1. There is a sysctl named
     <code class="literal">fs.nfs.nfs_callback_tcpport</code> to configure this port.
     This sysctl node only appears dynamically when NFS mounts are active.
     Therefore it is best to configure the port via kernel module
     parameters. This can be achieved by creating a file as shown in
     <a class="xref" href="#ex-security-firewall-nfscallback" title="Callback port configuration for the nfs kernel module in /etc/modprobe.d/60-nfs.conf">Example 23.1, “Callback port configuration for the <code class="literal">nfs</code> kernel module in <code class="filename">/etc/modprobe.d/60-nfs.conf</code>”</a>.
    </p><div class="example" id="ex-security-firewall-nfscallback" data-id-title="Callback port configuration for the nfs kernel module in /etc/modprobe.d/60-nfs.conf"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 23.1: </span><span class="title-name">Callback port configuration for the <code class="literal">nfs</code> kernel module in <code class="filename">/etc/modprobe.d/60-nfs.conf</code> </span></span><a title="Permalink" class="permalink" href="#ex-security-firewall-nfscallback">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">options nfs callback_tcpport=21005</pre></div></div></div><p>
     To make this change effective it is easiest to reboot the machine.
     Otherwise all NFS services need to be stopped and the
     <code class="literal">nfs</code> kernel module needs to be reloaded. To verify the
     active NFS callback port, check the output of
     <code class="command">cat /sys/module/nfs/parameters/callback_tcpport</code>.
    </p><p>
     For easy handling of the now statically configured RPC ports, it is useful
     to create a new <code class="systemitem">firewalld</code> service definition. This service definition
     will group all related ports and, for example, makes it easy to make them
     accessible in a specific zone. In
     <a class="xref" href="#ex-security-firewall-newrpcservice" title="Commands to define a new firewalld RPC service for NFS">Example 23.2, “Commands to define a new <code class="systemitem">firewalld</code> RPC service for NFS”</a> this is done for the
     NFS ports as they have been configured in the accompanying examples.
    </p><div class="example" id="ex-security-firewall-newrpcservice" data-id-title="Commands to define a new firewalld RPC service for NFS"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 23.2: </span><span class="title-name">Commands to define a new <code class="systemitem">firewalld</code> RPC service for NFS </span></span><a title="Permalink" class="permalink" href="#ex-security-firewall-newrpcservice">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --permanent --new-service=nfs-rpc</code>
<code class="prompt root"># </code><code class="command">firewall-cmd --permanent --service=nfs-rpc --set-description="NFS related, statically configured RPC ports"</code>
# add UDP and TCP ports for the given sequence
<code class="prompt root"># </code><code class="command">for port in 21001 21002 21003 21004; do
    firewall-cmd --permanent --service=nfs-rpc --add-port ${port}/udp --add-port ${port}/tcp
done</code>
# the callback port is TCP only
<code class="prompt root"># </code><code class="command">firewall-cmd --permanent --service=nfs-rpc --add-port 21005/tcp</code>

# show the complete definition of the new custom service
<code class="prompt root"># </code><code class="command">firewall-cmd --info-service=nfs-rpc --permanent -v</code>
nfs-rpc
  summary:
  description: NFS and related, statically configured RPC ports
  ports: 4711/tcp 21001/udp 21001/tcp 21002/udp 21002/tcp 21003/udp 21003/tcp 21004/udp 21004/tcp
  protocols:
  source-ports:
  modules:
  destination:

# reload firewalld to make the new service definition available
<code class="prompt root"># </code><code class="command">firewall-cmd --reload</code>

# the new service definition can now be used to open the ports for example in the internal zone
<code class="prompt root"># </code><code class="command">firewall-cmd --add-service=nfs-rpc --zone=internal</code></pre></div></div></div></section><section class="sect3" id="sec-security-firewall-firewalld-rpcports-helper" data-id-title="Using firewall-rpcbind-helper for configuring static ports"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.4.2 </span><span class="title-name">Using <span class="package">firewall-rpcbind-helper</span> for configuring static ports</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-firewalld-rpcports-helper">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The steps to configure static ports as shown in the previous section can
     be simplified by using the SUSE helper tool
     <code class="command">firewall-rpc-helper.py</code>. Install it with
     <code class="command">zypper in firewalld-rpcbind-helper</code>.
    </p><p>
     The tool allows interactive configuration of the service patterns
     discussed in the previous section. It can also display current port
     assignments and can be used for scripting. For details, see
     <code class="command">firewall-rpc-helper.py --help</code>.
    </p></section><section class="sect3" id="sec-security-firewall-firewalld-nftables" data-id-title="nftables as the default back-end"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.4.3 </span><span class="title-name">nftables as the default back-end </span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-firewalld-nftables">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The default back-end for <code class="systemitem">firewalld</code> is nftables. nftables is a framework by the Linux <code class="systemitem">netfilter</code> project
  that provides packet filtering, network address translation (NAT) and other similar functionalities. nftables reuses the existing Netfilter
  subsystems such as the connection tracking system, user space queueing, logging and the hook infrastructure.
  nftables is a replacement for iptables, ip6tables, arptables, ebtables, and ipset.
</p><p>
  The advantages of using nftables include:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        One framework for both the IPv4 and IPv6 protocols.
       </p></li><li class="listitem"><p>
        Rules are applied atomically instead of fetching, updating and storing a complete rule set.
        </p></li><li class="listitem"><p>
        Monitor trace events in the <span class="emphasis"><em>nft</em></span> tool, debug and trace the ruleset via <span class="emphasis"><em>nftrace</em></span>.
        </p></li><li class="listitem"><p>
      The <code class="command">nft</code> command line tool compiles into VM bytecode in netlink format.
      During the rule set retrieval, the VM bytecode in netlink format is translated back into the original ruleset representation.
      </p></li></ul></div><p><span class="bold"><strong>A basic nftables configuration file:</strong></span></p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code> cat /etc/nftables.conf
    #!/usr/sbin/nft -f

    flush ruleset

    # This matches IPv4 and IPv6
    table inet filter {
        # chain names are up to you.
        # what part of the traffic they cover,
        # depends on the type table.
        chain input {
            type filter hook input priority 0; policy accept;
        }
        chain forward {
            type filter hook forward priority 0; policy accept;
        }
        chain output {
            type filter hook output priority 0; policy accept;
        }
    }</pre></div><p>In the above example, all traffic is allowed because all chains have the policy <span class="emphasis"><em>accept</em></span>.
  Note that, in reality, this is a bad practice, as firewalls should deny traffic by default.</p><p><span class="bold"><strong>A basic nftables configuration file with masquerade:</strong></span></p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code> cat /etc/nftables.conf
    #!/sbin/nft -f

    flush ruleset

    table ip nat {
      chain prerouting {
        type nat hook prerouting priority 0; policy accept;
      }

      # for all packets to WAN, after routing, replace source address with primary IP of WAN interface
      chain postrouting {
        type nat hook postrouting priority 100; policy accept;
        oifname "wan0" masquerade
      }
    }</pre></div><p>If you have a static IP, it would be slightly faster to use source nat (SNAT) instead of masquerade.
    The router replaces the source with a predefined IP instead of looking up the outgoing IP for every packet.</p><p><span class="bold"><strong>An nftables configuration file with some rules applied:</strong></span></p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code> cat /etc/nftables.conf
    #!/usr/sbin/nft -f

flush ruleset

table inet filter {
    chain base_checks {
        ## another set, this time for connection tracking states.
        # allow established/related connections
        ct state {established, related} accept;

        # early drop of invalid connections
        ct state invalid drop;
    }

    chain input {
        type filter hook input priority 0; policy drop;

        # allow from loopback
        iif "lo" accept;

        jump base_checks;

        # allow icmp and igmp
        ip6 nexthdr icmpv6 icmpv6 type { echo-request, echo-reply, packet-too-big, time-exceeded, parameter-problem, destination-unreachable, packet-too-big, mld-listener-query, mld-listener-report, mld-listener-reduction, nd-router-solicit, nd-router-advert, nd-neighbor-solicit, nd-neighbor-advert, ind-neighbor-solicit, ind-neighbor-advert, mld2-listener-report } accept;
        ip protocol icmp icmp type { echo-request, echo-reply, destination-unreachable, router-solicitation, router-advertisement, time-exceeded, parameter-problem } accept;
        ip protocol igmp accept;

        # for testing reject with logging
        counter log prefix "[nftables] input reject " reject;
    }
    chain forward {
        type filter hook forward priority 0; policy accept;
    }
    chain output {
        type filter hook output priority 0; policy accept;
    }
}</pre></div><p>In the above example: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
   The chain policy is to drop and add a reject rule at the end, which means all incoming traffic is blocked.
    </p></li><li class="listitem"><p>
    All traffic on the <code class="literal">localhost</code> interface is allowed.
    </p></li><li class="listitem"><p>
   The <code class="literal">base_checks</code> chain handles all packets that are related to established connections.
   This ensures that incoming packets for outgoing connections are not blocked.
    </p></li><li class="listitem"><p>
    ICMP and IGMP packets are allowed by utilizing a set and specific type names.
   </p></li><li class="listitem"><p>
    A counter keeps a count of both the total number of packets and bytes it has seen since it was last reset.
    With nftables, you must specify a counter for each rule you want to count.
    </p></li></ul></div><section class="sect4" id="sec-security-nftables-more-information" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">23.4.4.3.1 </span><span class="title-name">More information </span></span> <a title="Permalink" class="permalink" href="#sec-security-nftables-more-information">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>For more information about nftables, see:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Upstream documentation <a class="link" href="https://www.netfilter.org/projects/nftables/index.html" target="_blank"> </a>
    </p></li><li class="listitem"><p>
    nftables man page <a class="link" href="https://www.netfilter.org/projects/nftables/manpage.html" target="_blank"> </a>
    </p></li></ul></div></section></section></section></section><section class="sect1" id="sec-security-firewall-upgrade" data-id-title="Migrating from SuSEfirewall2"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.5 </span><span class="title-name">Migrating from SuSEfirewall2</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-upgrade">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.6.5.9.2" data-id-title="Creating a firewalld configuration for AutoYaST" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Creating a <code class="systemitem">firewalld</code> configuration for AutoYaST</div><p>
    See the <em class="citetitle">Firewall Configuration</em> section of the
    AutoYaST Guide to learn how to create a <code class="systemitem">firewalld</code> configuration for AutoYaST.
   </p></div><p>
   When upgrading from
   <span class="phrase">any service pack of <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> 12</span>
   
   to <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP4</span></span>, SuSEfirewall2
   is not changed and remains active. There is no automatic migration, so you must
   migrate to <code class="systemitem">firewalld</code> manually. <code class="systemitem">firewalld</code> includes a helper migration
   script, <code class="command">susefirewall2-to-firewalld</code>. Depending on the
   complexity of your SuSEfirewall2 configuration, the script may perform a
   perfect migration, or it may fail. Most likely it will partially succeed and you
   will have to review your new <code class="systemitem">firewalld</code> configuration and make adjustments.
  </p><p>
   The resulting configuration will make <code class="systemitem">firewalld</code> behave somewhat like
   SuSEfirewall2. To take full advantage of <code class="systemitem">firewalld</code>'s features you may elect to
   create a new configuration, rather than trying to migrate your old configuration.
   It is safe to run the <code class="command">susefirewall2-to-firewalld</code> script
   with no options, as it makes no permanent changes to your system. However, if
   you are administering the system remotely you could get locked out.
  </p><p>
   Install and run <code class="command">susefirewall2-to-firewalld</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>zypper in susefirewall2-to-firewalld
<code class="prompt root"># </code>susefirewall2-to-firewalld
INFO: Reading the /etc/sysconfig/SuSEfirewall2 file
INFO: Ensuring all firewall services are in a well-known state.
INFO: This will start/stop/restart firewall services and it's likely
INFO: to cause network disruption.
INFO: If you do not wish for this to happen, please stop the script now!
5...4...3...2...1...Lets do it!
INFO: Stopping firewalld
INFO: Restarting SuSEfirewall2_init
INFO: Restarting SuSEfirewall2
INFO: DIRECT: Adding direct rule="ipv4 -t filter -A INPUT -p udp -m udp --dport 5353 -m pkttype
  --pkt-type multicast -j ACCEPT"
[...]
INFO: Enabling direct rule=ipv6 -t filter -A INPUT -p udp -m udp --dport 546 -j ACCEPT
INFO: Enabling direct rule=ipv6 -t filter -A INPUT -p udp -m udp --dport 5353 -m pkttype
  --pkt-type multicast -j ACCEPT
INFO: Enable logging for denied packets
INFO: ##########################################################
INFO:
INFO: The dry-run has been completed. Please check the above output to ensure
INFO: that everything looks good.
INFO:
INFO: ###########################################################
INFO: Stopping firewalld
INFO: Restarting SuSEfirewall2_init
INFO: Restarting SuSEfirewall2</pre></div><p>
   This results in a lot of output, which you may wish to direct to a file for easier review:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>susefirewall2-to-firewalld | tee newfirewallrules.txt</pre></div><p>
   The script supports these options:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.5.9.11.1"><span class="term"><code class="command">-c</code></span></dt><dd><p>
      Commit changes. The script will make changes to the system, so make sure you only use
      this option if you are really happy with the proposed changes. This <span class="emphasis"><em>will</em></span>
      reset your current <code class="systemitem">firewalld</code> configuration, so make sure you make backups!
     </p></dd><dt id="id-1.7.6.5.9.11.2"><span class="term"><code class="command">-d</code></span></dt><dd><p>
      Super noisy. Use it to file bug reports but be careful to mask sensitive information.
     </p></dd><dt id="id-1.7.6.5.9.11.3"><span class="term"><code class="command">-h</code></span></dt><dd><p>
      This message.
     </p></dd><dt id="id-1.7.6.5.9.11.4"><span class="term"><code class="command">-q</code></span></dt><dd><p>
      No output. Errors will not be printed either!
     </p></dd><dt id="id-1.7.6.5.9.11.5"><span class="term"><code class="command">-v</code></span></dt><dd><p>
       Verbose mode. It will print warnings and other informative messages.
      </p></dd></dl></div></section><section class="sect1" id="sec-security-firewall-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.6 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-security-firewall-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The most up-to-date information and other documentation about the <code class="systemitem">firewalld</code>
   package is found in <code class="filename">/usr/share/doc/packages/firewalld</code>.
   The home page of the netfilter and iptables project, <a class="link" href="http://www.netfilter.org" target="_blank">http://www.netfilter.org</a>, provides a large collection of
   documents about iptables in general in many languages.
  </p></section></section><section class="chapter" id="cha-security-vpnserver" data-id-title="Configuring a VPN server"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">24 </span><span class="title-name">Configuring a VPN server</span></span> <a title="Permalink" class="permalink" href="#cha-security-vpnserver">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Today, Internet connections are cheap and available almost
    everywhere. However, not all connections are secure.
    Using a Virtual Private Network (VPN), you can create a secure network
    within an insecure network such as the Internet or Wi-Fi. It can be
    implemented in different ways and serves several purposes. In this chapter,
    we focus on the
    <a class="link" href="https://openvpn.net" target="_blank">OpenVPN</a> implementation
    to link branch offices via secure wide area networks (WANs).

        </p></div></div></div></div><section class="sect1" id="sec-security-vpn-overview" data-id-title="Conceptual overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.1 </span><span class="title-name">Conceptual overview</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-overview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section defines some terms regarding VPN and gives a brief overview
   of some scenarios.
  </p><section class="sect2" id="sec-security-vpn-terminology" data-id-title="Terminology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.1.1 </span><span class="title-name">Terminology</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-terminology">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.6.3.3.2.1"><span class="term">Endpoint</span></dt><dd><p>
       The two <span class="quote">“<span class="quote">ends</span>”</span> of a tunnel, the source or destination
       client.
      </p></dd><dt id="id-1.7.6.6.3.3.2.2"><span class="term">Tap device</span></dt><dd><p>
       A tap device simulates an Ethernet device (layer 2 packets in the OSI
       model, such as Ethernet frames). A tap device is used for creating a
       network bridge. It works with Ethernet frames.
      </p></dd><dt id="id-1.7.6.6.3.3.2.3"><span class="term">Tun device</span></dt><dd><p>
       A tun device simulates a point-to-point network (layer 3 packets in
       the OSI model, such as IP packets). A tun device is used with
       routing and works with IP frames.
      </p></dd><dt id="id-1.7.6.6.3.3.2.4"><span class="term">Tunnel</span></dt><dd><p>
       Linking two locations through a primarily public network. From a more
       technical viewpoint, it is a connection between the client's device
       and the server's device. Usually a tunnel is encrypted, but it does
       need to be by definition.
      </p></dd></dl></div></section><section class="sect2" id="sec-security-vpn-scenarios" data-id-title="VPN scenarios"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.1.2 </span><span class="title-name">VPN scenarios</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-scenarios">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Whenever you set up a VPN connection, your IP packets are transferred
    over a secured <span class="emphasis"><em>tunnel</em></span>. A tunnel can use either a
    <span class="emphasis"><em>tun</em></span> or <span class="emphasis"><em>tap</em></span> device. They are
    virtual network kernel drivers which implement the transmission of
    Ethernet frames or IP frames/packets.
   </p><p>
    Any user space program, such as OpenVPN, can attach itself to a tun or tap
    device to receive packets sent by your operating system. The program is
    also able to write packets to the device.
   </p><p>
    There are many solutions to set up and build a VPN connection. This
    section focuses on the OpenVPN package. Compared to other VPN software,
    OpenVPN can be operated in two modes:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.6.3.4.5.1"><span class="term">Routed VPN</span></dt><dd><p>
       Routing is an easy solution to set up. It is more efficient and
       scales better than a bridged VPN. Furthermore, it allows the user to
       tune MTU (Maximum Transfer Unit) to raise efficiency. However, in a
       heterogeneous environment, if you do not have a Samba server on the
       gateway, NetBIOS broadcasts do not work. If you need IPv6, the drivers
       for the tun devices on both ends must support this protocol explicitly.
       This scenario is depicted in <a class="xref" href="#fig-vpn-scenario-routed-1" title="Routed VPN">Figure 24.1, “Routed VPN”</a>.
      </p><div class="figure" id="fig-vpn-scenario-routed-1"><div class="figure-contents"><div class="mediaobject"><a href="images/vpn_routed1.png"><img src="images/vpn_routed1.png" width="80%" alt="Routed VPN" title="Routed VPN"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 24.1: </span><span class="title-name">Routed VPN </span></span><a title="Permalink" class="permalink" href="#fig-vpn-scenario-routed-1">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></dd><dt id="id-1.7.6.6.3.4.5.2"><span class="term">Bridged VPN</span></dt><dd><p>
       Bridging is a more complex solution. It is recommended when you need
       to browse Windows file shares across the VPN without setting up a
       Samba or WINS server. Bridged VPN is also needed to use
       non-IP protocols (such as IPX) or applications relying on network
       broadcasts. However, it is less efficient than routed VPN. Another
       disadvantage is that it does not scale well. This scenario is
       depicted in the following figures.
      </p><div class="figure" id="fig-vpn-scenario-briged-1"><div class="figure-contents"><div class="mediaobject"><a href="images/vpn_bridged1.png"><img src="images/vpn_bridged1.png" width="80%" alt="Bridged VPN - scenario 1" title="Bridged VPN - scenario 1"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 24.2: </span><span class="title-name">Bridged VPN - scenario 1 </span></span><a title="Permalink" class="permalink" href="#fig-vpn-scenario-briged-1">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div><div class="figure" id="fig-vpn-scenario-briged-2"><div class="figure-contents"><div class="mediaobject"><a href="images/vpn_bridged2.png"><img src="images/vpn_bridged2.png" width="80%" alt="Bridged VPN - scenario 2" title="Bridged VPN - scenario 2"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 24.3: </span><span class="title-name">Bridged VPN - scenario 2 </span></span><a title="Permalink" class="permalink" href="#fig-vpn-scenario-briged-2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div><div class="figure" id="fig-vpn-scenario-briged-3"><div class="figure-contents"><div class="mediaobject"><a href="images/vpn_bridged3.png"><img src="images/vpn_bridged3.png" width="80%" alt="Bridged VPN - scenario 3" title="Bridged VPN - scenario 3"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 24.4: </span><span class="title-name">Bridged VPN - scenario 3 </span></span><a title="Permalink" class="permalink" href="#fig-vpn-scenario-briged-3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></dd></dl></div><p>
    The major difference between bridging and routing is that a routed VPN
    cannot IP-broadcast while a bridged VPN can.
   </p></section></section><section class="sect1" id="sec-security-vpn-simplest" data-id-title="Setting up a simple test scenario"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.2 </span><span class="title-name">Setting up a simple test scenario</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-simplest">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In the following example, we will create a point-to-point VPN tunnel. The
   example demonstrates how to create a VPN tunnel between one client and a
   server. It is assumed that your VPN server will use private IP addresses
   like <code class="systemitem"><em class="replaceable">IP_OF_SERVER</em></code>
   and your client will use the IP address
   <code class="systemitem"><em class="replaceable">IP_OF_CLIENT</em></code>.
   Make sure you select addresses which do not conflict with other IP addresses.
  </p><div id="id-1.7.6.6.4.3" data-id-title="Use only for testing" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Use only for testing</div><p>
    This following scenario is provided as an example meant for familiarizing
    yourself with VPN technology. <span class="emphasis"><em>Do not</em></span> use this as a
    real world scenario, as it can compromise the security and safety of your IT
    infrastructure!
   </p></div><div id="id-1.7.6.6.4.4" data-id-title="Names for configuration file" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Names for configuration file</div><p>
    To simplify working with OpenVPN configuration files, we recommend the
    following:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Place your OpenVPN configuration files in the directory
      <code class="filename">/etc/openvpn</code>.
     </p></li><li class="listitem"><p>
      Name your configuration files
      <code class="filename"><em class="replaceable">MY_CONFIGURATION</em>.conf</code>.
     </p></li><li class="listitem"><p>
      If there are multiple files that belong to the same configuration, place
      them in a subdirectory like
      <code class="filename">/etc/openvpn/<em class="replaceable">MY_CONFIGURATION</em></code>.
     </p></li></ul></div></div><section class="sect2" id="sec-security-vpn-simplest-vpnserv" data-id-title="Configuring the VPN server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.2.1 </span><span class="title-name">Configuring the VPN server</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-simplest-vpnserv">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To configure a VPN server, proceed as follows:
   </p><div class="procedure" id="pro-security-vpn-simplest-vpnserv" data-id-title="VPN server configuration"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 24.1: </span><span class="title-name">VPN server configuration </span></span><a title="Permalink" class="permalink" href="#pro-security-vpn-simplest-vpnserv">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Install the package <code class="systemitem">openvpn</code>
      on the machine that will later become your VPN server.
     </p></li><li class="step"><p>
      Open a shell, become <code class="systemitem">root</code> and create the VPN secret key:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>openvpn --genkey secret /etc/openvpn/secret.key</pre></div></li><li class="step"><p>
      Copy the secret key to your client:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>scp /etc/openvpn/secret.key root@<em class="replaceable">IP_OF_CLIENT</em>:/etc/openvpn/</pre></div></li><li class="step"><p>
      Create the file <code class="filename">/etc/openvpn/server.conf</code> with the
      following content:
     </p><div class="verbatim-wrap"><pre class="screen">dev tun
ifconfig <em class="replaceable">IP_OF_SERVER</em> <em class="replaceable">IP_OF_CLIENT</em>
secret secret.key</pre></div></li><li class="step"><p>
      Set up a tun device configuration by creating a file called
      <code class="filename">/etc/sysconfig/network/ifcfg-tun0</code> with the following
      content:
     </p><div class="verbatim-wrap"><pre class="screen">STARTMODE='manual'
BOOTPROTO='static'
TUNNEL='tun'
TUNNEL_SET_OWNER='nobody'
TUNNEL_SET_GROUP='nobody'
LINK_REQUIRED=no
PRE_UP_SCRIPT='systemd:openvpn@server'
PRE_DOWN_SCRIPT='systemd:openvpn@service'</pre></div><p>
      The notation <code class="literal">openvpn@server</code> points to the OpenVPN
      server configuration file located at
      <code class="filename">/etc/openvpn/server.conf</code>. For more information, see
      <code class="filename">/usr/share/doc/packages/openvpn/README.SUSE</code>.
     </p></li><li class="step" id="st-security-vpn-simplest-vpnserv-yast"><p>
      If you use a firewall, start YaST and open UDP port 1194
      (<span class="guimenu">Security and
      Users</span> › <span class="guimenu">Firewall</span> › <span class="guimenu">Allowed
      Services</span>).
     </p></li><li class="step"><p>
      Start the OpenVPN server service by setting the tun device to
      <code class="literal">up</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">wicked ifup tun0</code></pre></div><p>
      You should see the confirmation:
     </p><div class="verbatim-wrap"><pre class="screen">tun0            up</pre></div></li></ol></div></div></section><section class="sect2" id="sec-security-vpn-simplest-vpnclient" data-id-title="Configuring the VPN clients"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.2.2 </span><span class="title-name">Configuring the VPN clients</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-simplest-vpnclient">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To configure the VPN client, do the following:
   </p><div class="procedure" id="id-1.7.6.6.4.6.3" data-id-title="VPN client configuration"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 24.2: </span><span class="title-name">VPN client configuration </span></span><a title="Permalink" class="permalink" href="#id-1.7.6.6.4.6.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Install the package <code class="systemitem">openvpn</code>
      on your client VPN machine.
     </p></li><li class="step"><p>
      Create <code class="filename">/etc/openvpn/client.conf</code> with the
      following content:
     </p><div class="verbatim-wrap"><pre class="screen">remote <em class="replaceable">DOMAIN_OR_PUBLIC_IP_OF_SERVER</em>
dev tun
ifconfig <em class="replaceable">IP_OF_CLIENT</em> <em class="replaceable">IP_OF_SERVER</em>
secret secret.key</pre></div><p>
      Replace the placeholder <em class="replaceable">IP_OF_CLIENT</em> in the
      first line with either the domain name, or the public IP address of
      your server.
     </p></li><li class="step"><p>
      Set up a tun device configuration by creating a file called
      <code class="filename">/etc/sysconfig/network/ifcfg-tun0</code> with the following
      content:
     </p><div class="verbatim-wrap"><pre class="screen">STARTMODE='manual'
BOOTPROTO='static'
TUNNEL='tun'
TUNNEL_SET_OWNER='nobody'
TUNNEL_SET_GROUP='nobody'
LINK_REQUIRED=no
PRE_UP_SCRIPT='systemd:openvpn@client'
PRE_DOWN_SCRIPT='systemd:openvpn@client'</pre></div></li><li class="step"><p>
      If you use a firewall, start YaST and open UDP port 1194 as
      described in <a class="xref" href="#st-security-vpn-simplest-vpnserv-yast" title="Step 6">Step 6</a>
      of <a class="xref" href="#pro-security-vpn-simplest-vpnserv" title="VPN server configuration">Procedure 24.1, “VPN server configuration”</a>.
     </p></li><li class="step"><p>
      Start the OpenVPN server service by setting the tun device to
      <code class="literal">up</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">wicked ifup tun0</code></pre></div><p>
      You should see the confirmation:
     </p><div class="verbatim-wrap"><pre class="screen">tun0            up</pre></div></li></ol></div></div></section><section class="sect2" id="sec-security-vpn-simplest-use" data-id-title="Testing the VPN example scenario"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.2.3 </span><span class="title-name">Testing the VPN example scenario</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-simplest-use">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    After OpenVPN has successfully started, test the availability of the tun
    device with the following command:
   </p><div class="verbatim-wrap"><pre class="screen">ip addr show tun0</pre></div><p>
    To verify the VPN connection, use <code class="command">ping</code> on both client
    and server side to see if they can reach each other. Ping the server
    from the client:
   </p><div class="verbatim-wrap"><pre class="screen">ping -I tun0 <em class="replaceable">IP_OF_SERVER</em></pre></div><p>
    Ping the client from the server:
   </p><div class="verbatim-wrap"><pre class="screen">ping -I tun0 <em class="replaceable">IP_OF_CLIENT</em></pre></div></section></section><section class="sect1" id="sec-security-vpn-ca" data-id-title="Setting up your VPN server using a certificate authority"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.3 </span><span class="title-name">Setting up your VPN server using a certificate authority</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-ca">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The example in
   <a class="xref" href="#sec-security-vpn-simplest" title="24.2. Setting up a simple test scenario">Section 24.2</a>
   is useful for testing, but not for daily work. This section explains how
   to build a VPN server that allows more than one connection at the same
   time. This is done with a public key infrastructure (PKI). A PKI consists
   of a pair of public and private keys for the server and each client, and
   a certificate authority (CA), which is used to sign every server
   and client certificate.
  </p><p>
   This setup involves the following basic steps:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     <a class="xref" href="#sec-security-vpn-certs" title="24.3.1. Creating certificates">Section 24.3.1, “Creating certificates”</a>
    </p></li><li class="step"><p>
     <a class="xref" href="#sec-security-vpn-config-server" title="24.3.2. Configuring the VPN server">Section 24.3.2, “Configuring the VPN server”</a>
    </p></li><li class="step"><p>
     <a class="xref" href="#sec-security-vpn-config-clients" title="24.3.3. Configuring the VPN clients">Section 24.3.3, “Configuring the VPN clients”</a>
    </p></li></ol></div></div><section class="sect2" id="sec-security-vpn-certs" data-id-title="Creating certificates"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.3.1 </span><span class="title-name">Creating certificates</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-certs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Before a VPN connection can be established, the client must authenticate
    the server certificate. Conversely, the server must also authenticate
    the client certificate. This is called <span class="emphasis"><em>mutual
    authentication</em></span>.
   </p><p>
    Creating certificates is not supported on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. The following
    assumes you have created a CA certificate, a server certificate, and a
    client certificate on another system.
   </p><p>
    The server certificate is required in the PEM and unencrypted
    key in PEM formats. Copy the PEM version to
    <code class="filename">/etc/openvpn/server_crt.pem</code> on the VPN server. The
    unencrypted version needs to go to
    <code class="filename">/etc/openvpn/server_key.pem</code>.
   </p><p>
    Client certificates need to be of the format PKCS12 (preferred) or PEM. The
    certificate in PKCS12 format needs to contain the CA chain and needs to be
    copied to
    <code class="filename">/etc/openvpn/<em class="replaceable">CLIENT</em>.p12</code>. In
    case you have client certificates in PEM format containing the CA chain,
    copy them to
    <code class="filename">/etc/openvpn/<em class="replaceable">CLIENT</em>.pem</code>. In
    case you have split the PEM certificates into client certificate
    (<code class="filename">*.ca</code>), client key (<code class="filename">*.key</code>), and
    the CA certificate (<code class="filename">*.ca</code>), copy these files to
    <code class="filename">/etc/openvpn/</code> on each client.
   </p><p>
    The CA certificate needs to be copied to
    <code class="filename">/etc/openvpn/vpn_ca.pem</code> on the server and each client.
   </p><div id="id-1.7.6.6.5.5.7" data-id-title="Splitting client certificates" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Splitting client certificates</div><p>
     If you split client certificates into client certificate, client key, and
     the CA certificate, you need to provide the respective file names in the
     OpenVPN configuration file on the respective clients (see <a class="xref" href="#ex-vpn-serv-config" title="VPN server configuration file">Example 24.1, “VPN server configuration file”</a>).
    </p></div></section><section class="sect2" id="sec-security-vpn-config-server" data-id-title="Configuring the VPN server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.3.2 </span><span class="title-name">Configuring the VPN server</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-config-server">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As the basis of your configuration file, copy
    <code class="filename">/usr/share/doc/packages/openvpn/sample-config-files/server.conf</code>
    to <code class="filename">/etc/openvpn/</code>. Then customize it to your needs.
   </p><div class="example" id="ex-vpn-serv-config" data-id-title="VPN server configuration file"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 24.1: </span><span class="title-name">VPN server configuration file </span></span><a title="Permalink" class="permalink" href="#ex-vpn-serv-config">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"># /etc/openvpn/server.conf
port 1194 <span class="callout" id="co-vpn-servconfig-port">1</span>
proto udp <span class="callout" id="co-vpn-servconfig-proto">2</span>
dev tun0 <span class="callout" id="co-vpn-servconfig-dev">3</span>

# Security <span class="callout" id="co-vpn-servconfig-security">4</span>

ca    vpn_ca.pem
cert  server_crt.pem
key   server_key.pem

# ns-cert-type server 
remote-cert-tls client <span class="callout" id="co-vpn-servconfig-remote-cert-tls">5</span>
dh   server/dh2048.pem <span class="callout" id="co-vpn-servconfig-dh">6</span>

server 192.168.1.0 255.255.255.0 <span class="callout" id="co-vpn-servconfig-server">7</span>
ifconfig-pool-persist /var/run/openvpn/ipp.txt <span class="callout" id="co-vpn-servconfig-pool">8</span>

# Privileges <span class="callout" id="co-vpn-serverconf-privilege">9</span>
user nobody
group nobody

# Other configuration <span class="callout" id="co-vpn-servconfig-misc">10</span>
keepalive 10 120
comp-lzo
persist-key
persist-tun
# status      /var/log/openvpn-status.tun0.log <span class="callout" id="co-vpn-serverconfig-status">11</span>
# log-append  /var/log/openvpn-server.log <span class="callout" id="co-vpn-serverconfig-log-append">12</span>
verb 4</pre></div></div></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-servconfig-port"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      The TCP/UDP port on which OpenVPN listens. You need to open the port
      in the firewall, see <a class="xref" href="#cha-security-firewall" title="Chapter 23. Masquerading and firewalls">Chapter 23, <em>Masquerading and firewalls</em></a>. The
      standard port for VPN is 1194, so you can usually leave that as
      it is.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-servconfig-proto"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      The protocol, either UDP or TCP.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-servconfig-dev"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      The tun or tap device. For the difference between these, see
      <a class="xref" href="#sec-security-vpn-terminology" title="24.1.1. Terminology">Section 24.1.1, “Terminology”</a>.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-servconfig-security"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      The following lines contain the relative or absolute path to the root
      server CA certificate (<code class="literal">ca</code>), the root CA key
      (<code class="literal">cert</code>), and the private server key
      (<code class="literal">key</code>). These were generated in
      <a class="xref" href="#sec-security-vpn-certs" title="24.3.1. Creating certificates">Section 24.3.1, “Creating certificates”</a>.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-servconfig-remote-cert-tls"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p> Require that peer certificates have been signed with an
            explicit key usage and extended key usage based on RFC3280
            TLS rules. </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-servconfig-dh"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p> The Diffie-Hellman parameters. Create the required file with
            the following command: </p><div class="verbatim-wrap"><pre class="screen">openssl dhparam -out /etc/openvpn/dh2048.pem 2048</pre></div></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-servconfig-server"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Supplies a VPN subnet. The server can be reached by
      <code class="systemitem">192.168.1.1</code>.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-servconfig-pool"><span class="callout">8</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Records a mapping of clients and its virtual IP address in the given
      file. Useful when the server goes down and (after the restart) the
      clients get their previously assigned IP address.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-serverconf-privilege"><span class="callout">9</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      For security reasons, run the OpenVPN daemon with reduced privileges. To
      do so, specify that it should use the group and user
      <code class="systemitem">nobody</code>.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-servconfig-misc"><span class="callout">10</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p> Several configuration options—see the comment in the
            example configuration file:
              <code class="filename">/usr/share/doc/packages/openvpn/sample-config-files</code>. </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-serverconfig-status"><span class="callout">11</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      Enable this option to write short status updates with statistical data
      (<span class="quote">“<span class="quote">operational status dump</span>”</span>) to the named file.
      By default, this is not enabled.
     </p><p>
      All output is written to the system journal, which can be displayed with
      <code class="command">journalctl</code>. If you have more than one configuration
      file (for example, one for home and another for work), it is recommended
      to include the device name into the file name. This avoids overwriting
      output files accidentally. In this case, it is
      <code class="systemitem">tun0</code>, taken from the <code class="option">dev</code>
      directive—see <a class="xref" href="#co-vpn-servconfig-dev"><span class="callout">3</span></a>.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-serverconfig-log-append"><span class="callout">12</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      By default, log messages go to syslog. Overwrite this behavior by
      removing the hash character. In that case, all messages go to
      <code class="filename">/var/log/openvpn-server.log</code>. Do not forget to
      configure a logrotate service. See <code class="command">man 8 logrotate</code>
      for further details.
     </p></td></tr></table></div><p>
    After having completed this configuration, you can see log messages of
    your OpenVPN server under <code class="filename">/var/log/openvpn.log</code>.
    After having started it for the first time, it should finish with:
   </p><div class="verbatim-wrap"><pre class="screen">... Initialization Sequence Completed</pre></div><p>
    If you do not see this message, check the log carefully for any hints of
    what is wrong in your configuration file.
   </p></section><section class="sect2" id="sec-security-vpn-config-clients" data-id-title="Configuring the VPN clients"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">24.3.3 </span><span class="title-name">Configuring the VPN clients</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-config-clients">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As the basis of your configuration file, copy
    <code class="filename">/usr/share/doc/packages/openvpn/sample-config-files/client.conf</code>
    to <code class="filename">/etc/openvpn/</code>. Then customize it to your needs.
   </p><div class="example" id="id-1.7.6.6.5.7.3" data-id-title="VPN client configuration file"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 24.2: </span><span class="title-name">VPN client configuration file </span></span><a title="Permalink" class="permalink" href="#id-1.7.6.6.5.7.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"># /etc/openvpn/client.conf
client <span class="callout" id="co-vpn-clientconf-client">1</span>
dev tun <span class="callout" id="co-vpn-clientconf-dev">2</span>
proto udp <span class="callout" id="co-vpn-clientconf-proto">3</span>
remote <em class="replaceable">IP_OR_HOST_NAME</em> 1194 <span class="callout" id="co-vpn-clientconf-remote">4</span>
resolv-retry infinite
nobind

remote-cert-tls server <span class="callout" id="co-vpn-clientconf-remote-cert-tls">5</span>

# Privileges <span class="callout" id="co-vpn-clientconf-privileges">6</span>
user nobody
group nobody

# Try to preserve some state across restarts.
persist-key
persist-tun

# Security <span class="callout" id="co-vpn-clientconf-security">7</span>
pkcs12 client1.p12

comp-lzo <span class="callout" id="co-vpn-clientconf-compr">8</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-clientconf-client"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Specifies that this machine is a client.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-clientconf-dev"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The network device. Both clients and server must use the same device.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-clientconf-proto"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The protocol. Use the same settings as on the server.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-clientconf-remote-cert-tls"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       This is security option for clients which ensures that the host
       they connect to is a designated server.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-clientconf-remote"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Replace the placeholder <em class="replaceable">IP_OR_HOST_NAME</em>
       with the respective host name or IP address of your VPN server. After
       the host name, the port of the server is given. You can have multiple
       lines of <code class="literal">remote</code> entries pointing to different VPN
       servers. This is useful for load balancing between different VPN
       servers.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-clientconf-privileges"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       For security reasons, run the OpenVPN daemon with reduced privileges. To
       do so, specify that it should use the group and user
       <code class="systemitem">nobody</code>.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-clientconf-security"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Contains the client files. For security reasons, use a separate pair of
       files for each client.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-vpn-clientconf-compr"><span class="callout">8</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Turn on compression. Only use this parameter if compression is enabled
       on the server as well.
      </p></td></tr></table></div></div></div></section></section><section class="sect1" id="sec-security-vpn-moreinfo" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">24.4 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-security-vpn-moreinfo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_vpnserver.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For more information on setting up a VPN connection using NetworkManager, see
   <span class="intraxref">Book “Administration Guide”, Chapter 31 “Using NetworkManager”, Section 31.3.5 “NetworkManager and VPN”</span>.
  </p><p>
   For more information about VPN in general, see:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <a class="link" href="https://openvpn.net" target="_blank">https://openvpn.net</a>: the OpenVPN home page
    </p></li><li class="listitem"><p>
     <code class="command">man</code> <code class="option">openvpn</code>
    </p></li><li class="listitem"><p>
     <code class="filename">/usr/share/doc/packages/openvpn/sample-config-files/</code>:
     example configuration files for different scenarios.
    </p></li><li class="listitem"><p>
     <code class="filename">/usr/src/linux/Documentation/networking/tuntap.txt</code>,
     to install the <code class="systemitem">kernel-source</code>
     package.
    </p></li></ul></div></section></section><section class="chapter" id="cha-security-xca" data-id-title="Managing a PKI with XCA, X certificate and key manager"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">25 </span><span class="title-name">Managing a PKI with XCA, X certificate and key manager</span></span> <a title="Permalink" class="permalink" href="#cha-security-xca">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_xca.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
        Managing your own public key infrastructure (PKI) is traditionally
        done with the <code class="command">openssl</code> utility. For admins who
        prefer a graphical tool, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP4</span></span> includes XCA,
        the X Certificate and Key management tool
        (<a class="link" href="http://hohnstaedt.de/xca" target="_blank">http://hohnstaedt.de/xca</a>).
      </p><p>
        XCA creates and manages X.509 certificates, certificate requests,
        RSA, DSA, and EC private keys, Smartcards, and certificate revocation
        lists (CRLs). XCA supports everything you need to create and manage
        your own certificate authority (CA). XCA includes customizable
        templates that can be used for certificate or request generation.
        This chapter describes a basic setup.
      </p></div></div></div></div><section class="sect1" id="sec-security-xca-install" data-id-title="Installing XCA"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">25.1 </span><span class="title-name">Installing XCA</span></span> <a title="Permalink" class="permalink" href="#sec-security-xca-install">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_xca.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    XCA is provided by the <span class="package">xca</span> package:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper in xca</pre></div></section><section class="sect1" id="sec-security-xca-start" data-id-title="Creating a new PKI"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">25.2 </span><span class="title-name">Creating a new PKI</span></span> <a title="Permalink" class="permalink" href="#sec-security-xca-start">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_xca.xml" title="Edit source document"> </a></div></div></div></div></div><p>XCA stores all cryptographic data in a database. When you are using
    XCA for the first time, and creating a new PKI, you must first create a
    new database by clicking <span class="guimenu">File &gt; New DataBase</span>
      (<a class="xref" href="#fig-xca-newdb" title="Create a new XCA database">Figure 25.1, “Create a new XCA database”</a>).
  </p><div class="figure" id="fig-xca-newdb"><div class="figure-contents"><div class="mediaobject"><a href="images/sec-xca-2.png"><img src="images/sec-xca-2.png" width="80%" alt="Create a new XCA database" title="Create a new XCA database"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 25.1: </span><span class="title-name">Create a new XCA database </span></span><a title="Permalink" class="permalink" href="#fig-xca-newdb">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_xca.xml" title="Edit source document"> </a></div></div></div><section class="sect2" id="sec-security-root-ca" data-id-title="Creating a new root CA"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">25.2.1 </span><span class="title-name">Creating a new root CA</span></span> <a title="Permalink" class="permalink" href="#sec-security-root-ca">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_xca.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following steps describe how to create a new root CA.
 </p><div class="procedure" id="pro-create-root-ca"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Click the <span class="guimenu">Certificates</span> tab.
   </p></li><li class="step"><p>
     Click the <span class="guimenu">New Certificate</span> button.
   </p></li><li class="step"><p>
     Click the <span class="guimenu">Source</span> tab. At the bottom of the window,
     under <span class="guimenu">Template for the new certificate</span>, select the
     <span class="guimenu">default] CA</span> template, then click
     <span class="guimenu">Apply all</span>.
   </p></li><li class="step"><p>
     Click the <span class="guimenu">Subject</span> tab.
     Create an <span class="guimenu">Internal Name</span>, which identifies your new
     root CA internally, in XCA only.
   </p><p>
      Complete the fields in the <span class="guimenu">Distinguished Name</span>
      section. Use the <span class="guimenu">Add</span> button to add any additional
      elements, if you require any.
    </p></li><li class="step"><p>
      In the <span class="guimenu">Private key</span> drop-down, select your preferred
      private key if you have one, or generate a new key.
    </p></li><li class="step"><p>
      Click the <span class="guimenu">Extensions</span> tab. Edit any attributes as
      necessary. The default <span class="guimenu">Time Range</span> is 10 years.
      The certificate revocation list distribution point will be part of the
      issued certificates, and it is a good practice to use a common URL for
      all of your certificates, for example
      <em class="replaceable">http://www.example.com/crl/crl.der</em>. When you are
      finished click the <span class="guimenu">OK</span> button.
    </p></li></ol></div></div></section><section class="sect2" id="sec-security-signed-host-cert" data-id-title="Creating a signed host certificate"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">25.2.2 </span><span class="title-name">Creating a signed host certificate</span></span> <a title="Permalink" class="permalink" href="#sec-security-signed-host-cert">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_xca.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The next step is to create a host certificate signed by your new
    certificate authority.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
        Click the <span class="guimenu">Certificates</span> tab, then click the
        <span class="guimenu">New Certificate</span> button.
      </p></li><li class="step"><p>
        On the <span class="guimenu">Source</span> tab, select the
        <span class="guimenu">default] TLS_server</span> and click the
        <span class="guimenu">Apply all</span> button. This enters the appropriate
        values in the <span class="guimenu">Extensions</span>,
        <span class="guimenu">Key usage</span>, and <span class="guimenu">Netscape</span> tabs.
        In the <span class="guimenu">Signing</span> section, select the certificate that you created in <a class="xref" href="#sec-security-root-ca" title="25.2.1. Creating a new root CA">Section 25.2.1, “Creating a new root CA”</a>.
      </p></li><li class="step"><p>
        Click the <span class="guimenu">Subject</span> tab. Create an internal name,
        which is for display purposes in XCA. A good practice is to
        use the host name, or the fully-qualified domain name. Then fill in
        the fields in the <span class="guimenu">Distinguished Name</span>
        section. For host certificates, the common name must be the FQDN that
        your users will use. This can be the canonical name of the host, or
        an alias. For example, if jupiter.example.com is your web server and it has a
        DNS CNAME entry of www.example.com, then you probably want the
        <span class="guimenu">commonName</span> value in the certificate to be www.example.com. If you want to add in any additional parts to the
        distinguished name, use the drop-down box and Add button.
        Select the desired private key or generate a new one.
      </p></li><li class="step"><p>
        Click the <span class="guimenu">Extensions</span> tab. The default
        <span class="guimenu">Time range</span> is one year. If you change this, click the <span class="guimenu">Apply</span> button.
      </p></li><li class="step"><p>
        It is a good practice to designate a certificate revocation list
        location. The location must be unique for this root certificate. XCA
        exports CRLs in either PEM or DER format with appropriate suffixes, so this should be considered when selecting the URL, for example something like
        <em class="replaceable">http://www.example.com/crl/crl.der</em>. On the
        <span class="guimenu">CRL Distribution points</span> line click the
        <span class="guimenu">Edit</span> button. Type in your URI, then click
        <span class="guimenu">Add</span>. Click <span class="guimenu">Validate</span> and
        <span class="guimenu">Apply</span>.
      </p><p>
        Click the <span class="guimenu">OK</span> button.
      </p></li></ol></div></div></section><section class="sect2" id="sec-security-revoke-cert" data-id-title="Revoking a Certificate"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">25.2.3 </span><span class="title-name">Revoking a Certificate</span></span> <a title="Permalink" class="permalink" href="#sec-security-revoke-cert">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_xca.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
          Click the <span class="guimenu">Certificates</span> tab.
        </p></li><li class="step"><p>
          Right-click on the certificate that you want to revoke, then click
          <span class="guimenu">Revoke</span>.
        </p></li><li class="step"><p>
          Right-click the CA certificate that signed the certificate you want
          to revoke. Click <span class="guimenu">CA &gt; Generate CRL</span>.
        </p><p>
          Click the <span class="guimenu">OK</span> button in the <span class="guimenu">Create CRL</span> dialog.
        </p></li><li class="step"><p>
          Click on the <span class="guimenu">Revocation lists</span> tab in the main
          window. Right-click on the CRL you just generated and select
          <span class="guimenu">Expor</span>t. Select the desired format (probably DER)
          and click <span class="guimenu">OK</span>.
        </p><p>
          Copy the exported CRL to the location published in the issued certificate's <span class="guimenu">CRL Distribution Points</span>.
        </p></li></ol></div></div></section></section></section><section class="chapter" id="cha-sec-sysctl" data-id-title="Improving network security with sysctl variables"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">26 </span><span class="title-name">Improving network security with <code class="command">sysctl</code> variables</span></span> <a title="Permalink" class="permalink" href="#cha-sec-sysctl">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_sysctl.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Sysctl (system control) variables control certain kernel parameters that
  influence the behavior of different parts of the operating system, for example
  the Linux network stack. These parameters can be looked up in the
  <code class="literal">proc</code> file system, in <code class="filename">/proc/sys</code>. Many
  kernel parameters can be changed directly by writing a new value into a
  parameter pseudo file. However, these changes are not persisted and are lost
  after a system reboot. Therefore, we recommend configuring all changes in
  a sysctl configuration file to have them applied at every system start.
 </p><p>
  In this chapter, a number of networking related variables will be configured
  that improve the security features of Linux. Depending on the presence of a
  firewall and its settings, some of the variables listed here will already
  have the safe values by default. You can check the current value of a setting
  by using the <code class="command">sysctl</code> utility like this:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>/sbin/sysctl net.ipv4.conf.all.rp_filter
net.ipv4.conf.all.rp_filter = 2</pre></div><p>
  To apply the following settings, create a configuration file
  <code class="filename">/etc/sysctl.d/</code>. The file needs to end with a
  <code class="filename">.conf</code> suffix, for example
  <code class="filename">/etc/sysctl.d/network.conf</code>. For details, refer to
  <code class="command">man 5 sysctl.d</code>.
 </p><p>
  Set the variables from the following list as appropriate for your environment.
 </p><div class="itemizedlist" id="il-security-sysctl"><ul class="itemizedlist"><li class="listitem"><div class="verbatim-wrap"><pre class="screen"># the default setting for this is 2 (loose mode)
net.ipv4.conf.default.rp_filter = 1
net.ipv4.conf.all.rp_filter = 1</pre></div><p>
    This setting enables the IPv4 reverse path filter in strict mode. It ensures
    that answers to incoming IP packets are always sent out via the interface
    from that the packets have been received. If the system would direct answer
    packets to a different outgoing interface according to the routing table,
    these packets would be discarded. The setting prevents certain kinds of
    IP spoofing attacks that are, for example, used for distributed denial-of-service
    (DDoS) attacks.
   </p></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen"># the default setting for this should already be 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv4.conf.all.accept_source_route = 0</pre></div><p>
    This setting disables the acceptance of packets with the
    <code class="option">SSR</code> option set in the IPv4 packet header. Packets that use
    <span class="emphasis"><em>Source Routing</em></span> will be rejected. This prevents IP
    packet redirection, that is redirection to a host behind a firewall, that is
    not directly reachable otherwise.
   </p></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen"># the default setting for this should already be 1
net.ipv4.tcp_syncookies = 1</pre></div><p>
    This enables TCP SYN Cookie Protection for IPv4 <span class="emphasis"><em>and</em></span>
    IPv6. It addresses a specific denial-of-service attack on the TCP protocol
    level. The protection involves a small CPU trade-off in favor of avoiding
    memory exhaustion caused by attackers. The protection mechanism consists of
    a fallback algorithm that only comes into play when no further TCP
    connections can be accepted the normal way. The mechanism is not fully TCP
    protocol compliant and can thus cause protocol issues in some TCP contexts.
    The alternative would be to drop additional connections completely in
    overload scenarios. This also needs a differentiation between legitimate
    high TCP load and a TCP denial-of-service attack. If you expect a high load
    of TCP connections on your system, then this setting could be
    counterproductive.
   </p></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen"># default is 128
net.ipv4.tcp_max_syn_backlog = 4096</pre></div><p>
    The TCP SYN backlog defines the number of SYN packets that are queued for
    further processing. Once the queue limit is exceeded, all new incoming
    SYN-packets are dropped and new TCP connections will not be possible (or the
    SYN cookie protection kicks in). Increasing this value improves the
    protection against TCP SYN flood attacks.
   </p></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen"># the default setting for this should already be 1
net.ipv4.icmp_echo_ignore_broadcasts = 1</pre></div><p>
    ICMP echo requests (ping) can be sent to an IPv4 broadcast address in order
    to scan a network for existing hosts / IP addresses or to perform an ICMP
    flood within a network segment. This setting causes the networking stack to
    ignore ICMP echo packets sent to a broadcast address.
   </p></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen"># the default setting for this should already be 1
net.ipv4.icmp_ignore_bogus_error_responses = 1</pre></div><p>
    This setting avoids filling up log files with unnecessary error messages
    coming from invalid responses to broadcast frames. Refer to <a class="link" href="https://datatracker.ietf.org/doc/html/rfc1122#section-3.2.2" target="_blank">RFC
     1122 <em class="citetitle">Requirements for Internet Hosts -- Communication
      Layers</em> Section 3.2.2</a> for more information.
   </p></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen"># default should already be 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0
net.ipv6.conf.all.accept_redirects = 0</pre></div><p>
    Disables the acceptance of ICMP redirect messages. These messages are
    usually sent by gateways to inform a host about a better route to an outside
    network. These redirects can be misused for man-in-the-middle attacks.
   </p></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen">net.ipv4.conf.default.secure_redirects = 0
net.ipv4.conf.all.secure_redirects = 0</pre></div><p>
    Accepting 'secure' ICMP redirects (from those gateways listed as default
    gateways) has few legitimate uses. It should be disabled unless it is
    absolutely required.
   </p></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen">net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.all.send_redirects = 0</pre></div><p>
    A node should not send out IPv4 ICMP redirects, unless it acts as a router.
   </p></li><li class="listitem"><div class="verbatim-wrap"><pre class="screen"># default should already be 0
net.ipv4.ip_forward = 0
net.ipv6.conf.all.forwarding = 0
net.ipv6.conf.default.forwarding = 0</pre></div><p>
    IP forwarding should only be enabled on systems acting as routers.
   </p></li></ul></div></section></div><div class="part" id="part-compliance" data-id-title="Regulations and Compliance"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part IV </span><span class="title-name">Regulations and Compliance </span></span><a title="Permalink" class="permalink" href="#part-compliance">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_security.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-common-criteria"><span class="title-number">27 </span><span class="title-name">Common Criteria</span></a></span></li><dd class="toc-abstract"><p>Common Criteria is the best known and most widely used methodology to evaluate and measure the security value of an IT product. The methodology aims to be independent, as an independent laboratory conducts the evaluation, which a certification body will certify afterward. Security Functional Require…</p></dd><li><span class="chapter"><a href="#cha-security-fips"><span class="title-number">28 </span><span class="title-name">Enabling compliance with FIPS 140-3</span></a></span></li><dd class="toc-abstract"><p>FIPS 140-3 is a security accreditation program for validating cryptographic modules
        produced by private companies. The Federal Information Processing Standards (FIPS) Publication 140
        is a series of computer security standards developed by the National Institute of Standards and Technology (NIST)
        to ensure the quality of cryptographic modules.</p><p>
        If your organization does any work for the United States federal
        government, it is likely that your cryptography applications (such as
        openSSL, GnuTLS, and OpenJDK) will be required to be in compliance with
        Federal Information Processing Standards (FIPS) 140-3. If your organization is not required by
        compliance rules to run SUSE Linux Enterprise in FIPS mode, it is most likely best to
        not do it. This chapter provides guidance on enabling FIPS mode, and
        links to resources with detailed information.
      </p></dd></ul></div><section class="chapter" id="cha-common-criteria" data-id-title="Common Criteria"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">27 </span><span class="title-name">Common Criteria</span></span> <a title="Permalink" class="permalink" href="#cha-common-criteria">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_criteria.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Common Criteria is the best known and most widely used methodology to
    evaluate and measure the security value of an IT product. The methodology
    aims to be independent, as an independent laboratory conducts the
    evaluation, which a certification body will certify afterward. Security
    Functional Requirements (SFR) are summarized in so-called Protection
    Profiles (PP). If the definition of a Security Target (ST) and the
    Evaluation Assurance Levels (EAL) are comparable, this allows the comparison of
    security functions of different products. (The definition of a Security Target
    typically references the PP—if one exists that fits the purpose
    of the product.)
   </p><section class="sect1" id="sec-common-criteria-introduction" data-id-title="Introduction"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.1 </span><span class="title-name">Introduction</span></span> <a title="Permalink" class="permalink" href="#sec-common-criteria-introduction">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_criteria.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A clear definition of security in IT products is challenging. Security
    should be considered a process that never ends, not a static condition
    that can be met or not. A Common Criteria certificate (below EAL7) does not
    make a clear statement about the error-proneness of the system, but it adds
    an important value to the product that
    cannot be described with the presence of technology alone: That someone
    has independently inspected the design of the system in such a way that it
    corresponds to the claims that are made, and that explicit care has been
    taken in producing and maintaining the product.
   </p><p>
    The certificate states a degree of maturity of both the product with its
    security functions and the processes of the company that designed,
    built, and engineered the product, and that will maintain the product
    across its lifecycle. As such, Common Criteria aims to be fairly holistic
    with its approach to take everything into account that is relevant for the
    security of an IT product.
   </p></section><section class="sect1" id="sec-common-criteria-eal" data-id-title="Evaluation Assurance Level (EAL)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.2 </span><span class="title-name">Evaluation Assurance Level (EAL)</span></span> <a title="Permalink" class="permalink" href="#sec-common-criteria-eal">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_criteria.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The Evaluation Assurance Level denotes the degree of confidence
    that the product fulfills the described claims. The levels are from 1
    through 7:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      EAL1: Functionally tested
     </p></li><li class="listitem"><p>
      EAL2: Structurally tested
     </p></li><li class="listitem"><p>
      EAL3: Methodically tested and checked
     </p></li><li class="listitem"><p>
      EAL4: Methodically designed, tested and reviewed
     </p></li><li class="listitem"><p>
      EAL5: Semi-formally designed and tested
     </p></li><li class="listitem"><p>
      EAL6: Semi-formally verified design and tested
     </p></li><li class="listitem"><p>
      EAL7: Formally verified design and tested
     </p></li></ul></div><p>
    While EAL1 only provides basic assurance for products to meet security
    requirements, EAL2 to EAL4 are medium assurance levels. EAL5 to EAL7 describe
    medium-to-high and high assurance. EAL4 is expected to be the highest
    level of assurance that a product can have, if it has not been designed
    from the start to achieve a higher level of assurance.
   </p></section><section class="sect1" id="sec-common-criteria-principles" data-id-title="Generic guiding principles"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.3 </span><span class="title-name">Generic guiding principles</span></span> <a title="Permalink" class="permalink" href="#sec-common-criteria-principles">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_criteria.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Much of the advice in this guide is based on the following guidelines.
   Consider them when defining your own security processes or deciding about
   configurations that are not explicitly covered here.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.7.2.6.3.1"><span class="term">Use data encryption whenever possible</span></dt><dd><p>
       Be aware that cryptography is certainly useful, but only for the
       specific purposes that it is good for. Using cryptography is not a generic recipe for
       better security in a system; its use may even impose additional risk on
       the system. Make informed decisions about the use of cryptography, and
       feel obliged to have a reason for your decisions. A false sense of security can be more
       harmful than the weakness itself.
      </p><p>
       <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> supports encryption for:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Network connections (the
         <code class="command">openssl</code> command,
         <code class="command">stunnel</code>), for remote login
         (<code class="command">openssh</code>, <code class="command">man ssh(1)</code>)
        </p></li><li class="listitem"><p>
         Files (<code class="command">gpg</code>)
        </p></li><li class="listitem"><p>
         Entire file systems at block layer
         (<code class="literal">dm-crypt</code>, <code class="command">cryptsetup</code>)
        </p></li><li class="listitem"><p>
         VPN (<code class="command">ipsec</code>, <code class="command">openvpn</code>)
        </p></li></ul></div></dd><dt id="id-1.7.7.2.6.3.2"><span class="term">Minimal package installation</span></dt><dd><p>
       It is useful to restrict the installed packages in your system
       to a minimum. Binaries not installed cannot be executed.
      </p><p>
       During installation of the system, you can limit the set of packages that
       is installed. For example, you can deselect all packages and select only
       those that you want to use. For example, the selection of the
       <code class="systemitem">apache2-mod_perl</code>
       package in YaST would automatically cause all packages to be selected
       for installation that are needed for the Apache package to operate.
       Dependencies have often been artificially cut down to handle the system's
       dependency tree more flexibly. You can choose the minimal system, and
       build the dependency tree from there with your (leaf) package selection.
      </p></dd><dt id="id-1.7.7.2.6.3.3"><span class="term">Service isolation—run different services on separate
     systems</span></dt><dd><p>
       Whenever possible, a server should be dedicated to serving exactly one
       service or application. This limits the number of other services that
       could be compromised if an attacker can successfully exploit
       a software flaw in one service (assuming that flaw allows access to
       others).
      </p><p>
       The use of AppArmor for services that are provided on a system is an
       effective means of containment. For more information, see
       <a class="xref" href="#part-apparmor" title="Part V. Confining privileges with AppArmor">Part V, “Confining privileges with <span class="phrase">AppArmor</span>”</a> and the man page of
       <code class="command">apparmor</code>.
      </p><p>
       The use of virtualization technology is supported with <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>.
       While virtualization is generally designed for server consolidation purposes,
       it is also useful for service isolation. However, virtualization
       technology <span class="emphasis"><em>cannot</em></span> match or substitute the separation
       strength that is given by running services on different physical
       machines! Be aware that the capability of the hypervisor to separate
       virtual machines is not higher or stronger than the Linux kernel's
       capability to separate processes and their address spaces.
      </p></dd><dt id="id-1.7.7.2.6.3.4"><span class="term">
      System fingerprinting and backups
     </span></dt><dd><p>
       Doing regular backups and having a fingerprint of your system is vital,
       especially in the case of a successful attack against your system.
       Make it an integral part of your security routine to verify that your
       backups work.
      </p><p>
       A fast and directly accessible backup adds confidence about
       the integrity of your system. However, it is important that the backup
       mechanism/solution has adequate versioning support so that you can
       trace changes in the system. As an example: The installation times of
       packages (<code class="command">rpm</code> <code class="option">-q</code>
       <code class="option">--queryformat='%{INSTALLTIME} %{NAME}\n'</code>
       <em class="replaceable">PACKAGE NAME</em>) must correspond to the changed
       files in the backup log files.
      </p><p>
       Several tools exist on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP4</span></span> that can be
       used for the detection of unknown, yet successful attacks. It does not
       take much effort to configure them.
      </p><p>
       In particular, we recommend using the file and directory integrity checker
       <code class="systemitem">AIDE</code> (Advanced Intrusion Detection Environment).
       When run for initialization, it creates a hash database of all files in the system, which
       are listed in its configuration file. This allows verifying the integrity
       of all cataloged files at a later time.
      </p><div id="id-1.7.7.2.6.3.4.2.5" data-id-title="Backdoors" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Backdoors</div><p>
        If you use AIDE, copy the hash database to a place that
        is inaccessible for potential attackers. Otherwise, the attacker may
        modify the integrity database after planting a backdoor, thereby
        defeating the purpose of the integrity measurement.
       </p><p>
        An attacker may also have planted a backdoor in the kernel. Apart from
        being very hard to detect,
        the kernel-based backdoor can effectively remove all traces of the
        system compromise, so system alterations become almost invisible.
        Consequently, an integrity check needs to be done from a
        rescue system (or any other independent system with the target system's
        file systems mounted manually).
       </p></div><p>
        Be aware that the application of security updates invalidates the integrity
        database. <code class="command">rpm</code> <code class="option">-qlv packagename</code>
        lists the files that are contained in a package. The RPM subsystem is
        very powerful with the data it maintains. It is accessible with the
        <code class="option">--queryformat</code> command line option. A differential
        update of the integrity database with the changed files becomes more
        manageable with some fine-grained usage of RPM.
       </p></dd></dl></div></section><section class="sect1" id="sec-common-criteria-more" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">27.4 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-common-criteria-more">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_criteria.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The Common Criteria evaluations inspect a specific configuration of the
    product in an evaluated setup. How to install and configure the reference
    system that was used as baseline in the Common Criteria evaluation
    is documented in the <span class="quote">“<span class="quote">Administrator's Guide</span>”</span> part of
    the Common Criteria evaluation documentation.
   </p><p>
    However, it would be incorrect to understand the evaluated configuration as
    a <span class="emphasis"><em>hardened</em></span> configuration. The removal of setuid bits
    and the prescription of administrative procedures after installation help to
    reach a specific configuration that is sane. But this is not sufficient
    for a hardening claim.
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      For more information about <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> security certifications and
      features, see <a class="link" href="https://www.suse.com/support/security/certifications/" target="_blank">https://www.suse.com/support/security/certifications/</a>.
     </p></li><li class="listitem"><p>
    Find a list of SUSE security resources at
    <a class="link" href="https://www.suse.com/support/security/" target="_blank">https://www.suse.com/support/security/</a>.
    </p></li><li class="listitem"><p>
    Apart from the documentation that comes with the Common Criteria
    effort, see also the following manual pages:
    </p><table style="border: 0; " class="simplelist"><tr><td>pam(8), pam(5)</td></tr><tr><td>apparmor(7) and referenced man pages</td></tr><tr><td>rsyslogd(8), syslog(8), syslogd(8)</td></tr><tr><td>fstab(5), mount(8), losetup(8), cryptsetup(8)</td></tr><tr><td>haveged(8), random(4)</td></tr><tr><td>ssh(1), sshd(8), ssh_config(5), sshd_config(5), ssh-agent(1),
     ssh-add(1), ssh-keygen(1)</td></tr><tr><td>cron(1), crontab(5), at(1), atd(8)</td></tr><tr><td>systemctl(1), daemon(7), systemd.unit(5), systemd.special(5),
             kernel-command-line(7), bootup(7), systemd.directives</td></tr></table></li></ul></div></section></section><section class="chapter" id="cha-security-fips" data-id-title="Enabling compliance with FIPS 140-3"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">28 </span><span class="title-name">Enabling compliance with FIPS 140-3</span></span> <a title="Permalink" class="permalink" href="#cha-security-fips">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_fips.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>FIPS 140-3 is a security accreditation program for validating cryptographic modules
        produced by private companies. The Federal Information Processing Standards (FIPS) Publication 140
        is a series of computer security standards developed by the National Institute of Standards and Technology (NIST)
        to ensure the quality of cryptographic modules.</p><p>
        If your organization does any work for the United States federal
        government, it is likely that your cryptography applications (such as
        openSSL, GnuTLS, and OpenJDK) will be required to be in compliance with
        Federal Information Processing Standards (FIPS) 140-3. If your organization is not required by
        compliance rules to run SUSE Linux Enterprise in FIPS mode, it is most likely best to
        not do it. This chapter provides guidance on enabling FIPS mode, and
        links to resources with detailed information.
      </p></div></div></div></div><div id="id-1.7.7.3.3" data-id-title="SUSE Linux Enterprise Desktop and FIPS 140-3" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>  and FIPS 140-3</div><p>
      The relevant binaries are currently undergoing FIPS 140-3 certification.
      Until the certification has been achieved, full FIPS 140-3 compliance cannot be guaranteed.
    </p></div><section class="sect1" id="sec-fips-concept" data-id-title="FIPS overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.1 </span><span class="title-name">FIPS overview</span></span> <a title="Permalink" class="permalink" href="#sec-fips-concept">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_fips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Every vendor that develops and maintains cryptographic applications and
      wants them to be tested for FIPS compliance must submit them to the
      Cryptographic Module Validation Program (CMVP) (see
      <a class="link" href="https://csrc.nist.gov/projects/cryptographic-module-validation-program" target="_blank">https://csrc.nist.gov/projects/cryptographic-module-validation-program</a>).
    </p><p>
      The latest FIPS 140-3 standard was approved in March 2019 and
      replaces 140-2.
    </p></section><section class="sect1" id="sec-fips-use-case" data-id-title="When to enable FIPS mode"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.2 </span><span class="title-name">When to enable FIPS mode</span></span> <a title="Permalink" class="permalink" href="#sec-fips-use-case">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_fips.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.7.3.5.2" data-id-title="FIPS requires expertise" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: FIPS requires expertise</div><p>
        Administering FIPS is complex and requires significant expertise.
        Implementing it correctly, testing and troubleshooting all require a
        high degree of knowledge.
      </p></div><p>
      Only run your <span class="productname"><span class="phrase">SLED</span></span> in FIPS mode when it is required to meet
      compliance rules. Otherwise, we do not recommend running your systems in
      FIPS mode.
    </p><p>
      Below are some reasons to <span class="emphasis"><em>not</em></span> use FIPS mode (if not
      required explicitly):
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          FIPS is restrictive. It enforces the use of specific validated
          cryptographic algorithms and specific certified binaries that
          implement these validated algorithms. You must use only the certified
          binaries.
        </p></li><li class="listitem"><p>
          Upgrades may break functionality.
        </p></li><li class="listitem"><p>
          The approval process is very long, so certified binaries are always
          several releases behind the newest release.
        </p></li><li class="listitem"><p>
          Certified binaries, such as ssh, sshd and sftp-server, run their own
          self-checks at start-up and run only when these checks succeed. This
          creates a small performance degradation.
        </p></li><li class="listitem"><p>
          Administering FIPS is complex and requires significant expertise.
        </p></li></ul></div></section><section class="sect1" id="sec-fips-samba-cifs" data-id-title="MD5 not supported in Samba/CIFS"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.3 </span><span class="title-name">MD5 not supported in Samba/CIFS</span></span> <a title="Permalink" class="permalink" href="#sec-fips-samba-cifs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_fips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      According to the FIPS standards, MD5 is not a secure hashing algorithm,
      and it must not be used for authentication. If you run a FIPS-compliant
      network environment, and you have clients or servers that run in
      FIPS-compliant mode, you must use a Kerberos service for authenticating
      Samba/CIFS users. This is necessary as all other Samba authentication
      modes include MD5.
    </p></section><section class="sect1" id="sec-fips-more" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.4 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-fips-more">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_fips.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     For more information, refer to:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       Man 8 <code class="literal">fips-mode-setup</code>
      </p></li><li class="listitem"><p>
        Man 8 <code class="literal">fips-finish-install</code>
      </p></li><li class="listitem"><p>
        Man 7 <code class="literal">crypto-policies</code>
      </p></li><li class="listitem"><p>
        Man 8 <code class="literal">update-crypto-policies</code>
      </p></li></ul></div></section></section></div><div class="part" id="part-apparmor" data-id-title="Confining privileges with AppArmor"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part V </span><span class="title-name">Confining privileges with <span class="phrase">AppArmor</span> </span></span><a title="Permalink" class="permalink" href="#part-apparmor">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_security.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-apparmor-intro"><span class="title-number">29 </span><span class="title-name">Introducing <span class="phrase">AppArmor</span></span></a></span></li><dd class="toc-abstract"><p>
  Many security vulnerabilities result from bugs in
  <span class="emphasis"><em>trusted</em></span> programs. A trusted program runs with
  privileges that attackers want to possess. The program fails to keep that
  trust if there is a bug in the program that allows the attacker to acquire
  said privilege.
 </p></dd><li><span class="chapter"><a href="#cha-apparmor-start"><span class="title-number">30 </span><span class="title-name">Getting started</span></a></span></li><dd class="toc-abstract"><p>
  Prepare a successful deployment of <span class="phrase">AppArmor</span> on your system by carefully
  considering the following items:
 </p></dd><li><span class="chapter"><a href="#cha-apparmor-concept"><span class="title-number">31 </span><span class="title-name">Immunizing programs</span></a></span></li><dd class="toc-abstract"><p>Effective hardening of a computer system requires minimizing the number of programs that mediate privilege, then securing the programs as much as possible. With AppArmor, you only need to profile the programs that are exposed to attack in your environment, which drastically reduces the amount of wor…</p></dd><li><span class="chapter"><a href="#cha-apparmor-profiles"><span class="title-number">32 </span><span class="title-name">Profile components and syntax</span></a></span></li><dd class="toc-abstract"><p>Building AppArmor profiles to confine an application is very straightforward and intuitive. AppArmor ships with several tools that assist in profile creation. It does not require you to do any programming or script handling. The only task that is required of the administrator is to determine a polic…</p></dd><li><span class="chapter"><a href="#cha-apparmor-repos"><span class="title-number">33 </span><span class="title-name"><span class="phrase">AppArmor</span> profile repositories</span></a></span></li><dd class="toc-abstract"><p>AppArmor ships with a set of profiles enabled by default. These are created by the AppArmor developers, and are stored in /etc/apparmor.d. In addition to these profiles, SUSE Linux Enterprise Desktop ships profiles for individual applications together with the relevant application. These profiles ar…</p></dd><li><span class="chapter"><a href="#cha-apparmor-yast"><span class="title-number">34 </span><span class="title-name">Building and managing profiles with YaST</span></a></span></li><dd class="toc-abstract"><p>YaST provides a basic way to build profiles and manage AppArmor® profiles. It provides two interfaces: a graphical one and a text-based one. The text-based interface consumes less resources and bandwidth, making it a better choice for remote administration, or for times when a local graphical enviro…</p></dd><li><span class="chapter"><a href="#cha-apparmor-commandline"><span class="title-number">35 </span><span class="title-name">Building profiles from the command line</span></a></span></li><dd class="toc-abstract"><p>
  <span class="phrase">AppArmor®</span> provides the user the ability to use a command line interface
  rather than a graphical interface to manage and configure the system
  security. Track the status of <span class="phrase">AppArmor</span> and create, delete, or modify
  <span class="phrase">AppArmor</span> profiles using the <span class="phrase">AppArmor</span> command line tools.
 </p></dd><li><span class="chapter"><a href="#cha-apparmor-hat"><span class="title-number">36 </span><span class="title-name">Profiling your Web applications using ChangeHat</span></a></span></li><dd class="toc-abstract"><p>An AppArmor® profile represents the security policy for an individual program instance or process. It applies to an executable program, but if a portion of the program needs different access permissions than other portions, the program can “change hats” to use a different security context, distincti…</p></dd><li><span class="chapter"><a href="#cha-apparmor-pam"><span class="title-number">37 </span><span class="title-name">Confining users with <code class="systemitem">pam_apparmor</code></span></a></span></li><dd class="toc-abstract"><p>An AppArmor profile applies to an executable program; if a portion of the program needs different access permissions than other portions need, the program can change hats via change_hat to a different role, also known as a subprofile. The pam_apparmor PAM module allows applications to confine authen…</p></dd><li><span class="chapter"><a href="#cha-apparmor-managing"><span class="title-number">38 </span><span class="title-name">Managing profiled applications</span></a></span></li><dd class="toc-abstract"><p>After creating profiles and immunizing your applications, SUSE® Linux Enterprise Desktop becomes more efficient and better protected as long as you perform AppArmor® profile maintenance (which involves analyzing log files, refining your profiles, backing up your set of profiles and keeping it up-to-…</p></dd><li><span class="chapter"><a href="#cha-apparmor-support"><span class="title-number">39 </span><span class="title-name">Support</span></a></span></li><dd class="toc-abstract"><p>This chapter outlines maintenance-related tasks. Learn how to update AppArmor® and get a list of available man pages providing basic help for using the command line tools provided by AppArmor. Use the troubleshooting section to learn about some common problems encountered with AppArmor and their sol…</p></dd><li><span class="chapter"><a href="#cha-apparmor-glossary"><span class="title-number">40 </span><span class="title-name"><span class="phrase">AppArmor</span> glossary</span></a></span></li><dd class="toc-abstract"><p>
     See <span class="emphasis"><em>profile foundation classes</em></span> below.
    </p></dd></ul></div><section class="chapter" id="cha-apparmor-intro" data-id-title="Introducing AppArmor"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">29 </span><span class="title-name">Introducing <span class="phrase">AppArmor</span></span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-intro">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_intro.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Many security vulnerabilities result from bugs in
  <span class="emphasis"><em>trusted</em></span> programs. A trusted program runs with
  privileges that attackers want to possess. The program fails to keep that
  trust if there is a bug in the program that allows the attacker to acquire
  said privilege.
 </p><p>
  <span class="phrase">AppArmor®</span> is an application security solution designed specifically to
  apply privilege confinement to suspect programs. <span class="phrase">AppArmor</span> allows the
  administrator to specify the domain of activities the program can perform
  by developing a security <span class="emphasis"><em>profile</em></span>.  A security profile
  is a listing of files that the program may access and the operations the
  program may perform. <span class="phrase">AppArmor</span> secures applications by enforcing good
  application behavior without relying on attack signatures, so it can
  prevent attacks even if previously unknown vulnerabilities are being
  exploited.
 </p><section class="sect1" id="id-1.7.8.2.5" data-id-title="AppArmor components"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">29.1 </span><span class="title-name"><span class="phrase">AppArmor</span> components</span></span> <a title="Permalink" class="permalink" href="#id-1.7.8.2.5">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_intro.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  <span class="phrase">AppArmor</span> consists of:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    A library of <span class="phrase">AppArmor</span> profiles for common Linux* applications, describing
    what files the program needs to access.
   </p></li><li class="listitem"><p>
    A library of <span class="phrase">AppArmor</span> profile foundation classes (profile building
    blocks) needed for common application activities, such as DNS lookup and
    user authentication.
   </p></li><li class="listitem"><p>
    A tool suite for developing and enhancing <span class="phrase">AppArmor</span> profiles, so that you
    can change the existing profiles to suit your needs and create new
    profiles for your own local and custom applications.
   </p></li><li class="listitem"><p>
    Several specially modified applications that are <span class="phrase">AppArmor</span> enabled to
    provide enhanced security in the form of unique subprocess confinement
    (including Apache).
   </p></li><li class="listitem"><p>
    The <span class="phrase">AppArmor</span>-related kernel code and associated control scripts to
    enforce <span class="phrase">AppArmor</span> policies on your <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span> system.
   </p></li></ul></div></section><section class="sect1" id="sec-apparmor-intro-background" data-id-title="Background information on AppArmor profiling"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">29.2 </span><span class="title-name">Background information on <span class="phrase">AppArmor</span> profiling</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-intro-background">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_intro.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For more information about the science and security of <span class="phrase">AppArmor</span>, refer to
   the following papers:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.2.6.3.1"><span class="term"><em class="citetitle">SubDomain: Parsimonious Server Security</em> by
     Crispin Cowan, Steve Beattie, Greg Kroah-Hartman, Calton Pu, Perry Wagle,
     and Virgil Gligor</span></dt><dd><p>
      Describes the initial design and implementation of <span class="phrase">AppArmor</span>. Published
      in the proceedings of the USENIX LISA Conference, December 2000, New
      Orleans, LA. This paper is now out of date, describing syntax and
      features that are different from the current <span class="phrase">AppArmor</span> product. This
      paper should be used only for background, and not for technical
      documentation.
     </p></dd><dt id="id-1.7.8.2.6.3.2"><span class="term"><em class="citetitle">Defcon Capture the Flag: Defending Vulnerable Code from Intense Attack</em>
     by Crispin Cowan, Seth Arnold, Steve Beattie, Chris Wright, and John Viega</span></dt><dd><p>
      A good guide to strategic and tactical use of <span class="phrase">AppArmor</span> to solve severe
      security problems in a very short period of time. Published in the
      Proceedings of the DARPA Information Survivability Conference and Expo
      (DISCEX III), April 2003, Washington, DC.
     </p></dd><dt id="id-1.7.8.2.6.3.3"><span class="term"><em class="citetitle">AppArmor for Geeks</em> by Seth Arnold</span></dt><dd><p>
      This document tries to convey a better understanding of the technical
      details of <span class="phrase">AppArmor</span>. It is available at
      <a class="link" href="https://en.opensuse.org/SDB:AppArmor_geeks" target="_blank">https://en.opensuse.org/SDB:AppArmor_geeks</a>.
     </p></dd></dl></div></section></section><section class="chapter" id="cha-apparmor-start" data-id-title="Getting started"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">30 </span><span class="title-name">Getting started</span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-start">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_start.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Prepare a successful deployment of <span class="phrase">AppArmor</span> on your system by carefully
  considering the following items:
 </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
    Determine the applications to profile. Read more on this in
    <a class="xref" href="#sec-apparmor-start-choose" title="30.3. Choosing applications to profile">Section 30.3, “Choosing applications to profile”</a>.
   </p></li><li class="step"><p>
    Build the needed profiles as roughly outlined in
    <a class="xref" href="#sec-apparmor-start-build" title="30.4. Building and modifying profiles">Section 30.4, “Building and modifying profiles”</a>. Check the results and adjust
    the profiles when necessary.
   </p></li><li class="step"><p>
    Update your profiles whenever your environment changes or you need to
    react to security events logged by the reporting tool of <span class="phrase">AppArmor</span>. Refer
    to <a class="xref" href="#sec-apparmor-start-update" title="30.5. Updating your profiles">Section 30.5, “Updating your profiles”</a>.
   </p></li></ol></div></div><section class="sect1" id="sec-apparmor-start-install" data-id-title="Installing AppArmor"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">30.1 </span><span class="title-name">Installing <span class="phrase">AppArmor</span></span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-start-install">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_start.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> is installed and running on any installation of
   <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span> by default, regardless of what patterns are
   installed. The packages listed below are needed for a fully-functional
   instance of <span class="phrase">AppArmor</span>:
  </p><div class="itemizedlist"><ul class="itemizedlist compact"><li class="listitem"><p>
     <code class="systemitem">apparmor-docs</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">apparmor-parser</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">apparmor-profiles</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">apparmor-utils</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">audit</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">libapparmor1</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">perl-libapparmor</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">yast2-apparmor</code>
    </p></li></ul></div><div id="id-1.7.8.3.5.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    If <span class="phrase">AppArmor</span> is not installed on your system, install the pattern
    <code class="systemitem">apparmor</code> for a complete
    <span class="phrase">AppArmor</span> installation. Either use the YaST Software Management
    module for installation, or use Zypper on the command line:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper in -t pattern apparmor</pre></div></div></section><section class="sect1" id="sec-apparmor-start-enable" data-id-title="Enabling and disabling AppArmor"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">30.2 </span><span class="title-name">Enabling and disabling <span class="phrase">AppArmor</span></span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-start-enable">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_start.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> is configured to run by default on any fresh installation of

   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. There are two ways of toggling the status of <span class="phrase">AppArmor</span>:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.3.6.3.1"><span class="term">Using YaST services manager</span></dt><dd><p>
      Disable or enable <span class="phrase">AppArmor</span> by removing or adding its boot script to the
      sequence of scripts executed on system boot. Status changes are
      applied on reboot.
     </p></dd><dt id="id-1.7.8.3.6.3.2"><span class="term">Using <span class="phrase">AppArmor</span> configuration window</span></dt><dd><p>
      Toggle the status of <span class="phrase">AppArmor</span> in a running system by switching it off
      or on using the YaST <span class="phrase">AppArmor</span> Control Panel. Changes made here are
      applied instantaneously. The Control Panel triggers a stop or start
      event for <span class="phrase">AppArmor</span> and removes or adds its boot script in the system's
      boot sequence.
     </p></dd></dl></div><p>
   To disable <span class="phrase">AppArmor</span> permanently (by removing it from the sequence of
   scripts executed on system boot) proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Start YaST.
    </p></li><li class="step"><p>
     Select <span class="guimenu">System</span> › <span class="guimenu">Services
     Manager</span>.
    </p></li><li class="step"><p>
     Mark <code class="literal">apparmor</code> by clicking its row in the list of
     services, then click <span class="guimenu">Enable/Disable</span> in the lower
     part of the window. Check that <span class="guimenu">Enabled</span> changed to
     <span class="guimenu">Disabled</span> in the <code class="literal">apparmor</code> row.
    </p></li><li class="step"><p>
     Confirm with <span class="guimenu">OK</span>.
    </p></li></ol></div></div><p>
   <span class="phrase">AppArmor</span> will not be initialized on reboot, and stays inactive until you
   re-enable it. Re-enabling a service using the YaST
   <span class="guimenu">Services Manager</span> tool is similar to disabling it.
  </p><p>
   Toggle the status of <span class="phrase">AppArmor</span> in a running system by using the <span class="phrase">AppArmor</span>
   Configuration window. These changes take effect when you apply them
   and survive a reboot of the system. To toggle the status of <span class="phrase">AppArmor</span>,
   proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Start YaST, select <span class="guimenu"><span class="phrase">AppArmor</span> Configuration</span>, and
     click <span class="guimenu">Settings</span> in the main window.
    </p></li><li class="step"><p>
     Enable <span class="phrase">AppArmor</span> by checking <span class="guimenu">Enable <span class="phrase">AppArmor</span></span> or disable
     <span class="phrase">AppArmor</span> by deselecting it.
    </p></li><li class="step"><p>
     Click <span class="guimenu">Done</span> in the <span class="guimenu"><span class="phrase">AppArmor</span>
     Configuration</span> window.
    </p></li></ol></div></div></section><section class="sect1" id="sec-apparmor-start-choose" data-id-title="Choosing applications to profile"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">30.3 </span><span class="title-name">Choosing applications to profile</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-start-choose">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_start.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You only need to protect the programs that are exposed to attacks in your
   particular setup, so only use profiles for those applications you
   actually run. Use the following list to determine the most likely
   candidates:
  </p><table style="border: 0; " class="simplelist"><tr><td>Network Agents</td></tr><tr><td>Web Applications</td></tr><tr><td>Cron Jobs</td></tr></table><p>
   To find out which processes are currently running with open network ports
   and might need a profile to confine them, run
   <code class="command">aa-unconfined</code> as <code class="systemitem">root</code>.
  </p><div class="example" id="ex-unconfined" data-id-title="Output of aa-unconfined"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 30.1: </span><span class="title-name">Output of <code class="command">aa-unconfined</code> </span></span><a title="Permalink" class="permalink" href="#ex-unconfined">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_start.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">19848 /usr/sbin/cupsd not confined
19887 /usr/sbin/sshd not confined
19947 /usr/lib/postfix/master not confined
1328 /usr/sbin/smbd confined by '/usr/sbin/smbd (enforce)'</pre></div></div></div><p>
   Each of the processes in the above example labeled <code class="literal">not
   confined</code> might need a custom profile to confine it. Those
   labeled <code class="literal">confined by</code> are already protected by <span class="phrase">AppArmor</span>.
  </p><div id="id-1.7.8.3.7.7" data-id-title="More information" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: More information</div><p>
    For more information about choosing the right applications to profile,
    refer to <a class="xref" href="#sec-apparmor-concept-determine" title="31.2. Determining programs to immunize">Section 31.2, “Determining programs to immunize”</a>.
   </p></div></section><section class="sect1" id="sec-apparmor-start-build" data-id-title="Building and modifying profiles"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">30.4 </span><span class="title-name">Building and modifying profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-start-build">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_start.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> ships with a preconfigured set of profiles
   for the most important applications. In addition, you can use <span class="phrase">AppArmor</span> to
   create your own profiles for any application you want.
  </p><p>
   There are two ways of managing profiles. One is to use the graphical
   front-end provided by the YaST <span class="phrase">AppArmor</span> modules and the other is to
   use the command line tools provided by the <span class="phrase">AppArmor</span> suite itself. The main
   difference is that YaST supports only basic functionality for
   <span class="phrase">AppArmor</span> profiles, while the command line tools let you update/tune the
   profiles in a more fine-grained way.
  </p><p>
   For each application, perform the following steps to create a profile:
  </p><div class="procedure" id="proc-genprof"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step" id="st-genprof1"><p>
     As <code class="systemitem">root</code>, let <span class="phrase">AppArmor</span> create a rough outline of the
     application's profile by running <code class="command">aa-genprof</code>
     <em class="replaceable">PROGRAM_NAME</em>.
    </p><p>
     <span class="emphasis"><em>or</em></span>
    </p><p>

     Outline the basic profile by running <span class="guimenu">YaST</span> › <span class="guimenu">Security and Users</span> › <span class="guimenu"><span class="phrase">AppArmor</span> Configuration</span> › <span class="guimenu">Manually Add
     Profile</span> and specifying the complete path to the
     application you want to profile.
    </p><p>
     A new basic profile is outlined and put into learning mode, which means
     that it logs any activity of the program you are executing, but does
     not yet restrict it.
    </p></li><li class="step" id="st-genprof2"><p>
     Run the full range of the application's actions to let <span class="phrase">AppArmor</span> get a
     very specific picture of its activities.
    </p></li><li class="step" id="st-genprof3"><p>
     Let <span class="phrase">AppArmor</span> analyze the log files generated in
     <a class="xref" href="#st-genprof2" title="Step 2">Step 2</a> by typing <span class="keycap">S</span> in
     aa-genprof.
    </p><p>
     <span class="phrase">AppArmor</span> scans the logs it recorded during the application's run and
     asks you to set the access rights for each event that was logged.
     Either set them for each file or use globbing.
    </p></li><li class="step"><p>
     Depending on the complexity of your application, it might be necessary
     to repeat <a class="xref" href="#st-genprof2" title="Step 2">Step 2</a> and
     <a class="xref" href="#st-genprof3" title="Step 3">Step 3</a>. Confine the application, exercise it
     under the confined conditions, and process any new log events. To
     properly confine the full range of an application's capabilities, you
     might be required to repeat this procedure often.
    </p></li><li class="step" id="st-genprof4"><p>
     When you finish <code class="command">aa-genprof</code>, your profile is set to
     enforce mode. The profile is applied and <span class="phrase">AppArmor</span> restricts the
     application according to it.
    </p><p>
     If you started <code class="command">aa-genprof</code> on an application that had
     an existing profile that was in complain mode, this profile remains in
     learning mode upon exit of this learning cycle. For more information
     about changing the mode of a profile, refer to
     <a class="xref" href="#sec-apparmor-commandline-profiling-summary-complain" title="35.7.3.2. aa-complain—entering complain or learning mode">Section 35.7.3.2, “aa-complain—entering complain or learning mode”</a>
     and
     <a class="xref" href="#sec-apparmor-commandline-profiling-summary-enforce" title="35.7.3.6. aa-enforce—entering enforce mode">Section 35.7.3.6, “aa-enforce—entering enforce mode”</a>.
    </p></li></ol></div></div><p>
   Test your profile settings by performing every task you need with the
   application you confined. Normally, the confined program runs smoothly
   and you do not notice <span class="phrase">AppArmor</span> activities. However, if you notice
   certain misbehavior with your application, check the system logs and see
   if <span class="phrase">AppArmor</span> is too tightly confining your application. Depending on the
   log mechanism used on your system, there are several places to look for
   <span class="phrase">AppArmor</span> log entries:
  </p><table style="border: 0; " class="simplelist"><tr><td><code class="filename">/var/log/audit/audit.log</code>
   </td></tr><tr><td>The command <code class="command">journalctl | grep -i apparmor</code>
   </td></tr><tr><td>The command <code class="command">dmesg -T</code>
   </td></tr></table><p>
   To adjust the profile, analyze the log messages relating to this
   application again as described in
   <a class="xref" href="#sec-apparmor-commandline-profiling-summary-logprof" title="35.7.3.9. aa-logprof—scanning the system log">Section 35.7.3.9, “aa-logprof—scanning the system log”</a>.
   Determine the access rights or restrictions when prompted.
  </p><div id="id-1.7.8.3.8.9" data-id-title="More information" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: More information</div><p>
    For more information about profile building and modification, refer to
    <a class="xref" href="#cha-apparmor-profiles" title="Chapter 32. Profile components and syntax">Chapter 32, <em>Profile components and syntax</em></a>,
    <a class="xref" href="#cha-apparmor-yast" title="Chapter 34. Building and managing profiles with YaST">Chapter 34, <em>Building and managing profiles with YaST</em></a>, and
    <a class="xref" href="#cha-apparmor-commandline" title="Chapter 35. Building profiles from the command line">Chapter 35, <em>Building profiles from the command line</em></a>.
   </p></div></section><section class="sect1" id="sec-apparmor-start-update" data-id-title="Updating your profiles"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">30.5 </span><span class="title-name">Updating your profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-start-update">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_start.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Software and system configurations change over time. As a result, your
   profile setup for <span class="phrase">AppArmor</span> might need some fine-tuning from time to time.
   <span class="phrase">AppArmor</span> checks your system log for policy violations or other <span class="phrase">AppArmor</span>
   events and lets you adjust your profile set accordingly. Any application
   behavior that is outside of any profile definition can be addressed by
   <code class="command">aa-logprof</code>. For more information, see
   <a class="xref" href="#sec-apparmor-commandline-profiling-summary-logprof" title="35.7.3.9. aa-logprof—scanning the system log">Section 35.7.3.9, “aa-logprof—scanning the system log”</a>.
  </p></section></section><section class="chapter" id="cha-apparmor-concept" data-id-title="Immunizing programs"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">31 </span><span class="title-name">Immunizing programs</span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-concept">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_whatimmunize.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Effective hardening of a computer system requires minimizing the number of
  programs that mediate privilege, then securing the programs as much as
  possible. With <span class="phrase">AppArmor</span>, you only need to profile the programs that are
  exposed to attack in your environment, which drastically reduces the
  amount of work required to harden your computer. <span class="phrase">AppArmor</span> profiles enforce
  policies to make sure that programs do what they are supposed to do, but
  nothing else.
 </p><p>
  <span class="phrase">AppArmor</span> provides immunization technologies that protect applications from
  the inherent vulnerabilities they possess. After installing <span class="phrase">AppArmor</span>,
  setting up <span class="phrase">AppArmor</span> profiles, and rebooting the computer, your system
  becomes immunized because it begins to enforce the <span class="phrase">AppArmor</span> security
  policies. Protecting programs with <span class="phrase">AppArmor</span> is called
  <span class="emphasis"><em>immunizing</em></span>.
 </p><p>
  Administrators need only concern themselves with the applications that are
  vulnerable to attacks, and generate profiles for these. Hardening a system
  thus comes down to building and maintaining the <span class="phrase">AppArmor</span> profile set and
  monitoring any policy violations or exceptions logged by <span class="phrase">AppArmor</span>'s
  reporting facility.
 </p><p>
  Users should not notice <span class="phrase">AppArmor</span>. It runs <span class="quote">“<span class="quote">behind the
  scenes</span>”</span> and does not require any user interaction. Performance is
  not noticeably affected by <span class="phrase">AppArmor</span>. If some activity of the application is
  not covered by an <span class="phrase">AppArmor</span> profile or if some activity of the application
  is prevented by <span class="phrase">AppArmor</span>, the administrator needs to adjust the profile of
  this application.
 </p><p>
  <span class="phrase">AppArmor</span> sets up a collection of default application profiles to protect
  standard Linux services. To protect other applications, use the <span class="phrase">AppArmor</span>
  tools to create profiles for the applications that you want protected.
  This chapter introduces the philosophy of immunizing programs. Proceed to
  <a class="xref" href="#cha-apparmor-profiles" title="Chapter 32. Profile components and syntax">Chapter 32, <em>Profile components and syntax</em></a>,
  <a class="xref" href="#cha-apparmor-yast" title="Chapter 34. Building and managing profiles with YaST">Chapter 34, <em>Building and managing profiles with YaST</em></a>, or
  <a class="xref" href="#cha-apparmor-commandline" title="Chapter 35. Building profiles from the command line">Chapter 35, <em>Building profiles from the command line</em></a> if you are ready to build and
  manage <span class="phrase">AppArmor</span> profiles.
 </p><p>
  <span class="phrase">AppArmor</span> provides streamlined access control for network services by
  specifying which files each program is allowed to read, write, and
  execute, and which type of network it is allowed to access. This ensures
  that each program does what it is supposed to do, and nothing else.
  <span class="phrase">AppArmor</span> quarantines programs to protect the rest of the system from being
  damaged by a compromised process.
 </p><p>
  <span class="phrase">AppArmor</span> is a host intrusion prevention or mandatory access control scheme.
  Previously, access control schemes were centered around users because they
  were built for large timeshare systems. Alternatively, modern network
  servers largely do not permit users to log in, but instead provide a
  variety of network services for users (such as Web, mail, file, and print
  servers). <span class="phrase">AppArmor</span> controls the access given to network services and other
  programs to prevent weaknesses from being exploited.
 </p><div id="id-1.7.8.4.10" data-id-title="Background information for AppArmor" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Background information for <span class="phrase">AppArmor</span></div><p>
   To get a more in-depth overview of <span class="phrase">AppArmor</span> and the overall concept behind
   it, refer to <a class="xref" href="#sec-apparmor-intro-background" title="29.2. Background information on AppArmor profiling">Section 29.2, “Background information on <span class="phrase">AppArmor</span> profiling”</a>.
  </p></div><section class="sect1" id="sec-apparmor-concept-tools" data-id-title="Introducing the AppArmor framework"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">31.1 </span><span class="title-name">Introducing the <span class="phrase">AppArmor</span> framework</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-concept-tools">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_whatimmunize.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section provides a very basic understanding of what is happening
   <span class="quote">“<span class="quote">behind the scenes</span>”</span> (and under the hood of the YaST
   interface) when you run <span class="phrase">AppArmor</span>.
  </p><p>
   An <span class="phrase">AppArmor</span> profile is a plain text file containing path entries and
   access permissions. See <a class="xref" href="#sec-apparmor-profiles-parts" title="32.1. Breaking an AppArmor profile into its parts">Section 32.1, “Breaking an <span class="phrase">AppArmor</span> profile into its parts”</a> for
   a detailed reference profile. The directives contained in this text file
   are then enforced by the <span class="phrase">AppArmor</span> routines to quarantine the process or
   program.
  </p><p>
   The following tools interact in the building and enforcement of <span class="phrase">AppArmor</span>
   profiles and policies:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.4.11.5.1"><span class="term"><code class="command">aa-status</code>
    </span></dt><dd><p>
      <code class="command">aa-status</code> reports various aspects of the current
      state of the running <span class="phrase">AppArmor</span> confinement.
     </p></dd><dt id="id-1.7.8.4.11.5.2"><span class="term"><code class="command">aa-unconfined</code>
    </span></dt><dd><p>
      <code class="command">aa-unconfined</code> detects any application running on
      your system that listens for network connections and is not protected
      by an <span class="phrase">AppArmor</span> profile. Refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-summary-unconfined" title="35.7.3.12. aa-unconfined—identifying unprotected processes">Section 35.7.3.12, “aa-unconfined—identifying unprotected processes”</a>
      for detailed information about this tool.
     </p></dd><dt id="id-1.7.8.4.11.5.3"><span class="term"><code class="command">aa-autodep</code>
    </span></dt><dd><p>
      <code class="command">aa-autodep</code> creates a basic framework of a profile
      that needs to be fleshed out before it is put to use in production.
      The resulting profile is loaded and put into complain mode, reporting
      any behavior of the application that is not (yet) covered by <span class="phrase">AppArmor</span>
      rules. Refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-summary-autodep" title="35.7.3.1. aa-autodep—creating approximate profiles">Section 35.7.3.1, “aa-autodep—creating approximate profiles”</a>
      for detailed information about this tool.
     </p></dd><dt id="id-1.7.8.4.11.5.4"><span class="term"><code class="command">aa-genprof</code>
    </span></dt><dd><p>
      <code class="command">aa-genprof</code> generates a basic profile and asks you
      to refine this profile by executing the application and generating log
      events that need to be taken care of by <span class="phrase">AppArmor</span> policies. You are
      guided through a series of questions to deal with the log events that
      have been triggered during the application's execution. After the
      profile has been generated, it is loaded and put into enforce mode.
      Refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-summary-genprof" title="35.7.3.8. aa-genprof—generating profiles">Section 35.7.3.8, “aa-genprof—generating profiles”</a>
      for detailed information about this tool.
     </p></dd><dt id="id-1.7.8.4.11.5.5"><span class="term"><code class="command">aa-logprof</code>
    </span></dt><dd><p>
      <code class="command">aa-logprof</code> interactively scans and reviews the log
      entries generated by an application that is confined by an <span class="phrase">AppArmor</span>
      profile in both complain and enforced modes. It assists you in
      generating new entries in the profile concerned. Refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-summary-logprof" title="35.7.3.9. aa-logprof—scanning the system log">Section 35.7.3.9, “aa-logprof—scanning the system log”</a>
      for detailed information about this tool.
     </p></dd><dt id="id-1.7.8.4.11.5.6"><span class="term"><code class="command">aa-easyprof</code>
    </span></dt><dd><p>
      <code class="command">aa-easyprof</code> provides an easy-to-use interface for
      <span class="phrase">AppArmor</span> profile generation. <code class="command">aa-easyprof</code> supports
      the use of templates and policy groups to quickly profile an
      application. Note that while this tool can help with policy
      generation, its utility is dependent on the quality of the templates,
      policy groups and abstractions used. <code class="command">aa-easyprof</code>
      may create a profile that is less restricted than creating the profile
      with <code class="command">aa-genprof</code> and <code class="command">aa-logprof</code>.
     </p></dd><dt id="id-1.7.8.4.11.5.7"><span class="term"><code class="command">aa-complain</code>
    </span></dt><dd><p>
      <code class="command">aa-complain</code> toggles the mode of an <span class="phrase">AppArmor</span> profile
      from enforce to complain. Violations to rules set in a profile are
      logged, but the profile is not enforced. Refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-summary-complain" title="35.7.3.2. aa-complain—entering complain or learning mode">Section 35.7.3.2, “aa-complain—entering complain or learning mode”</a>
      for detailed information about this tool.
     </p></dd><dt id="id-1.7.8.4.11.5.8"><span class="term"><code class="command">aa-enforce</code>
    </span></dt><dd><p>
      <code class="command">aa-enforce</code> toggles the mode of an <span class="phrase">AppArmor</span> profile
      from complain to enforce. Violations to rules set in a profile are
      logged and not permitted—the profile is enforced. Refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-summary-enforce" title="35.7.3.6. aa-enforce—entering enforce mode">Section 35.7.3.6, “aa-enforce—entering enforce mode”</a>
      for detailed information about this tool.
     </p></dd><dt id="id-1.7.8.4.11.5.9"><span class="term"><code class="command">aa-disable</code>
    </span></dt><dd><p>
      <code class="command">aa-disable</code> disables the enforcement mode for one or
      more <span class="phrase">AppArmor</span> profiles. This command will unload the profile from the
      kernel and prevent it from being loaded on <span class="phrase">AppArmor</span> start-up. The
      <code class="command">aa-enforce</code> and <code class="command">aa-complain</code>
      utilities may be used to change this behavior.
     </p></dd><dt id="id-1.7.8.4.11.5.10"><span class="term"><code class="command">aa-exec</code>
    </span></dt><dd><p>
      <code class="command">aa-exec</code> launches a program confined by the
      specified <span class="phrase">AppArmor</span> profile and/or namespace. If both a profile and
      namespace are specified, the command will be confined by the profile
      in the new policy namespace. If only a namespace is specified, the
      profile name of the current confinement will be used. If neither a
      profile or namespace is specified, the command will be run using
      standard profile attachment—as if run without
      <code class="command">aa-exec</code>.
     </p></dd><dt id="id-1.7.8.4.11.5.11"><span class="term"><code class="command">aa-notify</code>
    </span></dt><dd><p>
      <code class="command">aa-notify</code> is a handy utility that displays <span class="phrase">AppArmor</span>
      notifications in your desktop environment. You can also configure it
      to display a summary of notifications for the specified number of
      recent days. For more information, see
      <a class="xref" href="#commandline-profiling-summary-aa-notify" title="35.7.3.13. aa-notify">Section 35.7.3.13, “aa-notify”</a>.
     </p></dd></dl></div></section><section class="sect1" id="sec-apparmor-concept-determine" data-id-title="Determining programs to immunize"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">31.2 </span><span class="title-name">Determining programs to immunize</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-concept-determine">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_whatimmunize.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Now that you have familiarized yourself with <span class="phrase">AppArmor</span>, start selecting the
   applications for which to build profiles. Programs that need profiling
   are those that mediate privilege. The following programs have access to
   resources that the person using the program does not have, so they grant
   the privilege to the user when used:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.4.12.3.1"><span class="term"><code class="systemitem">cron</code> Jobs</span></dt><dd><p>
      Programs that are run periodically by
      <code class="systemitem">cron</code>. Such programs read input
      from a variety of sources and can run with special privileges,
      sometimes with as much as <code class="systemitem">root</code> privilege. For example,
      <code class="systemitem">cron</code> can run
      <code class="command">/usr/sbin/logrotate</code> daily to rotate, compress, or
      even mail system logs. For instructions for finding these types of
      programs, refer to
      <a class="xref" href="#sec-apparmor-concept-cron" title="31.3. Immunizing cron jobs">Section 31.3, “Immunizing <code class="systemitem">cron</code> jobs”</a>.
     </p></dd><dt id="id-1.7.8.4.12.3.2"><span class="term">Web applications</span></dt><dd><p>
      Programs that can be invoked through a Web browser, including CGI Perl
      scripts, PHP pages, and more complex Web applications. For
      instructions for finding these types of programs, refer to
      <a class="xref" href="#sec-apparmor-concept-network-web" title="31.4.1. Immunizing web applications">Section 31.4.1, “Immunizing web applications”</a>.
     </p></dd><dt id="id-1.7.8.4.12.3.3"><span class="term">Network agents</span></dt><dd><p>
      Programs (servers and clients) that have open network ports. User
      clients, such as mail clients and Web browsers mediate privilege.
      These programs run with the privilege to write to the user's home
      directory and they process input from potentially hostile remote
      sources, such as hostile Web sites and e-mailed malicious code. For
      instructions for finding these types of programs, refer to
      <a class="xref" href="#sec-apparmor-concept-network-agents" title="31.4.2. Immunizing network agents">Section 31.4.2, “Immunizing network agents”</a>.
     </p></dd></dl></div><p>
   Conversely, unprivileged programs do not need to be profiled. For
   example, a shell script might invoke the <code class="command">cp</code>
   program to copy a file. Because <code class="command">cp</code> does not by
   default have its own profile or subprofile, it inherits the profile
   of the parent shell script.  Thus <code class="command">cp</code> can copy any
   files that the parent shell script's profile can read and write.
  </p></section><section class="sect1" id="sec-apparmor-concept-cron" data-id-title="Immunizing cron jobs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">31.3 </span><span class="title-name">Immunizing <code class="systemitem">cron</code> jobs</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-concept-cron">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_whatimmunize.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To find programs that are run by
   <code class="systemitem">cron</code>, inspect your local
   <code class="systemitem">cron</code> configuration.
   Unfortunately, <code class="systemitem">cron</code> configuration
   is rather complex, so there are numerous files to inspect. Periodic
   <code class="systemitem">cron</code> jobs are run from these
   files:
  </p><div class="verbatim-wrap"><pre class="screen">/etc/crontab
/etc/cron.d/*
/etc/cron.daily/*
/etc/cron.hourly/*
/etc/cron.monthly/*
/etc/cron.weekly/*</pre></div><p>
   
   The <code class="command">crontab</code> command lists/edits the current user's
   crontab. To manipulate <code class="systemitem">root</code>'s
   <code class="systemitem">cron</code> jobs, first become
   <code class="systemitem">root</code>, and then edit the tasks with <code class="command">crontab -e</code>
   or list them with <code class="command">crontab -l</code>.
  </p></section><section class="sect1" id="sec-apparmor-concept-network" data-id-title="Immunizing network applications"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">31.4 </span><span class="title-name">Immunizing network applications</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-concept-network">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_whatimmunize.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   An automated method for finding network server daemons that should be
   profiled is to use the <code class="command">aa-unconfined</code> tool.

  </p><p>
   The <code class="command">aa-unconfined</code> tool uses the command
   <code class="command">netstat -nlp</code> to inspect open ports from inside your
   computer, detect the programs associated with those ports, and inspect
   the set of <span class="phrase">AppArmor</span> profiles that you have loaded.
   <code class="command">aa-unconfined</code> then reports these programs along with
   the <span class="phrase">AppArmor</span> profile associated with each program, or reports
   <span class="quote">“<span class="quote">none</span>”</span> (if the program is not confined).
  </p><div id="id-1.7.8.4.14.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    If you create a new profile, you must restart the program that has been
    profiled to have it be effectively confined by <span class="phrase">AppArmor</span>.
   </p></div><p>
   Below is a sample <code class="command">aa-unconfined</code> output:
  </p><div class="verbatim-wrap"><pre class="screen">3702<span class="callout" id="co-apparmor-concept-network-id">1</span> /usr/sbin/sshd<span class="callout" id="co-apparmor-concept-network-string">2</span> confined
   by '/usr/sbin/sshd<span class="callout" id="co-apparmor-concept-network-confine">3</span> (enforce)'
4040 /usr/sbin/smbd confined by '/usr/sbin/smbd (enforce)'
4373 /usr/lib/postfix/master confined by '/usr/lib/postfix/master (enforce)'
4505 /usr/sbin/httpd2-prefork confined by '/usr/sbin/httpd2-prefork (enforce)'
646 /usr/lib/wicked/bin/wickedd-dhcp4 not confined
647 /usr/lib/wicked/bin/wickedd-dhcp6 not confined
5592 /usr/bin/ssh not confined
7146 /usr/sbin/cupsd confined by '/usr/sbin/cupsd (complain)'</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-concept-network-id"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The first portion is a number. This number is the process ID number
     (PID) of the listening program.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-concept-network-string"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The second portion is a string that represents the absolute path of the
     listening program
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-concept-network-confine"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The final portion indicates the profile confining the program, if any.
    </p></td></tr></table></div><div id="id-1.7.8.4.14.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    <code class="command">aa-unconfined</code> requires <code class="systemitem">root</code> privileges and
    should not be run from a shell that is confined by an <span class="phrase">AppArmor</span> profile.
   </p></div><p>
   <code class="command">aa-unconfined</code> does not distinguish between one network
   interface and another, so it reports all unconfined processes, even those
   that might be listening to an internal LAN interface.
  </p><p>
   Finding user network client applications is dependent on your user
   preferences. The <code class="command">aa-unconfined</code> tool detects and
   reports network ports opened by client applications, but only those
   client applications that are running at the time the
   <code class="command">aa-unconfined</code> analysis is performed. This is a problem
   because network services tend to be running all the time, while network
   client applications tend only to be running when the user is interested
   in them.
  </p><p>
   Applying <span class="phrase">AppArmor</span> profiles to user network client applications is also
   dependent on user preferences. Therefore, we leave the profiling of user
   network client applications as an exercise for the user.
  </p><p>
   To aggressively confine desktop applications, the
   <code class="command">aa-unconfined</code> command supports a
   <code class="option">--paranoid</code> option, which reports all processes running
   and the corresponding <span class="phrase">AppArmor</span> profiles that might or might not be
   associated with each process. The user can then decide whether each of
   these programs needs an <span class="phrase">AppArmor</span> profile.
  </p><p>
   If you have new or modified profiles, you can submit them to the
   &lt;<a class="email" href="mailto:apparmor@lists.ubuntu.com">apparmor@lists.ubuntu.com</a>&gt; mailing list along with a use
   case for the application behavior that you exercised. The <span class="phrase">AppArmor</span> team
   reviews and may submit the work into <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. We cannot
   guarantee that every profile will be included, but we make a sincere
   effort to include as much as possible.
  </p><section class="sect2" id="sec-apparmor-concept-network-web" data-id-title="Immunizing web applications"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">31.4.1 </span><span class="title-name">Immunizing web applications</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-concept-network-web">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_whatimmunize.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To find Web applications, investigate your Web server configuration. The
    Apache Web server is highly configurable and Web applications can be
    stored in many directories, depending on your local configuration.
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, by default, stores Web applications in
    <code class="filename">/srv/www/cgi-bin/</code>. To the maximum extent possible,
    each Web application should have an <span class="phrase">AppArmor</span> profile.
   </p><p>
    Once you find these programs, you can use the
    <code class="command">aa-genprof</code> and <code class="command">aa-logprof</code> tools to
    create or update their <span class="phrase">AppArmor</span> profiles.
   </p><p>
    Because CGI programs are executed by the Apache Web server, the profile
    for Apache itself, <code class="filename">usr.sbin.httpd2-prefork</code> for
    Apache2 on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, must be modified to add execute permissions
    to each of these programs. For example, adding the line
    <code class="literal">/srv/www/cgi-bin/my_hit_counter.pl rPx</code> grants Apache
    permission to execute the Perl script
    <code class="filename">my_hit_counter.pl</code> and requires that there be a
    dedicated profile for <code class="filename">my_hit_counter.pl</code>. If
    <code class="filename">my_hit_counter.pl</code> does not have a dedicated profile
    associated with it, the rule should say
    <code class="literal">/srv/www/cgi-bin/my_hit_counter.pl rix</code> to cause
    <code class="filename">my_hit_counter.pl</code> to inherit the
    <code class="filename">usr.sbin.httpd2-prefork</code> profile.
   </p><p>
    Some users might find it inconvenient to specify execute permission for
    every CGI script that Apache might invoke. Instead, the administrator
    can grant controlled access to collections of CGI scripts. For example,
    adding the line <code class="literal">/srv/www/cgi-bin/*.{pl,py,pyc} rix</code>
    allows Apache to execute all files in
    <code class="literal">/srv/www/cgi-bin/</code> ending in <code class="filename">.pl</code>
    (Perl scripts) and <code class="filename">.py</code> or <code class="filename">.pyc</code>
    (Python scripts). As above, the <code class="literal">ix</code> part of the rule
    causes Python scripts to inherit the Apache profile, which is
    appropriate if you do not want to write individual profiles for each CGI
    script.
   </p><div id="id-1.7.8.4.14.14.6" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     If you want the subprocess confinement module
     (<code class="filename">apache2-mod-apparmor</code>) functionality when Web
     applications handle Apache modules (<code class="filename">mod_perl</code> and
     <code class="filename">mod_php</code>), use the ChangeHat features when you add
     a profile in YaST or at the command line. To take advantage of the
     subprocess confinement, refer to
     <a class="xref" href="#sec-apparmor-hat-apache-managing" title="36.2. Managing ChangeHat-aware applications">Section 36.2, “Managing ChangeHat-aware applications”</a>.
    </p></div><p>
    Profiling Web applications that use <code class="filename">mod_perl</code> and
    <code class="filename">mod_php</code> requires slightly different handling. In
    this case, the <span class="quote">“<span class="quote">program</span>”</span> is a script interpreted directly
    by the module within the Apache process, so no exec happens. Instead,
    the <span class="phrase">AppArmor</span> version of Apache calls <code class="command">change_hat()</code>
    using a subprofile (a <span class="quote">“<span class="quote">hat</span>”</span>) corresponding to the name of
    the URI requested.
   </p><div id="id-1.7.8.4.14.14.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     The name presented for the script to execute might not be the URI,
     depending on how Apache has been configured for where to look for
     module scripts. If you have configured your Apache to place scripts in
     a different place, the different names appear in the log file when
     <span class="phrase">AppArmor</span> complains about access violations. See
     <a class="xref" href="#cha-apparmor-managing" title="Chapter 38. Managing profiled applications">Chapter 38, <em>Managing profiled applications</em></a>.
    </p></div><p>
    For <code class="filename">mod_perl</code> and <code class="filename">mod_php</code>
    scripts, this is the name of the Perl script or the PHP page requested.
    For example, adding this subprofile allows the
    <code class="filename">localtime.php</code> page to execute and access to the
    local system time and locale files:
   </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/httpd2-prefork {
  # ...
  ^/cgi-bin/localtime.php {
    /etc/localtime                  r,
    /srv/www/cgi-bin/localtime.php  r,
    /usr/lib/locale/**              r,
  }
}</pre></div><p>
    If no subprofile has been defined, the <span class="phrase">AppArmor</span> version of Apache applies
    the <code class="systemitem">DEFAULT_URI</code> hat. This subprofile is
    sufficient to display a Web page. The
    <code class="systemitem">DEFAULT_URI</code> hat that <span class="phrase">AppArmor</span> provides by
    default is the following:
   </p><div class="verbatim-wrap"><pre class="screen">^DEFAULT_URI {
    /usr/sbin/suexec2                  mixr,
    /var/log/apache2/**                rwl,
    @{HOME}/public_html                r,
    @{HOME}/public_html/**             r,
    /srv/www/htdocs                    r,
    /srv/www/htdocs/**                 r,
    /srv/www/icons/*.{gif,jpg,png}     r,
    /srv/www/vhosts                    r,
    /srv/www/vhosts/**                 r,
    /usr/share/apache2/**              r,
    /var/lib/php/sess_*                rwl
}</pre></div><p>
    To use a single <span class="phrase">AppArmor</span> profile for all Web pages and CGI scripts served
    by Apache, a good approach is to edit the
    <code class="systemitem">DEFAULT_URI</code> subprofile. For more information on
    confining Web applications with Apache, see
    <a class="xref" href="#cha-apparmor-hat" title="Chapter 36. Profiling your Web applications using ChangeHat">Chapter 36, <em>Profiling your Web applications using ChangeHat</em></a>.
   </p></section><section class="sect2" id="sec-apparmor-concept-network-agents" data-id-title="Immunizing network agents"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">31.4.2 </span><span class="title-name">Immunizing network agents</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-concept-network-agents">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_whatimmunize.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To find network server daemons and network clients (such as
    <code class="command">fetchmail</code> or Firefox) that need to be profiled,
    you should inspect the open ports on your machine.  Also consider
    the programs that are answering on those ports, and provide profiles
    for as many of those programs as possible. If you provide profiles
    for all programs with open network ports, an attacker cannot get to
    the file system on your machine without passing through an <span class="phrase">AppArmor</span>
    profile policy.
   </p><p>
    Scan your server for open network ports manually from outside the
    machine using a scanner (such as nmap), or from inside the machine using
    the <code class="command">netstat --inet -n -p</code> command as <code class="systemitem">root</code>.
    Then, inspect the machine to determine which programs are answering on
    the discovered open ports.
   </p><div id="id-1.7.8.4.14.15.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     Refer to the man page of the <code class="command">netstat</code> command for a
     detailed reference of all possible options.
    </p></div></section></section></section><section class="chapter" id="cha-apparmor-profiles" data-id-title="Profile components and syntax"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">32 </span><span class="title-name">Profile components and syntax</span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-profiles">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Building <span class="phrase">AppArmor</span> profiles to confine an application is very
  straightforward and intuitive. <span class="phrase">AppArmor</span> ships with several tools that
  assist in profile creation. It does not require you to do any programming
  or script handling. The only task that is required of the administrator is
  to determine a policy of strictest access and execute permissions for each
  application that needs to be hardened.
 </p><p>
  Updates or modifications to the application profiles are only required if
  the software configuration or the desired range of activities changes.
  <span class="phrase">AppArmor</span> offers intuitive tools to handle profile updates and
  modifications.
 </p><p>
  You are ready to build <span class="phrase">AppArmor</span> profiles after you select the programs to
  profile. To do so, it is important to understand the components and syntax
  of profiles. <span class="phrase">AppArmor</span> profiles contain several building blocks that help
  build simple and reusable profile code:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.5.6.1"><span class="term">Include files</span></dt><dd><p>
     Include statements are used to pull in parts of other <span class="phrase">AppArmor</span> profiles
     to simplify the structure of new profiles.
    </p></dd><dt id="id-1.7.8.5.6.2"><span class="term">Abstractions</span></dt><dd><p>
     Abstractions are include statements grouped by common application
     tasks.
    </p></dd><dt id="id-1.7.8.5.6.3"><span class="term">Program chunks</span></dt><dd><p>
     Program chunks are include statements that contain chunks of profiles
     that are specific to program suites.
    </p></dd><dt id="id-1.7.8.5.6.4"><span class="term">Capability entries</span></dt><dd><p>
     Capability entries are profile entries for any of the POSIX.1e
     <a class="link" href="http://en.wikipedia.org/wiki/POSIX#POSIX.1" target="_blank">http://en.wikipedia.org/wiki/POSIX#POSIX.1</a> Linux
     capabilities allowing a fine-grained control over what a confined
     process is allowed to do through system calls that require privileges.
    </p></dd><dt id="id-1.7.8.5.6.5"><span class="term">Network access control entries</span></dt><dd><p>
     Network Access Control Entries mediate network access based on the
     address type and family.
    </p></dd><dt id="id-1.7.8.5.6.6"><span class="term">Local variable definitions</span></dt><dd><p>
     Local variables define shortcuts for paths.
    </p></dd><dt id="id-1.7.8.5.6.7"><span class="term">File access control entries</span></dt><dd><p>
     File Access Control Entries specify the set of files an application can
     access.
    </p></dd><dt id="id-1.7.8.5.6.8"><span class="term">rlimit entries</span></dt><dd><p>
     rlimit entries set and control an application's resource limits.
    </p></dd></dl></div><p>
  For help determining the programs to profile, refer to
  <a class="xref" href="#sec-apparmor-concept-determine" title="31.2. Determining programs to immunize">Section 31.2, “Determining programs to immunize”</a>.
  To start building <span class="phrase">AppArmor</span> profiles with YaST, proceed to
  <a class="xref" href="#cha-apparmor-yast" title="Chapter 34. Building and managing profiles with YaST">Chapter 34, <em>Building and managing profiles with YaST</em></a>. To build profiles using the <span class="phrase">AppArmor</span>
  command line interface, proceed to
  <a class="xref" href="#cha-apparmor-commandline" title="Chapter 35. Building profiles from the command line">Chapter 35, <em>Building profiles from the command line</em></a>.
 </p><p>
  For more details about creating <span class="phrase">AppArmor</span> profiles, see
  <code class="command">man 5 apparmor</code>.
 </p><section class="sect1" id="sec-apparmor-profiles-parts" data-id-title="Breaking an AppArmor profile into its parts"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.1 </span><span class="title-name">Breaking an <span class="phrase">AppArmor</span> profile into its parts</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-parts">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The easiest way of explaining what a profile consists of and how to
   create one is to show the details of a sample profile, in this case for a
   hypothetical application called <code class="command">/usr/bin/foo</code>:
  </p><div class="verbatim-wrap"><pre class="screen">#include &lt;tunables/global&gt;<span class="callout" id="co-apparmor-profiles-vardef">1</span>

# a comment naming the application to confine
/usr/bin/foo<span class="callout" id="co-apparmor-profiles-path">2</span> {<span class="callout" id="co-apparmor-profiles-brack">3</span>
   #include &lt;abstractions/base&gt;<span class="callout" id="co-apparmor-profiles-incl">4</span>

   capability setgid<span class="callout" id="co-apparmor-profiles-capent">5</span>,
   network inet tcp<span class="callout" id="co-apparmor-profiles-netd">6</span>,

   link /etc/sysconfig/foo -&gt; /etc/foo.conf,<span class="callout" id="co-apparmor-profiles-lp">7</span>
   /bin/mount            ux,
   /dev/{,u}<span class="callout" id="co-apparmor-profiles-ext">8</span>random     r,
   /etc/ld.so.cache      r,
   /etc/foo/*            r,
   /lib/ld-*.so*         mr,
   /lib/lib*.so*         mr,
   /proc/[0-9]**         r,
   /usr/lib/**           mr,
   /tmp/                 r,<span class="callout" id="co-apparmor-profiles-pathent">9</span>
   /tmp/foo.pid          wr,
   /tmp/foo.*            lrw,
   /@{HOME}<span class="callout" id="co-apparmor-profiles-variable">10</span>/.foo_file   rw,
   /@{HOME}/.foo_lock    kw,
   owner<span class="callout" id="co-apparmor-profiles-owner">11</span> /shared/foo/** rw,
   /usr/bin/foobar       Cx,<span class="callout" id="co-apparmor-profiles-cx">12</span>
   /bin/**               Px -&gt; bin_generic,<span class="callout" id="co-apparmor-profiles-named">13</span>

   # a comment about foo's local (children) profile for /usr/bin/foobar.

   profile /usr/bin/foobar<span class="callout" id="co-apparmor-profiles-local">14</span> {
      /bin/bash          rmix,
      /bin/cat           rmix,
      /bin/more          rmix,
      /var/log/foobar*   rwl,
      /etc/foobar        r,
   }

  # foo's hat, bar.
   ^bar<span class="callout" id="co-apparmor-profiles-hat">15</span> {
    /lib/ld-*.so*         mr,
    /usr/bin/bar          px,
    /var/spool/*          rwl,
   }
}</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-vardef"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This loads a file containing variable definitions.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-path"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The normalized path to the program that is confined.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-brack"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The curly braces (<code class="literal">{}</code>) serve as a container for
     include statements, subprofiles, path entries, capability entries, and
     network entries.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-incl"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This directive pulls in components of <span class="phrase">AppArmor</span> profiles to simplify
     profiles.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-capent"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Capability entry statements enable each of the 29 POSIX.1e draft
     capabilities.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-netd"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     A directive determining the kind of network access allowed to the
     application. For details, refer to
     <a class="xref" href="#sec-apparmor-profiles-nac" title="32.5. Network access control">Section 32.5, “Network access control”</a>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-lp"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     A link pair rule specifying the source and the target of a link. See
     <a class="xref" href="#sec-apparmor-profiles-perm-link-pair" title="32.7.6. Link pair">Section 32.7.6, “Link pair”</a> for more
     information.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-ext"><span class="callout">8</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The curly braces (<code class="literal">{}</code>) here allow for each of the
     listed possibilities, one of which is the empty string.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-pathent"><span class="callout">9</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     A path entry specifying what areas of the file system the program can
     access. The first part of a path entry specifies the absolute path of a
     file (including regular expression globbing) and the second part
     indicates permissible access modes (for example <code class="literal">r</code>
     for read, <code class="literal">w</code> for write, and <code class="literal">x</code> for
     execute). A whitespace of any kind (spaces or tabs) can precede the
     path name, but must separate the path name and the mode specifier.
     Spaces between the access mode and the trailing comma are optional.
     Find a comprehensive overview of the available access modes in
     <a class="xref" href="#sec-apparmor-profiles-perm" title="32.7. File permission access modes">Section 32.7, “File permission access modes”</a>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-variable"><span class="callout">10</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This variable expands to a value that can be changed without changing
     the entire profile.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-owner"><span class="callout">11</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     An owner conditional rule, granting read and write permission on files
     owned by the user. Refer to
     <a class="xref" href="#sec-apparmor-profiles-perm-owner" title="32.7.8. Owner conditional rules">Section 32.7.8, “Owner conditional rules”</a> for more
     information.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-cx"><span class="callout">12</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This entry defines a transition to the local profile
     <code class="literal">/usr/bin/foobar</code>. Find a comprehensive overview of
     the available execute modes in
     <a class="xref" href="#sec-apparmor-profiles-exec" title="32.12. Execute modes">Section 32.12, “Execute modes”</a>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-named"><span class="callout">13</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     A named profile transition to the profile bin_generic located in the
     global scope. See <a class="xref" href="#sec-apparmor-profiles-exec-named" title="32.12.7. Named profile transitions">Section 32.12.7, “Named profile transitions”</a>
     for details.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-local"><span class="callout">14</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The local profile <code class="literal">/usr/bin/foobar</code> is defined in this
     section.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-hat"><span class="callout">15</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This section references a <span class="quote">“<span class="quote">hat</span>”</span> subprofile of the
     application. For more details on <span class="phrase">AppArmor</span>'s ChangeHat feature, refer to
     <a class="xref" href="#cha-apparmor-hat" title="Chapter 36. Profiling your Web applications using ChangeHat">Chapter 36, <em>Profiling your Web applications using ChangeHat</em></a>.
    </p></td></tr></table></div><p>
   When a profile is created for a program, the program can access only the
   files, modes, and POSIX capabilities specified in the profile. These
   restrictions are in addition to the native Linux access controls.
  </p><p><span class="formalpara-title">Example:</span>
    To gain the capability <code class="systemitem">CAP_CHOWN</code>, the
    program must have both access to <code class="systemitem">CAP_CHOWN</code>
    under conventional Linux access controls (typically, be a
    <code class="systemitem">root</code>-owned process) and have the capability
    <code class="systemitem">chown</code> in its profile. Similarly, to be able
    to write to the file <code class="filename">/foo/bar</code> the program must
    have both the correct user ID and mode bits set in the files
    attributes and have <code class="literal">/foo/bar w</code> in its profile.
   </p><p>
   Attempts to violate <span class="phrase">AppArmor</span> rules are recorded in
   <code class="filename">/var/log/audit/audit.log</code> if the
   <code class="systemitem">audit</code> package is installed, or
   in <code class="filename">/var/log/messages</code>, or only in
   <code class="systemitem">journalctl</code> if no traditional syslog is
   installed. Often <span class="phrase">AppArmor</span> rules prevent an attack from working
   because necessary files are not accessible and, in all cases, <span class="phrase">AppArmor</span>
   confinement restricts the damage that the attacker can do to the set of
   files permitted by <span class="phrase">AppArmor</span>.
  </p></section><section class="sect1" id="sec-apparmor-profiles-types" data-id-title="Profile types"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.2 </span><span class="title-name">Profile types</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-types">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> knows four different types of profiles: standard profiles,
   unattached profiles, local profiles and hats. Standard and unattached
   profiles are stand-alone profiles, each stored in a file under
   <code class="filename">/etc/apparmor.d/</code>. Local profiles and hats are
   children profiles embedded inside of a parent profile used to provide
   tighter or alternate confinement for a subtask of an application.
  </p><section class="sect2" id="sec-apparmor-profiles-types-attached" data-id-title="Standard profiles"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.2.1 </span><span class="title-name">Standard profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-types-attached">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The default <span class="phrase">AppArmor</span> profile is attached to a program by its name, so a
    profile name must match the path to the application it is to confine.
   </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/foo {
...
}</pre></div><p>
    This profile will be automatically used whenever an unconfined process
    executes <code class="filename">/usr/bin/foo</code>.
   </p></section><section class="sect2" id="sec-apparmor-profiles-types-unattached" data-id-title="Unattached profiles"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.2.2 </span><span class="title-name">Unattached profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-types-unattached">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Unattached profiles do not reside in the file system namespace and
    therefore are not automatically attached to an application. The name of
    an unattached profile is preceded by the keyword
    <code class="literal">profile</code>. You can freely choose a profile name, except
    for the following limitations: the name must not begin with a
    <code class="literal">:</code> or <code class="literal">.</code> character. If it contains a
    whitespace, it must be quoted. If the name begins with a
    <code class="literal">/</code>, the profile is considered to be a standard
    profile, so the following two profiles are identical:
   </p><div class="verbatim-wrap"><pre class="screen">profile /usr/bin/foo {
...
}
/usr/bin/foo {
...
}</pre></div><p>
    Unattached profiles are never used automatically, nor can they be
    transitioned to through a <code class="literal">Px</code> rule. They need to be
    attached to a program by either using a named profile transition (see
    <a class="xref" href="#sec-apparmor-profiles-exec-named" title="32.12.7. Named profile transitions">Section 32.12.7, “Named profile transitions”</a>) or with the
    <code class="literal">change_profile</code> rule (see
    <a class="xref" href="#sec-apparmor-profiles-types-change" title="32.2.5. Change rules">Section 32.2.5, “Change rules”</a>).
   </p><p>
    Unattached profiles are useful for specialized profiles for system
    utilities that generally should not be confined by a system-wide profile
    (for example, <code class="literal">/bin/bash</code>). They can also be used to
    set up roles or to confine a user.
   </p></section><section class="sect2" id="sec-apparmor-profiles-types-local" data-id-title="Local profiles"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.2.3 </span><span class="title-name">Local profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-types-local">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Local profiles provide a convenient way to provide specialized
    confinement for utility programs launched by a confined application.
    They are specified like standard profiles, except that they are embedded
    in a parent profile and begin with the <code class="literal">profile</code>
    keyword:
   </p><div class="verbatim-wrap"><pre class="screen">/parent/profile {
   ...
   profile /local/profile {
      ...
   }
}</pre></div><p>
    To transition to a local profile, either use a <code class="literal">cx</code>
    rule (see <a class="xref" href="#sec-apparmor-profiles-exec-cx" title="32.12.2. Discrete local profile execute mode (cx)">Section 32.12.2, “Discrete local profile execute mode (cx)”</a>) or a named
    profile transition (see
    <a class="xref" href="#sec-apparmor-profiles-exec-named" title="32.12.7. Named profile transitions">Section 32.12.7, “Named profile transitions”</a>).
   </p></section><section class="sect2" id="sec-apparmor-profiles-types-hat" data-id-title="Hats"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.2.4 </span><span class="title-name">Hats</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-types-hat">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="phrase">AppArmor</span> "hats" are a local profiles with some additional restrictions
    and an implicit rule allowing for <code class="literal">change_hat</code> to be
    used to transition to them. Refer to <a class="xref" href="#cha-apparmor-hat" title="Chapter 36. Profiling your Web applications using ChangeHat">Chapter 36, <em>Profiling your Web applications using ChangeHat</em></a>
    for a detailed description.
   </p></section><section class="sect2" id="sec-apparmor-profiles-types-change" data-id-title="Change rules"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.2.5 </span><span class="title-name">Change rules</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-types-change">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="phrase">AppArmor</span> provides <code class="literal">change_hat</code> and
    <code class="literal">change_profile</code> rules that control domain
    transitioning. <code class="literal">change_hat</code> are specified by defining
    hats in a profile, while <code class="literal">change_profile</code> rules refer
    to another profile and start with the keyword
    <code class="literal">change_profile</code>:
   </p><div class="verbatim-wrap"><pre class="screen">change_profile -&gt; /usr/bin/foobar,</pre></div><p>
    Both <code class="literal">change_hat</code> and <code class="literal">change_profile</code>
    provide for an application directed profile transition, without having
    to launch a separate application. <code class="literal">change_profile</code>
    provides a generic one way transition between any of the loaded
    profiles. <code class="literal">change_hat</code> provides for a returnable parent
    child transition where an application can switch from the parent profile
    to the hat profile and if it provides the correct secret key return to
    the parent profile at a later time.
   </p><p>
    <code class="literal">change_profile</code> is best used in situations where an
    application goes through a trusted setup phase and then can lower its
    privilege level. Any resources mapped or opened during the start-up
    phase may still be accessible after the profile change, but the new
    profile will restrict the opening of new resources, and will even limit
    some  resources opened before the switch. Specifically, memory
    resources will still be available while capability and file resources
    (as long as they are not memory mapped) can be limited.
   </p><p>
    <code class="literal">change_hat</code> is best used in situations where an
    application runs a virtual machine or an interpreter that does not
    provide direct access to the applications resources (for example
    Apache's <code class="literal">mod_php</code>). Since
    <code class="literal">change_hat</code> stores the return secret key in the
    application's memory the phase of reduced privilege should not have
    direct access to memory. It is also important that file access is
    properly separated, since the hat can restrict accesses to a file handle
    but does not close it. If an application does buffering and provides
    access to the open files with buffering, the accesses to these files
    might not be seen by the kernel and hence not restricted by the new
    profile.
   </p><div id="id-1.7.8.5.10.7.7" data-id-title="Safety of domain transitions" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Safety of domain transitions</div><p>
     The <code class="literal">change_hat</code> and <code class="literal">change_profile</code>
     domain transitions are less secure than a domain transition done
     through an exec because they do not affect a process's memory mappings,
     nor do they close resources that have already been opened.
    </p></div></section></section><section class="sect1" id="sec-apparmor-profiles-includes" data-id-title="Include statements"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.3 </span><span class="title-name">Include statements</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-includes">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Include statements are directives that pull in components of other
   <span class="phrase">AppArmor</span> profiles to simplify profiles. Include files retrieve access
   permissions for programs. By using an include, you can give the program
   access to directory paths or files that are also required by other
   programs. Using includes can reduce the size of a profile.
  </p><p>
   Include statements normally begin with a hash (<code class="literal">#</code>)
   sign. This is confusing because the same hash sign is used for comments
   inside profile files. Because of this, <code class="literal">#include</code> is
   treated as an include only if there is no preceding #
   (<code class="literal">##include</code> is a comment) and there is no whitespace
   between <code class="literal">#</code> and <code class="literal">include</code> (<code class="literal">#
   include</code> is a comment).
  </p><p>
   You can also use <code class="literal">include</code> without the leading
   <code class="literal">#</code>.
  </p><div class="verbatim-wrap"><pre class="screen">include "/etc/apparmor.d/abstractions/foo"</pre></div><p>
   is the same as using
  </p><div class="verbatim-wrap"><pre class="screen">#include "/etc/apparmor.d/abstractions/foo"</pre></div><div id="id-1.7.8.5.11.8" data-id-title="No trailing ," class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: No trailing ','</div><p>
    Note that because includes follow the C pre-processor syntax, they do
    not have a trailing ',' like most <span class="phrase">AppArmor</span> rules.
   </p></div><p>
   By slight changes in syntax, you can modify the behavior of
   <code class="literal">include</code>. If you use <code class="literal">""</code> around the
   including path, you instruct the parser to do an absolute or relative
   path lookup.
  </p><div class="verbatim-wrap"><pre class="screen">include "/etc/apparmor.d/abstractions/foo"   # absolute path
include "abstractions/foo"   # relative path to the directory of current file</pre></div><p>
   Note that when using relative path includes, when the file is included,
   it is considered the new current file for its includes. For example,
   suppose you are in the <code class="filename">/etc/apparmor.d/bar</code> file,
   then
  </p><div class="verbatim-wrap"><pre class="screen">include "abstractions/foo"</pre></div><p>
   includes the file <code class="filename">/etc/apparmor.d/abstractions/foo</code>.
   If then there is
  </p><div class="verbatim-wrap"><pre class="screen">include "example"</pre></div><p>
   inside the <code class="filename">/etc/apparmor.d/abstractions/foo</code> file, it
   includes <code class="filename">/etc/apparmor.d/abstractions/example</code>.
  </p><p>
   The use of <code class="literal">&lt;&gt;</code> specifies to try the include
   path (specified by <code class="option">-I</code>, defaults to the
   <code class="filename">/etc/apparmor.d</code> directory) in an ordered way. So
   assuming the include path is
  </p><div class="verbatim-wrap"><pre class="screen">-I /etc/apparmor.d/ -I /usr/share/apparmor/</pre></div><p>
   then the include statement
  </p><div class="verbatim-wrap"><pre class="screen">include &lt;abstractions/foo&gt;</pre></div><p>
   will try <code class="filename">/etc/apparmor.d/abstractions/foo</code>, and if
   that file does not exist, the next try is
   <code class="filename">/usr/share/apparmor/abstractions/foo</code>.
  </p><div id="id-1.7.8.5.11.21" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    The default include path can be overridden manually by passing
    <code class="option">-I</code> to the <code class="command">apparmor_parser</code>, or by
    setting the include paths in
    <code class="filename">/etc/apparmor/parser.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">Include /usr/share/apparmor/
Include /etc/apparmor.d/</pre></div><p>
    Multiple entries are allowed, and they are taken in the same order as
    when they are when using <code class="option">-I</code> or
    <code class="option">--Include</code> from the <code class="command">apparmor_parser</code>
    command line.
   </p></div><p>
   If an include ends with '/', this is considered a directory include, and
   all files within the directory are included.
  </p><p>
   To assist you in profiling your applications, <span class="phrase">AppArmor</span> provides three
   classes of includes: abstractions, program chunks and tunables.
  </p><section class="sect2" id="sec-apparmor-profiles-includes-abstractions" data-id-title="Abstractions"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.3.1 </span><span class="title-name">Abstractions</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-includes-abstractions">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Abstractions are includes that are grouped by common application tasks.
    These tasks include access to authentication mechanisms, access to name
    service routines, common graphics requirements, and system accounting.
    Files listed in these abstractions are specific to the named task.
    Programs that require one of these files usually also require
    other files listed in the abstraction file (depending on the local
    configuration and the specific requirements of the program). Find
    abstractions in <code class="filename">/etc/apparmor.d/abstractions</code>.
   </p></section><section class="sect2" id="sec-apparmor-profiles-includes-chunks" data-id-title="Program chunks"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.3.2 </span><span class="title-name">Program chunks</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-includes-chunks">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The program-chunks directory
    (<code class="filename">/etc/apparmor.d/program-chunks</code>) contains some
    chunks of profiles that are specific to program suites and not generally
    useful outside of the suite, thus are never suggested for use in
    profiles by the profile wizards (<code class="command">aa-logprof</code> and
    <code class="command">aa-genprof</code>). Currently, program chunks are only
    available for the postfix program suite.
   </p></section><section class="sect2" id="sec-apparmor-profiles-includes-tunables" data-id-title="Tunables"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.3.3 </span><span class="title-name">Tunables</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-includes-tunables">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The tunables directory (<code class="filename">/etc/apparmor.d/tunables</code>)
    contains global variable definitions. When used in a profile, these
    variables expand to a value that can be changed without changing the
    entire profile. Add all the tunables definitions that should be
    available to every profile to
    <code class="filename">/etc/apparmor.d/tunables/global</code>.
   </p></section></section><section class="sect1" id="sec-apparmor-profiles-capabilities" data-id-title="Capability entries (POSIX.1e)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.4 </span><span class="title-name">Capability entries (POSIX.1e)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-capabilities">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Capability rules are simply the word <code class="literal">capability</code>
   followed by the name of the POSIX.1e capability as defined in the
   <code class="systemitem">capabilities(7)</code> man page. You can list multiple
   capabilities in a single rule, or grant all implemented capabilities with
   the bare keyword <code class="literal">capability</code>.
  </p><div class="verbatim-wrap"><pre class="screen">capability dac_override sys_admin,   # multiple capabilities
capability,                          # grant all capabilities</pre></div></section><section class="sect1" id="sec-apparmor-profiles-nac" data-id-title="Network access control"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.5 </span><span class="title-name">Network access control</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-nac">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> allows mediation of network access based on the address type and
   family. The following illustrates the network access rule syntax:
  </p><div class="verbatim-wrap"><pre class="screen">network [[&lt;domain&gt;<span class="callout" id="co-apparmor-profiles-nac-dom">1</span>][&lt;type<span class="callout" id="co-apparmor-profiles-nac-type">2</span>&gt;][&lt;protocol<span class="callout" id="co-apparmor-profiles-nac-proto">3</span>&gt;]]</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-nac-dom"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Supported domains: <code class="literal">inet</code>, <code class="literal">ax25</code>,
     <code class="literal">ipx</code>, <code class="literal">appletalk</code>,
     <code class="literal">netrom</code>, <code class="literal">bridge</code>,
     <code class="literal">x25</code>, <code class="literal">inet6</code>,
     <code class="literal">rose</code>, <code class="literal">netbeui</code>,
     <code class="literal">security</code>, <code class="literal">key</code>,
     <code class="literal">packet</code>, <code class="literal">ash</code>,
     <code class="literal">econet</code>, <code class="literal">atmsvc</code>,
     <code class="literal">sna</code>,
     <code class="literal">pppox</code>, <code class="literal">wanpipe</code>,
     <code class="literal">bluetooth</code>, <code class="literal">unix</code>,
     <code class="literal">atmpvc</code>,<code class="literal">netlink</code>,
     <code class="literal">llc</code>, <code class="literal">can</code>,
     <code class="literal">tipc</code>, <code class="literal">iucv</code>,
     <code class="literal">rxrpc</code>, <code class="literal">isdn</code>,
     <code class="literal">phonet</code>, <code class="literal">ieee802154</code>,
     <code class="literal">caif</code>, <code class="literal">alg</code>,
     <code class="literal">nfc</code>, <code class="literal">vsock</code>
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-nac-type"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Supported types: <code class="literal">stream</code>, <code class="literal">dgram</code>,
     <code class="literal">seqpacket</code>, <code class="literal">rdm</code>,
     <code class="literal">raw</code>, <code class="literal">packet</code>
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-nac-proto"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Supported protocols: <code class="literal">tcp</code>, <code class="literal">udp</code>,
     <code class="literal">icmp</code>
    </p></td></tr></table></div><p>
   The <span class="phrase">AppArmor</span> tools support only family and type specification. The <span class="phrase">AppArmor</span>
   module emits only <code class="literal">network <em class="replaceable">DOMAIN</em>
   <em class="replaceable">TYPE</em></code> in <span class="quote">“<span class="quote">ACCESS DENIED</span>”</span>
   messages. And only these are output by the profile generation tools, both
   YaST and command line.
  </p><p>
   The following examples illustrate possible network-related rules to be
   used in <span class="phrase">AppArmor</span> profiles. Note that the syntax of the last two are not
   currently supported by the <span class="phrase">AppArmor</span> tools.
  </p><div class="verbatim-wrap"><pre class="screen">network<span class="callout" id="co-apparmor-profiles-nac-nw">1</span>,
network inet<span class="callout" id="co-apparmor-profiles-nac-inet">2</span>,
network inet6<span class="callout" id="co-apparmor-profiles-nac-inet6">3</span>,
network inet stream<span class="callout" id="co-apparmor-profiles-nac-istream">4</span>,
network inet tcp<span class="callout" id="co-apparmor-profiles-nac-itcp">5</span>,
network tcp<span class="callout" id="co-apparmor-profiles-nac-tcp">6</span>,</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-nac-nw"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Allow all networking. No restrictions applied with regard to domain,
     type, or protocol.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-nac-inet"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Allow general use of IPv4 networking.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-nac-inet6"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Allow general use of IPv6 networking.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-nac-istream"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Allow the use of IPv4 TCP networking.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-nac-itcp"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Allow the use of IPv4 TCP networking, paraphrasing the rule above.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-apparmor-profiles-nac-tcp"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Allow the use of both IPv4 and IPv6 TCP networking.
    </p></td></tr></table></div></section><section class="sect1" id="sec-apparmor-profiles-glob" data-id-title="Profile names, flags, paths, and globbing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.6 </span><span class="title-name">Profile names, flags, paths, and globbing</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-glob">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A profile is usually attached to a program by specifying a full path to
   the program's executable. For example in the case of a standard profile
   (see <a class="xref" href="#sec-apparmor-profiles-types-attached" title="32.2.1. Standard profiles">Section 32.2.1, “Standard profiles”</a>), the profile
   is defined by
  </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/foo { ... }</pre></div><p>
   The following sections describe several useful techniques that can be
   applied when naming a profile or putting a profile in the context of
   other existing ones, or specifying file paths.
  </p><p>
   <span class="phrase">AppArmor</span> explicitly distinguishes directory path names from file path
   names. Use a trailing <code class="literal">/</code> for any directory path that
   needs to be explicitly distinguished:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.5.14.6.1"><span class="term"><code class="filename">/some/random/example/* r</code>
    </span></dt><dd><p>
      Allow read access to files in the
      <code class="filename">/some/random/example</code> directory.
     </p></dd><dt id="id-1.7.8.5.14.6.2"><span class="term"><code class="filename">/some/random/example/ r</code>
    </span></dt><dd><p>
      Allow read access to the directory only.
     </p></dd><dt id="id-1.7.8.5.14.6.3"><span class="term"><code class="filename">/some/**/ r</code>
    </span></dt><dd><p>
      Give read access to any directories below <code class="filename">/some</code>
      (but not /some/ itself).
     </p></dd><dt id="id-1.7.8.5.14.6.4"><span class="term"><code class="filename">/some/random/example/** r</code>
    </span></dt><dd><p>
      Give read access to files and directories under
      <code class="filename">/some/random/example</code> (but not
      /some/random/example/ itself).
     </p></dd><dt id="id-1.7.8.5.14.6.5"><span class="term"><code class="filename">/some/random/example/**[^/] r</code>
    </span></dt><dd><p>
      Give read access to files under
      <code class="filename">/some/random/example</code>. Explicitly exclude
      directories (<code class="literal">[^/]</code>).
     </p></dd></dl></div><p>
   Globbing (or regular expression matching) is when you modify the
   directory path using wild cards to include a group of files or
   subdirectories. File resources can be specified with a globbing syntax
   similar to that used by popular shells, such as csh, Bash, and zsh.
  </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">*</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Substitutes for any number of any characters, except
        <code class="literal">/</code>.
       </p>
       <p>
        Example: An arbitrary number of file path elements.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">**</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Substitutes for any number of characters, including
        <code class="literal">/</code>.
       </p>
       <p>
        Example: An arbitrary number of path elements, including entire
        directories.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">?</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Substitutes for any single character, except <code class="literal">/</code>.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">[abc]</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Substitutes for the single character <code class="literal">a</code>,
        <code class="literal">b</code>, or <code class="literal">c</code>.
       </p>
       <p>
        Example: a rule that matches <code class="literal">/home[01]/*/.plan</code>
        allows a program to access <code class="filename">.plan</code> files for
        users in both <code class="filename">/home0</code> and
        <code class="filename">/home1</code>.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">[a-c]</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Substitutes for the single character <code class="literal">a</code>,
        <code class="literal">b</code>, or <code class="literal">c</code>.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">{ab,cd}</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Expands to one rule to match <code class="literal">ab</code> and one rule to
        match <code class="literal">cd</code>.
       </p>
       <p>
        Example: a rule that matches <code class="literal">/{usr,www}/pages/**</code>
        grants access to Web pages in both <code class="filename">/usr/pages</code>
        and <code class="filename">/www/pages</code>.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        <code class="literal">[^a]</code>
       </p>
      </td><td>
       <p>
        Substitutes for any character except <code class="literal">a</code>.
       </p>
      </td></tr></tbody></table></div><section class="sect2" id="sec-apparmor-profiles-flags" data-id-title="Profile flags"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.6.1 </span><span class="title-name">Profile flags</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-flags">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Profile flags control the behavior of the related profile. You can add
    profile flags to the profile definition by editing it manually, see the
    following syntax:
   </p><div class="verbatim-wrap"><pre class="screen">/path/to/profiled/binary flags=(list_of_flags) {
  [...]
}</pre></div><p>
    You can use multiple flags separated by a comma ',' or space ' '. There
    are three basic types of profile flags: mode, relative, and attach
    flags.
   </p><p>
    <span class="emphasis"><em>Mode</em></span> flag is <code class="literal">complain</code> (illegal
    accesses are allowed and logged). If it is omitted, the profile is in
    <code class="literal">enforce</code> mode (enforces the policy).
   </p><div id="id-1.7.8.5.14.9.6" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     A more flexible way of setting the whole profile into complain mode is
     to create a symbolic link from the profile file inside the
     <code class="filename">/etc/apparmor.d/force-complain/</code> directory.
    </p><div class="verbatim-wrap"><pre class="screen">ln -s /etc/apparmor.d/bin.ping /etc/apparmor.d/force-complain/bin.ping</pre></div></div><p>
    <span class="emphasis"><em>Relative</em></span> flags are
    <code class="literal">chroot_relative</code> (states that the profile is relative
    to the chroot instead of namespace) or
    <code class="literal">namespace_relative</code> (the default, with the path being
    relative to outside the chroot). They are mutually exclusive.
   </p><p>
    <span class="emphasis"><em>Attach</em></span> flags consist of two pairs of mutually
    exclusive flags: <code class="literal">attach_disconnected</code> or
    <code class="literal">no_attach_disconnected</code> (determine if path names
    resolved to be outside of the namespace are attached to the root, which
    means they have the '/' character at the beginning), and
    <code class="literal">chroot_attach</code> or <code class="literal">chroot_no_attach</code>
    (control path name generation when in a chroot environment while a file
    is accessed that is external to the chroot but within the namespace).
   </p></section><section class="sect2" id="sec-apparmor-profiles-glob-variables" data-id-title="Using variables in profiles"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.6.2 </span><span class="title-name">Using variables in profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-glob-variables">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="phrase">AppArmor</span> allows to use variables holding paths in profiles. Use global
    variables to make your profiles portable and local variables to create
    shortcuts for paths.
   </p><p>
    A typical example of when global variables come in handy are network
    scenarios in which user home directories are mounted in different
    locations. Instead of rewriting paths to home directories in all
    affected profiles, you only need to change the value of a variable.
    Global variables are defined under
    <code class="filename">/etc/apparmor.d/tunables</code> and need to be made
    available via an include statement. Find the variable definitions for
    this use case (<code class="envar">@{HOME}</code> and <code class="envar">@{HOMEDIRS}</code>) in
    the <code class="filename">/etc/apparmor.d/tunables/home</code> file.
   </p><p>
    Local variables are defined at the head of a profile. This is useful to
    provide the base of for a chrooted path, for example:
   </p><div class="verbatim-wrap"><pre class="screen">@{CHROOT_BASE}=/tmp/foo
/sbin/rsyslogd {
...
# chrooted applications
@{CHROOT_BASE}/var/lib/*/dev/log w,
@{CHROOT_BASE}/var/log/** w,
...
}</pre></div><p>
    In the following example, while @{HOMEDIRS} lists where all the user
    home directories are stored, @{HOME} is a space-separated list of home
    directories. Later on, @{HOMEDIRS} is expanded by two new specific
    places where user home directories are stored.
   </p><div class="verbatim-wrap"><pre class="screen">@{HOMEDIRS}=/home/
@{HOME}=@{HOMEDIRS}/*/ /root/
[...]
@{HOMEDIRS}+=/srv/nfs/home/ /mnt/home/</pre></div><div id="id-1.7.8.5.14.10.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     With the current <span class="phrase">AppArmor</span> tools, variables can only be used when
     manually editing and maintaining a profile.
    </p></div></section><section class="sect2" id="sec-apparmor-profiles-pattern-matching" data-id-title="Pattern matching"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.6.3 </span><span class="title-name">Pattern matching</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-pattern-matching">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Profile names can contain globbing expressions allowing the profile to
    match against multiple binaries.
   </p><p>
    The following example is valid for systems where the
    <code class="command">foo</code> binary resides either in
    <code class="filename">/usr/bin</code> or <code class="filename">/bin</code>.
   </p><div class="verbatim-wrap"><pre class="screen">/{usr/,}bin/foo { ... }</pre></div><p>
    In the following example, when matching against the executable
    <code class="filename">/bin/foo</code>, the <code class="literal">/bin/foo</code> profile
    is an exact match so it is chosen. For the executable
    <code class="filename">/bin/fat</code>, the profile <code class="literal">/bin/foo</code>
    does not match, and because the <code class="literal">/bin/f*</code> profile is
    more specific (less general) than <code class="literal">/bin/**</code>, the
    <code class="literal">/bin/f*</code> profile is chosen.
   </p><div class="verbatim-wrap"><pre class="screen">/bin/foo { ... }

/bin/f*  { ... }

/bin/**  { ... }</pre></div><p>
    For more information on profile name globbing examples, see the man page
    of <span class="phrase">AppArmor</span>, <code class="command">man 5 apparmor.d,</code>, section
    <code class="literal">Globbing</code>.
   </p></section><section class="sect2" id="sec-apparmor-profiles-namespaces" data-id-title="Namespaces"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.6.4 </span><span class="title-name">Namespaces</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-namespaces">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Namespaces are used to provide different profiles sets. Say one for the
    system, another for a chroot environment or container. Namespaces are
    hierarchical—a namespace can see its children but a child
    cannot see its parent. Namespace names start with a colon
    <code class="literal">:</code> followed by an alphanumeric string, a trailing
    colon <code class="literal">:</code> and an optional double slash
    <code class="literal">//</code>, such as
   </p><div class="verbatim-wrap"><pre class="screen">:childNameSpace://</pre></div><p>
    Profiles loaded to a child namespace will be prefixed with their
    namespace name (viewed from a parent's perspective):
   </p><div class="verbatim-wrap"><pre class="screen">:childNameSpace://apache</pre></div><p>
    Namespaces can be entered via the <code class="literal">change_profile</code> API,
    or named profile transitions:
   </p><div class="verbatim-wrap"><pre class="screen">/path/to/executable px -&gt; :childNameSpace://apache</pre></div></section><section class="sect2" id="sec-apparmor-profiles-naming-attachment" data-id-title="Profile naming and attachment specification"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.6.5 </span><span class="title-name">Profile naming and attachment specification</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-naming-attachment">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Profiles can have a name, and an attachment specification. This allows
    for profiles with a logical name that can be more meaningful to
    users/administrators than a profile name that contains pattern matching
    (see <a class="xref" href="#sec-apparmor-profiles-pattern-matching" title="32.6.3. Pattern matching">Section 32.6.3, “Pattern matching”</a>). For example,
    the default profile
   </p><div class="verbatim-wrap"><pre class="screen">/** { ... }</pre></div><p>
    can be named
   </p><div class="verbatim-wrap"><pre class="screen">profile default /** { ... }</pre></div><p>
    Also, a profile with pattern matching can be named. For example:
   </p><div class="verbatim-wrap"><pre class="screen">/usr/lib64/firefox*/firefox-*bin { ... }</pre></div><p>
    can be named
   </p><div class="verbatim-wrap"><pre class="screen">profile firefox /usr/lib64/firefox*/firefox-*bin { ... }</pre></div></section><section class="sect2" id="sec-apparmor-profiles-glob-alias" data-id-title="Alias rules"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.6.6 </span><span class="title-name">Alias rules</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-glob-alias">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Alias rules provide an alternative way to manipulate profile path
    mappings to site specific layouts. They are an alternative form of path
    rewriting to using variables, and are done post variable resolution. The
    alias rule says to treat rules that have the same source prefix as if
    the rules are at target prefix.
   </p><div class="verbatim-wrap"><pre class="screen">alias /home/ -&gt; /usr/home/</pre></div><p>
    All the rules that have a prefix match to <code class="filename">/home/</code>
    will provide access to <code class="filename">/usr/home/</code>. For example
   </p><div class="verbatim-wrap"><pre class="screen">/home/username/** r,</pre></div><p>
    allows as well access to
   </p><div class="verbatim-wrap"><pre class="screen">/usr/home/username/** r,</pre></div><p>
    Aliases provide a quick way of remapping rules without the need to
    rewrite them. They keep the source path still accessible—in our
    example, the alias rule keeps the paths under
    <code class="filename">/home/</code> still accessible.
   </p><p>
    With the <code class="literal">alias</code> rule, you can point to multiple
    targets at the same time.
   </p><div class="verbatim-wrap"><pre class="screen">alias /home/ -&gt; /usr/home/
alias /home/ -&gt; /mnt/home/</pre></div><div id="id-1.7.8.5.14.14.11" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     With the current <span class="phrase">AppArmor</span> tools, alias rules can only be used when
     manually editing and maintaining a profile.
    </p></div><div id="id-1.7.8.5.14.14.12" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     Insert global alias definitions in the file
     <code class="filename">/etc/apparmor.d/tunables/alias</code>.
    </p></div></section></section><section class="sect1" id="sec-apparmor-profiles-perm" data-id-title="File permission access modes"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.7 </span><span class="title-name">File permission access modes</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-perm">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   File permission access modes consist of combinations of the following
   modes:
  </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">r</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Read mode
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">w</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Write mode (mutually exclusive to <code class="literal">a</code>)
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">a</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Append mode (mutually exclusive to <code class="literal">w</code>)
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">k</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        File locking mode
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">l</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Link mode
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        <code class="literal">link <em class="replaceable">FILE</em> -&gt;
        <em class="replaceable">TARGET</em></code>
       </p>
      </td><td>
       <p>
        Link pair rule (cannot be combined with other access modes)
       </p>
      </td></tr></tbody></table></div><section class="sect2" id="sec-apparmor-profiles-perm-r" data-id-title="Read mode (r)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.7.1 </span><span class="title-name">Read mode (r)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-perm-r">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Allows the program to have read access to the resource. Read access is
    required for shell scripts and other interpreted content and determines
    if an executing process can core dump.
   </p></section><section class="sect2" id="sec-apparmor-profiles-perm-w" data-id-title="Write mode (w)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.7.2 </span><span class="title-name">Write mode (w)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-perm-w">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Allows the program to have write access to the resource. Files must have
    this permission if they are to be unlinked (removed).
   </p></section><section class="sect2" id="sec-apparmor-profiles-perm-a" data-id-title="Append mode (a)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.7.3 </span><span class="title-name">Append mode (a)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-perm-a">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Allows a program to write to the end of a file. In contrast to the
    <code class="literal">w</code> mode, the append mode does not include the ability
    to overwrite data, to rename, or to remove a file. The append permission
    is typically used with applications who need to be able to write to log
    files, but which should not be able to manipulate any existing data in
    the log files. As the append permission is a subset of the permissions
    associated with the write mode, the <code class="literal">w</code> and
    <code class="literal">a</code> permission flags cannot be used together and are
    mutually exclusive.
   </p></section><section class="sect2" id="sec-apparmor-profiles-perm-k" data-id-title="File locking mode (k)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.7.4 </span><span class="title-name">File locking mode (k)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-perm-k">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The application can take file locks. Former versions of <span class="phrase">AppArmor</span> allowed
    files to be locked if an application had access to them. By using a
    separate file locking mode, <span class="phrase">AppArmor</span> makes sure locking is restricted
    only to those files which need file locking and tightens security as
    locking can be used in several denial-of-service attack scenarios.
   </p></section><section class="sect2" id="sec-apparmor-profiles-perm-link" data-id-title="Link mode (l)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.7.5 </span><span class="title-name">Link mode (l)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-perm-link">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The link mode mediates access to hard links. When a link is created, the
    target file must have the same access permissions as the link created
    (but the destination does not need link access).
   </p></section><section class="sect2" id="sec-apparmor-profiles-perm-link-pair" data-id-title="Link pair"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.7.6 </span><span class="title-name">Link pair</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-perm-link-pair">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The link mode grants permission to link to arbitrary files, provided the
    link has a subset of the permissions granted by the target (subset
    permission test).
   </p><div class="verbatim-wrap"><pre class="screen">/srv/www/htdocs/index.html rl,</pre></div><p>
    By specifying origin and destination, the link pair rule provides
    greater control over how hard links are created. Link pair rules by
    default do not enforce the link subset permission test that the standard
    rules link permission requires.
   </p><div class="verbatim-wrap"><pre class="screen">link /srv/www/htdocs/index.html -&gt; /var/www/index.html</pre></div><p>
    To force the rule to require the test, the <code class="literal">subset</code>
    keyword is used. The following rules are equivalent:
   </p><div class="verbatim-wrap"><pre class="screen">/var/www/index.html l,
link subset /var/www/index.html -&gt; /**,</pre></div><div id="id-1.7.8.5.15.9.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     Currently link pair rules are not supported by YaST and the
     command line tools. Manually edit your profiles to use them. Updating
     such profiles using the tools is safe, because the link pair entries
     will not be touched.
    </p></div></section><section class="sect2" id="sec-apparmor-profiles-perm-file-allow" data-id-title="Optional allow and file rules"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.7.7 </span><span class="title-name">Optional <code class="literal">allow</code> and <code class="literal">file</code> rules</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-perm-file-allow">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="literal">allow</code> prefix is optional, and it is idiomatically
    implied if not specified and the <code class="literal">deny</code> (see
    <a class="xref" href="#sec-apparmor-profiles-perm-deny" title="32.7.9. Deny rules">Section 32.7.9, “Deny rules”</a>) keyword is not used.
   </p><div class="verbatim-wrap"><pre class="screen">allow file /example r,
allow /example r,
allow network,</pre></div><p>
    You can also use the optional <code class="literal">file</code> keyword. If you
    omit it and there are no other rule types that start with a keyword,
    such as <code class="literal">network</code> or <code class="literal">mount</code>, it is
    automatically implied.
   </p><div class="verbatim-wrap"><pre class="screen">file /example/rule r,</pre></div><p>
    is equivalent to
   </p><div class="verbatim-wrap"><pre class="screen">/example/rule r,</pre></div><p>
    The following rule grants access to all files:
   </p><div class="verbatim-wrap"><pre class="screen">file,</pre></div><p>
    which is equal to
   </p><div class="verbatim-wrap"><pre class="screen">/** rwmlk,</pre></div><p>
    File rules can use leading or trailing permissions. The permissions
    should not be specified as a trailing permission, but rather used at the
    start of the rule. This is important in that it makes file rules behave
    like any other rule types.
   </p><div class="verbatim-wrap"><pre class="screen">/path rw,            # old style
rw /path,            # leading permission
file rw /path,       # with explicit 'file' keyword
allow file rw /path, # optional 'allow' keyword added</pre></div></section><section class="sect2" id="sec-apparmor-profiles-perm-owner" data-id-title="Owner conditional rules"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.7.8 </span><span class="title-name">Owner conditional rules</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-perm-owner">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The file rules can be extended so that they can be conditional upon
    the user being the owner of the file (the fsuid needs to match the
    file's uid). For this purpose the <code class="literal">owner</code> keyword
    is put in front of the rule. Owner conditional rules accumulate like
    regular file rules do.
   </p><div class="verbatim-wrap"><pre class="screen">owner /home/*/** rw</pre></div><p>
    When using file ownership conditions with link rules the ownership test
    is done against the target file so the user must own the file to be able
    to link to it.
   </p><div id="id-1.7.8.5.15.11.5" data-id-title="Precedence of regular file rules" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Precedence of regular file rules</div><p>
     Owner conditional rules are considered a subset of regular file rules.
     If a regular file rule overlaps with an owner conditional file rule,
     the rules are merged. Consider the following example.
    </p><div class="verbatim-wrap"><pre class="screen">/foo r,
owner /foo rw,  # or w,</pre></div><p>
     The rules are merged—it results in <code class="literal">r</code> for
     everybody, and <code class="literal">w</code> for the owner only.
    </p></div><div id="id-1.7.8.5.15.11.6" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     To address everybody <span class="emphasis"><em>but</em></span> the owner of the file,
     use the keyword <code class="literal">other</code>.
    </p><div class="verbatim-wrap"><pre class="screen">owner /foo rw,
other /foo r,</pre></div></div></section><section class="sect2" id="sec-apparmor-profiles-perm-deny" data-id-title="Deny rules"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.7.9 </span><span class="title-name">Deny rules</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-perm-deny">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Deny rules can be used to annotate or quiet known rejects. The
    profile generating tools will not ask about a known reject treated
    with a deny rule. Such a reject will also not show up in the audit
    logs when denied, keeping the log files lean. If this is not
    desired, put the keyword <code class="literal">audit</code> in front of the
    deny entry.
   </p><p>
    It is also possible to use deny rules in combination with allow rules.
    This allows you to specify a broad allow rule, and then subtract a few
    known files that should not be allowed. Deny rules can also be combined
    with owner rules, to deny files owned by the user. The following example
    allows read/write access to everything in a users directory except write
    access to the <code class="filename">.ssh/</code> files:
   </p><div class="verbatim-wrap"><pre class="screen">deny /home/*/.ssh/** w,
owner /home/*/** rw,</pre></div><p>
    The extensive use of deny rules is generally not encouraged, because it
    makes it much harder to understand what a profile does. However a
    judicious use of deny rules can simplify profiles. Therefore the tools
    only generate profiles denying specific files and will not use
    globbing in deny rules. Manually edit your profiles to add deny rules
    using globbing. Updating such profiles using the tools is safe, because
    the deny entries will not be touched.
   </p></section></section><section class="sect1" id="sec-apparmor-profiles-mount" data-id-title="Mount rules"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.8 </span><span class="title-name">Mount rules</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-mount">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> can limit mount and unmount operations, including file system
   types and mount flags. The rule syntax is based on the
   <code class="command">mount</code> command syntax and starts with one of the
   keywords <code class="literal">mount</code>, <code class="literal">remount</code>, or
   <code class="literal">umount</code>. Conditions are optional and unspecified
   conditionals are assumed to match all entries. For example, not
   specifying a file system means that all file systems are matched.
  </p><p>
   Conditionals can be specified by specifying conditionals with
   <code class="literal">options=</code> or <code class="literal">options in</code>.
  </p><p>
    <code class="literal">options=</code> specifies conditionals that have to be met
    exactly. The rule
  </p><div class="verbatim-wrap"><pre class="screen">mount options=ro /dev/foo -E /mnt/,</pre></div><p>
    matches
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro /dev/foo /mnt</code></pre></div><p>
    but does not match
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro,atime /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o rw /dev/foo /mnt</code></pre></div><p>
   <code class="literal">options in</code> requires that at least one of the
   listed mount options is used. The rule
  </p><div class="verbatim-wrap"><pre class="screen">mount options in (ro,atime) /dev/foo -&gt; /mnt/,</pre></div><p>
   matches
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o ro,atime /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o atime /dev/foo /mnt</code></pre></div><p>
   but does not match
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro,sync /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o ro,atime,sync /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o rw /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o rw,noatime /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount /dev/foo /mnt</code></pre></div><p>
   With multiple conditionals, the rule grants permission for each set
   of options. The rule
  </p><div class="verbatim-wrap"><pre class="screen">mount options=ro options=atime</pre></div><p>
   matches
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o atime /dev/foo /mnt</code></pre></div><p>
   but does not match
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro,atime /dev/foo /mnt</code></pre></div><p>
   Separate mount rules are distinct and the options do not accumulate.
   The rules
  </p><div class="verbatim-wrap"><pre class="screen">mount options=ro,
mount options=atime,</pre></div><p>
   are not equivalent to
  </p><div class="verbatim-wrap"><pre class="screen">mount options=(ro,atime),
mount options in (ro,atime),</pre></div><p>
   The following rule allows mounting <code class="filename">/dev/foo</code> on
   <code class="filename">/mnt/</code> read only and using inode access times or
   allows mounting <code class="filename">/dev/foo</code> on
   <code class="filename">/mnt/</code> with some combination of 'nodev' and
   'user'.
  </p><div class="verbatim-wrap"><pre class="screen">mount options=(ro, atime) options in (nodev, user) /dev/foo -&gt; /mnt/,</pre></div><p>
   allows
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro,atime /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o nodev /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o user /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o nodev,user /dev/foo /mnt</code></pre></div></section><section class="sect1" id="sec-apparmor-profiles-pivot-root" data-id-title="Pivot root rules"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.9 </span><span class="title-name">Pivot root rules</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-pivot-root">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> can limit changing the root file system. The syntax is
  </p><div class="verbatim-wrap"><pre class="screen">pivot_root [oldroot=<em class="replaceable">OLD_ROOT</em>] <em class="replaceable">NEW_ROOT</em></pre></div><p>
   The paths specified in 'pivot_root' rules must end with '/' since they
   are directories.
  </p><div class="verbatim-wrap"><pre class="screen"># Allow any pivot
pivot_root,

# Allow pivoting to any new root directory and putting the old root
# directory at /mnt/root/old/
pivot_root oldroot=/mnt/root/old/,

# Allow pivoting the root directory to /mnt/root/
pivot_root /mnt/root/,

# Allow pivoting to /mnt/root/ and putting the old root directory at
# /mnt/root/old/
pivot_root oldroot=/mnt/root/old/ /mnt/root/,

# Allow pivoting to /mnt/root/, putting the old root directory at
# /mnt/root/old/ and transition to the /mnt/root/sbin/init profile
pivot_root oldroot=/mnt/root/old/ /mnt/root/ -&gt; /mnt/root/sbin/init,</pre></div></section><section class="sect1" id="sec-apparmor-profiles-ptrace" data-id-title="PTrace rules"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.10 </span><span class="title-name">PTrace rules</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-ptrace">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> supports limiting ptrace system calls. ptrace rules are
   accumulated so that the granted ptrace permissions are the union of
   all the listed ptrace rule permissions. If a rule does not specify
   an access list, permissions are implicitly granted.
  </p><p>
   The <code class="literal">trace</code> and <code class="literal">tracedby</code>
   permissions control ptrace(2); <code class="literal">read</code> and
   <code class="literal">readby</code> control proc(5) file system access,
   kcmp(2), futexes (get_robust_list(2)) and perf trace events.
  </p><p>
   For a ptrace operation to be allowed, the tracing and traced
   processes need the correct permissions. This means that the tracing
   process needs the <code class="literal">trace</code> permission and the traced
   process needs the <code class="literal">tracedby</code> permission.
  </p><p>
   Example AppArmor PTrace rules:
  </p><div class="verbatim-wrap"><pre class="screen"># Allow all PTrace access
ptrace,

# Explicitly allow all PTrace access,
ptrace (read, readby, trace, tracedby),

# Explicitly deny use of ptrace(2)
deny ptrace (trace),

# Allow unconfined processes (eg, a debugger) to ptrace us
ptrace (readby, tracedby) peer=unconfined,

# Allow ptrace of a process running under the /usr/bin/foo profile
ptrace (trace) peer=/usr/bin/foo,</pre></div></section><section class="sect1" id="sec-apparmor-profiles-signal" data-id-title="Signal rules"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.11 </span><span class="title-name">Signal rules</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-signal">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> supports limiting inter-process signals. AppArmor signal rules
   are accumulated so that the granted signal permissions are the union
   of all the listed signal rule permissions. <span class="phrase">AppArmor</span> signal permissions
   are implied when a rule does not explicitly state an access list.
  </p><p>
   The sending and receiving process must both have the correct
   permissions.
  </p><p>
   Example signal rules:
  </p><div class="verbatim-wrap"><pre class="screen"># Allow all signal access
signal,

# Explicitly deny sending the HUP and INT signals
deny signal (send) set=(hup, int),

# Allow unconfined processes to send us signals
signal (receive) peer=unconfined,

# Allow sending of signals to a process running under the /usr/bin/foo
# profile
signal (send) peer=/usr/bin/foo,

# Allow checking for PID existence
signal (receive, send) set=("exists"),

# Allow us to signal ourselves using the built-in @{profile_name} variable
signal peer=@{profile_name},

# Allow two real-time signals
signal set=(rtmin+0 rtmin+32),</pre></div></section><section class="sect1" id="sec-apparmor-profiles-exec" data-id-title="Execute modes"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.12 </span><span class="title-name">Execute modes</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Execute modes, also named profile transitions, consist of the following
   modes:
  </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">Px</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Discrete profile execute mode
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">Cx</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Discrete local profile execute mode
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">Ux</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Unconfined execute mode
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">ix</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Inherit execute mode
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        <code class="literal">m</code>
       </p>
      </td><td>
       <p>
        Allow <code class="literal">PROT_EXEC</code> with <code class="command">mmap(2)</code>
        calls
       </p>
      </td></tr></tbody></table></div><section class="sect2" id="sec-apparmor-profiles-exec-px" data-id-title="Discrete profile execute mode (px)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.12.1 </span><span class="title-name">Discrete profile execute mode (px)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec-px">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This mode requires that a discrete security profile is defined for a
    resource executed at an <span class="phrase">AppArmor</span> domain transition. If there is no
    profile defined, the access is denied.
   </p><p>
    Incompatible with <code class="literal">Ux</code>, <code class="literal">ux</code>,
    <code class="literal">px</code>, and <code class="literal">ix</code>.
   </p></section><section class="sect2" id="sec-apparmor-profiles-exec-cx" data-id-title="Discrete local profile execute mode (cx)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.12.2 </span><span class="title-name">Discrete local profile execute mode (cx)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec-cx">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As <code class="literal">Px</code>, but instead of searching the global profile
    set, <code class="literal">Cx</code> only searches the local profiles of the
    current profile. This profile transition provides a way for an
    application to have alternate profiles for helper applications.
   </p><div id="id-1.7.8.5.20.5.3" data-id-title="Limitations of the discrete local profile execute mode (cx)" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Limitations of the discrete local profile execute mode (cx)</div><p>
     Currently, Cx transitions are limited to top level profiles and cannot
     be used in hats and children profiles. This restriction will be removed
     in the future.
    </p></div><p>
    Incompatible with <code class="literal">Ux</code>, <code class="literal">ux</code>,
    <code class="literal">Px</code>, <code class="literal">px</code>, <code class="literal">cx</code>, and
    <code class="literal">ix</code>.
   </p></section><section class="sect2" id="sec-apparmor-profiles-exec-ux" data-id-title="Unconfined execute mode (ux)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.12.3 </span><span class="title-name">Unconfined execute mode (ux)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec-ux">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Allows the program to execute the resource without any <span class="phrase">AppArmor</span> profile
    applied to the executed resource. This mode is useful when a confined
    program needs to be able to perform a privileged operation, such as
    rebooting the machine. By placing the privileged section in another
    executable and granting unconfined execution rights, it is possible to
    bypass the mandatory constraints imposed on all confined processes.
    Allowing a root process to go unconfined means it can change <span class="phrase">AppArmor</span>
    policy itself. For more information about what is constrained, see the
    <code class="systemitem">apparmor(7)</code> man page.
   </p><p>
    This mode is incompatible with <code class="literal">ux</code>,
    <code class="literal">px</code>, <code class="literal">Px</code>, and <code class="literal">ix</code>.
   </p></section><section class="sect2" id="sec-apparmor-profiles-exec-clean" data-id-title="Unsafe exec modes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.12.4 </span><span class="title-name">Unsafe exec modes</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec-clean">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use the lowercase versions of exec modes—<code class="literal">px</code>,
    <code class="literal">cx</code>, <code class="literal">ux</code>—only in very
    special cases. They do not scrub the environment of variables such as
    <code class="envar">LD_PRELOAD</code>. As a result, the calling domain may have an
    undue amount of influence over the called resource. Use these modes only
    if the child absolutely <span class="emphasis"><em>must</em></span> be run unconfined and
    <code class="envar">LD_PRELOAD</code> must be used. Any profile using such modes
    provides negligible security. Use at your own risk.
   </p></section><section class="sect2" id="sec-apparmor-profiles-exec-ix" data-id-title="Inherit execute mode (ix)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.12.5 </span><span class="title-name">Inherit execute mode (ix)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec-ix">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="literal">ix</code> prevents the normal <span class="phrase">AppArmor</span> domain transition on
    <code class="command">execve(2)</code> when the profiled program executes the
    named program. Instead, the executed resource inherits the current
    profile.
   </p><p>
    This mode is useful when a confined program needs to call another
    confined program without gaining the permissions of the target's profile
    or losing the permissions of the current profile. There is no version to
    scrub the environment because <code class="literal">ix</code> executions do not
    change privileges.
   </p><p>
    Incompatible with <code class="literal">cx</code>, <code class="literal">ux</code>, and
    <code class="literal">px</code>. Implies <code class="literal">m</code>.
   </p></section><section class="sect2" id="sec-apparmor-profiles-exec-m" data-id-title="Allow executable mapping (m)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.12.6 </span><span class="title-name">Allow executable mapping (m)</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec-m">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This mode allows a file to be mapped into memory using
    <code class="command">mmap(2)</code>'s <code class="envar">PROT_EXEC</code> flag. This flag
    marks the pages executable. It is used on some architectures to provide
    non executable data pages, which can complicate exploit attempts.
    <span class="phrase">AppArmor</span> uses this mode to limit which files a well-behaved program (or
    all programs on architectures that enforce non executable memory access
    controls) may use as libraries, to limit the effect of invalid
    <code class="option">-L</code> flags given to <code class="command">ld(1)</code> and
    <code class="envar">LD_PRELOAD</code>, <code class="envar">LD_LIBRARY_PATH</code>, given to
    <code class="command">ld.so(8)</code>.
   </p></section><section class="sect2" id="sec-apparmor-profiles-exec-named" data-id-title="Named profile transitions"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.12.7 </span><span class="title-name">Named profile transitions</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec-named">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    By default, the <code class="literal">px</code> and <code class="literal">cx</code> (and
    their clean exec variants, too) transition to a profile whose name
    matches the executable name. With named profile transitions, you can
    specify a profile to be transitioned to. This is useful if multiple
    binaries need to share a single profile, or if they need to use a
    different profile than their name would specify. Named profile
    transitions can be used with <code class="literal">cx</code>,
    <code class="literal">Cx</code>, <code class="literal">px</code> and <code class="literal">Px</code>.
    Currently there is a limit of twelve named profile transitions per
    profile.
   </p><p>
    Named profile transitions use <code class="literal">-&gt;</code> to indicate the
    name of the profile that needs to be transitioned to:
   </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/foo
{
  /bin/** px -&gt; shared_profile,
  ...
  /usr/*bash cx -&gt; local_profile,
  ...
  profile local_profile
  {
    ...
  }
}</pre></div><div id="id-1.7.8.5.20.10.5" data-id-title="Difference between normal and named transitions" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Difference between normal and named transitions</div><p>
     When used with globbing, normal transitions provide a <span class="quote">“<span class="quote">one to
     many</span>”</span> relationship—<code class="literal">/bin/** px</code> will
     transition to <code class="filename">/bin/ping</code>,
     <code class="filename">/bin/cat</code>, etc, depending on the program being run.
    </p><p>
     Named transitions provide a <span class="quote">“<span class="quote">many to one</span>”</span>
     relationship—all programs that match the rule regardless of
     their name will transition to the specified profile.
    </p><p>
     Named profile transitions show up in the log as having the mode
     <code class="literal">Nx</code>. The name of the profile to be changed to is
     listed in the <code class="literal">name2</code> field.
    </p></div></section><section class="sect2" id="sec-apparmor-profiles-exec-fallback" data-id-title="Fallback modes for profile transitions"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.12.8 </span><span class="title-name">Fallback modes for profile transitions</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec-fallback">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="literal">px</code> and <code class="literal">cx</code> transitions specify
    a hard dependency—if the specified profile does not exist, the
    exec will fail. With the inheritance fallback, the execution will
    succeed but inherit the current profile. To specify inheritance
    fallback, <code class="literal">ix</code> is combined with <code class="literal">cx</code>,
    <code class="literal">Cx</code>, <code class="literal">px</code> and <code class="literal">Px</code>
    into the modes <code class="literal">cix</code>, <code class="literal">Cix</code>,
    <code class="literal">pix</code> and <code class="literal">Pix</code>.
   </p><div class="verbatim-wrap"><pre class="screen">/path Cix -&gt; profile_name,</pre></div><p>
    or
   </p><div class="verbatim-wrap"><pre class="screen">Cix /path -&gt; profile_name,</pre></div><p>
    where <code class="literal">-&gt; profile_name</code> is optional.
   </p><p>
    The same applies if you add the unconfined <code class="literal">ux</code> mode,
    where the resulting modes are <code class="literal">cux</code>,
    <code class="literal">CUx</code>, <code class="literal">pux</code> and
    <code class="literal">PUx</code>. These modes allow falling back to
    <span class="quote">“<span class="quote">unconfined</span>”</span> when the specified profile is not found.
   </p><div class="verbatim-wrap"><pre class="screen">/path PUx -&gt; profile_name,</pre></div><p>
    or
   </p><div class="verbatim-wrap"><pre class="screen">PUx /path -&gt; profile_name,</pre></div><p>
    where <code class="literal">-&gt; profile_name</code> is optional.
   </p><p>
    The fallback modes can be used with named profile transitions, too.
   </p></section><section class="sect2" id="sec-apparmor-profiles-exec-variables" data-id-title="Variable settings in execution modes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.12.9 </span><span class="title-name">Variable settings in execution modes</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec-variables">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When choosing one of the Px, Cx or Ux execution modes, take into account
    that the following environment variables are removed from the
    environment before the child process inherits it. As a consequence,
    applications or processes relying on any of these variables do not work
    anymore if the profile applied to them carries Px, Cx or Ux flags:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="envar">GCONV_PATH</code>
     </p></li><li class="listitem"><p>
      <code class="envar">GETCONF_DIR</code>
     </p></li><li class="listitem"><p>
      <code class="envar">HOSTALIASES</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LD_AUDIT</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LD_DEBUG</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LD_DEBUG_OUTPUT</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LD_DYNAMIC_WEAK</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LD_LIBRARY_PATH</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LD_ORIGIN_PATH</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LD_PRELOAD</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LD_PROFILE</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LD_SHOW_AUXV</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LD_USE_LOAD_BIAS</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LOCALDOMAIN</code>
     </p></li><li class="listitem"><p>
      <code class="envar">LOCPATH</code>
     </p></li><li class="listitem"><p>
      <code class="envar">MALLOC_TRACE</code>
     </p></li><li class="listitem"><p>
      <code class="envar">NLSPATH</code>
     </p></li><li class="listitem"><p>
      <code class="envar">RESOLV_HOST_CONF</code>
     </p></li><li class="listitem"><p>
      <code class="envar">RES_OPTIONS</code>
     </p></li><li class="listitem"><p>
      <code class="envar">TMPDIR</code>
     </p></li><li class="listitem"><p>
      <code class="envar">TZDIR</code>
     </p></li></ul></div></section><section class="sect2" id="sec-apparmor-profiles-exec-clean-keywords" data-id-title="safe and unsafe keywords"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">32.12.10 </span><span class="title-name"><code class="literal">safe</code> and <code class="literal">unsafe</code> keywords</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-exec-clean-keywords">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can use the <code class="literal">safe</code> and <code class="literal">unsafe</code>
    keywords for rules instead of using the case modifier of execution
    modes. For example
   </p><div class="verbatim-wrap"><pre class="screen">/example_rule Px,</pre></div><p>
    is the same as any of the following
   </p><div class="verbatim-wrap"><pre class="screen">safe /example_rule px,
safe /example_rule Px,
safe px /example_rule,
safe Px /example_rule,</pre></div><p>
    and the rule
   </p><div class="verbatim-wrap"><pre class="screen">/example_rule px,</pre></div><p>
    is the same as any of
   </p><div class="verbatim-wrap"><pre class="screen">unsafe /example_rule px,
unsafe /example_rule Px,
unsafe px /example_rule,
unsafe Px /example_rule,</pre></div><p>
    The <code class="literal">safe</code>/<code class="literal">unsafe</code> keywords are
    mutually exclusive and can be used in a file rule after the
    <code class="literal">owner</code> keyword, so the order of rule keywords is
   </p><div class="verbatim-wrap"><pre class="screen">[audit] [deny] [owner] [safe|unsafe] file_rule</pre></div></section></section><section class="sect1" id="sec-apparmor-profiles-rlimit" data-id-title="Resource limit control"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.13 </span><span class="title-name">Resource limit control</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-rlimit">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> can set and control an application's resource
   limits (rlimits, also known as ulimits). By default, <span class="phrase">AppArmor</span> does not
   control application's rlimits, and it will only control those limits
   specified in the confining profile. For more information about resource
   limits, refer to the <code class="systemitem">setrlimit(2)</code>,
   <code class="systemitem">ulimit(1)</code>, or <code class="systemitem">ulimit(3)</code>
   man pages.
  </p><p>
   <span class="phrase">AppArmor</span> leverages the system's rlimits and as such does not provide an
   additional auditing that would normally occur. It also cannot raise
   rlimits set by the system, <span class="phrase">AppArmor</span> rlimits can only reduce an
   application's current resource limits.
  </p><p>
   The values will be inherited by the children of a process and will remain
   even if a new profile is transitioned to or the application becomes
   unconfined. So when an application transitions to a new profile, that
   profile can further reduce the application's rlimits.
  </p><p>
   <span class="phrase">AppArmor</span>'s rlimit rules will also provide mediation of setting an
   application's hard limits, should it try to raise them. The application
   cannot raise its hard limits any further than specified in
   the profile. The mediation of raising hard limits is not inherited as the
   set value is, so that when the application transitions to a new profile
   it is free to raise its limits as specified in the profile.
  </p><p>
   <span class="phrase">AppArmor</span>'s rlimit control does not affect an application's soft limits
   beyond ensuring that they are less than or equal to the application's
   hard limits.
  </p><p>
   <span class="phrase">AppArmor</span>'s hard limit rules have the general form of:
  </p><div class="verbatim-wrap"><pre class="screen">set rlimit <em class="replaceable">RESOURCE</em> &lt;= <em class="replaceable">value</em>,</pre></div><p>
   where <em class="replaceable">RESOURCE</em> and
   <em class="replaceable">VALUE</em> are to be replaced with the following
   values:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.5.21.10.1"><span class="term"><code class="literal">cpu</code>
    </span></dt><dd><p>
      CPU time limit in seconds.
     </p></dd><dt id="id-1.7.8.5.21.10.2"><span class="term"><code class="literal">fsize</code>, <code class="literal">data</code>, <code class="literal">stack</code>,
      <code class="literal">core</code>, <code class="literal">rss</code>, <code class="literal">as</code>,
      <code class="literal">memlock</code>, <code class="literal">msgqueue</code>
    </span></dt><dd><p>
      a number in bytes, or a number with a suffix where the suffix can be
      K/KB (kilobytes), M/MB (megabytes), G/GB (gigabytes), for example
     </p><div class="verbatim-wrap"><pre class="screen">rlimit data &lt;= 100M,</pre></div></dd><dt id="id-1.7.8.5.21.10.3"><span class="term"><code class="literal">fsize</code>, <code class="literal">nofile</code>, <code class="literal">locks</code>,
      <code class="literal">sigpending</code>, <code class="literal">nproc</code><sup>*</sup>,
      <code class="literal">rtprio</code>
    </span></dt><dd><p>
      a number greater or equal to 0
     </p></dd><dt id="id-1.7.8.5.21.10.4"><span class="term"><code class="literal">nice</code>
    </span></dt><dd><p>
      a value between -20 and 19
     </p></dd></dl></div><p>
   <sup>*</sup>The nproc rlimit is handled different than
   all the other rlimits. Instead of indicating the standard process rlimit
   it controls the maximum number of processes that can be running under the
   profile at any time. When the limit is exceeded the creation of new
   processes under the profile will fail until the number of currently
   running processes is reduced.
  </p><div id="id-1.7.8.5.21.12" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    Currently the tools cannot be used to add rlimit rules to profiles. The
    only way to add rlimit controls to a profile is to manually edit the
    profile with a text editor. The tools will still work with profiles
    containing rlimit rules and will not remove them, so it is safe to use
    the tools to update profiles containing them.
   </p></div></section><section class="sect1" id="sec-apparmor-profiles-audit" data-id-title="Auditing rules"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">32.14 </span><span class="title-name">Auditing rules</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-profiles-audit">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> provides the ability to audit given rules so that when they are
   matched an audit message will appear in the audit log. To enable audit
   messages for a given rule, the <code class="literal">audit</code> keyword is
   put in front of the rule:
  </p><div class="verbatim-wrap"><pre class="screen">audit /etc/foo/*        rw,</pre></div><p>
   If it is desirable to audit only a given permission the rule can be split
   into two rules. The following example will result in audit messages when
   files are opened for writing, but not when they are opened for reading:
  </p><div class="verbatim-wrap"><pre class="screen">audit /etc/foo/*  w,
/etc/foo/*        r,</pre></div><div id="id-1.7.8.5.22.6" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    Audit messages are not generated for every read or write of a file but
    only when a file is opened for reading or writing.
   </p></div><p>
   Audit control can be combined with
   <code class="literal">owner</code>/<code class="literal">other</code> conditional file rules
   to provide auditing when users access files they own/do not own:
  </p><div class="verbatim-wrap"><pre class="screen">audit owner /home/*/.ssh/**       rw,
audit other /home/*/.ssh/**       r,</pre></div></section></section><section class="chapter" id="cha-apparmor-repos" data-id-title="AppArmor profile repositories"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">33 </span><span class="title-name"><span class="phrase">AppArmor</span> profile repositories</span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-repos">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_repositories.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  <span class="phrase">AppArmor</span> ships with a set of profiles enabled by default. These are created
  by the <span class="phrase">AppArmor</span> developers, and are stored in
  <code class="filename">/etc/apparmor.d</code>. In addition to these profiles,

  <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> ships profiles for individual applications together with
  the relevant application. These profiles are not enabled by default, and
  reside under another directory than the standard <span class="phrase">AppArmor</span> profiles,
  <code class="filename">/usr/share/apparmor/extra-profiles</code>.
 </p><p>
   The <span class="phrase">AppArmor</span> tools (YaST, <code class="command">aa-genprof</code> and
   <code class="command">aa-logprof</code>) support the use of a local repository.
   Whenever you start to create a new profile from scratch, and there
   already is an inactive profile in your local repository, you are asked
   whether you want to use the existing inactive one from
   <code class="filename">/usr/share/apparmor/extra-profiles</code> and whether you want
   to base your efforts on it. If you decide to use this profile, it gets
   copied over to the directory of profiles enabled by default
   (<code class="filename">/etc/apparmor.d</code>) and loaded whenever <span class="phrase">AppArmor</span> is
   started. Any further adjustments will be done to the active profile under
   <code class="filename">/etc/apparmor.d</code>.
  </p></section><section class="chapter" id="cha-apparmor-yast" data-id-title="Building and managing profiles with YaST"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">34 </span><span class="title-name">Building and managing profiles with YaST</span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-yast">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_yast.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  YaST provides a basic way to build profiles and manage <span class="phrase">AppArmor®</span>
  profiles. It provides two interfaces: a graphical one and a text-based
  one. The text-based interface consumes less resources and bandwidth,
  making it a better choice for remote administration, or for times when a
  local graphical environment is inconvenient. Although the interfaces have
  differing appearances, they offer the same functionality in similar ways.
  Another alternative is to use <span class="phrase">AppArmor</span> commands, which can control <span class="phrase">AppArmor</span>
  from a terminal window or through remote connections. The command line
  tools are described in <a class="xref" href="#cha-apparmor-commandline" title="Chapter 35. Building profiles from the command line">Chapter 35, <em>Building profiles from the command line</em></a>.
 </p><p>
  Start YaST from the main menu and enter your <code class="systemitem">root</code> password
  when prompted for it. Alternatively, start YaST by opening a terminal
  window, logging in as <code class="systemitem">root</code>, and entering <code class="command">yast2</code>
  for the graphical mode or <code class="command">yast</code> for the text-based mode.
 </p><p>
  In the <span class="guimenu">Security and Users</span> section, there is an
  <span class="guimenu"><span class="phrase">AppArmor</span> Configuration</span> icon. Click it to launch the
  <span class="phrase">AppArmor</span> YaST module.
 </p><section class="sect1" id="sec-apparmor-yast-add" data-id-title="Manually adding a profile"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">34.1 </span><span class="title-name">Manually adding a profile</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-yast-add">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_yast.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> enables you to create an <span class="phrase">AppArmor</span> profile by manually adding
   entries into the profile. Select the application for which to create a
   profile, then add entries.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Start YaST, select <span class="guimenu"><span class="phrase">AppArmor</span> Configuration</span>, and
     click <span class="guimenu">Manually Add Profile</span> in the main window.
    </p></li><li class="step"><p>
     Browse your system to find the application for which to create a
     profile.
    </p></li><li class="step"><p>
     When you find the application, select it and click
     <span class="guimenu">Open</span>. A basic, empty profile appears in the
     <span class="guimenu"><span class="phrase">AppArmor</span> Profile Dialog</span> window.
    </p></li><li class="step"><p>
     In <span class="guimenu"><span class="phrase">AppArmor</span> Profile Dialog</span>, add, edit, or delete
     <span class="phrase">AppArmor</span> profile entries by clicking the corresponding buttons and
     referring to
     <a class="xref" href="#sec-apparmor-yast-edit-add" title="34.2.1. Adding an entry">Section 34.2.1, “Adding an entry”</a>,
     <a class="xref" href="#sec-apparmor-yast-edit-edit" title="34.2.2. Editing an entry">Section 34.2.2, “Editing an entry”</a>,
     or
     <a class="xref" href="#sec-apparmor-yast-edit-del" title="34.2.3. Deleting an entry">Section 34.2.3, “Deleting an entry”</a>.
    </p></li><li class="step"><p>
     When finished, click <span class="guimenu">Done</span>.
    </p></li></ol></div></div></section><section class="sect1" id="sec-apparmor-yast-edit" data-id-title="Editing profiles"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">34.2 </span><span class="title-name">Editing profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-yast-edit">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_yast.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.8.7.7.2" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    YaST offers basic manipulation for <span class="phrase">AppArmor</span> profiles, such
    as creating or editing. However, the most straightforward way
    to edit an <span class="phrase">AppArmor</span>
    profile is to use a text editor such as <code class="command">vi</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> vi /etc/apparmor.d/usr.sbin.httpd2-prefork</pre></div></div><div id="id-1.7.8.7.7.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
    The <code class="command">vi</code> editor also includes syntax (error)
    highlighting and syntax error highlighting, which visually warns you
    when the syntax of the edited <span class="phrase">AppArmor</span> profile is wrong.
   </p></div><p>
   <span class="phrase">AppArmor</span> enables you to edit <span class="phrase">AppArmor</span> profiles manually by adding, editing,
   or deleting entries. To edit a profile, proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Start YaST, select <span class="guimenu"><span class="phrase">AppArmor</span> Configuration</span>, and
     click <span class="guimenu">Manage Existing Profiles</span> in the main window.
    </p><div class="informalfigure"><div class="mediaobject"><a href="images/edit_1.png"><img src="images/edit_1.png" alt="Choose the profile to edit" title="Choose the profile to edit"/></a></div></div></li><li class="step"><p>
     From the list of profiled applications, select the profile to edit.
    </p></li><li class="step"><p>
     Click <span class="guimenu">Edit</span>. The <span class="guimenu"><span class="phrase">AppArmor</span> Profile
     Dialog</span> window displays the profile.
    </p><div class="informalfigure"><div class="mediaobject"><a href="images/edit_2.png"><img src="images/edit_2.png" alt="AppArmor profile dialog" title="AppArmor profile dialog"/></a></div></div></li><li class="step"><p>
     In the <span class="guimenu"><span class="phrase">AppArmor</span> Profile Dialog</span> window, add, edit, or
     delete <span class="phrase">AppArmor</span> profile entries by clicking the corresponding buttons
     and referring to
     <a class="xref" href="#sec-apparmor-yast-edit-add" title="34.2.1. Adding an entry">Section 34.2.1, “Adding an entry”</a>,
     <a class="xref" href="#sec-apparmor-yast-edit-edit" title="34.2.2. Editing an entry">Section 34.2.2, “Editing an entry”</a>,
     or
     <a class="xref" href="#sec-apparmor-yast-edit-del" title="34.2.3. Deleting an entry">Section 34.2.3, “Deleting an entry”</a>.
    </p></li><li class="step"><p>
     When you are finished, click <span class="guimenu">Done</span>.
    </p></li><li class="step"><p>
     In the pop-up that appears, click <span class="guimenu">Yes</span> to confirm
     your changes to the profile and reload the <span class="phrase">AppArmor</span> profile set.
    </p></li></ol></div></div><div id="id-1.7.8.7.7.6" data-id-title="Syntax checking in AppArmor" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Syntax checking in <span class="phrase">AppArmor</span></div><p>
    <span class="phrase">AppArmor</span> contains a syntax check that notifies you of any syntax errors
    in profiles you are trying to process with the YaST <span class="phrase">AppArmor</span> tools.
    If an error occurs, edit the profile manually as <code class="systemitem">root</code> and
    reload the profile set with <code class="command">systemctl reload
    apparmor</code>.
   </p></div><section class="sect2" id="sec-apparmor-yast-edit-add" data-id-title="Adding an entry"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">34.2.1 </span><span class="title-name">Adding an entry</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-yast-edit-add">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_yast.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <span class="guimenu">Add Entry</span> button in the <span class="guimenu"><span class="phrase">AppArmor</span> Profile
    Window</span> lists types of entries you can add to the
    <span class="phrase">AppArmor</span> profile.
   </p><p>
    From the list, select one of the following:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.7.7.7.4.1"><span class="term">File</span></dt><dd><p>
       In the pop-up window, specify the absolute path of a file, including
       the type of access permitted. When finished, click
       <span class="guimenu">OK</span>.
      </p><p>
       You can use globbing if necessary. For globbing information, refer to
       <a class="xref" href="#sec-apparmor-profiles-glob" title="32.6. Profile names, flags, paths, and globbing">Section 32.6, “Profile names, flags, paths, and globbing”</a>.
       For file access permission information, refer to
       <a class="xref" href="#sec-apparmor-profiles-perm" title="32.7. File permission access modes">Section 32.7, “File permission access modes”</a>.
      </p><div class="informalfigure"><div class="mediaobject"><a href="images/add_2_addentry_file.png"><img src="images/add_2_addentry_file.png" width="35%" alt="Select a file to add" title="Select a file to add"/></a></div></div></dd><dt id="id-1.7.8.7.7.7.4.2"><span class="term">Directory</span></dt><dd><p>
       In the pop-up window, specify the absolute path of a directory,
       including the type of access permitted. You can use globbing if
       necessary. When finished, click <span class="guimenu">OK</span>.
      </p><p>
       For globbing information, refer to
       <a class="xref" href="#sec-apparmor-profiles-glob" title="32.6. Profile names, flags, paths, and globbing">Section 32.6, “Profile names, flags, paths, and globbing”</a>.
       For file access permission information, refer to
       <a class="xref" href="#sec-apparmor-profiles-perm" title="32.7. File permission access modes">Section 32.7, “File permission access modes”</a>.
      </p><div class="informalfigure"><div class="mediaobject"><a href="images/add_2_addentry_file.png"><img src="images/add_2_addentry_file.png" width="35%" alt="Select a directory to add" title="Select a directory to add"/></a></div></div></dd><dt id="id-1.7.8.7.7.7.4.3"><span class="term">Network rule</span></dt><dd><p>
       In the pop-up window, select the appropriate network family and the
       socket type. For more information, refer to
       <a class="xref" href="#sec-apparmor-profiles-nac" title="32.5. Network access control">Section 32.5, “Network access control”</a>.
      </p><div class="informalfigure"><div class="mediaobject"><a href="images/add_2_addentry_network.png"><img src="images/add_2_addentry_network.png" width="35%" alt="Select capabilities" title="Select capabilities"/></a></div></div></dd><dt id="id-1.7.8.7.7.7.4.4"><span class="term">Capability</span></dt><dd><p>
       In the pop-up window, select the appropriate capabilities. These are
       statements that enable each of the 32 POSIX.1e capabilities. Refer to
       <a class="xref" href="#sec-apparmor-profiles-capabilities" title="32.4. Capability entries (POSIX.1e)">Section 32.4, “Capability entries (POSIX.1e)”</a>
       for more information about capabilities. When finished making your
       selections, click <span class="guimenu">OK</span>.
      </p><div class="informalfigure"><div class="mediaobject"><a href="images/add_2_addentry_capability.png"><img src="images/add_2_addentry_capability.png" alt="Select capabilities" title="Select capabilities"/></a></div></div></dd><dt id="id-1.7.8.7.7.7.4.5"><span class="term">Include file</span></dt><dd><p>
       In the pop-up window, browse to the files to use as includes.
       Includes are directives that pull in components of other <span class="phrase">AppArmor</span>
       profiles to simplify profiles. For more information, refer to
       <a class="xref" href="#sec-apparmor-profiles-includes" title="32.3. Include statements">Section 32.3, “Include statements”</a>.
      </p></dd><dt id="id-1.7.8.7.7.7.4.6"><span class="term">Hat</span></dt><dd><p>
       In the pop-up window, specify the name of the subprofile
       (<span class="emphasis"><em>hat</em></span>) to add to your current profile and click
       <span class="guimenu">Create Hat</span>. For more information, refer to
       <a class="xref" href="#cha-apparmor-hat" title="Chapter 36. Profiling your Web applications using ChangeHat">Chapter 36, <em>Profiling your Web applications using ChangeHat</em></a>.
      </p><div class="informalfigure"><div class="mediaobject"><a href="images/add_2_addentry_hat.png"><img src="images/add_2_addentry_hat.png" width="60%" alt="enter subprofile name in popup window" title="enter subprofile name in popup window"/></a></div></div></dd></dl></div></section><section class="sect2" id="sec-apparmor-yast-edit-edit" data-id-title="Editing an entry"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">34.2.2 </span><span class="title-name">Editing an entry</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-yast-edit-edit">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_yast.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When you select <span class="guimenu">Edit Entry</span>, a pop-up window opens.
    From here, edit the selected entry.
   </p><p>
    In the pop-up window, edit the entry you need to modify. You can use
    globbing if necessary. When finished, click <span class="guimenu">OK</span>.
   </p><p>
    For globbing information, refer to
    <a class="xref" href="#sec-apparmor-profiles-glob" title="32.6. Profile names, flags, paths, and globbing">Section 32.6, “Profile names, flags, paths, and globbing”</a>. For access permission
    information, refer to <a class="xref" href="#sec-apparmor-profiles-perm" title="32.7. File permission access modes">Section 32.7, “File permission access modes”</a>.
   </p></section><section class="sect2" id="sec-apparmor-yast-edit-del" data-id-title="Deleting an entry"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">34.2.3 </span><span class="title-name">Deleting an entry</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-yast-edit-del">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_yast.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To delete an entry in a given profile, select <span class="guimenu">Delete
    Entry</span>. <span class="phrase">AppArmor</span> removes the selected profile entry.
   </p></section></section><section class="sect1" id="sec-apparmor-yast-del" data-id-title="Deleting a profile"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">34.3 </span><span class="title-name">Deleting a profile</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-yast-del">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_yast.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> enables you to delete an <span class="phrase">AppArmor</span> profile manually. Simply select
   the application for which to delete a profile then delete it as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Start YaST, select <span class="guimenu"><span class="phrase">AppArmor</span> Configuration</span>, and
     click <span class="guimenu">Manage Existing Profiles</span> in the main window.
    </p></li><li class="step"><p>
     Select the profile to delete.
    </p></li><li class="step"><p>
     Click <span class="guimenu">Delete</span>.
    </p></li><li class="step"><p>
     In the pop-up that opens, click <span class="guimenu">Yes</span> to delete the
     profile and reload the <span class="phrase">AppArmor</span> profile set.
    </p></li></ol></div></div></section><section class="sect1" id="sec-apparmor-yast-manage" data-id-title="Managing AppArmor"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">34.4 </span><span class="title-name">Managing <span class="phrase">AppArmor</span></span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-yast-manage">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_yast.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can change the status of <span class="phrase">AppArmor</span> by enabling or disabling it.
   Enabling <span class="phrase">AppArmor</span> protects your system from potential program
   exploitation. Disabling <span class="phrase">AppArmor</span>, even if your profiles have been set up,
   removes protection from your system. To change the status of <span class="phrase">AppArmor</span>,
   start YaST, select <span class="guimenu"><span class="phrase">AppArmor</span> Configuration</span>, and
   click <span class="guimenu">Settings</span> in the main window.
  </p><div class="informalfigure"><div class="mediaobject"><a href="images/sd_controlpanel_1.png"><img src="images/sd_controlpanel_1.png" alt="The AppArmor control panel" title="The AppArmor control panel"/></a></div></div><p>
   To change the status of <span class="phrase">AppArmor</span>, continue as described in
   <a class="xref" href="#sec-apparmor-yast-manage-status" title="34.4.1. Changing AppArmor status">Section 34.4.1, “Changing <span class="phrase">AppArmor</span> status”</a>.
   To change the mode of individual profiles, continue as described in
   <a class="xref" href="#sec-apparmor-yast-manage-profmodes" title="34.4.2. Changing the mode of individual profiles">Section 34.4.2, “Changing the mode of individual profiles”</a>.
  </p><section class="sect2" id="sec-apparmor-yast-manage-status" data-id-title="Changing AppArmor status"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">34.4.1 </span><span class="title-name">Changing <span class="phrase">AppArmor</span> status</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-yast-manage-status">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_yast.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When you change the status of <span class="phrase">AppArmor</span>, set it to enabled or disabled.
    When <span class="phrase">AppArmor</span> is enabled, it is installed, running, and enforcing the
    <span class="phrase">AppArmor</span> security policies.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start YaST, select <span class="guimenu"><span class="phrase">AppArmor</span> Configuration</span>, and
      click <span class="guimenu">Settings</span> in the main window.
     </p></li><li class="step"><p>
      Enable <span class="phrase">AppArmor</span> by checking <span class="guimenu">Enable <span class="phrase">AppArmor</span></span> or
      disable <span class="phrase">AppArmor</span> by deselecting it.
     </p></li><li class="step"><p>
      Click <span class="guimenu">Done</span> in the <span class="guimenu"><span class="phrase">AppArmor</span>
      Configuration</span> window.
     </p></li></ol></div></div><div id="id-1.7.8.7.9.5.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     You always need to restart running programs to apply the profiles to
     them.
    </p></div></section><section class="sect2" id="sec-apparmor-yast-manage-profmodes" data-id-title="Changing the mode of individual profiles"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">34.4.2 </span><span class="title-name">Changing the mode of individual profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-yast-manage-profmodes">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_yast.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <span class="phrase">AppArmor</span> can apply profiles in two different modes. In
    <span class="emphasis"><em>complain</em></span> mode, violations of <span class="phrase">AppArmor</span> profile rules,
    such as the profiled program accessing files not permitted by the
    profile, are detected. The violations are permitted, but also logged.
    This mode is convenient for developing profiles and is used by the
    <span class="phrase">AppArmor</span> tools for generating profiles. Loading a profile in
    <span class="emphasis"><em>enforce</em></span> mode enforces the policy defined in the
    profile, and reports policy violation attempts to
    <code class="systemitem">rsyslogd</code> (or
    <code class="systemitem">auditd</code> or
    <code class="systemitem">journalctl</code>, depending on system
    configuration).
   </p><p>
    The <span class="guimenu">Profile Mode Configuration</span> dialog allows you to
    view and edit the mode of currently loaded <span class="phrase">AppArmor</span> profiles. This
    feature is useful for determining the status of your system during
    profile development. During systemic profiling (see
    <a class="xref" href="#sec-apparmor-commandline-profiling-systemic" title="35.7.2. Systemic profiling">Section 35.7.2, “Systemic profiling”</a>), you can
    use this tool to adjust and monitor the scope of the profiles for which
    you are learning behavior.
   </p><p>
    To edit an application's profile mode, proceed as follows:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start YaST, select <span class="guimenu"><span class="phrase">AppArmor</span> Configuration</span>, and
      click <span class="guimenu">Settings</span> in the main window.
     </p></li><li class="step"><p>
      In the <span class="guimenu">Configure Profile Modes</span> section, select
      <span class="guimenu">Configure</span>.
     </p></li><li class="step"><p>
      Select the profile for which to change the mode.
     </p></li><li class="step"><p>
      Select <span class="guimenu">Toggle Mode</span> to set this profile to
      <span class="emphasis"><em>complain</em></span> mode or to <span class="emphasis"><em>enforce</em></span>
      mode.
     </p></li><li class="step"><p>
      Apply your settings and leave YaST with <span class="guimenu">Done</span>.
     </p></li></ol></div></div><p>
    To change the mode of all profiles, use <span class="guimenu">Set All to
    Enforce</span> or <span class="guimenu">Set All to Complain</span>.
   </p><div id="id-1.7.8.7.9.6.7" data-id-title="Listing the profiles available" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Listing the profiles available</div><p>
     By default, only active profiles are listed (any profile that has a
     matching application installed on your system). To set up a profile
     before installing the respective application, click <span class="guimenu">Show All
     Profiles</span> and select the profile to configure from the list
     that appears.
    </p></div></section></section></section><section class="chapter" id="cha-apparmor-commandline" data-id-title="Building profiles from the command line"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">35 </span><span class="title-name">Building profiles from the command line</span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-commandline">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  <span class="phrase">AppArmor®</span> provides the user the ability to use a command line interface
  rather than a graphical interface to manage and configure the system
  security. Track the status of <span class="phrase">AppArmor</span> and create, delete, or modify
  <span class="phrase">AppArmor</span> profiles using the <span class="phrase">AppArmor</span> command line tools.
 </p><div id="id-1.7.8.8.4" data-id-title="Background information" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Background information</div><p>
   Before starting to manage your profiles using the <span class="phrase">AppArmor</span> command line
   tools, check out the general introduction to <span class="phrase">AppArmor</span> given in
   <a class="xref" href="#cha-apparmor-concept" title="Chapter 31. Immunizing programs">Chapter 31, <em>Immunizing programs</em></a> and
   <a class="xref" href="#cha-apparmor-profiles" title="Chapter 32. Profile components and syntax">Chapter 32, <em>Profile components and syntax</em></a>.
  </p></div><section class="sect1" id="sec-apparmor-commandline-status" data-id-title="Checking the AppArmor status"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.1 </span><span class="title-name">Checking the <span class="phrase">AppArmor</span> status</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-status">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> can be in any one of three states:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.5.3.1"><span class="term">Unloaded</span></dt><dd><p>
      <span class="phrase">AppArmor</span> is not activated in the kernel.
     </p></dd><dt id="id-1.7.8.8.5.3.2"><span class="term">Running</span></dt><dd><p>
      <span class="phrase">AppArmor</span> is activated in the kernel and is enforcing <span class="phrase">AppArmor</span> program
      policies.
     </p></dd><dt id="id-1.7.8.8.5.3.3"><span class="term">Stopped</span></dt><dd><p>
      <span class="phrase">AppArmor</span> is activated in the kernel, but no policies are enforced.
     </p></dd></dl></div><p>
   Detect the state of <span class="phrase">AppArmor</span> by inspecting
   <code class="filename">/sys/kernel/security/apparmor/profiles</code>. If
   <code class="command">cat /sys/kernel/security/apparmor/profiles</code> reports a
   list of profiles, <span class="phrase">AppArmor</span> is running. If it is empty and returns nothing,
   <span class="phrase">AppArmor</span> is stopped. If the file does not exist, <span class="phrase">AppArmor</span> is unloaded.
  </p><p>
   Manage <span class="phrase">AppArmor</span> with <code class="command">systemctl</code>. It lets you perform the
   following operations:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.5.6.1"><span class="term"><code class="command">sudo systemctl start apparmor</code>
    </span></dt><dd><p>
      Behavior depends on the state of <span class="phrase">AppArmor</span>. If it is not activated,
      <code class="option">start</code> activates and starts it, putting it in the
      running state. If it is stopped, <code class="option">start</code> causes the
      re-scan of <span class="phrase">AppArmor</span> profiles usually found in
      <code class="filename">/etc/apparmor.d</code> and puts <span class="phrase">AppArmor</span> in the running
      state. If <span class="phrase">AppArmor</span> is already running, <code class="option">start</code> reports a
      warning and takes no action.
     </p><div id="id-1.7.8.8.5.6.1.2.2" data-id-title="Already running processes" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Already running processes</div><p>
       Already running processes need to be restarted to apply the <span class="phrase">AppArmor</span>
       profiles on them.
      </p></div></dd><dt id="id-1.7.8.8.5.6.2"><span class="term"><code class="command">sudo systemctl stop apparmor</code>
    </span></dt><dd><p>
      Stops <span class="phrase">AppArmor</span> if it is running by removing all profiles from kernel
      memory, effectively disabling all access controls, and putting <span class="phrase">AppArmor</span>
      into the stopped state. If the <span class="phrase">AppArmor</span> is already stopped,
      <code class="option">stop</code> tries to unload the profiles again, but nothing
      happens.
     </p></dd><dt id="id-1.7.8.8.5.6.3"><span class="term"><code class="command">sudo systemctl reload apparmor</code>
    </span></dt><dd><p>
      Causes the <span class="phrase">AppArmor</span> module to re-scan the profiles in
      <code class="filename">/etc/apparmor.d</code> without unconfining running
      
      processes. Freshly created profiles are enforced and recently deleted
      ones are removed from the <code class="filename">/etc/apparmor.d</code>
      directory.
     </p></dd></dl></div></section><section class="sect1" id="sec-apparmor-commandline-build" data-id-title="Building AppArmor profiles"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.2 </span><span class="title-name">Building <span class="phrase">AppArmor</span> profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-build">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <span class="phrase">AppArmor</span> module profile definitions are stored in the
   <code class="filename">/etc/apparmor.d</code> directory as plain text files. For a
   detailed description of the syntax of these files, refer to
   <a class="xref" href="#cha-apparmor-profiles" title="Chapter 32. Profile components and syntax">Chapter 32, <em>Profile components and syntax</em></a>.
  </p><p>
   All files in the <code class="filename">/etc/apparmor.d</code> directory are
   interpreted as profiles and are loaded as such. Renaming files in that
   directory is not an effective way of preventing profiles from being
   loaded. You must remove profiles from this directory to prevent them from
   being read and evaluated effectively, or call
   <code class="command">aa-disable</code> on the profile, which will create a
   symbolic link in <code class="filename">/etc/apparmor.d/disabled/</code>.
  </p><p>
   You can use a text editor, such as <code class="command">vi</code>, to access and
   make changes to these profiles. The following sections contain detailed
   steps for building profiles:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.6.5.1"><span class="term">Adding or creating <span class="phrase">AppArmor</span> profiles</span></dt><dd><p>
      Refer to <a class="xref" href="#sec-apparmor-commandline-add" title="35.3. Adding or creating an AppArmor profile">Section 35.3, “Adding or creating an <span class="phrase">AppArmor</span> profile”</a>
     </p></dd><dt id="id-1.7.8.8.6.5.2"><span class="term">Editing <span class="phrase">AppArmor</span> profiles</span></dt><dd><p>
      Refer to <a class="xref" href="#sec-apparmor-commandline-edit" title="35.4. Editing an AppArmor profile">Section 35.4, “Editing an <span class="phrase">AppArmor</span> profile”</a>
     </p></dd><dt id="id-1.7.8.8.6.5.3"><span class="term">Deleting <span class="phrase">AppArmor</span> profiles</span></dt><dd><p>
      Refer to
      <a class="xref" href="#sec-apparmor-commandline-del" title="35.6. Deleting an AppArmor profile">Section 35.6, “Deleting an <span class="phrase">AppArmor</span> profile”</a>
     </p></dd></dl></div></section><section class="sect1" id="sec-apparmor-commandline-add" data-id-title="Adding or creating an AppArmor profile"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.3 </span><span class="title-name">Adding or creating an <span class="phrase">AppArmor</span> profile</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-add">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To add or create an <span class="phrase">AppArmor</span> profile for an application, you can use a
   systemic or stand-alone profiling method, depending on your needs. Learn
   more about these two approaches in
   <a class="xref" href="#sec-apparmor-commandline-profiling" title="35.7. Two methods of profiling">Section 35.7, “Two methods of profiling”</a>.
  </p></section><section class="sect1" id="sec-apparmor-commandline-edit" data-id-title="Editing an AppArmor profile"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.4 </span><span class="title-name">Editing an <span class="phrase">AppArmor</span> profile</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-edit">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following steps describe the procedure for editing an <span class="phrase">AppArmor</span>
   profile:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     If you are not currently logged in as <code class="systemitem">root</code>, enter
     <code class="command">su</code> in a terminal window.
    </p></li><li class="step"><p>
     Enter the <code class="systemitem">root</code> password when prompted.
    </p></li><li class="step"><p>
     Go to the profile directory with <code class="command">cd
     /etc/apparmor.d/</code>.
    </p></li><li class="step"><p>
     Enter <code class="command">ls</code> to view all profiles currently installed.
    </p></li><li class="step"><p>
     Open the profile to edit in a text editor, such as vim.
    </p></li><li class="step"><p>
     Make the necessary changes, then save the profile.
    </p></li><li class="step"><p>
     Restart <span class="phrase">AppArmor</span> by entering <code class="command">systemctl reload
     apparmor</code> in a terminal window.
    </p></li></ol></div></div></section><section class="sect1" id="sec-apparmor-commandline-unload" data-id-title="Unloading unknown AppArmor profiles"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.5 </span><span class="title-name">Unloading unknown <span class="phrase">AppArmor</span> profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-unload">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.8.8.9.2" data-id-title="Danger of unloading wanted profiles" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Danger of unloading wanted profiles</div><p>
    <code class="command">aa-remove-unknown</code> will unload all profiles that
    are not stored in <code class="filename">/etc/apparmor.d</code>, for example
    automatically generated LXD profiles. This may compromise the
    security of the system. Use the <code class="option">-n</code> parameter to
    list all profiles that will be unloaded.
   </p></div><p>
   To unload all <span class="phrase">AppArmor</span> profiles that are no longer in
   <code class="filename">/etc/apparmor.d/</code>, run:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aa-remove-unknown</code></pre></div><p>
   You can print a list of profiles that will be removed:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aa-remove-unknown -n</code></pre></div></section><section class="sect1" id="sec-apparmor-commandline-del" data-id-title="Deleting an AppArmor profile"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.6 </span><span class="title-name">Deleting an <span class="phrase">AppArmor</span> profile</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-del">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following steps describe the procedure for deleting an <span class="phrase">AppArmor</span>
   profile.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Remove the <span class="phrase">AppArmor</span> definition from the kernel:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">apparmor_parser -R /etc/apparmor.d/<em class="replaceable">PROFILE</em></code></pre></div></li><li class="step"><p>
     Remove the definition file:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">rm /etc/apparmor.d/<em class="replaceable">PROFILE</em></code>
    <code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">rm /var/lib/apparmor/cache/<em class="replaceable">PROFILE</em></code></pre></div></li></ol></div></div></section><section class="sect1" id="sec-apparmor-commandline-profiling" data-id-title="Two methods of profiling"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.7 </span><span class="title-name">Two methods of profiling</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Given the syntax for <span class="phrase">AppArmor</span> profiles in
   <a class="xref" href="#cha-apparmor-profiles" title="Chapter 32. Profile components and syntax">Chapter 32, <em>Profile components and syntax</em></a>, you
   could create profiles without using the tools. However, the effort
   involved would be substantial. To avoid such a situation, use the <span class="phrase">AppArmor</span>
   tools to automate the creation and refinement of profiles.
  </p><p>
   There are two ways to approach <span class="phrase">AppArmor</span> profile creation. Tools are
   available for both methods.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.4.1"><span class="term">Stand-alone profiling</span></dt><dd><p>
      A method suitable for profiling small applications that have a finite
      runtime, such as user client applications like mail clients. For more
      information, refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-stand-alone" title="35.7.1. Stand-alone profiling">Section 35.7.1, “Stand-alone profiling”</a>.
     </p></dd><dt id="id-1.7.8.8.11.4.2"><span class="term">Systemic profiling</span></dt><dd><p>
      A method suitable for profiling many programs at once
      and for profiling applications that may run for days, weeks, or
      continuously across reboots, such as network server applications like
      Web servers and mail servers. For more information, refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-systemic" title="35.7.2. Systemic profiling">Section 35.7.2, “Systemic profiling”</a>.
     </p></dd></dl></div><p>
   Automated profile development becomes more manageable with the <span class="phrase">AppArmor</span>
   tools:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Decide which profiling method suits your needs.
    </p></li><li class="step"><p>
     Perform a static analysis. Run either <code class="command">aa-genprof</code> or
     <code class="command">aa-autodep</code>, depending on the profiling method
     chosen.
    </p></li><li class="step"><p>
     Enable dynamic learning. Activate learning mode for all profiled
     programs.
    </p></li></ol></div></div><section class="sect2" id="sec-apparmor-commandline-profiling-stand-alone" data-id-title="Stand-alone profiling"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.7.1 </span><span class="title-name">Stand-alone profiling</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-stand-alone">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Stand-alone profile generation and improvement is managed by a program
    called <code class="command">aa-genprof</code>. This method is easy because
    <code class="command">aa-genprof</code> takes care of everything, but is limited
    because it requires <code class="command">aa-genprof</code> to run for the entire
    duration of the test run of your program (you cannot reboot the machine
    while you are still developing your profile).
   </p><p>
    To use <code class="command">aa-genprof</code> for the stand-alone method of
    profiling, refer to
    <a class="xref" href="#sec-apparmor-commandline-profiling-summary-genprof" title="35.7.3.8. aa-genprof—generating profiles">Section 35.7.3.8, “aa-genprof—generating profiles”</a>.
   </p></section><section class="sect2" id="sec-apparmor-commandline-profiling-systemic" data-id-title="Systemic profiling"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.7.2 </span><span class="title-name">Systemic profiling</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-systemic">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This method is called <span class="emphasis"><em>systemic profiling</em></span> because it
    updates all of the profiles on the system at once, rather than focusing
    on the one or few targeted by <code class="command">aa-genprof</code> or
    stand-alone profiling. With systemic profiling, profile construction and
    improvement are somewhat less automated, but more flexible. This method
    is suitable for profiling long-running applications whose behavior
    continues after rebooting, or many programs at once.
   </p><p>
    Build an <span class="phrase">AppArmor</span> profile for a group of applications as follows:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Create profiles for the individual programs that make up your
      application.
     </p><p>
      Although this approach is systemic, <span class="phrase">AppArmor</span> only monitors those
      programs with profiles and their children. To get <span class="phrase">AppArmor</span> to consider
      a program, you must at least have <code class="command">aa-autodep</code> create
      an approximate profile for it. To create this approximate profile,
      refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-summary-autodep" title="35.7.3.1. aa-autodep—creating approximate profiles">Section 35.7.3.1, “aa-autodep—creating approximate profiles”</a>.
     </p></li><li class="step"><p>
      Put relevant profiles into learning or complain mode.
     </p><p>
      Activate learning or complain mode for all profiled programs by
      entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-complain /etc/apparmor.d/*</pre></div><p>
      in a terminal window while logged in as <code class="systemitem">root</code>. This
      functionality is also available through the YaST Profile Mode
      module, described in
      <a class="xref" href="#sec-apparmor-yast-manage-profmodes" title="34.4.2. Changing the mode of individual profiles">Section 34.4.2, “Changing the mode of individual profiles”</a>.
     </p><p>
      When in learning mode, access requests are not blocked, even if the
      profile dictates that they should be. This enables you to run through
      several tests (as shown in
      <a class="xref" href="#st-apparmor-commandline-profiling-systemic-exec" title="Step 3">Step 3</a>) and
      learn the access needs of the program so it runs properly. With this
      information, you can decide how secure to make the profile.
     </p><p>
      Refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-summary-complain" title="35.7.3.2. aa-complain—entering complain or learning mode">Section 35.7.3.2, “aa-complain—entering complain or learning mode”</a>
      for more detailed instructions for using learning or complain mode.
     </p></li><li class="step" id="st-apparmor-commandline-profiling-systemic-exec"><p>
      Exercise your application.
     </p><p>
      Run your application and exercise its functionality. How much to
      exercise the program is up to you, but you need the program to access
      each file representing its access needs. Because the execution is not
      being supervised by <code class="command">aa-genprof</code>, this step can go on
      for days or weeks and can span complete system reboots.
     </p></li><li class="step" id="st-apparmor-commandline-profiling-systemic-log"><p>
      Analyze the log.
     </p><p>
      In systemic profiling, run <code class="command">aa-logprof</code> directly
      instead of letting <code class="command">aa-genprof</code> run it (as in
      stand-alone profiling). The general form of
      <code class="command">aa-logprof</code> is:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-logprof [ -d <em class="replaceable">/path/to/profiles</em> ] [ -f <em class="replaceable">/path/to/logfile</em> ]</pre></div><p>
      Refer to
      <a class="xref" href="#sec-apparmor-commandline-profiling-summary-logprof" title="35.7.3.9. aa-logprof—scanning the system log">Section 35.7.3.9, “aa-logprof—scanning the system log”</a>
      for more information about using <code class="command">aa-logprof</code>.
     </p></li><li class="step"><p>
      Repeat
      <a class="xref" href="#st-apparmor-commandline-profiling-systemic-exec" title="Step 3">Step 3</a> and
      <a class="xref" href="#st-apparmor-commandline-profiling-systemic-log" title="Step 4">Step 4</a>.
     </p><p>
      This generates optimal profiles. An iterative approach captures
      smaller data sets that can be trained and reloaded into the policy
      engine. Subsequent iterations generate fewer messages and run faster.
     </p></li><li class="step"><p>
      Edit the profiles.
     </p><p>
      You should review the profiles that have been generated. You
      can open and edit the profiles in
      <code class="filename">/etc/apparmor.d/</code> using a text editor.
     </p></li><li class="step"><p>
      Return to enforce mode.
     </p><p>
      This is when the system goes back to enforcing the rules of the
      profiles, not only logging information. This can be done manually by
      removing the <code class="literal">flags=(complain)</code> text from the

      profiles or automatically by using the <code class="command">aa-enforce</code>
      command, which works identically to the <code class="command">aa-complain</code>
      command, except it sets the profiles to enforce mode. This
      functionality is also available through the YaST Profile Mode
      module, described in
      <a class="xref" href="#sec-apparmor-yast-manage-profmodes" title="34.4.2. Changing the mode of individual profiles">Section 34.4.2, “Changing the mode of individual profiles”</a>.
     </p><p>
      To ensure that all profiles are taken out of complain mode and put
      into enforce mode, enter <code class="command">aa-enforce
      /etc/apparmor.d/*</code>.
     </p></li><li class="step"><p>
      Re-scan all profiles.
     </p><p>
      To have <span class="phrase">AppArmor</span> re-scan all of the profiles and change the enforcement
      mode in the kernel, enter <code class="command">systemctl reload
      apparmor</code>.
     </p></li></ol></div></div></section><section class="sect2" id="sec-apparmor-commandline-profiling-summary" data-id-title="Summary of profiling tools"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">35.7.3 </span><span class="title-name">Summary of profiling tools</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    All of the <span class="phrase">AppArmor</span> profiling utilities are provided by the
    <code class="systemitem">apparmor-utils</code> RPM package and are stored in
    <code class="filename">/usr/sbin</code>. Each tool has a different purpose.
   </p><section class="sect3" id="sec-apparmor-commandline-profiling-summary-autodep" data-id-title="aa-autodep—creating approximate profiles"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.1 </span><span class="title-name">aa-autodep—creating approximate profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-autodep">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This creates an approximate profile for the program or application
     selected. You can generate approximate profiles for binary executables
     and interpreted script programs. The resulting profile is called
     <span class="quote">“<span class="quote">approximate</span>”</span> because it does not necessarily contain all
     of the profile entries that the program needs to be properly confined
     by <span class="phrase">AppArmor</span>. The minimum <code class="command">aa-autodep</code> approximate
     profile has, at minimum, a base include directive, which contains basic
     profile entries needed by most programs. For certain types of programs,
     <code class="command">aa-autodep</code> generates a more expanded profile. The
     profile is generated by recursively calling <code class="command">ldd(1)</code>
     on the executables listed on the command line.
    </p><p>
     To generate an approximate profile, use the
     <code class="command">aa-autodep</code> program. The program argument can be
     either the simple name of the program, which
     <code class="command">aa-autodep</code> finds by searching your shell's path
     variable, or it can be a fully qualified path. The program itself can
     be of any type (ELF binary, shell script, Perl script, etc.).
     <code class="command">aa-autodep</code> generates an approximate profile to
     improve through the dynamic profiling that follows.
    </p><p>
     The resulting approximate profile is written to the
     <code class="filename">/etc/apparmor.d</code> directory using the <span class="phrase">AppArmor</span>
     profile naming convention of naming the profile after the absolute path
     of the program, replacing the forward slash (<code class="literal">/</code>)
     characters in the path with period (<code class="literal">.</code>) characters.
     The general syntax of <code class="command">aa-autodep</code> is to enter the
     following in a terminal window:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-autodep [ -d <em class="replaceable">/PATH/TO/PROFILES</em> ] [<em class="replaceable">PROGRAM1</em> <em class="replaceable">PROGRAM2</em>...]</pre></div><p>
     If you do not enter the program name or names, you are prompted for
     them. <em class="replaceable">/path/to/profiles</em> overrides the
     default location of <code class="filename">/etc/apparmor.d</code>, should you
     keep profiles in a location other than the default.
    </p><p>
     To begin profiling, you must create profiles for each main executable
     service that is part of your application (anything that might start
     without being a child of another program that already has a profile).
     Finding all such programs depends on the application in question. Here
     are several strategies for finding such programs:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.3.8.1"><span class="term">Directories</span></dt><dd><p>
        If all the programs to profile are in one directory and there are no
        other programs in that directory, the simple command
        <code class="command">aa-autodep</code>
        <em class="replaceable">/path/to/your/programs/*</em> creates basic
        profiles for all programs in that directory.
       </p></dd><dt id="id-1.7.8.8.11.9.3.8.2"><span class="term">pstree -p</span></dt><dd><p>
        You can run your application and use the standard Linux
        <code class="command">pstree</code> command to find all processes running.
        Then manually hunt down the location of these programs and run the
        <code class="command">aa-autodep</code> for each one. If the programs are in
        your path, <code class="command">aa-autodep</code> finds them for you. If they
        are not in your path, the standard Linux command
        <code class="command">find</code> might be helpful in finding your programs.
        Execute <code class="command">find / -name '</code>
        <em class="replaceable">MY_APPLICATION</em>' -print to determine an
        application's path (<em class="replaceable">MY_APPLICATION</em> being
        an example application). You may use wild cards if appropriate.
       </p></dd></dl></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-complain" data-id-title="aa-complain—entering complain or learning mode"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.2 </span><span class="title-name">aa-complain—entering complain or learning mode</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-complain">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The complain or learning mode tool (<code class="command">aa-complain</code>)
     detects violations of <span class="phrase">AppArmor</span> profile rules, such as the profiled
     program accessing files not permitted by the profile. The violations
     are permitted, but also logged. To improve the profile, turn complain
     mode on, run the program through a suite of tests to generate log
     events that characterize the program's access needs, then postprocess
     the log with the <span class="phrase">AppArmor</span> tools to transform log events into improved
     profiles.
    </p><p>
     Manually activating complain mode (using the command line) adds a flag
     to the top of the profile so that <code class="literal">/bin/foo</code> becomes
     <code class="literal">/bin/foo flags=(complain)</code>. To use complain mode,

     open a terminal window and enter one of the following lines as
     <code class="systemitem">root</code>:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       If the example program (<em class="replaceable">PROGRAM1</em>) is in
       your path, use:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-complain [<em class="replaceable">PROGRAM1</em> <em class="replaceable">PROGRAM2</em> ...]</pre></div></li><li class="listitem"><p>
       If the program is not in your path, specify the entire path as
       follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-complain /sbin/<em class="replaceable">PROGRAM1</em></pre></div></li><li class="listitem"><p>
       If the profiles are not in <code class="filename">/etc/apparmor.d</code>, use
       the following to override the default location:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-complain <em class="replaceable">/path/to/profiles/</em><em class="replaceable">PROGRAM1</em></pre></div></li><li class="listitem"><p>
       Specify the profile for <em class="replaceable">/sbin/program1</em> as
       follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-complain /etc/apparmor.d/sbin.<em class="replaceable">PROGRAM1</em></pre></div></li></ul></div><p>
     Each of the above commands activates the complain mode for the profiles
     or programs listed. If the program name does not include its entire
     path, <code class="command">aa-complain</code> searches <code class="envar">$PATH</code> for
     the program. For example, <code class="command">aa-complain /usr/sbin/*</code>
     finds profiles associated with all of the programs in
     <code class="filename">/usr/sbin</code> and puts them into complain mode.
     <code class="command">aa-complain /etc/apparmor.d/*</code> puts all of the
     profiles in <code class="filename">/etc/apparmor.d</code> into complain mode.
    </p><div id="id-1.7.8.8.11.9.4.6" data-id-title="Toggling profile mode with YaST" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Toggling profile mode with YaST</div><p>
      YaST offers a graphical front-end for toggling complain and
      enforce mode. See <a class="xref" href="#sec-apparmor-yast-manage-profmodes" title="34.4.2. Changing the mode of individual profiles">Section 34.4.2, “Changing the mode of individual profiles”</a>
      for information.
     </p></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-decode" data-id-title="aa-decode—decoding hex-encoded strings in AppArmor log files"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.3 </span><span class="title-name">aa-decode—decoding hex-encoded strings in <span class="phrase">AppArmor</span> log files</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-decode">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">aa-decode</code> will decode hex-encoded strings in the
     <span class="phrase">AppArmor</span> log output. It can also process the audit log on standard
     input, convert any hex-encoded <span class="phrase">AppArmor</span> log entries, and display them on
     standard output.
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-disable" data-id-title="aa-disable—disabling an AppArmor security profile"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.4 </span><span class="title-name">aa-disable—disabling an <span class="phrase">AppArmor</span> security profile</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-disable">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use <code class="command">aa-disable</code> to disable the enforcement mode for
     one or more <span class="phrase">AppArmor</span> profiles. This command will unload the profile from
     the kernel, and prevent the profile from being loaded on <span class="phrase">AppArmor</span>
     start-up. Use <code class="command">aa-enforce</code> or
     <code class="command">aa-complain</code> utilities to change this behavior.
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-easyprof" data-id-title="aa-easyprof—easy profile generation"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.5 </span><span class="title-name">aa-easyprof—easy profile generation</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-easyprof">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">aa-easyprof</code> provides an easy-to-use interface for
     <span class="phrase">AppArmor</span> profile generation. <code class="command">aa-easyprof</code> supports the
     use of templates and profile groups to quickly profile an application.
     While <code class="command">aa-easyprof</code> can help with profile generation,
     its utility is dependent on the quality of the templates, profile
     groups and abstractions used. Also, this tool may create a profile that
     is less restricted than when creating a profile manually or with
     <code class="command">aa-genprof</code> and <code class="command">aa-logprof</code>.
    </p><p>
     For more information, see the man page of
     <code class="command">aa-easyprof</code> (8).
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-enforce" data-id-title="aa-enforce—entering enforce mode"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.6 </span><span class="title-name">aa-enforce—entering enforce mode</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-enforce">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The enforce mode detects violations of <span class="phrase">AppArmor</span> profile rules, such as
     the profiled program accessing files not permitted by the profile. The
     violations are logged and not permitted. The default is for enforce
     mode to be enabled. To log the violations only, but still permit them,
     use complain mode.
    </p><p>
     Manually activating enforce mode (using the command line) removes the
     complain flag from the top of the profile so that <code class="literal">/bin/foo
     flags=(complain)</code> becomes <code class="literal">/bin/foo</code>. To use
     enforce mode, open a terminal window and enter one of the following
     lines.
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       If the example program (<em class="replaceable">PROGRAM1</em>) is in
       your path, use:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-enforce [<em class="replaceable">PROGRAM1</em> <em class="replaceable">PROGRAM2</em> ...]</pre></div></li><li class="listitem"><p>
       If the program is not in your path, specify the entire path, as
       follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-enforce /sbin/<em class="replaceable">PROGRAM1</em></pre></div></li><li class="listitem"><p>
       If the profiles are not in
       <em class="replaceable">/etc/apparmor.d</em>, use the following to
       override the default location:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-enforce -d <em class="replaceable">/path/to/profiles/     program1</em></pre></div></li><li class="listitem"><p>
       Specify the profile for <em class="replaceable">/sbin/program1</em> as
       follows:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-enforce /etc/apparmor.d/sbin.<em class="replaceable">PROGRAM1</em></pre></div></li></ul></div><p>
     Each of the above commands activates the enforce mode for the profiles
     and programs listed.
    </p><p>
     If you do not enter the program or profile names, you are prompted to
     enter one. <em class="replaceable">/path/to/profiles</em> overrides the
     default location of <code class="filename">/etc/apparmor.d</code>.
    </p><p>
     The argument can be either a list of programs or a list of profiles. If
     the program name does not include its entire path,
     <code class="command">aa-enforce</code> searches <code class="envar">$PATH</code> for the
     program.
    </p><div id="id-1.7.8.8.11.9.8.8" data-id-title="Toggling profile mode with YaST" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Toggling profile mode with YaST</div><p>
      YaST offers a graphical front-end for toggling complain and
      enforce mode. See <a class="xref" href="#sec-apparmor-yast-manage-profmodes" title="34.4.2. Changing the mode of individual profiles">Section 34.4.2, “Changing the mode of individual profiles”</a>
      for information.
     </p></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-exec" data-id-title="aa-exec—confining a program with the specified profile"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.7 </span><span class="title-name">aa-exec—confining a program with the specified profile</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-exec">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Use <code class="command">aa-exec</code> to launch a program confined by a
     specified profile and/or profile namespace. If both a profile and
     namespace are specified, the program will be confined by the profile in
     the new namespace. If only a profile namespace is specified, the
     profile name of the current confinement will be used. If neither a
     profile nor namespace is specified, the command will be run using the
     standard profile attachment—as if you did not use the
     <code class="command">aa-exec</code> command.
    </p><p>
     For more information on the command's options, see its manual page
     <code class="command">man 8 aa-exec</code>.
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-genprof" data-id-title="aa-genprof—generating profiles"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.8 </span><span class="title-name">aa-genprof—generating profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-genprof">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">aa-genprof</code> is <span class="phrase">AppArmor</span>'s profile generating utility.
     It runs <code class="command">aa-autodep</code> on the specified program,
     creating an approximate profile (if a profile does not already exist
     for it), sets it to complain mode, reloads it into <span class="phrase">AppArmor</span>, marks the
     log, and prompts the user to execute the program and exercise its
     functionality. Its syntax is as follows:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-genprof [ -d <em class="replaceable">/path/to/profiles</em> ]  <em class="replaceable">PROGRAM</em></pre></div><p>
     To create a profile for the Apache Web server program httpd2-prefork,
     do the following as <code class="systemitem">root</code>:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Enter <code class="command">systemctl stop apache2</code>.
      </p></li><li class="step"><p>
       Next, enter <code class="command">aa-genprof httpd2-prefork</code>.
      </p><p>
       Now <code class="command">aa-genprof</code> does the following:
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
         Resolves the full path of httpd2-prefork using your shell's path
         variables. You can also specify a full path. On <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>,
         the default full path is
         <span class="phrase"><code class="filename">/usr/sbin/httpd2-prefork</code></span>.
        </p></li><li class="listitem"><p>
         Checks to see if there is an existing profile for httpd2-prefork.
         If there is one, it updates it. If not, it creates one using the
         <code class="command">aa-autodep</code> as described in
         <a class="xref" href="#sec-apparmor-commandline-profiling-summary" title="35.7.3. Summary of profiling tools">Section 35.7.3, “Summary of profiling tools”</a>.
        </p></li><li class="listitem"><p>
         Puts the profile for this program into learning or complain mode so
         that profile violations are logged, but are permitted to proceed. A
         log event looks like this (see
         <code class="filename">/var/log/audit/audit.log</code>):
        </p><div class="verbatim-wrap"><pre class="screen">type=APPARMOR_ALLOWED msg=audit(1189682639.184:20816): \
apparmor="DENIED" operation="file_mmap" parent=2692 \
profile="/usr/sbin/httpd2-prefork//HANDLING_UNTRUSTED_INPUT" \
name="/var/log/apache2/access_log-20140116" pid=28730 comm="httpd2-prefork" \
requested_mask="::r" denied_mask="::r" fsuid=30 ouid=0</pre></div><p>
         If you are not running the audit daemon, the <span class="phrase">AppArmor</span> events are
         logged directly to <code class="systemitem">systemd</code> journal (see
         <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: Query the <code class="systemitem">systemd</code> journal”</span>):
        </p><div class="verbatim-wrap"><pre class="screen">Sep 13 13:20:30 K23 kernel: audit(1189682430.672:20810): \
apparmor="DENIED" operation="file_mmap" parent=2692 \
profile="/usr/sbin/httpd2-prefork//HANDLING_UNTRUSTED_INPUT" \
name="/var/log/apache2/access_log-20140116" pid=28730 comm="httpd2-prefork" \
requested_mask="::r" denied_mask="::r" fsuid=30 ouid=0</pre></div><p>
         They also can be viewed using the <code class="command">dmesg</code> command:
        </p><div class="verbatim-wrap"><pre class="screen">audit(1189682430.672:20810): apparmor="DENIED" \
operation="file_mmap" parent=2692 \
profile="/usr/sbin/httpd2-prefork//HANDLING_UNTRUSTED_INPUT" \
name="/var/log/apache2/access_log-20140116" pid=28730 comm="httpd2-prefork" \
requested_mask="::r" denied_mask="::r" fsuid=30 ouid=0</pre></div></li><li class="listitem"><p>
         Marks the log with a beginning marker of log events to consider.
         For example:
        </p><div class="verbatim-wrap"><pre class="screen">Sep 13 17:48:52 figwit root: GenProf: e2ff78636296f16d0b5301209a04430d</pre></div></li></ol></div></li><li class="step"><p>
       When prompted by the tool, run the application to profile in another
       terminal window and perform as many of the application functions as
       possible. Thus, the learning mode can log the files and directories
       to which the program requires access to function properly.
       For example, in a new terminal window, enter <code class="command">systemctl start
       apache2</code>.
      </p></li><li class="step"><p>
       Select from the following options that are available in the
       <code class="command">aa-genprof</code> terminal window after you have executed
       the program function:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         <span class="keycap">S</span> runs <code class="command">aa-genprof</code> on the system
         log from where it was marked when <code class="command">aa-genprof</code> was
         started and reloads the profile. If system events exist in the log,
         <span class="phrase">AppArmor</span> parses the learning mode log files. This generates a series
         of questions that you must answer to guide
         <code class="command">aa-genprof</code> in generating the security profile.
        </p></li><li class="listitem"><p>
         <span class="keycap">F</span> exits the tool.
        </p></li></ul></div><div id="id-1.7.8.8.11.9.10.5.4.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
        If requests to add hats appear, proceed to
        <a class="xref" href="#cha-apparmor-hat" title="Chapter 36. Profiling your Web applications using ChangeHat">Chapter 36, <em>Profiling your Web applications using ChangeHat</em></a>.
       </p></div></li><li class="step"><p>
       Answer two types of questions:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         A resource is requested by a profiled program that is not in the
         profile (see
         <a class="xref" href="#ex-apparmor-commandline-profiling-summary-genprof-learn" title="Learning mode exception: controlling access to specific resources">Example 35.1, “Learning mode exception: controlling access to specific resources”</a>).
        </p></li><li class="listitem"><p>
         A program is executed by the profiled program and the security
         domain transition has not been defined (see
         <a class="xref" href="#ex-apparmor-commandline-profiling-summary-genprof-perms" title="Learning mode exception: defining permissions for an entry">Example 35.2, “Learning mode exception: defining permissions for an entry”</a>).
        </p></li></ul></div><p>
       Each of these categories results in a series of questions that you
       must answer to add the resource or program to the profile.
       <a class="xref" href="#ex-apparmor-commandline-profiling-summary-genprof-learn" title="Learning mode exception: controlling access to specific resources">Example 35.1, “Learning mode exception: controlling access to specific resources”</a>
       and
       <a class="xref" href="#ex-apparmor-commandline-profiling-summary-genprof-perms" title="Learning mode exception: defining permissions for an entry">Example 35.2, “Learning mode exception: defining permissions for an entry”</a>
       provide examples of each one. Subsequent steps describe your options
       in answering these questions.
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Dealing with execute accesses is complex. You must decide how to
         proceed with this entry regarding which execute permission type to
         grant to this entry:
        </p><div class="example" id="ex-apparmor-commandline-profiling-summary-genprof-learn" data-id-title="Learning mode exception: controlling access to specific resources"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.1: </span><span class="title-name">Learning mode exception: controlling access to specific resources </span></span><a title="Permalink" class="permalink" href="#ex-apparmor-commandline-profiling-summary-genprof-learn">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">Reading log entries from /var/log/audit/audit.log.
Updating AppArmor profiles in /etc/apparmor.d.

Profile:  /usr/sbin/cupsd
Program:  cupsd
Execute:  /usr/lib/cups/daemon/cups-lpd
Severity: unknown

(I)nherit / (P)rofile / (C)hild / (N)ame / (U)nconfined / (X)ix / (D)eny / Abo(r)t / (F)inish</pre></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.1"><span class="term">Inherit (ix)</span></dt><dd><p>
            The child inherits the parent's profile, running with the same
            access controls as the parent. This mode is useful when a
            confined program needs to call another confined program without
            gaining the permissions of the target's profile or losing the
            permissions of the current profile. This mode is often used when
            the child program is a <span class="emphasis"><em>helper application</em></span>,
            such as the <code class="command">/usr/bin/mail</code> client using
            <code class="command">less</code> as a pager.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.2"><span class="term">Profile (px/px)</span></dt><dd><p>
            The child runs using its own profile, which must be loaded into
            the kernel. If the profile is not present, attempts to execute
            the child fail with permission denied. This is most useful if
            the parent program is invoking a global service, such as DNS
            lookups or sending mail with your system's MTA.
           </p><p>
            Choose the <span class="guimenu">profile with clean exec</span> (Px)
            option to scrub the environment of environment variables that
            could modify execution behavior when passed to the child
            process.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.3"><span class="term">Child (cx/cx)</span></dt><dd><p>
            Sets up a transition to a subprofile. It is like px/Px
            transition, except to a child profile.
           </p><p>
            Choose the <span class="guimenu">profile with clean exec</span> (Cx)
            option to scrub the environment of environment variables that
            could modify execution behavior when passed to the child
            process.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.4"><span class="term">Unconfined (ux/ux)</span></dt><dd><p>
            The child runs completely unconfined without any <span class="phrase">AppArmor</span> profile
            applied to the executed resource.
           </p><p>
            Choose the <span class="guimenu">unconfined with clean exec</span> (Ux)
            option to scrub the environment of environment variables that
            could modify execution behavior when passed to the child
            process. Note that running unconfined profiles introduces a
            security vulnerability that could be used to evade <span class="phrase">AppArmor</span>. Only
            use it as a last resort.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.5"><span class="term">mmap (m)</span></dt><dd><p>
            This permission denotes that the program running under the
            profile can access the resource using the mmap system call with
            the flag <code class="envar">PROT_EXEC</code>. This means that the data
            mapped in it can be executed. You are prompted to include this
            permission if it is requested during a profiling run.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.6"><span class="term">Deny</span></dt><dd><p>
            Adds a <code class="literal">deny</code> rule to the profile, and
            permanently prevents the program from accessing the specified
            directory path entries. <span class="phrase">AppArmor</span> then continues to the next
            event.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.7"><span class="term">Abort</span></dt><dd><p>
            Aborts <code class="command">aa-logprof</code>, losing all rule changes
            entered so far and leaving all profiles unmodified.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.1.3.8"><span class="term">Finish</span></dt><dd><p>
            Closes <code class="command">aa-logprof</code>, saving all rule changes
            entered so far and modifying all profiles.
           </p></dd></dl></div></li><li class="listitem"><p>
         <a class="xref" href="#ex-apparmor-commandline-profiling-summary-genprof-perms" title="Learning mode exception: defining permissions for an entry">Example 35.2, “Learning mode exception: defining permissions for an entry”</a>
         shows <span class="phrase">AppArmor</span> suggest allowing a globbing pattern
         <code class="filename">/var/run/nscd/*</code> for reading, then using an
         abstraction to cover common Apache-related access rules.
        </p><div class="example" id="ex-apparmor-commandline-profiling-summary-genprof-perms" data-id-title="Learning mode exception: defining permissions for an entry"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 35.2: </span><span class="title-name">Learning mode exception: defining permissions for an entry </span></span><a title="Permalink" class="permalink" href="#ex-apparmor-commandline-profiling-summary-genprof-perms">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">Profile:  /usr/sbin/httpd2-prefork
Path:     /var/run/nscd/dbSz9CTr
Mode:     r
Severity: 3

  1 - /var/run/nscd/dbSz9CTr
 [2 - /var/run/nscd/*]

(A)llow / [(D)eny] / (G)lob / Glob w/(E)xt / (N)ew / Abo(r)t / (F)inish / (O)pts
Adding /var/run/nscd/* r to profile.

Profile:  /usr/sbin/httpd2-prefork
Path:     /proc/11769/attr/current
Mode:     w
Severity: 9

 [1 - #include &lt;abstractions/apache2-common&gt;]
  2 - /proc/11769/attr/current
  3 - /proc/*/attr/current

(A)llow / [(D)eny] / (G)lob / Glob w/(E)xt / (N)ew / Abo(r)t / (F)inish / (O)pts
Adding #include &lt;abstractions/apache2-common&gt; to profile.</pre></div></div></div><p>
         <span class="phrase">AppArmor</span> provides one or more paths or includes. By entering the
         option number, select the desired options then proceed to the next
         step.
        </p><div id="id-1.7.8.8.11.9.10.5.5.4.2.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
          Not all of these options are always presented in the <span class="phrase">AppArmor</span> menu.
         </p></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.10.5.5.4.2.5.1"><span class="term"><code class="literal">#include</code>
          </span></dt><dd><p>
            This is the section of an <span class="phrase">AppArmor</span> profile that refers to an
            include file, which procures access permissions for programs. By
            using an include, you can give the program access to directory
            paths or files that are also required by other programs. Using
            includes can reduce the size of a profile. It is good practice
            to select includes when suggested.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.5.2"><span class="term">Globbed version</span></dt><dd><p>
            This is accessed by selecting <span class="guimenu">Glob</span> as
            described in the next step. For information about globbing
            syntax, refer to <a class="xref" href="#sec-apparmor-profiles-glob" title="32.6. Profile names, flags, paths, and globbing">Section 32.6, “Profile names, flags, paths, and globbing”</a>.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.5.3"><span class="term">Actual path</span></dt><dd><p>
            This is the literal path to which the program needs access so
            that it can run properly.
           </p></dd></dl></div><p>
         After you select the path or include, process it as an entry into
         the <span class="phrase">AppArmor</span> profile by selecting <span class="guimenu">Allow</span> or
         <span class="guimenu">Deny</span>. If you are not satisfied with the
         directory path entry as it is displayed, you can also
         <span class="guimenu">Glob</span> it.
        </p><p>
         The following options are available to process the learning mode
         entries and build the profile:
        </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.1"><span class="term">Select <span class="keycap">Enter</span>
          </span></dt><dd><p>
            Allows access to the selected directory path.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.2"><span class="term">Allow</span></dt><dd><p>
            Allows access to the specified directory path entries. <span class="phrase">AppArmor</span>
            suggests file permission access. For more information, refer to
            <a class="xref" href="#sec-apparmor-profiles-perm" title="32.7. File permission access modes">Section 32.7, “File permission access modes”</a>.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.3"><span class="term">Deny</span></dt><dd><p>
            Prevents the program from accessing the specified directory path
            entries. <span class="phrase">AppArmor</span> then continues to the next event.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.4"><span class="term">New</span></dt><dd><p>
            Prompts you to enter your own rule for this event, allowing you
            to specify a regular expression. If the expression does not
            actually satisfy the event that prompted the question in the
            first place, <span class="phrase">AppArmor</span> asks for confirmation and lets you reenter
            the expression.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.5"><span class="term">Glob</span></dt><dd><p>
            Select a specific path or create a general rule using wild cards
            that match a broader set of paths. To select any of the offered
            paths, enter the number that is printed in front of the path
            then decide how to proceed with the selected item.
           </p><p>
            For more information about globbing syntax, refer to
            <a class="xref" href="#sec-apparmor-profiles-glob" title="32.6. Profile names, flags, paths, and globbing">Section 32.6, “Profile names, flags, paths, and globbing”</a>.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.6"><span class="term">Glob w/ext</span></dt><dd><p>
            This modifies the original directory path while retaining the
            file name extension. For example,
            <code class="filename">/etc/apache2/file.ext</code> becomes
            <code class="filename">/etc/apache2/*.ext</code>, adding the wild card
            (asterisk) in place of the file name. This allows the program to
            access all files in the suggested directory that end with the
            <code class="literal">.ext</code> extension.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.7"><span class="term">Abort</span></dt><dd><p>
            Aborts <code class="command">aa-logprof</code>, losing all rule changes
            entered so far and leaving all profiles unmodified.
           </p></dd><dt id="id-1.7.8.8.11.9.10.5.5.4.2.8.8"><span class="term">Finish</span></dt><dd><p>
            Closes <code class="command">aa-logprof</code>, saving all rule changes
            entered so far and modifying all profiles.
           </p></dd></dl></div></li></ul></div></li><li class="step"><p>
       To view and edit your profile using <code class="command">vi</code>, enter
       <code class="command">vi /etc/apparmor.d/</code>
       <em class="replaceable">PROFILENAME</em> in a terminal window. To
       enable syntax highlighting when editing an <span class="phrase">AppArmor</span> profile in vim,
       use the commands <code class="command">:syntax on</code> then <code class="command">:set
       syntax=apparmor</code>. For more information about vim and syntax
       highlighting, refer to
       <a class="xref" href="#sec-apparmor-commandline-profiling-summary-vim" title="35.7.3.14. apparmor.vim">Section 35.7.3.14, “apparmor.vim”</a>.
      </p></li><li class="step"><p>
       Restart <span class="phrase">AppArmor</span> and reload the profile set including the newly
       created one using the <code class="command">systemctl reload
       apparmor</code> command.
      </p></li></ol></div></div><p>
     Like the graphical front-end for building <span class="phrase">AppArmor</span> profiles, the
     YaST Add Profile Wizard, <code class="command">aa-genprof</code> also
     supports the use of the local profile repository under
     <code class="filename">/usr/share/apparmor/extra-profiles</code>.
    </p><p>
     To use a profile from the local repository, proceed as follows:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Start <code class="command">aa-genprof</code> as described above.
      </p><p>
       If <code class="command">aa-genprof</code> finds an inactive local profile, the
       following lines appear on your terminal window:
      </p><div class="verbatim-wrap"><pre class="screen">Profile: /usr/bin/opera

 [1 - Inactive local profile for /usr/bin/opera]

[(V)iew Profile] / (U)se Profile / (C)reate New Profile / Abo(r)t / (F)inish</pre></div></li><li class="step"><p>
       To use this profile, press <span class="keycap">U</span>
       (<span class="guimenu">Use Profile</span>) and follow the profile generation
       procedure outlined above.
      </p><p>
       To examine the profile before activating it, press
       <span class="keycap">V</span> (<span class="guimenu">View Profile</span>).
      </p><p>
       To ignore the existing profile, press <span class="keycap">C</span>
       (<span class="guimenu">Create New Profile</span>) and follow the profile
       generation procedure outlined above to create the profile from
       scratch.
      </p></li><li class="step"><p>
       Leave <code class="command">aa-genprof</code> by pressing <span class="keycap">F</span>
       (<span class="guimenu">Finish</span>) when you are done and save your changes.
      </p></li></ol></div></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-logprof" data-id-title="aa-logprof—scanning the system log"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.9 </span><span class="title-name">aa-logprof—scanning the system log</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-logprof">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">aa-logprof</code> is an interactive tool used to review the
     complain and enforce mode events found in the log entries in
     <code class="filename">/var/log/audit/audit.log</code>, or directly in the
     <code class="systemitem">systemd</code> journal (see <span class="intraxref">Book “Administration Guide”, Chapter 21 “<code class="command">journalctl</code>: Query the <code class="systemitem">systemd</code> journal”</span>), and
     generate new entries in <span class="phrase">AppArmor</span> security profiles.
    </p><p>
     When you run <code class="command">aa-logprof</code>, it begins to scan the log
     files produced in complain and enforce mode and, if there are new
     security events that are not covered by the existing profile set, it
     gives suggestions for modifying the profile.
     <code class="command">aa-logprof</code> uses this information to observe program
     behavior.
    </p><p>
     If a confined program forks and executes another program,
     <code class="command">aa-logprof</code> sees this and asks the user which
     execution mode should be used when launching the child process. The
     execution modes <span class="emphasis"><em>ix</em></span>, <span class="emphasis"><em>px</em></span>,
     <span class="emphasis"><em>Px</em></span>, <span class="emphasis"><em>ux</em></span>,
     <span class="emphasis"><em>Ux</em></span>, <span class="emphasis"><em>cx</em></span>,
     <span class="emphasis"><em>Cx</em></span>, and named profiles, are options for starting
     the child process. If a separate profile exists for the child process,
     the default selection is <span class="emphasis"><em>Px</em></span>. If one does not
     exist, the profile defaults to <span class="emphasis"><em>ix</em></span>. Child processes
     with separate profiles have <code class="command">aa-autodep</code> run on them
     and are loaded into <span class="phrase">AppArmor</span>, if it is running.
    </p><p>
     When <code class="command">aa-logprof</code> exits, profiles are updated with the
     changes. If <span class="phrase">AppArmor</span> is active, the updated profiles are reloaded and,
     if any processes that generated security events are still running in
     the null-XXXX profiles (unique profiles temporarily created in complain
     mode), those processes are set to run under their proper profiles.
    </p><p>
     To run <code class="command">aa-logprof</code>, enter
     <code class="command">aa-logprof</code> into a terminal window while logged in as
     <code class="systemitem">root</code>. The following options can be used for
     <code class="command">aa-logprof</code>:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.11.7.1"><span class="term"><code class="command">aa-logprof -d</code><em class="replaceable">/path/to/profile/directory/</em>
      </span></dt><dd><p>
        Specifies the full path to the location of the profiles if the
        profiles are not located in the standard directory,
        <code class="filename">/etc/apparmor.d/</code>.
       </p></dd><dt id="id-1.7.8.8.11.9.11.7.2"><span class="term"><code class="command">aa-logprof -f</code><em class="replaceable">/path/to/logfile/</em>
      </span></dt><dd><p>
        Specifies the full path to the location of the log file if the log
        file is not located in the default directory or
        <code class="filename">/var/log/audit/audit.log</code>.
       </p></dd><dt id="id-1.7.8.8.11.9.11.7.3"><span class="term"><code class="command">aa-logprof -m "string marker in logfile"</code>
      </span></dt><dd><p>
        Marks the starting point for <code class="command">aa-logprof</code> to look
        in the system log. <code class="command">aa-logprof</code> ignores all events
        in the system log before the specified mark. If the mark contains
        spaces, it must be surrounded by quotes to work correctly. For
        example:
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>aa-logprof -m "17:04:21"</pre></div><p>
        or
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>aa-logprof -m e2ff78636296f16d0b5301209a04430d</pre></div></dd></dl></div><p>
     <code class="command">aa-logprof</code> scans the log, asking you how to handle
     each logged event. Each question presents a numbered list of <span class="phrase">AppArmor</span>
     rules that can be added by pressing the number of the item on the list.
    </p><p>
     By default, <code class="command">aa-logprof</code> looks for profiles in
     <code class="filename">/etc/apparmor.d/</code>. Often running
     <code class="command">aa-logprof</code> as <code class="systemitem">root</code> is enough to update the
     profile. However, there might be times when you need to search archived
     log files, such as if the program exercise period exceeds the log
     rotation window (when the log file is archived and a new log file is
     started). If this is the case, you can enter <code class="command">zcat -f `ls
     -1tr</code> <em class="replaceable">/path/to/logfile*</em>` |
     aa-logprof -f -.
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-logprof-ex1" data-id-title="aa-logprof example 1"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.10 </span><span class="title-name">aa-logprof example 1</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-logprof-ex1">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The following is an example of how <code class="command">aa-logprof</code>
     addresses httpd2-prefork accessing the file
     <code class="filename">/etc/group</code>. <code class="literal">[]</code> indicates the
     default option.
    </p><p>
     In this example, the access to <code class="command">/etc/group</code> is part of
     httpd2-prefork accessing name services. The appropriate response is
     <code class="literal">1</code>, which includes a predefined set of <span class="phrase">AppArmor</span> rules.
     Selecting <code class="literal">1</code> to <code class="literal">#include</code> the name
     service package resolves all of the future questions pertaining to DNS
     lookups and makes the profile less brittle in that any changes to
     DNS configuration and the associated name service profile package can
     be made once, rather than needing to revise many profiles.
    </p><div class="verbatim-wrap"><pre class="screen">Profile:  /usr/sbin/httpd2-prefork
Path:     /etc/group
New Mode: r

[1 - #include &lt;abstractions/nameservice&gt;]
 2 - /etc/group
[(A)llow] / (D)eny / (N)ew / (G)lob / Glob w/(E)xt / Abo(r)t / (F)inish</pre></div><p>
     Select one of the following responses:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.12.6.1"><span class="term">Select <span class="keycap">Enter</span>
      </span></dt><dd><p>
        Triggers the default action, which is, in this example, allowing
        access to the specified directory path entry.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.2"><span class="term">Allow</span></dt><dd><p>
        Allows access to the specified directory path entries. <span class="phrase">AppArmor</span>
        suggests file permission access. For more information about this,
        refer to <a class="xref" href="#sec-apparmor-profiles-perm" title="32.7. File permission access modes">Section 32.7, “File permission access modes”</a>.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.3"><span class="term">Deny</span></dt><dd><p>
        Permanently prevents the program from accessing the specified
        directory path entries. <span class="phrase">AppArmor</span> then continues to the next event.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.4"><span class="term">New</span></dt><dd><p>
        Prompts you to enter your own rule for this event, allowing you to
        specify whatever form of regular expression you want. If the
        expression entered does not actually satisfy the event that prompted
        the question in the first place, <span class="phrase">AppArmor</span> asks for confirmation and
        lets you reenter the expression.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.5"><span class="term">Glob</span></dt><dd><p>
        Select either a specific path or create a general rule using wild
        cards that matches on a broader set of paths. To select any of the
        offered paths, enter the number that is printed in front of the
        paths then decide how to proceed with the selected item.
       </p><p>
        For more information about globbing syntax, refer to
        <a class="xref" href="#sec-apparmor-profiles-glob" title="32.6. Profile names, flags, paths, and globbing">Section 32.6, “Profile names, flags, paths, and globbing”</a>.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.6"><span class="term">Glob w/ext</span></dt><dd><p>
        This modifies the original directory path while retaining the file
        name extension. For example,
        <code class="filename">/etc/apache2/file.ext</code> becomes
        <code class="filename">/etc/apache2/*.ext</code>, adding the wild card
        (asterisk) in place of the file name. This allows the program to
        access all files in the suggested directory that end with the
        <code class="literal">.ext</code> extension.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.7"><span class="term">Abort</span></dt><dd><p>
        Aborts <code class="command">aa-logprof</code>, losing all rule changes
        entered so far and leaving all profiles unmodified.
       </p></dd><dt id="id-1.7.8.8.11.9.12.6.8"><span class="term">Finish</span></dt><dd><p>
        Closes <code class="command">aa-logprof</code>, saving all rule changes
        entered so far and modifying all profiles.
       </p></dd></dl></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-logprof-ex2" data-id-title="aa-logprof example 2"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.11 </span><span class="title-name">aa-logprof example 2</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-logprof-ex2">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     For example, when profiling vsftpd, see this question:
    </p><div class="verbatim-wrap"><pre class="screen">Profile:  /usr/sbin/vsftpd
Path:     /y2k.jpg

New Mode: r

[1 - /y2k.jpg]

(A)llow / [(D)eny] / (N)ew / (G)lob / Glob w/(E)xt / Abo(r)t / (F)inish</pre></div><p>
     Several items of interest appear in this question. First, note that
     vsftpd is asking for a path entry at the top of the tree, even though
     vsftpd on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>

     serves FTP files from <code class="filename">/srv/ftp</code> by default. This is
     because vsftpd uses chroot and, for the portion of the code inside the
     chroot jail, <span class="phrase">AppArmor</span> sees file accesses in terms of the chroot
     environment rather than the global absolute path.
    </p><p>
     The second item of interest is that you should grant FTP read
     access to all JPEG files in the directory, so you could use
     <span class="guimenu">Glob w/Ext</span> and use the suggested path of
     <code class="literal">/*.jpg</code>. Doing so collapses all previous rules
     granting access to individual <code class="literal">.jpg</code> files and
     forestalls any future questions pertaining to access to
     <code class="filename">.jpg</code> files.
    </p><p>
     Finally, you should grant more general access to FTP files. If
     you select <span class="guimenu">Glob</span> in the last entry,
     <code class="command">aa-logprof</code> replaces the suggested path of
     <code class="filename">/y2k.jpg</code> with <code class="filename">/*</code>.
     Alternatively, you should grant even more access to the entire
     directory tree, in which case you could use the <span class="guimenu">New</span>
     path option and enter <code class="literal">/**.jpg</code> (which would grant
     access to all <code class="literal">.jpg</code> files in the entire directory
     tree) or <code class="filename">/**</code> (which would grant access to all
     files in the directory tree).
    </p><p>
     These items deal with read accesses. Write accesses are similar, except
     that it is good policy to be more conservative in your use of regular
     expressions for write accesses. Dealing with execute accesses is more
     complex. Find an example in
     <a class="xref" href="#ex-apparmor-commandline-profiling-summary-genprof-learn" title="Learning mode exception: controlling access to specific resources">Example 35.1, “Learning mode exception: controlling access to specific resources”</a>.
    </p><p>
     In the following example, the <code class="filename">/usr/bin/mail</code> mail
     client is being profiled and <code class="command">aa-logprof</code> has
     discovered that <code class="command">/usr/bin/mail</code> executes
     <code class="command">/usr/bin/less</code> as a helper application to
     <span class="quote">“<span class="quote">page</span>”</span> long mail messages. Consequently, it presents this
     prompt:
    </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/nail -&gt; /usr/bin/less
(I)nherit / (P)rofile / (C)hild / (N)ame / (U)nconfined / (X)ix / (D)eny</pre></div><div id="id-1.7.8.8.11.9.13.10" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      The actual executable file for <code class="filename">/usr/bin/mail</code>
      turns out to be <code class="filename">/usr/bin/nail</code>, which is not a
      typographical error.
     </p></div><p>
     The program <code class="filename">/usr/bin/less</code> appears to be a
     simple one for scrolling through text that is more than one screen
     long and that is in fact what <code class="filename">/usr/bin/mail</code> is
     using it for. However, <code class="command">less</code> is actually a large
     and powerful program that uses many other helper applications, such
     as <code class="command">tar</code> and <code class="command">rpm</code>.
    </p><div id="id-1.7.8.8.11.9.13.12" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
      Run <code class="command">less</code> on a tar file or an RPM file and it shows
      you the inventory of these containers.
     </p></div><p>
     You do not want to run <code class="command">rpm</code> automatically when
     reading mail messages (that leads directly to a Microsoft*
     Outlook–style virus attack, because RPM has the power to
     install and modify system programs), so, in this case, the best choice
     is to use <span class="guimenu">Inherit</span>. This results in the less program
     executed from this context running under the profile for
     <code class="filename">/usr/bin/mail</code>. This has two consequences:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       You need to add all of the basic file accesses for
       <code class="filename">/usr/bin/less</code> to the profile for
       <code class="filename">/usr/bin/mail</code>.
      </p></li><li class="listitem"><p>
       You can avoid adding the helper applications, such as
       <code class="command">tar</code> and <code class="command">rpm</code>, to the
       <code class="filename">/usr/bin/mail</code> profile so that when
       <code class="filename">/usr/bin/mail</code> runs
       <code class="filename">/usr/bin/less</code> in this context, the less program
       is far less dangerous than it would be without <span class="phrase">AppArmor</span> protection.
       Another option is to use the Cx execute modes. For more information
       on execute modes, see <a class="xref" href="#sec-apparmor-profiles-exec" title="32.12. Execute modes">Section 32.12, “Execute modes”</a>.
      </p></li></ul></div><p>
     In other circumstances, you might instead want to use the
     <span class="guimenu">Profile</span> option. This has the following effects on
     <code class="command">aa-logprof</code>:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       The rule written into the profile uses px/Px, which forces the
       transition to the child's own profile.
      </p></li><li class="listitem"><p>
       <code class="command">aa-logprof</code> constructs a profile for the child and
       starts building it, in the same way that it built the parent profile,
       by assigning events for the child process to the child's profile and
       asking the <code class="command">aa-logprof</code> user questions. The profile
       will also be applied if you run the child as a stand-alone program.
      </p></li></ul></div><p>
     If a confined program forks and executes another program,
     <code class="command">aa-logprof</code> sees this and asks the user which
     execution mode should be used when launching the child process. The
     execution modes of inherit, profile, unconfined, child, named profile,
     or an option to deny the execution are presented.
    </p><p>
     If a separate profile exists for the child process, the default
     selection is profile. If a profile does not exist, the default is
     inherit. The inherit option, or <code class="literal">ix</code>, is described in
     <a class="xref" href="#sec-apparmor-profiles-perm" title="32.7. File permission access modes">Section 32.7, “File permission access modes”</a>.
    </p><p>
     The profile option indicates that the child program should run in its
     own profile. A secondary question asks whether to sanitize the
     environment that the child program inherits from the parent. If you
     choose to sanitize the environment, this places the execution modifier
     <code class="literal">Px</code> in your <span class="phrase">AppArmor</span> profile. If you select not to
     sanitize, <code class="literal">px</code> is placed in the profile and no
     environment sanitizing occurs. The default for the execution mode is
     <code class="literal">Px</code> if you select profile execution mode.
    </p><p>
     The unconfined execution mode is not recommended and should only be
     used in cases where there is no other option to generate a profile for
     a program reliably. Selecting unconfined opens a warning dialog asking
     for confirmation of the choice. If you are sure and choose
     <span class="guimenu">Yes</span>, a second dialog ask whether to sanitize the
     environment. To use the execution mode <code class="literal">Ux</code> in your
     profile, select <span class="guimenu">Yes</span>. To use the execution mode
     <code class="literal">ux</code> in your profile instead, select
     <span class="guimenu">No</span>. The default value selected is
     <code class="literal">Ux</code> for unconfined execution mode.
    </p><div id="id-1.7.8.8.11.9.13.21" data-id-title="Running unconfined" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Running unconfined</div><p>
      Selecting <code class="literal">ux or Ux</code> is very dangerous and provides
      no enforcement of policy (from a security perspective) of the
      resulting execution behavior of the child program.
     </p></div></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-unconfined" data-id-title="aa-unconfined—identifying unprotected processes"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.12 </span><span class="title-name">aa-unconfined—identifying unprotected processes</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-unconfined">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The <code class="command">aa-unconfined</code> command examines open network
     ports on your system, compares that to the set of profiles loaded on
     your system, and reports network services that do not have <span class="phrase">AppArmor</span>
     profiles. It requires <code class="systemitem">root</code> privileges and that it not be
     confined by an <span class="phrase">AppArmor</span> profile.
    </p><p>
     <code class="command">aa-unconfined</code> must be run as <code class="systemitem">root</code> to
     retrieve the process executable link from the
     <code class="filename">/proc</code> file system. This program is susceptible to
     the following race conditions:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       An unlinked executable is mishandled
      </p></li><li class="listitem"><p>
       A process that dies between <code class="command">netstat(8)</code> and further
       checks is mishandled
      </p></li></ul></div><div id="id-1.7.8.8.11.9.14.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      This program lists processes using TCP and UDP only. In short, this
      program is unsuitable for forensics use and is provided only as an aid
      to profiling all network-accessible processes in the lab.
     </p></div></section><section class="sect3" id="commandline-profiling-summary-aa-notify" data-id-title="aa-notify"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.13 </span><span class="title-name">aa-notify</span></span> <a title="Permalink" class="permalink" href="#commandline-profiling-summary-aa-notify">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="command">aa-notify</code> is a handy utility that displays <span class="phrase">AppArmor</span>
     notifications in your desktop environment. This is very convenient if
     you do not want to inspect the <span class="phrase">AppArmor</span> log file, but rather let the
     desktop inform you about events that violate the policy. To enable
     <span class="phrase">AppArmor</span> desktop notifications, run <code class="command">aa-notify</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-notify -p -u <em class="replaceable">USERNAME</em> --display <em class="replaceable">DISPLAY_NUMBER</em></pre></div><p>
     where <em class="replaceable">USERNAME</em> is your user name under which
     you are logged in, and <em class="replaceable">DISPLAY_NUMBER</em> is the
     X Window display number you are currently using, such as
     <code class="literal">:0</code>. The process is run in the background, and shows
     a notification each time a deny event happens.
    </p><div id="id-1.7.8.8.11.9.15.5" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
      The active X Window display number is saved in the
      <code class="literal">$DISPLAY</code> variable, so you can use
      <code class="literal">--display $DISPLAY</code> to avoid finding out the current
      display number.
     </p></div><div class="figure" id="id-1.7.8.8.11.9.15.6"><div class="figure-contents"><div class="mediaobject"><a href="images/aa-notify.png"><img src="images/aa-notify.png" width="40%" alt="aa-notify Message in GNOME" title="aa-notify Message in GNOME"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 35.1: </span><span class="title-name"><code class="command">aa-notify Message in GNOME</code> </span></span><a title="Permalink" class="permalink" href="#id-1.7.8.8.11.9.15.6">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div><p>
     With the <code class="option">-s <em class="replaceable">DAYS</em></code> option,
     you can also configure <code class="command">aa-notify</code> to display a
     summary of notifications for the specified number of past days. For
     more information on <code class="command">aa-notify</code>, see its man page
     <code class="command">man 8 aa-notify</code>.
    </p></section><section class="sect3" id="sec-apparmor-commandline-profiling-summary-vim" data-id-title="apparmor.vim"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">35.7.3.14 </span><span class="title-name">apparmor.vim</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-profiling-summary-vim">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     A syntax highlighting file for the vim text editor highlights various
     features of an <span class="phrase">AppArmor</span> profile with colors. Using vim and the <span class="phrase">AppArmor</span>
     syntax mode for vim, you can see the semantic implications of your
     profiles with color highlighting. Use vim to view and edit your profile
     by typing vim at a terminal window.
    </p><p>
     To enable the syntax coloring when you edit an <span class="phrase">AppArmor</span> profile in vim,
     use the commands <code class="literal">:syntax on</code> then <code class="literal">:set
     syntax=apparmor</code>. To make sure vim recognizes the edited file
     type correctly as an <span class="phrase">AppArmor</span> profile, add
    </p><div class="verbatim-wrap"><pre class="screen"># vim:ft=apparmor</pre></div><p>
     at the end of the profile.
    </p><div id="id-1.7.8.8.11.9.16.6" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
      <code class="command">vim</code> comes with <span class="phrase">AppArmor</span> highlighting automatically
      enabled for files in <code class="filename">/etc/apparmor.d/</code>.
     </p></div><p>
     When you enable this feature, vim colors the lines of the profile for
     you:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.11.9.16.8.1"><span class="term">Blue</span></dt><dd><p>
        Comments
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.2"><span class="term">White</span></dt><dd><p>
        Ordinary read access lines
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.3"><span class="term">Brown</span></dt><dd><p>
        Capability statements and complain flags
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.4"><span class="term">Yellow</span></dt><dd><p>
        Lines that grant write access
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.5"><span class="term">Green</span></dt><dd><p>
        Lines that grant execute permission (either ix or px)
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.6"><span class="term">Red</span></dt><dd><p>
        Lines that grant unconfined access (ux)
       </p></dd><dt id="id-1.7.8.8.11.9.16.8.7"><span class="term">Red background</span></dt><dd><p>
        Syntax errors that will not load properly into the <span class="phrase">AppArmor</span> modules
       </p></dd></dl></div><p>
     Use the <code class="systemitem">apparmor.vim</code> and
     <code class="systemitem">vim</code> man pages and the <code class="option">:help
     syntax</code> from within the vim editor for further vim help about
     syntax highlighting. The <span class="phrase">AppArmor</span> syntax is stored in
     <code class="filename">/usr/share/vim/current/syntax/apparmor.vim.</code>
    </p></section></section></section><section class="sect1" id="sec-apparmor-commandline-filenames" data-id-title="Important file names and directories"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">35.8 </span><span class="title-name">Important file names and directories</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-commandline-filenames">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles_man.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following list contains the most important files and directories used
   by the <span class="phrase">AppArmor</span> framework. If you intend to manage and troubleshoot your
   profiles manually, make sure that you know about these files and
   directories:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.8.12.3.1"><span class="term"><code class="filename">/sys/kernel/security/apparmor/profiles</code>
    </span></dt><dd><p>
      Virtualized file representing the currently loaded set of profiles.
     </p></dd><dt id="id-1.7.8.8.12.3.2"><span class="term"><code class="filename">/etc/apparmor/</code>
    </span></dt><dd><p>
      Location of <span class="phrase">AppArmor</span> configuration files.
     </p></dd><dt id="id-1.7.8.8.12.3.3"><span class="term"><code class="filename">/usr/share/apparmor/extra-profiles</code>
    </span></dt><dd><p>
      A local repository of profiles shipped with <span class="phrase">AppArmor</span>, but not enabled
      by default.
     </p></dd><dt id="id-1.7.8.8.12.3.4"><span class="term"><code class="filename">/etc/apparmor.d/</code>
    </span></dt><dd><p>
      Location of profiles, named with the convention of replacing the
      <code class="literal">/</code> in paths with <code class="literal">.</code> (not for the
      root <code class="literal">/</code>) so profiles are easier to manage. For
      example, the profile for the program
      <code class="filename">/usr/sbin/smbd</code> is named
      <code class="filename">usr.sbin.smbd</code>.
     </p></dd><dt id="id-1.7.8.8.12.3.5"><span class="term"><code class="filename">/etc/apparmor.d/abstractions/</code>
    </span></dt><dd><p>
      Location of abstractions.
     </p></dd><dt id="id-1.7.8.8.12.3.6"><span class="term"><code class="filename">/etc/apparmor.d/program-chunks/</code>
    </span></dt><dd><p>
      Location of program chunks.
     </p></dd><dt id="id-1.7.8.8.12.3.7"><span class="term"><code class="filename">/proc/*/attr/current</code>
    </span></dt><dd><p>
      Check this file to review the confinement status of a process and the
      profile that is used to confine the process. The <code class="command">ps</code>
      <code class="option">auxZ</code> command retrieves this information
      automatically.
     </p></dd></dl></div></section></section><section class="chapter" id="cha-apparmor-hat" data-id-title="Profiling your Web applications using ChangeHat"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">36 </span><span class="title-name">Profiling your Web applications using ChangeHat</span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-hat">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  An <span class="phrase">AppArmor®</span> profile represents the security policy for an individual
  program instance or process. It applies to an executable program, but if a
  portion of the program needs different access permissions than other
  portions, the program can <span class="quote">“<span class="quote">change hats</span>”</span> to use a different
  security context, distinctive from the access of the main program. This is
  known as a <span class="emphasis"><em>hat</em></span> or <span class="emphasis"><em>subprofile</em></span>.
 </p><p>
  ChangeHat enables programs to change to or from a <span class="emphasis"><em>hat</em></span>
  within an <span class="phrase">AppArmor</span> profile. It enables you to define security at a finer
  level than the process. This feature requires that each application be
  made <span class="quote">“<span class="quote">ChangeHat-aware</span>”</span>, meaning that it is modified to make a
  request to the <span class="phrase">AppArmor</span> module to switch security domains at specific times
  during the application execution. One example of a ChangeHat-aware
  application is the Apache Web server.
 </p><p>
  A profile can have an arbitrary number of subprofiles, but there are only
  two levels: a subprofile cannot have further child profiles. A subprofile
  is written as a separate profile. Its name consists of the name of the
  containing profile followed by the subprofile name, separated by a
  <code class="literal">^</code>.
 </p><p>
  Subprofiles are either stored in the same file as the parent profile, or
  in a separate file. The latter case is recommended on sites with many
  hats—it allows the policy caching to handle changes at
  the per hat level. If all the hats are in the same file as the parent
  profile, then the parent profile and all hats must be recompiled.
 </p><p>
  An external subprofile that is going to be used as a hat, must begin with
  the word <code class="literal">hat</code> or the <code class="literal">^</code> character.
 </p><p>
  The following two subprofiles <span class="emphasis"><em>cannot</em></span> be used as a
  hat:
 </p><div class="verbatim-wrap"><pre class="screen">/foo//bar { }</pre></div><p>
  or
 </p><div class="verbatim-wrap"><pre class="screen">profile /foo//bar { }</pre></div><p>
  While the following two are treated as hats:
 </p><div class="verbatim-wrap"><pre class="screen">^/foo//bar { }</pre></div><p>
  or
 </p><div class="verbatim-wrap"><pre class="screen">hat /foo//bar { } # this syntax is not highlighted in vim</pre></div><p>
  Note that the security of hats is considerably weaker than that of full
  profiles. Using certain types of bugs in a program, an attacker may be
  able to escape from a hat into the containing profile. This is because the
  security of hats is determined by a secret key handled by the containing
  process, and the code running in the hat must not have access to the key.
  Thus, change_hat is most useful with application servers,
  where a language interpreter (such as PERL, PHP, or Java) is isolating
  pieces of code such that they do not have direct access to the memory of
  the containing process.
 </p><p>
  The rest of this chapter describes using change_hat with
  Apache, to contain Web server components run using <code class="literal">mod_perl</code> and <code class="literal">mod_php</code>.
  Similar approaches can be used with any application server by providing an
  application module similar to the <code class="literal">mod_apparmor</code> described next in
  <a class="xref" href="#sec-apparmor-hat-config-directives" title="36.1.2. Location and directory directives">Section 36.1.2, “Location and directory directives”</a>.
 </p><div id="id-1.7.8.9.18" data-id-title="More information" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: More information</div><p>
   For more information, see the <code class="command">change_hat</code> man page.
  </p></div><section class="sect1" id="sec-apparmor-hat-config" data-id-title="Configuring Apache for mod_apparmor"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.1 </span><span class="title-name">Configuring Apache for <code class="systemitem">mod_apparmor</code></span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-hat-config">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="phrase">AppArmor</span> provides a <code class="literal">mod_apparmor</code> module (package <code class="systemitem">apache2-mod-apparmor</code>) for the Apache
   program<span class="phrase"> (only included in SUSE Linux Enterprise Server)</span>. This module
   makes the Apache Web server ChangeHat aware. Install it along with Apache.
  </p><p>
   When Apache is ChangeHat-aware, it checks for the following customized
   <span class="phrase">AppArmor</span> security profiles in the order given for every URI request that
   it receives.
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     URI-specific hat. For example,
     <code class="filename">^www_app_name/templates/classic/images/bar_left.gif</code>
    </p></li><li class="listitem"><p>
     <code class="literal">DEFAULT_URI</code>
    </p></li><li class="listitem"><p>
     <code class="literal">HANDLING_UNTRUSTED_INPUT</code>
    </p></li></ul></div><div id="id-1.7.8.9.19.5" data-id-title="Apache configuration" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Apache configuration</div><p>
    If you install
    <code class="systemitem">apache2-mod-apparmor</code>, make
    sure the module is enabled, and then restart Apache by executing the
    following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>a2enmod apparmor &amp;&amp; sudo systemctl reload apache2</pre></div></div><p>
   Apache is configured by placing directives in plain text configuration
   files. The main configuration file is usually
   <code class="filename">/etc/apache2/httpd.conf</code>. When you compile Apache,
   you can indicate the location of this file. Directives can be placed in
   any of these configuration files to alter the way Apache behaves. When
   you make changes to the main configuration files, you need to reload
   Apache with <code class="command">sudo systemctl reload apache2</code>, so
   the changes are recognized.
  </p><section class="sect2" id="sec-apparmor-hat-config-vhost" data-id-title="Virtual host directives"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">36.1.1 </span><span class="title-name">Virtual host directives</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-hat-config-vhost">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    &lt;VirtualHost&gt; and &lt;/VirtualHost&gt; directives are used
    to enclose a group of directives that will apply only to a particular
    virtual host. For more information on Apache virtual host directives,
    refer to
    <a class="link" href="http://httpd.apache.org/docs/2.4/en/mod/core.html#virtualhost" target="_blank">http://httpd.apache.org/docs/2.4/en/mod/core.html#virtualhost</a>.
   </p><p>
    The ChangeHat-specific configuration keyword is
    <code class="literal">AADefaultHatName</code>. It is used similarly to
    <code class="literal">AAHatName</code>, for example, <code class="literal">AADefaultHatName
    My_Funky_Default_Hat</code>.
   </p><p>
    It allows you to specify a default hat to be used for virtual hosts and
    other Apache server directives, so that you can have different defaults
    for different virtual hosts. This can be overridden by the
    <code class="literal">AAHatName</code> directive and is checked for only if there
    is not a matching <code class="literal">AAHatName</code> or hat named by the URI.
    If the <code class="literal">AADefaultHatName</code> hat does not exist, it falls
    back to the <code class="literal">DEFAULT_URI</code> hat if it exists/
   </p><p>
    If none of those are matched, it goes back to the <span class="quote">“<span class="quote">parent</span>”</span>
    Apache hat.
   </p></section><section class="sect2" id="sec-apparmor-hat-config-directives" data-id-title="Location and directory directives"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">36.1.2 </span><span class="title-name">Location and directory directives</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-hat-config-directives">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Location and directory directives specify hat names in the program
    configuration file so the Apache calls the hat regarding its security.
    For Apache, you can find documentation about the location and directory
    directives at
    <a class="link" href="http://httpd.apache.org/docs/2.4/en/sections.html" target="_blank">http://httpd.apache.org/docs/2.4/en/sections.html</a>.
   </p><p>
    The location directive example below specifies that, for a given
    location, <code class="literal">mod_apparmor</code> should use a specific hat:
   </p><div class="verbatim-wrap"><pre class="screen">&lt;Location /foo/&gt;
  AAHatName MY_HAT_NAME
&lt;/Location&gt;</pre></div><p>
    This tries to use <code class="literal">MY_HAT_NAME</code> for any URI beginning
    with <code class="filename">/foo/</code> (<code class="filename">/foo/</code>,
    <code class="filename">/foo/bar</code>,
    <code class="filename">/foo/cgi/path/blah_blah/blah</code>, etc.).
   </p><p>
    The directory directive works similarly to the location directive,
    except it refers to a path in the file system as in the following
    example:
   </p><div class="verbatim-wrap"><pre class="screen">&lt;Directory "/srv/www/www.example.org/docs"&gt;
  # Note lack of trailing slash
  AAHatName example.org
&lt;/Directory&gt;</pre></div></section></section><section class="sect1" id="sec-apparmor-hat-apache-managing" data-id-title="Managing ChangeHat-aware applications"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">36.2 </span><span class="title-name">Managing ChangeHat-aware applications</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-hat-apache-managing">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In the previous section you learned about <code class="literal">mod_apparmor</code>
   and the way it helps you to secure a specific Web application. This
   section walks you through a real-life example of creating a hat for a Web
   application, and using <span class="phrase">AppArmor</span>'s change_hat feature to secure it.
   Note that this chapter focuses on <span class="phrase">AppArmor</span>'s command line tools, as
   YaST's <span class="phrase">AppArmor</span> module has limited functionality.
  </p><section class="sect2" id="id-1.7.8.9.20.3" data-id-title="With AppArmors command line tools"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">36.2.1 </span><span class="title-name">With <span class="phrase">AppArmor</span>'s command line tools</span></span> <a title="Permalink" class="permalink" href="#id-1.7.8.9.20.3">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For illustration purposes, let us choose the Web application called
   <span class="emphasis"><em>Adminer</em></span>
   (<a class="link" href="http://www.adminer.org/en/" target="_blank">http://www.adminer.org/en/</a>). It is a full-featured
   SQL database management tool written in PHP, yet consisting of a single
   PHP file. For Adminer to work, you need to set up an Apache Web server,
   PHP and its Apache module, and one of the database drivers available for
   PHP—MariaDB in this example. You can install the required
   packages with
  </p><div class="verbatim-wrap"><pre class="screen">zypper in apache2 apache2-mod_apparmor apache2-mod_php5 php5 php5-mysql</pre></div><p>
   To set up the Web environment for running Adminer, follow these steps:
  </p><div class="procedure" id="id-1.7.8.9.20.3.5" data-id-title="Setting up a web server environment"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 36.1: </span><span class="title-name">Setting up a web server environment </span></span><a title="Permalink" class="permalink" href="#id-1.7.8.9.20.3.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Make sure <code class="literal">apparmor</code> and <code class="literal">php5</code>
     modules are enabled for Apache. To enable the modules in any case, use:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>a2enmod apparmor php5</pre></div><p>
     and then restart Apache with
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart apache2</pre></div></li><li class="step"><p>
     Make sure MariaDB is running. If unsure, restart it with
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart mariadb</pre></div></li><li class="step"><p>
     Download Adminer from <a class="link" href="http://www.adminer.org" target="_blank">http://www.adminer.org</a>, copy
     it to <code class="filename">/srv/www/htdocs/adminer/</code>, and rename it to
     <code class="filename">adminer.php</code>, so that its full path is
     <code class="filename">/srv/www/htdocs/adminer/adminer.php</code>.
    </p></li><li class="step"><p>
     Test Adminer in your Web browser by entering
     <code class="literal">http://localhost/adminer/adminer.php</code> in its URI
     address field. If you installed Adminer to a remote server, replace
     <code class="literal">localhost</code> with the real host name of the server.
    </p><div class="figure" id="id-1.7.8.9.20.3.5.5.2"><div class="figure-contents"><div class="mediaobject"><a href="images/aa_changehat_adminer.png"><img src="images/aa_changehat_adminer.png" width="40%" alt="Adminer login page" title="Adminer login page"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 36.1: </span><span class="title-name">Adminer login page </span></span><a title="Permalink" class="permalink" href="#id-1.7.8.9.20.3.5.5.2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div></div><div id="id-1.7.8.9.20.3.5.5.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p> If you encounter problems viewing the Adminer login page,
            try to look for help in the Apache error log
              <code class="filename">/var/log/apache2/error.log</code>. Another
            reason you cannot access the Web page may be
            that your Apache is already under <span class="phrase">AppArmor</span> control and its <span class="phrase">AppArmor</span>
            profile is too tight to permit viewing Adminer. Check it
            with <code class="command">aa-status</code>, and if needed, set Apache
            temporarily in complain mode with </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>sudo aa-complain usr.sbin.httpd2-prefork</pre></div></div></li></ol></div></div><p>
   After the Web environment for Adminer is ready, you need to configure
   Apache's <code class="literal">mod_apparmor</code>, so that <span class="phrase">AppArmor</span> can detect accesses to Adminer and
   change to the specific <span class="quote">“<span class="quote">hat</span>”</span>.
  </p><div class="procedure" id="id-1.7.8.9.20.3.7" data-id-title="Configuring mod_apparmor"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 36.2: </span><span class="title-name">Configuring <code class="literal">mod_apparmor</code> </span></span><a title="Permalink" class="permalink" href="#id-1.7.8.9.20.3.7">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Apache has several configuration files under
     <code class="filename">/etc/apache2/</code> and
     <code class="filename">/etc/apache2/conf.d/</code>. Choose your preferred one
     and open it in a text editor. In this example, the
     <code class="command">vim</code> editor is used to create a new configuration
     file <code class="filename">/etc/apache2/conf.d/apparmor.conf</code>.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> vim /etc/apache2/conf.d/apparmor.conf</pre></div></li><li class="step"><p>
     Copy the following snippet into the edited file.
    </p><div class="verbatim-wrap"><pre class="screen">&lt;Directory /srv/www/htdocs/adminer&gt;
  AAHatName adminer
&lt;/Directory&gt;</pre></div><p>
     It tells Apache to let <span class="phrase">AppArmor</span> know about a change_hat event when the
     Web user accesses the directory <code class="filename">/adminer</code> (and any
     file/directory inside) in Apache's document root. Remember, we placed
     the <code class="filename">adminer.php</code> application there.
    </p></li><li class="step"><p>
     Save the file, close the editor, and restart Apache with
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart apache2</pre></div></li></ol></div></div><p>
   Apache now knows about our Adminer and changing a <span class="quote">“<span class="quote">hat</span>”</span> for
   it. It is time to create the related hat for Adminer in the <span class="phrase">AppArmor</span>
   configuration. If you do not have an <span class="phrase">AppArmor</span> profile yet, create one
   before proceeding. Remember that if your Apache's main binary is
   <code class="filename">/usr/sbin/httpd2-prefork</code>, then the related profile
   is named <code class="filename">/etc/apparmor.d/usr.sbin.httpd2-prefork</code>.
  </p><div class="procedure" id="id-1.7.8.9.20.3.9" data-id-title="Creating a hat for Adminer"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 36.3: </span><span class="title-name">Creating a hat for Adminer </span></span><a title="Permalink" class="permalink" href="#id-1.7.8.9.20.3.9">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Open (or create one if it does not exist) the file
     <code class="filename">/etc/apparmor.d/usr.sbin.httpd2-prefork</code> in a text
     editor. Its contents should be similar to the following:
    </p><div class="verbatim-wrap"><pre class="screen">#include &lt;tunables/global&gt;

/usr/sbin/httpd2-prefork {
  #include &lt;abstractions/apache2-common&gt;
  #include &lt;abstractions/base&gt;
  #include &lt;abstractions/php5&gt;

  capability kill,
  capability setgid,
  capability setuid,

  /etc/apache2/** r,
  /run/httpd.pid rw,
  /usr/lib{,32,64}/apache2*/** mr,
  /var/log/apache2/** rw,

  ^DEFAULT_URI {
    #include &lt;abstractions/apache2-common&gt;
    /var/log/apache2/** rw,
  }

  ^HANDLING_UNTRUSTED_INPUT {
    #include &lt;abstractions/apache2-common&gt;
    /var/log/apache2/** w,
  }
}</pre></div></li><li class="step"><p>
     Before the last closing curly bracket (<code class="literal">}</code>), insert
     the following section:
    </p><div class="verbatim-wrap"><pre class="screen">^adminer flags=(complain) {
}</pre></div><p>
     Note the <code class="literal">(complain)</code> addition after the hat
     name—it tells <span class="phrase">AppArmor</span> to leave the
     <code class="systemitem">adminer</code> hat in complain mode. That is because
     we need to learn the hat profile by accessing Adminer later on.
     
    </p></li><li class="step"><p>
     Save the file, and then restart <span class="phrase">AppArmor</span>, then Apache.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl reload apparmor apache2</pre></div></li><li class="step"><p>
     Check if the <code class="systemitem">adminer</code> hat really is in complain
     mode.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-status
apparmor module is loaded.
39 profiles are loaded.
37 profiles are in enforce mode.
[...]
   /usr/sbin/httpd2-prefork
   /usr/sbin/httpd2-prefork//DEFAULT_URI
   /usr/sbin/httpd2-prefork//HANDLING_UNTRUSTED_INPUT
[...]
2 profiles are in complain mode.
   /usr/bin/getopt
   /usr/sbin/httpd2-prefork//adminer
[...]</pre></div><p>
     As we can see, the <code class="literal">httpd2-prefork//adminer</code> is loaded
     in complain mode.
    </p></li></ol></div></div><p>
   Our last task is to find out the right set of rules for the
   <code class="systemitem">adminer</code> hat. That is why we set the
   <code class="systemitem">adminer</code> hat into complain mode—the
   logging facility collects useful information about the access
   requirements of <code class="filename">adminer.php</code> as we use it via the Web
   browser. <code class="command">aa-logprof</code> then helps us with creating the
   hat's profile.
  </p><div class="procedure" id="id-1.7.8.9.20.3.11" data-id-title="Generating rules for the adminer hat"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 36.4: </span><span class="title-name">Generating rules for the <code class="systemitem">adminer</code> hat </span></span><a title="Permalink" class="permalink" href="#id-1.7.8.9.20.3.11">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Open Adminer in the Web browser. If you installed it locally, then the
     URI is <code class="literal">http://localhost/adminer/adminer.php</code>.
    </p></li><li class="step"><p>
     Choose the database engine you want to use (MariaDB in our case),
     and log in to Adminer using the existing database user name and
     password. You do not need to specify the database name as you can do so
     after logging in. Perform any operations with Adminer you
     like—create a new database, create a new table for it, set
     user privileges, and so on.
    </p></li><li class="step"><p>
     After the short testing of Adminer's user interface, switch back to
     console and examine the log for collected data.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-logprof
Reading log entries from /var/log/audit/audit.log.
Updating AppArmor profiles in /etc/apparmor.d.
Complain-mode changes:

Profile:  /usr/sbin/httpd2-prefork^adminer
Path:     /dev/urandom
Mode:     r
Severity: 3

  1 - #include &lt;abstractions/apache2-common&gt;
[...]
 [8 - /dev/urandom]

[(A)llow] / (D)eny / (G)lob / Glob w/(E)xt / (N)ew / Abo(r)t / (F)inish / (O)pts</pre></div><p>
     From the <code class="command">aa-logprof</code> message, it is clear that our
     new <code class="systemitem">adminer</code> hat was correctly detected:
    </p><div class="verbatim-wrap"><pre class="screen">Profile:  /usr/sbin/httpd2-prefork^adminer</pre></div><p>
     The <code class="command">aa-logprof</code> command will ask you to pick the
     right rule for each discovered <span class="phrase">AppArmor</span> event. Specify the one you want
     to use, and confirm with <span class="guimenu">Allow</span>. For more information
     on working with the <code class="command">aa-genprof</code> and
     <code class="command">aa-logprof</code> interface, see
     <a class="xref" href="#sec-apparmor-commandline-profiling-summary-genprof" title="35.7.3.8. aa-genprof—generating profiles">Section 35.7.3.8, “aa-genprof—generating profiles”</a>.
    </p><div id="id-1.7.8.9.20.3.11.4.6" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
      <code class="command">aa-logprof</code> usually offers several valid rules for
      the examined event. Some are
      <span class="emphasis"><em>abstractions</em></span>—predefined sets of rules
      affecting a specific common group of targets. Sometimes it is useful
      to include such an abstraction instead of a direct URI rule:
     </p><div class="verbatim-wrap"><pre class="screen"> 1 - #include &lt;abstractions/php5&gt;
 [2 - /var/lib/php5/sess_3jdmii9cacj1e3jnahbtopajl7p064ai242]</pre></div><p>
      In the example above, it is recommended hitting <span class="guimenu">1</span>
      and confirming with <span class="guimenu">A</span> to allow the abstraction.
     </p></div></li><li class="step"><p>
     After the last change, you will be asked to save the changed profile.
    </p><div class="verbatim-wrap"><pre class="screen">The following local profiles were changed. Would you like to save them?
 [1 - /usr/sbin/httpd2-prefork]

 (S)ave Changes / [(V)iew Changes] / Abo(r)t</pre></div><p>
     Hit <span class="guimenu">S</span> to save the changes.
    </p></li><li class="step"><p>
     Set the profile to enforce mode with <code class="command">aa-enforce</code>
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-enforce usr.sbin.httpd2-prefork</pre></div><p>
     and check its status with <code class="command">aa-status</code>
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aa-status
apparmor module is loaded.
39 profiles are loaded.
38 profiles are in enforce mode.
[...]
   /usr/sbin/httpd2-prefork
   /usr/sbin/httpd2-prefork//DEFAULT_URI
   /usr/sbin/httpd2-prefork//HANDLING_UNTRUSTED_INPUT
   /usr/sbin/httpd2-prefork//adminer
[...]</pre></div><p>
     As you can see, the <code class="literal">//adminer</code> hat jumped from
     <span class="emphasis"><em>complain</em></span> to <span class="emphasis"><em>enforce</em></span> mode.
    </p></li><li class="step"><p>
     Try to run Adminer in the Web browser, and if you encounter problems
     running it, switch it to the complain mode, repeat the steps that
     previously did not work well, and update the profile with
     <code class="command">aa-logprof</code> until you are satisfied with the
     application's functionality.
    </p></li></ol></div></div><div id="id-1.7.8.9.20.3.12" data-id-title="Hat and parent profile relationship" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Hat and parent profile relationship</div><p>
    The profile <code class="filename">^adminer</code> is only available in the
    context of a process running under the parent profile
    <code class="filename">usr.sbin.httpd2-prefork</code>.
   </p></div></section><section class="sect2" id="sec-apparmor-hat-apache-managing-add" data-id-title="Adding hats and entries to hats in YaST"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">36.2.2 </span><span class="title-name">Adding hats and entries to hats in YaST</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-hat-apache-managing-add">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_changehat.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When you use the <span class="guimenu">Edit Profile</span> dialog (for
    instructions, refer to
    <a class="xref" href="#sec-apparmor-yast-edit" title="34.2. Editing profiles">Section 34.2, “Editing profiles”</a>) or
    when you add a new profile using <span class="guimenu">Manually Add Profile</span>
    (for instructions, refer to
    <a class="xref" href="#sec-apparmor-yast-add" title="34.1. Manually adding a profile">Section 34.1, “Manually adding a profile”</a>),
    you are given the option of adding hats (subprofiles) to your <span class="phrase">AppArmor</span>
    profiles. Add a ChangeHat subprofile from the <span class="guimenu"><span class="phrase">AppArmor</span> Profile
    Dialog</span> window as in the following.
   </p><div class="informalfigure"><div class="mediaobject"><a href="images/hats_in_profiles.png"><img src="images/hats_in_profiles.png" width="75%" alt="AppArmor profile dialog" title="AppArmor profile dialog"/></a></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      From the <span class="guimenu"><span class="phrase">AppArmor</span> Profile Dialog</span> window, click
      <span class="guimenu">Add Entry</span> then select <span class="guimenu">Hat</span>. The
      <span class="guimenu">Enter Hat Name</span> dialog opens:
     </p><div class="informalfigure"><div class="mediaobject"><a href="images/hat_createhat.png"><img src="images/hat_createhat.png" width="35%" alt="Enter hat name" title="Enter hat name"/></a></div></div></li><li class="step"><p>
      Enter the name of the hat to add to the <span class="phrase">AppArmor</span> profile. The name is
      the URI that, when accessed, receives the permissions set in the hat.
     </p></li><li class="step"><p>
      Click <span class="guimenu">Create Hat</span>. You are returned to the
      <span class="guimenu"><span class="phrase">AppArmor</span> Profile Dialog</span> screen.
     </p></li><li class="step"><p>
      After adding the new hat, click <span class="guimenu">Done</span>.
     </p></li></ol></div></div></section></section></section><section class="chapter" id="cha-apparmor-pam" data-id-title="Confining users with pam_apparmor"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">37 </span><span class="title-name">Confining users with <code class="systemitem">pam_apparmor</code></span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-pam">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_pam.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  An <span class="phrase">AppArmor</span> profile applies to an executable program; if a portion of the
  program needs different access permissions than other portions need, the
  program can change hats via change_hat to a different role, also known as
  a subprofile. The <code class="systemitem">pam_apparmor</code> PAM module allows
  applications to confine authenticated users into subprofiles based on
  group names, user names, or a default profile. To accomplish this,
  <code class="systemitem">pam_apparmor</code> needs to be registered as a PAM
  session module.
 </p><p>
  The package <code class="systemitem">pam_apparmor</code> is not installed by
  default, you can install it using YaST or <code class="command">zypper</code>.
  Details about how to set up and configure
  <code class="systemitem">pam_apparmor</code> can be found in
  <code class="filename">/usr/share/doc/packages/pam_apparmor/README</code> after the
  package has been installed. For details on PAM, refer to
  <a class="xref" href="#cha-pam" title="Chapter 2. Authentication with PAM">Chapter 2, <em>Authentication with PAM</em></a>.
 </p></section><section class="chapter" id="cha-apparmor-managing" data-id-title="Managing profiled applications"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">38 </span><span class="title-name">Managing profiled applications</span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-managing">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  After creating profiles and immunizing your applications,
  <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span> becomes more efficient and better protected as long as
  you perform <span class="phrase">AppArmor®</span> profile maintenance (which involves analyzing log
  files, refining your profiles, backing up your set of profiles and keeping
  it up-to-date). You can deal with these issues before they become a
  problem by setting up event notification by e-mail, updating profiles from
  system log entries by running the aa-logprof tool, and dealing with
  maintenance issues.
 </p><section class="sect1" id="sec-apparmor-managing-react" data-id-title="Reacting to security event rejections"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">38.1 </span><span class="title-name">Reacting to security event rejections</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-managing-react">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When you receive a security event rejection, examine the access violation
   and determine if that event indicated a threat or was part of normal
   application behavior. Application-specific knowledge is required to make
   the determination. If the rejected action is part of normal application
   behavior, run <code class="command">aa-logprof</code> at the command line.
  </p><p>
   If the rejected action is not part of normal application behavior, this
   access should be considered a possible intrusion attempt (that was
   prevented) and this notification should be passed to the person
   responsible for security within your organization.
  </p></section><section class="sect1" id="sec-apparmor-managing-maintain" data-id-title="Maintaining your security profiles"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">38.2 </span><span class="title-name">Maintaining your security profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-managing-maintain">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In a production environment, you should plan on maintaining profiles for
   all of the deployed applications. The security policies are an integral
   part of your deployment. You should plan on taking steps to back up and
   restore security policy files, plan for software changes, and allow any
   needed modification of security policies that your environment dictates.
  </p><section class="sect2" id="sec-apparmor-managing-maintain-backup" data-id-title="Backing up your security profiles"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">38.2.1 </span><span class="title-name">Backing up your security profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-managing-maintain-backup">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Backing up profiles might save you from having to re-profile all your
    programs after a disk crash. Also, if profiles are changed, you can
    easily restore previous settings by using the backed up files.
   </p><p>
    Back up profiles by copying the profile files to a specified directory.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      You should first archive the files into one file. To do this, open a
      terminal window and enter the following as <code class="systemitem">root</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> tar zclpf profiles.tgz /etc/apparmor.d</pre></div><p>
      The simplest method to ensure that your security policy files are
      regularly backed up is to include the directory
      <code class="filename">/etc/apparmor.d</code> in the list of directories that
      your backup system archives.
     </p></li><li class="step"><p>
      You can also use <code class="command">scp</code> or a file manager like
      Nautilus to store the files on some kind of storage media, the
      network, or another computer.
     </p></li></ol></div></div></section><section class="sect2" id="sec-apparmor-managing-maintain-change" data-id-title="Changing your security profiles"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">38.2.2 </span><span class="title-name">Changing your security profiles</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-managing-maintain-change">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Maintenance of security profiles includes changing them if you decide
    that your system requires more or less security for its applications. To
    change your profiles in <span class="phrase">AppArmor</span>, refer to
    <a class="xref" href="#sec-apparmor-yast-edit" title="34.2. Editing profiles">Section 34.2, “Editing profiles”</a>.
   </p></section><section class="sect2" id="sec-apparmor-managing-maintain-change-new-software" data-id-title="Introducing new software into your environment"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">38.2.3 </span><span class="title-name">Introducing new software into your environment</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-managing-maintain-change-new-software">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_managing.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When you add a new application version or patch to your system, you
    should always update the profile to fit your needs. You have several
    options, depending on your company's software deployment strategy. You
    can deploy your patches and upgrades into a test or production
    environment. The following explains how to do this with each method.
   </p><p>
    If you intend to deploy a patch or upgrade in a test environment, the
    best method for updating your profiles is to run
    <code class="command">aa-logprof</code> in a terminal as <code class="systemitem">root</code>. For
    detailed instructions, refer to
    <a class="xref" href="#sec-apparmor-commandline-profiling-summary-logprof" title="35.7.3.9. aa-logprof—scanning the system log">Section 35.7.3.9, “aa-logprof—scanning the system log”</a>.
   </p><p>
    If you intend to deploy a patch or upgrade directly into a production
    environment, the best method for updating your profiles is to monitor
    the system frequently to determine if any new rejections should be added
    to the profile and update as needed using <code class="command">aa-logprof</code>.
    For detailed instructions, refer to
    <a class="xref" href="#sec-apparmor-commandline-profiling-summary-logprof" title="35.7.3.9. aa-logprof—scanning the system log">Section 35.7.3.9, “aa-logprof—scanning the system log”</a>.
   </p></section></section></section><section class="chapter" id="cha-apparmor-support" data-id-title="Support"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">39 </span><span class="title-name">Support</span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-support">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This chapter outlines maintenance-related tasks. Learn how to update
  <span class="phrase">AppArmor®</span> and get a list of available man pages providing basic help for
  using the command line tools provided by <span class="phrase">AppArmor</span>. Use the troubleshooting
  section to learn about some common problems encountered with <span class="phrase">AppArmor</span> and
  their solutions. Report defects or enhancement requests for <span class="phrase">AppArmor</span>
  following the instructions in this chapter.
 </p><section class="sect1" id="sec-apparmor-support-updating" data-id-title="Updating AppArmor online"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">39.1 </span><span class="title-name">Updating <span class="phrase">AppArmor</span> online</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-updating">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Updates for <span class="phrase">AppArmor</span> packages are provided in the same way as any other
   update for <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. Retrieve and apply them exactly like for any
   other package that ships as part of <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>.
  </p></section><section class="sect1" id="sec-apparmor-support-man" data-id-title="Using the man pages"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">39.2 </span><span class="title-name">Using the man pages</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-man">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are man pages available for your use. In a terminal, enter
   <code class="command">man apparmor</code> to open the <span class="phrase">AppArmor</span> man page. Man pages
   are distributed in sections numbered 1 through 8. Each section is
   specific to a category of documentation:
  </p><div class="table" id="id-1.7.8.12.5.3" data-id-title="Man pages: sections and categories"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 39.1: </span><span class="title-name">Man pages: sections and categories </span></span><a title="Permalink" class="permalink" href="#id-1.7.8.12.5.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Section
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Category
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        1
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        User commands
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        2
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        System calls
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        3
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Library functions
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        4
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Device driver information
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        5
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Configuration file formats
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        6
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Games
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        7
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        High level concepts
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        8
       </p>
      </td><td>
       <p>
        Administrator commands
       </p>
      </td></tr></tbody></table></div></div><p>
   The section numbers are used to distinguish man pages from each other.
   For example, <code class="systemitem">exit(2)</code> describes the exit system
   call, while <code class="systemitem">exit(3)</code> describes the exit C library
   function.
  </p><p>
   The <span class="phrase">AppArmor</span> man pages are:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="systemitem">aa-audit(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-autodep(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-complain(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-decode(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-disable(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-easyprof(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-enforce(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-enxec(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-genprof(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-logprof(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-notify(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-status(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa-unconfined(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">aa_change_hat(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">logprof.conf(5)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">apparmor.d(5)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">apparmor.vim(5)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">apparmor(7)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">apparmor_parser(8)</code>
    </p></li><li class="listitem"><p>
     <code class="systemitem">apparmor_status(8)</code>
    </p></li></ul></div></section><section class="sect1" id="sec-apparmor-support-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">39.3 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Find more information about the <span class="phrase">AppArmor</span> product at:
   <a class="link" href="http://wiki.apparmor.net" target="_blank">http://wiki.apparmor.net</a>. Find the product
   documentation for <span class="phrase">AppArmor</span> in the installed system at
   <code class="filename">/usr/share/doc/manual</code>.
  </p><p>
   There is a mailing list for <span class="phrase">AppArmor</span> that users can post to or join to
   communicate with developers. See
   <a class="link" href="https://lists.ubuntu.com/mailman/listinfo/apparmor" target="_blank">https://lists.ubuntu.com/mailman/listinfo/apparmor</a>
   for details.
  </p></section><section class="sect1" id="sec-apparmor-support-trouble" data-id-title="Troubleshooting"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">39.4 </span><span class="title-name">Troubleshooting</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-trouble">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section lists the most common problems and error messages that may
   occur using <span class="phrase">AppArmor</span>.
  </p><section class="sect2" id="sec-apparmor-support-trouble-odd" data-id-title="How to react to odd application behavior?"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">39.4.1 </span><span class="title-name">How to react to odd application behavior?</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-trouble-odd">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you notice odd application behavior or any other type of application
    problem, you should first check the reject messages in the log files to
    see if <span class="phrase">AppArmor</span> is too closely constricting your application. If you
    detect reject messages that indicate that your application or service is
    too closely restricted by <span class="phrase">AppArmor</span>, update your profile to properly
    handle your use case of the application. Do this with
    <code class="command">aa-logprof</code>
    (<a class="xref" href="#sec-apparmor-commandline-profiling-summary-logprof" title="35.7.3.9. aa-logprof—scanning the system log">Section 35.7.3.9, “aa-logprof—scanning the system log”</a>).
   </p><p>
    If you decide to run your application or service without <span class="phrase">AppArmor</span>
    protection, remove the application's profile from
    <code class="filename">/etc/apparmor.d</code> or move it to another location.
   </p></section><section class="sect2" id="sec-apparmor-support-trouble-dirpath" data-id-title="My profiles do not seem to work anymore …"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">39.4.2 </span><span class="title-name">My profiles do not seem to work anymore …</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-trouble-dirpath">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you have been using previous versions of <span class="phrase">AppArmor</span> and have updated
    your system (but kept your old set of profiles) you might notice some
    applications which seemed to work perfectly before you updated behaving
    strangely, or not working.
   </p><p>
    This version of <span class="phrase">AppArmor</span> introduces a set of new features to the profile
    syntax and the <span class="phrase">AppArmor</span> tools that might cause trouble with older
    versions of the <span class="phrase">AppArmor</span> profiles. Those features are:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      File Locking
     </p></li><li class="listitem"><p>
      Network Access Control
     </p></li><li class="listitem"><p>
      The <code class="literal">SYS_PTRACE</code> Capability
     </p></li><li class="listitem"><p>
      Directory Path Access
     </p></li></ul></div><p>
    The current version of <span class="phrase">AppArmor</span> mediates file locking and introduces a
    new permission mode (<code class="literal">k</code>) for this. Applications
    requesting file locking permission might misbehave or fail altogether if
    confined by older profiles which do not explicitly contain permissions
    to lock files. If you suspect this being the case, check the log file
    under <code class="filename">/var/log/audit/audit.log</code> for entries like the
    following:
   </p><div class="verbatim-wrap"><pre class="screen">type=AVC msg=audit(1389862802.727:13939): apparmor="DENIED" \
operation="file_lock" parent=2692 profile="/usr/bin/opera" \
name="/home/tux/.qt/.qtrc.lock" pid=28730 comm="httpd2-prefork" \
requested_mask="::k" denied_mask="::k" fsuid=30 ouid=0</pre></div><p>
    Update the profile using the <code class="command">aa-logprof</code> command as
    outlined below.
   </p><p>
    The new network access control syntax based on the network family and
    type specification, described in
    <a class="xref" href="#sec-apparmor-profiles-nac" title="32.5. Network access control">Section 32.5, “Network access control”</a>, might cause application
    misbehavior or even stop applications from working. If you notice a
    network-related application behaving strangely, check the log file under
    <code class="filename">/var/log/audit/audit.log</code> for entries like the
    following:
   </p><div class="verbatim-wrap"><pre class="screen">type=AVC msg=audit(1389864332.233:13947): apparmor="DENIED" \
operation="socket_create" family="inet" parent=29985 profile="/bin/ping" \
sock_type="raw" pid=30251 comm="ping"</pre></div><p>
    This log entry means that our example application,
    <code class="command">/bin/ping</code> in this case, failed to get <span class="phrase">AppArmor</span>'s
    permission to open a network connection. This permission needs to be
    explicitly stated to make sure that an application has network access.
    To update the profile to the new syntax, use the
    <code class="command">aa-logprof</code> command as outlined below.
   </p><p>
    The current kernel requires the <code class="literal">SYS_PTRACE</code>
    capability, if a process tries to access files in
    <code class="filename">/proc/<em class="replaceable">PID</em>/fd/*</code>. New
    profiles need an entry for the file and the capability, where old
    profiles only needed the file entry. For example:
   </p><div class="verbatim-wrap"><pre class="screen">/proc/*/fd/**  rw,</pre></div><p>
    in the old syntax would translate to the following rules in the new
    syntax:
   </p><div class="verbatim-wrap"><pre class="screen">capability SYS_PTRACE,
/proc/*/fd/**  rw,</pre></div><p>
    To update the profile to the new syntax, use the YaST Update
    Profile Wizard or the <code class="command">aa-logprof</code> command as outlined
    below.
   </p><p>
    With this version of <span class="phrase">AppArmor</span>, a few changes have been made to the
    profile rule syntax to better distinguish directory from file access.
    Therefore, some rules matching both file and directory paths in the
    previous version might now match a file path only. This could lead to
    <span class="phrase">AppArmor</span> not being able to access a crucial directory, and thus
    trigger misbehavior of your application and various log messages. The
    following examples highlight the most important changes to the path
    syntax.
   </p><p>
    Using the old syntax, the following rule would allow access to files and
    directories in <code class="filename">/proc/net</code>. It would allow directory
    access only to read the entries in the directory, but not give access to
    files or directories under the directory, for example
    <code class="filename">/proc/net/dir/foo</code> would be matched by the asterisk
    (*), but as <code class="filename">foo</code> is a file or directory under
    <code class="filename">dir</code>, it cannot be accessed.
   </p><div class="verbatim-wrap"><pre class="screen">/proc/net/*  r,</pre></div><p>
    To get the same behavior using the new syntax, you need two rules
    instead of one. The first allows access to the file under
    <code class="filename">/proc/net</code> and the second allows access to
    directories under <code class="filename">/proc/net</code>. Directory access can
    only be used for listing the contents, not actually accessing files or
    directories underneath the directory.
   </p><div class="verbatim-wrap"><pre class="screen">/proc/net/*  r,
/proc/net/*/  r,</pre></div><p>
    The following rule works similarly both under the old and the new
    syntax, and allows access to both files and directories under
    <code class="filename">/proc/net</code> (but does not allow a directory listing
    of <code class="filename">/proc/net/</code> itself):
   </p><div class="verbatim-wrap"><pre class="screen">/proc/net/**  r,</pre></div><p>
    To distinguish file access from directory access using the above
    expression in the new syntax, use the following two rules. The first one
    only allows to recursively access directories under
    <code class="filename">/proc/net</code> while the second one explicitly allows
    for recursive file access only.
   </p><div class="verbatim-wrap"><pre class="screen">/proc/net/**/  r,
/proc/net/**[^/]  r,</pre></div><p>
    The following rule works similarly both under the old and the new syntax
    and allows access to both files and directories beginning with
    <code class="literal">foo</code> under <code class="filename">/proc/net</code>:
   </p><div class="verbatim-wrap"><pre class="screen">/proc/net/foo**  r,</pre></div><p>
    To distinguish file access from directory access in the new syntax and
    use the <code class="literal">**</code> globbing pattern, use the following two
    rules. The first one would have matched both files and directories in
    the old syntax, but only matches files in the new syntax because of the
    missing trailing slash. The second rule matched neither file nor
    directory in the old syntax, but matches directories only in the new
    syntax:
   </p><div class="verbatim-wrap"><pre class="screen">/proc/net/**foo  r,
/proc/net/**foo/  r,</pre></div><p>
    The following rules illustrate how the use of the <code class="literal">?</code>
    globbing pattern has changed. In the old syntax, the first rule would
    have matched both files and directories (four characters, last character
    could be any but a slash). In the new syntax, it matches only files
    (trailing slash is missing). The second rule would match nothing in the
    old profile syntax, but matches directories only in the new syntax. The
    last rule matches explicitly matches a file called
    <code class="filename">bar</code> under <code class="filename">/proc/net/foo?</code>.
    Using the old syntax, this rule would have applied to both files and
    directories:
   </p><div class="verbatim-wrap"><pre class="screen">/proc/net/foo?  r,
/proc/net/foo?/  r,
/proc/net/foo?/bar  r,</pre></div><p>
    To find and resolve issues related to syntax changes, take some time
    after the update to check the profiles you want to keep and proceed as
    follows for each application you kept the profile for:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Put the application's profile into complain mode:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aa-complain</code> <code class="option"><em class="replaceable">/path/to/application</em></code></pre></div><p>
      Log entries are made for any actions violating the current profile,
      but the profile is not enforced and the application's behavior not
      restricted.
     </p></li><li class="step"><p>
      Run the application covering all the tasks you need this application
      to be able to perform.
     </p></li><li class="step"><p>
      Update the profile according to the log entries made while running the
      application:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aa-logprof</code> <code class="option"><em class="replaceable">/path/to/application</em></code></pre></div></li><li class="step"><p>
      Put the resulting profile back into enforce mode:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aa-enforce</code> <code class="option"><em class="replaceable">/path/to/application</em></code></pre></div></li></ol></div></div></section><section class="sect2" id="sec-apparmor-support-trouble-apache" data-id-title="Resolving issues with Apache"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">39.4.3 </span><span class="title-name">Resolving issues with Apache</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-trouble-apache">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    After installing additional Apache modules (like
    <code class="literal">apache2-mod_apparmor</code>) or making configuration changes
    to Apache, profile Apache again to find out if additional rules need to
    be added to the profile. If you do not profile Apache again, it could be
    unable to start properly or be unable to serve Web pages.
   </p></section><section class="sect2" id="sec-apparmor-support-trouble-ex" data-id-title="How to exclude certain profiles from the list of profiles used?"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">39.4.4 </span><span class="title-name">How to exclude certain profiles from the list of profiles used?</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-trouble-ex">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Run <code class="command">aa-disable</code>
    <code class="option"><em class="replaceable">PROGRAMNAME</em></code> to disable the
    profile for <em class="replaceable">PROGRAMNAME</em>. This command creates
    a symbolic link to the profile in
    <code class="filename">/etc/apparmor.d/disable/</code>. To reactivate
    the profile, delete the link, and run <code class="command">systemctl reload
    apparmor</code>.
   </p></section><section class="sect2" id="sec-apparmor-support-trouble-remote" data-id-title="Can I manage profiles for applications not installed on my system?"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">39.4.5 </span><span class="title-name">Can I manage profiles for applications not installed on my system?</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-trouble-remote">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Managing profiles with <span class="phrase">AppArmor</span> requires you to have access to the log of
    the system on which the application is running. So you do not need to
    run the application on your profile build host as long as you have
    access to the machine that runs the application. You can run the
    application on one system, transfer the logs
    (<code class="filename">/var/log/audit.log</code> or, if
    <code class="filename">audit</code> is not installed, <code class="command">journalctl | grep
    -i apparmor &gt; path_to_logfile</code>) to your profile build host
    and run <code class="command">aa-logprof -f</code>
    <em class="replaceable">PATH_TO_LOGFILE</em>.
   </p></section><section class="sect2" id="sec-apparmor-support-trouble-syntax" data-id-title="How to spot and fix AppArmor syntax errors"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">39.4.6 </span><span class="title-name">How to spot and fix <span class="phrase">AppArmor</span> syntax errors</span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-trouble-syntax">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Manually editing <span class="phrase">AppArmor</span> profiles can introduce syntax errors. If you
    attempt to start or restart <span class="phrase">AppArmor</span> with syntax errors in your profiles,
    error results are shown. This example shows the syntax of the entire
    parser error.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code> systemctl start apparmor.service
Loading AppArmor profiles AppArmor parser error in /etc/apparmor.d/usr.sbin.squid \
 at line 410: syntax error, unexpected TOK_ID, expecting TOK_MODE
Profile /etc/apparmor.d/usr.sbin.squid failed to load</pre></div><p>
    Using the <span class="phrase">AppArmor</span> YaST tools, a graphical error message indicates
    which profile contained the error and requests you to fix it.
   </p><div class="informalfigure"><div class="mediaobject"><a href="images/aa_syncheck.png"><img src="images/aa_syncheck.png" width="60%" alt="error message with hint for correcting the error" title="error message with hint for correcting the error"/></a></div></div><p>
    To fix a syntax error, log in to a terminal window as <code class="systemitem">root</code>,
    open the profile, and correct the syntax. Reload the profile set with
    <code class="command">systemctl reload apparmor</code>.
   </p><div id="id-1.7.8.12.7.8.7" data-id-title="AppArmor syntax highlighting in vi" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: <span class="phrase">AppArmor</span> syntax highlighting in <code class="literal">vi</code></div><p>
     The editor <code class="literal">vi</code> on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> supports syntax
     highlighting for <span class="phrase">AppArmor</span> profiles. Lines containing syntax errors will
     be displayed with a red background.
    </p></div></section></section><section class="sect1" id="sec-apparmor-support-bugs" data-id-title="Reporting bugs for AppArmor"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">39.5 </span><span class="title-name">Reporting bugs for <span class="phrase">AppArmor</span></span></span> <a title="Permalink" class="permalink" href="#sec-apparmor-support-bugs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_support.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The developers of <span class="phrase">AppArmor</span> are eager to deliver products of the highest
   quality. Your feedback and your bug reports help us keep the quality
   high. Whenever you encounter a bug in <span class="phrase">AppArmor</span>, file a bug report against
   this product:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Use your Web browser to go to <a class="link" href="http://bugzilla.suse.com/" target="_blank">http://bugzilla.suse.com/</a> and click <span class="guimenu">Log
     In</span>.
    </p></li><li class="step"><p>
     Enter the account data of your SUSE account and click
     <span class="guimenu">Login</span>. If you do not have a SUSE account, click
     <span class="guimenu">Create Account</span> and provide the required data.
    </p></li><li class="step"><p>
     If your problem has already been reported, check this bug report and
     add extra information to it, if necessary.
    </p></li><li class="step"><p>
     If your problem has not been reported yet, select
     <span class="guimenu">New</span> from the top navigation bar and proceed to the
     <span class="guimenu">Enter Bug</span> page.
    </p></li><li class="step"><p>
     Select the product against which to file the bug. In your case, this
     would be your product's release. Click <span class="guimenu">Submit</span>.
    </p></li><li class="step"><p>
     Select the product version, component (<span class="phrase">AppArmor</span> in this case), hardware
     platform, and severity.
    </p></li><li class="step"><p>
     Enter a brief headline describing your problem and add a more elaborate
     description including log files. You may create attachments to your bug
     report for screenshots, log files, or test cases.
    </p></li><li class="step"><p>
     Click <span class="guimenu">Submit</span> after you have entered all the details
     to send your report to the developers.
    </p></li></ol></div></div></section></section><section class="chapter" id="cha-apparmor-glossary" data-id-title="AppArmor glossary"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">40 </span><span class="title-name"><span class="phrase">AppArmor</span> glossary</span></span> <a title="Permalink" class="permalink" href="#cha-apparmor-glossary">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_glossary.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.8.13.3.1"><span class="term">Abstraction</span></dt><dd><p>
     See <span class="emphasis"><em>profile foundation classes</em></span> below.
    </p></dd><dt id="id-1.7.8.13.3.2"><span class="term">Apache</span></dt><dd><p>
     Apache is a freely-available Unix-based Web server. It is currently the
     most commonly used Web server on the Internet. Find more information
     about Apache at the Apache Web site at
     <a class="link" href="http://www.apache.org" target="_blank">http://www.apache.org</a>.
    </p></dd><dt id="id-1.7.8.13.3.3"><span class="term">application fire-walling</span></dt><dd><p>
     <span class="phrase">AppArmor</span> confines applications and limits the actions they are permitted
     to take. It uses privilege confinement to prevent attackers from using
     malicious programs on the protected server and even using trusted
     applications in unintended ways.
    </p></dd><dt id="id-1.7.8.13.3.4"><span class="term">attack signature</span></dt><dd><p>
     Pattern in system or network activity that alerts of a possible virus
     or hacker attack. Intrusion detection systems might use attack
     signatures to distinguish between legitimate and potentially malicious
     activity.
    </p><p>
     By not relying on attack signatures, <span class="phrase">AppArmor</span> provides "proactive"
     instead of "reactive" defense from attacks. This is better because
     there is no window of vulnerability where the attack signature must be
     defined for <span class="phrase">AppArmor</span> as it does for products using attack signatures.
    </p></dd><dt id="id-1.7.8.13.3.5"><span class="term">GUI</span></dt><dd><p>
     Graphical user interface. Refers to a software front-end meant to
     provide an attractive and easy-to-use interface between a computer user
     and application. Its elements include windows, icons, buttons, cursors,
     and scrollbars.
    </p></dd><dt id="id-1.7.8.13.3.6"><span class="term">globbing</span></dt><dd><p>
     File name substitution. Instead of specifying explicit file name paths,
     you can use helper characters <code class="literal">*</code> (substitutes any
     number of characters except special ones such as <code class="literal">/</code>
     or <code class="literal">?</code>) and <code class="literal">?</code> (substitutes exactly
     one character) to address multiple files/directories at once.
     <code class="literal">**</code> is a special substitution that matches any file
     or directory below the current directory.
    </p></dd><dt id="id-1.7.8.13.3.7"><span class="term">HIP</span></dt><dd><p>
     Host intrusion prevention. Works with the operating system kernel to
     block abnormal application behavior in the expectation that the
     abnormal behavior represents an unknown attack. Blocks malicious
     packets on the host at the network level before they can
     <span class="quote">“<span class="quote">hurt</span>”</span> the application they target.
    </p></dd><dt id="id-1.7.8.13.3.8"><span class="term">mandatory access control</span></dt><dd><p>
     A means of restricting access to objects that is based on fixed
     security attributes assigned to users, files, and other objects. The
     controls are mandatory in the sense that they cannot be modified by
     users or their programs.
    </p></dd><dt id="id-1.7.8.13.3.9"><span class="term">profile</span></dt><dd><p>
     <span class="phrase">AppArmor</span> profile completely defines what system resources an individual
     application can access, and with what privileges.
    </p></dd><dt id="id-1.7.8.13.3.10"><span class="term">profile foundation classes</span></dt><dd><p>
     Profile building blocks needed for common application activities, such
     as DNS lookup and user authentication.
    </p></dd><dt id="id-1.7.8.13.3.11"><span class="term">RPM</span></dt><dd><p>
     The RPM Package Manager. An open packaging system available for anyone
     to use. It works on Red Hat Linux, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, and other Linux
     and Unix systems. It is capable of installing, uninstalling, verifying,
     querying, and updating computer software packages. See
     <a class="link" href="http://www.rpm.org/" target="_blank">http://www.rpm.org/</a> for more information.
    </p></dd><dt id="id-1.7.8.13.3.12"><span class="term">SSH</span></dt><dd><p>
     Secure Shell. A service that allows you to access your server from a
     remote computer and issue text commands through a secure connection.
    </p></dd><dt id="id-1.7.8.13.3.13"><span class="term">streamlined access control</span></dt><dd><p>
     <span class="phrase">AppArmor</span> provides streamlined access control for network services by
     specifying which files each program is allowed to read, write, and
     execute. This ensures that each program does what it is supposed to do
     and nothing else.
    </p></dd><dt id="id-1.7.8.13.3.14"><span class="term">URI</span></dt><dd><p>
     Universal resource identifier. The generic term for all types of names
     and addresses that refer to objects on the World Wide Web. A URL is one
     kind of URI.
    </p></dd><dt id="id-1.7.8.13.3.15"><span class="term">URL</span></dt><dd><p>
     Uniform Resource Locator. The global address of documents and other
     resources on the Web.
    </p><p>
     The first part of the address indicates what protocol to use and the
     second part specifies the IP address or the domain name where the
     resource is located.
    </p><p>
     For example, when you visit <span class="phrase"><code class="literal">http://www.suse.com</code></span>, you are
     using the HTTP protocol, as the beginning of the URL indicates.
    </p></dd><dt id="id-1.7.8.13.3.16"><span class="term">vulnerabilities</span></dt><dd><p>
     An aspect of a system or network that leaves it open to attack.
     Characteristics of computer systems that allow an individual to keep it
     from correctly operating or that allows unauthorized users to take
     control of the system. Design, administrative, or implementation
     weaknesses or flaws in hardware, firmware, or software. If exploited, a
     vulnerability could lead to an unacceptable impact in the form of
     unauthorized access to information or the disruption of critical
     processing.
    </p></dd></dl></div></section></div><div class="part" id="part-audit" data-id-title="The Linux Audit Framework"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">Part VI </span><span class="title-name">The Linux Audit Framework </span></span><a title="Permalink" class="permalink" href="#part-audit">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/book_security.xml" title="Edit source document"> </a></div></div></div></div></div><div class="toc"><ul><li><span class="chapter"><a href="#cha-audit-comp"><span class="title-number">41 </span><span class="title-name">Understanding Linux audit</span></a></span></li><dd class="toc-abstract"><p>
    The Linux audit framework as shipped with this version of
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> provides a CAPP-compliant (Controlled Access Protection
    Profiles) auditing system that reliably collects information about any
    security-relevant event. The audit records can be examined to determine
    whether any violation of the security policies has been committed, and
    by whom.
   </p><p>
    Providing an audit framework is an important requirement for a
    CC-CAPP/EAL (Common Criteria-Controlled Access Protection
    Profiles/Evaluation Assurance Level) certification. Common Criteria (CC)
    for Information Technology Security Information is an international
    standard for independent security evaluations. Common Criteria helps
    customers judge the security level of any IT product they intend to
    deploy in mission-critical setups.
   </p><p>
    Common Criteria security evaluations have two sets of evaluation
    requirements, functional and assurance requirements. Functional
    requirements describe the security attributes of the product under
    evaluation and are summarized under the Controlled Access Protection
    Profiles (CAPP). Assurance requirements are summarized under the
    Evaluation Assurance Level (EAL). EAL describes any activities that must
    take place for the evaluators to be confident that security attributes
    are present, effective, and implemented. Examples for activities of this
    kind include documenting the developers' search for security
    vulnerabilities, the patch process, and testing.
   </p><p>
    This guide provides a basic understanding of how audit works and how it
    can be set up. For more information about Common Criteria itself, refer
    to <a class="link" href="https://www.commoncriteriaportal.org/" target="_blank">the Common
    Criteria Web site</a>.
   </p></dd><li><span class="chapter"><a href="#cha-audit-setup"><span class="title-number">42 </span><span class="title-name">Setting up the Linux audit framework</span></a></span></li><dd class="toc-abstract"><p>
  This chapter shows how to set up a simple audit scenario. Every step
  involved in configuring and enabling audit is explained in detail. After
  you have learned to set up audit, consider a real-world example scenario
  in <a class="xref" href="#cha-audit-scenarios" title="Chapter 43. Introducing an audit rule set">Chapter 43, <em>Introducing an audit rule set</em></a>.
 </p></dd><li><span class="chapter"><a href="#cha-audit-scenarios"><span class="title-number">43 </span><span class="title-name">Introducing an audit rule set</span></a></span></li><dd class="toc-abstract"><p>
  The following example configuration illustrates how audit can be used to
  monitor your system. It highlights the most important items that need to
  be audited to cover the list of auditable events specified by Controlled
  Access Protection Profile (CAPP).
 </p></dd><li><span class="chapter"><a href="#cha-audit-moreinfo"><span class="title-number">44 </span><span class="title-name">Useful resources</span></a></span></li><dd class="toc-abstract"><p>
  There are other resources available containing valuable information about
  the Linux audit framework:
 </p></dd></ul></div><section class="chapter" id="cha-audit-comp" data-id-title="Understanding Linux audit"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">41 </span><span class="title-name">Understanding Linux audit</span></span> <a title="Permalink" class="permalink" href="#cha-audit-comp">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    The Linux audit framework as shipped with this version of
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> provides a CAPP-compliant (Controlled Access Protection
    Profiles) auditing system that reliably collects information about any
    security-relevant event. The audit records can be examined to determine
    whether any violation of the security policies has been committed, and
    by whom.
   </p><p>
    Providing an audit framework is an important requirement for a
    CC-CAPP/EAL (Common Criteria-Controlled Access Protection
    Profiles/Evaluation Assurance Level) certification. Common Criteria (CC)
    for Information Technology Security Information is an international
    standard for independent security evaluations. Common Criteria helps
    customers judge the security level of any IT product they intend to
    deploy in mission-critical setups.
   </p><p>
    Common Criteria security evaluations have two sets of evaluation
    requirements, functional and assurance requirements. Functional
    requirements describe the security attributes of the product under
    evaluation and are summarized under the Controlled Access Protection
    Profiles (CAPP). Assurance requirements are summarized under the
    Evaluation Assurance Level (EAL). EAL describes any activities that must
    take place for the evaluators to be confident that security attributes
    are present, effective, and implemented. Examples for activities of this
    kind include documenting the developers' search for security
    vulnerabilities, the patch process, and testing.
   </p><p>
    This guide provides a basic understanding of how audit works and how it
    can be set up. For more information about Common Criteria itself, refer
    to <a class="link" href="https://www.commoncriteriaportal.org/" target="_blank">the Common
    Criteria Web site</a>.
   </p></div></div></div></div><p>
  Linux audit helps make your system more secure by providing you with a
  means to analyze what is happening on your system in great detail. It does
  not, however, provide additional security itself—it does not
  protect your system from code malfunctions or any kind of exploits.
  Instead, audit is useful for tracking these issues and helps you take
  additional security measures, like <span class="phrase">AppArmor</span>, to prevent them.
 </p><p>
  Audit consists of several components, each contributing crucial
  functionality to the overall framework. The audit kernel module intercepts
  the system calls and records the relevant events. The
  <code class="systemitem">auditd</code> daemon writes the audit
  reports to disk. Various command line utilities take care of displaying,
  querying, and archiving the audit trail.
 </p><p>
  Audit enables you to do the following:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.3.6.1"><span class="term">Associate users with processes</span></dt><dd><p>
     Audit maps processes to the user ID that started them. This makes it
     possible for the administrator or security officer to exactly trace
     which user owns which process and is potentially doing malicious
     operations on the system.
    </p><div id="id-1.7.9.3.6.1.2.2" data-id-title="Renaming user IDs" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Renaming user IDs</div><p>
      Audit does not handle the renaming of UIDs. Therefore avoid renaming
      UIDs (for example, changing <code class="literal">tux</code> from
      <code class="literal">uid=1001</code> to <code class="literal">uid=2000</code>) and
      obsolete UIDs rather than renaming them. Otherwise you would need to
      change <code class="command">auditctl</code> data (audit rules) and would have
      problems retrieving old data correctly.
     </p></div></dd><dt id="id-1.7.9.3.6.2"><span class="term">Review the audit trail</span></dt><dd><p>
     Linux audit provides tools that write the audit reports to disk and
     translate them into human readable format.
    </p></dd><dt id="id-1.7.9.3.6.3"><span class="term">Review particular audit events</span></dt><dd><p>
     Audit provides a utility that allows you to filter the audit reports
     for certain events of interest. You can filter for:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       User
      </p></li><li class="listitem"><p>
       Group
      </p></li><li class="listitem"><p>
       Audit ID
      </p></li><li class="listitem"><p>
       Remote Host Name
      </p></li><li class="listitem"><p>
       Remote Host Address
      </p></li><li class="listitem"><p>
       System Call
      </p></li><li class="listitem"><p>
       System Call Arguments
      </p></li><li class="listitem"><p>
       File
      </p></li><li class="listitem"><p>
       File Operations
      </p></li><li class="listitem"><p>
       Success or Failure
      </p></li></ul></div></dd><dt id="id-1.7.9.3.6.4"><span class="term">Apply a selective audit</span></dt><dd><p>
     Audit provides the means to filter the audit reports for events of
     interest and to tune audit to record only selected events. You can
     create your own set of rules and have the audit daemon record only
     those of interest to you.
    </p></dd><dt id="id-1.7.9.3.6.5"><span class="term">Guarantee the availability of the report data</span></dt><dd><p>
     Audit reports are owned by <code class="systemitem">root</code> and therefore only removable
     by <code class="systemitem">root</code>. Unauthorized users cannot remove the audit logs.
    </p></dd><dt id="id-1.7.9.3.6.6"><span class="term">Prevent audit data loss</span></dt><dd><p>
     If the kernel runs out of memory, the audit daemon's backlog is
     exceeded, or its rate limit is exceeded, audit can trigger a shutdown
     of the system to keep events from escaping audit's control. This
     shutdown would be an immediate halt of the system triggered by the
     audit kernel component without synchronizing the latest logs to disk.
     The default configuration is to log a warning to syslog rather than to
     halt the system.
    </p><p>
     If the system runs out of disk space when logging, the audit system can
     be configured to perform clean shutdown. The default configuration
     tells the audit daemon to stop logging when it runs out of disk space.
    </p></dd></dl></div><section class="sect1" id="sec-audit-bigpicture" data-id-title="Introducing the components of Linux audit"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">41.1 </span><span class="title-name">Introducing the components of Linux audit</span></span> <a title="Permalink" class="permalink" href="#sec-audit-bigpicture">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.9.3.7.2" data-id-title="audispd merged into auditd" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: audispd merged into auditd</div><p>
    In SUSE Linux Enterprise Server 15 SP4 the code for
    <code class="systemitem">audispd</code> has
    been merged into <code class="systemitem">auditd</code>.
    All <code class="systemitem">audispd</code> configurations
    are now in <code class="filename">/etc/audit/auditd.conf</code> and
    <code class="filename">/etc/audit/plugins.d</code>.
   </p></div><p>
   The following figure illustrates how the various components of audit
   interact with each other:
  </p><div class="figure" id="fig-audit-components"><div class="figure-contents"><div class="mediaobject"><a href="images/audit_components.png"><img src="images/audit_components.png" width="75%" alt="Introducing the components of Linux audit" title="Introducing the components of Linux audit"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 41.1: </span><span class="title-name">Introducing the components of Linux audit </span></span><a title="Permalink" class="permalink" href="#fig-audit-components">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div><p>
   Straight arrows represent the data flow between components while dashed
   arrows represent lines of control between components.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.3.7.6.1"><span class="term">auditd</span></dt><dd><p>
      The audit daemon is responsible for writing the audit messages that
      were generated through the audit kernel interface and triggered by
      application and system activity to disk. The way the audit daemon is
      started is controlled by <code class="systemitem">systemd</code>. The audit system functions
      (when started) are controlled by
      <code class="filename">/etc/audit/auditd.conf</code>. For more information
      about <code class="systemitem">auditd</code> and its
      configuration, refer to <a class="xref" href="#sec-audit-auditd" title="41.2. Configuring the audit daemon">Section 41.2, “Configuring the audit daemon”</a>.
     </p></dd><dt id="id-1.7.9.3.7.6.2"><span class="term"><code class="command">auditctl</code>
    </span></dt><dd><p>
      The <code class="command">auditctl</code> utility controls the audit system. It
      controls the log generation parameters and kernel settings of the
      audit interface and the rule sets that determine which events
      are tracked. For more information about <code class="command">auditctl</code>,
      refer to <a class="xref" href="#sec-audit-auditctl" title="41.3. Controlling the audit system using auditctl">Section 41.3, “Controlling the audit system using <code class="command">auditctl</code>”</a>.
     </p></dd><dt id="id-1.7.9.3.7.6.3"><span class="term">audit rules</span></dt><dd><p>
      The file <code class="filename">/etc/audit/audit.rules</code> contains a
      sequence of <code class="command">auditctl</code> commands that are loaded at
      system boot time immediately after the audit daemon is started. For
      more information about audit rules, refer to
      <a class="xref" href="#sec-audit-rules" title="41.4. Passing parameters to the audit system">Section 41.4, “Passing parameters to the audit system”</a>.
     </p></dd><dt id="id-1.7.9.3.7.6.4"><span class="term">aureport</span></dt><dd><p>
      The <code class="command">aureport</code> utility allows you to create custom
      reports from the audit event log. This report generation can easily be
      scripted, and the output can be used by various other applications,
      for example, to plot these results. For more information about
      <code class="command">aureport</code>, refer to
      <a class="xref" href="#sec-audit-aureport" title="41.5. Understanding the audit logs and generating reports">Section 41.5, “Understanding the audit logs and generating reports”</a>.
     </p></dd><dt id="id-1.7.9.3.7.6.5"><span class="term">ausearch</span></dt><dd><p>
      The <code class="command">ausearch</code> utility can search the audit log file
      for certain events using various keys or other characteristics of the
      logged format. For more information about <code class="command">ausearch</code>,
      refer to <a class="xref" href="#sec-audit-ausearch" title="41.6. Querying the audit daemon logs with ausearch">Section 41.6, “Querying the audit daemon logs with <code class="command">ausearch</code>”</a>.
     </p></dd><dt id="id-1.7.9.3.7.6.6"><span class="term">autrace</span></dt><dd><p>
      The <code class="command">autrace</code> utility traces individual processes in
      a fashion similar to <code class="command">strace</code>. The output of
      <code class="command">autrace</code> is logged to the audit log. For more
      information about <code class="command">autrace</code>, refer to
      <a class="xref" href="#sec-audit-autrace" title="41.7. Analyzing processes with autrace">Section 41.7, “Analyzing processes with <code class="command">autrace</code>”</a>.
     </p></dd><dt id="id-1.7.9.3.7.6.7"><span class="term">aulast</span></dt><dd><p>
      Prints a list of the last logged-in users, similarly to
      <code class="command">last</code>. <code class="command">aulast</code> searches back
      through the audit logs (or the given audit log file) and displays a
      list of all users logged in and out based on the range of time in the
      audit logs.
     </p></dd><dt id="id-1.7.9.3.7.6.8"><span class="term">aulastlog</span></dt><dd><p>
      Prints the last login for all users of a machine similar to the way
      <code class="command">lastlog</code> does. The login name, port, and last login
      time will be printed.
     </p></dd></dl></div></section><section class="sect1" id="sec-audit-auditd" data-id-title="Configuring the audit daemon"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">41.2 </span><span class="title-name">Configuring the audit daemon</span></span> <a title="Permalink" class="permalink" href="#sec-audit-auditd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Before you can start generating audit logs and processing them,
   configure the audit daemon itself.


   The <code class="filename">/etc/audit/auditd.conf</code> configuration file
   determines how the audit system functions when the daemon has been
   started. For most use cases, the default settings shipped with
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> should suffice. For CAPP environments, most of these
   parameters need tweaking. The following example is the default
   configuration:
  </p><div class="example" id="id-1.7.9.3.8.3" data-id-title="Default /etc/audit/auditd.conf"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.1: </span><span class="title-name">Default /etc/audit/auditd.conf </span></span><a title="Permalink" class="permalink" href="#id-1.7.9.3.8.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">local_events = yes
write_logs = yes
log_file = /var/log/audit/audit.log
log_group = audit
log_format = RAW
flush = INCREMENTAL_ASYNC
freq = 50
max_log_file = 8
num_logs = 5
priority_boost = 4
name_format = NONE
##name = mydomain
max_log_file_action = ROTATE
space_left = 75
space_left_action = SYSLOG
verify_email = yes
action_mail_acct = root
admin_space_left = 50
admin_space_left_action = SUSPEND
disk_full_action = SUSPEND
disk_error_action = SUSPEND
use_libwrap = yes
##tcp_listen_port = 60
tcp_listen_queue = 5
tcp_max_per_addr = 1
##tcp_client_ports = 1024-65535
tcp_client_max_idle = 0
transport = TCP
distribute_network = no
q_depth = 1200
overflow_action = SYSLOG
max_restarts = 10
plugin_dir = /etc/audit/plugins.d
end_of_event_timeout = 2</pre></div></div></div><p>
   Refer to <code class="command">man 5 auditd.conf</code> for an explanation of these
   options.
  </p><p>
   Depending on whether you want your environment to satisfy the
   requirements of CAPP, you need to be extra restrictive when configuring
   the audit daemon. Where you need to use particular settings to meet the
   CAPP requirements, a <span class="quote">“<span class="quote">CAPP Environment</span>”</span> note tells you how
   to adjust the configuration.
  </p><p>
   When the daemon configuration in
   <code class="filename">/etc/audit/auditd.conf</code> is complete, the next step is
   to focus on controlling the amount of auditing the daemon does, and to
   assign sufficient resources and limits to the daemon so it can operate
   smoothly.
  </p></section><section class="sect1" id="sec-audit-auditctl" data-id-title="Controlling the audit system using auditctl"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">41.3 </span><span class="title-name">Controlling the audit system using <code class="command">auditctl</code></span></span> <a title="Permalink" class="permalink" href="#sec-audit-auditctl">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">auditctl</code> is responsible for controlling the status and
   some basic system parameters of the audit daemon. It controls the amount
   of auditing performed on the system. Using audit rules,
   <code class="command">auditctl</code> controls which components of your system are
   subjected to the audit and to what extent they are audited. Audit rules
   can be passed to the audit daemon on the <code class="command">auditctl</code>
   command line or by composing a rule set and instructing the audit
   daemon to process this file. By default, the
   <code class="systemitem">auditd</code> daemon is configured to
   check for audit rules under <code class="filename">/etc/audit/audit.rules</code>.
   For more details on audit rules, refer to
   <a class="xref" href="#sec-audit-rules" title="41.4. Passing parameters to the audit system">Section 41.4, “Passing parameters to the audit system”</a>.
  </p><p>
   The main <code class="command">auditctl</code> commands to control basic audit
   system parameters are:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="command">auditctl</code> <code class="option">-e</code> to enable or disable
     audit
    </p></li><li class="listitem"><p>
     <code class="command">auditctl</code> <code class="option">-f</code> to control the failure
     flag
    </p></li><li class="listitem"><p>
     <code class="command">auditctl</code> <code class="option">-r</code> to control the rate
     limit for audit messages
    </p></li><li class="listitem"><p>
     <code class="command">auditctl</code> <code class="option">-b</code> to control the backlog
     limit
    </p></li><li class="listitem"><p>
     <code class="command">auditctl</code> <code class="option">-s</code> to query the current
     status of the audit daemon
    </p></li><li class="listitem"><p>
      <code class="command">auditctl</code> <code class="option">-S</code> specifies which system
      call to audit. Before running <code class="command">auditctl -S</code> on your system,
      add <code class="option">-F arch=b64</code> to prevent the architecture mismatch
      warning.
     </p></li></ul></div><p>
   The <code class="option">-e</code>, <code class="option">-f</code>, <code class="option">-r</code>, and
   <code class="option">-b</code> options can also be specified in the
   <code class="filename">audit.rules</code> file to avoid having to enter them each
   time the audit daemon is started.
  </p><p>
   Any time you query the status of the audit daemon with
   <code class="command">auditctl</code> <code class="option">-s</code> or change the status flag
   with <code class="command">auditctl</code>
   <code class="option">-e<em class="replaceable">FLAG</em></code>, a status message
   (including information on each of the above-mentioned parameters) is
   printed. The following example highlights the typical audit status
   message.
  </p><div class="example" id="ex-auditctl-status" data-id-title="Example output of auditctl -s"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.2: </span><span class="title-name">Example output of <code class="command">auditctl</code> <code class="option">-s</code> </span></span><a title="Permalink" class="permalink" href="#ex-auditctl-status">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">enabled 1
failure 1
pid 790
rate_limit 0
backlog_limit 64
lost 0
backlog 0
backlog_wait_time 15000
loginuid_immutable 0 unlocked</pre></div></div></div><div class="table" id="tab-audit-auditctl" data-id-title="Audit status flags"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 41.1: </span><span class="title-name">Audit status flags </span></span><a title="Permalink" class="permalink" href="#tab-audit-auditctl">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Flag
       </p>
      </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Meaning [Possible Values]
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Command
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">enabled</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Set the enable flag. [0..2] 0=disable, 1=enable, 2=enable and lock
        down the configuration. Note that this only disables logging syscalls,
        and other events may still be logged. (See
        <code class="command">man 3 audit_set_enabled</code> in the
        <span class="package">audit-devel</span>.)
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">auditctl</code> <code class="option">-e [0|1|2]</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">flag</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Set the failure flag. [0..2] 0=silent, 1=printk, 2=panic (immediate
        halt without synchronizing pending data to disk)
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">auditctl</code> <code class="option">-f [0|1|2]</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">pid</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Process ID under which
        <code class="systemitem">auditd</code> is running.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        —
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">rate_limit</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Set a limit in messages per second. If the rate is not zero and is
        exceeded, the action specified in the failure flag is triggered.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">auditctl</code> <code class="option">-r
        <em class="replaceable">RATE</em></code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">backlog_limit</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Specify the maximum number of outstanding audit buffers allowed. If
        all buffers are full, the action specified in the failure flag is
        triggered.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="command">auditctl</code> <code class="option">-b
        <em class="replaceable">BACKLOG</em></code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">lost</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Count the current number of lost audit messages.
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        —
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        <code class="literal">backlog</code>
       </p>
      </td><td style="border-right: 1px solid ; ">
       <p>
        Count the current number of outstanding audit buffers.
       </p>
      </td><td>
       <p>
        —
       </p>
      </td></tr></tbody></table></div></div></section><section class="sect1" id="sec-audit-rules" data-id-title="Passing parameters to the audit system"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">41.4 </span><span class="title-name">Passing parameters to the audit system</span></span> <a title="Permalink" class="permalink" href="#sec-audit-rules">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Commands to control the audit system can be invoked individually from the
   shell using <code class="command">auditctl</code> or batch read from a file using
   <code class="command">auditctl -</code> <code class="option">R</code>. This latter method is
   used by the init scripts to load rules from the file
   <code class="filename">/etc/audit/audit.rules</code> after the audit daemon has
   been started. The rules are executed in order from top to bottom. Each of
   these rules would expand to a separate <code class="command">auditctl</code>
   command. The syntax used in the rules file is the same as that used for
   the <code class="command">auditctl</code> command.
  </p><p>
   Changes made to the running audit system by executing
   <code class="command">auditctl</code> on the command line are not persistent across
   system restarts. For changes to persist, add them to the
   <code class="filename">/etc/audit/audit.rules</code> file and, if they are not
   currently loaded into audit, restart the audit system to load the
   modified rule set by using the <code class="command">systemctl restart
   auditd</code> command.
  </p><div class="example" id="ex-audit-rules-sysparam" data-id-title="Example audit rules—audit system parameters"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.3: </span><span class="title-name">Example audit rules—audit system parameters </span></span><a title="Permalink" class="permalink" href="#ex-audit-rules-sysparam">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">-b 1000<span class="callout" id="co-aurules-b">1</span>
-f 1<span class="callout" id="co-aurules-f">2</span>
-r 10<span class="callout" id="co-aurules-r">3</span>
-e 1<span class="callout" id="co-aurules-e">4</span></pre></div></div></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-b"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Specify the maximum number of outstanding audit buffers. Depending on
     the level of logging activity, you might need to adjust the number of
     buffers to avoid causing too heavy an audit load on your system.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-f"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Specify the failure flag to use. See
     <a class="xref" href="#tab-audit-auditctl" title="Audit status flags">Table 41.1, “Audit status flags”</a> for possible values.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-r"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Specify the maximum number of messages per second that may be issued by
     the kernel. See <a class="xref" href="#tab-audit-auditctl" title="Audit status flags">Table 41.1, “Audit status flags”</a> for details.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-e"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Enable or disable the audit subsystem.
    </p></td></tr></table></div><p>
   Using audit, you can track any kind of file system access to important
   files, configurations or resources. You can add watches on these and
   assign keys to each kind of watch for better identification in the logs.
  </p><div class="example" id="ex-audit-rules-fs" data-id-title="Example audit rules—file system auditing"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.4: </span><span class="title-name">Example audit rules—file system auditing </span></span><a title="Permalink" class="permalink" href="#ex-audit-rules-fs">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">-w /etc/shadow<span class="callout" id="co-aurules-fs">1</span>
-w /etc -p rx<span class="callout" id="co-aurules-fsmode">2</span>
-w /etc/passwd -k fk_passwd -p rwxa<span class="callout" id="co-aurules-fskey">3</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-fs"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      The <code class="literal">-w</code> option tells audit to add a watch to the
      file specified, in this case <code class="filename">/etc/shadow</code>. All
      system calls requesting access permissions to this file are analyzed.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-fsmode"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      This rule adds a watch to the <code class="filename">/etc</code> directory and
      applies permission filtering for read and execute access to this
      directory (<code class="literal">-p rx</code>). Any system call requesting any
      of these two permissions is analyzed. Only the creation of new files
      and the deletion of existing ones are logged as directory-related
      events. To get more specific events for files located under this
      particular directory, you should add a separate rule for each file. A
      file must exist before you add a rule containing a watch on it.
      Auditing files as they are created is not supported.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-fskey"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      This rule adds a file watch to <code class="filename">/etc/passwd</code>.
      Permission filtering is applied for read, write, execute, and
      attribute change permissions. The <code class="literal">-k</code> option allows
      you to specify a key to use to filter the audit logs for this
      particular event later (for example with <code class="command">ausearch</code>).
      You may use the same key on different rules to be able to
      group rules when searching for them. It is also possible to apply
      multiple keys to a rule.
     </p></td></tr></table></div></div></div><p>
   System call auditing lets you track your system's behavior on a level
   even below the application level. When designing these rules, consider
   that auditing a great many system calls may increase your system load and
   cause you to run out of disk space. Consider carefully which events need
   tracking and how they can be filtered to be even more specific.
  </p><div class="example" id="ex-audit-rules-syscall" data-id-title="Example audit rules—system call auditing"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.5: </span><span class="title-name">Example audit rules—system call auditing </span></span><a title="Permalink" class="permalink" href="#ex-audit-rules-syscall">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">-a exit,always -S mkdir<span class="callout" id="co-aurules-scalladd">1</span>
-a exit,always -S access -F a1=4<span class="callout" id="co-aurules-scallfilter">2</span>
-a exit,always -S ipc -F a0=2<span class="callout" id="co-aurules-scallipc">3</span>
-a exit,always -S open -F success!=0<span class="callout" id="co-aurules-scalls">4</span>
-a task,always -F auid=0<span class="callout" id="co-aurules-scalltask">5</span>
-a task,always -F uid=0 -F auid=501 -F gid=wheel<span class="callout" id="co-aurules-scallsu">6</span></pre></div></div></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-scalladd"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This rule activates auditing for the <code class="systemitem">mkdir</code>
     system call. The <code class="literal">-a</code> option adds system call rules.
     This rule triggers an event whenever the <code class="systemitem">mkdir</code>
     system call is entered (<code class="literal">exit</code>,
     <code class="literal">always</code>). The <code class="literal">-S</code> option specifies
     the system call to which this rule should be applied.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-scallfilter"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This rule adds auditing to the access system call, but only if the
     second argument of the system call (<code class="literal">mode</code>) is
     <code class="literal">4</code> (<code class="literal">R_OK</code>).
     <code class="literal">exit,always</code> tells audit to add an audit context to
     this system call when entering it, and to write out a report when
     it gets audited.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-scallipc"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This rule adds an audit context to the IPC multiplexed system call. The
     specific <code class="literal">ipc</code> system call is passed as the first
     syscall argument and can be selected using <code class="option">-F
     a0=<em class="replaceable">IPC_CALL_NUMBER</em></code>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-scalls"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This rule audits failed attempts to call open.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-scalltask"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This rule is an example of a task rule (keyword:
     <code class="literal">task</code>). It is different from the other rules above in
     that it applies to processes that are forked or cloned. To filter these
     kind of events, you can only use fields that are known at fork time,
     such as UID, GID, and AUID. This example rule filters for all tasks
     carrying an audit ID of <code class="literal">0</code>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-scallsu"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This last rule makes heavy use of filters. All filter options are
     combined with a logical AND operator, meaning that this rule applies to
     all tasks that carry the audit ID of <code class="literal">501</code>, run as
     <code class="systemitem">root</code>, and have <code class="literal">wheel</code> as the group. A
     process is given an audit ID on user login. This ID is then handed down
     to any child process started by the initial process of the user. Even
     if the user changes their identity, the audit ID stays the same and
     allows tracing actions to the original user.
    </p></td></tr></table></div><div id="id-1.7.9.3.10.11" data-id-title="Filtering system call arguments" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Filtering system call arguments</div><p>
    For more details on filtering system call arguments, refer to
    <a class="xref" href="#sec-audit-scenipc" title="43.6. Filtering system call arguments">Section 43.6, “Filtering system call arguments”</a>.
   </p></div><p>
   You cannot only add rules to the audit system, but also remove them.
   There are different methods for deleting the entire rule set at once or
   for deleting system call rules or file and directory watches:
  </p><div class="example" id="ex-audit-ruledel" data-id-title="Deleting audit rules and events"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.6: </span><span class="title-name">Deleting audit rules and events </span></span><a title="Permalink" class="permalink" href="#ex-audit-ruledel">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">-D<span class="callout" id="co-aurules-d">1</span>
-d exit,always -S mkdir<span class="callout" id="co-aurules-scalldel">2</span>
-W /etc<span class="callout" id="co-aurules-fsdel">3</span></pre></div></div></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-d"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Clear the queue of audit rules and delete any preexisting rules. This
     rule is used as the first rule in
     <code class="filename">/etc/audit/audit.rules</code> files to make sure that the
     rules that are about to be added do not clash with any preexisting
     ones. The <code class="command">auditctl</code> <code class="option">-D</code> command is
     also used before doing an <code class="command">autrace</code> to avoid having
     the trace rules clash with any rules present in the
     <code class="filename">audit.rules</code> file.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-scalldel"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This rule deletes a system call rule. The <code class="literal">-d</code> option
     must precede any system call rule that needs to be deleted from the
     rule queue, and must match exactly.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-aurules-fsdel"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     This rule tells audit to discard the rule with the directory watch on
     <code class="filename">/etc</code> from the rules queue. This rule deletes any
     rule containing a directory watch on <code class="filename">/etc</code>,
     regardless of any permission filtering or key options.
    </p></td></tr></table></div><p>
   To get an overview of which rules are currently in use in your audit
   setup, run <code class="command">auditctl</code> <code class="option">-l</code>. This command
   displays all rules with one rule per line.
  </p><div class="example" id="id-1.7.9.3.10.16" data-id-title="Listing rules with auditctl -l"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.7: </span><span class="title-name">Listing rules with <code class="command">auditctl</code> <code class="option">-l</code> </span></span><a title="Permalink" class="permalink" href="#id-1.7.9.3.10.16">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">exit,always watch=/etc perm=rx
exit,always watch=/etc/passwd perm=rwxa key=fk_passwd
exit,always watch=/etc/shadow perm=rwxa
exit,always syscall=mkdir
exit,always a1=4 (0x4) syscall=access
exit,always a0=2 (0x2) syscall=ipc
exit,always success!=0 syscall=open</pre></div></div></div><div id="id-1.7.9.3.10.17" data-id-title="Creating filter rules" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Creating filter rules</div><p>
    You can build very sophisticated audit rules by using the various filter
    options. Refer to the <code class="command">auditctl(8)</code> man page for more
    information about the options available for building audit filter rules,
    and audit rules in general.
   </p></div></section><section class="sect1" id="sec-audit-aureport" data-id-title="Understanding the audit logs and generating reports"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">41.5 </span><span class="title-name">Understanding the audit logs and generating reports</span></span> <a title="Permalink" class="permalink" href="#sec-audit-aureport">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To understand what the <code class="command">aureport</code> utility does, it is
   vital to know how the logs generated by the audit daemon are structured,
   and what exactly is recorded for an event. Only then can you decide which
   report types are most appropriate for your needs.
  </p><section class="sect2" id="sec-audit-aureport-ustand" data-id-title="Understanding the audit logs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">41.5.1 </span><span class="title-name">Understanding the audit logs</span></span> <a title="Permalink" class="permalink" href="#sec-audit-aureport-ustand">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following examples highlight two typical events that are logged by
    audit and how their trails in the audit log are read. The audit log or
    logs (if log rotation is enabled) are stored in the
    <code class="filename">/var/log/audit</code> directory.
   </p><p>
     The logs record two types of information: record types and event
     fields. The record types are identified by <code class="literal">type=</code> in
     each log entry. Event fields are all other items on the left side of
     the equals signs. In the following examples,
     <code class="literal">type=SYSCALL</code> and <code class="literal">type=CWD</code>are
     record types, and <code class="literal">arch=c000003e</code> and
     <code class="literal">syscall=2</code> are event fields, followed by their values.
   </p><p>
     Refer to the <code class="filename">/usr/include/libaudit.h</code> file (from the
     <span class="package">audit-devel</span> package) to see
     a complete list of record types and their definitions.
   </p><p>
     Run the <code class="command">ausyscall --dump</code> command to see a table of
     syscall numbers, and what they represent:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>ausyscall --dump
Using x86_64 syscall table:
0       read
1       write
2       open
3       close
4       stat
5       fstat
[...]</pre></div><p>
    The first example is a simple <code class="command">less</code> command. The second
    example covers a great deal of PAM activity in the logs when a user tries
    to remotely log in to a machine running audit.
   </p><div class="example" id="ex-audit-aureport-logtrail" data-id-title="A simple audit event—viewing the audit log"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.8: </span><span class="title-name">A simple audit event—viewing the audit log </span></span><a title="Permalink" class="permalink" href="#ex-audit-aureport-logtrail">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">type=SYSCALL msg=audit(1234874638.599:5207): arch=c000003e syscall=2
success=yes exit=4 a0=62fb60 a1=0 a2=31 a3=0 items=1 ppid=25400 pid
=25616 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0
tty=pts1 ses=1164 comm="less" exe="/usr/bin/less" key="doc_log"
type=CWD msg=audit(1234874638.599:5207):  cwd="/root"
type=PATH msg=audit(1234874638.599:5207): item=0 name="/var/log/audit/
audit.log" inode=1219041 dev=08:06 mode=0100644 ouid=0 ogid=0 rdev=00:00</pre></div></div></div><p>
    The above event, a simple <code class="command">less
    /var/log/audit/audit.log</code>, wrote three messages to the log. All
    of them are closely linked together and you would not be able to make
    sense of one of them without the others. The first message reveals the
    following information:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.3.11.3.10.1"><span class="term"><code class="literal">type</code>
     </span></dt><dd><p>
       The type of event recorded. In this case, it assigns the
       <code class="literal">SYSCALL</code> type to an event triggered by a system
       call. The <code class="literal">CWD</code> event was recorded to record the
       current working directory at the time of the syscall. A
       <code class="literal">PATH</code> event is generated for each path passed to
       the system call. The open system call takes only one path argument,
       so only generates one <code class="literal">PATH</code> event. It is important
       to understand that the <code class="literal">PATH</code> event reports the path
       name string argument without any further interpretation, so a
       relative path requires manual combination with the path reported by
       the <code class="literal">CWD</code> event to determine the object accessed.
      </p></dd><dt id="id-1.7.9.3.11.3.10.2"><span class="term"><code class="literal">msg</code>
     </span></dt><dd><p>
       A message ID enclosed in brackets. The ID splits into two parts. All
       characters before the <code class="literal">:</code> represent a Unix epoch
       time stamp. The number after the colon represents the actual event
       ID. All events that are logged from one application's system call
       have the same event ID. If the application makes a second system
       call, it gets another event ID.
      </p></dd><dt id="id-1.7.9.3.11.3.10.3"><span class="term"><code class="literal">arch</code>
     </span></dt><dd><p>
       References the CPU architecture of the system call. Decode this
       information using the <code class="option">-i</code> option on any of your
       <code class="command">ausearch</code> commands when searching the logs.
      </p></dd><dt id="id-1.7.9.3.11.3.10.4"><span class="term"><code class="literal">syscall</code>
     </span></dt><dd><p>
       The type of system call as it would have been printed by an <code class="command">strace</code> on
       this particular system call. This data is taken from the list of
       system calls under <code class="filename">/usr/include/asm/unistd.h</code> and
       may vary depending on the architecture. In this case,
       <code class="literal">syscall=2</code> refers to the open system call (see
       <code class="command">man open(2)</code>) invoked by the less application.
      </p></dd><dt id="id-1.7.9.3.11.3.10.5"><span class="term"><code class="literal">success</code>
     </span></dt><dd><p>
       Whether the system call succeeded or failed.
      </p></dd><dt id="id-1.7.9.3.11.3.10.6"><span class="term"><code class="literal">exit</code>
     </span></dt><dd><p>
       The exit value returned by the system call. For the
       <code class="command">open</code> system call used in this example, this is the
       file descriptor number. This varies by system call.
      </p></dd><dt id="id-1.7.9.3.11.3.10.7"><span class="term"><code class="literal">a0</code> to <code class="literal">a3</code>
     </span></dt><dd><p>
       The first four arguments to the system call in numeric form. The
       values of these are system call dependent. In this example (an
       <code class="command">open</code> system call), the following are used:
      </p><div class="verbatim-wrap"><pre class="screen">a0=62fb60 a1=8000 a2=31 a3=0</pre></div><p>
       <code class="literal">a0</code> is the start address of the passed path name.
       <code class="literal">a1</code> is the flags. <code class="literal">8000</code> in hex
       notation translates to <code class="literal">100000</code> in octal notation,
       which in turn translates to <code class="literal">O_LARGEFILE</code>.
       <code class="literal">a2</code> is the mode, which, because
       <code class="literal">O_CREAT</code> was not specified, is unused.
       
       <code class="literal">a3</code> is not passed by the <code class="command">open</code>
       system call. Check the manual page of the relevant system call to
       find out which arguments are used with it.
      </p></dd><dt id="id-1.7.9.3.11.3.10.8"><span class="term"><code class="literal">items</code>
     </span></dt><dd><p>
       The number of strings passed to the application.
      </p></dd><dt id="id-1.7.9.3.11.3.10.9"><span class="term"><code class="literal">ppid</code>
     </span></dt><dd><p>
       The process ID of the parent of the process analyzed.
      </p></dd><dt id="id-1.7.9.3.11.3.10.10"><span class="term"><code class="literal">pid</code>
     </span></dt><dd><p>
       The process ID of the process analyzed.
      </p></dd><dt id="id-1.7.9.3.11.3.10.11"><span class="term"><code class="literal">auid</code>
     </span></dt><dd><p>
       The audit ID. A process is given an audit ID on user login. This ID
       is then handed down to any child process started by the initial
       process of the user. Even if the user changes their identity (for
       example, becomes <code class="systemitem">root</code>), the audit ID stays the same. Thus
       you can always trace actions to the original user who logged in.
      </p></dd><dt id="id-1.7.9.3.11.3.10.12"><span class="term"><code class="literal">uid</code>
     </span></dt><dd><p>
       The user ID of the user who started the process. In this case,
       <code class="literal">0</code> for <code class="systemitem">root</code>.
      </p></dd><dt id="id-1.7.9.3.11.3.10.13"><span class="term"><code class="literal">gid</code>
     </span></dt><dd><p>
       The group ID of the user who started the process. In this case,
       <code class="literal">0</code> for <code class="systemitem">root</code>.
      </p></dd><dt id="id-1.7.9.3.11.3.10.14"><span class="term"><code class="literal">euid</code>, <code class="literal">suid</code>, <code class="literal">fsuid</code>
     </span></dt><dd><p>
       Effective user ID, set user ID, and file system user ID of the user
       that started the process.
      </p></dd><dt id="id-1.7.9.3.11.3.10.15"><span class="term"><code class="literal">egid</code>, <code class="literal">sgid</code>, <code class="literal">fsgid</code>
     </span></dt><dd><p>
       Effective group ID, set group ID, and file system group ID of the
       user that started the process.
      </p></dd><dt id="id-1.7.9.3.11.3.10.16"><span class="term"><code class="literal">tty</code>
     </span></dt><dd><p>
       The terminal from which the application was started. In this case, a
       pseudo-terminal used in an SSH session.
      </p></dd><dt id="id-1.7.9.3.11.3.10.17"><span class="term"><code class="literal">ses</code>
     </span></dt><dd><p>
       The login session ID. This process attribute is set when a user logs
       in and can tie any process to a particular user login.
      </p></dd><dt id="id-1.7.9.3.11.3.10.18"><span class="term"><code class="literal">comm</code>
     </span></dt><dd><p>
       The application name under which it appears in the task list.
      </p></dd><dt id="id-1.7.9.3.11.3.10.19"><span class="term"><code class="literal">exe</code>
     </span></dt><dd><p>
       The resolved path name to the binary program.
      </p></dd><dt id="id-1.7.9.3.11.3.10.20"><span class="term"><code class="literal">subj</code>
     </span></dt><dd><p>
       <code class="systemitem">auditd</code> records whether the
       process is subject to any security context, such as <span class="phrase">AppArmor</span>.
       <code class="literal">unconstrained</code>, as in this case, means that the
       process is not confined with <span class="phrase">AppArmor</span>. If the process had been
       confined, the binary path name plus the <span class="phrase">AppArmor</span> profile mode would
       have been logged.
      </p></dd><dt id="id-1.7.9.3.11.3.10.21"><span class="term"><code class="literal">key</code>
     </span></dt><dd><p>
       If you are auditing many directories or files, assign
       key strings to each of these watches. You can use these keys with
       <code class="command">ausearch</code> to search the logs for events of this
       type only.
      </p></dd></dl></div><p>
    The second message triggered by the example <code class="command">less</code> call
    does not reveal anything apart from the current working directory when
    the <code class="command">less</code> command was executed.
   </p><p>
    The third message reveals the following (the <code class="literal">type</code> and
    <code class="literal">message</code> flags have already been introduced):
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.3.11.3.13.1"><span class="term"><code class="literal">item</code>
     </span></dt><dd><p>
       In this example, <code class="literal">item</code> references the
       <code class="literal">a0</code> argument—a path—that is
       associated with the original <code class="literal">SYSCALL</code> message. Had
       the original call had more than one path argument (such as a
       <code class="command">cp</code> or <code class="command">mv</code> command), an
       additional <code class="literal">PATH</code> event would have been logged for
       the second path argument.
      </p></dd><dt id="id-1.7.9.3.11.3.13.2"><span class="term"><code class="literal">name</code>
     </span></dt><dd><p>
       Refers to the path name passed as an argument to the open system
       call.
      </p></dd><dt id="id-1.7.9.3.11.3.13.3"><span class="term"><code class="literal">inode</code>
     </span></dt><dd><p>
       Refers to the inode number corresponding to <code class="literal">name</code>.
      </p></dd><dt id="id-1.7.9.3.11.3.13.4"><span class="term"><code class="literal">dev</code>
     </span></dt><dd><p>
       Specifies the device on which the file is stored. In this case,
       <code class="literal">08:06</code>, which stands for
       <code class="literal">/dev/sda1</code> or <span class="quote">“<span class="quote">first partition on the first
       IDE device.</span>”</span>
      </p></dd><dt id="id-1.7.9.3.11.3.13.5"><span class="term"><code class="literal">mode</code>
     </span></dt><dd><p>
       Numerical representation of the file's access permissions. In this
       case, <code class="systemitem">root</code> has read and write permissions and their group
       (<code class="systemitem">root</code>) has read access while the entire rest of the world
       cannot access the file.
      </p></dd><dt id="id-1.7.9.3.11.3.13.6"><span class="term"><code class="literal">ouid</code> and <code class="literal">ogid</code>
     </span></dt><dd><p>
       Refer to the UID and GID of the inode itself.
      </p></dd><dt id="id-1.7.9.3.11.3.13.7"><span class="term"><code class="literal">rdev</code>
     </span></dt><dd><p>
       Not applicable for this example. The <code class="literal">rdev</code> entry
       only applies to block or character devices, not to files.
      </p></dd></dl></div><p>
    <a class="xref" href="#ex-audit-aureport-sshd" title="An advanced audit event—login via SSH">Example 41.9, “An advanced audit event—login via SSH”</a> highlights the audit events
    triggered by an incoming SSH connection. Most of the messages are
    related to the PAM stack and reflect the different stages of the SSH PAM
    process. Several of the audit messages carry nested PAM messages in them
    that signify that a particular stage of the PAM process has been
    reached. Although the PAM messages are logged by audit, audit assigns
    its own message type to each event:
   </p><div class="example" id="ex-audit-aureport-sshd" data-id-title="An advanced audit event—login via SSH"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.9: </span><span class="title-name">An advanced audit event—login via SSH </span></span><a title="Permalink" class="permalink" href="#ex-audit-aureport-sshd">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">type=USER_AUTH msg=audit(1234877011.791:7731): user pid=26127 uid=0 <span class="callout" id="co-audit-sshd-auth">1</span>
auid=4294967295 ses=4294967295 msg='op=PAM:authentication acct="root" exe="/usr/sbin/sshd"
(hostname=jupiter.example.com, addr=192.168.2.100, terminal=ssh res=success)'
type=USER_ACCT msg=audit(1234877011.795:7732): user pid=26127 uid=0 <span class="callout" id="co-audit-sshd-acct">2</span>
auid=4294967295 ses=4294967295 msg='op=PAM:accounting acct="root" exe="/usr/sbin/sshd"
(hostname=jupiter.example.com, addr=192.168.2.100, terminal=ssh res=success)'
type=CRED_ACQ msg=audit(1234877011.799:7733): user pid=26125 uid=0 <span class="callout" id="co-audit-sshd-acq">3</span>
auid=4294967295 ses=4294967295 msg='op=PAM:setcred acct="root" exe="/usr/sbin/sshd"
(hostname=jupiter.example.com, addr=192.168.2.100, terminal=/dev/pts/0 res=success)'
type=LOGIN msg=audit(1234877011.799:7734): login pid=26125 uid=0
old auid=4294967295 new auid=0 old ses=4294967295 new ses=1172
type=USER_START msg=audit(1234877011.799:7735): user pid=26125 uid=0 <span class="callout" id="co-audit-sshd-start">4</span>
auid=0 ses=1172 msg='op=PAM:session_open acct="root" exe="/usr/sbin/sshd"
(hostname=jupiter.example.com, addr=192.168.2.100, terminal=/dev/pts/0 res=success)'
type=USER_LOGIN msg=audit(1234877011.823:7736): user pid=26128 uid=0 <span class="callout" id="co-audit-sshd-login">5</span>
auid=0 ses=1172 msg='uid=0: exe="/usr/sbin/sshd"
(hostname=jupiter.example.com, addr=192.168.2.100, terminal=/dev/pts/0 res=success)'
type=CRED_REFR msg=audit(1234877011.828:7737): user pid=26128 uid=0 <span class="callout" id="co-audit-sshd-refr">6</span>
auid=0 ses=1172 msg='op=PAM:setcred acct="root" exe="/usr/sbin/sshd"
(hostname=jupiter.example.com, addr=192.168.2.100, terminal=/dev/pts/0 res=success)'</pre></div></div></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-sshd-auth"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      PAM reports that is has successfully requested user authentication for
      <code class="systemitem">root</code> from a remote host (jupiter.example.com, 192.168.2.100). The
      terminal where this is happening is <code class="literal">ssh</code>.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-sshd-acct"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      PAM reports that it has successfully determined whether the user is
      authorized to log in.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-sshd-acq"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      PAM reports that the appropriate credentials to log in have been
      acquired and that the terminal changed to a normal terminal
      (<code class="literal">/dev/pts0</code>).
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-sshd-start"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      PAM reports that it has successfully opened a session for
      <code class="systemitem">root</code>.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-sshd-login"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      The user has successfully logged in. This event is the one used by
      <code class="command">aureport</code> <code class="option">-l</code> to report about user
      logins.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-sshd-refr"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      PAM reports that the credentials have been successfully reacquired.
     </p></td></tr></table></div></section><section class="sect2" id="sec-audit-aureport-gen" data-id-title="Generating custom audit reports"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">41.5.2 </span><span class="title-name">Generating custom audit reports</span></span> <a title="Permalink" class="permalink" href="#sec-audit-aureport-gen">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The raw audit reports stored in the <code class="filename">/var/log/audit</code>
    directory tend to become very bulky and hard to understand. To more
    easily find relevant messages, use the <code class="command">aureport</code>
    utility and create custom reports.
   </p><p>
    The following use cases highlight a few of the possible report types
    that you can generate with <code class="command">aureport</code>:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.3.11.4.4.1"><span class="term">Read audit logs from another file</span></dt><dd><p>
       When the audit logs have moved to another machine or when you want to
       analyze the logs of several machines on your local machine
       without wanting to connect to each of these individually, move the
       logs to a local file and have <code class="command">aureport</code> analyze
       them locally:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport -if myfile</code>

Summary Report
======================
Range of time in logs: 03/02/09 14:13:38.225 - 17/02/09 14:52:27.971
Selected time for report: 03/02/09 14:13:38 - 17/02/09 14:52:27.971
Number of changes in configuration: 13
Number of changes to accounts, groups, or roles: 0
Number of logins: 6
Number of failed logins: 13
Number of authentications: 7
Number of failed authentications: 573
Number of users: 1
Number of terminals: 9
Number of host names: 4
Number of executables: 17
Number of files: 279
Number of AVC's: 0
Number of MAC events: 0
Number of failed syscalls: 994
Number of anomaly events: 0
Number of responses to anomaly events: 0
Number of crypto events: 0
Number of keys: 2
Number of process IDs: 1211
Number of events: 5320</pre></div><p>
       The above command, <code class="command">aureport</code> without any arguments,
       provides only the standard general summary report generated from the
       logs contained in <code class="filename">myfile</code>. To create more
       detailed reports, combine the <code class="option">-if</code> option with any of
       the options below. For example, generate a login report that is
       limited to a certain time frame:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport -l -ts 14:00 -te 15:00 -if myfile</code>

Login Report
============================================
# date time auid host term exe success event
============================================
1. 17/02/09 14:21:09 root: 192.168.2.100 sshd /usr/sbin/sshd no 7718
2. 17/02/09 14:21:15 0 jupiter /dev/pts/3 /usr/sbin/sshd yes 7724</pre></div></dd><dt id="id-1.7.9.3.11.4.4.2"><span class="term">Convert numeric entities to text</span></dt><dd><p>
       Some information, such as user IDs, are printed in numeric form. To
       convert these into a human-readable text format, add the
       <code class="option">-i</code> option to your <code class="command">aureport</code>
       command.
      </p></dd><dt id="id-1.7.9.3.11.4.4.3"><span class="term">Create a rough summary report</span></dt><dd><p>
       If you are interested in the current audit statistics (events,
       logins, processes, etc.), run <code class="command">aureport</code> without any
       other option.
      </p></dd><dt id="id-1.7.9.3.11.4.4.4"><span class="term">Create a summary report of failed events</span></dt><dd><p>
       If you want to break down the overall statistics of plain
       <code class="command">aureport</code> to the statistics of failed events, use
       <code class="command">aureport</code> <code class="option">--failed</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport --failed</code>

Failed Summary Report
======================
Range of time in logs: 03/02/09 14:13:38.225 - 17/02/09 14:57:35.183
Selected time for report: 03/02/09 14:13:38 - 17/02/09 14:57:35.183
Number of changes in configuration: 0
Number of changes to accounts, groups, or roles: 0
Number of logins: 0
Number of failed logins: 13
Number of authentications: 0
Number of failed authentications: 574
Number of users: 1
Number of terminals: 5
Number of host names: 4
Number of executables: 11
Number of files: 77
Number of AVC's: 0
Number of MAC events: 0
Number of failed syscalls: 994
Number of anomaly events: 0
Number of responses to anomaly events: 0
Number of crypto events: 0
Number of keys: 2
Number of process IDs: 708
Number of events: 1583</pre></div></dd><dt id="id-1.7.9.3.11.4.4.5"><span class="term">Create a summary report of successful events</span></dt><dd><p>
       If you want to break down the overall statistics of a plain
       <code class="command">aureport</code> to the statistics of successful events,
       use <code class="command">aureport</code> <code class="option">--success</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport --success</code>

Success Summary Report
======================
Range of time in logs: 03/02/09 14:13:38.225 - 17/02/09 15:00:01.535
Selected time for report: 03/02/09 14:13:38 - 17/02/09 15:00:01.535
Number of changes in configuration: 13
Number of changes to accounts, groups, or roles: 0
Number of logins: 6
Number of failed logins: 0
Number of authentications: 7
Number of failed authentications: 0
Number of users: 1
Number of terminals: 7
Number of host names: 3
Number of executables: 16
Number of files: 215
Number of AVC's: 0
Number of MAC events: 0
Number of failed syscalls: 0
Number of anomaly events: 0
Number of responses to anomaly events: 0
Number of crypto events: 0
Number of keys: 2
Number of process IDs: 558
Number of events: 3739</pre></div></dd><dt id="id-1.7.9.3.11.4.4.6"><span class="term">Create summary reports</span></dt><dd><p>
       In addition to the dedicated summary reports (main summary and failed
       and success summary), use the <code class="option">--summary</code> option with
       most of the other options to create summary reports for a particular
       area of interest only. Not all reports support this option, however.
       This example creates a summary report for user login events:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport -u -i --summary</code>

User Summary Report
===========================
total  auid
===========================
5640  root
13  tux
3  wilber</pre></div></dd><dt id="id-1.7.9.3.11.4.4.7"><span class="term">Create a report of events</span></dt><dd><p>
       To get an overview of the events logged by audit, use the
       <code class="command">aureport</code> <code class="option">-e</code> command. This command
       generates a numbered list of all events including date, time, event
       number, event type, and audit ID.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aureport -e -ts 14:00 -te 14:21

Event Report
===================================
# date time event type auid success
===================================
1. 17/02/09 14:20:27 7462 DAEMON_START 0 yes
2. 17/02/09 14:20:27 7715 CONFIG_CHANGE 0 yes
3. 17/02/09 14:20:57 7716 USER_END 0 yes
4. 17/02/09 14:20:57 7717 CRED_DISP 0 yes
5. 17/02/09 14:21:09 7718 USER_LOGIN -1 no
6. 17/02/09 14:21:15 7719 USER_AUTH -1 yes
7. 17/02/09 14:21:15 7720 USER_ACCT -1 yes
8. 17/02/09 14:21:15 7721 CRED_ACQ -1 yes
9. 17/02/09 14:21:15 7722 LOGIN 0 yes
10. 17/02/09 14:21:15 7723 USER_START 0 yes
11. 17/02/09 14:21:15 7724 USER_LOGIN 0 yes
12. 17/02/09 14:21:15 7725 CRED_REFR 0 yes</pre></div></dd><dt id="id-1.7.9.3.11.4.4.8"><span class="term">Create a report from all process events</span></dt><dd><p>
       To analyze the log from a process's point of view, use the
       <code class="command">aureport</code> <code class="option">-p</code> command. This command
       generates a numbered list of all process events including date, time,
       process ID, name of the executable, system call, audit ID, and event
       number.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="command">aureport -p</code>

Process ID Report
======================================
# date time pid exe syscall auid event
======================================
1. 13/02/09 15:30:01 32742 /usr/sbin/cron 0 0 35
2. 13/02/09 15:30:01 32742 /usr/sbin/cron 0 0 36
3. 13/02/09 15:38:34 32734 /usr/lib/gdm/gdm-session-worker 0 -1 37</pre></div></dd><dt id="id-1.7.9.3.11.4.4.9"><span class="term">Create a report from all system call events</span></dt><dd><p>
       To analyze the audit log from a system call's point of view, use the
       <code class="command">aureport</code> <code class="option">-s</code> command. This command
       generates a numbered list of all system call events including date,
       time, number of the system call, process ID, name of the command that
       used this call, audit ID, and event number.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport -s</code>

Syscall Report
=======================================
# date time syscall pid comm auid event
=======================================
1. 16/02/09 17:45:01 2 20343 cron -1 2279
2. 16/02/09 17:45:02 83 20350 mktemp 0 2284
3. 16/02/09 17:45:02 83 20351 mkdir 0 2285</pre></div></dd><dt id="id-1.7.9.3.11.4.4.10"><span class="term">Create a report from all executable events</span></dt><dd><p>
       To analyze the audit log from an executable's point of view, use the
       <code class="command">aureport</code> <code class="option">-x</code> command. This command
       generates a numbered list of all executable events including date,
       time, name of the executable, the terminal it is run in, the host
       executing it, the audit ID, and event number.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="command">aureport -x</code>

Executable Report
====================================
# date time exe term host auid event
====================================
1. 13/02/09 15:08:26 /usr/sbin/sshd sshd 192.168.2.100 -1 12
2. 13/02/09 15:08:28 /usr/lib/gdm/gdm-session-worker :0 ? -1 13
3. 13/02/09 15:08:28 /usr/sbin/sshd ssh 192.168.2.100 -1 14</pre></div></dd><dt id="id-1.7.9.3.11.4.4.11"><span class="term">Create a report about files</span></dt><dd><p>
       To generate a report from the audit log that focuses on file access,
       use the <code class="command">aureport</code> <code class="option">-f</code> command. This
       command generates a numbered list of all file-related events
       including date, time, name of the accessed file, number of the system
       call accessing it, success or failure of the command, the executable
       accessing the file, audit ID, and event number.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport -f</code>

File Report
===============================================
# date time file syscall success exe auid event
===============================================
1. 16/02/09 17:45:01 /etc/shadow 2 yes /usr/sbin/cron -1 2279
2. 16/02/09 17:45:02 /tmp/ 83 yes /bin/mktemp 0 2284
3. 16/02/09 17:45:02 /var 83 no /bin/mkdir 0 2285</pre></div></dd><dt id="id-1.7.9.3.11.4.4.12"><span class="term">Create a report about users</span></dt><dd><p>
       To generate a report from the audit log that illustrates which users
       are running what executables on your system, use the
       <code class="command">aureport</code> <code class="option">-u</code> command. This command
       generates a numbered list of all user-related events including date,
       time, audit ID, terminal used, host, name of the executable, and an
       event ID.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="command">aureport -u</code>

User ID Report
====================================
# date time auid term host exe event
====================================
1. 13/02/09 15:08:26 -1 sshd 192.168.2.100 /usr/sbin/sshd 12
2. 13/02/09 15:08:28 -1 :0 ? /usr/lib/gdm/gdm-session-worker 13
3. 14/02/09 08:25:39 -1 ssh 192.168.2.101 /usr/sbin/sshd 14</pre></div></dd><dt id="id-1.7.9.3.11.4.4.13"><span class="term">Create a report about logins</span></dt><dd><p>
       To create a report that focuses on login attempts to your machine,
       run the <code class="command">aureport</code> <code class="option">-l</code> command. This
       command generates a numbered list of all login-related events
       including date, time, audit ID, host and terminal used, name of the
       executable, success or failure of the attempt, and an event ID.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport -l -i</code>

Login Report
============================================
# date time auid host term exe success event
============================================
1. 13/02/09 15:08:31 tux: 192.168.2.100 sshd /usr/sbin/sshd no 19
2. 16/02/09 12:39:05 root: 192.168.2.101 sshd /usr/sbin/sshd no 2108
3. 17/02/09 15:29:07 geeko: ? tty3 /bin/login yes 7809</pre></div></dd><dt id="id-1.7.9.3.11.4.4.14"><span class="term">Limit a report to a certain time frame</span></dt><dd><p>
       To analyze the logs for a particular time frame, such as only the
       working hours of Feb 16, 2009, first find out whether this data is
       contained in the current <code class="filename">audit.log</code> or whether
       the logs have been rotated in by running <code class="command">aureport</code>
       <code class="option">-t</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="command">aureport -t</code>

Log Time Range Report
=====================
/var/log/audit/audit.log: 03/02/09 14:13:38.225 - 17/02/09 15:30:01.636</pre></div><p>
       The current <code class="filename">audit.log</code> contains all the desired
       data. Otherwise, use the <code class="option">-if</code> option to point the
       <code class="command">aureport</code> commands to the log file that contains
       the needed data.
      </p><p>
       Then, specify the start date and time and the end date and time of
       the desired time frame and combine it with the report option needed.
       This example focuses on login attempts:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport -ts 02/16/09 8:00 -te 02/16/09 18:00 -l</code>

Login Report
============================================
# date time auid host term exe success event
============================================
1. 16/02/09 12:39:05 root: 192.168.2.100 sshd /usr/sbin/sshd no 2108
2. 16/02/09 12:39:12 0 192.168.2.100 /dev/pts/1 /usr/sbin/sshd yes 2114
3. 16/02/09 13:09:28 root: 192.168.2.100 sshd /usr/sbin/sshd no 2131
4. 16/02/09 13:09:32 root: 192.168.2.100 sshd /usr/sbin/sshd no 2133
5. 16/02/09 13:09:37 0 192.168.2.100 /dev/pts/2 /usr/sbin/sshd yes 2139</pre></div><p>
       The start date and time are specified with the <code class="option">-ts</code>
       option. Any event that has a time stamp equal to or after your given
       start time appears in the report. If you omit the date,
       <code class="command">aureport</code> assumes that you meant
       <span class="emphasis"><em>today</em></span>. If you omit the time, it assumes that the
       start time should be midnight of the date specified.


      </p><p>
       Specify the end date and time with the <code class="option">-te</code> option.
       Any event that has a time stamp equal to or before your given event
       time appears in the report. If you omit the date,
       <code class="command">aureport</code> assumes that you meant today. If you omit
       the time, it assumes that the end time should be now. Use the same
       format for the date and time as for <code class="option">-ts</code>.
      </p></dd></dl></div><p>
    All reports except the summary ones are printed in column format and
    sent to STDOUT, which means that this data can be written to other
    commands very easily. The visualization scripts introduced in
    <a class="xref" href="#sec-audit-auviz" title="41.8. Visualizing audit data">Section 41.8, “Visualizing audit data”</a> are examples of how to further process
    the data generated by audit.
   </p></section></section><section class="sect1" id="sec-audit-ausearch" data-id-title="Querying the audit daemon logs with ausearch"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">41.6 </span><span class="title-name">Querying the audit daemon logs with <code class="command">ausearch</code></span></span> <a title="Permalink" class="permalink" href="#sec-audit-ausearch">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="command">aureport</code> tool helps you to create overall
   summaries of what is happening on the system, but if you are interested
   in the details of a particular event, <code class="command">ausearch</code> is the
   tool to use.
  </p><p>
   <code class="command">ausearch</code> allows you to search the audit logs using
   special keys and search phrases that relate to most of the flags that
   appear in event messages in
   <code class="filename">/var/log/audit/audit.log</code>. Not all record types
   contain the same search phrases. There are no <code class="literal">hostname</code>
   or <code class="literal">uid</code> entries in a <code class="literal">PATH</code> record,
   for example.
  </p><p>
   When searching, make sure that you choose appropriate search criteria to
   catch all records you need. On the other hand, you could be searching for
   a specific type of record and still get various other related records
   along with it. This is caused by different parts of the kernel
   contributing additional records for events that are related to the one to
   find. For example, you would always get a <code class="literal">PATH</code> record
   along with the <code class="literal">SYSCALL</code> record for an
   <code class="command">open</code> system call.
  </p><div id="id-1.7.9.3.12.5" data-id-title="Using multiple search options" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Using multiple search options</div><p>
    Any of the command line options can be combined with logical AND
    operators to narrow down your search.
   </p></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.3.12.6.1"><span class="term">Read audit logs from another file</span></dt><dd><p>
      When the audit logs have moved to another machine or when you want to
      analyze the logs of several machines on your local machine without
      wanting to connect to each of these individually, move the logs to a
      local file and have <code class="command">ausearch</code> search them locally:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ausearch -</code> <em class="replaceable">option</em> -if <em class="replaceable">myfile</em></pre></div></dd><dt id="id-1.7.9.3.12.6.2"><span class="term">Convert numeric results into text</span></dt><dd><p>
      Some information, such as user IDs are printed in numeric form. To
      convert these into human readable text format, add the
      <code class="option">-i</code> option to your <code class="command">ausearch</code>
      command.
     </p></dd><dt id="id-1.7.9.3.12.6.3"><span class="term">Search by audit event ID</span></dt><dd><p>
      If you have previously run an audit report or done an
      <code class="command">autrace</code>, you should analyze the trail of a
      particular event in the log. Most of the report types described in
      <a class="xref" href="#sec-audit-aureport" title="41.5. Understanding the audit logs and generating reports">Section 41.5, “Understanding the audit logs and generating reports”</a> include audit event IDs in their
      output. An audit event ID is the second part of an audit message ID,
      which consists of a Unix epoch time stamp and the audit event ID
      separated by a colon. All events that are logged from one
      application's system call have the same event ID. Use this event ID
      with <code class="command">ausearch</code> to retrieve this event's trail from
      the log.
     </p><p>
      Use a command similar to the following:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ausearch -a 5207</code>
----
time-&gt;Tue Feb 17 13:43:58 2009
type=PATH msg=audit(1234874638.599:5207): item=0 name="/var/log/audit/audit.log" inode=1219041 dev=08:06 mode=0100644 ouid=0 ogid=0 rdev=00:00
type=CWD msg=audit(1234874638.599:5207):  cwd="/root"
type=SYSCALL msg=audit(1234874638.599:5207): arch=c000003e syscall=2 success=yes exit=4 a0=62fb60 a1=0 a2=31 a3=0 items=1 ppid=25400 pid=25616 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts1 ses=1164 comm="less" exe="/usr/bin/less" key="doc_log"</pre></div><p>
      The <code class="command">ausearch</code> <code class="option">-a</code> command grabs all
      records in the logs that are related to the audit event ID provided
      and displays them. This option can be combined with any other option.
     </p></dd><dt id="id-1.7.9.3.12.6.4"><span class="term">Search by message type</span></dt><dd><p>
      To search for audit records of a particular message type, use the
      <code class="command">ausearch</code> <code class="option">-m
      <em class="replaceable">MESSAGE_TYPE</em></code> command. Examples of
      valid message types include <code class="literal">PATH</code>,
      <code class="literal">SYSCALL</code>, and <code class="literal">USER_LOGIN</code>. Running
      <code class="command">ausearch</code> <code class="option">-m</code> without a message type
      displays a list of all message types.
     </p></dd><dt id="id-1.7.9.3.12.6.5"><span class="term">Search by login ID</span></dt><dd><p>
      To view records associated with a particular login user ID, use the
      <code class="command">ausearch</code> <code class="option">-ul</code> command. It displays
      any records related to the user login ID specified provided that user
      had been able to log in successfully.
     </p></dd><dt id="id-1.7.9.3.12.6.6"><span class="term">Search by user ID</span></dt><dd><p>
      View records related to any of the user IDs (both user ID and
      effective user ID) with <code class="command">ausearch</code>
      <code class="option">-ua</code>. View reports related to a particular user ID
      with <code class="command">ausearch</code> <code class="option">-ui
      <em class="replaceable">UID</em></code>. Search for records related to
      a particular effective user ID, use the <code class="command">ausearch</code>
      <code class="option">-ue <em class="replaceable">EUID</em></code>. Searching for a
      user ID means the user ID of the user creating a process. Searching
      for an effective user ID means the user ID and privileges that are
      required to run this process.
     </p></dd><dt id="id-1.7.9.3.12.6.7"><span class="term">Search by group ID</span></dt><dd><p>
      View records related to any of the group IDs (both group ID and
      effective group ID) with the <code class="command">ausearch</code>
      <code class="option">-ga</code> command. View reports related to a particular
      user ID with <code class="command">ausearch</code> <code class="option">-gi
      <em class="replaceable">GID</em></code>. Search for records related to
      a particular effective group ID, use <code class="command">ausearch</code>
      <code class="option">-ge <em class="replaceable">EGID</em></code>.
     </p></dd><dt id="id-1.7.9.3.12.6.8"><span class="term">Search by command line name</span></dt><dd><p>
      View records related to a certain command, using the
      <code class="command">ausearch</code> <code class="option">-c
      <em class="replaceable">COMM_NAME</em></code> command, for example,
      <code class="command">ausearch</code> <code class="option">-c less</code> for all records
      related to the <code class="command">less</code> command.
     </p></dd><dt id="id-1.7.9.3.12.6.9"><span class="term">Search by executable name</span></dt><dd><p>
      View records related to a certain executable with the
      <code class="command">ausearch</code> <code class="option">-x
      <em class="replaceable">EXE</em></code> command, for example
      <code class="command">ausearch</code> <code class="option">-x /usr/bin/less</code> for all
      records related to the <code class="command">/usr/bin/less</code> executable.
     </p></dd><dt id="id-1.7.9.3.12.6.10"><span class="term">Search by system call name</span></dt><dd><p>
      View records related to a certain system call with the
      <code class="command">ausearch</code> <code class="option">-sc
      <em class="replaceable">SYSCALL</em></code> command, for example,
      <code class="command">ausearch -sc open</code> for all records related to the
      <code class="command">open</code> system call.
     </p></dd><dt id="id-1.7.9.3.12.6.11"><span class="term">Search by process ID</span></dt><dd><p>
      View records related to a certain process ID with the
      <code class="command">ausearch</code> <code class="option">-p
      <em class="replaceable">PID</em></code> command, for example
      <code class="command">ausearch</code> <code class="option">-p 13368</code> for all records
      related to this process ID.
     </p></dd><dt id="id-1.7.9.3.12.6.12"><span class="term">Search by event or system call success value</span></dt><dd><p>
      View records containing a certain system call success value with
      <code class="command">ausearch</code> <code class="option">-sv
      <em class="replaceable">SUCCESS_VALUE</em></code>, for example,
      <code class="command">ausearch</code> <code class="option">-sv yes</code> for all
      successful system calls.
     </p></dd><dt id="id-1.7.9.3.12.6.13"><span class="term">Search by file name</span></dt><dd><p>
      View records containing a certain file name with
      <code class="command">ausearch</code> <code class="option">-f
      <em class="replaceable">FILE_NAME</em></code>, for example,
      <code class="command">ausearch</code> <code class="option">-f /foo/bar</code> for all
      records related to the <code class="filename">/foo/bar</code> file. Using the
      file name alone would work as well, but using relative paths does not
      work.
     </p></dd><dt id="id-1.7.9.3.12.6.14"><span class="term">Search by terminal</span></dt><dd><p>
      View records of events related to a certain terminal only with
      <code class="command">ausearch</code> <code class="option">-tm
      <em class="replaceable">TERM</em></code>, for example,
      <code class="command">ausearch</code> <code class="option">-tm ssh</code> to view all
      records related to events on the SSH terminal and
      <code class="command">ausearch</code> <code class="option">-tm tty</code> to view all
      events related to the console.
     </p></dd><dt id="id-1.7.9.3.12.6.15"><span class="term">Search by host name</span></dt><dd><p>
      View records related to a certain remote host name with
      <code class="command">ausearch</code> <code class="option">-hn
      <em class="replaceable">HOSTNAME</em></code>, for example,
      <code class="command">ausearch</code> <code class="option">-hn jupiter.example.com</code>. You can
      use a host name, fully qualified domain name, or numeric network
      address.
     </p></dd><dt id="id-1.7.9.3.12.6.16"><span class="term">Search by key field</span></dt><dd><p>
      View records that contain a certain key assigned in the audit rule set
      to identify events of a particular type. Use the
      <code class="command">ausearch</code> <code class="option">-k
      <em class="replaceable">KEY_FIELD</em></code>, for example,
      <code class="command">ausearch</code> <code class="option">-k CFG_etc</code> to display any
      records containing the <code class="literal">CFG_etc</code> key.
     </p></dd><dt id="id-1.7.9.3.12.6.17"><span class="term">Search by word</span></dt><dd><p>
      View records that contain a certain string assigned in the audit rule
      set to identify events of a particular type. The whole string will be
      matched on file name, host name, and terminal. Use the
      <code class="command">ausearch</code> <code class="option">-w
      <em class="replaceable">WORD</em></code>.
     </p></dd><dt id="id-1.7.9.3.12.6.18"><span class="term">Limit a search to a certain time frame</span></dt><dd><p>
      Use <code class="option">-ts</code> and <code class="option">-te</code> to limit the scope
      of your searches to a certain time frame. The <code class="option">-ts</code>
      option is used to specify the start date and time and the
      <code class="option">-te</code> option is used to specify the end date and time.
      These options can be combined with any of the above. The use of these
      options is similar to use with <code class="command">aureport</code>.
     </p></dd></dl></div></section><section class="sect1" id="sec-audit-autrace" data-id-title="Analyzing processes with autrace"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">41.7 </span><span class="title-name">Analyzing processes with <code class="command">autrace</code></span></span> <a title="Permalink" class="permalink" href="#sec-audit-autrace">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In addition to monitoring your system using the rules you set up, you can
   also perform dedicated audits of individual processes using the
   <code class="command">autrace</code> command. <code class="command">autrace</code> works
   similarly to the <code class="command">strace</code> command, but gathers slightly
   different information. The output of <code class="command">autrace</code> is
   written to <code class="filename">/var/log/audit/audit.log</code> and does not
   look any different from the standard audit log entries.
  </p><p>
   When performing an <code class="command">autrace</code> on a process, make sure
   that any audit rules are purged from the queue to avoid these rules
   clashing with the ones <code class="command">autrace</code> adds itself. Delete the
   audit rules with the <code class="command">auditctl</code> <code class="option">-D</code>
   command. This stops all normal auditing.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">auditctl -D</code>

No rules

<code class="command">autrace /usr/bin/less</code>

Waiting to execute: /usr/bin/less
Cleaning up...
No rules
Trace complete. You can locate the records with 'ausearch -i -p 7642'</pre></div><p>
   Always use the full path to the executable to track with
   <code class="command">autrace</code>. After the trace is complete,
   <code class="command">autrace</code> provides the event ID of the trace, so you can
   analyze the entire data trail with <code class="command">ausearch</code>. To
   restore the audit system to use the audit rule set again, restart the
   audit daemon with <code class="command">systemctl restart auditd</code>.
  </p></section><section class="sect1" id="sec-audit-auviz" data-id-title="Visualizing audit data"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">41.8 </span><span class="title-name">Visualizing audit data</span></span> <a title="Permalink" class="permalink" href="#sec-audit-auviz">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Neither the data trail in <code class="filename">/var/log/audit/audit.log</code>
   nor the different report types generated by <code class="command">aureport</code>,
   described in <a class="xref" href="#sec-audit-aureport-gen" title="41.5.2. Generating custom audit reports">Section 41.5.2, “Generating custom audit reports”</a>, provide an
   intuitive reading experience to the user. The <code class="command">aureport</code>
   output is formatted in columns and thus easily available to any sed,
   Perl, or awk scripts that users might connect to the audit framework to
   visualize the audit data.
  </p><p>
   The visualization scripts (see <a class="xref" href="#sec-audit-viz" title="42.6. Configuring log visualization">Section 42.6, “Configuring log visualization”</a>) are one
   example of how to use standard Linux tools available with
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> or any other Linux distribution to create easy-to-read
   audit output. The following examples help you understand how the plain
   audit reports can be transformed into human readable graphics.
  </p><p>
   The first example illustrates the relationship of programs and system
   calls. To get to this kind of data, you need to determine the appropriate
   <code class="command">aureport</code> command that delivers the source data from
   which to generate the final graphic:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport -s -i</code>

Syscall Report
=======================================
# date time syscall pid comm auid event
=======================================
1. 16/02/09 17:45:01 open 20343 cron unset 2279
2. 16/02/09 17:45:02 mkdir 20350 mktemp root 2284
3. 16/02/09 17:45:02 mkdir 20351 mkdir root 2285
...</pre></div><p>
   The first thing that the visualization script needs to do on this report
   is to extract only those columns that are of interest, in this example,
   the <code class="literal">syscall</code> and the <code class="literal">comm</code> columns.
   The output is sorted and duplicates removed then the final output is
   written into the visualization program itself:
  </p><div class="verbatim-wrap"><pre class="screen">LC_ALL=C aureport -s -i | awk '/^[0-9]/ { print $6" "$4 }' | sort | uniq | mkgraph</pre></div><div class="figure" id="fig-audit-mkgraph"><div class="figure-contents"><div class="mediaobject"><a href="images/audit_mkgraph.png"><img src="images/audit_mkgraph.png" width="75%" alt="Flow graph—program versus system call relationship" title="Flow graph—program versus system call relationship"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 41.2: </span><span class="title-name">Flow graph—program versus system call relationship </span></span><a title="Permalink" class="permalink" href="#fig-audit-mkgraph">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div><p>
   The second example illustrates the different types of events and how many
   of each type have been logged. The appropriate
   <code class="command">aureport</code> command to extract this kind of information
   is <code class="command">aureport -e</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aureport -e -i --summary

Event Summary Report
======================
total  type
======================
2434  SYSCALL
816  USER_START
816  USER_ACCT
814  CRED_ACQ
810  LOGIN
806  CRED_DISP
779  USER_END
99  CONFIG_CHANGE
52  USER_LOGIN</pre></div><p>
   Because this type of report already contains a two column output, it is
   only fed into the visualization script and transformed into a bar chart.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aureport -e -i --summary  | mkbar events</pre></div><div class="figure" id="fig-audit-mkbar"><div class="figure-contents"><div class="mediaobject"><a href="images/audit_mkbar.png"><img src="images/audit_mkbar.png" width="75%" alt="Bar chart—common event types" title="Bar chart—common event types"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 41.3: </span><span class="title-name">Bar chart—common event types </span></span><a title="Permalink" class="permalink" href="#fig-audit-mkbar">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div><p>
   For background information about the visualization of audit data, refer
   to the Web site of the audit project at
   <a class="link" href="http://people.redhat.com/sgrubb/audit/visualize/index.html" target="_blank">http://people.redhat.com/sgrubb/audit/visualize/index.html</a>.
  </p></section><section class="sect1" id="sec-audit-audisp" data-id-title="Relaying audit event notifications"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">41.9 </span><span class="title-name">Relaying audit event notifications</span></span> <a title="Permalink" class="permalink" href="#sec-audit-audisp">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The auditing system also allows external applications to access and
   use the <code class="systemitem">auditd</code> daemon in real
   time. This feature is provided by so called <span class="emphasis"><em>audit
   dispatcher</em></span> which allows, for example, intrusion detection
   systems to use <code class="systemitem">auditd</code> to receive
   enhanced detection information.
  </p><p>
   The configuration of <code class="systemitem">auditd</code> is
   stored in <code class="filename">/etc/audit/auditd.conf</code>. The file includes
   the following options:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.3.15.4.1"><span class="term"><code class="literal">q_depth</code>
    </span></dt><dd><p>
      Specifies the size of the event dispatcher internal queue. If syslog
      complains about audit events getting dropped, increase this value.
      Default is 250.
     </p></dd><dt id="id-1.7.9.3.15.4.2"><span class="term"><code class="literal">overflow_action</code>
    </span></dt><dd><p>
      Specifies the way the audit daemon will react to the internal queue
      overflow. Possible values are <code class="option">ignore</code> (nothing
      happens), <code class="option">syslog</code> (issues a warning to syslog),
      <code class="option">suspend</code> (stop processing events),
      <code class="option">single</code> (the computer system will be put in single
      user mode), or <code class="option">halt</code> (shuts the system down).
     </p></dd><dt id="id-1.7.9.3.15.4.3"><span class="term"><code class="literal">priority_boost</code>
    </span></dt><dd><p>
      Specifies the priority for the audit event dispatcher (in addition to
      the audit daemon priority itself). Default is 4 which means no change
      in priority.
     </p></dd><dt id="id-1.7.9.3.15.4.4"><span class="term"><code class="literal">name_format</code>
    </span></dt><dd><p>
      Specifies the way the computer node name is inserted into the audit
      event. Possible values are <code class="option">none</code> (no computer name is
      inserted), <code class="option">hostname</code> (name returned by the
      <code class="systemitem">gethostname</code> system call),
      <code class="option">fqd</code> (fully qualified domain name of the machine),
      <code class="option">numeric</code> (IP address of the machine), or
      <code class="option">user</code> (user defined string from the
      <code class="option">name</code> option). Default is <code class="option">none</code>.
     </p></dd><dt id="id-1.7.9.3.15.4.5"><span class="term"><code class="literal">name</code>
    </span></dt><dd><p>
      Specifies a user-defined string which identifies the machine. The
      <code class="option">name_format</code> option must be set to
      <code class="option">user</code>, otherwise this option is ignored.
     </p></dd><dt id="id-1.7.9.3.15.4.6"><span class="term"><code class="literal">max_restarts</code>
    </span></dt><dd><p>
      A non-negative number that tells the audit event dispatcher how many
      times it can try to restart a crashed plug-in. The default is 10.
     </p></dd></dl></div><div class="example" id="id-1.7.9.3.15.5" data-id-title="Example /etc/audit/auditd.conf"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.10: </span><span class="title-name">Example /etc/audit/auditd.conf </span></span><a title="Permalink" class="permalink" href="#id-1.7.9.3.15.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">  q_depth = 250
  overflow_action = SYSLOG
  priority_boost = 4
  name_format = HOSTNAME
  #name = mydomain</pre></div></div></div><p>
   The plug-in programs install their configuration files in a special
   directory, <code class="filename">/etc/audit/plugins.d</code>.
   The plug-in configuration files have the following options:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.3.15.7.1"><span class="term"><code class="literal">active</code>
    </span></dt><dd><p>
      Specifies if the program will use
      <code class="systemitem">auditd</code>. Possible values are
      <code class="option">yes</code> or <code class="option">no</code>.
     </p></dd><dt id="id-1.7.9.3.15.7.2"><span class="term"><code class="literal">direction</code>
    </span></dt><dd><p>
      Specifies the way the plug-in was designed to communicate with audit.
      It informs the event dispatcher in which directions the events flow.
      Possible values are <code class="option">in</code> or <code class="option">out</code>.
     </p></dd><dt id="id-1.7.9.3.15.7.3"><span class="term"><code class="literal">path</code>
    </span></dt><dd><p>
      Specifies the absolute path to the plug-in executable. In case of
      internal plug-ins, this option specifies the plug-in name.
     </p></dd><dt id="id-1.7.9.3.15.7.4"><span class="term"><code class="literal">type</code>
    </span></dt><dd><p>
      Specifies the way the plug-in is to be run. Possible values are
      <code class="option">builtin</code> or <code class="option">always</code>. Use
      <code class="option">builtin</code> for internal plug-ins
      (<code class="literal">af_unix</code> and <code class="literal">syslog</code>) and
      <code class="option">always</code> for most (if not all) other plug-ins. Default
      is <code class="option">always</code>.
     </p></dd><dt id="id-1.7.9.3.15.7.5"><span class="term"><code class="literal">args</code>
    </span></dt><dd><p>
      Specifies the argument that is passed to the plug-in program.
      Normally, plug-in programs read their arguments from their
      configuration file and do not need to receive any arguments. There is
      a limit of two arguments.
     </p></dd><dt id="id-1.7.9.3.15.7.6"><span class="term"><code class="literal">format</code>
    </span></dt><dd><p>
      Specifies the format of data that the audit dispatcher passes to the
      plug-in program. Valid options are <code class="option">binary</code> or
      <code class="option">string</code>. <code class="option">binary</code> passes the data
      exactly as the event dispatcher receives them from the audit daemon.
      <code class="option">string</code> instructs the dispatcher to change the event
      into a string that is parseable by the audit parsing library. Default
      is <code class="option">string</code>.
     </p></dd></dl></div><div class="example" id="id-1.7.9.3.15.8" data-id-title="Example /etc/audit/plugins.d/syslog.conf"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 41.11: </span><span class="title-name">Example /etc/audit/plugins.d/syslog.conf </span></span><a title="Permalink" class="permalink" href="#id-1.7.9.3.15.8">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_components.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">  active = no
  direction = out
  path = /sbin/audisp-syslog
  type = builtin
  args = LOG_INFO
  format = string</pre></div></div></div></section></section><section class="chapter" id="cha-audit-setup" data-id-title="Setting up the Linux audit framework"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">42 </span><span class="title-name">Setting up the Linux audit framework</span></span> <a title="Permalink" class="permalink" href="#cha-audit-setup">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This chapter shows how to set up a simple audit scenario. Every step
  involved in configuring and enabling audit is explained in detail. After
  you have learned to set up audit, consider a real-world example scenario
  in <a class="xref" href="#cha-audit-scenarios" title="Chapter 43. Introducing an audit rule set">Chapter 43, <em>Introducing an audit rule set</em></a>.
 </p><p>
  To set up audit on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, you need to complete the following
  steps:
 </p><div class="procedure" id="id-1.7.9.4.5" data-id-title="Setting up the Linux audit framework"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 42.1: </span><span class="title-name">Setting up the Linux audit framework </span></span><a title="Permalink" class="permalink" href="#id-1.7.9.4.5">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_setup.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
    Install the <code class="systemitem">audit</code>
    package. To use the log visualization as described in
    <a class="xref" href="#sec-audit-viz" title="42.6. Configuring log visualization">Section 42.6, “Configuring log visualization”</a>,
    install <code class="systemitem">gnuplot</code> and
    <code class="systemitem">graphviz</code>.
   </p></li><li class="step"><p>
    Determine the components to audit. Refer to
    <a class="xref" href="#sec-audit-choose" title="42.1. Determining the components to audit">Section 42.1, “Determining the components to audit”</a> for details.
   </p></li><li class="step"><p>
    Check or modify the basic audit daemon configuration. Refer to
    <a class="xref" href="#sec-audit-config" title="42.2. Configuring the audit daemon">Section 42.2, “Configuring the audit daemon”</a> for details.
   </p></li><li class="step"><p>
    Enable auditing for system calls. Refer to
    <a class="xref" href="#sec-audit-syscall" title="42.3. Enabling audit for system calls">Section 42.3, “Enabling audit for system calls”</a> for details.
   </p></li><li class="step"><p>
    Compose audit rules to suit your scenario. Refer to
    <a class="xref" href="#sec-audit-aurules" title="42.4. Setting up audit rules">Section 42.4, “Setting up audit rules”</a> for details.
   </p></li><li class="step"><p>
    Generate logs and configure tailor-made reports. Refer to
    <a class="xref" href="#sec-audit-aurepo" title="42.5. Configuring audit reports">Section 42.5, “Configuring audit reports”</a> for details.
   </p></li><li class="step"><p>
    Configure optional log visualization. Refer to
    <a class="xref" href="#sec-audit-viz" title="42.6. Configuring log visualization">Section 42.6, “Configuring log visualization”</a> for details.
   </p></li></ol></div></div><div id="id-1.7.9.4.6" data-id-title="Controlling the audit daemon" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Controlling the audit daemon</div><p>
   Before configuring any of the components of the audit system, make sure
   that the audit daemon is not running by entering <code class="command">systemctl
   status auditd</code> as <code class="systemitem">root</code>. On a default
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> system, audit is started on boot, so you need to turn it
   off by entering <code class="command">systemctl stop auditd</code>. Start
   the daemon after configuring it with <code class="command">systemctl start
   auditd</code>.
  </p></div><section class="sect1" id="sec-audit-choose" data-id-title="Determining the components to audit"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">42.1 </span><span class="title-name">Determining the components to audit</span></span> <a title="Permalink" class="permalink" href="#sec-audit-choose">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Before starting to create your own audit configuration, determine to
   which degree you want to use it. Check the following general rules to
   determine which use case best applies to you and your requirements:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     If you require a full security audit for CAPP/EAL certification, enable
     full audit for system calls and configure watches on various
     configuration files and directories, similar to the rule set featured
     in <a class="xref" href="#cha-audit-scenarios" title="Chapter 43. Introducing an audit rule set">Chapter 43, <em>Introducing an audit rule set</em></a>.
    </p></li><li class="listitem"><p>
     If you need to trace a process based on the audit rules, use
     <code class="command">autrace</code>.
    </p></li><li class="listitem"><p>
     If you require file and directory watches to track access to important
     or security-sensitive data, create a rule set matching these
     requirements. Enable audit as described in
     <a class="xref" href="#sec-audit-syscall" title="42.3. Enabling audit for system calls">Section 42.3, “Enabling audit for system calls”</a> and proceed to
     <a class="xref" href="#sec-audit-aurules" title="42.4. Setting up audit rules">Section 42.4, “Setting up audit rules”</a>.
    </p></li></ul></div></section><section class="sect1" id="sec-audit-config" data-id-title="Configuring the audit daemon"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">42.2 </span><span class="title-name">Configuring the audit daemon</span></span> <a title="Permalink" class="permalink" href="#sec-audit-config">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The basic setup of the audit daemon is done by editing
   <code class="filename">/etc/audit/auditd.conf</code>. You may also use YaST
   to configure the basic settings by calling <span class="guimenu">YaST</span> › <span class="guimenu">Security and Users</span> › <span class="guimenu">Linux Audit Framework (LAF)</span>. Use the
   tabs <span class="guimenu">Log File</span> and <span class="guimenu">Disk Space</span> for
   configuration.
  </p><div class="verbatim-wrap"><pre class="screen">log_file = /var/log/audit/audit.log
log_format = RAW
log_group = root
priority_boost = 4
flush = INCREMENTAL
freq = 20
num_logs = 5
disp_qos = lossy
dispatcher = /sbin/audispd
name_format = NONE
##name = mydomain
max_log_file = 6
max_log_file_action = ROTATE
space_left = 75
space_left_action = SYSLOG
action_mail_acct = root
admin_space_left = 50
admin_space_left_action = SUSPEND
disk_full_action = SUSPEND
disk_error_action = SUSPEND
##tcp_listen_port =
tcp_listen_queue = 5
tcp_max_per_addr = 1
##tcp_client_ports = 1024-65535
tcp_client_max_idle = 0
cp_client_max_idle = 0</pre></div><p>
   The default settings work reasonably well for many setups. Some values,
   such as <code class="literal">num_logs</code>, <code class="literal">max_log_file</code>,
   <code class="literal">space_left</code>, and <code class="literal">admin_space_left</code>
   depend on the size of your deployment. If disk space is limited, you
   should reduce the number of log files to keep if they are rotated
   and you should get an earlier warning if disk space is running out.
   For a CAPP-compliant setup, adjust the values for
   <code class="literal">log_file</code>, <code class="literal">flush</code>,
   <code class="literal">max_log_file</code>, <code class="literal">max_log_file_action</code>,
   <code class="literal">space_left</code>, <code class="literal">space_left_action</code>,
   <code class="literal">admin_space_left</code>,
   <code class="literal">admin_space_left_action</code>,
   <code class="literal">disk_full_action</code>, and
   <code class="literal">disk_error_action</code>, as described in
   <a class="xref" href="#sec-audit-auditd" title="41.2. Configuring the audit daemon">Section 41.2, “Configuring the audit daemon”</a>. An example CAPP-compliant
   configuration looks like this:
  </p><div class="verbatim-wrap"><pre class="screen">log_file = <em class="replaceable">PATH_TO_SEPARATE_PARTITION</em>/audit.log
log_format = RAW
priority_boost = 4
flush = SYNC                       ### or DATA
freq = 20
num_logs = 4
dispatcher = /sbin/audispd
disp_qos = lossy
max_log_file = 5
max_log_file_action = KEEP_LOGS
space_left = 75
space_left_action = EMAIL
action_mail_acct = root
admin_space_left = 50
admin_space_left_action = SINGLE   ### or HALT
disk_full_action = SUSPEND         ### or HALT
disk_error_action = SUSPEND        ### or HALT</pre></div><p>
   The <code class="literal">###</code> precedes comments where you can choose from
   several options. Do not add the comments to your actual configuration
   files.
  </p><div id="id-1.7.9.4.8.7" data-id-title="More information" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: More information</div><p>
    Refer to <a class="xref" href="#sec-audit-auditd" title="41.2. Configuring the audit daemon">Section 41.2, “Configuring the audit daemon”</a> for detailed background
    information about the <code class="filename">auditd.conf</code> configuration
    parameters.
   </p></div></section><section class="sect1" id="sec-audit-syscall" data-id-title="Enabling audit for system calls"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">42.3 </span><span class="title-name">Enabling audit for system calls</span></span> <a title="Permalink" class="permalink" href="#sec-audit-syscall">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the audit framework is not installed, install the
   <code class="systemitem">audit</code> package. A standard <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>
   system does not have auditd running by default. Enable it with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable auditd</pre></div><p>
   There are different levels of auditing activity available:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.4.9.5.1"><span class="term">Basic logging</span></dt><dd><p>
      Out of the box (without any further configuration) auditd logs only
      events concerning its own configuration changes to
      <code class="filename">/var/log/audit/audit.log</code>. No events (file access,
      system call, etc.) are generated by the kernel audit component until
      requested by <code class="command">auditctl</code>. However, other kernel
      components and modules may log audit events outside of the control of
      <code class="command">auditctl</code> and these appear in the audit log. By
      default, the only module that generates audit events is <span class="phrase">AppArmor</span>.
     </p></dd><dt id="id-1.7.9.4.9.5.2"><span class="term">Advanced logging with system call auditing</span></dt><dd><p>
      To audit system calls and get meaningful file watches, you need to
      enable audit contexts for system calls.
     </p></dd></dl></div><p>
   As you need system call auditing capabilities even when you are
   configuring plain file or directory watches, you need to enable audit
   contexts for system calls. To enable audit contexts for the duration of
   the current session only, execute <code class="command">auditctl -e 1</code> as
   <code class="systemitem">root</code>. To disable this feature, execute <code class="command">auditctl -e
   0</code> as <code class="systemitem">root</code>.
  </p><p>
   The audit contexts are enabled by default. To turn this feature off
   temporarily, use <code class="command">auditctl -e 0</code>.
  </p></section><section class="sect1" id="sec-audit-aurules" data-id-title="Setting up audit rules"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">42.4 </span><span class="title-name">Setting up audit rules</span></span> <a title="Permalink" class="permalink" href="#sec-audit-aurules">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Using audit rules, determine which aspects of the system should be
   analyzed by audit. Normally this includes important databases and
   security-relevant configuration files. You may also analyze various
   system calls in detail if a broad analysis of your system is required. A
   very detailed example configuration that includes most of the rules that
   are needed in a CAPP compliant environment is available in
   <a class="xref" href="#cha-audit-scenarios" title="Chapter 43. Introducing an audit rule set">Chapter 43, <em>Introducing an audit rule set</em></a>.
  </p><p>
   Audit rules can be passed to the audit daemon on the
   <code class="command">auditctl</code> command line and by composing a rule
   set in <code class="filename">/etc/audit/audit.rules</code> which is processed
   whenever the audit daemon is started. To customize
   <code class="filename">/etc/audit/audit.rules</code> either edit it directly, or
   use YaST: <span class="guimenu">Security and Users</span> › <span class="guimenu">Linux Audit Framework (LAF)</span> › <span class="guimenu">Rules for
   'auditctl'</span>. Rules passed on the command line are
   not persistent and need to be re-entered when the audit daemon is
   restarted.
  </p><p>
   A simple rule set for very basic auditing on a few important files and
   directories could look like this:
  </p><div class="verbatim-wrap"><pre class="screen"># basic audit system parameters
-D
-b 8192
-f 1
-e 1

# some file and directory watches with keys
-w /var/log/audit/ -k LOG_audit
-w /etc/audit/auditd.conf -k CFG_audit_conf -p rxwa
-w /etc/audit/audit.rules -k CFG_audit_rules -p rxwa

-w /etc/passwd -k CFG_passwd -p rwxa
-w /etc/sysconfig/ -k CFG_sysconfig

# an example system call rule
-a entry,always -S umask

### add your own rules</pre></div><p>
   When configuring the basic audit system parameters (such as the backlog
   parameter <code class="literal">-b</code>) test these settings with your intended
   audit rule set to determine whether the backlog size is appropriate for
   the level of logging activity caused by your audit rule set. If your
   chosen backlog size is too small, your system might not be able to handle
   the audit load and consult the failure flag (<code class="literal">-f</code>) when
   the backlog limit is exceeded.
  </p><div id="id-1.7.9.4.10.7" data-id-title="Choosing the failure flag" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Choosing the failure flag</div><p>
    When choosing the failure flag, note that <code class="option">-f 2</code> tells
    your system to perform an immediate shutdown without flushing any
    pending data to disk when the limits of your audit system are exceeded.
    Because this shutdown is not a clean shutdown, restrict the use of
    <code class="option">-f 2</code> to only the most security-conscious environments
    and use <code class="option">-f 1</code> (system continues to run, issues a warning
    and audit stops) for any other setup to avoid loss of data or data
    corruption.
   </p></div><p>
   Directory watches produce less verbose output than separate file watches
   for the files under these directories. To get detailed logging for your
   system configuration in <code class="filename">/etc/sysconfig</code>, for example,
   add watches for each file. Audit does not support globbing,
   which means you cannot create a rule that says <code class="literal">-w
   /etc/*</code> and watches all files and directories below
   <code class="filename">/etc</code>.
  </p><p>
   For better identification in the log file, a key has been added to each
   of the file and directory watches. Using the key, it is easier to comb
   the logs for events related to a certain rule. When creating keys,
   distinguish between mere log file watches and configuration file watches
   by using an appropriate prefix with the key, in this case
   <code class="literal">LOG</code> for a log file watch and <code class="literal">CFG</code>
   for a configuration file watch. Using the file name as part of the key
   also makes it easier for you to identify events of this type in the log
   file.
  </p><p>
   Another thing to keep in mind when creating file and directory watches is
   that audit cannot deal with files that do not exist when the rules are
   created. Any file that is added to your system while audit is already
   running is not watched unless you extend the rule set to watch this new
   file.
  </p><p>
   For more information about creating custom rules, refer to
   <a class="xref" href="#sec-audit-rules" title="41.4. Passing parameters to the audit system">Section 41.4, “Passing parameters to the audit system”</a>.
  </p><div id="id-1.7.9.4.10.13" data-id-title="Changing audit rules" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Changing audit rules</div><p>
    After you change audit rules, always restart the audit daemon with
    <code class="command">systemctl restart auditd</code> to reread the
    changed rules.
   </p></div></section><section class="sect1" id="sec-audit-aurepo" data-id-title="Configuring audit reports"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">42.5 </span><span class="title-name">Configuring audit reports</span></span> <a title="Permalink" class="permalink" href="#sec-audit-aurepo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To avoid having to dig through the raw audit logs to get an impression of
   what your system is currently doing, run custom audit reports at certain
   intervals. Custom audit reports enable you to focus on areas of interest
   and get meaningful statistics on the nature and frequency of the events
   you are monitoring. To analyze individual events in detail, use the
   ausearch tool.
  </p><p>
   Before setting up audit reporting, consider the following:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     What types of events do you want to monitor by generating regular
     reports? Select the appropriate aureport command lines as described in
     <a class="xref" href="#sec-audit-aureport-gen" title="41.5.2. Generating custom audit reports">Section 41.5.2, “Generating custom audit reports”</a>.
    </p></li><li class="listitem"><p>
     What do you want to do with the audit reports? Decide whether to create
     graphical charts from the data accumulated or whether it should be
     transferred into any sort of spreadsheet or database. Set up the
     aureport command line and further processing similar to the examples
     shown in <a class="xref" href="#sec-audit-viz" title="42.6. Configuring log visualization">Section 42.6, “Configuring log visualization”</a> if you want to visualize your
     reports.
    </p></li><li class="listitem"><p>
     When and at which intervals should the reports run? Set up appropriate
     automated reporting using cron.
    </p></li></ul></div><p>
   For this example, assume that you are interested in finding out about any
   attempts to access your audit, PAM, and system configuration. Proceed as
   follows to find out about file events on your system:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Generate a full summary report of all events and check for any
     anomalies in the summary report, for example, have a look at the
     <span class="quote">“<span class="quote">failed syscalls</span>”</span> record, because these might have failed
     because of insufficient permissions to access a file or a file not
     being there:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport</code>

Summary Report
======================
Range of time in logs: 03/02/09 14:13:38.225 - 17/02/09 16:30:10.352
Selected time for report: 03/02/09 14:13:38 - 17/02/09 16:30:10.352
Number of changes in configuration: 24
Number of changes to accounts, groups, or roles: 0
Number of logins: 9
Number of failed logins: 15
Number of authentications: 19
Number of failed authentications: 578
Number of users: 3
Number of terminals: 15
Number of host names: 4
Number of executables: 20
Number of files: 279
Number of AVC's: 0
Number of MAC events: 0
Number of failed syscalls: 994
Number of anomaly events: 0
Number of responses to anomaly events: 0
Number of crypto events: 0
Number of keys: 2
Number of process IDs: 1238
Number of events: 5435</pre></div></li><li class="step"><p>
     Run a summary report for failed events and check the
     <span class="quote">“<span class="quote">files</span>”</span> record for the number of failed file access
     events:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport</code> <code class="option">--failed</code>

Failed Summary Report
======================
Range of time in logs: 03/02/09 14:13:38.225 - 17/02/09 16:30:10.352
Selected time for report: 03/02/09 14:13:38 - 17/02/09 16:30:10.352
Number of changes in configuration: 0
Number of changes to accounts, groups, or roles: 0
Number of logins: 0
Number of failed logins: 15
Number of authentications: 0
Number of failed authentications: 578
Number of users: 1
Number of terminals: 7
Number of host names: 4
Number of executables: 12
Number of files: 77
Number of AVC's: 0
Number of MAC events: 0
Number of failed syscalls: 994
Number of anomaly events: 0
Number of responses to anomaly events: 0
Number of crypto events: 0
Number of keys: 2
Number of process IDs: 713
Number of events: 1589</pre></div></li><li class="step"><p>
     To list the files that could not be accessed, run a summary report of
     failed file events:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport</code> <code class="option">-f -i --failed --summary</code>

Failed File Summary Report
===========================
total  file
===========================
80  /var
80  spool
80  cron
80  lastrun
46  /usr/lib/locale/en_GB.UTF-8/LC_CTYPE
45  /usr/lib/locale/locale-archive
38  /usr/lib/locale/en_GB.UTF-8/LC_IDENTIFICATION
38  /usr/lib/locale/en_GB.UTF-8/LC_MEASUREMENT
38  /usr/lib/locale/en_GB.UTF-8/LC_TELEPHONE
38  /usr/lib/locale/en_GB.UTF-8/LC_ADDRESS
38  /usr/lib/locale/en_GB.UTF-8/LC_NAME
38  /usr/lib/locale/en_GB.UTF-8/LC_PAPER
38  /usr/lib/locale/en_GB.UTF-8/LC_MESSAGES
38  /usr/lib/locale/en_GB.UTF-8/LC_MONETARY
38  /usr/lib/locale/en_GB.UTF-8/LC_COLLATE
38  /usr/lib/locale/en_GB.UTF-8/LC_TIME
38  /usr/lib/locale/en_GB.UTF-8/LC_NUMERIC
8  /etc/magic.mgc
...</pre></div><p>
     To focus this summary report on a few files or directories of interest
     only, such as <code class="filename">/etc/audit/auditd.conf</code>,
     <code class="filename">/etc/pam.d</code>, and
     <code class="filename">/etc/sysconfig</code>, use a command similar to the
     following:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport -f -i --failed --summary |grep -e "/etc/audit/auditd.conf" -e "/etc/pam.d/" -e "/etc/sysconfig"</code>

1  /etc/sysconfig/displaymanager</pre></div></li><li class="step"><p>
     From the summary report, then proceed to isolate these items of
     interest from the log and find out their event IDs for further
     analysis:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">aureport -f -i --failed |grep -e "/etc/audit/auditd.conf" -e "/etc/pam.d/" -e "/etc/sysconfig"</code>

993. 17/02/09 16:47:34 /etc/sysconfig/displaymanager readlink no /bin/vim-normal root 7887
994. 17/02/09 16:48:23 /etc/sysconfig/displaymanager getxattr no /bin/vim-normal root 7889</pre></div></li><li class="step"><p>
     Use the event ID to get a detailed record for each item of interest:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ausearch -a</code> <em class="replaceable">7887</em> -i
----
time-&gt;Tue Feb 17 16:48:23 2009
type=PATH msg=audit(1234885703.090:7889): item=0 name="/etc/sysconfig/displaymanager" inode=369282 dev=08:06 mode=0100644 ouid=0 ogid=0 rdev=00:00
type=CWD msg=audit(1234885703.090:7889):  cwd="/root"
type=SYSCALL msg=audit(1234885703.090:7889): arch=c000003e syscall=191 success=no exit=-61 a0=7e1e20 a1=7f90e4cf9187 a2=7fffed5b57d0 a3=84 items=1 ppid=25548 pid=23045 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts2 ses=1166 comm="vim" exe="/bin/vim-normal" key=(null)</pre></div></li></ol></div></div><div id="id-1.7.9.4.11.7" data-id-title="Focusing on a certain time frame" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Focusing on a certain time frame</div><p>
    If you are interested in events during a particular period of time, trim
    down the reports by using start and end dates and times with your
    <code class="command">aureport</code> commands (<code class="option">-ts</code> and
    <code class="option">-te</code>). For more information, refer to
    <a class="xref" href="#sec-audit-aureport-gen" title="41.5.2. Generating custom audit reports">Section 41.5.2, “Generating custom audit reports”</a>.
   </p></div><p>
   All steps (except for the last one) can be run automatically and would
   easily be scriptable and configured as cron jobs. Any of the
   <code class="literal">--failed --summary</code> reports could be transformed easily
   into a bar chart that plots files versus failed access attempts. For more
   information about visualizing audit report data, refer to
   <a class="xref" href="#sec-audit-viz" title="42.6. Configuring log visualization">Section 42.6, “Configuring log visualization”</a>.
  </p></section><section class="sect1" id="sec-audit-viz" data-id-title="Configuring log visualization"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">42.6 </span><span class="title-name">Configuring log visualization</span></span> <a title="Permalink" class="permalink" href="#sec-audit-viz">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_setup.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Using the scripts <code class="command">mkbar</code> and <code class="command">mkgraph</code>
   you can illustrate your audit statistics with various graphs and charts.
   As with any other <code class="command">aureport</code> command, the plotting
   commands are scriptable and can easily be configured to run as cron jobs.
  </p><p>
   <code class="command">mkbar</code> and <code class="command">mkgraph</code> were created by
   Steve Grubb at Red Hat. They are available from
   <a class="link" href="http://people.redhat.com/sgrubb/audit/visualize/" target="_blank">http://people.redhat.com/sgrubb/audit/visualize/</a>.
   Because the current version of audit in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> does not ship
   with these scripts, proceed as follows to make them available on your
   system:
  </p><div id="id-1.7.9.4.12.4" data-id-title="Downloaded content is dangerous" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Downloaded content is dangerous</div><p>
    Use <code class="command">mkbar</code> and <code class="command">mkgraph</code> at your own
    risk. Any content downloaded from the Web is potentially dangerous
    to your system, even more so when run with <code class="systemitem">root</code> privileges.
   </p></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Download the scripts to <code class="systemitem">root</code>'s <code class="filename">~/bin</code>
     directory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> wget http://people.redhat.com/sgrubb/audit/visualize/mkbar -O ~/bin/mkbar
<code class="prompt user">&gt; </code><code class="command">sudo</code> wget http://people.redhat.com/sgrubb/audit/visualize/mkgraph -O ~/bin/mkgraph</pre></div></li><li class="step"><p>
     Adjust the file permissions to read, write, and execute for
     <code class="systemitem">root</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> chmod 744 ~/bin/mk{bar,graph}</pre></div></li></ol></div></div><p>
   To plot summary reports, such as the ones discussed in
   <a class="xref" href="#sec-audit-aurepo" title="42.5. Configuring audit reports">Section 42.5, “Configuring audit reports”</a>, use the script
   <code class="command">mkbar</code>. Some example commands could look like the
   following:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.4.12.7.1"><span class="term">Create a summary of events</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aureport -e -i --summary | mkbar events</pre></div></dd><dt id="id-1.7.9.4.12.7.2"><span class="term">Create a summary of file events</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aureport -f -i --summary | mkbar files</pre></div></dd><dt id="id-1.7.9.4.12.7.3"><span class="term">Create a summary of login events</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aureport -l -i --summary | mkbar login</pre></div></dd><dt id="id-1.7.9.4.12.7.4"><span class="term">Create a summary of user events</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aureport -u -i --summary | mkbar users</pre></div></dd><dt id="id-1.7.9.4.12.7.5"><span class="term">Create a summary of system call events</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> aureport -s -i --summary | mkbar syscalls</pre></div></dd></dl></div><p>
   To create a summary chart of failed events of any of the above event
   types, add the <code class="option">--failed</code> option to the respective
   <code class="command">aureport</code> command. To cover a certain period of time
   only, use the <code class="option">-ts</code> and <code class="option">-te</code> options on
   aureport. Any of these commands can be tweaked further by narrowing down
   its scope using grep or egrep and regular expressions. See the comments
   in the <code class="command">mkbar</code> script for an example. Any of the above
   commands produces a PNG file containing a bar chart of the requested
   data.
  </p><p>
   To illustrate the relationship between different kinds of audit objects,
   such as users and system calls, use the script
   <code class="command">mkgraph</code>. Some example commands could look like the
   following:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.4.12.10.1"><span class="term">Users versus executables</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> LC_ALL=C aureport -u -i | awk '/^[0-9]/ { print $4" "$7 }' | sort | uniq | mkgraph users_vs_exec</pre></div></dd><dt id="id-1.7.9.4.12.10.2"><span class="term">Users versus files</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> LC_ALL=C aureport -f -i | awk '/^[0-9]/ { print $8" "$4 }' | sort | uniq | mkgraph users_vs_files</pre></div></dd><dt id="id-1.7.9.4.12.10.3"><span class="term">System calls versus commands</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> LC_ALL=C aureport -s -i | awk '/^[0-9]/ { print $4" "$6 }' | sort | uniq | mkgraph syscall_vs_com</pre></div></dd><dt id="id-1.7.9.4.12.10.4"><span class="term">System calls versus files</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> LC_ALL=C aureport -s -i | awk '/^[0-9]/ { print $5" "$4 }' | sort | uniq | mkgraph | syscall_vs_file</pre></div></dd></dl></div><p>
   Graphs can also be combined to illustrate complex relationships. See the
   comments in the <code class="command">mkgraph</code> script for further information
   and an example. The graphs produced by this script are created in
   PostScript format by default, but you can change the output format by
   changing the <code class="envar">EXT</code> variable in the script from
   <code class="literal">ps</code> to <code class="literal">png</code> or
   <code class="literal">jpg</code>.
  </p></section></section><section class="chapter" id="cha-audit-scenarios" data-id-title="Introducing an audit rule set"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">43 </span><span class="title-name">Introducing an audit rule set</span></span> <a title="Permalink" class="permalink" href="#cha-audit-scenarios">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following example configuration illustrates how audit can be used to
  monitor your system. It highlights the most important items that need to
  be audited to cover the list of auditable events specified by Controlled
  Access Protection Profile (CAPP).
 </p><p>
  The example rule set is divided into the following sections:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Basic audit configuration (see <a class="xref" href="#sec-audit-scenbasic" title="43.1. Adding basic audit configuration parameters">Section 43.1, “Adding basic audit configuration parameters”</a>)
   </p></li><li class="listitem"><p>
    Watches on audit log files and configuration files (see
    <a class="xref" href="#sec-audit-scenauconf" title="43.2. Adding watches on audit log files and configuration files">Section 43.2, “Adding watches on audit log files and configuration files”</a>)
   </p></li><li class="listitem"><p>
    Monitoring operations on file system objects (see
    <a class="xref" href="#sec-audit-scenfs" title="43.3. Monitoring file system objects">Section 43.3, “Monitoring file system objects”</a>)
   </p></li><li class="listitem"><p>
    Monitoring security databases (see
    <a class="xref" href="#sec-audit-scensecurity" title="43.4. Monitoring security configuration files and databases">Section 43.4, “Monitoring security configuration files and databases”</a>)
   </p></li><li class="listitem"><p>
    Monitoring miscellaneous system calls
    (<a class="xref" href="#sec-audit-scenmisc" title="43.5. Monitoring miscellaneous system calls">Section 43.5, “Monitoring miscellaneous system calls”</a>)
   </p></li><li class="listitem"><p>
    Filtering system call arguments (see
    <a class="xref" href="#sec-audit-scenipc" title="43.6. Filtering system call arguments">Section 43.6, “Filtering system call arguments”</a>)
   </p></li></ul></div><p>
  To transform this example into a configuration file to use in your live
  setup, proceed as follows:
 </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
    Choose the appropriate settings for your setup and adjust them.
   </p></li><li class="step"><p>
    Adjust the file <code class="filename">/etc/audit/audit.rules</code> by adding
    rules from the examples below or by modifying existing rules.
   </p></li></ol></div></div><div id="id-1.7.9.5.8" data-id-title="Adjusting the level of audit logging" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Adjusting the level of audit logging</div><p>
   Do not copy the example below into your audit setup without adjusting it
   to your needs. Determine what and to what extent to audit.
  </p></div><p>
  The entire <code class="filename">audit.rules</code> is a collection of
  <code class="command">auditctl</code> commands. Every line in this file expands to a
  full <code class="command">auditctl</code> command line. The syntax used in the rule
  set is the same as that of the <code class="command">auditctl</code> command.
 </p><section class="sect1" id="sec-audit-scenbasic" data-id-title="Adding basic audit configuration parameters"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">43.1 </span><span class="title-name">Adding basic audit configuration parameters</span></span> <a title="Permalink" class="permalink" href="#sec-audit-scenbasic">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><div class="verbatim-wrap"><pre class="screen">-D<span class="callout" id="co-auctld">1</span>
-b 8192<span class="callout" id="co-auctlb">2</span>
-f 2<span class="callout" id="co-auctlf">3</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctld"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Delete any preexisting rules before starting to define new ones.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctlb"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Set the number of buffers to take the audit messages. Depending on the
     level of audit logging on your system, increase or decrease this
     figure.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctlf"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Set the failure flag to use when the kernel needs to handle critical
     errors. Possible values are <code class="literal">0</code> (silent),
     <code class="literal">1</code> (printk, print a failure message), and
     <code class="literal">2</code> (panic, halt the system).
    </p></td></tr></table></div><p>
   By emptying the rule queue with the <code class="option">-D</code> option, you make
   sure that audit does not use any other rule set than what you are
   offering it by means of this file. Choosing an appropriate buffer number
   (<code class="option">-b</code>) is vital to avoid having your system fail because
   of too high an audit load. Choosing the panic failure flag <code class="option">-f
   2</code> ensures that your audit records are complete even if the
   system is encountering critical errors. By shutting down the system on a
   critical error, audit makes sure that no process escapes from its control
   as it otherwise might if level 1 (<code class="option">printk</code>) were chosen.
  </p><div id="id-1.7.9.5.10.5" data-id-title="Choosing the failure flag" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Choosing the failure flag</div><p>
    Before using your audit rule set on a live system, make sure that the
    setup has been thoroughly evaluated on test systems using the
    <span class="emphasis"><em>worst case production workload</em></span>. It is even more
    critical that you do this when specifying the <code class="option">-f 2</code>
    flag, because this instructs the kernel to panic (perform an immediate
    halt without flushing pending data to disk) if any thresholds are
    exceeded. Consider the use of the <code class="option">-f 2</code> flag for only
    the most security-conscious environments.
   </p></div></section><section class="sect1" id="sec-audit-scenauconf" data-id-title="Adding watches on audit log files and configuration files"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">43.2 </span><span class="title-name">Adding watches on audit log files and configuration files</span></span> <a title="Permalink" class="permalink" href="#sec-audit-scenauconf">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Adding watches on your audit configuration files and the log files
   themselves ensures that you can track any attempt to tamper with the
   configuration files or detect any attempted accesses to the log files.
  </p><div id="id-1.7.9.5.11.3" data-id-title="Creating directory and file watches" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Creating directory and file watches</div><p>
    Creating watches on a directory is not necessarily sufficient if you
    need events for file access. Events on directory access are only
    triggered when the directory's inode is updated with metadata changes.
    To trigger events on file access, add watches for each file
    to monitor.
   </p></div><div class="verbatim-wrap"><pre class="screen">-w /var/log/audit/ <span class="callout" id="co-auctllog">1</span>
-w /var/log/audit/audit.log

-w /var/log/audit/audit_log.1
-w /var/log/audit/audit_log.2
-w /var/log/audit/audit_log.3
-w /var/log/audit/audit_log.4

-w /etc/audit/auditd.conf -p wa<span class="callout" id="co-auctlconf">2</span>
-w /etc/audit/audit.rules -p wa
-w /etc/libaudit.conf -p wa</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctllog"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Set a watch on the directory where the audit log is located. Trigger an
     event for any type of access attempt to this directory. If you are
     using log rotation, add watches for the rotated logs as well.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctlconf"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Set a watch on an audit configuration file. Log all write and attribute
     change attempts to this file.
    </p></td></tr></table></div></section><section class="sect1" id="sec-audit-scenfs" data-id-title="Monitoring file system objects"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">43.3 </span><span class="title-name">Monitoring file system objects</span></span> <a title="Permalink" class="permalink" href="#sec-audit-scenfs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Auditing system calls helps track your system's activity well beyond the
   application level. By tracking file system–related system calls,
   get an idea of how your applications are using these system calls and
   determine whether that use is appropriate. By tracking mount and unmount
   operations, track the use of external resources (removable media, remote
   file systems, etc.).
  </p><div id="id-1.7.9.5.12.3" data-id-title="Auditing system calls" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Auditing system calls</div><p>
    Auditing system calls results in a high logging activity. This activity,
    in turn, puts a heavy load on the kernel. With a kernel less responsive
    than usual, the system's backlog and rate limits might be exceeded.
    Carefully evaluate which system calls to include in your audit rule set
    and adjust the log settings accordingly. See
    <a class="xref" href="#sec-audit-auditd" title="41.2. Configuring the audit daemon">Section 41.2, “Configuring the audit daemon”</a> for details on how to tweak the
    relevant settings.
   </p></div><div class="verbatim-wrap"><pre class="screen">-a entry,always -S chmod -S fchmod -S chown -S chown32 -S fchown -S fchown32 -S lchown -S lchown32<span class="callout" id="co-auctlfso">1</span>

-a entry,always -S creat -S open -S truncate -S truncate64 -S ftruncate -S ftruncate64<span class="callout" id="co-auctlmod">2</span>

-a entry,always -S mkdir -S rmdir<span class="callout" id="co-auctlfsdir">3</span>

-a entry,always -S unlink -S rename -S link -S symlink<span class="callout" id="co-auctlfsmov">4</span>

-a entry,always -S setxattr<span class="callout" id="co-auctlfsea">5</span>
-a entry,always -S lsetxattr
-a entry,always -S fsetxattr
-a entry,always -S removexattr
-a entry,always -S lremovexattr
-a entry,always -S fremovexattr

-a entry,always -S mknod<span class="callout" id="co-auctlfssf">6</span>

-a entry,always -S mount -S umount -S umount2<span class="callout" id="co-auctlfsfso">7</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctlfso"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Enable an audit context for system calls related to changing file
     ownership and permissions. Depending on the hardware architecture of
     your system, enable or disable the <code class="literal">*32</code> rules. 64-bit
     systems, like AMD64/Intel 64, require the <code class="literal">*32</code> rules
     to be removed.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctlmod"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Enable an audit context for system calls related to file content
     modification. Depending on the hardware architecture of your system,
     enable or disable the *64 rules. 64-bit systems, like AMD64/Intel 64,
     require the *64 rules to be removed.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctlfsdir"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Enable an audit context for any directory operation, like creating or
     removing a directory.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctlfsmov"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Enable an audit context for any linking operation, such as creating a
     symbolic link, creating a link, unlinking, or renaming.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctlfsea"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Enable an audit context for any operation related to extended file
     system attributes.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctlfssf"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Enable an audit context for the <code class="command">mknod</code> system call,
     which creates special (device) files.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-auctlfsfso"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Enable an audit context for any mount or umount operation. For the
     x86 architecture, disable the <code class="literal">umount</code> rule. For
     the Intel 64 architecture, disable the <code class="literal">umount2</code> rule.
    </p></td></tr></table></div></section><section class="sect1" id="sec-audit-scensecurity" data-id-title="Monitoring security configuration files and databases"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">43.4 </span><span class="title-name">Monitoring security configuration files and databases</span></span> <a title="Permalink" class="permalink" href="#sec-audit-scensecurity">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To make sure that your system is not made to do undesired things, track
   any attempts to change the <code class="systemitem">cron</code> and
   <code class="systemitem">at</code> configurations or the lists of scheduled
   jobs. Tracking any write access to the user, group, password and login
   databases and logs helps you identify any attempts to manipulate your
   system's user database.
  </p><p>
   Tracking changes to your system configuration (kernel, services, time,
   etc.) helps you spot any attempts of others to manipulate essential
   functionality of your system. Changes to the PAM configuration should
   also be monitored in a secure environment, because changes in the
   authentication stack should not be made by anyone other than the
   administrator, and it should be logged which applications are using PAM
   and how it is used. The same applies to any other configuration files
   related to secure authentication and communication.
  </p><div class="verbatim-wrap"><pre class="screen"><span class="callout" id="co-audit-at">1</span>
-w /var/spool/atspool
-w /etc/at.allow
-w /etc/at.deny

-w /etc/cron.allow -p wa
-w /etc/cron.deny -p wa
-w /etc/cron.d/ -p wa
-w /etc/cron.daily/ -p wa
-w /etc/cron.hourly/ -p wa
-w /etc/cron.monthly/ -p wa
-w /etc/cron.weekly/ -p wa
-w /etc/crontab -p wa
-w /var/spool/cron/root

<span class="callout" id="co-audit-security">2</span>
-w /etc/group -p wa
-w /etc/passwd -p wa
-w /etc/shadow

-w /etc/login.defs -p wa
-w /etc/securetty
-w /var/log/lastlog

<span class="callout" id="co-audit-nw">3</span>
-w /etc/hosts -p wa
-w /etc/sysconfig/
w /etc/init.d/
w /etc/ld.so.conf -p wa
w /etc/localtime -p wa
w /etc/sysctl.conf -p wa
w /etc/modprobe.d/
w /etc/modprobe.conf.local -p wa
w /etc/modprobe.conf -p wa
<span class="callout" id="co-audit-pam">4</span>
w /etc/pam.d/
<span class="callout" id="co-audit-pfix">5</span>
-w /etc/aliases -p wa
-w /etc/postfix/ -p wa

<span class="callout" id="co-audit-ssh">6</span>
-w /etc/ssh/sshd_config

-w /etc/stunnel/stunnel.conf
-w /etc/stunnel/stunnel.pem

-w /etc/vsftpd.ftpusers
-w /etc/vsftpd.conf

<span class="callout" id="co-audit-misc">7</span>
-a exit,always -S sethostname
-w /etc/issue -p wa
-w /etc/issue.net -p wa</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-at"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Set watches on the <code class="systemitem">at</code> and
     <code class="systemitem">cron</code> configuration and the scheduled jobs and
     assign labels to these events.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-security"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Set watches on the user, group, password, and login databases and logs
     and set labels to better identify any login-related events, such as
     failed login attempts.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-nw"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Set a watch and a label on the static host name configuration in
     <code class="filename">/etc/hosts</code>. Track changes to the system
     configuration directory, <code class="filename">/etc/sysconfig</code>. Enable
     per-file watches if you are interested in file events. Set watches and
     labels for changes to the boot configuration in

     the <code class="filename">/etc/init.d</code> directory. Enable per-file watches
     if you are interested in file events. Set watches and labels for any
     changes to the linker configuration in
     <code class="filename">/etc/ld.so.conf</code>. Set watches and a label for
     <code class="filename">/etc/localtime</code>. Set watches and labels for the
     kernel configuration files <code class="filename">/etc/sysctl.conf</code>,
     <code class="filename">/etc/modprobe.d/</code>,
     <code class="filename">/etc/modprobe.conf.local</code>, and
     <code class="filename">/etc/modprobe.conf</code>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-pam"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Set watches on the PAM configuration directory. If you are interested
     in particular files below the directory level, add explicit watches to
     these files as well.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-pfix"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Set watches to the postfix configuration to log any write attempt or
     attribute change and use labels for better tracking in the logs.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-ssh"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Set watches and labels on the SSH,
     <code class="command">stunnel</code>, and <code class="command">vsftpd</code> configuration
     files.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-misc"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Perform an audit of the <code class="systemitem">sethostname</code> system call and
     set watches and labels on the system identification configuration in
     <code class="filename">/etc/issue</code> and
     <code class="filename">/etc/issue.net</code>.
    </p></td></tr></table></div></section><section class="sect1" id="sec-audit-scenmisc" data-id-title="Monitoring miscellaneous system calls"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">43.5 </span><span class="title-name">Monitoring miscellaneous system calls</span></span> <a title="Permalink" class="permalink" href="#sec-audit-scenmisc">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Apart from auditing file system related system calls, as described in
   <a class="xref" href="#sec-audit-scenfs" title="43.3. Monitoring file system objects">Section 43.3, “Monitoring file system objects”</a>, you can also track various other
   system calls. Tracking task creation helps you understand your
   applications' behavior. Auditing the <code class="systemitem">umask</code>
   system call lets you track how processes modify creation mask. Tracking
   any attempts to change the system time helps you identify anyone or any
   process trying to manipulate the system time.
  </p><div class="verbatim-wrap"><pre class="screen"><span class="callout" id="co-audit-attrib">1</span>
-a entry,always -S clone -S fork -S vfork

<span class="callout" id="co-audit-umask">2</span>
-a entry,always -S umask

<span class="callout" id="co-audit-time">3</span>
-a entry,always -S adjtimex -S settimeofday</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-attrib"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Track task creation.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-umask"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Add an audit context to the umask system call.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-time"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Track attempts to change the system time. <code class="literal">adjtimex</code>
     can be used to skew the time. <code class="literal">settimeofday</code> sets the
     absolute time.
    </p></td></tr></table></div></section><section class="sect1" id="sec-audit-scenipc" data-id-title="Filtering system call arguments"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">43.6 </span><span class="title-name">Filtering system call arguments</span></span> <a title="Permalink" class="permalink" href="#sec-audit-scenipc">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In addition to the system call auditing introduced in
   <a class="xref" href="#sec-audit-scenfs" title="43.3. Monitoring file system objects">Section 43.3, “Monitoring file system objects”</a> and
   <a class="xref" href="#sec-audit-scenmisc" title="43.5. Monitoring miscellaneous system calls">Section 43.5, “Monitoring miscellaneous system calls”</a>, you can track application behavior
   to an even higher degree. Applying filters helps you focus audit on areas
   of primary interest to you. This section introduces filtering system call
   arguments for non-multiplexed system calls like access and for
   multiplexed ones like socketcall or ipc. Whether system calls are
   multiplexed depends on the hardware architecture used. Both socketcall
   and ipc are not multiplexed on 64-bit architectures, such as AMD64/Intel 64.
  </p><div id="id-1.7.9.5.15.3" data-id-title="Auditing system calls" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Auditing system calls</div><p>
    Auditing system calls results in high logging activity, which in turn
    puts a heavy load on the kernel. With a kernel less responsive than
    usual, the system's backlog and rate limits might well be exceeded.
    Carefully evaluate which system calls to include in your audit rule set
    and adjust the log settings accordingly. See
    <a class="xref" href="#sec-audit-auditd" title="41.2. Configuring the audit daemon">Section 41.2, “Configuring the audit daemon”</a> for details on how to tweak the
    relevant settings.
   </p></div><p>
   The access system call checks whether a process would be allowed to read,
   write or test for the existence of a file or file system object. Using
   the <code class="option">-F</code> filter flag, build rules matching specific access
   calls in the format<code class="option">-F
   a1=<em class="replaceable">ACCESS_MODE</em></code>. Check
   <code class="filename">/usr/include/fcntl.h</code> for a list of possible
   arguments to the access system call.
  </p><div class="verbatim-wrap"><pre class="screen">-a entry,always -S access -F a1=4<span class="callout" id="co-audit-accessr">1</span>
-a entry,always -S access -F a1=6<span class="callout" id="co-audit-accessrw">2</span>
-a entry,always -S access -F a1=7<span class="callout" id="co-audit-accessrwx">3</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-accessr"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Audit the access system call, but only if the second argument of the
     system call (<code class="literal">mode</code>) is <code class="literal">4</code>
     (<code class="literal">R_OK</code>). This rule filters for all access calls
     testing for sufficient read permissions to a file or file system object
     accessed by a user or process.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-accessrw"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Audit the access system call, but only if the second argument of the
     system call (<code class="literal">mode</code>) is <code class="literal">6</code>, meaning
     <code class="literal">4 OR 2</code>, which translates to <code class="literal">R_OK OR
     W_OK</code>. This rule filters for access calls testing for
     sufficient read and write permissions.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-accessrwx"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Audit the access system call, but only if the second argument of the
     system call (<code class="literal">mode</code>) is <code class="literal">7</code>, meaning
     <code class="literal">4 OR 2 OR 1</code>, which translates to <code class="literal">R_OK OR
     W_OK OR X_OK</code>. This rule filters for access calls testing for
     sufficient read, write, and execute permissions.
    </p></td></tr></table></div><p>
   The socketcall system call is a multiplexed system call. Multiplexed
   means that there is only one system call for all possible calls and that
   libc passes the actual system call to use as the first argument
   (<code class="literal">a0</code>). Check the manual page of socketcall for possible
   system calls and refer to
   <code class="filename">/usr/src/linux/include/linux/net.h</code> for a list of
   possible argument values and system call names. Audit supports filtering
   for specific system calls using a <code class="option">-F
   a0=<em class="replaceable">SYSCALL_NUMBER</em></code>.
  </p><div class="verbatim-wrap"><pre class="screen">-a entry,always -S socketcall -F a0=1 -F a1=10<span class="callout" id="co-audit-socket1">1</span>
## Use this line on x86_64, ia64 instead
#-a entry,always -S socket -F a0=10

-a entry,always -S socketcall -F a0=5<span class="callout" id="co-audit-socket2">2</span>
## Use this line on x86_64, ia64 instead
#-a entry, always -S accept</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-socket1"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Audit the socket(PF_INET6) system call. The <code class="option">-F a0=1</code>
     filter matches all socket system calls and the <code class="option">-F
     a1=10</code> filter narrows the matches down to socket system calls
     carrying the IPv6 protocol family domain parameter (PF_INET6). Check
     <code class="filename">/usr/include/linux/net.h</code> for the first argument
     (<code class="literal">a0</code>) and
     <code class="filename">/usr/src/linux/include/linux/socket.h</code> for the
     second parameter (<code class="literal">a1</code>). 64-bit platforms, like
     AMD64/Intel 64, do not use multiplexing on socketcall system calls. For
     these
     platforms, comment the rule and add the plain system call rules with a
     filter on PF_INET6.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-socket2"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Audit the socketcall system call. The filter flag is set to filter for
     <code class="option">a0=5</code> as the first argument to socketcall, which
     translates to the accept system call if you check
     <code class="filename">/usr/include/linux/net.h</code>. 64-bit platforms, like
     AMD64/Intel 64, do not use multiplexing on socketcall system calls.
     For these platforms, comment the rule and add the plain system call
     rule without argument filtering.
    </p></td></tr></table></div><p>
   The ipc system call is another example of multiplexed system calls. The
   actual call to invoke is determined by the first argument passed to the
   ipc system call. Filtering for these arguments helps you focus on those
   IPC calls of interest to you. Check
   <code class="filename">/usr/include/linux/ipc.h</code> for possible argument
   values.
  </p><div class="verbatim-wrap"><pre class="screen"><span class="callout" id="co-audit-mqueue">1</span>
## msgctl
-a entry,always -S ipc -F a0=14
## msgget
-a entry,always -S ipc -F a0=13
## Use these lines on x86_64, ia64 instead
#-a entry,always -S msgctl
#-a entry,always -S msgget

<span class="callout" id="co-audit-semaph">2</span>
## semctl
-a entry,always -S ipc -F a0=3
## semget
-a entry,always -S ipc -F a0=2
## semop
-a entry,always -S ipc -F a0=1
## semtimedop
-a entry,always -S ipc -F a0=4
## Use these lines on x86_64, ia64 instead
#-a entry,always -S semctl
#-a entry,always -S semget
#-a entry,always -S semop
#-a entry,always -S semtimedop

<span class="callout" id="co-audit-sharedmem">3</span>
## shmctl
-a entry,always -S ipc -F a0=24
## shmget
-a entry,always -S ipc -F a0=23
## Use these lines on x86_64, ia64 instead
#-a entry,always -S shmctl
#-a entry,always -S shmget</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-mqueue"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Audit system calls related to IPC SYSV message queues. In this case,
     the <code class="literal">a0</code> values specify that auditing is added for the
     msgctl and msgget system calls (<code class="literal">14</code> and
     <code class="literal">13</code>). 64-bit platforms, like AMD64/Intel 64, do not
     use multiplexing on ipc system calls. For these platforms, comment the
     first two rules and add the plain system call rules without argument
     filtering.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-semaph"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Audit system calls related to IPC SYSV message semaphores. In this
     case, the <code class="literal">a0</code> values specify that auditing is added
     for the semctl, semget, semop, and semtimedop system calls
     (<code class="literal">3</code>, <code class="literal">2</code>, <code class="literal">1</code>, and
     <code class="literal">4</code>). 64-bit platforms, like AMD64/Intel 64, do not
     use multiplexing on ipc system calls. For these platforms, comment the
     first four rules and add the plain system call rules without argument
     filtering.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-audit-sharedmem"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     Audit system calls related to IPC SYSV shared memory. In this case, the
     <code class="literal">a0</code> values specify that auditing is added for the
     shmctl and shmget system calls (<code class="literal">24</code>,
     <code class="literal">23</code>). 64-bit platforms, like AMD64/Intel 64, do not
     use multiplexing on ipc system calls. For these platforms, comment the
     first two rules and add the plain system call rules without argument
     filtering.
    </p></td></tr></table></div></section><section class="sect1" id="sec-audit-scenkeys" data-id-title="Managing audit event records using keys"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">43.7 </span><span class="title-name">Managing audit event records using keys</span></span> <a title="Permalink" class="permalink" href="#sec-audit-scenkeys">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_scenarios.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   After configuring a few rules generating events and populating the logs,
   you need to find a way to tell one event from the other. Using the
   <code class="command">ausearch</code> command, you can filter the logs for various
   criteria. Using <code class="command">ausearch</code> <code class="option">-m
   <em class="replaceable">MESSAGE_TYPE</em></code>, you can at least filter
   for events of a certain type. However, to be able to filter for events
   related to a particular rule, you need to add a key to this rule in the
   <code class="filename">/etc/audit/audit.rules</code> file. This key is then added
   to the event record every time the rule logs an event. To retrieve these
   log entries, simply run <code class="command">ausearch</code> <code class="option">-k
   <em class="replaceable">YOUR_KEY</em></code> to get a list of records
   related to the rule carrying this particular key.
  </p><p>
   As an example, assume you have added the following rule to your rule
   file:
  </p><div class="verbatim-wrap"><pre class="screen">-w /etc/audit/audit.rules -p wa</pre></div><p>
   Without a key assigned to it, you would probably need to filter for
   <code class="literal">SYSCALL</code> or <code class="literal">PATH</code> events then use
   grep or similar tools to isolate any events related to the above rule.
   Now, add a key to the above rule, using the <code class="option">-k</code> option:
  </p><div class="verbatim-wrap"><pre class="screen">-w /etc/audit/audit.rules -p wa -k CFG_audit.rules</pre></div><p>
   You can specify any text string as key. Distinguish watches related to
   different types of files (configuration files or log files) from one
   another using different key prefixes (<code class="literal">CFG</code>,
   <code class="literal">LOG</code>, etc.) followed by the file name. Finding any
   records related to the above rule now comes down to the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="command">ausearch -k CFG_audit.rules</code>
----
time-&gt;Thu Feb 19 09:09:54 2009
type=PATH msg=audit(1235030994.032:8649): item=3 name="audit.rules~" inode=370603 dev=08:06 mode=0100640 ouid=0 ogid=0 rdev=00:00
type=PATH msg=audit(1235030994.032:8649): item=2 name="audit.rules" inode=370603 dev=08:06 mode=0100640 ouid=0 ogid=0 rdev=00:00
type=PATH msg=audit(1235030994.032:8649): item=1  name="/etc/audit" inode=368599 dev=08:06 mode=040750 ouid=0 ogid=0 rdev=00:00
type=PATH msg=audit(1235030994.032:8649): item=0  name="/etc/audit" inode=368599 dev=08:06 mode=040750 ouid=0 ogid=0 rdev=00:00
type=CWD msg=audit(1235030994.032:8649):  cwd="/etc/audit"
type=SYSCALL msg=audit(1235030994.032:8649): arch=c000003e syscall=82 success=yes exit=0 a0=7deeb0 a1=883b30 a2=2 a3=ffffffffffffffff items=4 ppid=25400 pid=32619 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts1 ses=1164 comm="vim" exe="/bin/vim-normal" key="CFG_audit.rules"</pre></div></section></section><section class="chapter" id="cha-audit-moreinfo" data-id-title="Useful resources"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">44 </span><span class="title-name">Useful resources</span></span> <a title="Permalink" class="permalink" href="#cha-audit-moreinfo">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/audit_moreinfo.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  There are other resources available containing valuable information about
  the Linux audit framework:
 </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.6.4.1"><span class="term">The audit manual pages</span></dt><dd><p>
     There are several man pages installed along with the audit tools that
     provide valuable and very detailed information:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.9.6.4.1.2.2.1"><span class="term"><code class="literal">auditd(8)</code>
      </span></dt><dd><p>
        The Linux audit daemon
       </p></dd><dt id="id-1.7.9.6.4.1.2.2.2"><span class="term"><code class="literal">auditd.conf(5)</code>
      </span></dt><dd><p>
        The Linux audit daemon configuration file
       </p></dd><dt id="id-1.7.9.6.4.1.2.2.3"><span class="term"><code class="literal">auditctl(8)</code>
      </span></dt><dd><p>
        A utility to assist controlling the kernel's audit system
       </p></dd><dt id="id-1.7.9.6.4.1.2.2.4"><span class="term"><code class="literal">autrace(8)</code>
      </span></dt><dd><p>
        A program similar to <code class="command">strace</code>
       </p></dd><dt id="id-1.7.9.6.4.1.2.2.5"><span class="term"><code class="literal">ausearch(8)</code>
      </span></dt><dd><p>
        A tool to query audit daemon logs
       </p></dd><dt id="id-1.7.9.6.4.1.2.2.6"><span class="term"><code class="literal">aureport(8)</code>
      </span></dt><dd><p>
        A tool that produces summary reports of audit daemon logs
       </p></dd></dl></div></dd><dt id="id-1.7.9.6.4.2"><span class="term"><a class="link" href="http://people.redhat.com/sgrubb/audit/index.html" target="_blank">http://people.redhat.com/sgrubb/audit/index.html</a>
   </span></dt><dd><p>
     The home page of the Linux audit project. This site contains several
     specifications relating to different aspects of Linux audit, and
     a short FAQ.
    </p></dd><dt id="id-1.7.9.6.4.3"><span class="term"><code class="filename">/usr/share/doc/packages/audit </code>
   </span></dt><dd><p>
     The audit package itself contains a README with basic design
     information and sample <code class="filename">.rules </code> files for different
     scenarios:
    </p><table style="border: 0; " class="simplelist"><tr><td><code class="filename">capp.rules</code>: Controlled Access Protection Profile (CAPP)</td></tr><tr><td><code class="filename">lspp.rules</code>: Labeled Security Protection Profile (LSPP)</td></tr><tr><td><code class="filename">nispom.rules</code>: National Industrial Security Program Operating
      Manual Chapter 8(NISPOM)</td></tr><tr><td><code class="filename">stig.rules</code>: Secure Technical Implementation Guide (STIG)</td></tr></table></dd><dt id="id-1.7.9.6.4.4"><span class="term"><a class="link" href="https://www.commoncriteriaportal.org/" target="_blank">https://www.commoncriteriaportal.org/</a>
   </span></dt><dd><p>
     The official Web site of the Common Criteria project. Learn all about
     the Common Criteria security certification initiative and which role
     audit plays in this framework.
    </p></dd></dl></div></section></div><div class="legal-section"><section class="appendix" id="id-1.7.10" data-id-title="GNU licenses"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">A </span><span class="title-name">GNU licenses</span></span> <a title="Permalink" class="permalink" href="#id-1.7.10">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_legal.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This appendix contains the GNU Free Documentation License version 1.2.
 </p><section class="sect1" id="id-1.7.10.4" data-id-title="GNU Free Documentation License"><div class="titlepage"><div><div><div class="title-container"><h2 class="title legal"><span class="title-number-name"><span class="title-name">GNU Free Documentation License</span></span> <a title="Permalink" class="permalink" href="#id-1.7.10.4">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/common_license_gfdl1.2.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc. 51 Franklin St,
  Fifth Floor, Boston, MA 02110-1301 USA. Everyone is permitted to copy and
  distribute verbatim copies of this license document, but changing it is not
  allowed.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.4"><span class="name">
    0. PREAMBLE
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.4">#</a></h5></div><p>
  The purpose of this License is to make a manual, textbook, or other
  functional and useful document "free" in the sense of freedom: to assure
  everyone the effective freedom to copy and redistribute it, with or without
  modifying it, either commercially or non-commercially. Secondarily, this
  License preserves for the author and publisher a way to get credit for their
  work, while not being considered responsible for modifications made by
  others.
 </p><p>
  This License is a kind of "copyleft", which means that derivative works of
  the document must themselves be free in the same sense. It complements the
  GNU General Public License, which is a copyleft license designed for free
  software.
 </p><p>
  We have designed this License to use it for manuals for free software,
  because free software needs free documentation: a free program should come
  with manuals providing the same freedoms that the software does. But this
  License is not limited to software manuals; it can be used for any textual
  work, regardless of subject matter or whether it is published as a printed
  book. We recommend this License principally for works whose purpose is
  instruction or reference.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.8"><span class="name">
    1. APPLICABILITY AND DEFINITIONS
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.8">#</a></h5></div><p>
  This License applies to any manual or other work, in any medium, that
  contains a notice placed by the copyright holder saying it can be distributed
  under the terms of this License. Such a notice grants a world-wide,
  royalty-free license, unlimited in duration, to use that work under the
  conditions stated herein. The "Document", below, refers to any such manual or
  work. Any member of the public is a licensee, and is addressed as "you". You
  accept the license if you copy, modify or distribute the work in a way
  requiring permission under copyright law.
 </p><p>
  A "Modified Version" of the Document means any work containing the Document
  or a portion of it, either copied verbatim, or with modifications and/or
  translated into another language.
 </p><p>
  A "Secondary Section" is a named appendix or a front-matter section of the
  Document that deals exclusively with the relationship of the publishers or
  authors of the Document to the Document's overall subject (or to related
  matters) and contains nothing that could fall directly within that overall
  subject. (Thus, if the Document is in part a textbook of mathematics, a
  Secondary Section may not explain any mathematics.) The relationship could be
  a matter of historical connection with the subject or with related matters,
  or of legal, commercial, philosophical, ethical or political position
  regarding them.
 </p><p>
  The "Invariant Sections" are certain Secondary Sections whose titles are
  designated, as being those of Invariant Sections, in the notice that says
  that the Document is released under this License. If a section does not fit
  the above definition of Secondary then it is not allowed to be designated as
  Invariant. The Document may contain zero Invariant Sections. If the Document
  does not identify any Invariant Sections then there are none.
 </p><p>
  The "Cover Texts" are certain short passages of text that are listed, as
  Front-Cover Texts or Back-Cover Texts, in the notice that says that the
  Document is released under this License. A Front-Cover Text may be at most 5
  words, and a Back-Cover Text may be at most 25 words.
 </p><p>
  A "Transparent" copy of the Document means a machine-readable copy,
  represented in a format whose specification is available to the general
  public, that is suitable for revising the document straightforwardly with
  generic text editors or (for images composed of pixels) generic paint
  programs or (for drawings) some widely available drawing editor, and that is
  suitable for input to text formatters or for automatic translation to a
  variety of formats suitable for input to text formatters. A copy made in an
  otherwise Transparent file format whose markup, or absence of markup, has
  been arranged to thwart or discourage subsequent modification by readers is
  not Transparent. An image format is not Transparent if used for any
  substantial amount of text. A copy that is not "Transparent" is called
  "Opaque".
 </p><p>
  Examples of suitable formats for Transparent copies include plain ASCII
  without markup, Texinfo input format, LaTeX input format, SGML or XML using a
  publicly available DTD, and standard-conforming simple HTML, PostScript or
  PDF designed for human modification. Examples of transparent image formats
  include PNG, XCF and JPG. Opaque formats include proprietary formats that can
  be read and edited only by proprietary word processors, SGML or XML for which
  the DTD and/or processing tools are not generally available, and the
  machine-generated HTML, PostScript or PDF produced by some word processors
  for output purposes only.
 </p><p>
  The "Title Page" means, for a printed book, the title page itself, plus such
  following pages as are needed to hold, legibly, the material this License
  requires to appear in the title page. For works in formats which do not have
  any title page as such, "Title Page" means the text near the most prominent
  appearance of the work's title, preceding the beginning of the body of the
  text.
 </p><p>
  A section "Entitled XYZ" means a named subunit of the Document whose title
  either is precisely XYZ or contains XYZ in parentheses following text that
  translates XYZ in another language. (Here XYZ stands for a specific section
  name mentioned below, such as "Acknowledgements", "Dedications",
  "Endorsements", or "History".) To "Preserve the Title" of such a section when
  you modify the Document means that it remains a section "Entitled XYZ"
  according to this definition.
 </p><p>
  The Document may include Warranty Disclaimers next to the notice which states
  that this License applies to the Document. These Warranty Disclaimers are
  considered to be included by reference in this License, but only as regards
  disclaiming warranties: any other implication that these Warranty Disclaimers
  may have is void and has no effect on the meaning of this License.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.19"><span class="name">
    2. VERBATIM COPYING
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.19">#</a></h5></div><p>
  You may copy and distribute the Document in any medium, either commercially
  or non-commercially, provided that this License, the copyright notices, and
  the license notice saying this License applies to the Document are reproduced
  in all copies, and that you add no other conditions whatsoever to those of
  this License. You may not use technical measures to obstruct or control the
  reading or further copying of the copies you make or distribute. However, you
  may accept compensation in exchange for copies. If you distribute a large
  enough number of copies you must also follow the conditions in section 3.
 </p><p>
  You may also lend copies, under the same conditions stated above, and you may
  publicly display copies.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.22"><span class="name">
    3. COPYING IN QUANTITY
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.22">#</a></h5></div><p>
  If you publish printed copies (or copies in media that commonly have printed
  covers) of the Document, numbering more than 100, and the Document's license
  notice requires Cover Texts, you must enclose the copies in covers that
  carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the
  front cover, and Back-Cover Texts on the back cover. Both covers must also
  clearly and legibly identify you as the publisher of these copies. The front
  cover must present the full title with all words of the title equally
  prominent and visible. You may add other material on the covers in addition.
  Copying with changes limited to the covers, as long as they preserve the
  title of the Document and satisfy these conditions, can be treated as
  verbatim copying in other respects.
 </p><p>
  If the required texts for either cover are too voluminous to fit legibly, you
  should put the first ones listed (as many as fit reasonably) on the actual
  cover, and continue the rest onto adjacent pages.
 </p><p>
  If you publish or distribute Opaque copies of the Document numbering more
  than 100, you must either include a machine-readable Transparent copy along
  with each Opaque copy, or state in or with each Opaque copy a
  computer-network location from which the general network-using public has
  access to download using public-standard network protocols a complete
  Transparent copy of the Document, free of added material. If you use the
  latter option, you must take reasonably prudent steps, when you begin
  distribution of Opaque copies in quantity, to ensure that this Transparent
  copy will remain thus accessible at the stated location until at least one
  year after the last time you distribute an Opaque copy (directly or through
  your agents or retailers) of that edition to the public.
 </p><p>
  It is requested, but not required, that you contact the authors of the
  Document well before redistributing any large number of copies, to give them
  a chance to provide you with an updated version of the Document.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.27"><span class="name">
    4. MODIFICATIONS
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.27">#</a></h5></div><p>
  You may copy and distribute a Modified Version of the Document under the
  conditions of sections 2 and 3 above, provided that you release the Modified
  Version under precisely this License, with the Modified Version filling the
  role of the Document, thus licensing distribution and modification of the
  Modified Version to whoever possesses a copy of it. In addition, you must do
  these things in the Modified Version:
 </p><div class="orderedlist"><ol class="orderedlist" type="A"><li class="listitem"><p>
    Use in the Title Page (and on the covers, if any) a title distinct from
    that of the Document, and from those of previous versions (which should, if
    there were any, be listed in the History section of the Document). You may
    use the same title as a previous version if the original publisher of that
    version gives permission.
   </p></li><li class="listitem"><p>
    List on the Title Page, as authors, one or more persons or entities
    responsible for authorship of the modifications in the Modified Version,
    together with at least five of the principal authors of the Document (all
    of its principal authors, if it has fewer than five), unless they release
    you from this requirement.
   </p></li><li class="listitem"><p>
    State on the Title page the name of the publisher of the Modified Version,
    as the publisher.
   </p></li><li class="listitem"><p>
    Preserve all the copyright notices of the Document.
   </p></li><li class="listitem"><p>
    Add an appropriate copyright notice for your modifications adjacent to the
    other copyright notices.
   </p></li><li class="listitem"><p>
    Include, immediately after the copyright notices, a license notice giving
    the public permission to use the Modified Version under the terms of this
    License, in the form shown in the Addendum below.
   </p></li><li class="listitem"><p>
    Preserve in that license notice the full lists of Invariant Sections and
    required Cover Texts given in the Document's license notice.
   </p></li><li class="listitem"><p>
    Include an unaltered copy of this License.
   </p></li><li class="listitem"><p>
    Preserve the section Entitled "History", Preserve its Title, and add to it
    an item stating at least the title, year, new authors, and publisher of the
    Modified Version as given on the Title Page. If there is no section
    Entitled "History" in the Document, create one stating the title, year,
    authors, and publisher of the Document as given on its Title Page, then add
    an item describing the Modified Version as stated in the previous sentence.
   </p></li><li class="listitem"><p>
    Preserve the network location, if any, given in the Document for public
    access to a Transparent copy of the Document, and likewise the network
    locations given in the Document for previous versions it was based on.
    These may be placed in the "History" section. You may omit a network
    location for a work that was published at least four years before the
    Document itself, or if the original publisher of the version it refers to
    gives permission.
   </p></li><li class="listitem"><p>
    For any section Entitled "Acknowledgements" or "Dedications", Preserve the
    Title of the section, and preserve in the section all the substance and
    tone of each of the contributor acknowledgements and/or dedications given
    therein.
   </p></li><li class="listitem"><p>
    Preserve all the Invariant Sections of the Document, unaltered in their
    text and in their titles. Section numbers or the equivalent are not
    considered part of the section titles.
   </p></li><li class="listitem"><p>
    Delete any section Entitled "Endorsements". Such a section may not be
    included in the Modified Version.
   </p></li><li class="listitem"><p>
    Do not retitle any existing section to be Entitled "Endorsements" or to
    conflict in title with any Invariant Section.
   </p></li><li class="listitem"><p>
    Preserve any Warranty Disclaimers.
   </p></li></ol></div><p>
  If the Modified Version includes new front-matter sections or appendices that
  qualify as Secondary Sections and contain no material copied from the
  Document, you may at your option designate some or all of these sections as
  invariant. To do this, add their titles to the list of Invariant Sections in
  the Modified Version's license notice. These titles must be distinct from any
  other section titles.
 </p><p>
  You may add a section Entitled "Endorsements", provided it contains nothing
  but endorsements of your Modified Version by various parties--for example,
  statements of peer review or that the text has been approved by an
  organization as the authoritative definition of a standard.
 </p><p>
  You may add a passage of up to five words as a Front-Cover Text, and a
  passage of up to 25 words as a Back-Cover Text, to the end of the list of
  Cover Texts in the Modified Version. Only one passage of Front-Cover Text and
  one of Back-Cover Text may be added by (or through arrangements made by) any
  one entity. If the Document already includes a cover text for the same cover,
  previously added by you or by arrangement made by the same entity you are
  acting on behalf of, you may not add another; but you may replace the old
  one, on explicit permission from the previous publisher that added the old
  one.
 </p><p>
  The author(s) and publisher(s) of the Document do not by this License give
  permission to use their names for publicity for or to assert or imply
  endorsement of any Modified Version.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.34"><span class="name">
    5. COMBINING DOCUMENTS
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.34">#</a></h5></div><p>
  You may combine the Document with other documents released under this
  License, under the terms defined in section 4 above for modified versions,
  provided that you include in the combination all of the Invariant Sections of
  all of the original documents, unmodified, and list them all as Invariant
  Sections of your combined work in its license notice, and that you preserve
  all their Warranty Disclaimers.
 </p><p>
  The combined work need only contain one copy of this License, and multiple
  identical Invariant Sections may be replaced with a single copy. If there are
  multiple Invariant Sections with the same name but different contents, make
  the title of each such section unique by adding at the end of it, in
  parentheses, the name of the original author or publisher of that section if
  known, or else a unique number. Make the same adjustment to the section
  titles in the list of Invariant Sections in the license notice of the
  combined work.
 </p><p>
  In the combination, you must combine any sections Entitled "History" in the
  various original documents, forming one section Entitled "History"; likewise
  combine any sections Entitled "Acknowledgements", and any sections Entitled
  "Dedications". You must delete all sections Entitled "Endorsements".
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.38"><span class="name">
    6. COLLECTIONS OF DOCUMENTS
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.38">#</a></h5></div><p>
  You may make a collection consisting of the Document and other documents
  released under this License, and replace the individual copies of this
  License in the various documents with a single copy that is included in the
  collection, provided that you follow the rules of this License for verbatim
  copying of each of the documents in all other respects.
 </p><p>
  You may extract a single document from such a collection, and distribute it
  individually under this License, provided you insert a copy of this License
  into the extracted document, and follow this License in all other respects
  regarding verbatim copying of that document.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.41"><span class="name">
    7. AGGREGATION WITH INDEPENDENT WORKS
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.41">#</a></h5></div><p>
  A compilation of the Document or its derivatives with other separate and
  independent documents or works, in or on a volume of a storage or
  distribution medium, is called an "aggregate" if the copyright resulting from
  the compilation is not used to limit the legal rights of the compilation's
  users beyond what the individual works permit. When the Document is included
  in an aggregate, this License does not apply to the other works in the
  aggregate which are not themselves derivative works of the Document.
 </p><p>
  If the Cover Text requirement of section 3 is applicable to these copies of
  the Document, then if the Document is less than one half of the entire
  aggregate, the Document's Cover Texts may be placed on covers that bracket
  the Document within the aggregate, or the electronic equivalent of covers if
  the Document is in electronic form. Otherwise they must appear on printed
  covers that bracket the whole aggregate.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.44"><span class="name">
    8. TRANSLATION
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.44">#</a></h5></div><p>
  Translation is considered a kind of modification, so you may distribute
  translations of the Document under the terms of section 4. Replacing
  Invariant Sections with translations requires special permission from their
  copyright holders, but you may include translations of some or all Invariant
  Sections in addition to the original versions of these Invariant Sections.
  You may include a translation of this License, and all the license notices in
  the Document, and any Warranty Disclaimers, provided that you also include
  the original English version of this License and the original versions of
  those notices and disclaimers. In case of a disagreement between the
  translation and the original version of this License or a notice or
  disclaimer, the original version will prevail.
 </p><p>
  If a section in the Document is Entitled "Acknowledgements", "Dedications",
  or "History", the requirement (section 4) to Preserve its Title (section 1)
  will typically require changing the actual title.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.47"><span class="name">
    9. TERMINATION
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.47">#</a></h5></div><p>
  You may not copy, modify, sublicense, or distribute the Document except as
  expressly provided for under this License. Any other attempt to copy, modify,
  sublicense or distribute the Document is void, and will automatically
  terminate your rights under this License. However, parties who have received
  copies, or rights, from you under this License will not have their licenses
  terminated so long as such parties remain in full compliance.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.49"><span class="name">
    10. FUTURE REVISIONS OF THIS LICENSE
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.49">#</a></h5></div><p>
  The Free Software Foundation may publish new, revised versions of the GNU
  Free Documentation License from time to time. Such new versions will be
  similar in spirit to the present version, but may differ in detail to address
  new problems or concerns. See
  <a class="link" href="https://www.gnu.org/copyleft/" target="_blank">https://www.gnu.org/copyleft/</a>.
 </p><p>
  Each version of the License is given a distinguishing version number. If the
  Document specifies that a particular numbered version of this License "or any
  later version" applies to it, you have the option of following the terms and
  conditions either of that specified version or of any later version that has
  been published (not as a draft) by the Free Software Foundation. If the
  Document does not specify a version number of this License, you may choose
  any version ever published (not as a draft) by the Free Software Foundation.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="id-1.7.10.4.52"><span class="name">
    ADDENDUM: How to use this License for your documents
  </span><a title="Permalink" class="permalink" href="#id-1.7.10.4.52">#</a></h5></div><div class="verbatim-wrap"><pre class="screen">Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.</pre></div><p>
  If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
  replace the “with...Texts.” line with this:
 </p><div class="verbatim-wrap"><pre class="screen">with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</pre></div><p>
  If you have Invariant Sections without Cover Texts, or some other combination
  of the three, merge those two alternatives to suit the situation.
 </p><p>
  If your document contains nontrivial examples of program code, we recommend
  releasing these examples in parallel under your choice of free software
  license, such as the GNU General Public License, to permit their use in free
  software.
 </p></section></section></div></section></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>