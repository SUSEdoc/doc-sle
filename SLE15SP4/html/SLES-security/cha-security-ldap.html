<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLES 15 SP4 | Security and Hardening Guide | LDAP with 389 Directory Server</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="LDAP with 389 Directory Server | SLES 15 SP4"/>
<meta name="description" content="The Lightweight Directory Access Protocol (LDAP) is a protocol designed to access and maintain information directories. LDAP can be used for tasks su…"/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="15 SP4"/>
<meta name="book-title" content="Security and Hardening Guide"/>
<meta name="chapter-title" content="Chapter 5. LDAP with 389 Directory Server"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Server 15 SP4"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Security and Hardening Guide"/>
<meta property="og:description" content="Implement system security and hardening for SLES"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Security and Hardening Guide"/>
<meta name="twitter:description" content="Implement system security and hardening for SLES"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "LDAP with 389 Directory Server",
  
    "description": "The Lightweight Directory Access Protocol (LDAP) is a protocol designed to access and maintain information directories. LDAP can be used for tasks su…",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-05-27T00:00+02:00",
      
    "datePublished": "2022-06-21T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-security-auth.html" title="Chapter 4. Setting up authentication clients using YaST"/><link rel="next" href="cha-security-kerberos.html" title="Chapter 6. Network authentication with Kerberos"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Security and Hardening Guide</a><span> / </span><a class="crumb" href="part-auth.html">Authentication</a><span> / </span><a class="crumb" href="cha-security-ldap.html">LDAP with 389 Directory Server</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Security and Hardening Guide</div><ol><li><a href="preface-security.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="cha-security.html" class=" "><span class="title-number">1 </span><span class="title-name">Security and confidentiality</span></a></li><li class="active"><a href="part-auth.html" class="has-children you-are-here"><span class="title-number">I </span><span class="title-name">Authentication</span></a><ol><li><a href="cha-pam.html" class=" "><span class="title-number">2 </span><span class="title-name">Authentication with PAM</span></a></li><li><a href="cha-nis.html" class=" "><span class="title-number">3 </span><span class="title-name">Using NIS</span></a></li><li><a href="cha-security-auth.html" class=" "><span class="title-number">4 </span><span class="title-name">Setting up authentication clients using YaST</span></a></li><li><a href="cha-security-ldap.html" class=" you-are-here"><span class="title-number">5 </span><span class="title-name">LDAP with 389 Directory Server</span></a></li><li><a href="cha-security-kerberos.html" class=" "><span class="title-number">6 </span><span class="title-name">Network authentication with Kerberos</span></a></li><li><a href="cha-security-ad.html" class=" "><span class="title-number">7 </span><span class="title-name">Active Directory support</span></a></li><li><a href="cha-security-freeradius.html" class=" "><span class="title-number">8 </span><span class="title-name">Setting up a freeRADIUS server</span></a></li></ol></li><li><a href="part-local-security.html" class="has-children "><span class="title-number">II </span><span class="title-name">Local security</span></a><ol><li><a href="cha-physical-security.html" class=" "><span class="title-number">9 </span><span class="title-name">Physical security</span></a></li><li><a href="sec-sec-software-management.html" class=" "><span class="title-number">10 </span><span class="title-name">Software management</span></a></li><li><a href="sec-sec-file-management.html" class=" "><span class="title-number">11 </span><span class="title-name">File management</span></a></li><li><a href="cha-security-cryptofs.html" class=" "><span class="title-number">12 </span><span class="title-name">Encrypting partitions and files</span></a></li><li><a href="cha-configure-cryptctl.html" class=" "><span class="title-number">13 </span><span class="title-name">Storage encryption for hosted applications with cryptctl</span></a></li><li><a href="sec-sec-user-management.html" class=" "><span class="title-number">14 </span><span class="title-name">User management</span></a></li><li><a href="cha-sec-cron-at.html" class=" "><span class="title-number">15 </span><span class="title-name">Restricting <code class="systemitem">cron</code> and <code class="systemitem">at</code></span></a></li><li><a href="cha-spectre.html" class=" "><span class="title-number">16 </span><span class="title-name">Spectre/Meltdown checker</span></a></li><li><a href="cha-security-yast-security.html" class=" "><span class="title-number">17 </span><span class="title-name">Configuring security settings with YaST</span></a></li><li><a href="cha-security-polkit.html" class=" "><span class="title-number">18 </span><span class="title-name">The Polkit authentication framework</span></a></li><li><a href="cha-security-acls.html" class=" "><span class="title-number">19 </span><span class="title-name">Access control lists in Linux</span></a></li><li><a href="cha-aide.html" class=" "><span class="title-number">20 </span><span class="title-name">Intrusion detection with AIDE</span></a></li></ol></li><li><a href="part-network-security.html" class="has-children "><span class="title-number">III </span><span class="title-name">Network security</span></a><ol><li><a href="cha-xauth.html" class=" "><span class="title-number">21 </span><span class="title-name">X Window System and X authentication</span></a></li><li><a href="cha-ssh.html" class=" "><span class="title-number">22 </span><span class="title-name">Securing network operations with OpenSSH</span></a></li><li><a href="cha-security-firewall.html" class=" "><span class="title-number">23 </span><span class="title-name">Masquerading and firewalls</span></a></li><li><a href="cha-security-vpnserver.html" class=" "><span class="title-number">24 </span><span class="title-name">Configuring a VPN server</span></a></li><li><a href="cha-security-xca.html" class=" "><span class="title-number">25 </span><span class="title-name">Managing a PKI with XCA, X certificate and key manager</span></a></li><li><a href="cha-sec-sysctl.html" class=" "><span class="title-number">26 </span><span class="title-name">Improving network security with <code class="command">sysctl</code> variables</span></a></li></ol></li><li><a href="part-compliance.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Regulations and Compliance</span></a><ol><li><a href="cha-common-criteria.html" class=" "><span class="title-number">27 </span><span class="title-name">Common Criteria</span></a></li><li><a href="cha-security-fips.html" class=" "><span class="title-number">28 </span><span class="title-name">Enabling compliance with FIPS 140-3</span></a></li><li><a href="cha-security-pci-dss.html" class=" "><span class="title-number">29 </span><span class="title-name">Payment Card Industry Data Security Standard (PCI DSS)</span></a></li><li><a href="cha-security-stig.html" class=" "><span class="title-number">30 </span><span class="title-name">Hardening SUSE Linux Enterprise with STIG</span></a></li></ol></li><li><a href="part-apparmor.html" class="has-children "><span class="title-number">V </span><span class="title-name">Confining privileges with <span class="phrase">AppArmor</span></span></a><ol><li><a href="cha-apparmor-intro.html" class=" "><span class="title-number">31 </span><span class="title-name">Introducing <span class="phrase">AppArmor</span></span></a></li><li><a href="cha-apparmor-start.html" class=" "><span class="title-number">32 </span><span class="title-name">Getting started</span></a></li><li><a href="cha-apparmor-concept.html" class=" "><span class="title-number">33 </span><span class="title-name">Immunizing programs</span></a></li><li><a href="cha-apparmor-profiles.html" class=" "><span class="title-number">34 </span><span class="title-name">Profile components and syntax</span></a></li><li><a href="cha-apparmor-repos.html" class=" "><span class="title-number">35 </span><span class="title-name"><span class="phrase">AppArmor</span> profile repositories</span></a></li><li><a href="cha-apparmor-yast.html" class=" "><span class="title-number">36 </span><span class="title-name">Building and managing profiles with YaST</span></a></li><li><a href="cha-apparmor-commandline.html" class=" "><span class="title-number">37 </span><span class="title-name">Building profiles from the command line</span></a></li><li><a href="cha-apparmor-hat.html" class=" "><span class="title-number">38 </span><span class="title-name">Profiling your Web applications using ChangeHat</span></a></li><li><a href="cha-apparmor-pam.html" class=" "><span class="title-number">39 </span><span class="title-name">Confining users with <code class="systemitem">pam_apparmor</code></span></a></li><li><a href="cha-apparmor-managing.html" class=" "><span class="title-number">40 </span><span class="title-name">Managing profiled applications</span></a></li><li><a href="cha-apparmor-support.html" class=" "><span class="title-number">41 </span><span class="title-name">Support</span></a></li><li><a href="cha-apparmor-glossary.html" class=" "><span class="title-number">42 </span><span class="title-name"><span class="phrase">AppArmor</span> glossary</span></a></li></ol></li><li><a href="part-selinux.html" class="has-children "><span class="title-number">VI </span><span class="title-name">SELinux</span></a><ol><li><a href="cha-selinux.html" class=" "><span class="title-number">43 </span><span class="title-name">Configuring SELinux</span></a></li></ol></li><li><a href="part-audit.html" class="has-children "><span class="title-number">VII </span><span class="title-name">The Linux Audit Framework</span></a><ol><li><a href="cha-audit-comp.html" class=" "><span class="title-number">44 </span><span class="title-name">Understanding Linux audit</span></a></li><li><a href="cha-audit-setup.html" class=" "><span class="title-number">45 </span><span class="title-name">Setting up the Linux audit framework</span></a></li><li><a href="cha-audit-scenarios.html" class=" "><span class="title-number">46 </span><span class="title-name">Introducing an audit rule set</span></a></li><li><a href="cha-audit-moreinfo.html" class=" "><span class="title-number">47 </span><span class="title-name">Useful resources</span></a></li></ol></li><li><a href="bk06apa.html" class=" "><span class="title-number">A </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-security-ldap" data-id-title="LDAP with 389 Directory Server"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP4</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">5 </span><span class="title-name">LDAP with 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    The Lightweight Directory Access Protocol (LDAP) is a protocol
    designed to access and maintain information directories. LDAP can be
    used for tasks such as user and group management, system configuration
    management, and address management. In <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15 SP4</span></span> the
    LDAP service is provided by the 389 Directory Server, replacing OpenLDAP.
   </p></div></div></div></div><p>
   Ideally, a central server stores the data in a directory and distributes
   it to all clients using a well-defined protocol. The structured data allow
   a wide range of applications to access them. A central repository reduces
   the necessary administrative effort. The use of an open and standardized
   protocol such as LDAP ensures that as many client applications as
   possible can access such information.
  </p><p>
   A directory in this context is a type of database optimized for quick and
   effective reading and searching. The type of data stored in a directory tends
   to be long lived and changes infrequently. This allows the LDAP service to be
   optimized for high performance concurrent reads, whereas conventional databases
   are optimized for accepting many writes to data in a short time.
  </p><section class="sect1" id="sec-security-ldap-tree" data-id-title="Structure of an LDAP directory tree"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.1 </span><span class="title-name">Structure of an LDAP directory tree</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-tree">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_directory_tree.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section introduces the layout of an LDAP directory tree, and provides
   the basic terminology used with regard to LDAP. <span class="phrase">If
    you are familiar with LDAP, read on at <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server" title="5.2.1. Setting up a new 389 Directory Server instance">Section 5.2.1, “Setting up a new 389 Directory Server instance”</a>.
   </span>
  </p><p>
   An LDAP directory has a tree structure. All entries (called objects) of
   the directory have a defined position within this hierarchy. This
   hierarchy is called the <span class="emphasis"><em>directory information tree</em></span>
   (DIT). The complete path to the desired entry, which unambiguously
   identifies it, is called the <span class="emphasis"><em>distinguished name</em></span> or
   DN. An object in the tree is identified by its <span class="emphasis"><em>relative distinguished
   name</em></span> (RDN). The distinguished name is built from the RDNs of all
   entries on the path to the entry.
  </p><p>
   The relations within an LDAP directory tree become more evident in the
   following example, shown in <a class="xref" href="cha-security-ldap.html#fig-ldap-tree" title="Structure of an LDAP directory">Figure 5.1, “Structure of an LDAP directory”</a>.
  </p><div class="figure" id="fig-ldap-tree"><div class="figure-contents"><div class="mediaobject"><a href="images/ldap_tree.png"><img src="images/ldap_tree.png" width="85%" alt="Structure of an LDAP directory" title="Structure of an LDAP directory"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 5.1: </span><span class="title-name">Structure of an LDAP directory </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#fig-ldap-tree">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_directory_tree.xml" title="Edit source document"> </a></div></div></div><p>
   The complete diagram is a fictional directory information tree. The
   entries on three levels are depicted. Each entry corresponds to one box
   in the image. The complete, valid <span class="emphasis"><em>distinguished name</em></span>
   for the fictional employee <code class="systemitem">Geeko
   Linux</code>, in this case, is <code class="literal">cn=Geeko
   Linux,ou=doc,dc=example,dc=com</code>. It is composed by adding the
   RDN <code class="literal">cn=Geeko Linux</code> to the DN of the preceding entry
   <code class="literal">ou=doc,dc=example,dc=com</code>.
  </p><p>
   The types of objects that can be stored in the DIT are globally
   determined following a <span class="emphasis"><em>Schema</em></span>. The type of an object
   is determined by the <span class="emphasis"><em>object class</em></span>. The object class
   determines what attributes the relevant object must or may be assigned.
   The Schema contains all object classes and attributes which can be used by
   the LDAP server. Attributes are a structured data type. Their syntax, ordering
   and other behavior is defined by the Schema. LDAP servers supply a core set of
   Schemas which can work in a broad variety of environments. If a custom Schema
   is required, you can upload it to an LDAP server.
  </p><p>
   <a class="xref" href="cha-security-ldap.html#tab-ldap-schema" title="Commonly used object classes and attributes">Table 5.1, “Commonly used object classes and attributes”</a> offers a small overview of the object
   classes from <code class="filename">00core.ldif</code> and
   <code class="filename">06inetorgperson.ldif</code> used in the example, including
   required attributes (Req. Attr.) and valid attribute values. After installing
   389 Directory Server, these can be found in
   <code class="filename">/usr/share/dirsrv/schema</code>.

  </p><div class="table" id="tab-ldap-schema" data-id-title="Commonly used object classes and attributes"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 5.1: </span><span class="title-name">Commonly used object classes and attributes </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#tab-ldap-schema">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_directory_tree.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/><col class="c4"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Object Class
       </p>
      </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Meaning
       </p>
      </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        Example Entry
       </p>
      </th><th style="border-bottom: 1px solid ; ">
       <p>
        Req. Attr.
       </p>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">domain</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        name components of the domain
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        example
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        displayName
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">organizationalUnit</code>
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        organizational unit
       </p>
      </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        <code class="literal">documentationdept</code>
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        <code class="literal">ou</code>
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        <code class="literal">nsPerson</code>
       </p>
      </td><td style="border-right: 1px solid ; ">
       <p>
        person-related data for the
        intranet or Internet
       </p>
      </td><td style="border-right: 1px solid ; ">
       <p>
        <code class="literal">Tux Linux</code>
       </p>
      </td><td>
       <p>
        <code class="literal">cn</code>
       </p>
      </td></tr></tbody></table></div></div><p>
   <a class="xref" href="cha-security-ldap.html#aus-ldap-schema-help" title="Excerpt from CN=schema">Example 5.1, “Excerpt from CN=schema”</a> shows an excerpt from a Schema
   directive with explanations.
  </p><div class="example" id="aus-ldap-schema-help" data-id-title="Excerpt from CN=schema"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.1: </span><span class="title-name">Excerpt from CN=schema </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#aus-ldap-schema-help">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_directory_tree.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">attributetype (1.2.840.113556.1.2.102 NAME 'memberOf' <span class="callout" id="co-ldap-schema-core-att-type">1</span>
       DESC 'Group that the entry belongs to' <span class="callout" id="co-ldap-schema-core-desc">2</span>
       SYNTAX 1.3.6.1.4.1.1466.115.121.1.12 <span class="callout" id="co-ldap-schema-core-syntax">3</span>
       X-ORIGIN 'Netscape Delegated Administrator') <span class="callout" id="co-ldap-schema-core-xorigin">4</span>

objectclass (2.16.840.1.113730.3.2.333 NAME 'nsPerson' <span class="callout" id="co-ldap-schema-core-oc">5</span>
       DESC 'A representation of a person in a directory server' <span class="callout" id="co-ldap-schema-core-desc-oc">6</span>
       SUP top STRUCTURAL <span class="callout" id="co-ldap-schema-core-sup-oc">7</span>
       MUST ( displayName $ cn ) <span class="callout" id="co-ldap-schema-core-must-oc">8</span>
       MAY ( userPassword $ seeAlso $ description $ legalName $ mail \
             $ preferredLanguage ) <span class="callout" id="co-ldap-schema-core-may-oc">9</span>
       X-ORIGIN '389 Directory Server Project'
  ...</pre></div></div></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-att-type"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The name of the attribute, its unique <span class="emphasis"><em>object
     identifier</em></span> (OID, numerical), and the abbreviation of the
     attribute.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-desc"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     A brief description of the attribute with <code class="literal">DESC</code>. The
     corresponding RFC, on which the definition is based, may also mentioned
     here.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-syntax"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      The type of data that can be held in the attribute. In this case, it is a
      case-insensitive directory string.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-xorigin"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The source of the schema element (for example, the name of the project).
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-oc"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The definition of the object class <code class="literal">nsPerson</code> begins with
     an OID and the name of the object class (like the definition of
     the attribute).
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-desc-oc"><span class="callout">6</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     A brief description of the object class.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-sup-oc"><span class="callout">7</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     The <code class="literal">SUP top</code> entry indicates that this object class
     is not subordinate to another object class.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-must-oc"><span class="callout">8</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     With <code class="literal">MUST</code>, list all attribute types that must be used
     with an object of the type
     <code class="literal">nsPerson</code>.
    </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-schema-core-may-oc"><span class="callout">9</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
     With <code class="literal">MAY</code>, list all attribute types that are optionally
     permitted with this object class.
    </p></td></tr></table></div></section><section class="sect1" id="sec-security-ldap-server-install" data-id-title="Installing 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.2 </span><span class="title-name">Installing 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-server-install">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Install 389 Directory Server with the following command:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">zypper install 389-ds</code></pre></div><p>
  After installation, set up the server <span class="phrase">as described in
  <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server" title="5.2.1. Setting up a new 389 Directory Server instance">Section 5.2.1, “Setting up a new 389 Directory Server instance”</a>.</span>
 </p><section class="sect2" id="sec-security-ldap-server" data-id-title="Setting up a new 389 Directory Server instance"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.1 </span><span class="title-name">Setting up a new 389 Directory Server instance</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-server">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You will use the <code class="command">dscreate</code> command to create new 389 Directory Server
   instances, and the <code class="command">dsctl</code> command to cleanly remove them.
  </p><p>
   There are two ways to configure and create a new instance: from a custom
   configuration file, and from an auto-generated template file. You can use
   the auto-generated template without changes for a test instance, though for
   a production system you must carefully review it and make any necessary
   changes.
  </p><p>
   Then you will set up administration credentials, manage users and groups,
   and configure identity services.
  </p><p>
   The 389 Directory Server is controlled by three primary commands:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.4.5.6.5.6.1"><span class="term"><code class="command">dsctl</code></span></dt><dd><p>
      Manages a local instance and requires <code class="systemitem">root</code> permissions. Requires
      you to be connected to a terminal which is running the directory server
      instance. Used for starting, stopping, backing up the database, and more.
     </p></dd><dt id="id-1.8.4.5.6.5.6.2"><span class="term"><code class="command">dsconf</code></span></dt><dd><p>
      The primary tool used for administration and configuration of the server.
      Manages an instance's configuration via its external interfaces. This
      allows you to make configuration changes remotely on the instance.
     </p></dd><dt id="id-1.8.4.5.6.5.6.3"><span class="term"><code class="command">dsidm</code></span></dt><dd><p>
      Used for identity management (managing users, groups, passwords, etc.).
      The permissions are granted by access controls, so, for example, users
      can reset their own password or change details of their own account.
     </p></dd></dl></div><p>
   Follow these steps to set up a simple instance for testing and development,
   populated with a small set of sample entries.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>

     <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server-instance" title="5.2.2. Creating a 389 Directory Server instance with a custom configuration file">Creating a 389 Directory Server instance with a custom configuration file</a>
    </p></li><li class="step"><p>

     <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server-template" title="5.2.3. Creating a 389 Directory Server instance from a template">Creating a 389 Directory Server instance from a template</a>
    </p></li><li class="step"><p>

     <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server-credentials" title="5.2.5. Configuring admin credentials for local administration">Configuring admin credentials for local administration</a>
    </p></li><li class="step"><p>

     <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server-users" title="5.5. Managing LDAP users and groups">Managing LDAP users and groups</a>
    </p></li><li class="step"><p>

     <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server-sssd" title="5.7. Using SSSD to manage LDAP authentication">Using SSSD to manage LDAP authentication</a>
    </p></li><li class="step"><p>

     <a class="xref" href="cha-security-ldap.html#sec-security-ldap-modules" title="5.6. Managing plug-ins">Managing plug-ins</a>
    </p></li><li class="step"><p>

     <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server-ca" title="5.9. Importing TLS server certificates and keys">Importing TLS server certificates and keys</a>
    </p></li></ol></div></div></section><section class="sect2" id="sec-security-ldap-server-instance" data-id-title="Creating a 389 Directory Server instance with a custom configuration file"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.2 </span><span class="title-name">Creating a 389 Directory Server instance with a custom configuration file</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-server-instance">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can create a new 389 Directory Server instance from a simple custom configuration
   file. This file must be in the INF format, and you can name it anything you
   like.
  </p><p>
   The default instance name is <code class="literal">localhost</code>. The instance name
   cannot be changed after it has been created. It is better to create your own
   instance name, rather than using the default, to avoid confusion and to
   enable a better understanding of how it all works. The following examples
   use the <em class="replaceable">LDAP1</em> instance name, and a suffix of
   dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em>.
  </p><p>
   <a class="xref" href="cha-security-ldap.html#ex-ldap-389-ds-inf" title="Minimal 389 Directory Server instance configuration file">Example 5.2</a> shows an
   example configuration file that you can use to create a new 389 Directory Server
   instance. You can copy and use this file without changes.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Copy the following example file, <code class="filename">LDAP1.inf</code>, to your
     home directory:
    </p><div class="example" id="ex-ldap-389-ds-inf" data-id-title="Minimal 389 Directory Server instance configuration file"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.2: </span><span class="title-name">Minimal 389 Directory Server instance configuration file </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#ex-ldap-389-ds-inf">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"># <em class="replaceable">LDAP1.inf</em>

[general]
config_version = 2 <span class="callout" id="co-ldap-389-ds-config-version">1</span>

[slapd]
root_password = <em class="replaceable">PASSWORD</em><span class="callout" id="co-ldap-389-ds-rootpasswd">2</span>
self_sign_cert = True <span class="callout" id="co-ldap-389-ds-cert">3</span>
instance_name = <em class="replaceable">LDAP1</em>

[backend-userroot]
sample_entries = yes <span class="callout" id="co-ldap-389-ds-sample-entries">4</span>
suffix = dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-389-ds-config-version"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        This line is required, indicating that this is a version 2 setup INF
        file.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-389-ds-rootpasswd"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Create a strong <code class="varname">root_password</code> for the ldap user
        <code class="literal">cn=Directory Manager</code>. This user is for connecting
        (binding) to the directory.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-389-ds-cert"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Create self-signed server certificates in
        <code class="filename">/etc/dirsrv/slapd-<em class="replaceable">LDAP1</em></code>.
       </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-389-ds-sample-entries"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
        Populate the new instance with sample user and group entries.
       </p></td></tr></table></div></div></div></li><li class="step"><p>
     To create the 389 Directory Server instance from
     <a class="xref" href="cha-security-ldap.html#ex-ldap-389-ds-inf" title="Minimal 389 Directory Server instance configuration file">Example 5.2</a>, run the
     following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dscreate -v from-file <em class="replaceable">LDAP1.inf</em> |</code> \
<code class="command">tee <em class="replaceable">LDAP1-OUTPUT.txt</em></code></pre></div><p>
     This shows all activity during the instance creation, stores all the
     messages in
     <code class="filename"><em class="replaceable">LDAP1-OUTPUT.txt</em></code>, and
     creates a working LDAP server in about a minute. The verbose output
     contains a lot of useful information. If you do not want to save it, then
     delete the <code class="literal">| tee
     <em class="replaceable">LDAP1-OUTPUT.txt</em></code> portion of the
     command.
    </p></li><li class="step"><p>
     If the <code class="command">dscreate</code> command should fail, the messages will
     tell you why. After correcting any issues, remove the instance (see
     <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server-remove" title="Step 5">Step 5</a>) and create a new
     instance.
    </p></li><li class="step"><p>
     A successful installation reports "<code class="literal">Completed installation for
     <em class="replaceable">LDAP1</em></code>". Check the status of your new
     server:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> status</code>
Instance "LDAP1" is running</pre></div></li><li class="step" id="sec-security-ldap-server-remove"><p>
     The following commands are for cleanly removing the instance. The first
     command performs a dry run and does not remove the instance. When you are
     sure you want to remove it, use the second command with the
     <code class="command">--do-it</code> option:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> remove</code>
Not removing: if you are sure, add --do-it

<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl<em class="replaceable">LDAP1</em> remove --do-it</code></pre></div><p>
     This command also removes partially installed or corrupted instances. You
     can reliably create and remove instances as often as you want.
    </p></li></ol></div></div><p>
   If you forget the name of your instance, use <code class="command">dsctl</code> to
   list all instances:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo dsctl -l</code>
slapd-<em class="replaceable">LDAP1</em></pre></div></section><section class="sect2" id="sec-security-ldap-server-template" data-id-title="Creating a 389 Directory Server instance from a template"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.3 </span><span class="title-name">Creating a 389 Directory Server instance from a template</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-server-template">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can auto-create a template for a new 389 Directory Server instance with the
   <code class="command">dscreate</code> command. This creates a template that you can
   use without making any changes, for testing. For production systems, review
   and change it to suit your own requirements. All of the defaults are
   documented in the template file, and commented out. To make changes,
   uncomment the default and enter your own value. All options are well
   documented.
  </p><p>
   The following example prints the template to stdout:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo dscreate create-template</code></pre></div><p>
   This is good for a quick review of the template, but you must create a file
   to use in creating your new 389 Directory Server instance. You can name this file
   anything you want:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo dscreate create-template <em class="replaceable">TEMPLATE.txt</em></code></pre></div><p>
   This is a snippet from the new file:
  </p><div class="verbatim-wrap"><pre class="screen"># full_machine_name (str)
# Description: Sets the fully qualified hostname (FQDN) of this system. When
# installing this instance with GSSAPI authentication behind a load balancer, set
# this parameter to the FQDN of the load balancer and, additionally, set
# "strict_host_checking" to "false".
# Default value: ldapserver1.test.net
;full_machine_name = ldapserver1.test.net

# selinux (bool)
# Description: Enables SELinux detection and integration during the installation
# of this instance. If set to "True", dscreate auto-detects whether SELinux is
# enabled. Set this parameter only to "False" in a development environment.
# Default value: True
;selinux = True</pre></div><p>
   It automatically configures some options from your existing environment; for
   example, the system's fully-qualified domain name, which is called
   <code class="literal">full_machine_name</code> in the template. Use this file with no
   changes to create a new instance:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dscreate from-file <em class="replaceable">TEMPLATE.txt</em></code></pre></div><p>
   This creates a new instance named <code class="literal">localhost</code>, and
   automatically starts it after creation:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl localhost status</code>
Instance "localhost" is running</pre></div><p>
   The default values create a fully operational instance, but there are some
   values you might want to change.
  </p><p>
   The instance name cannot be changed after it has been created. It is better
   to create your own instance name, rather than using the default, to avoid
   confusion and to enable a better understanding of how it all works. To do
   this, uncomment the <code class="literal">;instance_name = localhost</code> line and
   change <code class="literal">localhost</code> to your chosen name. In the following
   examples, the instance name is <em class="replaceable">LDAP1</em>.
  </p><p>
   Another useful change is to populate your new instance with sample users and
   groups. Uncomment <code class="literal">;sample_entries = no</code> and change
   <code class="literal">no</code> to <code class="literal">yes</code>. This creates the
   <code class="literal">demo_user</code> and <code class="literal">demo_group</code>.
  </p><p>
   Set your own password by uncommenting <code class="literal">;root_password</code>, and
   replacing the default password with your own.
  </p><p>
   The template does not create a default suffix, so you should configure your
   own on the <code class="literal">suffix</code> line, like the following example:
  </p><div class="verbatim-wrap"><pre class="screen">suffix = dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em></pre></div><p>
   You can cleanly remove any instance and start over with
   <code class="command">dsctl</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> remove --do-it</code></pre></div></section><section class="sect2" id="sec-security-ldap-server-stop-start" data-id-title="Stopping and starting 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.4 </span><span class="title-name">Stopping and starting 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-server-stop-start">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following examples use <code class="literal">LDAP1</code> as the instance name.
   Use <code class="systemitem">systemd</code> to manage your 389 Directory Server instance. Get the status of your
   instance:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">systemctl status --no-pager --full dirsrv@LDAP1.service</code>
   ● dirsrv@LDAP1.service - 389 Directory Server LDAP1.
     Loaded: loaded (/usr/lib/systemd/system/dirsrv@.service; enabled; vendor preset: disabled)
     Active: active (running) since Thu 2021-03-11 08:55:28 PST; 2h 7min ago
    Process: 4451 ExecStartPre=/usr/lib/dirsrv/ds_systemd_ask_password_acl
       /etc/dirsrv/slapd-LDAP1/dse.ldif (code=exited, status=0/SUCCESS)
   Main PID: 4456 (ns-slapd)
     Status: "slapd started: Ready to process requests"
      Tasks: 26
     CGroup: /system.slice/system-dirsrv.slice/dirsrv@LDAP1.service
             └─4456 /usr/sbin/ns-slapd -D /etc/dirsrv/slapd-LDAP1 -i /run/dirsrv/slapd-LDAP1.pid</pre></div><p>
   Start, stop, and restart your LDAP server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl start <em class="replaceable">dirsrv@LDAP1.service</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl stop <em class="replaceable">dirsrv@LDAP1.service</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl restart <em class="replaceable">dirsrv@LDAP1.service</em></code></pre></div><p>
   See <span class="intraxref">Book “Administration Guide”, Chapter 19 “The <code class="systemitem">systemd</code> daemon”</span> for more information on using
   <code class="command">systemctl</code>.
  </p><p>
   The <code class="command">dsctl</code> command also starts and stops your server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> status</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> stop</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> restart</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">LDAP1</em> start</code></pre></div></section><section class="sect2" id="sec-security-ldap-server-credentials" data-id-title="Configuring admin credentials for local administration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.2.5 </span><span class="title-name">Configuring admin credentials for local administration</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-server-credentials">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For local administration of the 389 Directory Server, you can create a
   <code class="filename">.dsrc</code> configuration file in the
   <code class="filename">/root</code> directory, allowing root and sudo users to
   administer the server without typing connection details with every command.
   <a class="xref" href="cha-security-ldap.html#ex-security-ldap-server-credentials-local" title="A .dsrc file for local administration">Example 5.3</a>
   shows an example for local administration on the server, using
   <em class="replaceable">LDAP1</em> and <em class="replaceable">com</em> for the
   suffix.
  </p><p>
   After creating your <code class="filename">/root/.dsrc</code> file, try a few
   administration commands, such as creating new users (see
   <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server-users" title="5.5. Managing LDAP users and groups">Section 5.5, “Managing LDAP users and groups”</a>).
  </p><div class="example" id="ex-security-ldap-server-credentials-local" data-id-title="A .dsrc file for local administration"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.3: </span><span class="title-name">A <code class="filename">.dsrc</code> file for local administration </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#ex-security-ldap-server-credentials-local">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_install.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"># /root/.dsrc file for administering the LDAP1 instance

[<em class="replaceable">LDAP1</em>] <span class="callout" id="co-ldap-server-dsrc-instance-name">1</span>

uri = ldapi://<em class="replaceable">%%2fvar%%2frun%%2fslapd-LDAP1.socket</em> <span class="callout" id="co-ldap-server-dsrc-remote-ldapi">2</span>
basedn = dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em>
binddn = cn=Directory Manager</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-server-dsrc-instance-name"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      This must specify your exact instance name.
     </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-ldap-server-dsrc-remote-ldapi"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
      <code class="literal">ldapi</code> detects the UID and GID of the user attempting
      to log in to the server. If the UID/GID are <code class="literal">0/0</code> or
      <code class="literal">dirsrv:dirsrv</code>, <code class="literal">ldapi</code> binds the user
      as the directory server root dn, which is <code class="literal">cn=Directory
      Manager</code>.
     </p><p>
      In the URI, the slashes are replaced with <code class="literal">%%2f</code>, so in
      this example the path is
      <code class="filename">/var/run/slapd-<em class="replaceable">LDAP1</em>.socket</code>.
     </p></td></tr></table></div></div></div><div id="id-1.8.4.5.6.9.5" data-id-title="New negation feature in sudoers.ldap" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: New negation feature in sudoers.ldap</div><p>
         In <span class="package">sudo</span> versions older than 1.9.9,
         negation in sudoers.ldap does
         not work for the <code class="literal">sudoUser</code>,
         <code class="literal">sudoRunAsUser</code>, or
         <code class="literal">sudoRunAsGroup</code> attributes. For example:
       </p><div class="verbatim-wrap"><pre class="screen"> # does not match all but joe
# instead, it does not match anyone
sudoUser: !joe

# does not match all but joe
# instead, it matches everyone including Joe
sudoUser: ALL
sudoUser: !joe</pre></div></div><p>
    In <code class="command">sudo</code> version 1.9.9 and higher, negation is
    enabled for the <code class="literal">sudoUser</code> attribute. See
    <code class="command">man 5 sudoers.ldap</code> for more information.
  </p></section></section><section class="sect1" id="sec-security-ldap-firewall" data-id-title="Firewall configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.3 </span><span class="title-name">Firewall configuration</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-firewall">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      The default TCP ports for 389 Directory Server are 389 and 636. TCP 389 is for unencrypted
      connections, and STARTTLS. 636 is for encrypted connections over TLS.
  </p><p>
      <code class="systemitem">firewalld</code> is the default firewall manager for SUSE Linux Enterprise. The following rules
      activate the <code class="literal">ldap</code> and <code class="literal">ldaps</code> firewall
      services:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">firewall-cmd --add-service=ldap --zone=<em class="replaceable">internal</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">firewall-cmd --add-service=ldaps --zone=<em class="replaceable">internal</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">firewall-cmd --runtime-to-permanent</code></pre></div><p>
      Replace the zone with the appropriate zone for your server. See
      <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server-ca" title="5.9. Importing TLS server certificates and keys">Section 5.9, “Importing TLS server certificates and keys”</a> for information on securing
          your connections with TLS, and
          <a class="xref" href="cha-security-firewall.html#sec-security-firewall-fw" title="23.3. Firewalling basics">Section 23.3, “Firewalling basics”</a> to learn about <code class="systemitem">firewalld</code>.
  </p></section><section class="sect1" id="sec-security-ldap-backup" data-id-title="Backing up and restoring 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.4 </span><span class="title-name">Backing up and restoring 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-backup">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_backups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  389 Directory Server supports making offline and online backups. The
  <code class="command">dsctl</code> command makes offline database backups, and the
  <code class="command">dsconf</code> command makes online database backups. Back up the
  LDAP server configuration directory to enable complete restoration in case
  of a major failure.
 </p><section class="sect2" id="sec-security-ldap-backup-config" data-id-title="Backing up the LDAP server configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.4.1 </span><span class="title-name">Backing up the LDAP server configuration</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-backup-config">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_backups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Your LDAP server configuration is in the directory
   <code class="filename">/etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em></code>.
   This directory contains certificates, keys, and the <code class="filename">dse.ldif</code>
   file. Make a compressed backup of this directory with the
   <code class="command">tar</code> command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">tar caf \</code>
<code class="command">config_slapd-<em class="replaceable">INSTANCE_NAME</em>-$(date +%Y-%m-%d_%H-%M-%S).tar.gz \</code>
<code class="command">/etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/</code></pre></div><div id="id-1.8.4.5.8.3.4" data-id-title="Harmless tar error message" class="admonition note compact"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Harmless tar error message</div><p>
    When running <code class="command">tar</code>, you may see the harmless informational
    message <code class="literal">tar: Removing leading `/' from member names</code>.
   </p></div><p>
   To restore a previous configuration, unpack it to the same directory:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p><span class="step-optional">(Optional)</span> 
     To avoid overwriting an existing configuration, move it:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">old /etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/</code></pre></div></li><li class="step"><p>
     Unpack the backup archive:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">tar -xvzf</code> \
<code class="command">config_slapd-<em class="replaceable">INSTANCE_NAME-DATE</em>.tar.gz</code></pre></div></li><li class="step"><p>
     Copy it to
     <code class="filename">/etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em></code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">cp -r etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em></code> \
<code class="command">/etc/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em></code></pre></div></li></ol></div></div></section><section class="sect2" id="sec-security-ldap-offline-backup" data-id-title="Creating an offline backup of the LDAP database and restoring from it"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.4.2 </span><span class="title-name">Creating an offline backup of the LDAP database and restoring from it</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-offline-backup">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_backups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="command">dsctl</code> command makes offline backups. Stop the server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> stop</code>
Instance "<em class="replaceable">INSTANCE_NAME</em>" has been stopped</pre></div><p>
   Then make the backup using your instance name. The following example
   creates a backup archive at
   <em class="replaceable">/var/lib/dirsrv/slapd-INSTANCE_NAME/bak/INSTANCE_NAME-DATE</em>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> db2bak</code>
db2bak successful</pre></div><p>
  For example, on a test instance named ldap1 it looks like this:
</p><div class="verbatim-wrap"><pre class="screen"><code class="filename">/var/lib/dirsrv/slapd-ldap1/bak/ldap1-2021_10_25_13_03_17</code></pre></div><p>
   Restore from this backup, naming the directory containing the backup
   archive:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> bak2db</code> \
<code class="command">/var/lib/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/bak/<em class="replaceable">INSTANCE_NAME-DATE</em>/</code>
bak2db successful</pre></div><p>
   Then start the server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> start</code>
Instance "INSTANCE_NAME" has been started</pre></div><p>
   You can also create LDIF backups:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> db2ldif --replication userRoot</code>
ldiffile: /var/lib/dirsrv/slapd-INSTANCE_NAME/ldif/INSTANCE_NAME-userRoot-DATE.ldif
db2ldif successful</pre></div><p>
   Restore an LDIF backup with the name of the archive, then start the server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl ldif2db userRoot</code> \
<code class="command">/var/lib/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/ldif/<em class="replaceable">INSTANCE_NAME</em>-userRoot-<em class="replaceable">DATE</em>.ldif</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> start</code></pre></div></section><section class="sect2" id="sec-security-ldap-online-backup" data-id-title="Creating an online backup of the LDAP database and restoring from it"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.4.3 </span><span class="title-name">Creating an online backup of the LDAP database and restoring from it</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-online-backup">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_backups.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use the <code class="command">dsconf</code> to make an online backup of your LDAP
   database:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> backup create</code>
The backup create task has finished successfully</pre></div><p>
   This creates
   <code class="filename">/var/lib/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/bak/<em class="replaceable">INSTANCE_NAME-DATE</em></code>.
  </p><p>
   Restore it:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> backup restore</code> \
<code class="command">/var/lib/dirsrv/slapd-<em class="replaceable">INSTANCE_NAME</em>/bak/<em class="replaceable">INSTANCE_NAME-DATE</em></code></pre></div></section></section><section class="sect1" id="sec-security-ldap-server-users" data-id-title="Managing LDAP users and groups"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.5 </span><span class="title-name">Managing LDAP users and groups</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-server-users">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Use the <code class="command">dsidm</code> command to create, remove, and manage 
  users and groups.  
 </p><section class="sect2" id="sec-security-ldap-list-users-groups" data-id-title="Querying existing LDAP users and groups"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.5.1 </span><span class="title-name">Querying existing LDAP users and groups</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-list-users-groups">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following examples show how to list your existing users and groups. The
  examples use the instance name <em class="replaceable">LDAP1</em>. Replace 
  this with your instance name:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> user list</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group list</code></pre></div><p>
  List all information on a single user:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> user get <em class="replaceable">USER</em></code></pre></div><p>
  List all information on a single group:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group get <em class="replaceable">GROUP</em></code></pre></div><p>
  List members of a group:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group members <em class="replaceable">GROUP</em></code></pre></div></section><section class="sect2" id="sec-security-ldap-create-users-passwords" data-id-title="Creating users and managing passwords"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.5.2 </span><span class="title-name">Creating users and managing passwords</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-create-users-passwords">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  In the following example, we create one user, <code class="systemitem">wilber</code>. The
  example server instance is named <em class="replaceable">LDAP1</em>, and the
  instance's suffix is <em class="replaceable">dc=LDAP1,dc=COM</em>.
 </p><div class="procedure" id="pro-security-ldap-server-users" data-id-title="Creating LDAP users"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 5.1: </span><span class="title-name">Creating LDAP users </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#pro-security-ldap-server-users">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
   The following example creates the user Wilber Fox on your 
   389 DS instance:
  </p><ol class="procedure" type="1"><li class="step"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> user create --uid wilber \</code>
  <code class="command">--cn wilber --displayName 'Wilber Fox' --uidNumber 1001 --gidNumber 101 \</code>
 <code class="command"> --homeDirectory /home/wilber</code></pre></div></li><li class="step"><p>
    Verify by looking up your new user's <code class="literal">distinguished name</code>
    (fully qualified name to the directory object, which is guaranteed unique):
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> user get wilber</code>
dn: <em class="replaceable">uid=wilber,ou=people,dc=LDAP1,dc=COM</em>
[...]</pre></div><p>
    You need the distinguished name for actions such as changing the password
    for a user.
   </p></li><li class="step"><p>
    Create a password for new user <code class="systemitem">wilber</code>:
   </p><ol type="a" class="substeps"><li class="step"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> account reset_password \</code>
  <code class="command">uid=<em class="replaceable">wilber,ou=people,dc=LDAP1,dc=COM</em></code></pre></div></li><li class="step"><p>
      Enter the new password for <code class="systemitem">wilber</code> twice.
     </p><p>
      If the action was successful, you get the following message:
     </p><div class="verbatim-wrap"><pre class="screen">reset password for uid=<em class="replaceable">wilber,ou=people,dc=LDAP1,dc=COM</em></pre></div><p>
      Use the same command to change an existing password.
     </p></li></ol></li><li class="step"><p>
    Verify that the user's password works:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">ldapwhoami -D <em class="replaceable">uid=wilber,ou=people,dc=LDAP1,dc=COM</em> -W</code>
Enter LDAP Password: <em class="replaceable">PASSWORD</em>
dn: <em class="replaceable">uid=wilber,ou=people,dc=LDAP1,dc=COM</em></pre></div></li></ol></div></div></section><section class="sect2" id="sec-security-ldap-create-groups" data-id-title="Creating and managing groups"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.5.3 </span><span class="title-name">Creating and managing groups</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-create-groups">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    After creating users, you can create groups, and then assign
    users to them. In the following examples, we create a group,
   <em class="replaceable">server_admins</em>, and assign the user
   <code class="systemitem">wilber</code> to this group. The example server instance is named
   <em class="replaceable">LDAP1</em>, and the instance's suffix is
   <em class="replaceable">dc=LDAP1,dc=COM</em>.
  </p><div class="procedure" id="pro-security-ldap-server-groups" data-id-title="Creating LDAP groups and assigning users to them"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 5.2: </span><span class="title-name">Creating LDAP groups and assigning users to them </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#pro-security-ldap-server-groups">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
    Create the group:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group create</code></pre></div><p>
    You will be prompted for a group name. Enter your chosen group name, which
    in the following example is <em class="replaceable">SERVER_ADMINS</em>:
   </p><div class="verbatim-wrap"><pre class="screen">Enter value for cn : <em class="replaceable">SERVER_ADMINS</em></pre></div></li><li class="step"><p>
     Add the user <code class="systemitem">wilber</code> 
     (created in <a class="xref" href="cha-security-ldap.html#pro-security-ldap-server-users" title="Creating LDAP users">Procedure 5.1, “Creating LDAP users”</a>) to the 
     group:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group add_member <em class="replaceable">SERVER_ADMINS</em></code> \
<code class="command">uid=wilber,<em class="replaceable">ou=people,dc=LDAP1,dc=COM</em></code>
added member: uid=<em class="replaceable">wilber,ou=people,dc=LDAP1,dc=COM</em></pre></div></li></ol></div></div></section><section class="sect2" id="sec-security-ldap-delete-users-groups" data-id-title="Deleting users and groups, and removing users from groups"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.5.4 </span><span class="title-name">Deleting users and groups, and removing users from groups</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-delete-users-groups">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_users.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use the <code class="command">dsidm</code> command to delete users, remove users 
   from groups, and delete groups. The following example removes our
   example user wilber from the server_admins group:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group remove_member <em class="replaceable">SERVER_ADMINS</em></code> \
<code class="command">uid=<em class="replaceable">wilber,ou=people,dc=LDAP1,dc=COM</em></code></pre></div><p>
   Delete a user:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> user delete</code> \
<code class="command"><em class="replaceable">uid=wilber,ou=people,dc=LDAP1,dc=COM</em></code></pre></div><p>
     Delete a group:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> group delete <em class="replaceable">SERVER_ADMINS</em></code></pre></div></section></section><section class="sect1" id="sec-security-ldap-modules" data-id-title="Managing plug-ins"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.6 </span><span class="title-name">Managing plug-ins</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-modules">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_modules.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use the following command to list all available plug-ins, enabled and
    disabled. Use your server's hostname rather than the instance name
    of your 389 Directory Server, like the following example hostname of
    <em class="replaceable">LDAPSERVER1</em>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf -D "cn=Directory Manager" ldap://<em class="replaceable">LDAPSERVER1</em> plugin list</code>
Enter password for cn=Directory Manager on ldap://<em class="replaceable">LDAPSERVER1</em>: <em class="replaceable">PASSWORD</em>

7-bit check
Account Policy Plugin
Account Usability Plugin
ACL Plugin
ACL preoperation
[...]</pre></div><p>
    The following command enables the <code class="literal">MemberOf</code> plug-in referenced in
    <a class="xref" href="cha-security-ldap.html#sec-security-ldap-server-sssd" title="5.7. Using SSSD to manage LDAP authentication">Section 5.7, “Using SSSD to manage LDAP authentication”</a>. <code class="literal">MemberOf</code> simplifies
    user searches, by returning the user and any groups the user
    belongs to, with a single command. Without <code class="literal">MemberOf</code>, a client must
    run multiple lookups to find a user's group memberships.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf -D "cn=Directory Manager" ldap://<em class="replaceable">LDAPSERVER1</em> plugin memberof enable</code></pre></div><p>
    Note that the plug-in names used in commands are lowercase, so they
    are different from how
    they appear when you list them. If you make a mistake with a plug-in
    name, you will see a helpful error message:
  </p><div class="verbatim-wrap"><pre class="screen">dsconf instance plugin: error: invalid choice: 'MemberOf' (choose from
'memberof', 'automember', 'referential-integrity', 'root-dn', 'usn',
'account-policy', 'attr-uniq', 'dna', 'linked-attr', 'managed-entries',
'pass-through-auth', 'retro-changelog', 'posix-winsync', 'contentsync', 'list',
'show', 'set')</pre></div><p>
    After enabling a plug-in, it is necessary to restart the server:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl restart dirsrv@<em class="replaceable">LDAPSERVER1</em>.service</code></pre></div><p>
 Next, configure the plug-in. The following example enables <code class="literal">MemberOf</code> to
 search all entries. Use your instance name rather than the server's
 hostname:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">LDAP1 plugin memberOf set --scope dc=example,dc=com</em></code>
Successfully changed the cn=MemberOf Plugin,cn=plugins,cn=config</pre></div><p>
 After the <code class="literal">MemberOf</code> plug-in is enabled and configured, all new groups and
 users are automatically <code class="literal">MemberOf</code> targets. However, any
 users and groups that exist before it is enabled are not. They must be
 marked manually:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm LDAP1 user modify suzanne add:objectclass:nsmemberof</code>
Successfully modified uid=suzanne,ou=people,dc=ldap1,dc=com</pre></div><p>
 Now suzanne information and group membership are listed
 with a single command:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm LDAP1 user get suzanne</code>
dn: uid=suzanne,ou=people,dc=ldap1,dc=com
cn: suzanne
displayName: Suzanne Geeko
gidNumber: 102
homeDirectory: /home/suzanne
memberOf: cn=SERVER_ADMINS,ou=groups,dc=ldap1,dc=com</pre></div><p>
 Modifying a larger number of users is a lot of work. The following
 example shows how to make all legacy users <code class="literal">MemberOf</code> targets with one
 <code class="command">fixup</code> command:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf LDAP1 plugin memberof fixup -f '(objectClass=*)' dc=LDAP1,dc=COM</code></pre></div><section class="sect2" id="sec-security-ldap-modules-unsupported-plugins" data-id-title="Unsupported plug-ins on 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.6.1 </span><span class="title-name">Unsupported plug-ins on 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-modules-unsupported-plugins">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_modules.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following plug-ins are not supported on 389 Directory Server:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Distributed Numeric Assignment (DNA) plug-in
   </p></li><li class="listitem"><p>
    Managed Entries Plug-in (MEP)
   </p></li><li class="listitem"><p>
    Posix Winsync plug-in
   </p></li></ul></div></section></section><section class="sect1" id="sec-security-ldap-server-sssd" data-id-title="Using SSSD to manage LDAP authentication"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.7 </span><span class="title-name">Using SSSD to manage LDAP authentication</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-server-sssd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_sssd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The System Security Services Daemon (SSSD) manages authentication,
    identification, and access controls for remote users. This section
    describes how to use SSSD to manage authentication and identification
    for your 389 Directory Server.
  </p><p>
    SSSD mediates between your LDAP server and clients. It supports several
    provider back-ends, such as LDAP, Active Directory, and
    Kerberos. SSSD supports services, including SSH, PAM, NSS, and sudo.
    SSSD provides performance benefits and resilience through caching user
    IDs and credentials. Caching reduces the number of requests to your
    389 DS server, and provides authentication and identity services
    when the back-ends are unavailable.
  </p><p>
    If the Name Services Caching Daemon (nscd) is running on your network,
    you should disable or remove it. nscd caches only the common name
    service  requests, such as passwd, group, hosts, service, and netgroup,
    and will conflict with SSSD.
  </p><p>
    Your LDAP server is the provider, and your SSSD instance is the client
    of the provider. You may install SSSD on your 389 DS server, but
    installing it on a separate machine provides some resilience in case the
    389 DS server becomes unavailable. Use the following procedure to
    install and configure an SSSD client. The example 389 DS instance name
    is <em class="replaceable">LDAP1</em>:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
    Install the <code class="systemitem">sssd</code> and <code class="systemitem">sssd-ldap</code> packages:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">zypper in sssd sssd-ldap</code></pre></div></li><li class="step"><p>
    Back up the <code class="filename">/etc/sssd/sssd.conf</code> file, if it exists:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">old /etc/sssd/sssd.conf</code></pre></div></li><li class="step"><p>
     Create your new SSSD configuration template. The allowed output file
     names are <code class="literal">sssd.conf</code> and
     <code class="literal">ldap.conf</code>.
     <code class="literal">display</code> sends the output to stdout. The following
     example creates a client configuration in
     <code class="filename">/etc/sssd/sssd.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">cd /etc/sssd</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsidm <em class="replaceable">LDAP1</em> client_config sssd.conf</code></pre></div></li><li class="step"><p>
      Review the output and make any necessary changes to suit your
      environment. The following <code class="filename">/etc/sssd/sssd.conf</code>
      file demonstrates a working example.
    </p><div id="id-1.8.4.5.11.6.4.2" data-id-title="MemberOf" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: MemberOf</div><p>
      The LDAP access filter relies on <code class="literal">MemberOf</code> being
      configured. For details, see <a class="xref" href="cha-security-ldap.html#sec-security-ldap-modules" title="5.6. Managing plug-ins">Section 5.6, “Managing plug-ins”</a>.
     </p></div><div class="verbatim-wrap"><pre class="screen">[sssd]
services = nss, pam, ssh, sudo
config_file_version = 2
domains = default

[nss]
homedir_substring = <em class="replaceable">/home</em>

[domain/default]
# If you have large groups (for example, 50+ members),
# you should set this to True
ignore_group_members = False
debug_level=3
cache_credentials = True
id_provider = ldap
auth_provider = ldap
access_provider = ldap
chpass_provider = ldap

ldap_schema = rfc2307bis
ldap_search_base = <em class="replaceable">dc=example,dc=com</em>
# We strongly recommend ldaps
ldap_uri = <em class="replaceable">ldaps://ldap.example.com</em>
ldap_tls_reqcert = demand
ldap_tls_cacert = /etc/openldap/ldap.crt
ldap_access_filter = (|(memberof=cn=&lt;login group&gt;,ou=Groups,dc=example,dc=com))
enumerate = false
access_provider = ldap

ldap_user_member_of = memberof
ldap_user_gecos = cn
ldap_user_uuid = nsUniqueId
ldap_group_uuid = nsUniqueId
ldap_account_expire_policy = rhds
ldap_access_order = filter, expire
# add these lines to /etc/ssh/sshd_config
#  AuthorizedKeysCommand /usr/bin/sss_ssh_authorizedkeys
#  AuthorizedKeysCommandUser nobody
ldap_user_ssh_public_key = nsSshPublicKey</pre></div></li><li class="step"><p>
      Set file ownership to root, and restrict read-write permissions to root:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">chown root:root /etc/sssd/sssd.conf</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">chmod 600 /etc/sssd/sssd.conf</code></pre></div></li><li class="step"><p>
      Edit the
      <code class="filename">/etc/nsswitch.conf</code> configuration file on
      the SSSD server to include the following lines:
    </p><div class="verbatim-wrap"><pre class="screen">passwd: compat sss
group:  compat sss
shadow: compat sss</pre></div></li><li class="step"><p>
    Edit the PAM configuration on the SSSD server, modifying <code class="filename">common-account-pc</code>,
    <code class="filename">common-auth-pc</code>,
<code class="filename">common-password-pc</code>, and
<code class="filename">common-session-pc</code>. SUSE Linux Enterprise provides a command to
modify all of these files at once, <code class="command">pam-config</code>:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">pam-config -a --sss</code></pre></div></li><li class="step"><p>
      Verify the modified configuration:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">pam-config -q --sss</code>
auth:
account:
password:
session:</pre></div></li><li class="step"><p>
      Copy <code class="filename">/etc/dirsrv/slapd-<em class="replaceable">LDAP1/</em>ca.crt</code>
      from the 389 DS server to <code class="filename">/etc/openldap/certs</code> on your SSSD server, then rehash it:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">c_rehash /etc/openldap/certs</code></pre></div></li><li class="step"><p>
     Enable and start SSSD:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl enable --now sssd</code></pre></div></li></ol></div></div><p>
    See <a class="xref" href="cha-security-auth.html" title="Chapter 4. Setting up authentication clients using YaST">Chapter 4, <em>Setting up authentication clients using YaST</em></a> for information on managing the
    sssd.service with systemctl.
  </p><section class="sect2" id="sec-security-ldap-server-sssd-unsupported-password-hash" data-id-title="Unsupported password hashes and authentication schemes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.7.1 </span><span class="title-name">Unsupported password hashes and authentication schemes</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-server-sssd-unsupported-password-hash">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_sssd.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following are not supported as configuration values in <code class="systemitem">dse.ldif</code> for
    the settings <code class="systemitem">nsslapd-rootpwstoragescheme</code> or
    <code class="systemitem">passwordStorageScheme</code>, or as a value of
    <code class="systemitem">passwordStorageScheme</code> in the account policy objects:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>SHA</p></li><li class="listitem"><p>SSHA</p></li><li class="listitem"><p>SHA256</p></li><li class="listitem"><p>SSHA256</p></li><li class="listitem"><p>SHA384</p></li><li class="listitem"><p>SSHA384</p></li><li class="listitem"><p>SHA512</p></li><li class="listitem"><p>SSHA512</p></li><li class="listitem"><p>NS-MTA-MD5</p></li><li class="listitem"><p>clear</p></li><li class="listitem"><p>MD5</p></li><li class="listitem"><p>SMD5</p></li></ul></div><div id="id-1.8.4.5.11.8.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      Database imports that contain these values are supported if
      <code class="systemitem">nsslapd-enable-upgrade-hash</code> is set to <code class="systemitem">on</code>
      (defaults to <code class="systemitem">on</code>).
    </p></div></section></section><section class="sect1" id="sec-security-ldap-migrate" data-id-title="Migrating to 389 Directory Server from OpenLDAP"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.8 </span><span class="title-name">Migrating to 389 Directory Server from OpenLDAP</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-migrate">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_migrate_test.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     OpenLDAP is deprecated<span class="phrase"> and no longer supported as of
     SUSE Linux Enterprise 15 SP3</span>.
     It has been replaced by 389 Directory Server. SUSE provides the
     <code class="command">openldap_to_ds</code> utility to assist with migration, included
     in the <span class="package">389-ds</span> package.
   </p><p>
     The <code class="command">openldap_to_ds</code> utility is designed to automate as
     much of the migration as possible. However, every LDAP deployment is
     different, and it is not possible to write a tool that satisfies all
     situations. It is likely there will be some manual steps to perform, and
     you should test your migration procedure thoroughly before attempting a
     production migration.
   </p><section class="sect2" id="sec-security-ldap-migrate-test" data-id-title="Testing migration from OpenLDAP"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.8.1 </span><span class="title-name">Testing migration from OpenLDAP</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-migrate-test">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_migrate_test.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     There are enough differences between OpenLDAP and 389 Directory Server that
     migration will probably involve repeated testing and adjustments.
     It can be helpful to do a quick migration test to get an idea of what
     steps will be necessary for a successful migration.
   </p><p>
     Prerequisites:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        A running 389 Directory Server instance.
     </p></li><li class="listitem"><p>
       An OpenLDAP <code class="filename">slapd</code> configuration file or directory
       in dynamic ldif format.
     </p></li><li class="listitem"><p>
        An ldif file backup of your OpenLDAP database.
     </p></li></ul></div><p>
     If your slapd configuration is not in dynamic ldif format, create a
     dynamic copy with <code class="command">slaptest</code>. Create a
     <code class="filename">slapd.d</code> directory, for example 
     <code class="filename">/root/slapd.d/</code>, then run the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">slaptest -f /etc/openldap/slapd.conf -F /root/slapd.d</code></pre></div><p>
       This results in several files similar to the following example:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">ls /root/slapd.d/*</code>

/root/slapd.d/cn=config.ldif

/root/slapd.d/cn=config:
cn=module{0}.ldif  cn=schema.ldif                 olcDatabase={0}config.ldif
cn=schema          olcDatabase={-1}frontend.ldif  olcDatabase={1}mdb.ldif</pre></div><p>
     Create one ldif file per suffix. In the following examples, the suffix
     is 
     dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em>. If you are using the
     <code class="filename">/etc/openldap/slapd.conf</code>
     format, use the following command to create the ldif backup file:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">slapcat -f /etc/openldap/slapd.conf -b dc=<em class="replaceable">LDAP1</em>,dc=<em class="replaceable">COM</em></code> \
<code class="command">-l <em class="replaceable">/root/LDAP1-COM</em>.ldif</code></pre></div><p>
     Use <code class="command">openldap_to_ds</code> to analyze the configuration and
     files, and show a migration plan without changing anything:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">openldap_to_ds <em class="replaceable">LDAP1</em></code>\
<code class="command">/root/slapd.d <em class="replaceable">/root/LDAP1-COM</em>.ldif.ldif</code></pre></div><p>
     This performs a dry run and does not change anything. The output looks
     like this:
   </p><div class="verbatim-wrap"><pre class="screen">Examining OpenLDAP Configuration ...
Completed OpenLDAP Configuration Parsing.
Examining Ldifs ...
Completed Ldif Metadata Parsing.
The following migration steps will be performed:
 * Schema Skip Unsupported Attribute -&gt; otherMailbox (0.9.2342.19200300.100.1.22)
 * Schema Skip Unsupported Attribute -&gt; dSAQuality (0.9.2342.19200300.100.1.49)
 * Schema Skip Unsupported Attribute -&gt; singleLevelQuality (0.9.2342.19200300.100.1.50)
 * Schema Skip Unsupported Attribute -&gt; subtreeMinimumQuality (0.9.2342.19200300.100.1.51)
 * Schema Skip Unsupported Attribute -&gt; subtreeMaximumQuality (0.9.2342.19200300.100.1.52)
 * Schema Create Attribute -&gt; suseDefaultBase (SUSE.YaST.ModuleConfig.Attr:2)
 * Schema Create Attribute -&gt; suseNextUniqueId (SUSE.YaST.ModuleConfig.Attr:3)
[...]
 * Schema Create ObjectClass -&gt; suseDhcpConfiguration (SUSE.YaST.ModuleConfig.OC:10)
 * Schema Create ObjectClass -&gt; suseMailConfiguration (SUSE.YaST.ModuleConfig.OC:11)
 * Database Reindex -&gt; dc=example,dc=com
 * Database Import Ldif -&gt; dc=example,dc=com from example.ldif - 
excluding entry attributes = [{'structuralobjectclass', 'entrycsn'}]
No actions taken. To apply migration plan, use '--confirm'</pre></div><p>
     The following example performs the migration, and the output looks
     different from the dry run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">openldap_to_ds <em class="replaceable">LDAP1</em> /root/slapd.d <em class="replaceable">/root/LDAP1-COM</em>.ldif --confirm</code>
Starting Migration ... This may take some time ...
migration: 1 / 40 complete ...
migration: 2 / 40 complete ...
migration: 3 / 40 complete ...
[...]
Index task index_all_05252021_120216 completed successfully
post: 39 / 40 complete ...
post: 40 / 40 complete ...
🎉 Migration complete!
----------------------
You should now review your instance configuration and data:
 * [ ] - Create/Migrate Database Access Controls (ACI)
 * [ ] - Enable and Verify TLS (LDAPS) Operation
 * [ ] - Schedule Automatic Backups
 * [ ] - Verify Accounts Can Bind Correctly
 * [ ] - Review Schema Inconistent ObjectClass -&gt; pilotOrganization (0.9.2342.19200300.100.4.20)
 * [ ] - Review Database Imported Content is Correct -&gt; dc=ldap1,dc=com</pre></div><p>
     When the migration is complete, <code class="command">openldap_to_ds</code>
     creates a checklist of post-migration tasks that must be completed.
     It is a best practice to document all of your post-migration steps,
     so that you can reproduce them in your post-production procedures.
     Then test clients and application integrations to the migrated 389 Directory Server
     instance.
   </p><div id="id-1.8.4.5.12.4.18" data-id-title="Develop a rollback plan" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Develop a rollback plan</div><p>
       It is essential to develop a rollback plan in case of any failures.
       This plan should define a successful migration, the tests to determine
       what worked and what needs to be fixed, which steps are critical, what
       can be deferred until later, how to decide when to undo any changes,
       how to undo them with minimal disruption, and which other teams need to be involved.
     </p></div><p>
     Due to the variability of deployments, it is difficult to provide
     a recipe for a successful production migration. Once you have
     thoroughly tested the migration process and verified that you will
     get good results, there are some general steps that will help:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        Lower all hostname/DNS TTLs to 5 minutes 48 hours before the change, to 
        allow a fast rollback to your existing OpenLDAP deployment.
      </p></li><li class="listitem"><p>
        Pause all data synchronization and incoming data processes, so that data 
        in the OpenLDAP environment does not change during the migration process.
      </p></li><li class="listitem"><p>
        Have all 389 Directory Server hosts ready for deployment before the migration.
      </p></li><li class="listitem"><p>
        Have your test migration documentation readily available.
      </p></li></ul></div></section><section class="sect2" id="sec-security-ldap-migrate-plan" data-id-title="Planning your migration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.8.2 </span><span class="title-name">Planning your migration</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-migrate-plan">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_migrate_test.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   As OpenLDAP is a <span class="quote">“<span class="quote">box of parts</span>”</span> and highly customizable, it is
   not possible to prescribe a <span class="quote">“<span class="quote">one size fits all</span>”</span> migration.
   It is necessary to assess your
   current environment and configuration with OpenLDAP and other integrations.
   This includes, and is not limited to:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Replication topology
    </p></li><li class="listitem"><p>
     High availability and load balancer configurations
    </p></li><li class="listitem"><p>
     External data flows (IGA, HR, AD, etc.)
    </p></li><li class="listitem"><p>
     Configured overlays (plug-ins in 389 Directory Server)
    </p></li><li class="listitem"><p>
     Client configuration and expected server features
    </p></li><li class="listitem"><p>
     Customized schema
    </p></li><li class="listitem"><p>
     TLS configuration
    </p></li></ul></div><p>
   Plan what your 389 Directory Server deployment will look like in the end. This includes
   the same list, except replace overlays with plugins. Once you have assessed
   your current environment, and planned what your 389 Directory Server environment will
   look like, you can then form a migration plan. We recommended building
   the 389 Directory Server environment in parallel to your OpenLDAP environment to allow
   switching between them.
  </p><p>
   Migrating from OpenLDAP to 389 Directory Server is a one-way migration. There are enough
   differences between the two that they cannot interoperate, and there is not
   a migration path from 389 Directory Server to OpenLDAP. The following table highlights
   the major similarities and differences.
  </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Feature</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">OpenLDAP</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">389 Directory Server</th><th style="border-bottom: 1px solid ; ">Compatible</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Two-way replication</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">SyncREPL</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">389 DS-specific system</td><td style="border-bottom: 1px solid ; ">No</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MemberOf</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Overlay</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Plug-in</td><td style="border-bottom: 1px solid ; ">Yes, simple configurations only</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">External Auth</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Proxy</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-</td><td style="border-bottom: 1px solid ; ">No</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Active Directory Synchronization</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Winsync Plug-in</td><td style="border-bottom: 1px solid ; ">No</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Inbuilt Schema</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OLDAP Schemas</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">389 Schemas</td><td style="border-bottom: 1px solid ; ">Yes, supported by migration tool</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Custom Schema</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OLDAP Schemas</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">389 Schemas</td><td style="border-bottom: 1px solid ; ">Yes, supported by migration tool</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Database Import</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">LDIF</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">LDIF</td><td style="border-bottom: 1px solid ; ">Yes, supported by migration tool</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Password hashes</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Varies</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Varies</td><td style="border-bottom: 1px solid ; ">Yes, all formats supported excluding Argon2</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">OpenLDAP to 389 DS replication</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-</td><td style="border-bottom: 1px solid ; ">No mechanism to replicate to 389 DS is possible</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Time-based one-time password (TOTP)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">TOTP overlay</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">-</td><td style="border-bottom: 1px solid ; ">No, currently not supported</td></tr><tr><td style="border-right: 1px solid ; ">entryUUID</td><td style="border-right: 1px solid ; ">Part of OpenLDAP</td><td style="border-right: 1px solid ; ">Plug-in</td><td>Yes</td></tr></tbody></table></div></section></section><section class="sect1" id="sec-security-ldap-server-ca" data-id-title="Importing TLS server certificates and keys"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.9 </span><span class="title-name">Importing TLS server certificates and keys</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-server-ca">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_ca.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  You can manage your CA certificates and keys for 389 Directory Server with the following
  command line tools: <code class="command">certutil</code>, <code class="command">openssl</code>, and
  <code class="command">pk12util</code>.
 </p><p>
  For testing purposes, you can use the self-signed certificate that
  <code class="command">dscreate</code> creates when you create a new 389 DS
  instance. Find the certificate at
  <code class="filename">/etc/dirsrv/slapd-<em class="replaceable">INSTANCE-NAME</em>/ca.crt</code>.
  </p><p>
    For production environments, it is a best practice to use a third-party
    certificate authority, such as Let's Encrypt, CAcert.org, SSL.com, or
    whatever CA you choose. Request a server certificate, a client
    certificate, and a root certificate.
  </p><div class="procedure"><div class="procedure-contents"><div id="id-1.8.4.5.13.5.1" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
  The Mozilla NSS (Network Security Services ) toolkit uses nicknames for certificates in the certificate store.
  The server certificate uses the nickname <span class="emphasis"><em>Server-Cert</em></span>.
  </p></div><ol class="procedure" type="1"><li class="step"><p>
   Use the following commands to remove the Self-Signed-CA and Server-Cert from the instance:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> tls remove-cert Self-Signed-CA</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> tls remove-cert Server-Cert
</code></pre></div><p>
   Replace <em class="replaceable">INSTANCE_NAME</em> with the instance name of the directory server.
   This is LDAP1 in the previous sections.
  </p></li><li class="step"><p>
    Import the CA that has signed your certificate.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">sudo dsctl <em class="replaceable">INSTANCE_NAME</em> tls import-ca
   /path/to/CA/in/PEM/format/CA.pem  <em class="replaceable">NICKNAME_FOR_CA</em>
</code></pre></div><p>Replace <code class="literal">INSTANCE_NAME</code> with the instance name of the directory server.
Replace <code class="literal">/path/to/CA/in/PEM/format/CA.pem</code> with the full path to the CA certificate file in the PEM format.
Replace <code class="literal">NICKNAME_FOR_CA </code> with a nickname for the CA. </p></li><li class="step"><p>
   Import the server certificate and the key for the certificate.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> tls import-server-key-cert
  <em class="replaceable">/path/to/SERVER.pem</em> <em class="replaceable">/path/to/SERVER.key</em></code></pre></div><p> Replace <code class="literal">INSTANCE_NAME</code> with the instance name of the directory server.
Replace <code class="literal">/path/to/SERVER.pem</code> with the full path to the server certificate in PEM format.
Replace <code class="literal">/path/to/SERVER.key</code> with the full path to the server certificate key file in the PEM format.
</p></li><li class="step"><p>
   Restart the instance so that the new certificates are used.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl restart dirsrv@<em class="replaceable">INSTANCE-NAME.</em>.service
</code></pre></div><p>Replace  <code class="literal">INSTANCE_NAME</code> with the instance name of the directory server.</p></li></ol></div></div></section><section class="sect1" id="sec-security-ldap-replication" data-id-title="Setting up replication"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.10 </span><span class="title-name">Setting up replication</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  389 Directory Server supports replicating its database content between multiple servers.
  According to the type of replication, this provides:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Faster performance and response times
   </p></li><li class="listitem"><p>
    Fault tolerance and failover
   </p></li><li class="listitem"><p>
    Load balancing
   </p></li><li class="listitem"><p>
    High availability
   </p></li></ul></div><p>
   A database is the smallest unit of a directory that can be replicated. You
   can replicate an entire database, but not a subtree within a database.
   One database must correspond to one suffix. You cannot replicate a suffix
   that is distributed over two or more databases.
 </p><p>
   A replica that sends data to another replica is a supplier. A replica
   that receives data from a supplier is a consumer. Replication is always
   initiated by the supplier, and a single supplier can send data to multiple
   consumers. Usually the supplier
   is a read-write replica, and the consumer is read-only, except in the
   case of multi-supplier replication. In multi-supplier replication the
   suppliers are both suppliers and consumers of the same data.
 </p><section class="sect2" id="sec-security-ldap-replication-async" data-id-title="Asynchronous writes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.1 </span><span class="title-name">Asynchronous writes</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-async">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   389 DS manages replication differently than other databases. Replication
   is asynchronous, and eventually consistent. This means:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Any write or change to a single server is immediately accepted.
    </p></li><li class="listitem"><p>
     There is a delay between a write finishing on one
     server, and then replicating and being visible on other servers.
    </p></li><li class="listitem"><p>
     If that write conflicts with writes on other servers, it may be rolled
     back at some point in the future.
    </p></li><li class="listitem"><p>
     Not all servers may show identical content at the same time due to
     replication delay.
    </p></li></ul></div><p>
   In general, as LDAP is "low-write", these factors mean that all servers are
   at least up to a common baseline of a known consistent state. Small changes
   occur on top of this baseline, so many of these aspects of delayed
   replication are not perceived in day to day usage.
  </p></section><section class="sect2" id="sec-security-ldap-replication-topology" data-id-title="Designing your topology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.2 </span><span class="title-name">Designing your topology</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-topology">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Consider the following factors when you are designing your replication
   topology.
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     The need for replication: high availability, geo-location, read scaling,
     or a combination of all.
    </p></li><li class="listitem"><p>
     How many replicas (nodes, servers) you plan to have in your topology.
    </p></li><li class="listitem"><p>
     Direction of data flows, both inside of the topology, and data flowing
     into the topology.
    </p></li><li class="listitem"><p>
     How clients will balance across nodes of the topology for their requests
     (multiple ldap URIs, SRV records, load balancers).
    </p></li></ul></div><p>
   These factors all affect how you may create your topology. (See
   <a class="xref" href="cha-security-ldap.html#sec-security-ldap-replication-topologies" title="5.10.3. Example replication topologies">Section 5.10.3, “Example replication topologies”</a> for some
   topology examples.)
  </p></section><section class="sect2" id="sec-security-ldap-replication-topologies" data-id-title="Example replication topologies"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.3 </span><span class="title-name">Example replication topologies</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-topologies">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following sections provide examples of replication topologies, using two
   to six 389 Directory Server nodes. The maximum number of supported supplier replicas in
   a topology is 20. Operational experience shows the optimal number for
   replication efficiency is a maximum of eight.
  </p><section class="sect3" id="sec-security-ldap-replication-two-replicas" data-id-title="Two replicas"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.3.1 </span><span class="title-name">Two replicas</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-two-replicas">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><div class="example" id="ex-ldap-replication-two-replicas" data-id-title="Two supplier replicas"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.4: </span><span class="title-name">Two supplier replicas </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#ex-ldap-replication-two-replicas">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">┌────┐       ┌────┐
│ S1 │◀─────▶│ S2 │
└────┘       └────┘</pre></div></div></div><p>
    In <a class="xref" href="cha-security-ldap.html#ex-ldap-replication-two-replicas" title="Two supplier replicas">Example 5.4, “Two supplier replicas”</a> there are two replicas,
    S1 and S2, which replicate bi-directionally between each other, so they
    are both suppliers and consumers. S1 and S2
    could be in separate data centers, or in the same data center. Clients can
    balance across the servers using LDAP URIs, a load balancer, or DNS SRV
    records. This is the simplest topology for high availability. Note that
    each server needs to be able to provide 100% of client load, in case the
    other server is offline for any reason. A two-node replication is
    generally not adequate for horizontal read scaling, as a single node will
    handle all read requests if the other node is offline.
   </p><div id="id-1.8.4.5.14.8.3.4" data-id-title="Default topology" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Default topology</div><p>
       The two-node topology should be considered the default topology,
       because it is the simplest to manage. You can expand your toplogy,
       over time, as necessary.
     </p></div></section><section class="sect3" id="sec-security-ldap-replication-four-replicas" data-id-title="Four supplier replicas"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.3.2 </span><span class="title-name">Four supplier replicas</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-four-replicas">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><div class="example" id="ex-ldap-replication-four-replicas" data-id-title="Four supplier replicas"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.5: </span><span class="title-name">Four supplier replicas </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#ex-ldap-replication-four-replicas">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">┌────┐       ┌────┐
│ S1 │◀─────▶│ S2 │
└────┘       └────┘
   ▲            ▲
   │            │
   ▼            ▼
┌────┐       ┌────┐
│ S3 │◀─────▶│ S4 │
└────┘       └────┘</pre></div></div></div><p>
    <a class="xref" href="cha-security-ldap.html#ex-ldap-replication-four-replicas" title="Four supplier replicas">Example 5.5, “Four supplier replicas”</a> has four supplier
    replicas, which all synchronize to each other. These
    could be in four datacenters, or two servers per datacenter. In the case of
    one node per data center, each node should be able to support 100% of
    client load. When there are two per datacenter, each one only needs to
    scale to 50% of the client load.
   </p></section><section class="sect3" id="sec-security-ldap-replication-six-replicas" data-id-title="Six replicas"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.3.3 </span><span class="title-name">Six replicas</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-six-replicas">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><div class="example" id="ex-ldap-replication-six-replicas" data-id-title="Six replicas"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.6: </span><span class="title-name">Six replicas </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#ex-ldap-replication-six-replicas">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">                  ┌────┐       ┌────┐
                  │ S1 │◀─────▶│ S2 │
                  └────┘       └────┘
                     ▲            ▲
                     │            │
   ┌────────────┬────┴────────────┴─────┬────────────┐
   │            │                       │            │
   ▼            ▼                       ▼            ▼
┌────┐       ┌────┐                  ┌────┐       ┌────┐
│ S3 │◀─────▶│ S4 │                  │ S5 │◀─────▶│ S6 │
└────┘       └────┘                  └────┘       └────┘</pre></div></div></div><p>
    In <a class="xref" href="cha-security-ldap.html#ex-ldap-replication-six-replicas" title="Six replicas">Example 5.6, “Six replicas”</a>, each pair is in a
    separate location. S1 and S2 are the suppliers, and S3, S4, S5, and
    S6 are consumers of S1 and S2. Each pair of servers replicate to each
    other. S3, S4, S5, and S6 can accept writes, though most of the
    replication is done through S1 and S2. This setup provides geographic
    separation for high availability and scaling.
   </p></section><section class="sect3" id="sec-security-ldap-replication-six-replicas-read-only" data-id-title="Six replicas with read-only consumers"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.3.4 </span><span class="title-name">Six replicas with read-only consumers</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-six-replicas-read-only">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><div class="example" id="ex-ldap-replication-six-replicas-read-only" data-id-title="Six replicas with read-only consumers"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 5.7: </span><span class="title-name">Six replicas with read-only consumers </span></span><a title="Permalink" class="permalink" href="cha-security-ldap.html#ex-ldap-replication-six-replicas-read-only">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">             ┌────┐       ┌────┐
             │ S1 │◀─────▶│ S2 │
             └────┘       └────┘
                │            │
                │            │
   ┌────────────┼────────────┼────────────┐
   │            │            │            │
   ▼            ▼            ▼            ▼
┌────┐       ┌────┐       ┌────┐       ┌────┐
│ S3 │       │ S4 │       │ S5 │       │ S6 │
└────┘       └────┘       └────┘       └────┘</pre></div></div></div><p>
    In <a class="xref" href="cha-security-ldap.html#ex-ldap-replication-six-replicas-read-only" title="Six replicas with read-only consumers">Example 5.7, “Six replicas with read-only consumers”</a>, S1 and S2 are the suppliers, and the other four
    servers are read-only consumers. All changes occur on S1 and S2, and are
    propagated to the four replicas. Read-only consumers can be configured to
    store only a subset of the database, or partial entries, to limit data
    exposure. You could have a fractional read-only server in a DMZ, for
    example, so that if data is exposed, changes can not propagate back to
    the other replicas.
   </p></section></section><section class="sect2" id="sec-security-ldap-replication-terminology" data-id-title="Terminology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.4 </span><span class="title-name">Terminology</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-terminology">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In the example topologies we have seen that 389 DS can take on a
   number of roles in a topology. The following list clarifies the terminology.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.8.4.5.14.9.3.1"><span class="term">Replica</span></dt><dd><p>
      An instance of 389 DS with an attached database.
     </p></dd><dt id="id-1.8.4.5.14.9.3.2"><span class="term">Read-write replica</span></dt><dd><p>
      A replica with a full copy of a database, that accepts read and write
      operations.
     </p></dd><dt id="id-1.8.4.5.14.9.3.3"><span class="term">Read-only replica</span></dt><dd><p>
      A replica with a full copy of a database, that only accepts read
      operations.
     </p></dd><dt id="id-1.8.4.5.14.9.3.4"><span class="term">Fractional read-only replica</span></dt><dd><p>
      A replica with a partial copy of a database, that only accepts read-
      only operations.
     </p></dd><dt id="id-1.8.4.5.14.9.3.5"><span class="term">Supplier</span></dt><dd><p>
      A replica that supplies data from its database to another replica.
     </p></dd><dt id="id-1.8.4.5.14.9.3.6"><span class="term">Consumer</span></dt><dd><p>
      A replica that receives data from another replica to write into its
      database.
     </p></dd><dt id="id-1.8.4.5.14.9.3.7"><span class="term">Replication agreement</span></dt><dd><p>
      The configuration of a server defining its supplier and consumer relation
      to another replica.
     </p></dd><dt id="id-1.8.4.5.14.9.3.8"><span class="term">Topology</span></dt><dd><p>
      A set of replicas connected via replication agreements.
     </p></dd><dt id="id-1.8.4.5.14.9.3.9"><span class="term">Replica ID</span></dt><dd><p>
      A unique identifier of the 389 Directory Server instance within the replication
      topology.
     </p></dd><dt id="id-1.8.4.5.14.9.3.10"><span class="term">Replication manager</span></dt><dd><p>
      An account with replication rights in the directory.
     </p></dd></dl></div></section><section class="sect2" id="sec-security-ldap-replication-configuration" data-id-title="Configuring replication"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.5 </span><span class="title-name">Configuring replication</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-configuration">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The first example sets up a two node bi-directional replication with a
   single read-only server, as a minimal starting example. In the following
   examples, the host names of the two read-write nodes are RW1 and RW2, and
   the read-only server is RO1. (Of course you must use your own host names.)
   </p><p>
   All servers should have a backend with an identical suffix. Only one server,
   RW1, needs an initial copy of the database.
  </p><section class="sect3" id="sec-security-ldap-replication-two-nodes" data-id-title="Configuring two-node replication"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.5.1 </span><span class="title-name">Configuring two-node replication</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-two-nodes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following commands configure the read-write replicas in a two-node setup
    (<a class="xref" href="cha-security-ldap.html#ex-ldap-replication-two-replicas" title="Two supplier replicas">Example 5.4, “Two supplier replicas”</a>), with the hostnames
    RW1 and RW2. (Remember to use your own hostnames.)
  </p><div id="id-1.8.4.5.14.10.4.3" data-id-title="Create a strong replication manager password" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Create a strong replication manager password</div><p>
    The replication manager should be considered equivalent to the
    directory manager, in terms of security and access, and should
    have a very strong password.
  </p><p>
    If you create different replication manager passwords for each server,
    be sure to keep track of which password belongs to which server. For
    example, when you configure the outbound connection in RW1's replication agreement,
    you need to set the replication manager password to the RW2 replication manager password.
  </p></div><p>
First, configure RW1:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> replication create-manager</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> replication enable</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em></code> \
<code class="command">--role supplier --replica-id <em class="replaceable">1</em> --bind-dn "cn=replication manager,cn=config"</code></pre></div><p>
   Configure RW2:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> replication create-manager</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> replication enable</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em></code> \
<code class="command">--role supplier --replica-id <em class="replaceable">2</em> --bind-dn "cn=replication manager,cn=config"</code></pre></div><p>
   This will create the replication metadata required on RW1 and RW2. Note the
   difference in the <code class="option">replica-id</code> between the two servers. This
   also creates the replication manager account, which is an account with
   replication rights for authenticating between the two nodes.
  </p><p>
   RW1 and RW2 are now both configured to have replication metadata. The next
   step is to create the first agreement for outbound data from RW1 to RW2.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-agmt create</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em></code> \
<code class="command">--host=<em class="replaceable">RW2</em> --port=636 --conn-protocol LDAPS --bind-dn "cn=replication manager,cn=config"</code> \
<code class="command">--bind-passwd <em class="replaceable">PASSWORD</em> --bind-method SIMPLE <em class="replaceable">RW1_to_RW2</em></code></pre></div><p>
   Data will not flow from RW1 to RW2 until after a full synchronization
   of the database, which is called an initialization or reinit. This will
   reset all database content on RW2 to match the content of RW1. Run the
   following command to trigger a reinit of the data:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-agmt init</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em> <em class="replaceable">RW1_to_RW2</em></code></pre></div><p>
   Check the status by running this command on RW1:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-agmt init-status</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em> <em class="replaceable">RW1_to_RW2</em></code></pre></div><p>
   When it is finished, you should see an "Agreement successfully initialized"
   message. If you get an error message, check the errors log. Otherwise, you
   should see the identical content from RW1 on RW2.
  </p><p>
   Finally, to make this bi-directional, configure a replication agreement
   from RW2 outbound to RW1:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-agmt create</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em></code> \
<code class="command">--host=<em class="replaceable">RW1</em> --port=636 --conn-protocol LDAPS</code> \
<code class="command">--bind-dn "cn=replication manager,cn=config" --bind-passwd <em class="replaceable">PASSWORD</em></code> \
<code class="command">--bind-method SIMPLE <em class="replaceable">RW2_to_RW1</em></code></pre></div><p>
   Changes made on either RW1 or RW2 will now be replicated to the other. Check
   replication status on either server with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-agmt status</code> \
<code class="command">--suffix <em class="replaceable">dc=example,dc=com</em></code> \
<code class="command">--bind-dn "cn=replication manager,cn=config"</code> \
<code class="command">--bind-passwd <em class="replaceable">PASSWORD</em> <em class="replaceable">RW2_to_RW1</em></code></pre></div></section><section class="sect3" id="sec-security-ldap-replication-four-nodes" data-id-title="Configuring a read-only node"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">5.10.5.2 </span><span class="title-name">Configuring a read-only node</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-four-nodes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To create a read-only node, start by creating the replication
   manager account and metadata. The hostname of the example server
   is RO3:
 </p><div id="id-1.8.4.5.14.10.5.3" data-id-title="Create a strong replication manager password" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Create a strong replication manager password</div><p>
    The replication manager should be considered equivalent to the
    directory manager, in terms of security and access, and should
    have a very strong password.
  </p><p>
    If you create different replication manager passwords for each server,
    be sure to keep track of which password belongs to which server. For
    example, when you configure the outbound connection in RW1's replication agreement,
    you need to set the replication manager password to the RW2 replication manager password.
  </p></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> replication create-manager</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command"> dsconf <em class="replaceable">INSTANCE_NAME</em></code> \
<code class="command">replication enable --suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em></code> \
<code class="command">--role consumer --bind-dn "cn=replication manager,cn=config"</code></pre></div><p>
  Note that for a read-only replica, you do not provide a replica-id, and the
  role is set to <code class="literal">consumer</code>. This allocates a
  special read-only replica-id for all read-only replicas. After the read-only
  replica is created, add the replication agreements from RW1 and RW2
  to the read-only instance. The following example is on RW1:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em></code> \
<code class="command">repl-agmt create --suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em></code> \
<code class="command">--host=<em class="replaceable">RO3</em> --port=636 --conn-protocol LDAPS</code> \
<code class="command">--bind-dn "cn=replication manager,cn=config" --bind-passwd <em class="replaceable">PASSWORD</em></code>
<code class="command">--bind-method SIMPLE <em class="replaceable">RW1_to_RO3</em></code></pre></div><p>
  The following example, on RW2, configures the replication agreement between RW2 and
  RO3:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt create</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em></code> \
<code class="command">--host=<em class="replaceable">RO3</em> --port=636 --conn-protocol LDAPS</code> \
<code class="command">--bind-dn "cn=replication manager,cn=config" --bind-passwd <em class="replaceable">PASSWORD</em></code> \
<code class="command">--bind-method SIMPLE <em class="replaceable">RW2_to_RO3</em></code></pre></div><p>
  After these steps are completed, you can use either RW1 or RW2 to perform
  the initialization of the database on RO3. The following example
  initalizes RO3 from RW2:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt init</code>
<code class="command">--suffix dc=<em class="replaceable">EXAMPLE,dc=COM</em> <em class="replaceable">RW2_to_RO3</em></code></pre></div></section></section><section class="sect2" id="sec-security-ldap-replication-monitoring-healthcheck" data-id-title="Monitoring and healthcheck"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.6 </span><span class="title-name">Monitoring and healthcheck</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-monitoring-healthcheck">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The <code class="command">dsconf</code> command includes a monitoring option. You can check the status of each
  replica status directly on the replicas, or from other hosts. The following example commands are run on RW1,
  checking the status on two remote replicas, and then on itself:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf -D "cn=Directory Manager" ldap://<em class="replaceable">RW2</em> replication monitor</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf -D "cn=Directory Manager" ldap://<em class="replaceable">RO3</em> replication monitor</code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf -D "cn=Directory Manager" ldap://<em class="replaceable">RW1</em> replication monitor</code></pre></div><p>
  The <code class="command">dsctl</code> command has a <code class="option">healthcheck</code> option. The following
  example runs a replication healthcheck on the local 389 DS instance:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> healthcheck --check replication</code></pre></div><p>
  Use the <code class="option">-v</code> option for verbosity, to see what the healthcheck examines:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl -v <em class="replaceable">INSTANCE_NAME</em> healthcheck --check replication</code></pre></div><p>
  Run <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> healthcheck</code>
  with no options for a general health check.
</p><p>
  Run the following command to see a list of the checks that healthcheck
  performs:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> healthcheck --list-checks</code>
config:hr_timestamp
config:passwordscheme
backends:userroot:cl_trimming
backends:userroot:mappingtree
backends:userroot:search
backends:userroot:virt_attrs
encryption:check_tls_version
fschecks:file_perms
[...]</pre></div><p>
  You can run one or more of the individual checks:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsctl <em class="replaceable">INSTANCE_NAME</em> healthcheck</code> \
<code class="command">--check monitor-disk-space:disk_space tls:certificate_expiration</code></pre></div></section><section class="sect2" id="sec-security-ldap-replication-backups" data-id-title="Making backups"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.7 </span><span class="title-name">Making backups</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-backups">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When replication is
   enabled, you need to adjust your 389 Directory Server backup strategy
   (see <a class="xref" href="cha-security-ldap.html#sec-security-ldap-backup" title="5.4. Backing up and restoring 389 Directory Server">Section 5.4, “Backing up and restoring 389 Directory Server”</a> to learn about
   making backups). If you are using
   <code class="command">db2ldif</code>, you must add the <code class="option">--replication</code> flag
   to ensure that replication
   metadata is backed up. You should backup all servers in the topology. When
   restoring from backup, start by restoring a single node of the topology, then
   reinitialize all other nodes as new instances.
 </p></section><section class="sect2" id="sec-security-ldap-replication-pause-resume" data-id-title="Pausing and resuming replication"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.8 </span><span class="title-name">Pausing and resuming replication</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-pause-resume">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can pause replication during maintenance windows, or anytime you need to
    stop it. A node of the topology can only be offline for a maximum of days
    up to the limit of the changelog
    (see <a class="xref" href="cha-security-ldap.html#sec-security-ldap-replication-changelog" title="5.10.9.  Changelog max-age">Section 5.10.9, “ Changelog max-age”</a>).
  </p><p>
    Use the <code class="command">repl-agmt</code> command to pause replication. The
    following example is on RW2:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt disable</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> <em class="replaceable">RW2_to_RW1</em></code></pre></div><p>
  The following example re-enables replication:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt enable</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> <em class="replaceable">RW2_to_RW1</em></code></pre></div></section><section class="sect2" id="sec-security-ldap-replication-changelog" data-id-title="Changelog max-age"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.9 </span><span class="title-name"> Changelog max-age</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-changelog">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A replica can be offline for up to the length of time defined by
   the changelog <code class="option">max-age</code> option. <code class="option">max-age</code>
   defines the maximum age of any entry in the changelog. Any items older
   than the <code class="option">max-age</code> value are automatically removed.
 </p><p>
   After the replica comes back online, it will synchronize with the other
   replicas. If it is offline for longer than the <code class="option">max-age</code> value,
   the replica will need to be re-initialised, and will refuse to accept or
   provide changes to other nodes, as they may be inconsistent. The following
   example sets the <code class="option">max-age</code> to seven days:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em></code> \
<code class="command">replication set-changelog --max-age 7d</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em></code></pre></div></section><section class="sect2" id="sec-security-ldap-replication-remove-replica" data-id-title="Removing a replica"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.10 </span><span class="title-name">Removing a replica</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-remove-replica">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To remove a replica, first fence the node to prevent any incoming changes
   or reads. Then, find all servers that have incoming replication agreements
   with the node you are removing, and remove them. The following example
   removes RW2. Start by disabling the outbound replication agreement on RW1:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt delete</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> <em class="replaceable">RW1_to_RW2</em></code></pre></div><p>
  On the replica you are removing, which in the following example is RW2, remove all outbound agreements:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt delete</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> <em class="replaceable">RW2_to_RW1</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-agmt delete</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> <em class="replaceable">RW2_to_RO3</em></code></pre></div><p>
  Stop the instance on RW2:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">systemctl stop dirsrv@<em class="replaceable">INSTANCE_NAME</em>.service</code></pre></div><p>
  Then run the <code class="command">cleanallruv</code> command to remove the replica ID from the topology.
  The following example is run on RW1:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-tasks cleanallruv</code> \
<code class="command">--suffix <em class="replaceable">dc=EXAMPLE,dc=COM</em> --replica-id <em class="replaceable">2</em></code>
<code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE_NAME</em> repl-tasks list-cleanruv-tasks</code></pre></div></section><section class="sect2" id="sec-security-ldap-replication-limits" data-id-title="Limitations on replication of 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.10.11 </span><span class="title-name">Limitations on replication of 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-replication-limits">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_replication.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The use of 389 Directory Server is supported within the following replication limits:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     A maximum of 8 read-write nodes
    </p></li><li class="listitem"><p>
     A maximum of 20 replication hubs
    </p></li><li class="listitem"><p>
     A maximum of 100 read-only servers
    </p></li><li class="listitem"><p>
     A maximum of 1 Winsync Active Directory consumer as a read-write node member
    </p></li></ul></div></section></section><section class="sect1" id="sec-security-ldap-active-directory-sync" data-id-title="Synchronizing with Microsoft Active Directory"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.11 </span><span class="title-name">Synchronizing with Microsoft Active Directory</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-active-directory-sync">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_active_directory_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    389 Directory Server supports synchronizing some user and group content
    from Microsoft's Active Directory, so that Linux clients can use
    389 DS for their identity information without the normally required
    domain join process. This also allows 389 DS to extend and use its
    other features with the data synchronised from Active Directory.
  </p><section class="sect2" id="sec-security-ldap-synchronization-planning" data-id-title="Planning your synchronization topology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.11.1 </span><span class="title-name">Planning your synchronization topology</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-synchronization-planning">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_active_directory_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Due to how the synchronization works, only a single 389 Directory Server and
    Active Directory server are involved. The Active Directory server must be a full Domain
    Controller, and not a Read Only Domain Controller (RODC).
    The Global Catalog is not required on the DC that is synchronized, as
    389 DS only replicates the content of a single forest in a domain.
  </p><p>
    You must first chooose the direction of your data flow. There are three
    options: from AD to 389 DS, from 389 DS to AD, or bi-
    directional.
  </p><div id="id-1.8.4.5.15.3.4" data-id-title="No password synchronization" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: No password synchronization</div><p>
      Passwords cannot be synchronised between 389 DS and Active Directory.
      This may change in the future, to support Active Directory to 389 DS password
      flow.
    </p></div><p>
      Your topology will look like the following diagram. The 389 Directory Server and
      Active Directory topologies may differ, but the most important factor is to have
      only a single connection between 389 DS and Active Directory. It is very
      important to account for this in your disaster recovery and backup
      plans for both 389 DS and AD, to ensure that you correctly restore
      only a single replication connection between these topologies.
    </p><div class="verbatim-wrap"><pre class="screen">┌────────┐     ┌────────┐         ┌────────┐     ┌────────┐
│        │     │        │         │        │     │        │
│ 389-ds │◀───▶│ 389-ds │◀ ─ ─ ─ ▶│   AD   │◀───▶│   AD   │
│        │     │        │         │        │     │        │
└────────┘     └────────┘         └────────┘     └────────┘
    ▲               ▲                  ▲             ▲
    │               │                  │             │
    ▼               ▼                  ▼             ▼
┌────────┐     ┌────────┐         ┌────────┐     ┌────────┐
│        │     │        │         │        │     │        │
│ 389-ds │◀───▶│ 389-ds │         │   AD   │◀───▶│   AD   │
│        │     │        │         │        │     │        │
└────────┘     └────────┘         └────────┘     └────────┘</pre></div></section><section class="sect2" id="sec-security-ldap-synchronization-ad-prerequisites" data-id-title="Prerequisites for Active Directory"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.11.2 </span><span class="title-name">Prerequisites for Active Directory</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-synchronization-ad-prerequisites">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_active_directory_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A security group that is granted the "Replicating Directory Changes"
    permission is required. For example, you have created a group named
    "Directory Server Sync". Follow the steps in the "How to grant the
    'Replicating Directory Changes' permission for the Microsoft Metadirectory Services ADMA service account"
    (<a class="link" href="https://docs.microsoft.com/en-US/troubleshoot/windows-server/windows-security/grant-replicating-directory-changes-permission-adma-service" target="_blank">https://docs.microsoft.com/en-US/troubleshoot/windows-server/windows-security/grant-replicating-directory-changes-permission-adma-service</a> to set this up.
  </p><div id="id-1.8.4.5.15.4.3" data-id-title="Strong security needed" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Strong security needed</div><p>
      You should consider members of this group to be of equivalent security
      importance to Domain Administrators. Members of this group have the
      ability to read sensitive content from the Active Directory
      environment, so you should use strong, randomly-generated service
      account passwords for these accounts, and carefully audit membership to this group.
    </p></div><p>
    You should also create a service account that is a member of this group.
  </p><p>
    Your Active Directory environment must have certificates configured for LDAPS to
    ensure that authentication between 389 DS and AD is secure.
    Authentication with Generic Security Services API/Kerberos (GSSAPI/KRB)
    cannot be used.
  </p></section><section class="sect2" id="sec-security-ldap-synchronization-389ds-prerequisites" data-id-title="Prerequisites for 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.11.3 </span><span class="title-name">Prerequisites for 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-synchronization-389ds-prerequisites">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_active_directory_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The 389 Directory Server must have a backend database already configured with
    Organization Units (OUs) for entries to be synchronised into.
  </p><p>
    The 389 Directory Server must have a replica ID configured as though the server
    is a read-write replica. (For details about setting up replication see
    <a class="xref" href="cha-security-ldap.html#sec-security-ldap-replication" title="5.10. Setting up replication">Section 5.10, “Setting up replication”</a>).
  </p></section><section class="sect2" id="sec-security-ldap-synchronization-agreement" data-id-title="Creating an agreement from Active Directory to 389 Directory Server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">5.11.4 </span><span class="title-name">Creating an agreement from Active Directory to 389 Directory Server</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-synchronization-agreement">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap_active_directory_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following example command, which is run on the 389 Directory Server,
    creates a replication agreement from Active Directory to 389 Directory Server:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt create --suffix <em class="replaceable">dc=example,dc=com</em></code> \
  <code class="command">--host <em class="replaceable">AD-HOSTNAME</em> --port 636 --conn-protocol LDAPS</code> \
  --bind-dn <code class="command">"<em class="replaceable">cn=SERVICE-ACCOUNT,cn=USERS,dc=AD,dc=EXAMPLE,dc=COM</em>"</code> \
  <code class="command">--bind-passwd "<em class="replaceable">PASSWORD</em>" --win-subtree "<em class="replaceable">cn=USERS,dc=AD,dc=EXAMPLE,dc=COM</em>"</code> \
  <code class="command">--ds-subtree <em class="replaceable">ou=AD,dc=EXAMPLE,dc=COM</em> --one-way-sync fromWindows</code> \
  <code class="command">--sync-users=on --sync-groups=on --move-action delete</code> \
  <code class="command">--win-domain <em class="replaceable">AD-DOMAIN</em> adsync_agreement</code></pre></div><p>
  Once the agreement has been created, you must perform an initial resynchronization:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt init --suffix <em class="replaceable">dc=example,dc=com</em> adsync_agreement</code></pre></div><p>
  Use the following command to check the status of the initialization:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt init-status --suffix <em class="replaceable">dc=example,dc=com</em> adsync_agreement</code></pre></div><div id="id-1.8.4.5.15.6.8" data-id-title="Some entries are not synchronized" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Some entries are not synchronized</div><p>
    In some cases, an entry may not be synchronized, even if the init status reports success. Check your 389 DS log files in
    <code class="filename">/var/log/dirsrv/slapd-INSTANCE-NAME/errors</code>.
  </p></div><p>
    Check the status of the agreement with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt status --suffix <em class="replaceable">dc=example,dc=com</em> adsync_agreement</code></pre></div><p>
    Whe you are performing maintenance on the Active Directory or 389 Directory Server topology, you
    can pause the agreement with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt disable --suffix <em class="replaceable">dc=example,dc=com</em> adsync_agreement</code></pre></div><p>
    Resume the agreement with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> <code class="command">dsconf <em class="replaceable">INSTANCE-NAME</em> repl-winsync-agmt enable --suffix <em class="replaceable">dc=example,dc=com</em> adsync_agreement</code></pre></div></section></section><section class="sect1" id="sec-security-ldap-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">5.12 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="cha-security-ldap.html#sec-security-ldap-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_ldap.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For more information about 389 Directory Server, see:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The upstream documentation at
      <a class="link" href="https://www.port389.org/docs/389ds/documentation.html" target="_blank">https://www.port389.org/docs/389ds/documentation.html</a>.
    </p></li><li class="listitem"><p>
      man dsconf
    </p></li><li class="listitem"><p>
      man dsctl
    </p></li><li class="listitem"><p>
      man dsidm
    </p></li><li class="listitem"><p>
      man dscreate
    </p></li></ul></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-security-auth.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 4 </span>Setting up authentication clients using YaST</span></a> </div><div><a class="pagination-link next" href="cha-security-kerberos.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 6 </span>Network authentication with Kerberos</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-tree"><span class="title-number">5.1 </span><span class="title-name">Structure of an LDAP directory tree</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-server-install"><span class="title-number">5.2 </span><span class="title-name">Installing 389 Directory Server</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-firewall"><span class="title-number">5.3 </span><span class="title-name">Firewall configuration</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-backup"><span class="title-number">5.4 </span><span class="title-name">Backing up and restoring 389 Directory Server</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-server-users"><span class="title-number">5.5 </span><span class="title-name">Managing LDAP users and groups</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-modules"><span class="title-number">5.6 </span><span class="title-name">Managing plug-ins</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-server-sssd"><span class="title-number">5.7 </span><span class="title-name">Using SSSD to manage LDAP authentication</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-migrate"><span class="title-number">5.8 </span><span class="title-name">Migrating to 389 Directory Server from OpenLDAP</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-server-ca"><span class="title-number">5.9 </span><span class="title-name">Importing TLS server certificates and keys</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-replication"><span class="title-number">5.10 </span><span class="title-name">Setting up replication</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-active-directory-sync"><span class="title-number">5.11 </span><span class="title-name">Synchronizing with Microsoft Active Directory</span></a></span></li><li><span class="sect1"><a href="cha-security-ldap.html#sec-security-ldap-info"><span class="title-number">5.12 </span><span class="title-name">More information</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>