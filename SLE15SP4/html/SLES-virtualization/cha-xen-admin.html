<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLES 15 SP4 | Virtualization Guide | Administrative tasks</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Administrative tasks | SLES 15 SP4"/>
<meta name="description" content=""/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="15 SP4"/>
<meta name="book-title" content="Virtualization Guide"/>
<meta name="chapter-title" content="Chapter 28. Administrative tasks"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Server 15 SP4"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Virtualization Guide"/>
<meta property="og:description" content="Learn all about virtualization and VM management"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Virtualization Guide"/>
<meta name="twitter:description" content="Learn all about virtualization and VM management"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Administrative tasks",
  
    "description": "Administrative tasks",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-06-05T00:00+02:00",
      
    "datePublished": "2022-06-21T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-xen-config.html" title="Chapter 27. Virtualization: configuration options and settings"/><link rel="next" href="cha-xen-xenstore.html" title="Chapter 29. XenStore: configuration database shared between domains"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Virtualization Guide</a><span> / </span><a class="crumb" href="part-virt-xen.html">Managing virtual machines with Xen</a><span> / </span><a class="crumb" href="cha-xen-admin.html">Administrative tasks</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Virtualization Guide</div><ol><li><a href="cha-kvm.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="part-virt-intro.html" class="has-children "><span class="title-number">I </span><span class="title-name">Introduction</span></a><ol><li><a href="chap-virtualization-introduction.html" class=" "><span class="title-number">1 </span><span class="title-name">Virtualization technology</span></a></li><li><a href="cha-virtualization-scenarios.html" class=" "><span class="title-number">2 </span><span class="title-name">Virtualization scenarios</span></a></li><li><a href="cha-xen-basics.html" class=" "><span class="title-number">3 </span><span class="title-name">Introduction to Xen virtualization</span></a></li><li><a href="cha-kvm-intro.html" class=" "><span class="title-number">4 </span><span class="title-name">Introduction to KVM virtualization</span></a></li><li><a href="cha-tools-intro.html" class=" "><span class="title-number">5 </span><span class="title-name">Virtualization tools</span></a></li><li><a href="cha-vt-installation.html" class=" "><span class="title-number">6 </span><span class="title-name">Installation of virtualization components</span></a></li><li><a href="cha-virt-support.html" class=" "><span class="title-number">7 </span><span class="title-name">Virtualization limits and support</span></a></li></ol></li><li><a href="part-virt-libvirt.html" class="has-children "><span class="title-number">II </span><span class="title-name">Managing virtual machines with <code class="systemitem">libvirt</code></span></a><ol><li><a href="cha-libvirt-overview.html" class=" "><span class="title-number">8 </span><span class="title-name"><code class="systemitem">libvirt</code> daemons</span></a></li><li><a href="cha-libvirt-host.html" class=" "><span class="title-number">9 </span><span class="title-name">Preparing the VM Host Server</span></a></li><li><a href="cha-kvm-inst.html" class=" "><span class="title-number">10 </span><span class="title-name">Guest installation</span></a></li><li><a href="cha-libvirt-managing.html" class=" "><span class="title-number">11 </span><span class="title-name">Basic VM Guest management</span></a></li><li><a href="cha-libvirt-connect.html" class=" "><span class="title-number">12 </span><span class="title-name">Connecting and authorizing</span></a></li><li><a href="cha-libvirt-storage.html" class=" "><span class="title-number">13 </span><span class="title-name">Advanced storage topics</span></a></li><li><a href="cha-libvirt-config-gui.html" class=" "><span class="title-number">14 </span><span class="title-name">Configuring virtual machines with Virtual Machine Manager</span></a></li><li><a href="cha-libvirt-config-virsh.html" class=" "><span class="title-number">15 </span><span class="title-name">Configuring virtual machines with <code class="command">virsh</code></span></a></li><li><a href="xen2kvm-migration.html" class=" "><span class="title-number">16 </span><span class="title-name">Xen to KVM migration guide</span></a></li></ol></li><li><a href="part-virt-common.html" class="has-children "><span class="title-number">III </span><span class="title-name">Hypervisor-independent features</span></a><ol><li><a href="cha-cachemodes.html" class=" "><span class="title-number">17 </span><span class="title-name">Disk cache modes</span></a></li><li><a href="sec-kvm-managing-clock.html" class=" "><span class="title-number">18 </span><span class="title-name">VM Guest clock settings</span></a></li><li><a href="chap-guestfs.html" class=" "><span class="title-number">19 </span><span class="title-name">libguestfs</span></a></li><li><a href="cha-qemu-ga.html" class=" "><span class="title-number">20 </span><span class="title-name">QEMU guest agent</span></a></li><li><a href="tpm.html" class=" "><span class="title-number">21 </span><span class="title-name">Software TPM emulator</span></a></li><li><a href="virt-crash-dump.html" class=" "><span class="title-number">22 </span><span class="title-name">Creating crash dumps of a VM Guest</span></a></li></ol></li><li class="active"><a href="part-virt-xen.html" class="has-children you-are-here"><span class="title-number">IV </span><span class="title-name">Managing virtual machines with Xen</span></a><ol><li><a href="cha-xen-vhost.html" class=" "><span class="title-number">23 </span><span class="title-name">Setting up a virtual machine host</span></a></li><li><a href="cha-xen-network.html" class=" "><span class="title-number">24 </span><span class="title-name">Virtual networking</span></a></li><li><a href="cha-xen-manage.html" class=" "><span class="title-number">25 </span><span class="title-name">Managing a virtualization environment</span></a></li><li><a href="cha-xen-vbd.html" class=" "><span class="title-number">26 </span><span class="title-name">Block devices in Xen</span></a></li><li><a href="cha-xen-config.html" class=" "><span class="title-number">27 </span><span class="title-name">Virtualization: configuration options and settings</span></a></li><li><a href="cha-xen-admin.html" class=" you-are-here"><span class="title-number">28 </span><span class="title-name">Administrative tasks</span></a></li><li><a href="cha-xen-xenstore.html" class=" "><span class="title-number">29 </span><span class="title-name">XenStore: configuration database shared between domains</span></a></li><li><a href="cha-xen-ha.html" class=" "><span class="title-number">30 </span><span class="title-name">Xen as a high-availability virtualization host</span></a></li><li><a href="pv-to-fv.html" class=" "><span class="title-number">31 </span><span class="title-name">Xen: converting a paravirtual (PV) guest into a fully virtual (FV/HVM) guest</span></a></li></ol></li><li><a href="part-virt-qemu.html" class="has-children "><span class="title-number">V </span><span class="title-name">Managing virtual machines with QEMU</span></a><ol><li><a href="cha-qemu-overview.html" class=" "><span class="title-number">32 </span><span class="title-name">QEMU overview</span></a></li><li><a href="cha-qemu-host.html" class=" "><span class="title-number">33 </span><span class="title-name">Setting up a KVM VM Host Server</span></a></li><li><a href="cha-qemu-guest-inst.html" class=" "><span class="title-number">34 </span><span class="title-name">Guest installation</span></a></li><li><a href="cha-qemu-running.html" class=" "><span class="title-number">35 </span><span class="title-name">Running virtual machines with qemu-system-ARCH</span></a></li><li><a href="cha-qemu-monitor.html" class=" "><span class="title-number">36 </span><span class="title-name">Virtual machine administration using QEMU monitor</span></a></li></ol></li><li><a href="part-virt-troubleshoot.html" class="has-children "><span class="title-number">VI </span><span class="title-name">Troubleshooting</span></a><ol><li><a href="cha-virt-help.html" class=" "><span class="title-number">37 </span><span class="title-name">Integrated help and package documentation</span></a></li><li><a href="cha-virt-logs.html" class=" "><span class="title-number">38 </span><span class="title-name">Gathering system information and logs</span></a></li></ol></li><li><a href="gloss-vt-glossary.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li><li><a href="app-vmdp-driver.html" class=" "><span class="title-number">A </span><span class="title-name">Virtual machine drivers</span></a></li><li><a href="app-gpu-passthru.html" class=" "><span class="title-number">B </span><span class="title-name">Configuring GPU Pass-Through for NVIDIA cards</span></a></li><li><a href="cha-xmtoxl.html" class=" "><span class="title-number">C </span><span class="title-name">XM, XL toolstacks, and the <code class="systemitem">libvirt</code> framework</span></a></li><li><a href="bk10apd.html" class=" "><span class="title-number">D </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-xen-admin" data-id-title="Administrative tasks"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP4</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">28 </span><span class="title-name">Administrative tasks</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect1" id="sec-xen-config-bootloader" data-id-title="The boot loader program"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.1 </span><span class="title-name">The boot loader program</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-config-bootloader">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The boot loader controls how the virtualization software boots and runs.
   You can modify the boot loader properties by using YaST, or by
   directly editing the boot loader configuration file.
  </p><p>
   The YaST boot loader program is located at <span class="guimenu">YaST</span> › <span class="guimenu">System</span> › <span class="guimenu">Boot
   Loader</span>. Click the <span class="guimenu">Bootloader
   Options</span> tab and select the line containing the Xen kernel
   as the <span class="guimenu">Default Boot Section</span>.
  </p><div class="figure" id="id-1.12.6.7.4.4"><div class="figure-contents"><div class="mediaobject"><a href="images/xen_bootloader.png"><img src="images/xen_bootloader.png" width="80%" alt="Boot loader settings" title="Boot loader settings"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 28.1: </span><span class="title-name">Boot loader settings </span></span><a title="Permalink" class="permalink" href="cha-xen-admin.html#id-1.12.6.7.4.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div><p>
   Confirm with <span class="guimenu">OK</span>. Next time you boot the host, it will
   be ready to provide the Xen virtualization environment.
  </p><p>
   You can use the Boot Loader program to specify functionality, such as:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Pass kernel command line parameters.
    </p></li><li class="listitem"><p>
     Specify the kernel image and initial RAM disk.
    </p></li><li class="listitem"><p>
     Select a specific hypervisor.
    </p></li><li class="listitem"><p>
     Pass additional parameters to the hypervisor. See
     <a class="link" href="http://xenbits.xen.org/docs/unstable/misc/xen-command-line.html" target="_blank">http://xenbits.xen.org/docs/unstable/misc/xen-command-line.html</a>
     for their complete list.
    </p></li></ul></div><p>
   You can customize your virtualization environment by editing the
   <code class="filename">/etc/default/grub</code> file. Add the following line to
   this file:
   <code class="literal">GRUB_CMDLINE_XEN="&lt;boot_parameters&gt;"</code>. Do not
   forget to run <code class="command">grub2-mkconfig -o /boot/grub2/grub.cfg</code>
   after editing the file.
  </p></section><section class="sect1" id="sec-xen-config-sparse" data-id-title="Sparse image files and disk space"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.2 </span><span class="title-name">Sparse image files and disk space</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-config-sparse">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If the host’s physical disk reaches a state where it has no available
   space, a virtual machine using a virtual disk based on a sparse image
   file cannot write to its disk. Consequently, it reports I/O errors.
  </p><p>
   If this situation
   occurs, you should free up available space on the physical disk, remount
   the virtual machine’s file system, and set the file system back to
   read-write.
  </p><p>
   To check the actual disk requirements of a sparse image file, use the
   command <code class="command">du -h &lt;image file&gt;</code>.
  </p><p>
   To increase the available space of a sparse image file, first increase
   the file size and then the file system.
  </p><div id="id-1.12.6.7.5.6" data-id-title="Back up before resizing" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Back up before resizing</div><p>
    Touching the sizes of partitions or sparse files always bears the risk
    of data failure. Do not work without a backup.
   </p></div><p>
   The resizing of the image file can be done online, while the VM Guest
   is running. Increase the size of a sparse image file with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/zero of=&lt;image file&gt; count=0 bs=1M seek=&lt;new size in MB&gt;</pre></div><p>
   For example, to increase the file
   <code class="filename">/var/lib/xen/images/sles/disk0</code> to a size of 16GB,
   use the command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/zero of=/var/lib/xen/images/sles/disk0 count=0 bs=1M seek=16000</pre></div><div id="id-1.12.6.7.5.11" data-id-title="Increasing non-sparse images" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Increasing non-sparse images</div><p>
    It is also possible to increase the image files of devices that are not
    sparse files. However, you must know exactly where the previous image
    ends. Use the seek parameter to point to the end of the image file and
    use a command similar to the following:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/zero of=/var/lib/xen/images/sles/disk0 seek=8000 bs=1M count=2000</pre></div></div><p>
   Be sure to use the right seek, else data loss may happen.
  </p><p>
   If the VM Guest is running during the resize operation, also resize
   the loop device that provides the image file to the VM Guest. First
   detect the correct loop device with the command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> losetup -j /var/lib/xen/images/sles/disk0</pre></div><p>
   Then resize the loop device, for example <code class="filename">/dev/loop0</code>,
   with the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> losetup -c /dev/loop0</pre></div><p>
   Finally check the size of the block device inside the guest system with
   the command <code class="command">fdisk -l /dev/xvdb</code>. The device name
   depends on the actually increased device.
  </p><p>
   The resizing of the file system inside the sparse file involves tools that
   are depending on the actual file system. <span class="phrase">This is
   described in detail in the <span class="intraxref">Book “Storage Administration Guide”</span>.</span>
  </p></section><section class="sect1" id="sec-xen-manage-migrate" data-id-title="Migrating Xen VM Guest systems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.3 </span><span class="title-name">Migrating Xen VM Guest systems</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-manage-migrate">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   With Xen it is possible to migrate a VM Guest system from one
   VM Host Server to another with almost no service interruption. This could be
   used for example to move a busy VM Guest to a VM Host Server that has
   stronger hardware or is not yet loaded. Or, if a service of a VM Host Server
   is required, all VM Guest systems running on this machine can be
   migrated to other machines to avoid interruption of service.
   These are only two examples—many more reasons may apply to your
   personal situation.
  </p><p>
   Before starting, some preliminary considerations regarding the
   VM Host Server should be taken into account:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     All VM Host Server systems should use a similar CPU. The frequency is not so
     important, but they should be using the same CPU family. To get more
     information about the used CPU, use <code class="command">cat /proc/cpuinfo</code>.
     Find more details about comparing host CPU features in <a class="xref" href="cha-xen-admin.html#sec-xen-manage-migrate-cpu" title="28.3.1. Detecting CPU features">Section 28.3.1, “Detecting CPU features”</a>.
    </p></li><li class="listitem"><p>
     All resources that are used by a specific guest system must be
     available on all involved VM Host Server systems—for example all used block devices
     must exist on both VM Host Server systems.
    </p></li><li class="listitem"><p>
     If the hosts included in the migration process run in different subnets,
     make sure that either DHCP relay is available to the guests,
     or for guests with static network configuration, set up the network manually.
    </p></li><li class="listitem"><p>
     Using special features like <code class="literal">PCI Pass-Through</code> may be
     problematic. Do not implement these when deploying for an environment
     that should migrate VM Guest systems between different VM Host Server
     systems.
    </p></li><li class="listitem"><p>
     For fast migrations, a fast network is mandatory. If possible, use GB
     Ethernet and fast switches. Deploying VLAN might also help avoid
     collisions.
    </p></li></ul></div><section class="sect2" id="sec-xen-manage-migrate-cpu" data-id-title="Detecting CPU features"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">28.3.1 </span><span class="title-name">Detecting CPU features</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-manage-migrate-cpu">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    By using the <code class="systemitem">cpuid</code> and
    <code class="systemitem">xen_maskcalc.py</code> tools, you can compare features of
    a CPU on the host from where you are migrating the source VM Guest with
    the features of CPUs on the target hosts. This way you can better predict
    if the guest migrations will be successful.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Run the <code class="command">cpuid -1r</code> command on each Dom0 that is
      supposed to run or receive the migrated VM Guest and capture the output
      in text files, for example:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux@vm_host1 &gt; </code>sudo cpuid -1r &gt; vm_host1.txt
<code class="prompt user">tux@vm_host2 &gt; </code>sudo cpuid -1r &gt; vm_host2.txt
<code class="prompt user">tux@vm_host3 &gt; </code>sudo cpuid -1r &gt; vm_host3.txt</pre></div></li><li class="step"><p>
      Copy all the output text files on a host with the
      <code class="command">xen_maskcalc.py</code> script installed.
     </p></li><li class="step"><p>
      Run the <code class="command">xen_maskcalc.py</code> script on all output text
      files:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xen_maskcalc.py vm_host1.txt vm_host2.txt vm_host3.txt
cpuid = [
    "0x00000001:ecx=x00xxxxxx0xxxxxxxxx00xxxxxxxxxxx",
    "0x00000007,0x00:ebx=xxxxxxxxxxxxxxxxxx00x0000x0x0x00"
]</pre></div></li><li class="step"><p>
      Copy the output <code class="literal">cpuid=[...]</code> configuration snipped into
      the <code class="command">xl</code> configuration of the migrated
      guest<code class="filename">domU.cfg</code> or alternatively to its <code class="systemitem">libvirt</code>'s
      XML configuration.
     </p></li><li class="step"><p>
      Start the source guest with the <span class="emphasis"><em>trimmed</em></span> CPU
      configuration. The guest can now only use CPU features which are present
      on each of the hosts.
     </p></li></ol></div></div><div id="id-1.12.6.7.6.5.4" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>
     <code class="systemitem">libvirt</code> also supports calculating a baseline CPU for migration. For more details, refer to <a class="link" href="https://documentation.suse.com/sles-15/html/SLES-all/article-virtualization-best-practices.html" target="_blank">https://documentation.suse.com/sles-15/html/SLES-all/article-virtualization-best-practices.html</a>.
    </p></div><section class="sect3" id="sec-xen-manage-migrate-cpu-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">28.3.1.1 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-manage-migrate-cpu-info">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can find more details about <code class="systemitem">cpuid</code> at
     <a class="link" href="http://etallen.com/cpuid.html" target="_blank">http://etallen.com/cpuid.html</a>.
    </p><p>
     You can download the latest version of the CPU mask calculator from
     <a class="link" href="https://github.com/twizted/xen_maskcalc" target="_blank">https://github.com/twizted/xen_maskcalc</a>.
    </p></section></section><section class="sect2" id="sec-xen-manage-migrate-block" data-id-title="Preparing block devices for migrations"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">28.3.2 </span><span class="title-name">Preparing block devices for migrations</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-manage-migrate-block">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The block devices needed by the VM Guest system must be available on
    all involved VM Host Server systems. This is done by implementing some kind
    of shared storage that serves as container for the root file system of
    the migrated VM Guest system. Common possibilities include:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="literal">iSCSI</code> can be set up to give access to the same block
      devices from different systems at the same time. <span class="phrase">For
      more information about iSCSI, see <span class="intraxref">Book “Storage Administration Guide”, Chapter 15 “Mass storage over IP networks: iSCSI”</span>.</span>
     </p></li><li class="listitem"><p>
      <code class="literal">NFS</code> is a widely used root file system that can
      easily be accessed from different locations. For more information, see
      <span class="intraxref">Book “Storage Administration Guide”, Chapter 19 “Sharing file systems with NFS”</span>.
     </p></li><li class="listitem"><p>
      <code class="literal">DRBD</code> can be used if only two VM Host Server systems
      are involved. This gives some extra data security, because the used
      data is mirrored over the network. <span class="phrase">For more information, see the
      <em class="citetitle">SUSE Linux Enterprise High Availability
      <span class="productnumber"><span class="phrase">15 SP4</span></span></em> documentation at
      <a class="link" href="https://documentation.suse.com/sle-ha-15/" target="_blank">https://documentation.suse.com/sle-ha-15/</a></span>.
     </p></li><li class="listitem"><p>
      <code class="literal">SCSI</code> can also be used if the available hardware
      permits shared access to the same disks.
     </p></li><li class="listitem"><p>
      <code class="literal">NPIV</code> is a special mode to use Fibre channel disks.
      However, in this case all migration hosts must be attached to the same
      Fibre channel switch. For more information about NPIV, see
      <a class="xref" href="cha-xen-vbd.html#sec-xen-config-disk" title="26.1. Mapping physical storage to virtual disks">Section 26.1, “Mapping physical storage to virtual disks”</a>. Commonly, this works if the
      Fibre channel environment supports 4 Gbps or faster connections.
     </p></li></ul></div></section><section class="sect2" id="sec-xen-manage-migrate-xl" data-id-title="Migrating VM Guest systems"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">28.3.3 </span><span class="title-name">Migrating VM Guest systems</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-manage-migrate-xl">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The actual migration of the VM Guest system is done with the
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl migrate &lt;domain_name&gt; &lt;host&gt;</pre></div><p>
    The speed of the migration depends on how fast the memory print can be
    saved to disk, sent to the new VM Host Server and loaded there. This means
    that small VM Guest systems can be migrated faster than big systems
    with a lot of memory.
   </p></section></section><section class="sect1" id="sec-xen-monitor" data-id-title="Monitoring Xen"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.4 </span><span class="title-name">Monitoring Xen</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-monitor">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For a regular operation of many virtual guests, having a possibility to
   check the sanity of all the different VM Guest systems is
   indispensable. Xen offers several tools besides the system tools to
   gather information about the system.
  </p><div id="id-1.12.6.7.7.3" data-id-title="Monitoring the VM Host Server" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Monitoring the VM Host Server</div><p>
    Basic monitoring of the VM Host Server (I/O and CPU) is available via the
    Virtual Machine Manager. Refer to
    <a class="xref" href="cha-libvirt-managing.html#cha-libvirt-admin-monitor-virt-manager" title="11.8.1. Monitoring with Virtual Machine Manager">Section 11.8.1, “Monitoring with Virtual Machine Manager”</a> for details.
   </p></div><section class="sect2" id="sec-xen-monitor-xentop" data-id-title="Monitor Xen with xentop"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">28.4.1 </span><span class="title-name">Monitor Xen with <code class="command">xentop</code></span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-monitor-xentop">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The preferred terminal application to gather information about Xen
    virtual environment is <code class="command">xentop</code>. Unfortunately, this
    tool needs a rather broad terminal, else it inserts line breaks into the
    display.
   </p><p>
    <code class="command">xentop</code> has several command keys that can give you
    more information about the system that is monitored. Some of the more
    important are:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.7.7.4.4.1"><span class="term">D</span></dt><dd><p>
       Change the delay between the refreshes of the screen.
      </p></dd><dt id="id-1.12.6.7.7.4.4.2"><span class="term">N</span></dt><dd><p>
       Also display network statistics. Note, that only standard
       configurations will be displayed. If you use a special configuration
       like a routed network, no network will be displayed.
      </p></dd><dt id="id-1.12.6.7.7.4.4.3"><span class="term">B</span></dt><dd><p>
       Display the respective block devices and their cumulated usage count.
      </p></dd></dl></div><p>
    For more information about <code class="command">xentop</code> see the manual page
    <code class="command">man 1 xentop</code>.
   </p><div id="id-1.12.6.7.7.4.6" data-id-title="virt-top" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: <code class="command">virt-top</code></div><p>
     libvirt offers the hypervisor-agnostic tool <code class="command">virt-top</code>,
     which is recommended for monitoring VM Guests. See <a class="xref" href="cha-libvirt-managing.html#cha-libvirt-admin-monitor-virt-top" title="11.8.2. Monitoring with virt-top">Section 11.8.2, “Monitoring with <code class="command">virt-top</code>”</a> for details.
    </p></div></section><section class="sect2" id="sec-xen-monitor-tools" data-id-title="Additional tools"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">28.4.2 </span><span class="title-name">Additional tools</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-monitor-tools">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There are many system tools that also help monitoring or debugging a
    running <span class="phrase">SUSE Linux Enterprise</span> system. Many of these are covered in
    <span class="intraxref">Book “System Analysis and Tuning Guide”, Chapter 2 “System monitoring utilities”</span>. Especially useful for monitoring a
    virtualization environment are the following tools:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.6.7.7.5.3.1"><span class="term">ip</span></dt><dd><p>
       The command line utility <code class="command">ip</code> may be used to monitor
       arbitrary network interfaces. This is especially useful if you have
       set up a network that is routed or applied a masqueraded network. To
       monitor a network interface with the name
       <code class="literal">alice.0</code>, run the following command:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>watch ip -s link show alice.0</pre></div></dd><dt id="id-1.12.6.7.7.5.3.2"><span class="term">bridge</span></dt><dd><p>
       In a standard setup, all the Xen VM Guest systems are
       attached to a virtual network bridge. <code class="command">bridge</code> allows
       you to determine the connection between the bridge and the virtual
       network adapter in the VM Guest system. For example, the output
       of <code class="command">bridge link</code> may look like the following:
      </p><div class="verbatim-wrap"><pre class="screen">2: eth0 state DOWN : &lt;NO-CARRIER, ...,UP&gt; mtu 1500 master br0
8: vnet0 state UNKNOWN : &lt;BROADCAST, ...,LOWER_UP&gt; mtu 1500 master virbr0 \
  state forwarding priority 32 cost 100</pre></div><p>
       This shows that there are two virtual bridges defined on the system.  One
       is connected to the physical Ethernet device <code class="literal">eth0</code>, the
       other one is connected to a VLAN interface <code class="literal">vnet0</code>.
      </p></dd><dt id="id-1.12.6.7.7.5.3.3"><span class="term">iptables-save</span></dt><dd><p>
       Especially when using masquerade networks, or if several Ethernet
       interfaces are set up together with a firewall setup, it may be
       helpful to check the current firewall rules.
      </p><p>
       The command <code class="command">iptables</code> may be used to check all the
       different firewall settings. To list all the rules of a chain, or
       even of the complete setup, you may use the commands
       <code class="command">iptables-save</code> or <code class="command">iptables -S</code>.
      </p></dd></dl></div></section></section><section class="sect1" id="sec-xen-admin-vhostmd" data-id-title="Providing host information for VM Guest systems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">28.5 </span><span class="title-name">Providing host information for VM Guest systems</span></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-admin-vhostmd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In a standard Xen environment, the VM Guest systems have only
   very limited information about the VM Host Server system they are running
   on. If a guest should know more about the VM Host Server it runs on,
   <code class="systemitem">vhostmd</code> can provide more information to selected
   guests. To set up your system to run <code class="systemitem">vhostmd</code>,
   proceed as follows:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Install the package vhostmd on the VM Host Server.
    </p></li><li class="step"><p>
     To add or remove <code class="literal">metric</code> sections from the
     configuration, edit the file
     <code class="filename">/etc/vhostmd/vhostmd.conf</code>. However, the default works
     well.
    </p></li><li class="step"><p>
     Check the validity of the <code class="filename">vhostmd.conf</code>
     configuration file with the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cd /etc/vhostmd
<code class="prompt user">&gt; </code>xmllint --postvalid --noout vhostmd.conf</pre></div></li><li class="step"><p>
     Start the vhostmd daemon with the command <code class="command">sudo systemctl start
     vhostmd</code>.
    </p><p>
     If vhostmd should be started automatically during start-up of the
     system, run the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable vhostmd</pre></div></li><li class="step"><p>
     Attach the image file <code class="filename">/dev/shm/vhostmd0</code> to the
     VM Guest system named alice with the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>xl block-attach opensuse /dev/shm/vhostmd0,,xvdb,ro</pre></div></li><li class="step"><p>
     Log on the VM Guest system.
    </p></li><li class="step"><p>
     Install the client package <code class="systemitem">vm-dump-metrics</code>.
    </p></li><li class="step"><p>
     Run the command <code class="command">vm-dump-metrics</code>. To save the result to
     a file, use the option <code class="systemitem">-d &lt;filename&gt;</code>.
    </p></li></ol></div></div><p>
   The result of the <code class="systemitem">vm-dump-metrics</code> is an XML
   output. The respective metric entries follow the DTD
   <code class="filename">/etc/vhostmd/metric.dtd</code>.
  </p><p>
   For more information, see the manual pages <code class="command">man 8
   vhostmd</code> and <code class="filename">/usr/share/doc/vhostmd/README</code>
   on the VM Host Server system. On the guest, see the manual page <code class="command">man
   1 vm-dump-metrics</code>.
  </p></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-xen-config.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 27 </span>Virtualization: configuration options and settings</span></a> </div><div><a class="pagination-link next" href="cha-xen-xenstore.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 29 </span>XenStore: configuration database shared between domains</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-xen-admin.html#sec-xen-config-bootloader"><span class="title-number">28.1 </span><span class="title-name">The boot loader program</span></a></span></li><li><span class="sect1"><a href="cha-xen-admin.html#sec-xen-config-sparse"><span class="title-number">28.2 </span><span class="title-name">Sparse image files and disk space</span></a></span></li><li><span class="sect1"><a href="cha-xen-admin.html#sec-xen-manage-migrate"><span class="title-number">28.3 </span><span class="title-name">Migrating Xen VM Guest systems</span></a></span></li><li><span class="sect1"><a href="cha-xen-admin.html#sec-xen-monitor"><span class="title-number">28.4 </span><span class="title-name">Monitoring Xen</span></a></span></li><li><span class="sect1"><a href="cha-xen-admin.html#sec-xen-admin-vhostmd"><span class="title-number">28.5 </span><span class="title-name">Providing host information for VM Guest systems</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>