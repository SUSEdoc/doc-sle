<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLES 15 SP4 | Storage Administration Guide | Managing multipath I/O for devices</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Managing multipath I/O for devices | SLES 15 SP4"/>
<meta name="description" content="This section describes how to manage failover and path load balancing for multiple paths between the servers and block storage devices by using Multi…"/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="15 SP4"/>
<meta name="book-title" content="Storage Administration Guide"/>
<meta name="chapter-title" content="Chapter 18. Managing multipath I/O for devices"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Server 15 SP4"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Storage Administration Guide"/>
<meta property="og:description" content="Administer storage devices on SLES"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Storage Administration Guide"/>
<meta name="twitter:description" content="Administer storage devices on SLES"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Managing multipath I/O for devices",
  
    "description": "Managing multipath I/O for devices",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-04-26T00:00+02:00",
      
    "datePublished": "2022-06-21T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-nvmeof.html" title="Chapter 17. NVMe-oF"/><link rel="next" href="cha-nfs.html" title="Chapter 19. Sharing file systems with NFS"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Storage Administration Guide</a><span> / </span><a class="crumb" href="part-net-storage.html">Network storage</a><span> / </span><a class="crumb" href="cha-multipath.html">Managing multipath I/O for devices</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Storage Administration Guide</div><ol><li><a href="storage-preface.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="part-filesystems.html" class="has-children "><span class="title-number">I </span><span class="title-name">File systems and mounting</span></a><ol><li><a href="cha-filesystems.html" class=" "><span class="title-number">1 </span><span class="title-name">Overview of file systems in Linux</span></a></li><li><a href="cha-resize-fs.html" class=" "><span class="title-number">2 </span><span class="title-name">Resizing file systems</span></a></li><li><a href="cha-uuid.html" class=" "><span class="title-number">3 </span><span class="title-name">Mounting storage devices</span></a></li><li><a href="cha-multitiercache.html" class=" "><span class="title-number">4 </span><span class="title-name">Multi-tier caching for block device operations</span></a></li></ol></li><li><a href="part-lvm.html" class="has-children "><span class="title-number">II </span><span class="title-name">Logical volumes (LVM)</span></a><ol><li><a href="cha-lvm.html" class=" "><span class="title-number">5 </span><span class="title-name">LVM configuration</span></a></li><li><a href="cha-lvm-snapshots.html" class=" "><span class="title-number">6 </span><span class="title-name">LVM volume snapshots</span></a></li></ol></li><li><a href="part-software-raid.html" class="has-children "><span class="title-number">III </span><span class="title-name">Software RAID</span></a><ol><li><a href="cha-raid.html" class=" "><span class="title-number">7 </span><span class="title-name">Software RAID configuration</span></a></li><li><a href="cha-raidroot.html" class=" "><span class="title-number">8 </span><span class="title-name">Configuring software RAID for the root partition</span></a></li><li><a href="cha-raid10.html" class=" "><span class="title-number">9 </span><span class="title-name">Creating software RAID 10 devices</span></a></li><li><a href="cha-raid-degraded.html" class=" "><span class="title-number">10 </span><span class="title-name">Creating a degraded RAID array</span></a></li><li><a href="cha-raid-resize.html" class=" "><span class="title-number">11 </span><span class="title-name">Resizing software RAID arrays with mdadm</span></a></li><li><a href="cha-raid-leds.html" class=" "><span class="title-number">12 </span><span class="title-name">Storage enclosure LED utilities for MD software RAIDs</span></a></li><li><a href="cha-raidtroubleshooting.html" class=" "><span class="title-number">13 </span><span class="title-name">Troubleshooting software RAIDs</span></a></li></ol></li><li class="active"><a href="part-net-storage.html" class="has-children you-are-here"><span class="title-number">IV </span><span class="title-name">Network storage</span></a><ol><li><a href="cha-isns.html" class=" "><span class="title-number">14 </span><span class="title-name">iSNS for Linux</span></a></li><li><a href="cha-iscsi.html" class=" "><span class="title-number">15 </span><span class="title-name">Mass storage over IP networks: iSCSI</span></a></li><li><a href="cha-fcoe.html" class=" "><span class="title-number">16 </span><span class="title-name">Fibre Channel storage over Ethernet networks: FCoE</span></a></li><li><a href="cha-nvmeof.html" class=" "><span class="title-number">17 </span><span class="title-name">NVMe-oF</span></a></li><li><a href="cha-multipath.html" class=" you-are-here"><span class="title-number">18 </span><span class="title-name">Managing multipath I/O for devices</span></a></li><li><a href="cha-nfs.html" class=" "><span class="title-number">19 </span><span class="title-name">Sharing file systems with NFS</span></a></li><li><a href="cha-samba.html" class=" "><span class="title-number">20 </span><span class="title-name">Samba</span></a></li><li><a href="cha-autofs.html" class=" "><span class="title-number">21 </span><span class="title-name">On-demand mounting with autofs</span></a></li></ol></li><li><a href="bk09apa.html" class=" "><span class="title-number">A </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section xml:lang="en" class="chapter" id="cha-multipath" data-id-title="Managing multipath I/O for devices"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP4</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">18 </span><span class="title-name">Managing multipath I/O for devices</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This section describes how to manage failover and path load balancing for
  multiple paths between the servers and block storage devices by using
  Multipath I/O (MPIO).
 </p><section class="sect1" id="sec-multipath-intro" data-id-title="Understanding multipath I/O"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.1 </span><span class="title-name">Understanding multipath I/O</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-intro">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Multipathing is the ability of a server to communicate with the same
   physical or logical block storage device across multiple physical paths
   between the host bus adapters in the server and the storage controllers for
   the device, typically in Fibre Channel (FC) or iSCSI SAN environments.
  </p><p>
   Linux multipathing provides connection fault tolerance and can provide load
   balancing across the active connections. When multipathing is configured and
   running, it automatically isolates and identifies device connection
   failures, and reroutes I/O to alternate connections.
  </p><p>
   Multipathing provides fault tolerance against connection failures, but not
   against failures of the storage device itself. The latter is achieved with
   complementary techniques like mirroring.
  </p><section class="sect2" id="id-1.11.6.6.4.5" data-id-title="Multipath terminology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.1.1 </span><span class="title-name">Multipath terminology</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#id-1.11.6.6.4.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.4.5.2.1"><span class="term">Storage array</span></dt><dd><p>
       A hardware device with many disks and multiple fabrics connections
       (controllers) that provides SAN storage to clients. Storage arrays
       typically have RAID and failover features and support multipathing.
       Historically, active/passive (failover) and active/active
       (load-balancing) storage array configurations were distinguished. These
       concepts still exist but they are merely special cases of the concepts
       of path groups and access states supported by modern hardware.
      </p></dd><dt id="id-1.11.6.6.4.5.2.2"><span class="term">Host, host system</span></dt><dd><p>
       The computer running <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> which acts as a client system for a
       <span class="emphasis"><em>storage array</em></span>.
      </p></dd><dt id="id-1.11.6.6.4.5.2.3"><span class="term">Multipath map, multipath device</span></dt><dd><p>
       A set of <span class="emphasis"><em>path devices</em></span>. It represents a storage
       volume on a storage array and is seen as a single block device by the
       host system.
      </p></dd><dt id="id-1.11.6.6.4.5.2.4"><span class="term">Path device</span></dt><dd><p>
       A member of a multipath map, typically a SCSI device. Each path device
       represents a unique connection between the host computer and the actual
       storage volume, for example, a logical unit from an iSCSI session.
      </p></dd><dt id="id-1.11.6.6.4.5.2.5"><span class="term">WWID</span></dt><dd><p>
       “World Wide Identifier”.
       <code class="systemitem">multipath-tools</code> uses the WWID to determine
       which low-level devices should be assembled into a multipath map. The
       WWID must be distinguished from the configurable <span class="emphasis"><em>map
       name</em></span> (see <a class="xref" href="cha-multipath.html#sec-multipath-names" title="18.12. Multipath device names and WWIDs">Section 18.12, “Multipath device names and WWIDs”</a>).
      </p></dd><dt id="id-1.11.6.6.4.5.2.6"><span class="term">uevent, udev event</span></dt><dd><p>
       An event sent by the kernel to user space and processed by the
       <code class="command">udev</code> subsystem. Uevents are generated when devices
       are added or removed, or when they change their properties.
      </p></dd><dt id="id-1.11.6.6.4.5.2.7"><span class="term">Device mapper</span></dt><dd><p>
       A framework in the Linux kernel for creating virtual block devices. I/O
       operations to mapped devices are redirected to the underlying block
       devices. Device mappings may be stacked. The device mapper implements
       its own event signaling, also known as “device mapper
       events” or “dm events”.
      </p></dd><dt id="id-1.11.6.6.4.5.2.8"><span class="term">initramfs</span></dt><dd><p>
       The initial RAM file system, also referred to as “initial RAM
       disk” (initrd) for historical reasons (see
       <span class="intraxref">Book “Administration Guide”, Chapter 16 “Introduction to the boot process”, Section 16.1 “Terminology”</span>).
      </p></dd><dt id="id-1.11.6.6.4.5.2.9"><span class="term">ALUA</span></dt><dd><p>
       “Asymmetric Logical Unit Access”, a concept introduced with
       the SCSI standard SCSI-3. Storage volumes can be accessed via multiple
       ports, which are organized in port groups with different states (active,
       standby, etc.). ALUA defines SCSI commands to query the port groups and
       their states and change the state of a port group. Modern storage arrays
       that support SCSI usually support ALUA, too.
      </p></dd></dl></div></section></section><section class="sect1" id="sec-multipath-hardware" data-id-title="Hardware support"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.2 </span><span class="title-name">Hardware support</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-hardware">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The multipathing drivers and tools are available on all architectures
   supported by <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. The generic, protocol-agnostic driver works with
   most multipath-capable storage hardware on the market. Some storage array
   vendors provide their own multipathing management tools. Consult the
   vendor’s hardware documentation to determine what settings are required.
  </p><section class="sect2" id="sec-multipath-hardware-implementations" data-id-title="Multipath implementations: device mapper and NVMe"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.2.1 </span><span class="title-name">Multipath implementations: device mapper and NVMe</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-hardware-implementations">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The traditional, generic implementation of multipathing under Linux uses
    the device mapper framework. For most device types like SCSI devices,
    device mapper multipathing is the only available implementation. Device
    mapper multipath is highly configurable and flexible.
   </p><p>
    The Linux <span class="emphasis"><em>NVM Express</em></span> (NVMe) kernel subsystem
    implements multipathing natively in the kernel. This implementation creates
    less computational overhead for NVMe devices, which are typically fast
    devices with very low latencies. Native NVMe multipathing requires no user
    space component. Since SLE 15, native multipathing has been the default
    for NVMe multipath devices. For details, refer to
    <a class="xref" href="cha-nvmeof.html#sec-nvmeof-host-configuration-multipathing" title="17.2.4. Multipathing">Section 17.2.4, “Multipathing”</a>.
   </p><p>
    This chapter documents device mapper multipath and its user-space
    component, <code class="systemitem">multipath-tools</code>.
    <code class="systemitem">multipath-tools</code> also has limited support for
    native NVMe multipathing (see
    <a class="xref" href="cha-multipath.html#sec-multipath-conf-misc" title="18.13. Miscellaneous options">Section 18.13, “Miscellaneous options”</a>).
   </p></section><section class="sect2" id="sec-multipath-hardware-autodetect" data-id-title="Storage array autodetection for multipathing"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.2.2 </span><span class="title-name">Storage array autodetection for multipathing</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-hardware-autodetect">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Device mapper multipath is a generic technology. Multipath device detection
    requires only that the low-level (for example, SCSI) devices are detected
    by the kernel, and that device properties reliably identify multiple
    low-level devices as being different “paths” to the same volume
    rather than actually different devices.
   </p><p>
    The <code class="filename">multipath-tools</code> package detects storage arrays by
    their vendor and product names. It provides built-in configuration defaults
    for a large variety of storage products. Consult the hardware documentation
    of your storage array: some vendors provide specific recommendations for
    Linux multipathing configuration.
   </p><p>
    If you need to apply changes to the built-in configuration for your storage
    array, read <a class="xref" href="cha-multipath.html#sec-multipath-conf-file" title="18.8. Multipath configuration">Section 18.8, “Multipath configuration”</a>.
   </p><div id="id-1.11.6.6.5.4.5" data-id-title="Disclaimer about built-in hardware properties" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Disclaimer about built-in hardware properties</div><p>
     <code class="filename">multipath-tools</code> has built-in presets for many storage
     arrays. The existence of such presets for a given storage product
     <span class="emphasis"><em>does not imply</em></span> that the vendor of the storage product
     has tested the product with <code class="systemitem">dm-multipath</code>, nor
     that the vendor endorses or supports the use of
     <code class="systemitem">dm-multipath</code> with the product. Always consult the
     original vendor documentation for support-related questions.
    </p></div></section><section class="sect2" id="sec-multipath-hardware-handlers" data-id-title="Storage arrays that require specific hardware handlers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.2.3 </span><span class="title-name">Storage arrays that require specific hardware handlers</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-hardware-handlers">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Some storage arrays require special commands for failover from one path to
    the other, or non-standard error-handling methods. These special commands
    and methods are implemented by hardware handlers in the Linux kernel.
    Modern SCSI storage arrays support the “Asymmetric Logical Unit
    Access” (ALUA) hardware handler defined in the SCSI standard. Besides
    ALUA, the SLE kernel contains hardware handlers for Netapp E-Series
    (RDAC), the Dell/EMC CLARiiON CX family of arrays, and legacy arrays from
    HP.
   </p><p>
    Since Linux kernel 4.4, the Linux kernel has automatically detected
    hardware handlers for most arrays, including all arrays supporting ALUA.
    The only requirement is that the device handler modules are loaded at the
    time the respective devices are probed. The
    <code class="systemitem">multipath-tools</code> package ensures this by installing
    appropriate configuration files. Once a device handler is attached to a
    given device, it cannot be changed anymore.
   </p></section></section><section class="sect1" id="sec-multipath-planning" data-id-title="Planning for multipathing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.3 </span><span class="title-name">Planning for multipathing</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-planning">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use the guidelines in this section when planning your multipath I/O
   solution.
  </p><section class="sect2" id="sec-multipath-planning-prereq" data-id-title="Prerequisites"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.3.1 </span><span class="title-name">Prerequisites</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-planning-prereq">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The storage array you use for the multipathed device must support
      multipathing. For more information, see
      <a class="xref" href="cha-multipath.html#sec-multipath-hardware" title="18.2. Hardware support">Section 18.2, “Hardware support”</a>.
     </p></li><li class="listitem"><p>
      You need to configure multipathing only if multiple physical paths exist
      between host bus adapters in the server and host bus controllers for the
      block storage device.
     </p></li><li class="listitem"><p>
      For some storage arrays, the vendor provides its own multipathing
      software to manage multipathing for the array’s physical and logical
      devices. In this case, you should follow the vendor’s instructions for
      configuring multipathing for those devices.
     </p></li><li class="listitem"><p>
      When using multipathing in a virtualization environment, the multipathing
      is controlled in the host server environment. Configure multipathing for
      the device before you assign it to a virtual guest machine.
     </p></li></ul></div></section><section class="sect2" id="sec-multipath-planning-types" data-id-title="Multipath installation types"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.3.2 </span><span class="title-name">Multipath installation types</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-planning-types">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    We distinguish installation types by the way the root device is handled.
    <a class="xref" href="cha-multipath.html#sec-multipath-installing" title="18.4. Installing SUSE Linux Enterprise Server on multipath systems">Section 18.4, “Installing <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> on multipath systems”</a> describes how the different
    setups are created during and after installation.
   </p><section class="sect3" id="sec-multipath-planning-type-root" data-id-title="Root file system on multipath (SAN-boot)"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">18.3.2.1 </span><span class="title-name">Root file system on multipath (SAN-boot)</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-planning-type-root">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The root file system is on a multipath device. This is typically the case
     for diskless servers that use SAN storage exclusively. On such systems,
     multipath support is required for booting, and multipathing must be
     enabled in the initramfs.
    </p></section><section class="sect3" id="sec-multipath-planning-type-noroot" data-id-title="Root file system on a local disk"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">18.3.2.2 </span><span class="title-name">Root file system on a local disk</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-planning-type-noroot">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The root file system (and possibly some other file systems) is on local
     storage, for example, on a directly attached SATA disk or local RAID, but
     the system additionally uses file systems in the multipath SAN storage.
     This system type can be configured in three different ways:
    </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.6.4.4.3.1"><span class="term">Multipath setup for local disk</span></dt><dd><p>
        All block devices are part of multipath maps, including the local disk.
        The root device appears as a degraded multipath map with just one path.
        This configuration is created if multipathing was enabled during the
        initial system installation with YaST.
       </p></dd><dt id="vl-multipath-planning-type-noroot-ignore"><span class="term">Local disk is excluded from multipath</span></dt><dd><p>
        In this configuration, multipathing is enabled in the initramfs, but
        the root device is explicitly excluded from multipath (see
        <a class="xref" href="cha-multipath.html#sec-multipath-blacklist" title="18.11.1. The blacklist section in multipath.conf">Section 18.11.1, “The <code class="literal">blacklist</code> section in <code class="filename">multipath.conf</code>”</a>).
        <a class="xref" href="cha-multipath.html#pr-multipath-disable-root" title="Disabling multipathing for the root disk after installation">Procedure 18.1, “Disabling multipathing for the root disk after installation”</a> describes how to set up
        this configuration.
       </p></dd><dt id="vl-multipath-planning-type-noroot-noinitrd"><span class="term">Multipath disabled in the initramfs</span></dt><dd><p>
        This setup is created if multipathing was not enabled during the
        initial system installation with YaST. This configuration is rather
        fragile; consider using one of the other options instead.
       </p></dd></dl></div></section></section><section class="sect2" id="sec-multipath-planning-disks" data-id-title="Disk management tasks"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.3.3 </span><span class="title-name">Disk management tasks</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-planning-disks">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use third-party SAN array management tools or the user interface of your
    storage array to create logical devices and assign them to hosts. Make sure
    to configure the host credentials correctly on both sides.
   </p><p>
    You can add or remove volumes to a running host, but detecting the changes
    may require rescanning SCSI targets and reconfiguring multipathing on the
    host. See <a class="xref" href="cha-multipath.html#sec-multipath-best-practice-scandev" title="18.14.6. Scanning for new devices without rebooting">Section 18.14.6, “Scanning for new devices without rebooting”</a>.
   </p><div id="id-1.11.6.6.6.5.4" data-id-title="Storage processors" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Storage processors</div><p>
     On some disk arrays, the storage array manages the traffic through storage
     processors. One processor is active and the other one is passive until
     there is a failure. If you are connected to the passive storage processor,
     you might not see the expected LUNs, or you might see the LUNs but
     encounter I/O errors when you try to access them.
    </p><p>
     If a disk array has more than one storage processor, ensure that the SAN
     switch has a connection to the active storage processor that owns the LUNs
     you want to access.
    </p></div></section><section class="sect2" id="sec-multipath-planning-raid" data-id-title="Software RAID and complex storage stacks"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.3.4 </span><span class="title-name">Software RAID and complex storage stacks</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-planning-raid">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Multipathing is set up on top of basic storage devices such as SCSI disks.
    In a multi-layered storage stack, multipathing is always the bottom layer.
    Other layers such as software RAID, Logical Volume Management, block device
    encryption, etc. are layered on top of it. Therefore, for each device that
    has multiple I/O paths and that you plan to use in a software RAID, you
    must configure the device for multipathing before you attempt to create the
    software RAID device.
   </p></section><section class="sect2" id="sec-multipath-planning-ha" data-id-title="High-availability solutions"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.3.5 </span><span class="title-name">High-availability solutions</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-planning-ha">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    High-availability solutions for clustering storage resources run on top of
    the multipathing service on each node. Make sure that the configuration
    settings in the <code class="filename">/etc/multipath.conf</code> file on each node
    are consistent across the cluster.
   </p><p>
    Make sure that multipath devices have the same name across all devices.
    Refer to <a class="xref" href="cha-multipath.html#sec-multipath-names" title="18.12. Multipath device names and WWIDs">Section 18.12, “Multipath device names and WWIDs”</a> for details.
   </p><p>
    The Distributed Replicated Block Device (DRBD) high-availability solution
    for mirroring devices across a LAN runs on top of multipathing. For each
    device that has multiple I/O paths and that you plan to use in a DRDB
    solution, you must configure the device for multipathing before you
    configure DRBD.
   </p><p>
    Special care must be taken when using multipathing together with clustering
    software that relies on shared storage for fencing, such as
    <code class="command">pacemaker</code> with <code class="command">sbd</code>. See
    <a class="xref" href="cha-multipath.html#sec-multipath-policies-cluster" title="18.9.2. Queuing policy on clustered servers">Section 18.9.2, “Queuing policy on clustered servers”</a> for details.
   </p></section></section><section class="sect1" id="sec-multipath-installing" data-id-title="Installing SUSE Linux Enterprise Server on multipath systems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.4 </span><span class="title-name">Installing <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> on multipath systems</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-installing">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   No special installation parameters are required for the installation of
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> on systems with multipath hardware.
  </p><section class="sect2" id="sec-multipath-installing-nomp" data-id-title="Installing without connected multipath devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.4.1 </span><span class="title-name">Installing without connected multipath devices</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-installing-nomp">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You may want to perform installation on a local disk, without configuring
    the fabric and the storage first, with the intention to add multipath SAN
    devices to the system later. In this case, the installation will proceed
    like on a non-multipath system. After installation,
    <code class="systemitem">multipath-tools</code> will be installed, but the
    <code class="systemitem">systemd</code> service <code class="filename">multipathd.service</code> will be disabled.
    The system will be configured as described in
    <a class="xref" href="cha-multipath.html#vl-multipath-planning-type-noroot-noinitrd">Multipath disabled in the initramfs</a> in
    <a class="xref" href="cha-multipath.html#sec-multipath-planning-type-noroot" title="18.3.2.2. Root file system on a local disk">Section 18.3.2.2, “Root file system on a local disk”</a>. Before adding SAN
    hardware, you will need to enable and start
    <code class="filename">multipathd.service</code>. We recommend creating a
    <code class="literal">blacklist</code> entry in the
    <code class="filename">/etc/multipath.conf</code> for the root device (see
    <a class="xref" href="cha-multipath.html#sec-multipath-blacklist" title="18.11.1. The blacklist section in multipath.conf">Section 18.11.1, “The <code class="literal">blacklist</code> section in <code class="filename">multipath.conf</code>”</a>).
   </p></section><section class="sect2" id="sec-multipath-installing-mp" data-id-title="Installing with connected multipath devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.4.2 </span><span class="title-name">Installing with connected multipath devices</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-installing-mp">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If multipath devices are connected to the system at installation time,
    YaST will detect them and display a pop-up window asking you whether
    multipath should be enabled before entering the partitioning stage.
   </p><div class="informalfigure"><div class="mediaobject"><a href="images/multipath-popup.png"><img src="images/multipath-popup.png" width="50%" alt="YaST multipath dialog" title="YaST multipath dialog"/></a></div></div><p>
    If you select “No” at this prompt (not recommended), the
    installation will proceed as in
    <a class="xref" href="cha-multipath.html#sec-multipath-installing-nomp" title="18.4.1. Installing without connected multipath devices">Section 18.4.1, “Installing without connected multipath devices”</a>. In the partitioning stage,
    do not use/edit devices that will later be part of a multipath map.
   </p><p>
    If you select “Yes” at the multipath prompt,
    <code class="command">multipathd</code> will run during the installation. No device
    will be added to the <code class="literal">blacklist</code> section of
    <code class="filename">/etc/multipath.conf</code>, thus all SCSI and DASD devices,
    including local disks, will appear as multipath devices in the partitioning
    dialogs. After installation, all SCSI and DASD devices will be multipath
    devices, as described in
    <a class="xref" href="cha-multipath.html#sec-multipath-planning-type-root" title="18.3.2.1. Root file system on multipath (SAN-boot)">Section 18.3.2.1, “Root file system on multipath (SAN-boot)”</a>.
   </p><div class="procedure" id="pr-multipath-disable-root" data-id-title="Disabling multipathing for the root disk after installation"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 18.1: </span><span class="title-name">Disabling multipathing for the root disk after installation </span></span><a title="Permalink" class="permalink" href="cha-multipath.html#pr-multipath-disable-root">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><p>
     This procedure assumes that you installed on a local disk and enabled
     multipathing during installation, so that the root device is on multipath
     now, but you prefer to set up the system as described in
     <a class="xref" href="cha-multipath.html#vl-multipath-planning-type-noroot-ignore">Local disk is excluded from multipath</a> in
     <a class="xref" href="cha-multipath.html#sec-multipath-planning-type-noroot" title="18.3.2.2. Root file system on a local disk">Section 18.3.2.2, “Root file system on a local disk”</a>.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Check your system for <code class="filename">/dev/mapper/...</code> references to
      your local root device, and replace them with references that will still
      work if the device is not a multipath map anymore (see
      <a class="xref" href="cha-multipath.html#sec-multipath-referring" title="18.12.4. Referring to multipath maps">Section 18.12.4, “Referring to multipath maps”</a>). If the following command
      finds no references, you do not need to apply changes:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> grep -rl /dev/mapper/ /etc</pre></div></li><li class="step"><p>
      Switch to <code class="literal">by-uuid</code> persistent device policy for
      <code class="command">dracut</code> (see
      <a class="xref" href="cha-multipath.html#sec-multipath-initrd-persistent" title="18.7.4.2. Persistent device names in the initramfs">Section 18.7.4.2, “Persistent device names in the initramfs”</a>):
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>echo 'persistent_policy="by-uuid"' | \
      sudo tee /etc/dracut.conf.d/10-persistent-policy.conf</pre></div></li><li class="step"><p>
      Determine the WWID of the root device:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>multipathd show paths format "%i %d %w %s"
0:2:0:0 sda 3600605b009e7ed501f0e45370aaeb77f IBM,ServeRAID M5210
...</pre></div><p>
      This command prints all paths devices with their WWIDs and vendor/product
      information. You will be able to identify the root device (here, the
      ServeRAID device) and note the WWID.
     </p></li><li class="step"><p>
      Create a blacklist entry in <code class="filename">/etc/multipath.conf</code> (see
      <a class="xref" href="cha-multipath.html#sec-multipath-blacklist" title="18.11.1. The blacklist section in multipath.conf">Section 18.11.1, “The <code class="literal">blacklist</code> section in <code class="filename">multipath.conf</code>”</a>) with the WWID you just
      determined (do <span class="emphasis"><em>not</em></span> apply these settings just yet):
     </p><div class="verbatim-wrap"><pre class="screen">blacklist {
    wwid 3600605b009e7ed501f0e45370aaeb77f
}</pre></div></li><li class="step"><p>
      Rebuild the initramfs:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dracut -f</pre></div></li><li class="step"><p>
      Reboot. Your system should boot with a non-multipath root disk.
     </p></li></ol></div></div></section></section><section class="sect1" id="sec-multipath-offline-update" data-id-title="Updating SLE on multipath systems"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.5 </span><span class="title-name">Updating SLE on multipath systems</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-offline-update">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   When updating your system online, you can proceed as described in
   <span class="intraxref">Book “Upgrade Guide”, Chapter 5 “Upgrading online”</span>.
  </p><p>
   The offline update of your system is similar to the fresh installation as
   described in <a class="xref" href="cha-multipath.html#sec-multipath-installing" title="18.4. Installing SUSE Linux Enterprise Server on multipath systems">Section 18.4, “Installing <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> on multipath systems”</a>. There is no
   <code class="literal">blacklist</code>, so if the user selects to enable multipath,
   the root device will appear as a multipath device, even if it is normally
   not one. When <code class="command">dracut</code> builds the initramfs during the update
   procedure, it sees a different storage stack than it would see on the booted
   system. See <a class="xref" href="cha-multipath.html#sec-multipath-initrd-persistent" title="18.7.4.2. Persistent device names in the initramfs">Section 18.7.4.2, “Persistent device names in the initramfs”</a> and
   <a class="xref" href="cha-multipath.html#sec-multipath-referring" title="18.12.4. Referring to multipath maps">Section 18.12.4, “Referring to multipath maps”</a>.
  </p></section><section class="sect1" id="sec-multipath-mpiotools" data-id-title="Multipath management tools"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.6 </span><span class="title-name">Multipath management tools</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-mpiotools">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The multipathing support in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is based on the Device Mapper
   Multipath module of the Linux kernel and the
   <code class="systemitem">multipath-tools</code> user space package.
  </p><p>
   The generic multipathing capability is handled by the Device Mapper
   Multipath (DM-MP) module. For details, refer to
   <a class="xref" href="cha-multipath.html#sec-multipath-mpiotools-dm" title="18.6.1. Device mapper multipath module">Section 18.6.1, “Device mapper multipath module”</a>.
  </p><p>
   The packages <code class="systemitem">multipath-tools</code> and
   <code class="systemitem">kpartx</code> provide tools that handle
   automatic path discovery and grouping. The tools are the following:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.9.5.1"><span class="term"><code class="command">multipathd</code></span></dt><dd><p>
      The daemon to set up and monitor multipath maps, and a command-line
      client to communicate with the daemon process. See
      <a class="xref" href="cha-multipath.html#sec-multipath-mpiotools-multipathd" title="18.6.2. The multipathd daemon">Section 18.6.2, “The <code class="command">multipathd</code> daemon”</a>.
     </p></dd><dt id="id-1.11.6.6.9.5.2"><span class="term"><code class="command">multipath</code></span></dt><dd><p>
      The command-line tool for multipath operations. See
      <a class="xref" href="cha-multipath.html#sec-multipath-mpiotools-multipath" title="18.6.3. The multipath command">Section 18.6.3, “The <code class="command">multipath</code> command”</a>.
     </p></dd><dt id="id-1.11.6.6.9.5.3"><span class="term"><code class="command">kpartx</code></span></dt><dd><p>
      The command-line tool for managing “partitions” on multipath
      devices. See <a class="xref" href="cha-multipath.html#sec-multipath-configuration-partitioning" title="18.7.3. Partitions on multipath devices and kpartx">Section 18.7.3, “Partitions on multipath devices and <code class="command">kpartx</code>”</a>.
     </p></dd><dt id="id-1.11.6.6.9.5.4"><span class="term"><code class="command">mpathpersist</code></span></dt><dd><p>
      The command-line tool for managing SCSI persistent reservations. See
      <a class="xref" href="cha-multipath.html#sec-multipath-mpiotools-mpathpersist" title="18.6.4. SCSI persistent reservations and mpathpersist">Section 18.6.4, “SCSI persistent reservations and <code class="command">mpathpersist</code>”</a>.
     </p></dd></dl></div><section class="sect2" id="sec-multipath-mpiotools-dm" data-id-title="Device mapper multipath module"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.6.1 </span><span class="title-name">Device mapper multipath module</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-mpiotools-dm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The Device Mapper Multipath (DM-MP) module
    <code class="filename">dm-multipath.ko</code> provides the generic multipathing
    capability for Linux. DM-MPIO is the preferred solution for multipathing on
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> for SCSI and DASD devices, and can be used for NVMe devices
    as well.
   </p><div id="id-1.11.6.6.9.6.3" data-id-title="Using DM-MP for NVMe devices" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Using DM-MP for NVMe devices</div><p>
     Since <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 15, native NVMe multipathing (see
     <a class="xref" href="cha-multipath.html#sec-multipath-hardware-implementations" title="18.2.1. Multipath implementations: device mapper and NVMe">Section 18.2.1, “Multipath implementations: device mapper and NVMe”</a>) has been
     recommended for NVMe and used by default. To disable native NVMe
     multipathing and use device mapper multipath instead (<span class="emphasis"><em>not
     recommended</em></span>), boot with the kernel parameter
     <code class="literal">nvme-core.multipath=0</code>.
    </p></div><p>
    The Device Mapper Multipath module handles the following tasks:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Distributing load over multiple paths inside the active path group.
     </p></li><li class="listitem"><p>
      Noticing I/O errors on path devices, and marking these as failed, so that
      no I/O will be sent to them.
     </p></li><li class="listitem"><p>
      Switching path groups when all paths in the active path group have
      failed.
     </p></li><li class="listitem"><p>
      Either failing or queuing I/O on the multipath device if all paths have
      failed, depending on configuration.
     </p></li></ul></div><p>
    The following tasks are handled by the user-space components in the
    <code class="systemitem">multipath-tools</code> package, not by the Device Mapper
    Multipath module:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Discovering devices representing different paths to the same storage
      device and assembling multipath maps from them.
     </p></li><li class="listitem"><p>
      Collecting path devices with similar properties into path groups.
     </p></li><li class="listitem"><p>
      Monitoring path devices actively for failure or reinstantiation.
     </p></li><li class="listitem"><p>
      Monitoring of addition and removal of path devices.
     </p></li><li class="listitem"><p>
      The Device Mapper Multipath module does not provide an easy-to-use user
      interface for setup and configuration.
     </p></li></ul></div><p>
    For details about the components from the
    <code class="systemitem">multipath-tools</code> package, refer to
    <a class="xref" href="cha-multipath.html#sec-multipath-mpiotools-multipathd" title="18.6.2. The multipathd daemon">Section 18.6.2, “The <code class="command">multipathd</code> daemon”</a>.
   </p><div id="id-1.11.6.6.9.6.9" data-id-title="Failures that multipath prevents" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Failures that multipath prevents</div><p>
     DM-MPIO protects against failures in the paths to the device, and not
     failures in the device itself, such as media errors. The latter kind of
     errors must be prevented by other means, such as replication.
    </p></div></section><section class="sect2" id="sec-multipath-mpiotools-multipathd" data-id-title="The multipathd daemon"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.6.2 </span><span class="title-name">The <code class="command">multipathd</code> daemon</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-mpiotools-multipathd">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="command">multipathd</code> is the most important part of a modern Linux
    device mapper multipath setup. It is normally started through the systemd
    service <code class="filename">multipathd.service</code> (see
    <a class="xref" href="cha-multipath.html#sec-multipath-configuration-start" title="18.7.1. Enabling, starting, and stopping multipath services">Section 18.7.1, “Enabling, starting, and stopping multipath services”</a>).
   </p><p>
    <code class="command">multipathd</code> serves the following tasks (some of them
    depend on the configuration):
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      On startup, detects path devices and sets up multipath maps from detected
      devices.
     </p></li><li class="listitem"><p>
      Monitors uevents and device mapper events, adding or removing path
      mappings to multipath maps as necessary and initiating failover or
      failback operations.
     </p></li><li class="listitem"><p>
      Sets up new maps on the fly when new path devices are discovered.
     </p></li><li class="listitem"><p>
      Checks path devices at regular intervals to detect failure, and tests
      failed paths to reinstate them if they become operational again.
     </p></li><li class="listitem"><p>
      When all paths fail, <code class="command">multipathd</code> either fails the map,
      or switches the map device to queuing mode for a given time interval.
     </p></li><li class="listitem"><p>
      Handles path state changes and switches path groups or regroups paths, as
      necessary.
     </p></li><li class="listitem"><p>
      Tests paths for “marginal” state, i.e. shaky fabrics
      conditions that cause path state flipping between operational and
      non-operational.
     </p></li><li class="listitem"><p>
      Handles SCSI persistent reservation keys for path devices if configured.
      See <a class="xref" href="cha-multipath.html#sec-multipath-mpiotools-mpathpersist" title="18.6.4. SCSI persistent reservations and mpathpersist">Section 18.6.4, “SCSI persistent reservations and <code class="command">mpathpersist</code>”</a>.
     </p></li></ul></div><p>
    <code class="command">multipathd</code> also serves as a command-line client to
    process interactive commands by sending them to the running daemon. The
    general syntax to send commands to the daemon is as follows:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipathd <em class="replaceable">COMMAND</em></pre></div><p>
    or
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipathd -k'<em class="replaceable">COMMAND</em>'</pre></div><p>
    There is also an interactive mode that allows sending multiple subsequent
    commands:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipathd -k</pre></div><div id="id-1.11.6.6.9.7.11" data-id-title="How multipath and multipathd work together" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: How multipath and multipathd work together</div><p>
     Many <code class="command">multipathd</code> commands have
     <code class="command">multipath</code> equivalents. For example, <code class="command">multipathd
     show topology</code> does the same thing as <code class="command">multipath
     -ll</code>. The notable difference is that the multipathd command
     inquires the internal state of the running <code class="command">multipathd</code>
     daemon, whereas multipath obtains information directly from the kernel and
     I/O operations.
    </p><p>
     If the multipath daemon is running, we recommend making modifications to
     the system by using the <code class="command">multipathd</code> commands. Otherwise,
     the daemon may notice configuration changes and react to them. In some
     situations, the daemon might even try to undo the applied changes.
     <code class="command">multipath</code> automatically delegates certain possibly
     dangerous commands, like destroying and flushing maps, to
     <code class="command">multipathd</code> if a running daemon is detected.
    </p></div><p>
    The list below describes frequently used <code class="command">multipathd</code>
    commands:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.9.7.13.1"><span class="term">show topology</span></dt><dd><p>
       Shows the current map topology and properties. See
       <a class="xref" href="cha-multipath.html#sec-multipath-best-practice-status" title="18.14.2. Interpreting multipath I/O status">Section 18.14.2, “Interpreting multipath I/O status”</a>.
      </p></dd><dt id="id-1.11.6.6.9.7.13.2"><span class="term">show paths</span></dt><dd><p>
       Shows the currently known path devices.
      </p></dd><dt id="id-1.11.6.6.9.7.13.3"><span class="term">show paths format "<em class="replaceable">FORMAT STRING</em>"</span></dt><dd><p>
       Shows the currently known path devices using a format string. Use
       <code class="command">show wildcards</code> to see a list of supported format
       specifiers.
      </p></dd><dt id="id-1.11.6.6.9.7.13.4"><span class="term">show maps</span></dt><dd><p>
       Shows the currently configured map devices.
      </p></dd><dt id="id-1.11.6.6.9.7.13.5"><span class="term">show maps format <em class="replaceable">FORMAT STRING</em></span></dt><dd><p>
       Shows the currently configured map devices using a format string. Use
       <code class="command">show wildcards</code> to see a list of supported format
       specifiers.
      </p></dd><dt id="id-1.11.6.6.9.7.13.6"><span class="term">show config local</span></dt><dd><p>
       Shows the current configuration that multipathd is using.
      </p></dd><dt id="id-1.11.6.6.9.7.13.7"><span class="term">reconfigure</span></dt><dd><p>
       Rereads configuration files, rescans devices, and sets up maps again.
       This is basically equivalent to a restart of
       <code class="command">multipathd</code>. A few options cannot be modified without
       a restart. They are mentioned in the man page
       <code class="systemitem">multipath.conf(5)</code>. The
       <code class="option">reconfigure</code> command reloads only map devices that have
       changed in some way. To force the reloading of every map device, use
       <code class="command">reconfigure all</code> (available since SUSE Linux Enterprise Server 15 SP4;
       on previous versions, <code class="option">reconfigure</code> reloaded every map).
      </p></dd><dt id="id-1.11.6.6.9.7.13.8"><span class="term">del map <em class="replaceable">MAP DEVICE NAME</em></span></dt><dd><p>
       Unconfigure and delete the given map device and its partitions.
       <em class="replaceable">MAP DEVICE NAME</em> can be a device node name
       like <code class="filename">dm-0</code>, a WWID, or a map name. The command fails
       if the device is in use.
      </p></dd><dt id="id-1.11.6.6.9.7.13.9"><span class="term">switchgroup map <em class="replaceable">MAP DEVICE NAME</em> group <em class="replaceable">N</em></span></dt><dd><p>
       Switch to the path group with the given numeric index (starting at 1).
       This is useful for maps with manual failback (see
       <a class="xref" href="cha-multipath.html#sec-multipath-policies-default" title="18.9. Configuring policies for failover, queuing, and failback">Section 18.9, “Configuring policies for failover, queuing, and failback”</a>).
      </p></dd></dl></div><p>
    Additional commands are available to modify path states, enable or disable
    queuing, and more. See <code class="systemitem">multipathd(8)</code> for details.
   </p></section><section class="sect2" id="sec-multipath-mpiotools-multipath" data-id-title="The multipath command"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.6.3 </span><span class="title-name">The <code class="command">multipath</code> command</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-mpiotools-multipath">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Even though multipath setup is mostly automatic and handled by
    <code class="command">multipathd</code>, <code class="command">multipath</code> is still useful
    for some administration tasks. Several examples of the command usage
    follow:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.9.8.3.1"><span class="term">multipath</span></dt><dd><p>
       Detects path devices and configures all multipath maps that it finds.
      </p></dd><dt id="id-1.11.6.6.9.8.3.2"><span class="term">multipath -d</span></dt><dd><p>
       Similar to <code class="command">multipath</code>, but does not set up any maps
       (“dry run”).
      </p></dd><dt id="id-1.11.6.6.9.8.3.3"><span class="term">multipath <em class="replaceable">DEVICENAME</em></span></dt><dd><p>
       Configures a specific multipath device.
       <em class="replaceable">DEVICENAME</em> can denote a member path device by
       its device node name (<code class="filename">/dev/sdb</code>) or device number in
       <code class="literal">major:minor</code> format. Alternatively, it can be the WWID
       or name of a multipath map.
      </p></dd><dt id="id-1.11.6.6.9.8.3.4"><span class="term">multipath -f <em class="replaceable">DEVICENAME</em></span></dt><dd><p>
       Unconfigures ("flushes") a multipath map and its partition mappings. The
       command will fail if the map or one of its partitions is in use. See
       above for possible values of <em class="replaceable">DEVICENAME</em>.
      </p></dd><dt id="id-1.11.6.6.9.8.3.5"><span class="term">multipath -F</span></dt><dd><p>
       Unconfigures ("flushes") all multipath maps and their partition
       mappings. The command will fail for maps in use.
      </p></dd><dt id="id-1.11.6.6.9.8.3.6"><span class="term">multipath -ll</span></dt><dd><p>
       Displays the status and topology of all currently configured multipath
       devices. See <a class="xref" href="cha-multipath.html#sec-multipath-best-practice-status" title="18.14.2. Interpreting multipath I/O status">Section 18.14.2, “Interpreting multipath I/O status”</a>.
      </p></dd><dt id="id-1.11.6.6.9.8.3.7"><span class="term">multipath -ll <em class="replaceable">DEVICENAME</em></span></dt><dd><p>
       Displays the status of a specified multipath device. See above for
       possible values of <em class="replaceable">DEVICENAME</em>.
      </p></dd><dt id="id-1.11.6.6.9.8.3.8"><span class="term">multipath -t</span></dt><dd><p>
       Shows the internal hardware table and the active configuration of
       multipath. Refer to <code class="systemitem">multipath.conf(5)</code> for
       details about the configuration parameters.
      </p></dd><dt id="id-1.11.6.6.9.8.3.9"><span class="term">multipath -T</span></dt><dd><p>
       Has a similar function to the <code class="command">multipath -t</code> command
       but shows only hardware entries matching the hardware detected on the
       host.
      </p></dd></dl></div><p>
    The option <code class="option">-v</code> controls the verbosity of the output. The
    provided value overrides the <code class="option">verbosity</code> option in
    <code class="filename">/etc/multipath.conf</code>. See
    <a class="xref" href="cha-multipath.html#sec-multipath-conf-misc" title="18.13. Miscellaneous options">Section 18.13, “Miscellaneous options”</a>.
   </p></section><section class="sect2" id="sec-multipath-mpiotools-mpathpersist" data-id-title="SCSI persistent reservations and mpathpersist"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.6.4 </span><span class="title-name">SCSI persistent reservations and <code class="command">mpathpersist</code></span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-mpiotools-mpathpersist">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="command">mpathpersist</code> utility is used to manage SCSI
    persistent reservations on Device Mapper Multipath devices. Persistent
    reservations serve to restrict access to SCSI Logical Units to certain SCSI
    initiators. In multipath configurations, it is important to use the same
    reservation keys for all I_T nexuses (paths) for a given volume; otherwise,
    creating a reservation on one path device would cause I/O errors on other
    paths.
   </p><p>
    Use this utility with the <code class="literal">reservation_key</code> attribute in
    the <code class="filename">/etc/multipath.conf</code> file to set persistent
    reservations for SCSI devices. If (and only if) this option is set, the
    <code class="command">multipathd</code> daemon checks persistent reservations for
    newly discovered paths or reinstated paths.
   </p><p>
    You can add the attribute to the <code class="literal">defaults</code> section or the
    <code class="literal">multipaths</code> section of
    <code class="filename">multipath.conf</code>. For example:
   </p><div class="verbatim-wrap"><pre class="screen">multipaths {
    multipath {
        wwid             3600140508dbcf02acb448188d73ec97d
        alias            yellow
        reservation_key  0x123abc
    }
}</pre></div><p>
    After setting the <code class="literal">reservation_key</code> parameter for all
    mpath devices applicable for persistent management, reload the
    configuration using <code class="command">multipathd reconfigure</code>.
   </p><div id="id-1.11.6.6.9.9.7" data-id-title="Using “reservation_key file”" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Using “<code class="option">reservation_key file</code>”</div><p>
     If the special value <code class="literal">reservation_key file</code> is used in
     the <code class="literal">defaults</code> section of
     <code class="filename">multipath.conf</code>, reservation keys can be managed
     dynamically in the file <code class="filename">/etc/multipath/prkeys</code> using
     <code class="command">mpathpersist</code>.
    </p><p>
     This is the recommended way to handle persistent reservations with
     multipath maps. It is available from <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 12 SP4.
    </p></div><p>
    Use the command <code class="command">mpathpersist</code> to query and set persistent
    reservations for multipath maps consisting of SCSI devices. Refer to the
    manual page <code class="systemitem">mpathpersist(8)</code> for details. The
    command-line options are the same as those of the
    <code class="command">sg_persist</code> from the <code class="systemitem">sg3_utils</code>
    package. The <code class="systemitem">sg_persist(8)</code> manual page explains
    the semantics of the options in detail.
   </p><p>
    In the following examples, <em class="replaceable">DEVICE</em> denotes a
    device mapper multipath device like
    <code class="filename">/dev/mapper/mpatha</code>. The commands below are listed with
    long options for better readability. All options have single-letter
    replacements, like in <code class="command">mpathpersist -oGS 123abc
    <em class="replaceable">DEVICE</em></code>.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.9.9.10.1"><span class="term">mpathpersist --in --read-keys <em class="replaceable">DEVICE</em></span></dt><dd><p>
       Read the registered reservation keys for the device.
      </p></dd><dt id="id-1.11.6.6.9.9.10.2"><span class="term">mpathpersist --in --read-reservation <em class="replaceable">DEVICE</em></span></dt><dd><p>
       Show existing reservations for the device.
      </p></dd><dt id="id-1.11.6.6.9.9.10.3"><span class="term">mpathpersist --out --register --param-sark=123abc <em class="replaceable">DEVICE</em></span></dt><dd><p>
       Register a reservation key for the device. This will add the reservation
       key for all I_T nexuses (path devices) on the host.
      </p></dd><dt id="id-1.11.6.6.9.9.10.4"><span class="term">mpathpersist --out --reserve --param-rk=123abc --prout-type=5 <em class="replaceable">DEVICE</em></span></dt><dd><p>
       Create a reservation of type 5 (“write exclusive - registrants
       only”) for the device, using the previously registered key.
      </p></dd><dt id="id-1.11.6.6.9.9.10.5"><span class="term">mpathpersist --out --release --param-rk=123abc --prout-type=5 <em class="replaceable">DEVICE</em></span></dt><dd><p>
       Release a reservation of type 5 for the device.
      </p></dd><dt id="id-1.11.6.6.9.9.10.6"><span class="term">mpathpersist --out --register-ignore --param-sark=0 <em class="replaceable">DEVICE</em></span></dt><dd><p>
       Delete a previously existing reservation key from the device.
      </p></dd></dl></div></section></section><section class="sect1" id="sec-multipath-config" data-id-title="Configuring the system for multipathing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.7 </span><span class="title-name">Configuring the system for multipathing</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-config">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-multipath-configuration-start" data-id-title="Enabling, starting, and stopping multipath services"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.7.1 </span><span class="title-name">Enabling, starting, and stopping multipath services</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-configuration-start">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To enable multipath services to start at boot time, run the following
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable multipathd</pre></div><p>
    To manually start the service in the running system, enter:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start multipathd</pre></div><p>
    To restart the service, enter:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart multipathd</pre></div><p>
    In most situations, restarting the service is not necessary. To simply have
    <code class="command">multipathd</code> reload its configuration, run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl reload multipathd</pre></div><p>
    To check the status of the service, enter:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl status multipathd</pre></div><p>
    To stop the multipath services in the current session, run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl stop multipathd multipathd.socket</pre></div><p>
    Stopping the service does not remove existing multipath maps. To remove
    unused maps, run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipath -F</pre></div><div id="id-1.11.6.6.10.3.16" data-id-title="Keep multipathd.service enabled" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Keep <code class="filename">multipathd.service</code> enabled</div><p>
     We strongly recommend keeping <code class="filename">multipathd.service</code>
     always enabled and running on systems with multipath hardware. The service
     does support <code class="command">systemd</code>'s socket activation mechanism, but
     we do not recommend that you rely on that. Multipath maps will not be set up
     during boot if the service is disabled.
    </p></div><div id="ann-multipath-configuration-disable" data-id-title="Disabling multipath" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Disabling multipath</div><p>
     If you need to disable multipath despite the warning above, for example,
     because a third-party multipathing software is going to be deployed,
     proceed as follows. Be sure that the system uses no hard-coded references
     to multipath devices (see <a class="xref" href="cha-multipath.html#sec-multipath-trouble-ref" title="18.15.2. Understanding device referencing issues">Section 18.15.2, “Understanding device referencing issues”</a>).
    </p><p>
     To disable multipathing <span class="emphasis"><em>just for a single system
     boot</em></span>, use the kernel parameter
     <code class="literal">multipath=off</code>. This affects both the booted system and
     the initramfs, which does not need to be rebuilt in this case.
    </p><p>
     To disable multipathd services <span class="emphasis"><em>permanently</em></span>, so that
     they will not be started on future system boots, run the following
     commands:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl disable multipathd multipathd.socket
<code class="prompt user">&gt; </code><code class="command">sudo</code> dracut --force --omit multipath</pre></div><p>
     (Whenever you disable or enable the multipath services, rebuild the
     <code class="systemitem">initramfs</code>. See
     <a class="xref" href="cha-multipath.html#sec-multipath-initrd-sync" title="18.7.4. Keeping the initramfs synchronized">Section 18.7.4, “Keeping the initramfs synchronized”</a>.)
    </p><p>
     If you want to make sure multipath devices do not get set up,
     <span class="emphasis"><em>even when running <code class="command">multipath</code>
     manually</em></span>, add the following lines at the end of
     <code class="filename">/etc/multipath.conf</code> before rebuilding the initramfs:
    </p><div class="verbatim-wrap"><pre class="screen">blacklist {
    wwid .*
}</pre></div></div></section><section class="sect2" id="sec-multipath-configuration-sandevs" data-id-title="Preparing SAN devices for multipathing"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.7.2 </span><span class="title-name">Preparing SAN devices for multipathing</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-configuration-sandevs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Before configuring multipath I/O for your SAN devices, prepare the SAN
    devices, as necessary, by doing the following:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Configure and zone the SAN with the vendor’s tools.
     </p></li><li class="listitem"><p>
      Configure permissions for host LUNs on the storage arrays with the
      vendor’s tools.
     </p></li><li class="listitem"><p>
      If <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> ships no driver for the host bus adapter (HBA), install
      a Linux driver from the HBA vendor. See the vendor’s specific
      instructions for more details.
     </p></li></ul></div><p>
    If multipath devices are detected and
    <code class="filename">multipathd.service</code> is enabled, multipath maps should
    be created automatically. If this does not happen,
    <a class="xref" href="cha-multipath.html#sec-multipath-trouble-steps" title="18.15.3. Troubleshooting steps in emergency mode">Section 18.15.3, “Troubleshooting steps in emergency mode”</a>
    lists some shell commands that can be used to examine the situation. When
    the LUNs are not seen by the HBA driver, check the zoning setup in the SAN.
    In particular, check whether LUN masking is active and whether the LUNs are
    correctly assigned to the server.
   </p><p>
    If the HBA driver can see LUNs, but no corresponding block devices are
    created, additional kernel parameters may be needed. See <em class="citetitle">TID
    3955167: Troubleshooting SCSI (LUN) Scanning Issues</em> in the
    SUSE Knowledge base at
    <a class="link" href="https://www.suse.com/support/kb/doc.php?id=3955167" target="_blank">https://www.suse.com/support/kb/doc.php?id=3955167</a>.
   </p></section><section class="sect2" id="sec-multipath-configuration-partitioning" data-id-title="Partitions on multipath devices and kpartx"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.7.3 </span><span class="title-name">Partitions on multipath devices and <code class="command">kpartx</code></span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-configuration-partitioning">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Multipath maps can have partitions like their path devices. Partition table
    scanning and device node creation for partitions is done in user space by
    the <code class="command">kpartx</code> tool. <code class="command">kpartx</code> is
    automatically invoked by udev rules; there is usually no need to run it
    manually. See <a class="xref" href="cha-multipath.html#sec-multipath-referring" title="18.12.4. Referring to multipath maps">Section 18.12.4, “Referring to multipath maps”</a> for ways to refer
    to multipath partitions.
   </p><div id="id-1.11.6.6.10.5.3" data-id-title="Disabling invocation of kpartx" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Disabling invocation of <code class="command">kpartx</code></div><p>
     The <code class="literal">skip_kpartx</code> option in
     <code class="filename">/etc/multipath.conf</code> can be used to disable invocation
     of <code class="command">kpartx</code> on selected multipath maps. This may be
     useful on virtualization hosts, for example.
    </p></div><p>
    Partition tables and partitions on multipath devices can be manipulated as
    usual, using YaST or tools like <code class="command">fdisk</code> or
    <code class="command">parted</code>. Changes applied to the partition table will be
    noted by the system when the partitioning tool exits. If this does not work
    (usually because a device is busy), try <code class="command">multipathd
    reconfigure</code>, or reboot the system.
   </p></section><section class="sect2" id="sec-multipath-initrd-sync" data-id-title="Keeping the initramfs synchronized"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.7.4 </span><span class="title-name">Keeping the initramfs synchronized</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-initrd-sync">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.11.6.6.10.6.2" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
     Make sure that the initial RAM file system (initramfs) and the booted
     system behave consistently regarding the use of multipathing for all block
     devices. Rebuild the initramfs after applying multipath configuration
     changes.
    </p></div><p>
    If multipathing is enabled in the system, it also needs to be enabled in
    the <code class="filename">initramfs</code> and vice versa. The only exception to
    this rule is the option
    <a class="xref" href="cha-multipath.html#vl-multipath-planning-type-noroot-noinitrd">Multipath disabled in the initramfs</a> in
    <a class="xref" href="cha-multipath.html#sec-multipath-planning-type-noroot" title="18.3.2.2. Root file system on a local disk">Section 18.3.2.2, “Root file system on a local disk”</a>.
   </p><p>
    The multipath configuration must be synchronized between the booted system
    and the initramfs. Therefore, if you change any of the files:
    <code class="filename">/etc/multipath.conf</code>,
    <code class="filename">/etc/multipath/wwids</code>,
    <code class="filename">/etc/multipath/bindings</code>, or other configuration files,
    or udev rules related to device identification, rebuild initramfs using the
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dracut -f</pre></div><p>
    If the <code class="filename">initramfs</code> and the system are not synchronized,
    the system will not boot properly, and the start-up procedure may result in
    an emergency shell. See <a class="xref" href="cha-multipath.html#sec-multipath-trouble" title="18.15. Troubleshooting MPIO">Section 18.15, “Troubleshooting MPIO”</a> for
    instructions on how to avoid or repair such a scenario.
   </p><section class="sect3" id="sec-multipath-initrd-disable" data-id-title="Enabling or disabling multipathing in the initramfs"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">18.7.4.1 </span><span class="title-name">Enabling or disabling multipathing in the initramfs</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-initrd-disable">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Special care must be taken if the initramfs is rebuilt in non-standard
     situations, for example, from a rescue system or after booting with the
     kernel parameter <code class="literal">multipath=off</code>.
     <code class="command">dracut</code> will automatically include multipathing support
     in the initramfs if and only if it detects that the root file system is on
     a multipath device while the initramfs is being built. In such cases, it
     is necessary to enable or disable multipathing explicitly.
    </p><p>
     To enable multipath support in the <code class="filename">initramfs</code>, run the
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dracut --force --add multipath</pre></div><p>
     To disable multipath support in <code class="filename">initramfs</code>, run the
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dracut --force --omit multipath</pre></div></section><section class="sect3" id="sec-multipath-initrd-persistent" data-id-title="Persistent device names in the initramfs"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">18.7.4.2 </span><span class="title-name">Persistent device names in the initramfs</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-initrd-persistent">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     When <code class="command">dracut</code> generates the initramfs, it must refer to
     disks and partitions to be mounted in a persistent manner, to make sure
     the system will boot correctly. When <code class="command">dracut</code> detects
     multipath devices, it will use the DM-MP device names such as
    </p><div class="verbatim-wrap"><pre class="screen">/dev/mapper/3600a098000aad73f00000a3f5a275dc8-part1</pre></div><p>
     for this purpose by default. This is good if the system
     <span class="emphasis"><em>always</em></span> runs in multipath mode. But if the system is
     started without multipathing, as described in
     <a class="xref" href="cha-multipath.html#sec-multipath-initrd-disable" title="18.7.4.1. Enabling or disabling multipathing in the initramfs">Section 18.7.4.1, “Enabling or disabling multipathing in the initramfs”</a>, booting with such an
     initramfs will fail, because the <code class="filename">/dev/mapper</code> devices
     will not exist. See <a class="xref" href="cha-multipath.html#sec-multipath-referring" title="18.12.4. Referring to multipath maps">Section 18.12.4, “Referring to multipath maps”</a> for another
     possible problem scenario, and some background information.
    </p><p>
     To prevent this from happening, change <code class="command">dracut</code>'s
     persistent device naming policy by using the
     <code class="option">--persistent-policy</code> option. We recommend setting the
     <code class="literal">by-uuid</code> use policy:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dracut --force --omit multipath --persistent-policy=by-uuid</pre></div><p>
     See also <a class="xref" href="cha-multipath.html#pr-multipath-disable-root" title="Disabling multipathing for the root disk after installation">Procedure 18.1, “Disabling multipathing for the root disk after installation”</a> and
     <a class="xref" href="cha-multipath.html#sec-multipath-trouble-ref" title="18.15.2. Understanding device referencing issues">Section 18.15.2, “Understanding device referencing issues”</a>.
    </p></section></section></section><section class="sect1" id="sec-multipath-conf-file" data-id-title="Multipath configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.8 </span><span class="title-name">Multipath configuration</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-conf-file">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The built-in <code class="systemitem">multipath-tools</code> defaults work well for
   most setups. If customizations are needed, a configuration file needs to be
   created. The main configuration file is
   <code class="filename">/etc/multipath.conf</code>. In addition, files in
   <code class="filename">/etc/multipath/conf.d/</code> are taken into account. See
   <a class="xref" href="cha-multipath.html#sec-multipath-conf-file-precedence" title="18.8.2.1. Additional configuration files and precedence rules">Section 18.8.2.1, “Additional configuration files and precedence rules”</a> for additional
   information.
  </p><div id="id-1.11.6.6.11.3" data-id-title="Vendor recommendations and built-in hardware defaults" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Vendor recommendations and built-in hardware defaults</div><p>
    Some storage vendors publish recommended values for multipath options in
    their documentation. These values often represent what the vendor has
    tested in their environment and found most suitable for the storage product.
    See the disclaimer in <a class="xref" href="cha-multipath.html#sec-multipath-hardware-autodetect" title="18.2.2. Storage array autodetection for multipathing">Section 18.2.2, “Storage array autodetection for multipathing”</a>.
   </p><p>
    <code class="systemitem">multipath-tools</code> has built-in defaults for many
    storage arrays that are derived from the published vendor recommendations.
    Run <code class="command">multipath -T</code> to see the current settings for your
    devices and compare them to vendor recommendations.
   </p></div><section class="sect2" id="sec-multipath-conf-file-create" data-id-title="Creating /etc/multipath.conf"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.8.1 </span><span class="title-name">Creating <code class="filename">/etc/multipath.conf</code></span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-conf-file-create">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    It is recommended that you create a minimal
    <code class="filename">/etc/multipath.conf</code> that just contains those settings
    you want to change. In many cases, you do not need to create
    <code class="filename">/etc/multipath.conf</code> at all.
   </p><p>
    If you prefer working with a configuration template that contains all
    possible configuration directives, run:
   </p><div class="verbatim-wrap"><pre class="screen">multipath -T &gt;/etc/multipath.conf</pre></div><p>
    See also
    <a class="xref" href="cha-multipath.html#sec-multipath-best-practice-config" title="18.14.1. Best practices for configuration">Section 18.14.1, “Best practices for configuration”</a>.
   </p></section><section class="sect2" id="sec-multipath-conf-file-syntax" data-id-title="multipath.conf syntax"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.8.2 </span><span class="title-name"><code class="filename">multipath.conf</code> syntax</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-conf-file-syntax">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="filename">/etc/multipath.conf</code> file uses a hierarchy of
    sections, subsections and option/value pairs.
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      White space separates tokens. Consecutive white space characters are
      collapsed into a single space, unless quoted (see below).
     </p></li><li class="listitem"><p>
      The hash (<code class="literal">#</code>) and exclamation mark
      (<code class="literal">!</code>) characters cause the rest of the line to be
      discarded as a comment.
     </p></li><li class="listitem"><p>
      Sections and subsections are started with a section name and an opening
      brace (<code class="literal">{</code>) on the same line, and end with a closing
      brace (<code class="literal">}</code>) on a line on its own.
     </p></li><li class="listitem"><p>
      Options and values are written on one line. Line continuations are
      unsupported.
     </p></li><li class="listitem"><p>
      Options and section names must be keywords. The allowed keywords are
      documented in <code class="systemitem">multipath.conf(5)</code>.
     </p></li><li class="listitem"><p>
      Values may be enclosed in double quotes (<code class="literal">"</code>). They must
      be enclosed in quotes if they contain white space or comment characters.
      A double quote character inside a value is represented by a pair of
      double quotes (<code class="literal">""</code>).
     </p></li><li class="listitem"><p>
      The values of some options are POSIX regular expressions (see
      <code class="systemitem">regex(7)</code>). They are case sensitive and not
      anchored, so “<code class="literal">bar</code>” matches
      “<code class="literal">rhabarber</code>”, but not “Barbie”.
     </p></li></ul></div><p>
    The following example illustrates the syntax:
   </p><div class="verbatim-wrap"><pre class="screen">section {
    subsection {
        option1 value
        option2      "complex value!"
        option3    "value with ""quoted"" word"
    } ! subsection end
} # section end</pre></div><section class="sect3" id="sec-multipath-conf-file-precedence" data-id-title="Additional configuration files and precedence rules"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">18.8.2.1 </span><span class="title-name">Additional configuration files and precedence rules</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-conf-file-precedence">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     After <code class="filename">/etc/multipath.conf</code>, the tools read files
     matching the pattern <code class="filename">/etc/multipath.conf.d/*.conf</code>.
     The additional files follow the same syntax rules as
     <code class="filename">/etc/multipath.conf</code>. Sections and options can occur
     multiple times. If <span class="emphasis"><em>the same option in the same
     section</em></span> is set in multiple files, or on multiple lines in the
     same file, the last value takes precedence. Separate precedence rules
     apply between <code class="filename">multipath.conf</code> sections. See below.
    </p></section></section><section class="sect2" id="sec-multipath-conf-file-sections" data-id-title="multipath.conf sections"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.8.3 </span><span class="title-name"><code class="filename">multipath.conf</code> sections</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-conf-file-sections">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="filename">/etc/multipath.conf</code> file is organized into the
    following sections. Some options can occur in more than one section. See
    <code class="systemitem">multipath.conf(5)</code> for details.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.11.6.3.1"><span class="term">defaults</span></dt><dd><p>
       General default settings.
      </p><div id="id-1.11.6.6.11.6.3.1.2.2" data-id-title="Overriding built-in device properties" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Overriding built-in device properties</div><p>
        Built-in hardware-specific device properties take precedence over the
        settings in the <code class="literal">defaults</code> section. Changes must
        therefore be made in the <code class="literal">devices</code> section or in the
        <code class="literal">overrides</code> section.
       </p></div></dd><dt id="id-1.11.6.6.11.6.3.2"><span class="term">blacklist</span></dt><dd><p>
       Lists devices to ignore. See
       <a class="xref" href="cha-multipath.html#sec-multipath-blacklist" title="18.11.1. The blacklist section in multipath.conf">Section 18.11.1, “The <code class="literal">blacklist</code> section in <code class="filename">multipath.conf</code>”</a>.
      </p></dd><dt id="id-1.11.6.6.11.6.3.3"><span class="term">blacklist_exceptions</span></dt><dd><p>
       Lists devices to be multipathed even though they are matched by the
       blacklist. See
       <a class="xref" href="cha-multipath.html#sec-multipath-blacklist" title="18.11.1. The blacklist section in multipath.conf">Section 18.11.1, “The <code class="literal">blacklist</code> section in <code class="filename">multipath.conf</code>”</a>.
      </p></dd><dt id="id-1.11.6.6.11.6.3.4"><span class="term">devices</span></dt><dd><p>
       Settings specific to the storage controller. This section is a
       collection of <code class="literal">device</code> subsections. Values in this
       section override values for the same options in the
       <code class="filename">defaults</code> section, and the built-in settings of
       <code class="systemitem">multipath-tools</code>.
      </p><p>
       <code class="literal">device</code> entries in the <code class="literal">devices</code>
       section are matched against the vendor and product of a device using
       regular expressions. These entries will be “merged”, setting
       all options from matching sections for the device. If the same option is
       set in multiple matching <code class="literal">device</code> sections, the last
       device entry takes precedence, even if it is less “specific”
       than preceding entries. This applies also if the matching entries appear
       in different configuration files (see
       <a class="xref" href="cha-multipath.html#sec-multipath-conf-file-precedence" title="18.8.2.1. Additional configuration files and precedence rules">Section 18.8.2.1, “Additional configuration files and precedence rules”</a>). In the following
       example, a device <code class="literal">SOMECORP STORAGE</code> will use
       <code class="literal">fast_io_fail_tmo 15</code>.
      </p><div class="verbatim-wrap"><pre class="screen">devices {
    device {
        vendor SOMECORP
        product STOR
        fast_io_fail_tmo 10
    }
    device {
        vendor SOMECORP
        product .*
        fast_io_fail_tmo 15
    }
}</pre></div></dd><dt id="id-1.11.6.6.11.6.3.5"><span class="term">multipaths</span></dt><dd><p>
       Settings for individual multipath devices. This section is a list of
       <code class="literal">multipath</code> subsections. Values override the
       <code class="literal">defaults</code> and <code class="literal">devices</code> sections.
      </p></dd><dt id="id-1.11.6.6.11.6.3.6"><span class="term">overrides</span></dt><dd><p>
       Settings that override values from all other sections.
      </p></dd></dl></div></section><section class="sect2" id="sec-multipath-conf-file-apply" data-id-title="Applying multipath.conf modifications"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.8.4 </span><span class="title-name">Applying <code class="filename">multipath.conf</code> modifications</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-conf-file-apply">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To apply the configuration changes, run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipathd reconfigure</pre></div><p>
    Do not forget to synchronize with the configuration in the initramfs. See
    <a class="xref" href="cha-multipath.html#sec-multipath-initrd-sync" title="18.7.4. Keeping the initramfs synchronized">Section 18.7.4, “Keeping the initramfs synchronized”</a>.
   </p><div id="id-1.11.6.6.11.7.5" data-id-title="Do not apply settings using multipath" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Do not apply settings using <code class="command">multipath</code></div><p>
     Do not apply new settings with the <code class="command">multipath</code> command
     while <code class="command">multipathd</code> is running. This may result in an
     inconsistent and possibly broken setup.
    </p></div><div id="sec-multipath-conf-file-verify" data-id-title="Verifying a modified setup" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Verifying a modified setup</div><p>
     It is possible to test modified settings first before they are applied, by
     running:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipath -d -v2</pre></div><p>
     This command shows new maps to be created with the proposed topology, but
     not whether maps will be removed/flushed. To obtain more information, run
     with increased verbosity:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipath -d -v3 2&gt;&amp;1 | less</pre></div></div></section></section><section class="sect1" id="sec-multipath-policies-default" data-id-title="Configuring policies for failover, queuing, and failback"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.9 </span><span class="title-name">Configuring policies for failover, queuing, and failback</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-policies-default">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The goal of multipath I/O is to provide connectivity fault tolerance between
   the storage system and the server. The desired default behavior depends on
   whether the server is a stand-alone server or a node in a high-availability
   cluster.
  </p><p>
   This section discusses the most important
   <code class="systemitem">multipath-tools</code> configuration parameters for
   achieving fault tolerance.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.12.4.1"><span class="term">polling_interval</span></dt><dd><p>
      The time interval (in seconds) between health checks for path devices.
      The default is 5 seconds. Failed devices are checked at this time
      interval. For healthy devices, the time interval may be increased up to
      <code class="literal">max_polling_interval</code> seconds.
     </p></dd><dt id="id-1.11.6.6.12.4.2"><span class="term">detect_checker</span></dt><dd><p>
      If this is set to <code class="literal">yes</code> (default, recommended),
      <code class="command">multipathd</code> automatically detects the best path
      checking algorithm.
     </p></dd><dt id="id-1.11.6.6.12.4.3"><span class="term">path_checker</span></dt><dd><p>
      The algorithm used to check path state. If you need to enable the
      checker, disable <code class="literal">detect_checker</code> as follows:
     </p><div class="verbatim-wrap"><pre class="screen">defaults {
	  detect_checker no
}</pre></div><p>
      The following list contains only the most important algorithms. See
      <code class="systemitem">multipath.conf(5)</code> for the full list.
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.12.4.3.2.4.1"><span class="term">tur</span></dt><dd><p>
         Send TEST UNIT READY command. This is the default for SCSI devices
         with ALUA support.
        </p></dd><dt id="id-1.11.6.6.12.4.3.2.4.2"><span class="term">directio</span></dt><dd><p>
         Read a device sector using asynchronous I/O (aio).
        </p></dd><dt id="id-1.11.6.6.12.4.3.2.4.3"><span class="term">rdac</span></dt><dd><p>
         Device-specific checker for NetAPP E-Series and similar arrays.
        </p></dd><dt id="id-1.11.6.6.12.4.3.2.4.4"><span class="term">none</span></dt><dd><p>
         No path checking is performed.
        </p></dd></dl></div></dd><dt id="id-1.11.6.6.12.4.4"><span class="term">checker_timeout</span></dt><dd><p>
      If a device does not respond to a path checker command in the given time,
      it is considered failed. The default is the kernel's SCSI command timeout
      for the device (usually 30 seconds).
     </p></dd><dt id="id-1.11.6.6.12.4.5"><span class="term">fast_io_fail_tmo</span></dt><dd><p>
      If an error on the SCSI transport layer is detected (for example on a
      Fibre Channel remote port), the kernel transport layer waits for this
      amount of time (in seconds) for the transport to recover. After that, the
      path device fails with “transport offline” state. This is
      very useful for multipath, because it allows a quick path failover for a
      frequently occurring class of errors. The value must match typical time
      scale for reconfiguration in the fabric. The default value of 5 seconds
      works well for Fibre Channel. Other transports, like iSCSI, may require
      longer timeouts.
     </p></dd><dt id="id-1.11.6.6.12.4.6"><span class="term">dev_loss_tmo</span></dt><dd><p>
      If a SCSI transport endpoint (for example a Fibre Channel remote port) is
      not reachable any more, the kernel waits for this amount of time (in
      seconds) for the port to reappear until it removes the SCSI device node
      for good. Device node removal is a complex operation which is prone to
      race conditions or deadlocks and should best be avoided. We therefore
      recommend setting this to a high value. The special value
      <code class="literal">infinity</code> is supported. The default is 10 minutes. To
      avoid deadlock situations, <code class="command">multipathd</code> ensures that I/O
      queuing (see <code class="literal">no_path_retry</code>) is stopped before
      <code class="literal">dev_loss_tmo</code> expires.
     </p></dd><dt id="id-1.11.6.6.12.4.7"><span class="term">no_path_retry</span></dt><dd><p>
      Determine what happens if all paths of a given multipath map have failed.
      The possible values are:
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.12.4.7.2.2.1"><span class="term">fail</span></dt><dd><p>
         Fail I/O on the multipath map. This will cause I/O errors in upper
         layers such as mounted file systems. The affected file systems, and
         possibly the entire host, will enter degraded mode.
        </p></dd><dt id="id-1.11.6.6.12.4.7.2.2.2"><span class="term">queue</span></dt><dd><p>
         I/O on the multipath map is queued in the device mapper layer and sent
         to the device when path devices become available again. This is the
         safest option to avoid losing data, but it can have negative effects
         if the path devices do not get reinstated for a long time. Processes
         reading from the device will hang in uninterruptible sleep
         (<code class="literal">D</code>) state. Queued data occupies memory, which
         becomes unavailable for processes. Eventually, memory will be
         exhausted.
        </p></dd><dt id="id-1.11.6.6.12.4.7.2.2.3"><span class="term"><em class="replaceable">N</em></span></dt><dd><p>
         <em class="replaceable">N</em> is a positive integer. Keep the map
         device in queuing mode for <em class="replaceable">N</em> polling
         intervals. When the time elapses, <code class="command">multipathd</code> fails
         the map device. If <code class="literal">polling_interval</code> is 5 seconds
         and <code class="literal">no_path_retry</code> is 6,
         <code class="command">multipathd</code> will queue I/O for approximately 6 * 5s
         = 30s before failing I/O on the map device.
        </p></dd></dl></div></dd><dt id="id-1.11.6.6.12.4.8"><span class="term">flush_on_last_del</span></dt><dd><p>
      If set to <code class="literal">yes</code> and all path devices of a map are
      deleted (as opposed to just failed), fail all I/O in the map before
      removing it. The default is <code class="literal">no</code>.
     </p></dd><dt id="id-1.11.6.6.12.4.9"><span class="term">deferred_remove</span></dt><dd><p>
      If set to <code class="literal">yes</code> and all path devices of a map are
      deleted, wait for holders to close the file descriptors for the map
      device before flushing and removing it. If paths reappear before the last
      holder closed the map, the deferred remove operation will be cancelled.
      The default is <code class="literal">no</code>.
     </p></dd><dt id="vle-failback"><span class="term">failback</span></dt><dd><p>
      If a failed path device in an inactive path group recovers,
      <code class="command">multipathd</code> reevaluates the path group priorities of
      all path groups (see <a class="xref" href="cha-multipath.html#sec-multipath-grouping" title="18.10. Configuring path grouping and priorities">Section 18.10, “Configuring path grouping and priorities”</a>). After the
      reevaluation, the highest-priority path group may be one of the currently
      inactive path groups. This parameter determines what happens in this
      situation.
     </p><div id="id-1.11.6.6.12.4.10.2.2" data-id-title="Observe vendor recommendations" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Observe vendor recommendations</div><p>
       The optimal failback policy depends on the property of the storage
       device. It is therefore strongly encouraged to verify
       <code class="option">failback</code> settings with the storage vendor.
      </p></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.12.4.10.2.3.1"><span class="term">manual</span></dt><dd><p>
         Nothing happens unless the administrator runs a <code class="command">multipathd
         switchgroup</code> (see
         <a class="xref" href="cha-multipath.html#sec-multipath-mpiotools-multipathd" title="18.6.2. The multipathd daemon">Section 18.6.2, “The <code class="command">multipathd</code> daemon”</a>).
        </p></dd><dt id="id-1.11.6.6.12.4.10.2.3.2"><span class="term">immediate</span></dt><dd><p>
         The highest-priority path group is activated immediately. This is
         often beneficial for performance, especially on stand-alone servers,
         but it should not be used for arrays on which the change of the path
         group is a costly operation.
        </p></dd><dt id="id-1.11.6.6.12.4.10.2.3.3"><span class="term">followover</span></dt><dd><p>
         Like <code class="literal">immediate</code>, but only perform failback when the
         path that has just become active is the only healthy path in its path
         group. This is useful for cluster configurations: It keeps a node from
         automatically failing back when another node requested a failover
         before.
        </p></dd><dt id="id-1.11.6.6.12.4.10.2.3.4"><span class="term"><em class="replaceable">N</em></span></dt><dd><p>
         <em class="replaceable">N</em> is a positive integer. Wait for
         <em class="replaceable">N</em> polling intervals before activating the
         highest priority path group. If the priorities change again during
         this time, the wait period starts anew.
        </p></dd></dl></div></dd><dt id="id-1.11.6.6.12.4.11"><span class="term">eh_deadline</span></dt><dd><p>
      Set an approximate upper limit for the time (in seconds) spent in SCSI
      error handling if devices are unresponsive and SCSI commands time out
      without error response. When the deadline has elapsed, the kernel will
      perform a full HBA reset.
     </p></dd></dl></div><p>
   After modifying the <code class="filename">/etc/multipath.conf</code> file, apply
   your settings as described in
   <a class="xref" href="cha-multipath.html#sec-multipath-conf-file-apply" title="18.8.4. Applying multipath.conf modifications">Section 18.8.4, “Applying <code class="filename">multipath.conf</code> modifications”</a>.
  </p><section class="sect2" id="sec-multipath-policies-standalone" data-id-title="Queuing policy on stand-alone servers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.9.1 </span><span class="title-name">Queuing policy on stand-alone servers</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-policies-standalone">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When you configure multipath I/O for a stand-alone server, a
    <code class="literal">no_path_retry</code> setting with value
    <code class="literal">queue</code> protects the server operating system from
    receiving I/O errors as long as possible. It queues messages until a
    multipath failover occurs. If “infinite” queuing is not desired
    (see above), select a numeric value that is deemed high enough for the
    storage paths to recover under ordinary circumstances (see above).
   </p></section><section class="sect2" id="sec-multipath-policies-cluster" data-id-title="Queuing policy on clustered servers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.9.2 </span><span class="title-name">Queuing policy on clustered servers</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-policies-cluster">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When you configure multipath I/O for a node in a high-availability cluster,
    you want multipath to report the I/O failure to trigger the resource
    failover instead of waiting for a multipath failover to be resolved. In
    cluster environments, you must modify the <code class="literal">no_path_retry
    </code>setting so that the cluster node receives an I/O error in
    relation to the cluster verification process (recommended to be 50% of the
    heartbeat tolerance) if the connection is lost to the storage system. In
    addition, you want the multipath <code class="literal">failback</code> to be set to
    <code class="literal">manual</code> or <code class="literal">followover</code> to avoid a
    ping-pong of resources because of path failures.
   </p></section></section><section class="sect1" id="sec-multipath-grouping" data-id-title="Configuring path grouping and priorities"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.10 </span><span class="title-name">Configuring path grouping and priorities</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-grouping">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Path devices in multipath maps are grouped in <span class="emphasis"><em>path
   groups</em></span>, also called <span class="emphasis"><em>priority groups</em></span>. Only
   one path group receives I/O at any given time. <code class="command">multipathd</code>
   assigns <span class="emphasis"><em>priorities</em></span> to path groups. Out of the path
   groups with active paths, the group with the highest priority is activated
   according to the configured failback policy for the map (see
   <a class="xref" href="cha-multipath.html#sec-multipath-policies-default" title="18.9. Configuring policies for failover, queuing, and failback">Section 18.9, “Configuring policies for failover, queuing, and failback”</a>).
   The priority of a path group is the average of the priorities of the active
   path devices in the path group. The priority of a path device is an integer
   value calculated from the device properties (see the description of the
   <code class="literal">prio</code> option below).
  </p><p>
   This section describes the <code class="filename">multipath.conf</code> configuration
   parameters relevant for priority determination and path grouping.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.13.4.1"><span class="term">path_grouping_policy</span></dt><dd><p>
      Specifies the method used to combine paths into groups. Only the most
      important policies are listed here; see
      <code class="systemitem">multipath.conf(5)</code> for other less frequently used
      values.
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.13.4.1.2.2.1"><span class="term">failover</span></dt><dd><p>
         One path per path group. This setting is useful for traditional
         “active/passive” storage arrays.
        </p></dd><dt id="id-1.11.6.6.13.4.1.2.2.2"><span class="term">multibus</span></dt><dd><p>
         All paths in one path group. This is useful for traditional
         “active/active” arrays.
        </p></dd><dt id="id-1.11.6.6.13.4.1.2.2.3"><span class="term">group_by_prio</span></dt><dd><p>
         Path devices with the same path priority are grouped together. This
         option is useful for modern arrays that support asymmetric access
         states, like ALUA. Combined with the <code class="literal">alua</code> or
         <code class="literal">sysfs</code> priority algorithms, the priority groups set
         up by <code class="command">multipathd</code> will match the primary target port
         groups that the storage array reports through ALUA-related SCSI
         commands.
        </p></dd></dl></div><p>
      Using the same policy names, the path grouping policy for a multipath map
      can be changed temporarily with the command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipath -p <em class="replaceable">POLICY_NAME</em> <em class="replaceable">MAP_NAME</em></pre></div></dd><dt id="id-1.11.6.6.13.4.2"><span class="term">marginal_pathgroups</span></dt><dd><p>
      If set to <code class="literal">on</code> or <code class="literal">fpin</code>,
      “marginal” path devices are sorted into a separate path
      group. This is independent of the path grouping algorithm in use. See
      <a class="xref" href="cha-multipath.html#sec-multipath-marginal" title="18.13.1. Handling unreliable (“marginal”) path devices">Section 18.13.1, “Handling unreliable (“marginal”) path devices”</a>.
     </p></dd><dt id="id-1.11.6.6.13.4.3"><span class="term">detect_prio</span></dt><dd><p>
      If this is set to <code class="literal">yes</code> (default, recommended),
      <code class="command">multipathd</code> automatically detects the best algorithm to
      set the priority for a storage device and ignores the
      <code class="literal">prio</code> setting. In practice, this means using the
      <code class="literal">sysfs</code> prio algorithm if ALUA support is detected.
     </p></dd><dt id="id-1.11.6.6.13.4.4"><span class="term">prio</span></dt><dd><p>
      Determines the method to derive priorities for path devices. If you
      override this, disable <code class="literal">detect_prio</code> as follows:
     </p><div class="verbatim-wrap"><pre class="screen">defaults {
	  detect_prio no
}</pre></div><p>
      The following list contains only the most important methods. Several
      other methods are available, mainly to support legacy hardware. See
      <code class="systemitem">multipath.conf(5)</code> for the full list.
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.13.4.4.2.4.1"><span class="term">alua</span></dt><dd><p>
         Uses SCSI-3 ALUA access states to derive path priority values. The
         optional <code class="literal">exclusive_pref_bit</code> argument can be used to
         change the behavior for devices that have the ALUA “preferred
         primary target port group” (PREF) bit set:
        </p><div class="verbatim-wrap"><pre class="screen">	prio alua
	prio_args exclusive_pref_bit</pre></div><p>
         If this option is set, “preferred” paths get a priority
         bonus over other active/optimized paths. Otherwise, all
         active/optimized paths are assigned the same priority.
        </p></dd><dt id="id-1.11.6.6.13.4.4.2.4.2"><span class="term">sysfs</span></dt><dd><p>
         Like <code class="literal">alua</code>, but instead of sending SCSI commands to
         the device, it obtains the access states from
         <code class="systemitem">sysfs</code>. This causes less I/O load than
         <code class="literal">alua</code>, but is not suitable for all storage arrays
         with ALUA support.
        </p></dd><dt id="id-1.11.6.6.13.4.4.2.4.3"><span class="term">const</span></dt><dd><p>
         Uses a constant value for all paths.
        </p></dd><dt id="id-1.11.6.6.13.4.4.2.4.4"><span class="term">path_latency</span></dt><dd><p>
         Measures I/O latency (time from I/O submission to completion) on path
         devices, and assigns higher priority to devices with lower latency.
         See <code class="systemitem">multipath.conf(5)</code> for details. This
         algorithm is still experimental.
        </p></dd><dt id="id-1.11.6.6.13.4.4.2.4.5"><span class="term">weightedpath</span></dt><dd><p>
         Assigns a priority to paths based on their name, serial number,
         Host:Bus:Target:Lun ID (HBTL), or Fibre Channel WWN. The priority
         value does not change over time. The method requires a
         <code class="literal">prio_args</code> argument, see
         <code class="systemitem">multipath.conf(5)</code> for details. For example:
        </p><div class="verbatim-wrap"><pre class="screen">	prio weightedpath
	prio_args "hbtl 2:.*:.*:.* 10 hbtl 3:.*:.*:.* 20 hbtl .* 1"</pre></div><p>
         This assigns devices on SCSI host 3 a higher priority than devices on
         SCSI host 2, and all others a lower priority.
        </p></dd></dl></div></dd><dt id="id-1.11.6.6.13.4.5"><span class="term">prio_args</span></dt><dd><p>
      Some <code class="literal">prio</code> algorithms require extra arguments. These
      are specified in this option, with syntax depending on the algorithm. See
      above.
     </p></dd><dt id="id-1.11.6.6.13.4.6"><span class="term">hardware_handler</span></dt><dd><p>
      The name of a kernel module that the kernel uses to activate path devices
      when switching path groups. This option has no effect with recent kernels
      because hardware handlers are autodetected. See
      <a class="xref" href="cha-multipath.html#sec-multipath-hardware-handlers" title="18.2.3. Storage arrays that require specific hardware handlers">Section 18.2.3, “Storage arrays that require specific hardware handlers”</a>.
     </p></dd><dt id="id-1.11.6.6.13.4.7"><span class="term">path_selector</span></dt><dd><p>
      The name of a kernel module that is used for load balancing between the
      paths of the active path group. The available choices depend on the
      kernel configuration. For historical reasons, the name must always be
      enclosed in quotes and followed by a “0” in
      <code class="filename">multipath.conf</code>, like this:
     </p><div class="verbatim-wrap"><pre class="screen">    path_selector "queue-length 0"</pre></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.13.4.7.2.3.1"><span class="term">service-time</span></dt><dd><p>
         Estimates the time pending I/O will need to complete on all paths, and
         selects the path with the lowest value. This is the default.
        </p></dd><dt id="id-1.11.6.6.13.4.7.2.3.2"><span class="term">historical-service-time</span></dt><dd><p>
         Estimates future service time based on the historical service time
         (about which it keeps a moving average) and the number of outstanding
         requests. Estimates the time pending I/O will need to complete on all
         paths, and selects the path with the lowest value.
        </p></dd><dt id="id-1.11.6.6.13.4.7.2.3.3"><span class="term">queue-length</span></dt><dd><p>
         Selects the path with the lowest number of currently pending I/O
         requests.
        </p></dd><dt id="id-1.11.6.6.13.4.7.2.3.4"><span class="term">round-robin</span></dt><dd><p>
         Switches paths in round-robin fashion. The number of requests
         submitted to a path before switching to the next one can be adjusted
         with the options <code class="literal">rr_min_io_rq</code> and
         <code class="literal">rr_weight</code>.
        </p></dd><dt id="id-1.11.6.6.13.4.7.2.3.5"><span class="term">io-affinity</span></dt><dd><p>
         This path selector currently does not work with
         <code class="systemitem">multipath-tools</code>.
        </p></dd></dl></div></dd></dl></div><p>
   After modifying the <code class="filename">/etc/multipath.conf</code> file, apply
   your settings as described in
   <a class="xref" href="cha-multipath.html#sec-multipath-conf-file-apply" title="18.8.4. Applying multipath.conf modifications">Section 18.8.4, “Applying <code class="filename">multipath.conf</code> modifications”</a>.
  </p></section><section class="sect1" id="sec-multipath-select-devices" data-id-title="Selecting devices for multipathing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.11 </span><span class="title-name">Selecting devices for multipathing</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-select-devices">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   On systems with multipath devices, you might want to avoid setting up
   multipath maps on some devices (typically local disks).
   <code class="systemitem">multipath-tools</code> offers various means for
   configuring which devices should be considered multipath path devices.
  </p><div id="id-1.11.6.6.14.3" data-id-title="multipath on local disks" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: multipath on local disks</div><p>
    In general, there is nothing wrong with setting up “degraded”
    multipath maps with just a single device on top of local disks. It works
    fine and requires no extra configuration. However, some administrators find
    this confusing or generally oppose this sort of unnecessary multipathing.
    Also, the multipath layer causes a slight performance overhead. See also
    <a class="xref" href="cha-multipath.html#sec-multipath-planning-type-noroot" title="18.3.2.2. Root file system on a local disk">Section 18.3.2.2, “Root file system on a local disk”</a>.
   </p></div><p>
   After modifying the <code class="filename">/etc/multipath.conf</code> file, apply
   your settings as described in
   <a class="xref" href="cha-multipath.html#sec-multipath-conf-file-apply" title="18.8.4. Applying multipath.conf modifications">Section 18.8.4, “Applying <code class="filename">multipath.conf</code> modifications”</a>.
  </p><section class="sect2" id="sec-multipath-blacklist" data-id-title="The blacklist section in multipath.conf"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.11.1 </span><span class="title-name">The <code class="literal">blacklist</code> section in <code class="filename">multipath.conf</code></span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-blacklist">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The <code class="filename">/etc/multipath.conf</code> file can contain a
    <code class="literal">blacklist</code> section that lists all devices that should be
    ignored by <code class="command">multipathd</code> and <code class="command">multipath</code>.
    The following example illustrates possible ways of excluding devices:
   </p><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">blacklist {
    wwid 3600605b009e7ed501f0e45370aaeb77f <span class="callout" id="mp-co-bl-wwid">1</span>
    device {  <span class="callout" id="mp-co-bl-device">2</span>
        vendor ATA
        product .*
    }
    protocol scsi:sas <span class="callout" id="mp-co-bl-prot">3</span>
    property SCSI_IDENT_LUN_T10 <span class="callout" id="mp-co-bl-prop">4</span>
    devnode "!^dasd[a-z]*" <span class="callout" id="mp-co-bl-devnode">5</span>
}</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-bl-wwid"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       <code class="literal">wwid</code> entries are ideal for excluding specific
       devices, for example, the root disk.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-bl-device"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       This <code class="literal">device</code> section excludes all ATA devices (the
       regular expression for <code class="literal">product</code> matches anything).
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-bl-prot"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Excluding by <code class="literal">protocol</code> allows excluding devices using
       certain bus types, here SAS. Other common protocol values are
       <code class="literal">scsi:fcp</code>, <code class="literal">scsi:iscsi</code>, and
       <code class="literal">ccw</code>. See <code class="systemitem">multipath.conf(5)</code>
       for more. To see the protocols that paths in your systems are using,
       run:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipathd show paths format "%d %P"</pre></div><p>
       This form is supported since <span class="productname"><span class="phrase">SLES</span></span> 15 SP1 and
       <span class="productname"><span class="phrase">SLES</span></span> 12 SP5.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-bl-prop"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       This <code class="literal">property</code> entry excludes devices that have a
       certain udev property (no matter what the value of the property is).
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-bl-devnode"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Excluding devices by <code class="literal">devnode</code> is only recommended for
       classes of devices using regular expressions, like in the example, which
       excludes everything but DASD devices. Using this for individual devices
       like <code class="filename">sda</code> is discouraged because device node names
       are not persistent.
      </p><p>
       The example illustrates special syntax that is only supported in the
       <code class="literal">blacklist</code> and <code class="literal">blacklist_exceptions</code>
       sections: Prefixing the regular expression with an exclamation mark
       (<code class="literal">!</code>) negates the match. Note that the exclamation mark
       must appear within double quotes.
      </p></td></tr></table></div></div><p>
    By default, <code class="systemitem">multipath-tools</code> ignores all devices
    except SCSI, DASD or NVMe. Technically, the built-in devnode exclude list
    is this negated regular expression:
   </p><div class="verbatim-wrap"><pre class="screen">    devnode !^(sd[a-z]|dasd[a-z]|nvme[0-9])</pre></div></section><section class="sect2" id="sec-multipath-blacklist-exceptions" data-id-title="The blacklist exceptions section in multipath.conf"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.11.2 </span><span class="title-name">The <code class="literal">blacklist exceptions</code> section in <code class="filename">multipath.conf</code></span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-blacklist-exceptions">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Sometimes, it is desired to configure only very specific devices for
    multipathing. In this case, devices are excluded by default, and exceptions
    are defined for devices that should be part of a multipath map. The
    <code class="literal">blacklist_exceptions</code> section exists for this purpose. It
    is typically used like in the following example, which excludes everything
    except storage with product string “NETAPP”:
   </p><div class="verbatim-wrap"><pre class="screen">blacklist {
     wwid .*
}
blacklist_exceptions {
     device {
         vendor ^NETAPP$
         product .*
     }
}</pre></div><p>
    The <code class="literal">blacklist_exceptions</code> section supports all methods
    described for the <code class="literal">blacklist</code> section above.
   </p><p>
    The <code class="literal">property</code> directive in
    <code class="literal">blacklist_exceptions</code> is mandatory because every device
    <span class="emphasis"><em>must</em></span> have at least one of the “allowed”
    udev properties to be considered a path device for multipath (the value of
    the property does not matter). The built-in default for
    <code class="literal">property</code> is
   </p><div class="verbatim-wrap"><pre class="screen">    property (SCSI_IDENT_|ID_WWN)</pre></div><p>
    Only devices that have at least one udev property matching this regular
    expression will be included.
   </p></section><section class="sect2" id="sec-multipath-device-select-other" data-id-title="Other options affecting device selection"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.11.3 </span><span class="title-name">Other options affecting device selection</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-device-select-other">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Besides the <code class="literal">blacklist</code> options, there are several other
    settings in <code class="filename">/etc/multipath.conf</code> that affect which
    devices are considered multipath path devices.
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.14.7.3.1"><span class="term">find_multipaths</span></dt><dd><p>
       This option controls the behavior of <code class="command">multipath</code> and
       <code class="command">multipathd</code> when a device that is not excluded is
       first encountered. The possible values are:
      </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.14.7.3.1.2.2.1"><span class="term">greedy</span></dt><dd><p>
          Every device non-excluded by <code class="literal">blacklist</code> in
          <code class="filename">/etc/multipath.conf</code> is included. This is the
          default on SUSE Linux Enterprise. If this setting is active, the only way to prevent
          devices from being added to multipath maps is setting them as
          excluded.
         </p></dd><dt id="id-1.11.6.6.14.7.3.1.2.2.2"><span class="term">strict</span></dt><dd><p>
          Every device is excluded, even if it is not present in the
          <code class="literal">blacklist</code> section of
          <code class="filename">/etc/multipath.conf</code>, unless its WWID is listed
          in the file <code class="filename">/etc/multipath/wwids</code>. It requires
          manual maintenance of the WWIDs file (see note below).
         </p></dd><dt id="id-1.11.6.6.14.7.3.1.2.2.3"><span class="term">yes</span></dt><dd><p>
          Devices are included if they meet the conditions for
          <code class="literal">strict</code>, or if at least one other device with the
          same WWID exists in the system.
         </p></dd><dt id="id-1.11.6.6.14.7.3.1.2.2.4"><span class="term">smart</span></dt><dd><p>
          If a new WWID is first encountered, it is temporarily marked as
          multipath path device. <code class="command">multipathd</code> waits for some
          time for additional paths with the same WWID to appear. If this
          happens, the multipath map is set up as usual. Otherwise, when the
          timeout expires, the single device is released to the system as
          a non-multipath device. The timeout is configurable with the option
          <code class="option">find_multipaths_timeout</code>.
         </p><p>
          This option depends on <code class="command">systemd</code> features which are
          only available on SUSE Linux Enterprise Server 15.
         </p></dd></dl></div><div id="id-1.11.6.6.14.7.3.1.2.3" data-id-title="Maintaining /etc/multipath/wwids" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Maintaining <code class="filename">/etc/multipath/wwids</code></div><p>
        <code class="systemitem">multipath-tools</code> keeps a record of previously
        setup multipath maps in the file
        <code class="filename">/etc/multipath/wwids</code> (the “WWIDs
        file”). Devices with WWIDs listed in this file are considered
        multipath path devices. The file is important for multipath device
        selection for all values of <code class="option">find_multipaths</code> except
        <code class="literal">greedy</code>.
       </p><p>
        If <code class="option">find_multipaths</code> is set to <code class="literal">yes</code> or
        <code class="literal">smart</code>, <code class="command">multipathd</code> adds WWIDs to
        <code class="filename">/etc/multipath/wwids</code> after setting up new maps, so
        that these maps will be detected more quickly in the future.
       </p><p>
        The WWIDs file can be manually modified:
       </p><div class="informalexample"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipath -a 3600a098000aad1e3000064e45f2c2355 <span class="callout" id="mp-co-wwid-a">1</span>
<code class="prompt user">&gt; </code><code class="command">sudo</code> multipath -w /dev/sdf <span class="callout" id="mp-co-wwid-w">2</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-wwid-a"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
           This command adds the given WWID to
           <code class="filename">/etc/multipath/wwids</code>.
          </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-wwid-w"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
           This command removes the WWID of the given device.
          </p></td></tr></table></div></div><p>
        In the <code class="literal">strict</code> mode, this is the only way to add new
        multipath devices. After modifying the WWIDs file, run
        <code class="command">multipathd reconfigure</code> to apply the changes. We
        recommend rebuilding the initramfs after applying changes to the WWIDs
        file (see <a class="xref" href="cha-multipath.html#sec-multipath-initrd-sync" title="18.7.4. Keeping the initramfs synchronized">Section 18.7.4, “Keeping the initramfs synchronized”</a>).
       </p></div></dd><dt id="id-1.11.6.6.14.7.3.2"><span class="term">allow_usb_devices</span></dt><dd><p>
       If this option is set to <code class="literal">yes</code>, USB storage devices are
       considered for multipathing. The default is <code class="literal">no</code>.
      </p></dd></dl></div></section></section><section class="sect1" id="sec-multipath-names" data-id-title="Multipath device names and WWIDs"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.12 </span><span class="title-name">Multipath device names and WWIDs</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-names">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="command">multipathd</code> and <code class="command">multipath</code> internally
   use WWIDs to identify devices. WWIDs are also used as map names by default.
   For convenience, <code class="systemitem">multipath-tools</code> supports assigning
   simpler, more easily memorizable names to multipath devices.
  </p><section class="sect2" id="sec-multipath-conf-file-wwid" data-id-title="WWIDs and device Identification"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.12.1 </span><span class="title-name">WWIDs and device Identification</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-conf-file-wwid">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    It is crucial for multipath operation to reliably detect devices that
    represent paths to the same storage volume.
    <code class="systemitem">multipath-tools</code> uses the device's World Wide
    Identification (WWID) for this purpose (sometimes also referred to as
    Universally Unique ID (UUID) or Unique ID (UID—do not confuse with
    “User ID”)). The WWID of a map device is always the same as the
    WWID of its path devices.
   </p><p>
    By default, WWIDs of path devices are inferred from udev properties of the
    devices, which are determined in udev rules, either by reading device
    attributes from the sysfs file system or by using specific I/O commands. To
    see the udev properties of a device, run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>udevadm info /dev/<em class="replaceable">sdx</em></pre></div><p>
    The udev properties used by <code class="systemitem">multipath-tools</code> to
    derive WWIDs are:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <code class="literal">ID_SERIAL</code> for SCSI devices (do not confuse this with
      the device's “serial number”)
     </p></li><li class="listitem"><p>
      <code class="literal">ID_UID</code> for DASD devices
     </p></li><li class="listitem"><p>
      <code class="literal">ID_WWN</code> for NVMe devices
     </p></li></ul></div><div id="id-1.11.6.6.15.3.7" data-id-title="Avoid changing WWIDs" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Avoid changing WWIDs</div><p>
     It is impossible to change the WWID of a multipath map which is in use. If
     the WWID of mapped path devices changes because of a configuration change,
     the map needs to be destroyed, and a new map needs to be set up with the
     new WWID. This cannot be done while the old map is in use. In extreme
     cases, data corruption may result from WWID changes. It must therefore be
     <span class="emphasis"><em>strictly avoided</em></span> to apply configuration changes that
     would cause map WWIDs to change.
    </p><p>
     It is allowed to enable the <code class="literal">uid_attrs</code> option in
     <code class="filename">/etc/multipath.conf</code>, see
     <a class="xref" href="cha-multipath.html#sec-multipath-conf-misc" title="18.13. Miscellaneous options">Section 18.13, “Miscellaneous options”</a>.
    </p></div></section><section class="sect2" id="sec-multipath-alias" data-id-title="Setting aliases for multipath maps"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.12.2 </span><span class="title-name">Setting aliases for multipath maps</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-alias">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Arbitrary map names can be set in the <code class="literal">multipaths</code> section
    of <code class="filename">/etc/multipath.conf</code> as follows:
   </p><div class="verbatim-wrap"><pre class="screen">multipaths {
    multipath {
        wwid 3600a098000aad1e3000064e45f2c2355
        alias postgres
    }
}</pre></div><p>
    Aliases are expressive, but they need to be assigned to each map
    individually, which may be cumbersome on large systems.
   </p></section><section class="sect2" id="sec-multipath-user-friendly-names" data-id-title="Using autogenerated user-friendly names"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.12.3 </span><span class="title-name">Using autogenerated user-friendly names</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-user-friendly-names">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="systemitem">multipath-tools</code> also supports autogenerated
    aliases, so-called “user-friendly names”. The naming scheme of
    the aliases follows the pattern: mpath<em class="replaceable">INDEX</em>,
    where <em class="replaceable">INDEX</em> is a lower case letter (starting
    with <code class="literal">a</code>). So the first autogenerated alias is
    <code class="literal">mpatha</code>, the next one is <code class="literal">mpathb</code>,
    <code class="literal">mpathc</code> to <code class="literal">mpathz</code>. After that follows
    <code class="literal">mpathaa</code>, <code class="literal">mpathab</code>, and so on.
   </p><p>
    Map names are only useful if they are persistent.
    <code class="systemitem">multipath-tools</code> keeps track of the assigned names
    in the file <code class="filename">/etc/multipath/bindings</code> (the
    “bindings file”). When a new map is created, the WWID is first
    looked up in this file. If it is not found, the lowest available
    user-friendly name is assigned to it.
   </p><p>
    Explicit aliases as discussed in <a class="xref" href="cha-multipath.html#sec-multipath-alias" title="18.12.2. Setting aliases for multipath maps">Section 18.12.2, “Setting aliases for multipath maps”</a> take
    precedence over user-friendly names.
   </p><p>
    The following options in <code class="filename">/etc/multipath.conf</code> affect
    user-friendly names:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.15.5.6.1"><span class="term">user_friendly_names</span></dt><dd><p>
       If set to <code class="literal">yes</code>, user-friendly names are assigned and
       used. Otherwise, the WWID is used as a map name unless an alias is
       configured.
      </p></dd><dt id="id-1.11.6.6.15.5.6.2"><span class="term">alias_prefix</span></dt><dd><p>
       The prefix used to create user-friendly names, <code class="literal">mpath</code>
       by default.
      </p></dd></dl></div><div id="id-1.11.6.6.15.5.7" data-id-title="Map names in high-availability clusters" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Map names in high-availability clusters</div><p>
     For cluster operations, device names must be identical across all nodes in
     the cluster. The <code class="systemitem">multipath-tools</code> configuration
     must be kept synchronized between nodes. If
     <code class="literal">user_friendly_names</code> is used,
     <code class="command">multipathd</code> may modify the
     <code class="filename">/etc/multipath/bindings</code> file at runtime. Such
     modifications must be replicated dynamically to all nodes. The same
     applies to <code class="filename">/etc/multipath/wwids</code> (see
     <a class="xref" href="cha-multipath.html#sec-multipath-device-select-other" title="18.11.3. Other options affecting device selection">Section 18.11.3, “Other options affecting device selection”</a>).
    </p></div><div id="id-1.11.6.6.15.5.8" data-id-title="Changing map names at runtime" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Changing map names at runtime</div><p>
     It is possible to change map names at runtime. Use any of the methods
     described in this section and run <code class="command">multipathd
     reconfigure</code>, and the map names will change without disrupting
     the system operation.
    </p></div></section><section class="sect2" id="sec-multipath-referring" data-id-title="Referring to multipath maps"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.12.4 </span><span class="title-name">Referring to multipath maps</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-referring">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Technically, multipath maps are Device Mapper devices, which have generic
    names of the form <code class="filename">/dev/dm-<em class="replaceable">n</em></code>
    with an integer number <em class="replaceable">n</em>. These names are not
    persistent. They should <span class="emphasis"><em>never</em></span> be used to refer to the
    multipath maps. <code class="command">udev</code> creates various symbolic links to
    these devices, which are more suitable as persistent references. These
    links differ with respect to their invariance against certain configuration
    changes. The following typical example shows various symlinks all pointing
    to the same device.
   </p><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">/dev/disk/by-id/dm-name-mpathb<span class="callout" id="mp-ref-dm-name">1</span> -&gt; ../../dm-1
/dev/disk/by-id/dm-uuid-mpath-3600a098000aad73f00000a3f5a275dc8<span class="callout" id="mp-ref-dm-uuid">2</span> -&gt; ../../dm-1
/dev/disk/by-id/scsi-3600a098000aad73f00000a3f5a275dc8<span class="callout" id="mp-ref-scsi">3</span> -&gt; ../../dm-1
/dev/disk/by-id/wwn-0x600a098000aad73f00000a3f5a275dc8<span class="callout" id="mp-ref-wwn">4</span> -&gt; ../../dm-1
/dev/mapper/mpathb<span class="callout" id="mp-ref-mapper">5</span> -&gt; ../dm-1</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-ref-dm-name"><span class="callout">1</span></a> <a href="#mp-ref-mapper"><span class="callout">5</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       These two links use the map name to refer to the map. Thus, the links
       will change if the map name changes, for example, if you enable or
       disable user-friendly names.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-ref-dm-uuid"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       This link uses the device mapper UUID, which is the WWID used by
       <code class="systemitem">multipath-tools</code> prefixed by the string
       <code class="literal">dm-uuid-mpath-</code>. It is independent of the map name.
      </p><p>
       The device mapper UUID is the preferred form to ensure that
       <span class="emphasis"><em>only multipath devices</em></span> are referenced. For example,
       the following line in <code class="filename">/etc/lvm/lvm.conf</code> rejects all
       devices except multipath maps:
      </p><div class="verbatim-wrap"><pre class="screen">filter = [ "a|/dev/disk/by-id/dm-uuid-mpath-.*|", "r|.*|" ]</pre></div></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-ref-scsi"><span class="callout">3</span></a> <a href="#mp-ref-wwn"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       These are links that would normally point to path devices. The multipath
       device took them over, because it has a higher udev link priority (see
       <code class="systemitem">udev(7)</code>). When the map is destroyed or
       multipathing is turned off, they will still exist and point to one of
       the path devices instead. This provides a means to reference a device by
       its WWID, whether or not multipathing is active.
      </p></td></tr></table></div></div><p>
    For <span class="bold"><strong>partitions</strong></span> on multipath maps created
    by the <code class="command">kpartx</code> tool, there are similar symbolic links,
    derived from the parent device name or WWID and the partition number:
   </p><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">/dev/disk/by-id/dm-name-mpatha-part2 -&gt; ../../dm-5
/dev/disk/by-id/dm-uuid-part2-mpath-3600a098000aad1e300000b4b5a275d45 -&gt; ../../dm-5
/dev/disk/by-id/scsi-3600a098000aad1e300000b4b5a275d45-part2 -&gt; ../../dm-5
/dev/disk/by-id/wwn-0x600a098000aad1e300000b4b5a275d45-part2 -&gt; ../../dm-5
/dev/disk/by-partuuid/1c2f70e0-fb91-49f5-8260-38eacaf7992b -&gt; ../../dm-5
/dev/disk/by-uuid/f67c49e9-3cf2-4bb7-8991-63568cb840a4 -&gt; ../../dm-5
/dev/mapper/mpatha-part2 -&gt; ../dm-5</pre></div></div><p>
    Note that partitions often have <code class="filename">by-uuid</code> links, too,
    referring not to the device itself but to the file system it contains.
    These links are often preferable. They are invariant even if the file
    system is copied to a different device or partition.
   </p><div id="id-1.11.6.6.15.6.7" data-id-title="Map names in the initramfs" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Map names in the initramfs</div><p>
     When <code class="command">dracut</code> builds an initramfs, it creates hard-coded
     references to devices in the initramfs, using
     <code class="filename">/dev/mapper/$MAP_NAME</code> references by default. These
     hard-coded references will not be found during boot if the map names used
     in the initramfs do not match the names used during building the
     initramfs, causing boot failure. Normally this will not happen, because
     <code class="command">dracut</code> will add all multipath configuration files to
     the initramfs. But problems can occur if the initramfs is built from a
     different environment, for example, in the rescue system or during an
     offline update. To prevent this boot failure, change
     <code class="command">dracut</code>'s <code class="literal">persistent_policy</code> setting,
     as explained in <a class="xref" href="cha-multipath.html#sec-multipath-initrd-persistent" title="18.7.4.2. Persistent device names in the initramfs">Section 18.7.4.2, “Persistent device names in the initramfs”</a>.
    </p></div></section></section><section class="sect1" id="sec-multipath-conf-misc" data-id-title="Miscellaneous options"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.13 </span><span class="title-name">Miscellaneous options</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-conf-misc">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section lists some useful <code class="filename">multipath.conf</code> options
   that were not mentioned so far. See
   <code class="systemitem">multipath.conf(5)</code> for a full list.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.16.3.1"><span class="term">verbosity</span></dt><dd><p>
      Controls the log verbosity of both <code class="command">multipath</code> and
      <code class="command">multipathd</code>. The command-line option
      <code class="option">-v</code> overrides this setting for both commands. The value
      can be between 0 (only fatal errors) and 4 (verbose logging). The default
      is 2.
     </p></dd><dt id="id-1.11.6.6.16.3.2"><span class="term">uid_attrs</span></dt><dd><p>
      This option enables an optimization for processing udev events, so-called
      “uevent merging”. It is useful in environments in which
      hundreds of path devices may fail or reappear simultaneously. In order to
      make sure that path WWIDs do not change (see
      <a class="xref" href="cha-multipath.html#sec-multipath-conf-file-wwid" title="18.12.1. WWIDs and device Identification">Section 18.12.1, “WWIDs and device Identification”</a>),
      the value should be set exactly like this:
     </p><div class="verbatim-wrap"><pre class="screen">defaults {
     uid_attrs "sd:ID_SERIAL dasd:ID_UID nvme:ID_WWN"
}</pre></div></dd><dt id="id-1.11.6.6.16.3.3"><span class="term">skip_kpartx</span></dt><dd><p>
      If set to <code class="literal">yes</code> for a multipath device (default is
      <code class="literal">no</code>), do not create partition devices on top of the
      given device (see
      <a class="xref" href="cha-multipath.html#sec-multipath-configuration-partitioning" title="18.7.3. Partitions on multipath devices and kpartx">Section 18.7.3, “Partitions on multipath devices and <code class="command">kpartx</code>”</a>).
      Useful for multipath devices used by virtual machines. Previous
      <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> releases achieved the same effect with the parameter
      “<code class="literal">features 1 no_partitions</code>”.
     </p></dd><dt id="id-1.11.6.6.16.3.4"><span class="term">max_sectors_kb</span></dt><dd><p>
      Limits the maximum amount of data sent in a single I/O request for all
      path devices of the multipath map.
     </p></dd><dt id="id-1.11.6.6.16.3.5"><span class="term">ghost_delay</span></dt><dd><p>
      On active/passive arrays, it can happen that passive paths (in
      “ghost” state) are probed before active paths. If the map was
      activated immediately and I/O was sent, this would cause a possibly
      costly path activation. This parameter specifies the time (in seconds) to
      wait for active paths of the map to appear before activating the map. The
      default is <code class="literal">no</code> (no ghost delay).
     </p></dd><dt id="id-1.11.6.6.16.3.6"><span class="term">recheck_wwid</span></dt><dd><p>
      If set to <code class="literal">yes</code> (default is <code class="literal">no</code>),
      double-checks the WWID of restored paths after failure, and removes them
      if the WWID has changed. This is a safety measure against data
      corruption.
     </p></dd><dt id="id-1.11.6.6.16.3.7"><span class="term">enable_foreign</span></dt><dd><p>
      <code class="systemitem">multipath-tools</code> provides a plugin API for other
      multipathing backends than Device Mapper multipath. The API supports
      monitoring and displaying information about the multipath topology using
      standard commands like <code class="command">multipath -ll</code>. Modifying the
      topology is unsupported.
     </p><p>
      The value of <code class="literal">enable_foreign</code> is a regular expression to
      match against foreign library names. The default value is
      “<code class="literal">NONE</code>”.
     </p><p>
      <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> ships the <code class="literal">nvme</code> plugin, which adds
      support for the native NVMe multipathing (see
      <a class="xref" href="cha-multipath.html#sec-multipath-hardware-implementations" title="18.2.1. Multipath implementations: device mapper and NVMe">Section 18.2.1, “Multipath implementations: device mapper and NVMe”</a>).
      To enable the <code class="literal">nvme</code> plugin, set
     </p><div class="verbatim-wrap"><pre class="screen">defaults {
    enable_foreign nvme
}</pre></div></dd></dl></div><section class="sect2" id="sec-multipath-marginal" data-id-title="Handling unreliable (“marginal”) path devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.13.1 </span><span class="title-name">Handling unreliable (“marginal”) path devices</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-marginal">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Unstable conditions in the fabric can cause path devices to behave
    erratically. They exhibit frequent I/O errors, recover, and fail again.
    Such path devices are also denoted “marginal” or
    “shaky” paths. This section summarizes the options that
    <code class="systemitem">multipath-tools</code> provides to deal with this
    problem.
   </p><div id="id-1.11.6.6.16.4.3" data-id-title="multipathds marginal path checking algorithm" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: multipathd's marginal path checking algorithm</div><p>
     If a path device exhibits a second failure (good → bad transition) before
     <code class="literal">marginal_path_double_failed_time</code> elapses after the
     first failure, <code class="command">multipathd</code> starts monitoring the path at
     a rate of 10 requests per second, for a monitoring period of
     <code class="literal">marginal_path_err_sample_time</code>. If the error rate during
     the monitoring period exceeds
     <code class="literal">marginal_path_err_rate_threshold</code>, the path is
     classified as marginal. After
     <code class="literal">marginal_path_err_recheck_gap_time</code>, the path
     transitions to normal state again.
    </p><p>
     This algorithm is used if all four numeric
     <code class="literal">marginal_path_</code> parameters are set to a positive value,
     and <code class="literal">marginal_pathgroups</code> is not set to
     <code class="literal">fpin</code>. It is available since SUSE Linux Enterprise Server 15 SP1 and
     SUSE Linux Enterprise Server 12 SP5.
    </p></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.16.4.4.1"><span class="term">marginal_path_double_failed_time</span></dt><dd><p>
       Maximum time (in seconds) between two path failures that triggers path
       monitoring.
      </p></dd><dt id="id-1.11.6.6.16.4.4.2"><span class="term">marginal_path_err_sample_time</span></dt><dd><p>
       Length (in seconds) of the path monitoring interval.
      </p></dd><dt id="id-1.11.6.6.16.4.4.3"><span class="term">marginal_path_err_rate_threshold</span></dt><dd><p>
       Minimum error rate (per thousand I/Os).
      </p></dd><dt id="id-1.11.6.6.16.4.4.4"><span class="term">marginal_path_err_recheck_gap_time</span></dt><dd><p>
       Time (in seconds) to keep the path in marginal state.
      </p></dd><dt id="id-1.11.6.6.16.4.4.5"><span class="term">marginal_pathgroups</span></dt><dd><p>
       This option is available since <span class="productname"><span class="phrase">SLES</span></span> 15SP3. Possible
       values are:
      </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.16.4.4.5.2.2.1"><span class="term">off</span></dt><dd><p>
          Marginal state is determined by <code class="command">multipathd</code> (see
          above). Marginal paths are not reinstated as long as they remain in
          marginal state. This is the default, and the behavior in SUSE Linux Enterprise Server
          releases before SP3, where the <code class="literal">marginal_pathgroups</code>
          option was unavailable.
         </p></dd><dt id="id-1.11.6.6.16.4.4.5.2.2.2"><span class="term">on</span></dt><dd><p>
          Similar to the <code class="literal">off</code> option, but instead of keeping
          them in the failed state, marginal paths are moved to a separate path
          group, which will be assigned a lower priority than all other path
          groups (see <a class="xref" href="cha-multipath.html#sec-multipath-grouping" title="18.10. Configuring path grouping and priorities">Section 18.10, “Configuring path grouping and priorities”</a>).
          Paths in this path group will only be used for I/O if all paths in
          other path groups have failed.
         </p></dd><dt id="id-1.11.6.6.16.4.4.5.2.2.3"><span class="term">fpin</span></dt><dd><p>
          This setting is available from <span class="productname"><span class="phrase">SLES</span></span> 15SP4.
          Marginal path state is derived from FPIN events (see below). Marginal
          paths are moved into a separate path group, as described
          for<code class="literal">off</code>. This setting requires no further host-side
          configuration. It is the recommended way to handle marginal paths on
          Fibre Channel fabrics that support FPIN.
         </p><div id="id-1.11.6.6.16.4.4.5.2.2.3.2.2" data-id-title="FPIN-based marginal path detection" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: FPIN-based marginal path detection</div><p>
           <code class="command">multipathd</code> listens for Fibre Channel Performance
           Impact Notifications (FPIN). If an FPIN-LI (Link Integrity) event is
           received for a path device, the path will enter marginal state. This
           state will last until a RSCN or Link up event is received on the
           Fibre channel adapter the device is connected to.
          </p></div></dd></dl></div></dd></dl></div><p>
    A simpler algorithm using the parameters
    <code class="literal">san_path_err_threshold</code>,
    <code class="literal">san_path_err_forget_rate</code>, and
    <code class="literal">san_path_err_recovery time</code> is also available and
    recommended for SUSE Linux Enterprise Server 15 (GA). See the “Shaky paths
    detection” section in <code class="systemitem">multipath.conf(5)</code>.
   </p></section></section><section class="sect1" id="sec-multipath-best-practice" data-id-title="Best practice"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.14 </span><span class="title-name">Best practice</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-best-practice">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="sec-multipath-best-practice-config" data-id-title="Best practices for configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.14.1 </span><span class="title-name">Best practices for configuration</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-best-practice-config">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The large number of configuration directives is daunting at first. Usually,
    you can get good results with an empty configuration, unless you are in a
    clustering environment.
   </p><p>
    Here are some general recommendations for stand-alone servers. They are
    <span class="emphasis"><em>not mandatory</em></span>. See the documentation of the respective
    parameters in the previous sections for background information.
   </p><div class="verbatim-wrap"><pre class="screen">defaults {
    deferred_remove      yes
    find_multipaths      smart
    enable_foreign       nvme
    marginal_pathgroups  fpin    # 15.4 only, if supported by fabric
}
devices {
    # A catch-all device entry.
    device {
        vendor                .*
        product               .*
        dev_loss_tmo          infinity
        no_path_retry         60            # 5 minutes
        path_grouping_policy  group_by_prio
        path_selector         "historical-service-time 0"
        reservation_key       file          # if using SCSI persistent reservations
    }
    # Follow up with specific device entries below, they will take precedence.
}</pre></div><p>
    After modifying the <code class="filename">/etc/multipath.conf</code> file, apply
    your settings as described in
    <a class="xref" href="cha-multipath.html#sec-multipath-conf-file-apply" title="18.8.4. Applying multipath.conf modifications">Section 18.8.4, “Applying <code class="filename">multipath.conf</code> modifications”</a>.
   </p></section><section class="sect2" id="sec-multipath-best-practice-status" data-id-title="Interpreting multipath I/O status"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.14.2 </span><span class="title-name">Interpreting multipath I/O status</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-best-practice-status">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    For a quick overview of the multipath subsystem, use <code class="command">multipath
    -ll</code> or <code class="command">multipathd show topology</code>. The output of
    these commands has the same format. The former command reads the kernel
    state, while the latter prints the status of the multipath daemon. Normally
    both states are equal. Here is an example of the output:
   </p><div class="informalexample"><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipathd show topology
mpatha<span class="callout" id="mp-co-top-name">1</span> (3600a098000aad1e300000b4b5a275d45<span class="callout" id="mp-co-top-wwid">2</span>) dm-0<span class="callout" id="mp-co-top-dev">3</span> NETAPP,INF-01-00<span class="callout" id="mp-co-top-prod">4</span>
size=64G features='3 queue_if_no_path pg_init_retries 50'<span class="callout" id="mp-co-top-feat">5</span> hwhandler='1 alua'<span class="callout" id="mp-co-top-hwh">6</span> wp=rw<span class="callout" id="mp-co-top-wp">7</span>
|-+- <span class="callout" id="mp-co-top-pg">8</span>policy='historical-service-time 2'<span class="callout" id="mp-co-top-ps">9</span> prio=50<span class="callout" id="mp-co-top-prio">10</span> status=active<span class="callout" id="mp-co-top-pgst">11</span>
| |-<span class="callout" id="mp-co-top-pp">12</span> 3:0:0:1<span class="callout" id="mp-co-top-hbtl">13</span> sdb 8:16<span class="callout" id="mp-co-top-sd">14</span> active<span class="callout" id="mp-co-top-dmst">15</span> ready<span class="callout" id="mp-co-top-st">16</span> running<span class="callout" id="mp-co-top-devst">17</span>
| `- 4:0:0:1 sdf 8:80  active ready running
`-+- policy='historical-service-time 2' prio=10 status=enabled
  `- 4:0:1:1 sdj 8:144 active ready running</pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-name"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The map name.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-wwid"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The map WWID (if different from the map name).
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-dev"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The device node name of the map device.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-prod"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The vendor and product name.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-pg"><span class="callout">8</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       A path group. The indented lines below the path group list the path
       devices that belong to it.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-ps"><span class="callout">9</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The path selector algorithm used by the path group. The "2" can be
       ignored.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-prio"><span class="callout">10</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The priority of the path group.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-pgst"><span class="callout">11</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The status of the path group (<code class="literal">active</code>,
       <code class="literal">enabled</code> or <code class="literal">disabled</code>). The active
       path group is the one that I/O is currently sent to.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-pp"><span class="callout">12</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       A path device.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-hbtl"><span class="callout">13</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The bus ID of the device (here, a SCSI Host:Bus:Target:Lun ID).
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-sd"><span class="callout">14</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The device node name and major/minor number of the path device.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-dmst"><span class="callout">15</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The kernel device mapper state of the path (<code class="literal">active</code> or
       <code class="literal">failed</code>).
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-st"><span class="callout">16</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The multipath path device state (see below).
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-top-devst"><span class="callout">17</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       The state of the path device in the kernel. This is a device-type
       specific value. For SCSI, it is either <code class="literal">running</code> or
       <code class="literal">offline</code>.
      </p></td></tr></table></div></div><p>
    The multipath path device states are:
   </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">ready</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         The path is healthy and up
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">ghost</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         A passive path in an active/passive array
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">faulty</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         The path is down or unreachable
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">i/o timeout</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         A checker command timed out
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">i/o pending</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Waiting for the completion of a path checker command
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">delayed</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Path reinstantiation is delayed to avoid "flapping"
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="literal">shaky</code>
        </p>
       </td><td>
        <p>
         An unreliable path (emc path checker only)
        </p>
       </td></tr></tbody></table></div></section><section class="sect2" id="sec-multipath-lvm" data-id-title="Using LVM2 on multipath devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.14.3 </span><span class="title-name">Using LVM2 on multipath devices</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-lvm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    LVM2 has built-in support for detecting multipath devices. It is activated
    by default in <code class="filename">/etc/lvm/lvm.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">    multipath_component_detection=1</pre></div><p>
    This works reliably only if LVM2 is also configured to obtain information
    about device properties from udev:
   </p><div class="verbatim-wrap"><pre class="screen">    external_device_info_source="udev"</pre></div><p>
    This is the default in SUSE Linux Enterprise 15 SP4, but not in earlier releases. It
    is also possible (although normally not necessary) to create a filter
    expression for LVM2 to ignore all devices except multipath devices. See
    <a class="xref" href="cha-multipath.html#sec-multipath-referring" title="18.12.4. Referring to multipath maps">Section 18.12.4, “Referring to multipath maps”</a>.
   </p></section><section class="sect2" id="sec-multipath-best-practice-io-stalled" data-id-title="Resolving stalled I/O"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.14.4 </span><span class="title-name">Resolving stalled I/O</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-best-practice-io-stalled">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If all paths fail concurrently and I/O is queued, applications may stall
    for a long time. To resolve this, you can use the following procedure:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Enter the following command at a terminal prompt:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipathd disablequeueing map <em class="replaceable">MAPNAME</em></pre></div><p>
      Replace <code class="literal"><em class="replaceable">MAPNAME</em></code> with the
      correct WWID or mapped alias name for the device.
     </p><p>
      This command immediately causes all queued I/O to fail and propagates the
      error to the calling application. File systems will observe I/O errors
      and switch to read-only mode.
     </p></li><li class="step"><p>
      Reactivate queuing by entering the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> multipathd restorequeueing <em class="replaceable">MAPNAME</em></pre></div></li></ol></div></div></section><section class="sect2" id="sec-multipath-mpiotools-mdadm" data-id-title="MD RAID on multipath devices"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.14.5 </span><span class="title-name">MD RAID on multipath devices</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-mpiotools-mdadm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    MD RAID arrays on top of multipathing are set up automatically by the
    system's udev rules. No special configuration in
    <code class="filename">/etc/mdadm.conf</code> is necessary.
   </p></section><section class="sect2" id="sec-multipath-best-practice-scandev" data-id-title="Scanning for new devices without rebooting"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.14.6 </span><span class="title-name">Scanning for new devices without rebooting</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-best-practice-scandev">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If your system has already been configured for multipathing and you need to
    add storage to the SAN, you can use the
    <code class="command">rescan-scsi-bus.sh</code> script to scan for the new devices.
    The general syntax for the command follows:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> rescan-scsi-bus.sh [-a] [-r] --hosts=2-3,5</pre></div><p>
    Where the options have the following meaning:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.6.17.7.5.1"><span class="term">-a</span></dt><dd><p>
       the option ensures that all SCSI targets are scanned, otherwise only
       already existing targets will be scanned for new LUNs.
      </p></dd><dt id="id-1.11.6.6.17.7.5.2"><span class="term">-r</span></dt><dd><p>
       the option enables the removal of devices which have been removed on the
       storage side.
      </p></dd><dt id="id-1.11.6.6.17.7.5.3"><span class="term">--hosts</span></dt><dd><p>
       the option specifies the list of host bus adapters to scan (the default
       is to scan all).
      </p></dd></dl></div><p>
    Run <code class="command">rescan-scsi-bus.sh --help</code> for help on additional
    options.
   </p><p>
    If <code class="command">multipathd</code> is running and new SAN devices are
    discovered, they should be automatically set up as multipath maps according
    to the configuration described in
    <a class="xref" href="cha-multipath.html#sec-multipath-select-devices" title="18.11. Selecting devices for multipathing">Section 18.11, “Selecting devices for multipathing”</a>.
   </p><div id="id-1.11.6.6.17.7.8" data-id-title="Dell/EMC PowerPath environments" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Dell/EMC PowerPath environments</div><p>
     In EMC PowerPath environments, do not use the
     <code class="filename">rescan-scsi-bus.sh</code> utility provided with the
     operating system or the HBA vendor scripts for scanning the SCSI buses. To
     avoid potential file system corruption, EMC requires that you follow the
     procedure provided in the vendor documentation for EMC PowerPath for
     Linux.
    </p></div></section></section><section class="sect1" id="sec-multipath-trouble" data-id-title="Troubleshooting MPIO"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">18.15 </span><span class="title-name">Troubleshooting MPIO</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-trouble">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If a system runs into emergency mode on a system with multipath, printing
   messages about missing devices, the reason is almost always one of these:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Inconsistent configuration of multipath device selection
    </p></li><li class="listitem"><p>
     Use of non-existing device references
    </p></li></ul></div><section class="sect2" id="sec-multipath-trouble-select" data-id-title="Understanding device selection issues"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.15.1 </span><span class="title-name">Understanding device selection issues</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-trouble-select">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A block device can only either be part of a multipath map or be used
    directly (mounted as file system, used as swap, LVM physical volume, or
    otherwise). If a device is already mounted, an attempt by multipathd to
    make it part of a multipath map will fail with a “Device or resource
    busy” error. Vice-versa, the same error results if
    <code class="command">systemd</code> attempts to mount a device that has already
    been made part of a multipath map.
   </p><p>
    Storage device activation during boot is handled by a complex interaction
    between <code class="command">systemd</code>, <code class="systemitem">udev</code>,
    <code class="command">multipathd</code> and some other tools.
    <code class="systemitem">udev</code> rules play a central role. They set device
    properties that indicate to other subsystems how a device should be used.
    The multipath-related udev rules set the following properties for devices
    that are selected for multipathing:
   </p><div class="verbatim-wrap"><pre class="screen">SYSTEMD_READY=0
DM_MULTIPATH_DEVICE_PATH=1</pre></div><p>
    Partition devices inherit these properties from their parents.
   </p><p>
    If these properties are not set correctly, if some tool does not respect
    them, or if they get set too late, a race condition between
    <code class="command">multipathd</code> and some other subsystem may result. Only one
    of the contenders can win the race; the other one will see a “Device
    or resource busy” error.
   </p><p>
    One problem in this context is that the tools of the LVM2 suite do not
    evaluate udev properties by default. They rely on their own logic for
    determining whether a device is a multipath component, which sometimes does
    not match the logic of the rest of the system. A workaround for this is
    described in <a class="xref" href="cha-multipath.html#sec-multipath-lvm" title="18.14.3. Using LVM2 on multipath devices">Section 18.14.3, “Using LVM2 on multipath devices”</a>.
   </p><div id="id-1.11.6.6.18.4.8" data-id-title="Example of boot deadlock" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Example of boot deadlock</div><p>
     Consider a system with multipathing where the root device is not
     multipathed, and no devices are excluded from multipath (see
     <a class="xref" href="cha-multipath.html#vl-multipath-planning-type-noroot-noinitrd">Multipath disabled in the initramfs</a> in
     <a class="xref" href="cha-multipath.html#sec-multipath-planning-type-noroot" title="18.3.2.2. Root file system on a local disk">Section 18.3.2.2, “Root file system on a local disk”</a>). The root file
     system is mounted in the initramfs. <code class="command">systemd</code> switches to
     the root file system and <code class="command">multipathd</code> starts up. Because
     the device is already mounted, <code class="command">multipathd</code> fails to set
     up the multipath map for it. Because the root device is not configured in
     <code class="literal">blacklist</code>, it is considered a multipath device, and
     <code class="literal">SYSTEMD_READY=0</code> is set for it.
    </p><p>
     Later in the boot process, the system attempts to mount additional file
     systems like <code class="filename">/var</code> and <code class="filename">/home</code>.
     Usually, these file systems will be on the same device as the root file
     system, by default as BTRFS subvolumes of the root file system itself. But
     systemd cannot mount them because of <code class="literal">SYSTEMD_READY=0</code>.
     <span class="emphasis"><em>We are in a deadlock</em></span>: The dm-multipath device cannot
     be created, and the underlying device is blocked for systemd. The
     additional file systems cannot be mounted, resulting in boot failure.
    </p><p>
     <span class="bold"><strong>A solution to this problem already
     exists.</strong></span> <code class="command">multipathd</code> detects this situation
     and releases the device to <code class="command">systemd</code> which can then
     proceed mounting the file system. However, it is important to understand
     the general problem, which can still occur in more subtle ways.
    </p></div></section><section class="sect2" id="sec-multipath-trouble-ref" data-id-title="Understanding device referencing issues"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.15.2 </span><span class="title-name">Understanding device referencing issues</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-trouble-ref">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    An example of a device referencing issue has been given in
    <a class="xref" href="cha-multipath.html#sec-multipath-initrd-persistent" title="18.7.4.2. Persistent device names in the initramfs">Section 18.7.4.2, “Persistent device names in the initramfs”</a>. Typically, there are
    multiple symbolic links pointing to a device node (see
    <a class="xref" href="cha-multipath.html#sec-multipath-referring" title="18.12.4. Referring to multipath maps">Section 18.12.4, “Referring to multipath maps”</a>). But these links do not always
    exist; <code class="command">udev</code> creates them according to the current udev
    rules. For example, if multipathing is off, symbolic links under
    <code class="filename">/dev/mapper/</code> for multipath devices will be missing.
    Thus, any reference to a <code class="filename">/dev/mapper/</code> device will
    fail.
   </p><p>
    Such references can appear in various places, notably in
    <code class="filename">/etc/fstab</code> and <code class="filename">/etc/crypttab</code>, in
    the initramfs, or even on the kernel command line.
   </p><p>
    The safest way to circumvent this problem is to avoid using the kind of
    device references that are not persistent between boots or depend on system
    configuration. We generally recommend referring to file systems (and
    similar entities like swap space) by properties of the file system itself
    (like UUID or label) rather than the containing device. If such references
    are not available and device references are required, for example, in
    <code class="filename">/etc/crypttab</code>, the options should be evaluated
    carefully. For example, in <a class="xref" href="cha-multipath.html#sec-multipath-referring" title="18.12.4. Referring to multipath maps">Section 18.12.4, “Referring to multipath maps”</a>, the
    best option might be the <code class="filename">/dev/disk/by-id/wwn-</code> link
    because it would also work with <code class="literal">multipath=off</code>.
   </p></section><section class="sect2" id="sec-multipath-trouble-steps" data-id-title="Troubleshooting steps in emergency mode"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.15.3 </span><span class="title-name">Troubleshooting steps in emergency mode</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-trouble-steps">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    As there are many error situations that differ in subtle ways, it is
    impossible to provide a step-by-step recovery guide. But with the
    background knowledge from the previous subsections, you should be able to
    figure out the problem if a system runs into emergency mode because of
    multipathing issues. Before you begin debugging, make sure you have checked
    the following questions:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Is the multipath service enabled?
     </p></li><li class="listitem"><p>
      Is the multipath dracut module included in the initramfs?
     </p></li><li class="listitem"><p>
      Is my root device configured as a multipath device? If not, is the root
      device properly excluded from multipath as described in
      <a class="xref" href="cha-multipath.html#sec-multipath-blacklist" title="18.11.1. The blacklist section in multipath.conf">Section 18.11.1, “The <code class="literal">blacklist</code> section in <code class="filename">multipath.conf</code>”</a>, or are you relying on the
      absence of the multipath module in the initramfs (see
      <a class="xref" href="cha-multipath.html#sec-multipath-planning-type-noroot" title="18.3.2.2. Root file system on a local disk">Section 18.3.2.2, “Root file system on a local disk”</a>)?
     </p></li><li class="listitem"><p>
      Does the system enter emergency mode before or after switching to the
      real root file system?
     </p></li></ul></div><p>
    If you are unsure with respect to the last question, here is a sample
    dracut emergency prompt as it would be printed before switching root:
   </p><div class="verbatim-wrap"><pre class="screen">Generating "/run/initramfs/rdsosreport.txt"
Entering emergency mode. Exit the shell to continue.
Type "journalctl" to view system logs.

You might want to save "/run/initramfs/rdsosreport.txt" to a USB stick or /boot
after mounting them and attach it to a bug report.

Give root password for maintenance
(or press Control-D to continue):</pre></div><p>
    The mention of <code class="filename">rdsosreport.txt</code> is a clear indication
    that the system is still running from the initramfs. If you are still
    uncertain, log in and check for the existence of the file
    <code class="filename">/etc/initrd-release</code>. This file exists only in an
    initramfs environment.
   </p><p>
    If emergency mode is entered after switching root, the emergency prompt
    looks similar, but <code class="filename">rdsosreport.txt</code> is not mentioned:
   </p><div class="verbatim-wrap"><pre class="screen">Timed out waiting for device dev-disk-by\x2duuid-c4a...cfef77d.device.
[DEPEND] Dependency failed for Local File Systems.
[DEPEND] Dependency failed for Postfix Mail Transport Agent.
Welcome to emergency shell
Give root password for maintenance
(or press Control-D to continue):</pre></div><div class="procedure" id="id-1.11.6.6.18.6.9" data-id-title="Steps for analyzing the situation in emergency mode"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 18.2: </span><span class="title-name">Steps for analyzing the situation in emergency mode </span></span><a title="Permalink" class="permalink" href="cha-multipath.html#id-1.11.6.6.18.6.9">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Try to figure out what failed by examining failed systemd units and the
      journal.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>systemctl --failed
<code class="prompt root"># </code>journalctl -b -o short-monotonic</pre></div><p>
      When looking at the journal, determine the <span class="emphasis"><em>first</em></span>
      failed unit. When you have found the first failure, examine the messages
      before and around that point in time very carefully. Are there any
      warnings or other suspicious messages?
     </p><p>
      Watch out for the root switch ("<code class="literal">Switching root.</code>") and
      for messages about SCSI devices, device mapper, multipath and LVM2. Look
      for <code class="command">systemd</code> messages about devices and file systems
      ("<code class="literal">Found device</code>…", "<code class="literal">Mounting</code>…",
      "<code class="literal">Mounted</code>…").
     </p></li><li class="step"><p>
      Examine the existing devices, both low-level devices and device mapper
      devices (note that some of the commands below may not be available in the
      initramfs):
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>cat /proc/partitions
<code class="prompt root"># </code>ls -l /sys/class/block
<code class="prompt root"># </code>ls -l /dev/disk/by-id/* /dev/mapper/*
<code class="prompt root"># </code>dmsetup ls --tree
<code class="prompt root"># </code>lsblk
<code class="prompt root"># </code>lsscsi</pre></div><p>
      From the output of the commands above, you should get an idea whether the
      low-level devices were successfully probed, and whether any multipath
      maps and multipath partitions were set up.
     </p></li><li class="step"><p>
      If the device mapper multipath setup is not as you expect, examine the
      udev properties, in particular, <code class="literal">SYSTEMD_READY</code> (see
      above)
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>udevadm info -e</pre></div></li><li class="step"><p>
      If the previous step showed unexpected udev properties, something may
      have gone wrong during udev rule processing. Check other properties, in
      particular, those used for device identification (see
      <a class="xref" href="cha-multipath.html#sec-multipath-conf-file-wwid" title="18.12.1. WWIDs and device Identification">Section 18.12.1, “WWIDs and device Identification”</a>).
      If the udev properties are correct, check the journal for
      <code class="command">multipathd</code> messages again. Look for "<code class="literal">Device
      or resource busy</code>" messages.
     </p></li><li class="step"><p>
      If the system failed to mount or otherwise activate a device, it is often
      helpful to try activating this device manually:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>mount /var
<code class="prompt root"># </code>swapon -a
<code class="prompt root"># </code>vgchange -a y</pre></div><p>
      Mostly, the manual activation will succeed and allow to proceed with
      system boot (usually by simply logging out from the emergency shell) and
      examine the situation further in the booted system.
     </p><p>
      If manual activation fails, you will probably see error messages that
      provide clues about what is going wrong. You can also try the commands
      again with increased verbosity.
     </p></li><li class="step"><p>
      At this point, you should have some idea what went wrong (if not, contact
      SUSE support and be prepared to answer most of the questions raised
      above).
     </p><p>
      You should be able to correct the situation with a few shell commands,
      exit the emergency shell, and boot successfully. You will still need to
      adjust your configuration to make sure the same problem will not occur
      again in the future.
     </p><p>
      Otherwise, you will need to boot the rescue system, set up the devices
      manually to <code class="command">chroot</code> into the real root file system, and
      attempt to fix the problem based on the insight you got in the previous
      steps. Be aware that in this situation, the storage stack for the root
      file system may differ from normal. Depending on your setup, you may have
      force addition or omission of dracut modules when building a new
      initramfs. See also <a class="xref" href="cha-multipath.html#sec-multipath-initrd-disable" title="18.7.4.1. Enabling or disabling multipathing in the initramfs">Section 18.7.4.1, “Enabling or disabling multipathing in the initramfs”</a>.
     </p></li><li class="step"><p>
      If the problem occurs frequently or even on every boot attempt, try
      booting with increased verbosity in order to get more information about
      the failure. The following kernel parameters, or a combination of them,
      are often helpful:
     </p><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">udev.log-priority=debug<span class="callout" id="mp-co-kparm-udev">1</span>
systemd.log_level=debug<span class="callout" id="mp-co-kparm-sl">2</span>
scsi_mod.scsi_logging_level=020400<span class="callout" id="mp-co-kparm-sc">3</span>
rd.debug<span class="callout" id="mp-co-kparm-rd">4</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-kparm-udev"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Increase the log level of <code class="command">systemd-udevd</code> and udev
         rule processing.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-kparm-sl"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Increase the log level of <code class="command">systemd</code>.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-kparm-sc"><span class="callout">3</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Increase the logging level of the kernel's SCSI subsystem.
        </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#mp-co-kparm-rd"><span class="callout">4</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
         Trace the scripts in the initramfs.
        </p></td></tr></table></div></div><p>
      In addition, it may make sense to enable logging for certain drivers and
      configure a serial console to capture the output during boot.
     </p></li></ol></div></div></section><section class="sect2" id="sec-multipath-trouble-tids" data-id-title="Technical information documents"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">18.15.4 </span><span class="title-name">Technical information documents</span></span> <a title="Permalink" class="permalink" href="cha-multipath.html#sec-multipath-trouble-tids">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multipath.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    For more information about troubleshooting multipath I/O issues on SUSE
    Linux Enterprise Server, see the following Technical Information Documents
    (TIDs) in the SUSE Knowledgebase:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      <a class="link" href="https://www.suse.com/support/kb/doc/?id=000016331" target="_blank"><em class="citetitle">Using
      LVM on local and SAN attached devices</em></a>
     </p></li><li class="listitem"><p>
      <a class="link" href="https://www.suse.com/support/kb/doc/?id=000017521" target="_blank"><em class="citetitle">Using
      LVM on Multipath (DM MPIO) Devices</em></a>
     </p></li><li class="listitem"><p>
      <a class="link" href="https://www.suse.com/support/kb/doc/?id=000017762" target="_blank"><em class="citetitle">HOWTO:
      Add, Resize and Remove LUN without restarting SLES</em></a>
     </p></li></ul></div></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-nvmeof.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 17 </span>NVMe-oF</span></a> </div><div><a class="pagination-link next" href="cha-nfs.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 19 </span>Sharing file systems with NFS</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-intro"><span class="title-number">18.1 </span><span class="title-name">Understanding multipath I/O</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-hardware"><span class="title-number">18.2 </span><span class="title-name">Hardware support</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-planning"><span class="title-number">18.3 </span><span class="title-name">Planning for multipathing</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-installing"><span class="title-number">18.4 </span><span class="title-name">Installing <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> on multipath systems</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-offline-update"><span class="title-number">18.5 </span><span class="title-name">Updating SLE on multipath systems</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-mpiotools"><span class="title-number">18.6 </span><span class="title-name">Multipath management tools</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-config"><span class="title-number">18.7 </span><span class="title-name">Configuring the system for multipathing</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-conf-file"><span class="title-number">18.8 </span><span class="title-name">Multipath configuration</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-policies-default"><span class="title-number">18.9 </span><span class="title-name">Configuring policies for failover, queuing, and failback</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-grouping"><span class="title-number">18.10 </span><span class="title-name">Configuring path grouping and priorities</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-select-devices"><span class="title-number">18.11 </span><span class="title-name">Selecting devices for multipathing</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-names"><span class="title-number">18.12 </span><span class="title-name">Multipath device names and WWIDs</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-conf-misc"><span class="title-number">18.13 </span><span class="title-name">Miscellaneous options</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-best-practice"><span class="title-number">18.14 </span><span class="title-name">Best practice</span></a></span></li><li><span class="sect1"><a href="cha-multipath.html#sec-multipath-trouble"><span class="title-number">18.15 </span><span class="title-name">Troubleshooting MPIO</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>