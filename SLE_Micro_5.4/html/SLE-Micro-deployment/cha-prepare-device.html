<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLE Micro 5.4 | Deployment Guide | Preparing the configuration device</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Preparing the configuration device | SLE Micro 5.4"/>
<meta name="description" content="The following procedure describes how to prepare the configuration device (usually a USB flash disk). Ensure that the configuration device is connect…"/>
<meta name="product-name" content="SUSE Linux Enterprise Micro"/>
<meta name="product-number" content="5.4"/>
<meta name="book-title" content="Deployment Guide"/>
<meta name="chapter-title" content="Chapter 7. Preparing the configuration device"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="jsindelarova@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="SUSE Linux Enterprise Micro 5.4"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Deployment Guide"/>
<meta property="og:description" content="Deployment of SLE Micro"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Deployment Guide"/>
<meta name="twitter:description" content="Deployment of SLE Micro"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Preparing the configuration device",
  
    "description": "Preparing the configuration device",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2023-04-03T00:00+02:00",
      
    "datePublished": "2024-05-30T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-deployment-overview.html" title="Chapter 6. Overview of the deployment process"/><link rel="next" href="cha-images-procedure.html" title="Chapter 8. Deploying the raw image"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Deployment Guide</a><span> / </span><a class="crumb" href="part-raw-image.html">Pre-built image deployment</a><span> / </span><a class="crumb" href="cha-prepare-device.html">Preparing the configuration device</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Deployment Guide</div><ol><li><a href="preface-deployment.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="part-prep.html" class="has-children "><span class="title-number">I </span><span class="title-name">Installation preparation</span></a><ol><li><a href="cha-planning.html" class=" "><span class="title-number">1 </span><span class="title-name">Planning for <span class="productname"><span class="phrase">SUSE Linux Enterprise Micro</span></span></span></a></li><li><a href="cha-x86.html" class=" "><span class="title-number">2 </span><span class="title-name">Installation on AMD64 and Intel 64</span></a></li><li><a href="cha-aarch64.html" class=" "><span class="title-number">3 </span><span class="title-name">Installation on AArch64</span></a></li><li><a href="cha-zseries.html" class=" "><span class="title-number">4 </span><span class="title-name">Installation on IBM Z and LinuxONE</span></a></li></ol></li><li class="active"><a href="part-raw-image.html" class="has-children you-are-here"><span class="title-number">II </span><span class="title-name">Pre-built image deployment</span></a><ol><li><a href="cha-images-description.html" class=" "><span class="title-number">5 </span><span class="title-name">Description of pre-built images</span></a></li><li><a href="cha-deployment-overview.html" class=" "><span class="title-number">6 </span><span class="title-name">Overview of the deployment process</span></a></li><li><a href="cha-prepare-device.html" class=" you-are-here"><span class="title-number">7 </span><span class="title-name">Preparing the configuration device</span></a></li><li><a href="cha-images-procedure.html" class=" "><span class="title-number">8 </span><span class="title-name">Deploying the raw image</span></a></li><li><a href="cha-selfinstal-procedure.html" class=" "><span class="title-number">9 </span><span class="title-name">Deploying selfinstall images</span></a></li><li><a href="cha-postintall-registration.html" class=" "><span class="title-number">10 </span><span class="title-name">Post-deployment steps</span></a></li></ol></li><li><a href="part-manual-installation.html" class="has-children "><span class="title-number">III </span><span class="title-name">Manual installation</span></a><ol><li><a href="cha-boot-parameters.html" class=" "><span class="title-number">11 </span><span class="title-name">Boot parameters</span></a></li><li><a href="cha-install.html" class=" "><span class="title-number">12 </span><span class="title-name">Installation steps</span></a></li><li><a href="cha-remote-installation.html" class=" "><span class="title-number">13 </span><span class="title-name">Remote installation</span></a></li><li><a href="cha-installation-troubleshooting.html" class=" "><span class="title-number">14 </span><span class="title-name">Troubleshooting</span></a></li></ol></li><li><a href="bk02apa.html" class=" "><span class="title-number">A </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-prepare-device" data-id-title="Preparing the configuration device"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Micro</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">5.4</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">7 </span><span class="title-name">Preparing the configuration device</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following procedure describes how to prepare the configuration device
  (usually a USB flash disk). Ensure that the configuration device is
  connected to your host running SLE Micro during its first boot.
 </p><div class="procedure" id="pro-preparing-configuration-device" data-id-title="Preparing the configuration device"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 7.1: </span><span class="title-name">Preparing the configuration device </span></span><a title="Permalink" class="permalink" href="cha-prepare-device.html#pro-preparing-configuration-device">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
    Format the disk to any file system supported by SLE Micro: Ext3, Ext4, etc.:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>sudo mkfs.ext4 /dev/sd<em class="replaceable">Y</em></pre></div></li><li class="step"><p>
    Set the device label to either <code class="literal">ignition</code> (when either
    Ignition or Combustion is used) or <code class="literal">combustion</code> (when only
    Combustion is used). If needed, you can use uppercase letters for the labels, too. To label the device, run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>sudo e2label /dev/sd<em class="replaceable">Y</em> ignition</pre></div><p>
    You can use any type of configuration storage media that your
    virtualization system or your hardware supports: ISO image, a USB
    flash disk, etc.
   </p></li><li class="step"><p>
    Mount the device:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>sudo mount /dev/sdY /mnt</pre></div></li><li class="step"><p>
    Create the directory structure as mentioned in
    <a class="xref" href="cha-prepare-device.html#sec-about-ignition" title="7.2. Configuring SLE Micro using Ignition">Section 7.2, “Configuring <span class="productname"><span class="phrase">SLE Micro</span></span> using Ignition”</a> or
    <a class="xref" href="cha-prepare-device.html#sec-about-combustion" title="7.3. Configuring SLE Micro using Combustion">Section 7.3, “Configuring <span class="productname"><span class="phrase">SLE Micro</span></span> using Combustion”</a>, depending on the configuration
    tool used:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>sudo mkdir -p /mnt/ignition/</pre></div><p>
    or:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>sudo mkdir -p /mnt/combustion/</pre></div></li><li class="step"><p>
    Prior to booting for the first time, prepare all elements of the
    configuration that will be used by
    <a class="xref" href="cha-prepare-device.html#sec-ignition-configuration" title="7.2.1. config.ign">Ignition</a> or
    <a class="xref" href="cha-prepare-device.html#sec-about-combustion" title="7.3. Configuring SLE Micro using Combustion">Combustion</a>. To
    log in to your system, you need to provide a password for <code class="systemitem">root</code> or set
    up passwordless authentication, otherwise the system will not be accessible
    after the first boot.
   </p></li></ol></div></div><section class="sect1" id="sec-default-partitioning" data-id-title="Default partitioning"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.1 </span><span class="title-name">Default partitioning</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-default-partitioning">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The pre-built images are delivered with a default partitioning scheme, which
   can be changed during the first boot by using Ignition or Combustion. For a
   procedure to repartition the system, refer to
   <a class="xref" href="cha-prepare-device.html#sec-ignition-configuration" title="7.2.1. config.ign">Section 7.2.1, “<code class="filename">config.ign</code>”</a> or
   <a class="xref" href="cha-prepare-device.html#sec-combustion-script" title="7.3.1. The script configuration file">Section 7.3.1, “The <code class="filename">script</code> configuration file”</a>.
  </p><div id="id-1.4.4.4.5.3" data-id-title="Btrfs is mandatory for the root file system" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Btrfs is mandatory for the root file system</div><p>
    If you intend to perform any changes to the default partitioning scheme,
    the root file system must be Btrfs.
   </p></div><p>
   Each image has the following subvolumes:
  </p><div class="verbatim-wrap"><pre class="screen"> /home
 /root
 /opt
 /srv 
 /usr/local
 /var</pre></div><p>
   The images also have mounted subvolumes for booting by default. The specific
   subvolumes differ according to the architecture.
  </p><p>
   The <code class="literal">/etc</code> directory is mounted as OverlayFS, where the
   upper directory is mounted to <code class="filename">/var/lib/overlay/1/etc/</code>. For details, refer to <span class="intraxref">Book “Administration Guide”, Chapter 1 “Read-only file system”, Section 1.1 “<code class="filename">/etc</code> on a read-only file system”</span>.
  </p><p>
   You can recognize the subvolumes mounted by default by the option
   <code class="literal">x-initrd.mount</code> in <code class="filename">/etc/fstab</code>. Other
   subvolumes or partitions must be configured either by Ignition or
   Combustion.
  </p></section><section class="sect1" id="sec-about-ignition" data-id-title="Configuring SLE Micro using Ignition"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.2 </span><span class="title-name">Configuring <span class="productname"><span class="phrase">SLE Micro</span></span> using Ignition</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-about-ignition">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Ignition is a provisioning tool that enables you to configure a system
    according to your specification on the first boot. When the system is
    booted for the first time, Ignition is loaded as part of an
    <code class="filename">initramfs</code> and searches for a configuration file
    within a specific directory (on a USB flash drive, or you can provide a
    URL). All changes are performed before the kernel switches from the
    temporal file system to the real root file system (before the
    <code class="literal">switch_root</code> command is issued).
  </p><p>
    Ignition uses a configuration file in the JSON format. The file is called
    <code class="filename">config.ign</code>.
  </p><section class="sect2" id="sec-ignition-configuration" data-id-title="config.ign"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.2.1 </span><span class="title-name"><code class="filename">config.ign</code></span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-ignition-configuration">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="filename">config.ign</code> is a JSON configuration file that
    provides prescriptions for Ignition. You can either create the file
    manually in JSON, or you can use the Fuel Ignition tool
    (<a class="link" href="https://opensuse.github.io/fuel-ignition/" target="_blank">https://opensuse.github.io/fuel-ignition/</a>) to
    generate a basic set of prescriptions. Bear in mind that the Fuel
    Ignition tool does not provide a full set of options, so you might have
    to modify the file manually.
  </p><p>
    When installing on bare metal, the configuration file
    <code class="filename">config.ign</code> must reside in the
    <code class="filename">ignition</code> subdirectory on the configuration media
    labeled <code class="literal">ignition</code>. The directory structure must look as
    follows:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;root directory&gt;
└── ignition
  └── config.ign</pre></div><p>
    If you intend to configure a QEMU/KVM virtual machine, provide the path
    to <code class="filename">config.ign</code> as an attribute of the
    <code class="command">qemu</code> command. For example:
  </p><div class="verbatim-wrap"><pre class="screen">-fw_cfg name=opt/com.coreos/config,file=<em class="replaceable">PATH_TO_config.ign</em></pre></div><p>
  When configuring a virtual machine with Virtual Machine Manager (<code class="systemitem">libvirt</code>),
  provide the path to the <code class="filename">config.ign</code> file in its XML
  definition, for example:
</p><div class="verbatim-wrap"><pre class="screen">&lt;domain ... &gt;
&lt;sysinfo type="fwcfg"&gt;
&lt;entry name="opt/com.coreos/config" file="/location/to/config.ign"/&gt;
&lt;/sysinfo&gt;
&lt;/domain&gt;</pre></div><p>
  Alternatively, when using <code class="systemitem">libvirt</code>, you can provide the path as an option to the <code class="command">virt-install</code> command:
</p><div class="verbatim-wrap"><pre class="screen">--sysinfo type=fwcfg,entry0.name="opt/com.coreos/config",entry0.file="<em class="replaceable">PATH_TO_config.ign</em>&gt;"</pre></div><p>
    The <code class="filename">config.ign</code> file contains various data types: objects,
    strings, integers, Booleans and lists of objects. For a complete
    specification, refer to
    <a class="link" href="https://coreos.github.io/ignition/configuration-v3_3/" target="_blank">Ignition
    specification v3.3.0</a>.
  </p><p>
    The <code class="literal">version</code> attribute is mandatory, and with
    SLE Micro, its value must be set either to <code class="literal">3.3.0</code> or to
    any lower version. Otherwise Ignition will fail.
  </p><p>
    To log in to your system as root, you must at least include a
    password for <code class="systemitem">root</code>. However, it is recommended to establish access
    via SSH keys. If you want to configure a password, make sure to use a
    secure one. If you use a randomly generated password, use at least 10
    characters. If you create your password manually, use even more than 10
    characters and combine uppercase and lowercase letters and numbers.
  </p><section class="sect3" id="sec-ignition-examples" data-id-title="Configuration examples"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">7.2.1.1 </span><span class="title-name">Configuration examples</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-ignition-examples">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      This section will provide you with some common examples of the Ignition
      configuration in the JSON format. 
    </p><div id="id-1.4.4.4.6.4.14.3" data-id-title="Declaring content outside the default subvolumes" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Declaring content outside the default subvolumes</div><p>
        Bear in mind that if you want to create files outside the
        <a class="xref" href="cha-prepare-device.html#sec-default-partitioning" title="7.1. Default partitioning">default mounted directories</a>,
        you need to define the directories using the
        <code class="literal">filesystem</code> attribute.
      </p></div><div id="id-1.4.4.4.6.4.14.4" data-id-title="The version attribute is mandatory" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: The <code class="literal">version</code> attribute is mandatory</div><p>
        Include the version specification in <code class="filename">config.ign</code>
        (version 3.3.0 or lower).
      </p></div><section class="sect4" id="sec-ignition-storage" data-id-title="Storage configuration"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">7.2.1.1.1 </span><span class="title-name">Storage configuration</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-ignition-storage">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The <code class="literal">storage</code> attribute is used to configure
        partitions and RAID, define file systems, create files, etc. To define
        partitions, use the <code class="literal">disks</code> attribute. The
        <code class="literal">filesystem</code> attribute is used to format partitions. The
        <code class="literal">files</code> attribute can be used to create files in the
        file system. Each of the mentioned attributes is described in the
        following sections.
      </p><section class="sect5" id="sec-storage-disks" data-id-title="The disks attribute"><div class="titlepage"><div><div><div class="title-container"><h6 class="title"><span class="title-number-name"><span class="title-number">7.2.1.1.1.1 </span><span class="title-name">The <code class="literal">disks</code> attribute</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-storage-disks">#</a></h6><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          The <code class="literal">disks</code> attribute is a list of devices that
          enables you to define partitions on these devices. The
          <code class="literal">disks</code> attribute must contain at least one
          <code class="literal">device</code>. Other attributes are optional. The
          following example will use a single virtual device and divide the
          disk into four partitions:
        </p><div class="verbatim-wrap"><pre class="screen">  {
  "variant": "fcos",
  "version": "3.3.0",
  "storage": {
      "disks": [
          {
              "device": "/dev/vda",
              "wipe_table": true,
              "partitions": [
                  {
                      "label": "root",
                      "number": 1,
                      "type_guid": "4F68BCE3-E8CD-4DB1-96E7-FBCAF984B709"
                  },
                  {
                      "label": "boot",
                      "number": 2,
                      "type_guid": "BC13C2FF-59E6-4262-A352-B275FD6F7172"
                  },
                  {
                      "label": "swap",
                      "number": 3,
                      "type_guid": "0657FD6D-A4AB-43C4-84E5-0933C84B4F4F"
                  },
                  {
                      "label": "home",
                      "number": 4,
                      "type_guid": "933AC7E1-2EB4-4F13-B844-0E14E2AEF915"
                  }
              ]
          }
      ]
  }
}</pre></div></section><section class="sect5" id="sec-storage-raid" data-id-title="The raid attribute"><div class="titlepage"><div><div><div class="title-container"><h6 class="title"><span class="title-number-name"><span class="title-number">7.2.1.1.1.2 </span><span class="title-name">The <code class="literal">raid</code> attribute</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-storage-raid">#</a></h6><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          The <code class="literal">raid</code> is a list of RAID arrays. The following
          attributes of <code class="literal">raid</code> are mandatory:
        </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.4.4.4.6.4.14.5.4.3.1"><span class="term">level</span></dt><dd><p>
                a level of the particular RAID array (linear, raid0, raid1,
                raid2, raid3, raid4, raid5, raid6)
              </p></dd><dt id="id-1.4.4.4.6.4.14.5.4.3.2"><span class="term">devices</span></dt><dd><p>
                a list of devices in the array referenced by their absolute
                paths
              </p></dd><dt id="id-1.4.4.4.6.4.14.5.4.3.3"><span class="term">name</span></dt><dd><p>
                a name that will be used for the md device
              </p></dd></dl></div><div class="verbatim-wrap"><pre class="screen">    {
  "variant": "fcos",
  "version": "3.3.0",
  "storage": {
      "raid": [
          {
              "name": "system",
              "level": "raid1",
              "devices": [
                  "/dev/sda",
                  "/dev/sdb"
              ]
          }
      ]
  }
}</pre></div></section><section class="sect5" id="sec-storage-filesystem" data-id-title="The filesystem attribute"><div class="titlepage"><div><div><div class="title-container"><h6 class="title"><span class="title-number-name"><span class="title-number">7.2.1.1.1.3 </span><span class="title-name">The <code class="literal">filesystem</code> attribute</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-storage-filesystem">#</a></h6><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.4.4.4.6.4.14.5.5.2" data-id-title="Ignition does not perform modifications to mount units" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Ignition does not perform modifications to mount units</div><p>
            The <code class="literal">file system</code> attribute does not modify mount units. If you add a new partition or remove an
            existing partition, you must manually adjust the mount units. 
          </p></div><p>
          <code class="literal">filesystem</code> must contain the following
          attributes:
        </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.4.4.4.6.4.14.5.5.4.1"><span class="term">device</span></dt><dd><p>
                the absolute path to the device, typically
                <code class="literal">/dev/sda</code> in case of physical disk
              </p></dd><dt id="id-1.4.4.4.6.4.14.5.5.4.2"><span class="term">format</span></dt><dd><p>
                the file system format (btrfs, ext4, xfs, vfat or swap)
              </p><div id="id-1.4.4.4.6.4.14.5.5.4.2.2.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
                  In the case of SLE Micro, the <code class="literal">root</code> file
                  system must be formatted to Btrfs.
                </p></div></dd></dl></div><p>
          The following example demonstrates using the
          <code class="literal">filesystem</code> attribute. The
          <code class="filename">/opt</code> directory will be mounted to the
          <code class="literal">/dev/sda1</code> partition, which is formatted to
          Btrfs. The partition table will not be erased.
        </p><div class="verbatim-wrap"><pre class="screen">{
  "variant": "fcos",
  "version": "3.3.0",
  "storage": {
      "filesystems": [
          {
              "path": "/opt",
              "device": "/dev/sda1",
              "format": "btrfs",
              "wipe_filesystem": false
          }
      ]
  }
}</pre></div></section><section class="sect5" id="sec-storage-files" data-id-title="The files attribute"><div class="titlepage"><div><div><div class="title-container"><h6 class="title"><span class="title-number-name"><span class="title-number">7.2.1.1.1.4 </span><span class="title-name">The <code class="literal">files</code> attribute</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-storage-files">#</a></h6><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          You can use the <code class="literal">files</code> attribute to create any
          files on your machine. Bear in mind that if you want to create
          files outside the
          <a class="xref" href="cha-prepare-device.html#sec-default-partitioning" title="7.1. Default partitioning">default mounted directories</a>,
          you need to define the directories by using the
          <code class="literal">filesystem</code> attribute.
        </p><p>
          In the following example, a host name is created by using the
          <code class="literal">files</code> attribute. The file
          <code class="filename">/etc/hostname</code> will be created with the
          <span class="emphasis"><em>slemicro-1</em></span> host name.
        </p><div id="id-1.4.4.4.6.4.14.5.6.4" data-id-title="Decimal numeral systems in JSON" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Decimal numeral systems in JSON </div><p>
            Bear in mind that JSON uses the decimal numeral system, so the
            <code class="literal">mode</code> value is a decimal notation of the access
            rights. 
          </p></div><div class="verbatim-wrap"><pre class="screen">{
  "variant": "fcos",
  "version": "3.3.0",
  "storage": {
      "files": [
          {
              "path": "/etc/hostname",
              "mode": 420,
              "overwrite": true,
              "contents": {
                  "inline": "slemicro-1"
              }
          }
      ]
  }
}</pre></div></section><section class="sect5" id="sec-storage-directories" data-id-title="The directories attribute"><div class="titlepage"><div><div><div class="title-container"><h6 class="title"><span class="title-number-name"><span class="title-number">7.2.1.1.1.5 </span><span class="title-name">The <code class="literal">directories</code> attribute</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-storage-directories">#</a></h6><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          The <code class="literal">directories</code> attribute is a list of
          directories that will be created in the file system. The
          <code class="literal">directories</code> attribute must contain at least one
          <code class="literal">path</code> attribute.
        </p><div class="verbatim-wrap"><pre class="screen">{
  "variant": "fcos",
  "version": "3.3.0",
  "storage": {
      "directories": [
          {
              "path": "/mnt/backup",
              "user": {
                  "name": "tux"
              }
          }
      ]
  }
}</pre></div></section></section><section class="sect4" id="sec-ignition-users" data-id-title="Users administration"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">7.2.1.1.2 </span><span class="title-name">Users administration</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-ignition-users">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        The <code class="literal">passwd</code> attribute is used to add users. If you
        intend to log in to your system, create <code class="systemitem">root</code> and set the
        <code class="systemitem">root</code>'s password and/or add the SSH key to the Ignition
        configuration. You need to hash the <code class="systemitem">root</code> password, for example,
        by using the <code class="command">openssl</code> command:
      </p><div class="verbatim-wrap"><pre class="screen">openssl passwd -6</pre></div><p>
        The command creates a hash of the password you chose. Use this hash
        as the value of the <code class="literal">password_hash</code> attribute.
      </p><p>
        The <code class="literal">users</code> attribute must contain at least one
        <code class="literal">name</code> attribute.
        <code class="literal">ssh_authorized_keys</code> is a list of SSH keys for the
        user.
      </p><div id="id-1.4.4.4.6.4.14.6.6" data-id-title="Creating other users than root" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Creating other users than <code class="systemitem">root</code></div><p>
          When you are creating other users than <code class="systemitem">root</code>, you need to
          define <code class="filename">/home</code> directories for the users,
          because these directories (usually
          <code class="filename">/home/<em class="replaceable">USER_NAME</em></code>)
          are not mounted by default. Therefore, declare these directories
          using the <code class="literal">storage</code>/<code class="literal">filesystem</code>
          attribute. For example, for tux, the example
          looks as follows:
        </p><div class="verbatim-wrap"><pre class="screen">      {
"ignition": {
  "version": "3.2.0"
},
"passwd": {
  "users": [
    {
      "name": "tux",
      "passwordHash": "$2a$10$US9XSqLOqMmGq/OnhlVjPOwuZREh2.iEtlwD5LI7DKgV24NJU.wO6"
    }
  ]
},
"storage": {
  "filesystems": [
    {
      "device": "/dev/disk/by-label/ROOT",
      "format": "btrfs",
      "mountOptions": [
        "subvol=/@/home"
      ],
      "path": "/home",
      "wipeFilesystem": false
    }
  ]
}
}</pre></div></div></section><section class="sect4" id="sec-ignition-systemd" data-id-title="Enabling systemd services"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">7.2.1.1.3 </span><span class="title-name">Enabling <code class="literal">systemd</code> services</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-ignition-systemd">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        You can enable <code class="systemitem">systemd</code> services by specifying them in the
        <code class="literal">systemd</code> attribute. The <code class="literal">name</code>
        must be the exact name of a service to be enabled (including the
        suffix).
      </p><div class="verbatim-wrap"><pre class="screen">{
"ignition": {
  "version": "3.0.0"
},
"systemd": {
  "units": [
    {
      "enabled": true,
      "name": "sshd.service"
    }
  ]
}
}</pre></div></section></section></section></section><section class="sect1" id="sec-about-combustion" data-id-title="Configuring SLE Micro using Combustion"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.3 </span><span class="title-name">Configuring <span class="productname"><span class="phrase">SLE Micro</span></span> using Combustion</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-about-combustion">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Combustion is a dracut module that enables you to configure your system on
   its first boot. Combustion reads a provided file called
   <code class="filename">script</code> and executes commands in it and thus performs
   changes to the file system. You can use Combustion to change the default
   partitions, set users' passwords, create files, install packages, etc.
  </p><p>
   The Combustion dracut module is invoked after the
   <code class="literal">ignition.firstboot</code> argument is passed to the kernel
   command line. Combustion then reads the configuration from
   <code class="filename">script</code>. Combustion tries to configure the network if the
   network flag has been found in <code class="filename">script</code>. After
   <code class="literal">/sysroot</code> is mounted, Combustion tries to activate all
   mount points in <code class="filename">/etc/fstab</code> and then call
   <code class="command">transactional-update</code> to apply other changes (like setting
   <code class="systemitem">root</code> password or installing packages).
  </p><p>
   When using Combustion, you need to label the configuration device with the
   name <code class="literal">combustion</code>, create a specific directory structure in
   that configuration medium, and include a configuration file named
   <code class="filename">script</code>. In the root directory of the configuration
   medium, create a directory called <code class="filename">combustion</code> and place
   the <code class="filename">script</code> into this directory along with other
   files—SSH key, configuration files, etc. The directory structure then
   should look as follows:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;root directory&gt;
└── combustion
    └── script
    └── other files</pre></div><p>
   You can use Combustion to configure your QEMU/KVM virtual machine. In this
   case, pass the location of the <code class="filename">script</code> file using the
   <code class="literal">fw_cfg</code> parameter of the <code class="command">qemu</code> command:
  </p><div class="verbatim-wrap"><pre class="screen">-fw_cfg name=opt/org.opensuse.combustion/script,file=/var/combustion-script</pre></div><p>
    When configuring a virtual machine with Virtual Machine Manager (<code class="systemitem">libvirt</code>),
    provide the path to the <code class="filename">script</code> file in its XML
    definition, for example:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;domain ... &gt;
&lt;sysinfo type="fwcfg"&gt;
&lt;entry name="opt/org.opensuse.combustion/script" file="/location/of/script"/&gt;
&lt;/sysinfo&gt;
&lt;/domain&gt;</pre></div><p>
Alternatively, when using <code class="systemitem">libvirt</code>, you can provide the path as an option to the <code class="command">virt-install</code> command:
</p><div class="verbatim-wrap"><pre class="screen">--sysinfo type=fwcfg,entry0.name="opt/org.opensuse.combustion/script",entry0.file="<em class="replaceable">PATH_TO_script</em>&gt;"</pre></div><p>
   Combustion can be used along with Ignition. If you intend to do so, label
   your configuration medium <code class="literal">ignition</code> and include the
   <code class="filename">ignition</code> directory with the
   <code class="filename">config.ign</code> to your directory structure, as shown below:
  </p><div class="verbatim-wrap"><pre class="screen">&lt;root directory&gt;
└── combustion
    └── script
    └── other files
└── ignition 
    └── config.ign</pre></div><p>
   In this scenario, Ignition runs before Combustion.
  </p><section class="sect2" id="sec-combustion-script" data-id-title="The script configuration file"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">7.3.1 </span><span class="title-name">The <code class="filename">script</code> configuration file</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-combustion-script">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="filename">script</code> configuration file is a set of commands that
   are executed on your system in a transactional-update shell. This section
   provides examples for performing various configuration tasks by using
   Combustion.
  </p><div id="id-1.4.4.4.7.15.3" data-id-title="Include interpreter declaration" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Include interpreter declaration</div><p>
    As the <code class="filename">script</code> file is interpreted by shell, 
    start the file with the interpreter declaration on the first line. 
    For example, for Bash:
   </p><div class="verbatim-wrap"><pre class="screen"> #!/bin/bash</pre></div></div><p>
   To log in to your system, include at least the <code class="systemitem">root</code>
   password. However, it is recommended to establish the authentication using SSH
   keys. If you need to use a <code class="systemitem">root</code> password, make sure to configure a
   secure password. If you use a randomly generated password, use at least
   10 characters. If you create your password manually, use even more than 10
   characters and combine uppercase and lowercase letters, and numbers.
  </p><section class="sect3" id="sec-script-network" data-id-title="Network configuration"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">7.3.1.1 </span><span class="title-name">Network configuration</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-script-network">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To configure and use the network connection during the first boot, add the
    following statement to your <code class="filename">script</code>:
   </p><div class="verbatim-wrap"><pre class="screen"> # combustion: network</pre></div><p>
    Using this statement will pass the <code class="literal">rd.neednet=1</code> argument
    to dracut. If you do not use the statement, the system will be configured
    without any network connection.
   </p></section><section class="sect3" id="combustion-prepare-statement" data-id-title="Performing modifications in the initramfs"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">7.3.1.2 </span><span class="title-name">Performing modifications in the initramfs</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#combustion-prepare-statement">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You may need to perform changes to the initramfs environment, for
     example, to write a custom network configuration for NetworkManager into
     <code class="filename">/etc/NetworkManager/system-connections/</code>. To do so,
     use the <code class="literal">prepare</code> statement.
   </p><p>
     For example, to create a connection with a static IP address and
     configure DNS:
   </p><div class="verbatim-wrap"><pre class="screen">#!/bin/bash
# combustion: network prepare
set -euxo pipefail

nm_config() {
umask 077 # Required for NM config
mkdir -p /etc/NetworkManager/system-connections/
cat &gt;/etc/NetworkManager/system-connections/static.nmconnection &lt;&lt;-EOF
[connection]
id=static
type=ethernet
autoconnect=true

[ipv4]
method=manual
dns=192.168.100.1
address1=192.168.100.42/24,192.168.100.1
EOF
}

if [ "${1-}" = "--prepare" ]; then
nm_config # Configure NM in the initrd
exit 0
fi

# Redirect output to the console
exec &gt; &gt;(exec tee -a /dev/tty0) 2&gt;&amp;1

nm_config # Configure NM in the system
curl example.com

# Close outputs and wait for tee to finish
exec 1&gt;&amp;- 2&gt;&amp;-; wait;

# Leave a marker
echo "Configured with combustion" &gt; /etc/issue.d/combustion</pre></div></section><section class="sect3" id="combustion-script-wait" data-id-title="Waiting for the task to complete"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">7.3.1.3 </span><span class="title-name">Waiting for the task to complete</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#combustion-script-wait">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Some processes may be run in background, for example, the <code class="command">tee</code> process
    that redirects output to the terminal. To ensure that all running processes are completed before the
    <code class="filename">script</code>
    execution finishes, add the following line:
  </p><div class="verbatim-wrap"><pre class="screen">exec 1&gt;&amp;- 2&gt;&amp;-; wait;</pre></div></section><section class="sect3" id="sec-script-partitioning" data-id-title="Partitioning"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">7.3.1.4 </span><span class="title-name">Partitioning</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-script-partitioning">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    SLE Micro raw images are delivered with a default partitioning scheme as
    described in <a class="xref" href="cha-prepare-device.html#sec-default-partitioning" title="7.1. Default partitioning">Section 7.1, “Default partitioning”</a>. You might want to
    use a different partitioning. The following set of example snippets moves the
    <code class="filename">/home</code> to a different partition.
   </p><div id="id-1.4.4.4.7.15.8.3" data-id-title="Performing changes outside of directories included in snapshots" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Performing changes outside of directories included in snapshots</div><p>
     The following script performs changes that are not included in snapshots.
     If the script fails and the snapshot is discarded, some changes remain
     visible and cannot be reverted (like the changes to the
     <code class="literal">/dev/vdb</code> device.)
    </p></div><p>
    The following snippet creates a GPT with a single partition on the
    <code class="literal">/dev/vdb</code> device:
   </p><div class="verbatim-wrap"><pre class="screen">sfdisk /dev/vdb &lt;&lt;EOF
label: gpt
type=linux
EOF 

partition=/dev/vdb1</pre></div><p>
    As the <code class="command">sfdisk</code> command may take longer time to complete, postpone
    <code class="command">label</code> by using the
    <code class="command">sleep</code> command after <code class="command">sfdisk</code>.
  </p><p>
    The partition is formatted to Btrfs:
   </p><div class="verbatim-wrap"><pre class="screen">wipefs --all ${partition}
mkfs.btrfs ${partition}</pre></div><p>
    Possible content of <code class="filename">/home</code> is moved to the new
    <code class="filename">/home</code> folder location by the following snippet:
   </p><div class="verbatim-wrap"><pre class="screen">mount /home
mount ${partition} /mnt 
rsync -aAXP /home/ /mnt/
umount /home /mnt</pre></div><p>
    The snippet below removes an old entry in <code class="filename">/etc/fstab</code>
    and creates a new entry:
   </p><div class="verbatim-wrap"><pre class="screen">awk -i inplace '$2 != "/home"' /etc/fstab
echo "$(blkid -o export ${partition} | grep ^UUID=) /home btrfs defaults 0 0" &gt;&gt;/etc/fstab</pre></div></section><section class="sect3" id="sec-cript-security" data-id-title="Setting a password for root"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">7.3.1.5 </span><span class="title-name">Setting a password for <code class="systemitem">root</code></span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-cript-security">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Before you set the <code class="systemitem">root</code> password, generate a hash of the password,
    for example, by using the <code class="command">openssl passwd -6</code>. To set the
    password, add the following to your <code class="filename">script</code>:
   </p><div class="verbatim-wrap"><pre class="screen"> echo 'root:$5$.wn2BZHlEJ5R3B1C$TAHEchlU.h2tvfOpOki54NaHpGYKwdNhjaBuSpDotD7' | chpasswd -e</pre></div></section><section class="sect3" id="sec-script-sshkeys" data-id-title="Adding SSH keys"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">7.3.1.6 </span><span class="title-name">Adding SSH keys</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-script-sshkeys">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following snippet creates a directory to store the <code class="systemitem">root</code>'s SSH key
    and then copies the public SSH key located on the configuration device to
    the <code class="filename">authorized_keys</code> file.
   </p><div class="verbatim-wrap"><pre class="screen"> mkdir -pm700 /root/.ssh/
cat id_rsa_new.pub &gt;&gt; /root/.ssh/authorized_keys</pre></div><div id="id-1.4.4.4.7.15.10.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     The SSH service must be enabled in case you need to use remote login via
     SSH. For details, refer to <a class="xref" href="cha-prepare-device.html#sec-script-services" title="7.3.1.7. Enabling services">Section 7.3.1.7, “Enabling services”</a>.
    </p></div></section><section class="sect3" id="sec-script-services" data-id-title="Enabling services"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">7.3.1.7 </span><span class="title-name">Enabling services</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-script-services">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You may need to enable some services, for example, the SSH service. To
    enable the SSH service, add the following line to
    <code class="filename">script</code>:
   </p><div class="verbatim-wrap"><pre class="screen"> systemctl enable sshd.service</pre></div></section><section class="sect3" id="sec-script-install" data-id-title="Installing packages"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">7.3.1.8 </span><span class="title-name">Installing packages</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-script-install">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.4.4.4.7.15.12.2" data-id-title="Network connection and registering your system might be necessary" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Network connection and registering your system might be necessary</div><p>
     As some packages may require additional subscription, you might need to
     register your system beforehand. An available network connection may also be
     needed to install additional packages.
    </p></div><p>
    During the first boot configuration, you can install additional packages to
    your system. For example, you can install the <code class="literal">vim</code> editor
    by adding:
   </p><div class="verbatim-wrap"><pre class="screen">zypper --non-interactive install vim-small</pre></div><div id="id-1.4.4.4.7.15.12.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     Bear in mind that you cannot use <code class="command">zypper</code>
     after the configuration is complete and you boot to the configured system.
     To perform changes later, you must use the
     <code class="command">transactional-update</code> command to create a changed
     snapshot. For details, refer to <span class="intraxref">Book “Administration Guide”, Chapter 3 “Administration using transactional updates”</span>.
    </p></div></section></section></section><section class="sect1" id="sec-raw-preparation" data-id-title="Preparing the raw image"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.4 </span><span class="title-name">Preparing the raw image</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-raw-preparation">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To prepare the raw image, proceed as follows:
   </p><div class="procedure" id="proc-prepare-image" data-id-title="Preparing the raw disk image"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 7.2: </span><span class="title-name">Preparing the raw disk image </span></span><a title="Permalink" class="permalink" href="cha-prepare-device.html#proc-prepare-image">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Download the raw image and decompress it:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>xz -d <em class="replaceable">DOWNLOADED_IMAGE.raw.xz</em></pre></div></li><li class="step"><p>
      Copy the decompressed image to the device where SLE Micro will run:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>dd if=<em class="replaceable">DOWNLOADED_IMAGE.raw</em> of=/dev/sd<em class="replaceable">X</em></pre></div></li></ol></div></div></section><section class="sect1" id="sec-jeos-firstboot" data-id-title="Minimal initial configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">7.5 </span><span class="title-name">Minimal initial configuration</span></span> <a title="Permalink" class="permalink" href="cha-prepare-device.html#sec-jeos-firstboot">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      If you do not attach any configuration device when booting the raw image for the first time, <span class="emphasis"><em>jeos-firstboot</em></span> enables you to perform minimal configuration of your system as follows:
    </p><div class="procedure" id="id-1.4.4.4.9.3" data-id-title="Configuring the system using jeos-firstboot"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 7.3: </span><span class="title-name">Configuring the system using <span class="emphasis"><em>jeos-firstboot</em></span> </span></span><a title="Permalink" class="permalink" href="cha-prepare-device.html#id-1.4.4.4.9.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/deployment_prepare_config_device.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
          Confirm the configuration.
        </p><div class="informalfigure"><div class="mediaobject"><a href="images/slemicro_jeos_start.png"><img src="images/slemicro_jeos_start.png" width="100%" alt="jeos first boot" title="jeos first boot"/></a></div></div></li><li class="step"><p>
          Select your keyboard layout and confirm your selection.
        </p><div class="informalfigure"><div class="mediaobject"><a href="images/slemicro_jeos_keyboard.png"><img src="images/slemicro_jeos_keyboard.png" width="100%" alt="jeos keyboard selection" title="jeos keyboard selection"/></a></div></div></li><li class="step"><p>
          Read the license agreement and accept it.
        </p><div class="informalfigure"><div class="mediaobject"><a href="images/slemicro_jeos_eula.png"><img src="images/slemicro_jeos_eula.png" width="100%" alt="jeos EULA" title="jeos EULA"/></a></div></div></li><li class="step"><p>
          Select your time zone.
        </p><div class="informalfigure"><div class="mediaobject"><a href="images/slemicro_jeos_timezone.png"><img src="images/slemicro_jeos_timezone.png" width="100%" alt="jeos time zone selection" title="jeos time zone selection"/></a></div></div></li><li class="step"><p>
          Enter a password for <code class="systemitem">root</code>.
        </p><div class="informalfigure"><div class="mediaobject"><a href="images/slemicro_jeos_password.png"><img src="images/slemicro_jeos_password.png" width="100%" alt="root password" title="root password"/></a></div></div></li><li class="step"><p>
      Confirm the <code class="systemitem">root</code> password.
    </p><div class="informalfigure"><div class="mediaobject"><a href="images/slemicro_jeos_password_confirm.png"><img src="images/slemicro_jeos_password_confirm.png" width="100%" alt="root password confirmation" title="root password confirmation"/></a></div></div></li><li class="step"><p>
          Accept the statement about SLE Micro registration.
        </p><div class="informalfigure"><div class="mediaobject"><a href="images/slemicro_jeos_statement.png"><img src="images/slemicro_jeos_statement.png" width="100%" alt="root password" title="root password"/></a></div></div></li></ol></div></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-deployment-overview.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 6 </span>Overview of the deployment process</span></a> </div><div><a class="pagination-link next" href="cha-images-procedure.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 8 </span>Deploying the raw image</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="section"><a href="cha-prepare-device.html#sec-default-partitioning"><span class="title-number">7.1 </span><span class="title-name">Default partitioning</span></a></span></li><li><span class="section"><a href="cha-prepare-device.html#sec-about-ignition"><span class="title-number">7.2 </span><span class="title-name">Configuring <span class="productname"><span class="phrase">SLE Micro</span></span> using Ignition</span></a></span></li><li><span class="section"><a href="cha-prepare-device.html#sec-about-combustion"><span class="title-number">7.3 </span><span class="title-name">Configuring <span class="productname"><span class="phrase">SLE Micro</span></span> using Combustion</span></a></span></li><li><span class="section"><a href="cha-prepare-device.html#sec-raw-preparation"><span class="title-number">7.4 </span><span class="title-name">Preparing the raw image</span></a></span></li><li><span class="section"><a href="cha-prepare-device.html#sec-jeos-firstboot"><span class="title-number">7.5 </span><span class="title-name">Minimal initial configuration</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>