<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLES 12 SP5 | Security and Hardening Guide | Network Authentication with Kerberos</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Network Authentication with Kerberos | SLES 12 SP5"/>
<meta name="description" content="Kerberos is a network authentication protocol which also provides encryption. This chapter describes how to set up Kerberos and integrate services li…"/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="12 SP5"/>
<meta name="book-title" content="Security and Hardening Guide"/>
<meta name="chapter-title" content="Chapter 6. Network Authentication with Kerberos"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="SUSE Linux Enterprise Server 12 SP5"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Security Guide"/>
<meta property="og:description" content="Implement system security for SLES"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Security Guide"/>
<meta name="twitter:description" content="Implement system security for SLES"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Network Authentication with Kerberos",
  
    "description": "Kerberos is a network authentication protocol which also provides encryption. This chapter describes how to set up Kerberos and integrate services li…",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2019-12-09T00:00+02:00",
      
    "datePublished": "2019-12-09T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-security-ldap.html" title="Chapter 5. LDAP—A Directory Service"/><link rel="next" href="cha-security-ad.html" title="Chapter 7. Active Directory Support"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Security and Hardening Guide</a><span> / </span><a class="crumb" href="part-auth.html">Authentication</a><span> / </span><a class="crumb" href="cha-security-kerberos.html">Network Authentication with Kerberos</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Security and Hardening Guide</div><ol><li><a href="preface-security.html" class=" "><span class="title-number"> </span><span class="title-name">About This Guide</span></a></li><li><a href="cha-security.html" class=" "><span class="title-number">1 </span><span class="title-name">Security and Confidentiality</span></a></li><li class="active"><a href="part-auth.html" class="has-children you-are-here"><span class="title-number">I </span><span class="title-name">Authentication</span></a><ol><li><a href="cha-pam.html" class=" "><span class="title-number">2 </span><span class="title-name">Authentication with PAM</span></a></li><li><a href="cha-nis.html" class=" "><span class="title-number">3 </span><span class="title-name">Using NIS</span></a></li><li><a href="cha-security-auth.html" class=" "><span class="title-number">4 </span><span class="title-name">Setting Up Authentication Servers and Clients Using YaST</span></a></li><li><a href="cha-security-ldap.html" class=" "><span class="title-number">5 </span><span class="title-name">LDAP—A Directory Service</span></a></li><li><a href="cha-security-kerberos.html" class=" you-are-here"><span class="title-number">6 </span><span class="title-name">Network Authentication with Kerberos</span></a></li><li><a href="cha-security-ad.html" class=" "><span class="title-number">7 </span><span class="title-name">Active Directory Support</span></a></li></ol></li><li><a href="part-local-security.html" class="has-children "><span class="title-number">II </span><span class="title-name">Local Security</span></a><ol><li><a href="cha-spectre.html" class=" "><span class="title-number">8 </span><span class="title-name">Spectre/Meltdown Checker</span></a></li><li><a href="cha-security-yast-security.html" class=" "><span class="title-number">9 </span><span class="title-name">Configuring Security Settings with YaST</span></a></li><li><a href="cha-security-policykit.html" class=" "><span class="title-number">10 </span><span class="title-name">Authorization with Polkit</span></a></li><li><a href="cha-security-acls.html" class=" "><span class="title-number">11 </span><span class="title-name">Access Control Lists in Linux</span></a></li><li><a href="cha-security-cryptofs.html" class=" "><span class="title-number">12 </span><span class="title-name">Encrypting Partitions and Files</span></a></li><li><a href="cha-certstore.html" class=" "><span class="title-number">13 </span><span class="title-name">Certificate Store</span></a></li><li><a href="cha-aide.html" class=" "><span class="title-number">14 </span><span class="title-name">Intrusion Detection with AIDE</span></a></li></ol></li><li><a href="part-network-security.html" class="has-children "><span class="title-number">III </span><span class="title-name">Network Security</span></a><ol><li><a href="cha-ssh.html" class=" "><span class="title-number">15 </span><span class="title-name">SSH: Secure Network Operations</span></a></li><li><a href="cha-security-firewall.html" class=" "><span class="title-number">16 </span><span class="title-name">Masquerading and Firewalls</span></a></li><li><a href="cha-security-vpnserver.html" class=" "><span class="title-number">17 </span><span class="title-name">Configuring a VPN Server</span></a></li><li><a href="cha-security-yast-ca.html" class=" "><span class="title-number">18 </span><span class="title-name">Managing X.509 Certification</span></a></li><li><a href="cha-security-fips.html" class=" "><span class="title-number">19 </span><span class="title-name">Enabling compliance with FIPS 140-2</span></a></li></ol></li><li><a href="part-apparmor.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Confining Privileges with <span class="phrase">AppArmor</span></span></a><ol><li><a href="cha-apparmor-intro.html" class=" "><span class="title-number">20 </span><span class="title-name">Introducing <span class="phrase">AppArmor</span></span></a></li><li><a href="cha-apparmor-start.html" class=" "><span class="title-number">21 </span><span class="title-name">Getting Started</span></a></li><li><a href="cha-apparmor-concept.html" class=" "><span class="title-number">22 </span><span class="title-name">Immunizing Programs</span></a></li><li><a href="cha-apparmor-profiles.html" class=" "><span class="title-number">23 </span><span class="title-name">Profile Components and Syntax</span></a></li><li><a href="cha-apparmor-repos.html" class=" "><span class="title-number">24 </span><span class="title-name"><span class="phrase">AppArmor</span> Profile Repositories</span></a></li><li><a href="cha-apparmor-yast.html" class=" "><span class="title-number">25 </span><span class="title-name">Building and Managing Profiles with YaST</span></a></li><li><a href="cha-apparmor-commandline.html" class=" "><span class="title-number">26 </span><span class="title-name">Building Profiles from the Command Line</span></a></li><li><a href="cha-apparmor-hat.html" class=" "><span class="title-number">27 </span><span class="title-name">Profiling Your Web Applications Using ChangeHat</span></a></li><li><a href="cha-apparmor-pam.html" class=" "><span class="title-number">28 </span><span class="title-name">Confining Users with <code class="systemitem">pam_apparmor</code></span></a></li><li><a href="cha-apparmor-managing.html" class=" "><span class="title-number">29 </span><span class="title-name">Managing Profiled Applications</span></a></li><li><a href="cha-apparmor-support.html" class=" "><span class="title-number">30 </span><span class="title-name">Support</span></a></li><li><a href="cha-apparmor-glossary.html" class=" "><span class="title-number">31 </span><span class="title-name"><span class="phrase">AppArmor</span> Glossary</span></a></li></ol></li><li><a href="bk05pt05.html" class="has-children "><span class="title-number">V </span><span class="title-name">SELinux</span></a><ol><li><a href="cha-selinux.html" class=" "><span class="title-number">32 </span><span class="title-name">Configuring SELinux</span></a></li></ol></li><li><a href="part-audit.html" class="has-children "><span class="title-number">VI </span><span class="title-name">The Linux Audit Framework</span></a><ol><li><a href="cha-audit-comp.html" class=" "><span class="title-number">33 </span><span class="title-name">Understanding Linux Audit</span></a></li><li><a href="cha-audit-setup.html" class=" "><span class="title-number">34 </span><span class="title-name">Setting Up the Linux Audit Framework</span></a></li><li><a href="cha-audit-scenarios.html" class=" "><span class="title-number">35 </span><span class="title-name">Introducing an Audit Rule Set</span></a></li><li><a href="cha-audit-moreinfo.html" class=" "><span class="title-number">36 </span><span class="title-name">Useful Resources</span></a></li></ol></li><li><a href="app-pcidss.html" class=" "><span class="title-number">A </span><span class="title-name">Achieving PCI DSS Compliance</span></a></li><li><a href="bk05apb.html" class=" "><span class="title-number">B </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-security-kerberos" data-id-title="Network Authentication with Kerberos"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber">12 SP5</span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">6 </span><span class="title-name">Network Authentication with Kerberos</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div><div><div class="abstract"><p>
    Kerberos is a network authentication protocol which also provides
    encryption. This chapter describes how to set up Kerberos and integrate
    services like LDAP and NFS.
   </p></div></div></div></div><section class="sect1" id="sec-security-kerberos-overview" data-id-title="Conceptual Overview"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.1 </span><span class="title-name">Conceptual Overview</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-overview">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   An open network provides no means of ensuring that a workstation can
   identify its users properly, except through the usual password
   mechanisms. In common installations, the user must enter the
   password each time a service inside the network is accessed. Kerberos
   provides an authentication method with which a user registers only
   once and is trusted in the complete network for the rest of the
   session. To have a secure network, the following requirements must
   be met:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Have all users prove their identity for each desired service and
     make sure that no one can take the identity of someone else.
    </p></li><li class="listitem"><p>
     Make sure that each network server also proves its identity.
     Otherwise an attacker might be able to impersonate the server and
     obtain sensitive information transmitted to the server. This
     concept is called <span class="emphasis"><em>mutual authentication</em></span>,
     because the client authenticates to the server and vice versa.
    </p></li></ul></div><p>
   Kerberos helps you meet these requirements by providing strongly
   encrypted authentication. Only the basic principles of Kerberos are
   discussed here. For detailed technical instruction, refer to the
   Kerberos documentation.
  </p></section><section class="sect1" id="sec-security-kerberos-terms" data-id-title="Kerberos Terminology"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.2 </span><span class="title-name">Kerberos Terminology</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-terms">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following glossary defines some Kerberos terminology.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.6.4.3.1"><span class="term">credential</span></dt><dd><p>
      Users or clients need to present some kind of credentials that authorize
      them to request services. Kerberos knows two kinds of
      credentials—tickets and authenticators.
     </p></dd><dt id="id-1.7.4.6.4.3.2"><span class="term">ticket</span></dt><dd><p>
      A ticket is a per-server credential used by a client to
      authenticate at a server from which it is requesting a service. It
      contains the name of the server, the client's name, the client's
      Internet address, a time stamp, a lifetime, and a random session key.
      All this data is encrypted using the server's key.
     </p></dd><dt id="id-1.7.4.6.4.3.3"><span class="term">authenticator</span></dt><dd><p>
      Combined with the ticket, an authenticator is used to prove that the
      client presenting a ticket is really the one it claims to be. An
      authenticator is built using the client's name, the workstation's IP
      address, and the current workstation's time, all encrypted with the
      session key known only to the client and the relevant server. An
      authenticator can only be used once, unlike a ticket. A client can build
      an authenticator itself.
     </p></dd><dt id="id-1.7.4.6.4.3.4"><span class="term">principal</span></dt><dd><p>
      A Kerberos principal is a unique entity (a user or service) to which it
      can assign a ticket. A principal consists of the following components:
     </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">USER</em>/<em class="replaceable">INSTANCE</em>@<em class="replaceable">REALM</em></pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title">primary:</span>
         The first part of the principal. In the case of users, this is
         usually the same as the user name.
        </p></li><li class="listitem"><p><span class="formalpara-title">instance <span class="emphasis"><em>(optional)</em></span>:</span>
         Additional information characterizing the
         <span class="emphasis"><em>primary</em></span>. This string is separated from the
         <span class="emphasis"><em>primary</em></span> by a <code class="literal">/</code>.
        </p><p>
       <code class="literal">tux@example.org</code> and
       <code class="literal">tux/admin@example.org</code> can both exist on the same
       Kerberos system and are treated as different principals.
       </p></li><li class="listitem"><p><span class="formalpara-title">realm:</span>
         Specifies the Kerberos realm. Normally, your realm is your domain
         name in uppercase letters.
        </p></li></ul></div></dd><dt id="id-1.7.4.6.4.3.5"><span class="term">mutual authentication</span></dt><dd><p>
      Kerberos ensures that both client and server can be sure of each
      others identity. They share a session key, which they can use to
      communicate securely.
     </p></dd><dt id="id-1.7.4.6.4.3.6"><span class="term">session key</span></dt><dd><p>
      Session keys are temporary private keys generated by Kerberos. They are
      known to the client and used to encrypt the communication between the
      client and the server for which it requested and received a ticket.
     </p></dd><dt id="id-1.7.4.6.4.3.7"><span class="term">replay</span></dt><dd><p>
      Almost all messages sent in a network can be eavesdropped, stolen, and
      resent. In the Kerberos context, this would be most dangerous if an
      attacker manages to obtain your request for a service containing your
      ticket and authenticator. The attacker could then try to resend it
      (<span class="emphasis"><em>replay</em></span>) to impersonate you. However, Kerberos
      implements several mechanisms to deal with this problem.
     </p></dd><dt id="id-1.7.4.6.4.3.8"><span class="term">server or service</span></dt><dd><p>
      <span class="emphasis"><em>Service</em></span> is used to refer to a specific action to
      perform. The process behind this action is called a
      <span class="emphasis"><em>server</em></span>.
     </p></dd></dl></div></section><section class="sect1" id="sec-security-kerberos-how" data-id-title="How Kerberos Works"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.3 </span><span class="title-name">How Kerberos Works</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-how">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Kerberos is often called a third-party trusted authentication service,
   which means all its clients trust Kerberos's judgment of another client's
   identity. Kerberos keeps a database of all its users and their private
   keys.
  </p><p>
   To ensure Kerberos is working correctly, run both the authentication and
   ticket-granting server on a dedicated machine. Make sure that only the
   administrator can access this machine physically and over the network.
   Reduce the (networking) services running on it to the absolute
   minimum—do not even run
   <code class="systemitem">sshd</code>.
  </p><section class="sect2" id="sec-security-kerberos-how-contact" data-id-title="First Contact"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.3.1 </span><span class="title-name">First Contact</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-how-contact">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Your first contact with Kerberos is quite similar to any login procedure
    at a normal networking system. Enter your user name. This piece of
    information and the name of the ticket-granting service are sent to the
    authentication server (Kerberos). If the authentication server knows
    you, it generates a random session key for further use between your
    client and the ticket-granting server. Now the authentication server
    prepares a ticket for the ticket-granting server. The ticket contains
    the following information—all encrypted with a session key only
    the authentication server and the ticket-granting server know:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The names of both, the client and the ticket-granting server
     </p></li><li class="listitem"><p>
      The current time
     </p></li><li class="listitem"><p>
      A lifetime assigned to this ticket
     </p></li><li class="listitem"><p>
      The client's IP address
     </p></li><li class="listitem"><p>
      The newly-generated session key
     </p></li></ul></div><p>
    This ticket is then sent back to the client together with the session
    key, again in encrypted form, but this time the private key of the
    client is used. This private key is only known to Kerberos and the
    client, because it is derived from your user password. Now that the
    client has received this response, you are prompted for your password.
    This password is converted into the key that can decrypt the package
    sent by the authentication server. The package is
    <span class="quote">“<span class="quote">unwrapped</span>”</span> and password and key are erased from the
    workstation's memory. As long as the lifetime given to the ticket used
    to obtain other tickets does not expire, your workstation can prove your
    identity.
   </p></section><section class="sect2" id="sec-security-kerberos-how-request" data-id-title="Requesting a Service"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.3.2 </span><span class="title-name">Requesting a Service</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-how-request">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To request a service from any server in the network, the client
    application needs to prove its identity to the server. Therefore, the
    application generates an authenticator. An authenticator consists of the
    following components:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The client's principal
     </p></li><li class="listitem"><p>
      The client's IP address
     </p></li><li class="listitem"><p>
      The current time
     </p></li><li class="listitem"><p>
      A checksum (chosen by the client)
     </p></li></ul></div><p>
    All this information is encrypted using the session key that the client
    has already received for this special server. The authenticator and the
    ticket for the server are sent to the server. The server uses its copy
    of the session key to decrypt the authenticator, which gives it all the
    information needed about the client requesting its service, to compare
    it to that contained in the ticket. The server checks if the ticket and
    the authenticator originate from the same client.
   </p><p>
    Without any security measures implemented on the server side, this stage
    of the process would be an ideal target for replay attacks. Someone
    could try to resend a request stolen off the net some time before. To
    prevent this, the server does not accept any request with a time stamp
    and ticket received previously. In addition to that, a request with a
    time stamp differing too much from the time the request is received is
    ignored.
   </p></section><section class="sect2" id="sec-security-kerberos-how-mutual" data-id-title="Mutual Authentication"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.3.3 </span><span class="title-name">Mutual Authentication</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-how-mutual">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Kerberos authentication can be used in both directions. It is not only a
    question of the client being the one it claims to be. The server should
    also be able to authenticate itself to the client requesting its
    service. Therefore, it sends an authenticator itself. It adds one to the
    checksum it received in the client's authenticator and encrypts it with
    the session key, which is shared between it and the client. The client
    takes this response as a proof of the server's authenticity and they
    both start cooperating.
   </p></section><section class="sect2" id="sec-security-kerberos-how-tgs" data-id-title="Ticket Granting—Contacting All Servers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.3.4 </span><span class="title-name">Ticket Granting—Contacting All Servers</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-how-tgs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Tickets are designed to be used for one server at a time.  Therefore, you
    need to get a new ticket each time you request another service. Kerberos
    implements a mechanism to obtain tickets for individual servers. This
    service is called the <span class="quote">“<span class="quote">ticket-granting service</span>”</span>. The
    ticket-granting service is a service (like any other service mentioned
    before) and uses the same access protocols that have already been
    outlined. Any time an application needs a ticket that has not already been
    requested, it contacts the ticket-granting server.  This request consists
    of the following components:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The requested principal
     </p></li><li class="listitem"><p>
      The ticket-granting ticket
     </p></li><li class="listitem"><p>
      An authenticator
     </p></li></ul></div><p>
    Like any other server, the ticket-granting server now checks the
    ticket-granting ticket and the authenticator. If they are considered
    valid, the ticket-granting server builds a new session key to be used
    between the original client and the new server. Then the ticket for the
    new server is built, containing the following information:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The client's principal
     </p></li><li class="listitem"><p>
      The server's principal
     </p></li><li class="listitem"><p>
      The current time
     </p></li><li class="listitem"><p>
      The client's IP address
     </p></li><li class="listitem"><p>
      The newly-generated session key
     </p></li></ul></div><p>
    The new ticket has a lifetime, which is either the remaining lifetime of
    the ticket-granting ticket or the default for the service. The lesser of
    both values is assigned. The client receives this ticket and the session
    key, which are sent by the ticket-granting service. But this time the
    answer is encrypted with the session key that came with the original
    ticket-granting ticket. The client can decrypt the response without
    requiring the user's password when a new service is contacted. Kerberos
    can thus acquire ticket after ticket for the client without bothering
    the user.
   </p></section></section><section class="sect1" id="sec-security-kerberos-users" data-id-title="User View of Kerberos"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.4 </span><span class="title-name">User View of Kerberos</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-users">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Ideally, a user only contact with Kerberos happens during login
   at the workstation. The login process includes obtaining a
   ticket-granting ticket. At logout, a user's Kerberos tickets are
   automatically destroyed, which makes it difficult for anyone else to
   impersonate this user.
  </p><p>
   The automatic expiration of tickets can lead to a situation when a user's login session lasts longer than the maximum
   lifespan given to the ticket-granting ticket (a reasonable setting is 10
   hours). However, the user can get a new ticket-granting ticket by running
   <code class="command">kinit</code>. Enter the password again and Kerberos obtains
   access to desired services without additional authentication. To get a
   list of all the tickets silently acquired for you by Kerberos, run
   <code class="command">klist</code>.
  </p><p>
   Here is a short list of applications that use Kerberos authentication.
   These applications can be found under
   <code class="filename">/usr/lib/mit/bin</code> or
   <code class="filename">/usr/lib/mit/sbin</code> after installing the package
   <code class="systemitem">krb5-apps-clients</code>. They all have the full
   functionality of their common Unix and Linux brothers plus the additional
   bonus of transparent authentication managed by Kerberos:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="command">telnet</code>,
     <code class="systemitem">telnetd</code>
    </p></li><li class="listitem"><p>
     <code class="command">rlogin</code>
    </p></li><li class="listitem"><p>
     <code class="command">rsh</code>, <code class="command">rcp</code>,
     <code class="systemitem">rshd</code>
    </p></li><li class="listitem"><p>
     <code class="command">ftp</code>, <code class="systemitem">ftpd</code>
    </p></li><li class="listitem"><p>
     <code class="command">ksu</code>
    </p></li></ul></div><p>
   You no longer need to enter your password for using these applications
   because Kerberos has already proven your identity.
   <code class="command">ssh</code>, if compiled with Kerberos support, can even
   forward all the tickets acquired for one workstation to another one. If
   you use <code class="command">ssh</code> to log in to another workstation,
   <code class="command">ssh</code> makes sure that the encrypted contents of the
   tickets are adjusted to the new situation. Simply copying tickets between
   workstations is not sufficient because the ticket contains
   workstation-specific information (the IP address). XDM and GDM offer
   Kerberos support, too. Read more about the Kerberos network applications
   in <em class="citetitle">Kerberos V5 UNIX User's Guide</em> at
   <a class="link" href="https://web.mit.edu/kerberos" target="_blank">https://web.mit.edu/kerberos</a>.
  </p></section><section class="sect1" id="sec-security-kerberos-admin" data-id-title="Installing and Administering Kerberos"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.5 </span><span class="title-name">Installing and Administering Kerberos</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   A Kerberos environment consists of several components. A key
   distribution center (KDC) holds the central database with all
   Kerberos-relevant data. All clients rely on the KDC for proper
   authentication across the network. Both the KDC and the clients need to
   be configured to match your setup:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.6.7.3.1"><span class="term">General Preparations</span></dt><dd><p>
      Check your network setup and make sure it meets the minimum
      requirements outlined in
      <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-top" title="6.5.1. Kerberos Network Topology">Section 6.5.1, “Kerberos Network Topology”</a>. Choose an
      appropriate realm for your Kerberos setup, see
      <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-realm" title="6.5.2. Choosing the Kerberos Realms">Section 6.5.2, “Choosing the Kerberos Realms”</a>. Carefully set up
      the machine that is to serve as the KDC and apply tight security, see
      <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-kdc" title="6.5.3. Setting Up the KDC Hardware">Section 6.5.3, “Setting Up the KDC Hardware”</a>. Set up a reliable
      time source in your network to make sure all tickets contain valid
      time stamps, see <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-time" title="6.5.4. Configuring Time Synchronization">Section 6.5.4, “Configuring Time Synchronization”</a>.
     </p></dd><dt id="id-1.7.4.6.7.3.2"><span class="term">Basic Configuration</span></dt><dd><p>
      Configure the KDC and the clients, see
      <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-instkdc" title="6.5.5. Configuring the KDC">Section 6.5.5, “Configuring the KDC”</a> and
      <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-client" title="6.5.6. Configuring Kerberos Clients">Section 6.5.6, “Configuring Kerberos Clients”</a>. Enable remote
      administration for your Kerberos service, so you do not need physical
      access to your KDC machine, see
      <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-remote" title="6.5.7. Configuring Remote Kerberos Administration">Section 6.5.7, “Configuring Remote Kerberos Administration”</a>. Create service
      principals for every service in your realm, see
      <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-hostprinc" title="6.5.8. Creating Kerberos Service Principals">Section 6.5.8, “Creating Kerberos Service Principals”</a>.
     </p></dd><dt id="id-1.7.4.6.7.3.3"><span class="term">Enabling Kerberos Authentication</span></dt><dd><p>
      Various services in your network can use Kerberos. To add
      Kerberos password-checking to applications using PAM, proceed as
      outlined in <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-pam" title="6.5.9. Enabling PAM Support for Kerberos">Section 6.5.9, “Enabling PAM Support for Kerberos”</a>. To
      configure SSH or LDAP with Kerberos authentication, proceed as
      outlined in <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-sshd" title="6.5.10. Configuring SSH for Kerberos Authentication">Section 6.5.10, “Configuring SSH for Kerberos Authentication”</a> and
      <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-ldap" title="6.5.11. Using LDAP and Kerberos">Section 6.5.11, “Using LDAP and Kerberos”</a>.
     </p></dd></dl></div><section class="sect2" id="sec-security-kerberos-admin-top" data-id-title="Kerberos Network Topology"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.1 </span><span class="title-name">Kerberos Network Topology</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-top">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Any Kerberos environment must meet the following requirements to be
    fully functional:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Provide a DNS server for name resolution across your network, so
      clients and servers can locate each other. Refer to
      <span class="intraxref">Book “Administration Guide”, Chapter 27 “The Domain Name System”</span> for information on DNS setup.
     </p></li><li class="listitem"><p>
      Provide a time server in your network. Using exact time stamps is
      crucial to a Kerberos setup, because valid Kerberos tickets must
      contain correct time stamps. Refer to <span class="intraxref">Book “Administration Guide”, Chapter 26 “Time Synchronization with NTP”</span>
      for information on NTP setup.
     </p></li><li class="listitem"><p>
      Provide a key distribution center (KDC) as the center piece of the
      Kerberos architecture. It holds the Kerberos database. Use the
      tightest possible security policy on this machine to prevent any
      attacks on this machine compromising your entire infrastructure.
     </p></li><li class="listitem"><p>
      Configure the client machines to use Kerberos authentication.
     </p></li></ul></div><p>
    The following figure depicts a simple example network with only the
    minimum components needed to build a Kerberos infrastructure. Depending
    on the size and topology of your deployment, your setup may vary.
   </p><div class="figure" id="fig-netw-kerb"><div class="figure-contents"><div class="mediaobject"><a href="images/network_kerb.png"><img src="images/network_kerb.png" width="73%" alt="Kerberos Network Topology" title="Kerberos Network Topology"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 6.1: </span><span class="title-name">Kerberos Network Topology </span></span><a title="Permalink" class="permalink" href="cha-security-kerberos.html#fig-netw-kerb">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div><div id="id-1.7.4.6.7.4.6" data-id-title="Configuring Subnet Routing" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Configuring Subnet Routing</div><p>
     For a setup similar to the one in <a class="xref" href="cha-security-kerberos.html#fig-netw-kerb" title="Kerberos Network Topology">Figure 6.1, “Kerberos Network Topology”</a>,
     configure routing between the two subnets (192.168.1.0/24 and
     192.168.2.0/24). Refer to
     <span class="intraxref">Book “Administration Guide”, Chapter 17 “Basic Networking”, Section 17.4.1.5 “Configuring Routing”</span> for more information
     on configuring routing with YaST.
    </p></div></section><section class="sect2" id="sec-security-kerberos-admin-realm" data-id-title="Choosing the Kerberos Realms"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.2 </span><span class="title-name">Choosing the Kerberos Realms</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-realm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The domain of a Kerberos installation is called a realm and is
    identified by a name, such as <code class="systemitem">EXAMPLE.COM</code> or simply <code class="systemitem">ACCOUNTING</code>. Kerberos is case-sensitive, so
    <code class="systemitem">example.com</code> is actually a
    different realm than <code class="systemitem">EXAMPLE.COM</code>. Use the case you prefer. It
    is common practice, however, to use uppercase realm names.
   </p><p>
    It is also a good idea to use your DNS domain name (or a subdomain, such
    as <code class="systemitem">ACCOUNTING.EXAMPLE.COM</code>). As
    shown below, your life as an administrator can be much easier if you
    configure your Kerberos clients to locate the KDC and other Kerberos services via
    DNS. To do so, it is helpful if your realm name is a subdomain of your DNS
    domain name.
   </p><p>
    Unlike the DNS name space, Kerberos is not hierarchical. So if you have a
    realm named <code class="systemitem">EXAMPLE.COM</code> with
    two <span class="quote">“<span class="quote">subrealms</span>”</span> named <code class="systemitem">DEVELOPMENT</code> and <code class="systemitem">ACCOUNTING</code>, these subordinate realms do
    not inherit principals from <code class="systemitem">EXAMPLE.COM</code>. Instead, you would have three
    separate realms, and you would need to configure cross-realm authentication
    for each realm, so that users from one realm can interact with servers or
    other users from another realm.
   </p><p>
    For the sake of simplicity, let us assume you are setting up just one
    realm for your entire organization. For the remainder of this section, the
    realm name <code class="systemitem">EXAMPLE.COM</code> is used
    in all examples.
   </p></section><section class="sect2" id="sec-security-kerberos-admin-kdc" data-id-title="Setting Up the KDC Hardware"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.3 </span><span class="title-name">Setting Up the KDC Hardware</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-kdc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The first thing required to use Kerberos is a machine that acts as the
    key distribution center, or KDC for short. This machine holds the entire
    Kerberos user database with passwords and all information.
   </p><p>
    The KDC is the most important part of your security
    infrastructure—if someone breaks into it, all user accounts and
    all of your infrastructure protected by Kerberos is compromised. An
    attacker with access to the Kerberos database can impersonate any
    principal in the database. Tighten security for this machine as much as
    possible:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Put the server machine into a physically secured location, such as a
      locked server room to which only a very few people have access.
     </p></li><li class="step"><p>
      Do not run any network applications on it except the KDC. This
      includes servers and clients—for example, the KDC should not
      import any file systems via NFS or use DHCP to retrieve its network
      configuration.
     </p></li><li class="step"><p>
      Install a minimal system first then check the list of installed
      packages and remove any unneeded packages. This includes servers, such
      as <code class="systemitem">inetd</code>,
      <code class="systemitem">portmap</code>, and CUPS, plus
      anything X-based. Even installing an SSH server should be considered a
      potential security risk.
     </p></li><li class="step"><p>
      No graphical login is provided on this machine as an X server is a
      potential security risk. Kerberos provides its own administration
      interface.
     </p></li><li class="step"><p>
      Configure <code class="filename">/etc/nsswitch.conf</code> to use only local
      files for user and group lookup. Change the lines for
      <code class="literal">passwd</code> and <code class="literal">group</code> to look like
      this:
     </p><div class="verbatim-wrap"><pre class="screen">passwd:         files
group:          files</pre></div><p>
      Edit the <code class="filename">passwd</code>, <code class="filename">group</code>, and
      <code class="filename">shadow</code> files in <code class="filename">/etc</code> and
      remove the lines that start with a <code class="literal">+</code> character
      (these are for NIS lookups).
     </p></li><li class="step"><p>
      Disable all user accounts except <code class="systemitem">root</code>'s account by editing
      <code class="filename">/etc/shadow</code> and replacing the hashed passwords
      with <code class="literal">*</code> or <code class="literal">!</code> characters.
     </p></li></ol></div></div></section><section class="sect2" id="sec-security-kerberos-admin-time" data-id-title="Configuring Time Synchronization"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.4 </span><span class="title-name">Configuring Time Synchronization</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-time">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To use Kerberos successfully, make sure that all system clocks within
    your organization are synchronized within a certain range. This is
    important because Kerberos protects against replayed credentials. An
    attacker might be able to observe Kerberos credentials on the network
    and reuse them to attack the server. Kerberos employs several defenses
    to prevent this. One of them is that it puts time stamps into its
    tickets. A server receiving a ticket with a time stamp that differs from
    the current time rejects the ticket.
   </p><p>
    Kerberos allows a certain leeway when comparing time
    stamps. However, computer clocks can be very inaccurate in keeping
    time—it is not unheard of for PC clocks to lose or gain half
    an hour during a week. For this reason, configure all hosts on the
    network to synchronize their clocks with a central time source.
   </p><p>
    A simple way to do so is by installing an NTP time server on one machine
    and having all clients synchronize their clocks with this server. Do
    this either by running an NTP daemon in client mode on all these
    machines or by running <code class="command">ntpdate</code> once a day from all
    clients (this solution probably works for a few clients
    only). The KDC itself needs to be synchronized to the common time source
    as well. Because running an NTP daemon on this machine would be a
    security risk, it is probably a good idea to do this by running ntpdate
    via a cron job. To configure your machine as an NTP client, proceed as
    outlined in <span class="intraxref">Book “Administration Guide”, Chapter 26 “Time Synchronization with NTP”, Section 26.1 “Configuring an NTP Client with YaST”</span>.
   </p><p>
    A different way to secure the time service and still use the NTP daemon
    is to attach a hardware reference clock to a dedicated NTP server and
    an additional hardware reference clock to the KDC.
   </p><p>
    It is also possible to adjust the maximum deviation Kerberos allows when
    checking time stamps. This value (called <span class="emphasis"><em>clock
    skew</em></span>) can be set in the <code class="filename">krb5.conf</code> file
    as described in
    <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-client-clockskew" title="6.5.6.3. Adjusting the Clock Skew">Section 6.5.6.3, “Adjusting the Clock Skew”</a>.
   </p></section><section class="sect2" id="sec-security-kerberos-admin-instkdc" data-id-title="Configuring the KDC"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.5 </span><span class="title-name">Configuring the KDC</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-instkdc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This section covers the initial configuration and installation of the
    KDC, including the creation of an administrative principal. This
    procedure consists of several steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p><span class="formalpara-title">Install the RPMs. </span>
       On a machine designated as the KDC, install the following software
       packages: <code class="systemitem">krb5</code>,
       <code class="systemitem">krb5-server</code> and
       <code class="systemitem">krb5-client</code> packages.
      </p></li><li class="step"><p><span class="formalpara-title">Adjust the Configuration Files. </span>
       The <code class="filename">/etc/krb5.conf</code> and
       <code class="filename">/var/lib/kerberos/krb5kdc/kdc.conf</code> configuration
       files must be adjusted for your scenario. These files contain all
       information on the KDC.
      </p></li><li class="step"><p><span class="formalpara-title">Create the Kerberos Database. </span>
       Kerberos keeps a database of all principal identifiers and the secret
       keys of all principals that need to be authenticated. Refer to
       <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-kdc-database" title="6.5.5.1. Setting Up the Database">Section 6.5.5.1, “Setting Up the Database”</a> for
       details.
      </p></li><li class="step"><p><span class="formalpara-title">Adjust the ACL Files: Add Administrators. </span>
       The Kerberos database on the KDC can be managed remotely. To prevent
       unauthorized principals from tampering with the database, Kerberos
       uses access control lists. You must explicitly enable remote access
       for the administrator principal to enable them to manage the database.
       The Kerberos ACL file is located under
       <code class="filename">/var/lib/kerberos/krb5kdc/kadm5.acl</code>. Refer to
       <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-remote" title="6.5.7. Configuring Remote Kerberos Administration">Section 6.5.7, “Configuring Remote Kerberos Administration”</a> for details.
      </p></li><li class="step"><p><span class="formalpara-title">Adjust the Kerberos Database: Add Administrators. </span>
       You need at least one administrative principal to run and administer
       Kerberos. This principal must be added before starting the KDC. Refer
       to <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-kdc-princ" title="6.5.5.2. Creating a Principal">Section 6.5.5.2, “Creating a Principal”</a> for
       details.
      </p></li><li class="step"><p><span class="formalpara-title">Start the Kerberos Daemon. </span>
       After the KDC software is installed and properly configured, start
       the Kerberos daemon to provide Kerberos service for your realm. Refer
       to <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-kdc-start" title="6.5.5.3. Starting the KDC">Section 6.5.5.3, “Starting the KDC”</a> for
       details.
      </p></li><li class="step"><p><span class="formalpara-title">Create a Principal for Yourself. </span>
       You need a principal for yourself. Refer to
       <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-admin-kdc-princ" title="6.5.5.2. Creating a Principal">Section 6.5.5.2, “Creating a Principal”</a> for details.
      </p></li></ol></div></div><section class="sect3" id="sec-security-kerberos-admin-kdc-database" data-id-title="Setting Up the Database"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">6.5.5.1 </span><span class="title-name">Setting Up the Database</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-kdc-database">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Your next step is to initialize the database where Kerberos keeps all
     information about principals. Set up the database master key, which is
     used to protect the database from accidental disclosure (in particular
     if it is backed up to tape). The master key is derived from a pass
     phrase and is stored in a file called the stash file. This is so you do
     not need to enter the password every time the KDC is restarted. Make
     sure that you choose a good pass phrase, such as a sentence from a book
     opened to a random page.
    </p><p>
     When you make tape backups of the Kerberos database
     (<code class="filename">/var/lib/kerberos/krb5kdc/principal</code>), do not back
     up the stash file (which is in
     <code class="filename">/var/lib/kerberos/krb5kdc/.k5.EXAMPLE.COM</code>).
     Otherwise, everyone able to read the tape could also decrypt the
     database. Therefore, keep a copy of the pass phrase in a safe or some
     other secure location, because you will need it to restore your
     database from backup tape after a crash.
    </p><p>
     To create the stash file and the database, run:
    </p><div class="verbatim-wrap"><pre class="screen">kdb5_util create -r EXAMPLE.COM -s</pre></div><p>
     You will see the following output:
    </p><div class="verbatim-wrap"><pre class="screen">Initializing database '/var/lib/kerberos/krb5kdc/principal' for realm 'EXAMPLE.COM',
master key name 'K/M@EXAMPLE.COM'
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.
Enter KDC database master key:  <span class="callout" id="co-kerb-kdb5-pass">1</span>
Re-enter KDC database master key to verify:  <span class="callout" id="co-kerb-kdb5-pass-repeat">2</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-kerb-kdb5-pass"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Type the master password.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-kerb-kdb5-pass-repeat"><span class="callout">2</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Type the password again.
      </p></td></tr></table></div><p>
     To verify, use the list command:
    </p><div class="verbatim-wrap"><pre class="screen">kadmin.local

kadmin&gt; listprincs</pre></div><p>
     You will see several principals in the database, which are for internal
     use by Kerberos:
    </p><div class="verbatim-wrap"><pre class="screen">K/M@EXAMPLE.COM
kadmin/admin@EXAMPLE.COM
kadmin/changepw@EXAMPLE.COM
krbtgt/EXAMPLE.COM@EXAMPLE.COM</pre></div></section><section class="sect3" id="sec-security-kerberos-admin-kdc-princ" data-id-title="Creating a Principal"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">6.5.5.2 </span><span class="title-name">Creating a Principal</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-kdc-princ">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Create two Kerberos principals for yourself: one normal principal for
     everyday work and one for administrative tasks relating to Kerberos.
     Assuming your login name is <code class="systemitem">suzanne</code>, proceed as follows:
    </p><div class="verbatim-wrap"><pre class="screen">kadmin.local

kadmin&gt; ank suzanne</pre></div><p>
     You will see the following output:
    </p><div class="verbatim-wrap"><pre class="screen">suzanne@EXAMPLE.COM's Password: <span class="callout" id="co-kerb-geeko-pass">1</span>
Verifying password: <span class="callout" id="co-kerb-geeko-pass-repeat">2</span></pre></div><div class="calloutlist"><table style="border: 0; "><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-kerb-geeko-pass"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Type <code class="systemitem">suzanne</code>'s password.
      </p></td></tr><tr><td style="width: 5%; vertical-align: top; text-align: left; "><p><a href="#co-kerb-geeko-pass"><span class="callout">1</span></a> </p></td><td style="vertical-align: top; text-align: left; "><p>
       Type <code class="systemitem">suzanne</code>'s password again.
      </p></td></tr></table></div><p>
     Next, create another principal named
     <code class="literal">suzanne/admin</code> by typing
     <code class="command">ank</code> <code class="option">suzanne/admin</code> at
     the <code class="command">kadmin</code> prompt. The <code class="literal">admin</code>
     suffixed to your user name is a <span class="emphasis"><em>role</em></span>. Later, use
     this role when administering the Kerberos database. A user can have
     several roles for different purposes. Roles act like completely
     different accounts that have similar names.
    </p></section><section class="sect3" id="sec-security-kerberos-admin-kdc-start" data-id-title="Starting the KDC"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">6.5.5.3 </span><span class="title-name">Starting the KDC</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-kdc-start">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Start the KDC daemon and the kadmin daemon. To start the daemons
     manually, enter:
    </p><div class="verbatim-wrap"><pre class="screen">sudo systemctl start krb5kdc
sudo systemctl start kadmind</pre></div><p>
     Also make sure that the services KDC (<code class="systemitem">krb5kdc</code>) and
     kadmind (<code class="systemitem">kadmind</code>) are started by
     default when the server machine is rebooted. Enable them by entering:
    </p><div class="verbatim-wrap"><pre class="screen">sudo systemctl enable krb5kdc kadmind</pre></div><p>
     or by using the YaST <span class="guimenu">Services Manager</span>.
    </p></section></section><section class="sect2" id="sec-security-kerberos-admin-client" data-id-title="Configuring Kerberos Clients"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.6 </span><span class="title-name">Configuring Kerberos Clients</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-client">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When the supporting infrastructure is in place (DNS, NTP) and the KDC
    has been properly configured and started, configure the client machines.
    To configure a Kerberos client, use one of the two manual approaches
    described below.
   </p><p>
     When configuring Kerberos, there are two approaches you can
     take—static configuration in the
     <code class="filename">/etc/krb5.conf</code> file or dynamic configuration with
     DNS. With DNS configuration, Kerberos applications try to locate the
     KDC services using DNS records. With static configuration, add the host
     names of your KDC server to <code class="filename">krb5.conf</code> (and update
     the file whenever you move the KDC or reconfigure your realm in other
     ways).
    </p><p>
     DNS-based configuration is generally a lot more flexible and the amount
     of configuration work per machine is a lot less. However, it requires
     that your realm name is either the same as your DNS domain or a
     subdomain of it. Configuring Kerberos via DNS also creates a
     security issue: an attacker can seriously disrupt your
     infrastructure through your DNS (by shooting down the name server,
     spoofing DNS records, etc.). However, this amounts to a denial of
     service at worst. A similar scenario applies to the static
     configuration case unless you enter IP addresses in
     <code class="filename">krb5.conf</code> instead of host names.
    </p><section class="sect3" id="sec-security-kerberos-admin-client-stat" data-id-title="Static Configuration"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">6.5.6.1 </span><span class="title-name">Static Configuration</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-client-stat">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      One way to configure Kerberos is to edit
      <code class="filename">/etc/krb5.conf</code>. The file installed by default
      contains various sample entries. Erase all of these entries before
      starting. <code class="filename">krb5.conf</code> is made up of several
      sections (stanzas), each introduced by the section name in brackets
      like <code class="literal">[this]</code>.
     </p><p>
      To configure your Kerberos clients, add the following stanza to
      <code class="filename">krb5.conf</code> (where
      <code class="systemitem">kdc.example.com</code> is the
      host name of the KDC):
     </p><div class="verbatim-wrap"><pre class="screen">[libdefaults]
        default_realm = EXAMPLE.COM

[realms]
        EXAMPLE.COM = {
                kdc = kdc.example.com
                admin_server = kdc.example.com
        }</pre></div><p>
      The <code class="literal">default_realm</code> line sets the default realm for
      Kerberos applications. If you have several realms, add additional
      statements to the <code class="literal">[realms]</code> section.
     </p><p>
      Also add a statement to this file that tells applications how to map
      host names to a realm. For example, when connecting to a remote host,
      the Kerberos library needs to know in which realm this host is
      located. This must be configured in the
      <code class="literal">[domain_realms]</code> section:
     </p><div class="verbatim-wrap"><pre class="screen">[domain_realm]
.example.com = EXAMPLE.COM
www.example.org = EXAMPLE.COM</pre></div><p>
      This tells the library that all hosts in the
      <code class="filename">example.com</code> DNS domains are in the
      <code class="filename">EXAMPLE.COM</code> Kerberos realm. In addition, one
      external host named <code class="filename">www.example.org</code> should also
      be considered a member of the <code class="filename">EXAMPLE.COM</code> realm.
     </p></section><section class="sect3" id="sec-security-kerberos-admin-client-dns" data-id-title="DNS-Based Configuration"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">6.5.6.2 </span><span class="title-name">DNS-Based Configuration</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-client-dns">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      DNS-based Kerberos configuration makes heavy use of SRV records. See
      <span class="emphasis"><em>(RFC2052) A DNS RR for specifying the location of
      services</em></span> at <a class="link" href="https://datatracker.ietf.org/doc/html/rfc2052" target="_blank">https://datatracker.ietf.org/doc/html/rfc2052</a>.
     </p><p>
      The name of an SRV record, as far as Kerberos is concerned, is always
      in the format <code class="literal">_service._proto.realm</code>, where realm is
      the Kerberos realm. Domain names in DNS are case-insensitive, so
      case-sensitive Kerberos realms would break when using this
      configuration method. <code class="literal">_service</code> is a service name
      (different names are used when trying to contact the KDC or the
      password service, for example). <code class="literal">_proto</code> can be
      either <code class="literal">_udp</code> or <code class="literal">_tcp</code>, but not all
      services support both protocols.
     </p><p>
      The data portion of SRV resource records consists of a priority value,
      a weight, a port number, and a host name. The priority defines the
      order in which hosts should be tried (lower values indicate a higher
      priority). The weight value is there to support some sort of load
      balancing among servers of equal priority. You probably do not need
      any of this, so it is okay to set these to zero.
     </p><p>
      MIT Kerberos currently looks up the following names when looking for
      services:
     </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.4.6.7.9.6.6.1"><span class="term">_kerberos</span></dt><dd><p>
         This defines the location of the KDC daemon (the authentication and
         ticket granting server). Typical records look like this:
        </p><div class="verbatim-wrap"><pre class="screen">_kerberos._udp.EXAMPLE.COM.  IN  SRV    0 0 88 kdc.example.com.
_kerberos._tcp.EXAMPLE.COM.  IN  SRV    0 0 88 kdc.example.com.</pre></div></dd><dt id="id-1.7.4.6.7.9.6.6.2"><span class="term">_kerberos-adm</span></dt><dd><p>
         This describes the location of the remote administration service.
         Typical records look like this:
        </p><div class="verbatim-wrap"><pre class="screen">_kerberos-adm._tcp.EXAMPLE.COM. IN  SRV    0 0 749 kdc.example.com.</pre></div><p>
         Because kadmind does not support UDP, there should be no
         <code class="literal">_udp</code> record.
        </p></dd></dl></div><p>
      As with the static configuration file, there is a mechanism to inform
      clients that a specific host is in the <code class="literal">EXAMPLE.COM</code>
      realm, even if it is not part of the <code class="literal">example.com</code>
      DNS domain. This can be done by attaching a TXT record to
      <code class="literal">_kerberos.host_name</code>, as shown here:
     </p><div class="verbatim-wrap"><pre class="screen">_kerberos.www.example.org.  IN TXT "EXAMPLE.COM"</pre></div></section><section class="sect3" id="sec-security-kerberos-admin-client-clockskew" data-id-title="Adjusting the Clock Skew"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">6.5.6.3 </span><span class="title-name">Adjusting the Clock Skew</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-client-clockskew">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      The <span class="emphasis"><em>clock skew</em></span> is the tolerance for accepting
      tickets with time stamps that do not exactly match the host's system
      clock. Usually, the clock skew is set to 300 seconds (five minutes).
      This means a ticket can have a time stamp somewhere between five
      minutes behind and five minutes ahead of the server's clock.
     </p><p>
      When using NTP to synchronize all hosts, you can reduce this value to
      about one minute. The clock skew value can be set in
      <code class="filename">/etc/krb5.conf</code> like this:
     </p><div class="verbatim-wrap"><pre class="screen">[libdefaults]
        clockskew = 60</pre></div></section></section><section class="sect2" id="sec-security-kerberos-admin-remote" data-id-title="Configuring Remote Kerberos Administration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.7 </span><span class="title-name">Configuring Remote Kerberos Administration</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-remote">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    To be able to add and remove principals from the Kerberos database
    without accessing the KDC's console directly, tell the Kerberos
    administration server which principals are allowed to do what by editing
    <code class="filename">/var/lib/kerberos/krb5kdc/kadm5.acl</code>. The ACL
    (access control list) file allows you to specify privileges with a
    precise degree of control. For details, refer to the manual page with
    <code class="command">man</code> <code class="option">8 kadmind</code>.
   </p><p>
    For now, grant yourself the privilege to administer the database by
    putting the following line into the file:
   </p><div class="verbatim-wrap"><pre class="screen">suzanne/admin              *</pre></div><p>
    Replace the user name <code class="systemitem">suzanne</code> with your own. Restart
    <code class="systemitem">kadmind</code> for the change to take effect.
   </p><p>
    You should now be able to perform Kerberos administration tasks remotely
    using the kadmin tool. First, obtain a ticket for your admin role and
    use that ticket when connecting to the kadmin server:
   </p><div class="verbatim-wrap"><pre class="screen">kadmin -p suzanne/admin
Authenticating as principal suzanne/admin@EXAMPLE.COM with password.
Password for suzanne/admin@EXAMPLE.COM:
kadmin:  getprivs
current privileges: GET ADD MODIFY DELETE
kadmin:</pre></div><p>
    Using the <code class="command">getprivs</code> command, verify which privileges
    you have. The list shown above is the full set of privileges.
   </p><p>
    As an example, modify the principal <code class="systemitem">suzanne</code>:
   </p><div class="verbatim-wrap"><pre class="screen">kadmin -p suzanne/admin
Authenticating as principal suzanne/admin@EXAMPLE.COM with password.
Password for suzanne/admin@EXAMPLE.COM:

kadmin:  getprinc suzanne
Principal: suzanne@EXAMPLE.COM
Expiration date: [never]
Last password change: Wed Jan 12 17:28:46 CET 2005
Password expiration date: [none]
Maximum ticket life: 0 days 10:00:00
Maximum renewable life: 7 days 00:00:00
Last modified: Wed Jan 12 17:47:17 CET 2005 (admin/admin@EXAMPLE.COM)
Last successful authentication: [never]
Last failed authentication: [never]
Failed password attempts: 0
Number of keys: 2
Key: vno 1, Triple DES cbc mode with HMAC/sha1, no salt
Key: vno 1, DES cbc mode with CRC-32, no salt
Attributes:
Policy: [none]

kadmin:  modify_principal -maxlife "8 hours" suzanne
Principal "suzanne@EXAMPLE.COM" modified.
kadmin:  getprinc suzanne
Principal: suzanne@EXAMPLE.COM
Expiration date: [never]
Last password change: Wed Jan 12 17:28:46 CET 2005
Password expiration date: [none]
Maximum ticket life: 0 days 08:00:00
Maximum renewable life: 7 days 00:00:00
Last modified: Wed Jan 12 17:59:49 CET 2005 (suzanne/admin@EXAMPLE.COM)
Last successful authentication: [never]
Last failed authentication: [never]
Failed password attempts: 0
Number of keys: 2
Key: vno 1, Triple DES cbc mode with HMAC/sha1, no salt
Key: vno 1, DES cbc mode with CRC-32, no salt
Attributes:
Policy: [none]
kadmin:</pre></div><p>
    This changes the maximum ticket life time to eight hours. For more
    information about the <code class="command">kadmin</code> command and the options
    available, see the <code class="systemitem">krb5-doc</code> package or refer to
    the <code class="command">man</code> <code class="option">8 kadmin</code> manual page.
   </p></section><section class="sect2" id="sec-security-kerberos-admin-hostprinc" data-id-title="Creating Kerberos Service Principals"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.8 </span><span class="title-name">Creating Kerberos Service Principals</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-hostprinc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    So far, only user credentials have been discussed. However,
    Kerberos-compatible services usually need to authenticate themselves to
    the client user, too. Therefore, special service principals must be
    in the Kerberos database for each service offered in the realm.
    For example, if ldap.example.com offers an LDAP service, you need a service
    principal, <code class="literal">ldap/ldap.example.com@EXAMPLE.COM</code>, to
    authenticate this service to all clients.
   </p><p>
    The naming convention for service principals is
    <code class="literal"><em class="replaceable">SERVICE</em>/<em class="replaceable">HOSTNAME</em>@<em class="replaceable">REALM</em></code>,
    where <em class="replaceable">HOSTNAME</em> is the host's fully qualified
    host name.
   </p><p>
    Valid service descriptors are:
   </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         Service Descriptor
        </p>
       </th><th style="border-bottom: 1px solid ; ">
        <p>
         Service
        </p>
       </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">host</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         Telnet, RSH, SSH
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">nfs</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         NFSv4 (with Kerberos support)
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">HTTP</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         HTTP (with Kerberos authentication)
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">imap</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         IMAP
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
        <p>
         <code class="literal">pop</code>
        </p>
       </td><td style="border-bottom: 1px solid ; ">
        <p>
         POP3
        </p>
       </td></tr><tr><td style="border-right: 1px solid ; ">
        <p>
         <code class="literal">ldap</code>
        </p>
       </td><td>
        <p>
         LDAP
        </p>
       </td></tr></tbody></table></div><p>
    Service principals are similar to user principals, but have significant
    differences. The main difference between a user principal and a service
    principal is that the key of the former is protected by a
    password. When a user obtains a ticket-granting ticket from the
    KDC, they needs to type their password, so Kerberos can decrypt the ticket.
    It would be inconvenient for system administrators to obtain new tickets
    for the SSH daemon every eight hours or so.
   </p><p>
    Instead, the key required to decrypt the initial ticket for the service
    principal is extracted by the administrator from the KDC only once and
    stored in a local file called the <span class="emphasis"><em>keytab</em></span>. Services
    such as the SSH daemon read this key and use it to obtain new tickets
    automatically, when needed. The default keytab file resides in
    <code class="filename">/etc/krb5.keytab</code>.
   </p><p>
    To create a host service principal for <code class="literal">jupiter.example.com</code>
    enter the following commands during your kadmin session:
   </p><div class="verbatim-wrap"><pre class="screen">kadmin -p suzanne/admin
Authenticating as principal suzanne/admin@EXAMPLE.COM with password.
Password for suzanne/admin@EXAMPLE.COM:
kadmin:  addprinc -randkey host/jupiter.example.com
WARNING: no policy specified for host/jupiter.example.com@EXAMPLE.COM;
defaulting to no policy
Principal "host/jupiter.example.com@EXAMPLE.COM" created.</pre></div><p>
    Instead of setting a password for the new principal, the
    <code class="option">-randkey</code> flag tells <code class="command">kadmin</code> to
    generate a random key. This is used here because no user interaction is
    wanted for this principal. It is a server account for the machine.
   </p><p>
    Finally, extract the key and store it in the local keytab file
    <code class="filename">/etc/krb5.keytab</code>. This file is owned by the
    superuser, so you must be <code class="systemitem">root</code>
    to execute the next command in the kadmin shell:
   </p><div class="verbatim-wrap"><pre class="screen">kadmin:  ktadd host/jupiter.example.com
Entry for principal host/jupiter.example.com with kvno 3, encryption type Triple
DES cbc mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5.keytab.
Entry for principal host/jupiter.example.com with kvno 3, encryption type DES
cbc mode with CRC-32 added to keytab WRFILE:/etc/krb5.keytab.
kadmin:</pre></div><p>
    When completed, make sure that you destroy the admin ticket obtained
    with kinit above with <code class="command">kdestroy</code>.
   </p></section><section class="sect2" id="sec-security-kerberos-admin-pam" data-id-title="Enabling PAM Support for Kerberos"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.9 </span><span class="title-name">Enabling PAM Support for Kerberos</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-pam">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.4.6.7.12.2" data-id-title="Incomplete Configuration Locks Users Out" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning: Incomplete Configuration Locks Users Out</div><p>
     An incomplete Kerberos configuration may completely lock you out of
     your system, including the root user. To prevent this, add the
     <code class="option">ignore_unknown_principals</code> directive to the
     <code class="option">pam_krb5</code> module <span class="emphasis"><em>after</em></span> you
     have added the <code class="option">pam_krb5</code> module to the existing
     PAM configuration files as described below.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">pam-config --add --krb5-ignore_unknown_principals</code></pre></div><p>
     This will direct the <code class="option">pam_krb5</code> module to ignore
     some errors that would otherwise cause the account phase to fail.
    </p></div><p>
    <span class="productname"><span class="phrase">SUSE® Linux Enterprise Server</span></span> comes with a PAM module named
    <code class="option">pam_krb5</code>, which supports Kerberos login and
    password update. This module can be used by applications such as console
    login, <code class="command">su</code>, and graphical login applications like GDM.
    That is, it can be used in all cases where the user enters a password
    and expects the authenticating application to obtain an initial Kerberos
    ticket on their behalf. To configure PAM support for Kerberos, use the
    following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">pam-config --add --krb5</code></pre></div><p>
    The above command adds the <code class="option">pam_krb5</code> module to the
    existing PAM configuration files and makes sure it is called in the
    right order. To make precise adjustments to the way in which
    <code class="option">pam_krb5</code> is used, edit the file
    <code class="filename">/etc/krb5.conf</code> and add default applications to
    PAM. For details, refer to the manual page with
    <code class="command">man 5 pam_krb5</code>.
   </p><p>
    The <code class="option">pam_krb5</code> module was specifically not designed
    for network services that accept Kerberos tickets as part of user
    authentication. This is an entirely different matter, and is
    discussed below.
   </p></section><section class="sect2" id="sec-security-kerberos-admin-sshd" data-id-title="Configuring SSH for Kerberos Authentication"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.10 </span><span class="title-name">Configuring SSH for Kerberos Authentication</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-sshd">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    OpenSSH supports Kerberos authentication in both protocol
    version 1 and 2. In version 1, there are special
    protocol messages to transmit Kerberos tickets. Version 2 does
    not use Kerberos directly anymore, but relies on GSSAPI, the General
    Security Services API. This is a programming interface that is not
    specific to Kerberos—it was designed to hide the peculiarities
    of the underlying authentication system, be it Kerberos, a public-key
    authentication system like SPKM, or others. However, the included GSSAPI
    library only supports Kerberos.
   </p><p>
    To use sshd with Kerberos authentication, edit
    <code class="filename">/etc/ssh/sshd_config</code> and set the following options:
   </p><div class="verbatim-wrap"><pre class="screen"># These are for protocol version 1
#
# KerberosAuthentication yes
# KerberosTicketCleanup yes

# These are for version 2 - better to use this
GSSAPIAuthentication yes
GSSAPICleanupCredentials yes</pre></div><p>
    Then restart your SSH daemon using <code class="command">sudo systemctl restart
    sshd</code>.
   </p><p>
    To use Kerberos authentication with protocol version 2, enable it on the
    client side as well. Do this either in the systemwide configuration file
    <code class="filename">/etc/ssh/ssh_config</code> or on a per-user level by
    editing <code class="filename">~/.ssh/config</code>. In both cases, add the
    option <code class="literal">GSSAPIAuthentication yes</code>.
   </p><p>
    You should now be able to connect using Kerberos authentication. Use
    <code class="command">klist</code> to verify that you have a valid ticket, then
    connect to the SSH server. To force SSH protocol version 1, specify the
    <code class="literal">-1</code> option on the command line.
   </p><div id="id-1.7.4.6.7.13.8" data-id-title="Additional Information" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Additional Information</div><p>
     The file
     <code class="filename">/usr/share/doc/packages/openssh/README.kerberos</code>
     discusses the interaction of OpenSSH and Kerberos in more detail.
    </p></div><div id="id-1.7.4.6.7.13.9" data-id-title="Additional Directives for Protocol Version 2" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Additional Directives for Protocol Version 2</div><p>
     The <code class="literal">GSSAPIKeyExchange</code> mechanism (RFC 4462) is
     supported. This directive specifies how host keys are exchanged. For
     more information, see the sshd_config manual page (<code class="command">man
     sshd_config</code>).
    </p></div></section><section class="sect2" id="sec-security-kerberos-admin-ldap" data-id-title="Using LDAP and Kerberos"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.5.11 </span><span class="title-name">Using LDAP and Kerberos</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-ldap">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When using Kerberos, one way to distribute the user information (such as
    user ID, groups, and home directory) in your local network is to use
    LDAP. This requires a strong authentication mechanism that prevents
    packet spoofing and other attacks. One solution is to use Kerberos for
    LDAP communication, too.
   </p><p>
    OpenLDAP implements most authentication flavors through SASL, the simple
    authentication session layer. SASL is a network protocol designed for
    authentication. The SASL implementation is cyrus-sasl, which supports
    several authentication flavors. Kerberos authentication is
    performed through GSSAPI (General Security Services API). By default,
    the SASL plug-in for GSSAPI is not installed. Install the
    <code class="systemitem">cyrus-sasl-gssapi</code> with YaST.
   </p><p>
    To enable Kerberos to bind to the OpenLDAP server, create a principal
    <code class="literal">ldap/ldap.example.com</code> and add that to the keytab.
   </p><p>
    By default, the LDAP server slapd runs as user and group
    <code class="systemitem">ldap</code>, while the keytab file is
    readable by <code class="systemitem">root</code> only.
    Therefore, either change the LDAP configuration so the server runs as
    <code class="systemitem">root</code> or make the keytab file
    readable by the group <code class="systemitem">ldap</code>.
    The latter is done automatically by the OpenLDAP start script
    (<code class="filename">/usr/lib/openldap/start</code>) if the keytab file has
    been specified in the <code class="envar">OPENLDAP_KRB5_KEYTAB</code> variable in
    <code class="filename">/etc/sysconfig/openldap</code> and the
    <code class="envar">OPENLDAP_CHOWN_DIRS</code> variable is set to
    <code class="literal">yes</code>, which is the default setting. If
    <code class="envar">OPENLDAP_KRB5_KEYTAB</code> is left empty, the default keytab
    under <code class="filename">/etc/krb5.keytab</code> is used and you must adjust
    the privileges yourself as described below.
   </p><p>
    To run slapd as <code class="systemitem">root</code>, edit
    <code class="filename">/etc/sysconfig/openldap</code>. Disable the
    <code class="systemitem">OPENLDAP_USER</code> and
    <code class="systemitem">OPENLDAP_GROUP</code> variables by putting a comment
    character in front of them.
   </p><p>
    To make the keytab file readable by group LDAP, execute
   </p><div class="verbatim-wrap"><pre class="screen">chgrp ldap /etc/krb5.keytab
chmod 640 /etc/krb5.keytab</pre></div><p>
    A third (and maybe the best) solution is to tell OpenLDAP to use a
    special keytab file. To do this, start kadmin, and enter the following
    command after you have added the principal ldap/ldap.example.com:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ktadd -k /etc/openldap/ldap.keytab ldap/ldap.example.com@EXAMPLE.COM</pre></div><p>
    Then in the shell run:
   </p><div class="verbatim-wrap"><pre class="screen">chown ldap.ldap /etc/openldap/ldap.keytab
chmod 600 /etc/openldap/ldap.keytab</pre></div><p>
    To tell OpenLDAP to use a different keytab file, change the following
    variable in <code class="filename">/etc/sysconfig/openldap</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPENLDAP_KRB5_KEYTAB="/etc/openldap/ldap.keytab"</pre></div><p> Finally, restart the LDAP server using <code class="command">sudo systemctl
     restart slapd</code>. </p><section class="sect3" id="sec-security-kerberos-admin-ldap-auth" data-id-title="Using Kerberos Authentication with LDAP"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">6.5.11.1 </span><span class="title-name">Using Kerberos Authentication with LDAP</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-ldap-auth">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You are now able to automatically use tools such as ldapsearch with
     Kerberos authentication.
    </p><div class="verbatim-wrap"><pre class="screen">ldapsearch -b ou=people,dc=example,dc=com '(uid=suzanne)'

SASL/GSSAPI authentication started
SASL SSF: 56
SASL installing layers
[...]

# suzanne, people, example.com
dn: uid=suzanne,ou=people,dc=example,dc=com
uid: suzanne
cn: Suzanne Geeko
[...]</pre></div><p>
     As you can see, <code class="command">ldapsearch</code> prints a message that it
     started GSSAPI authentication. The next message is very cryptic, but it
     shows that the <span class="emphasis"><em>security strength factor</em></span> (SSF for
     short) is 56 (The value 56 is somewhat arbitrary. Most likely it was
     chosen because this is the number of bits in a DES encryption key).
     This means that GSSAPI authentication was successful and that
     encryption is being used to protect integrity and provide
     confidentiality for the LDAP connection.
    </p><p>
     In Kerberos, authentication is always mutual. This means that not only
     have you authenticated yourself to the LDAP server, but also the LDAP
     server has authenticated itself to you. In particular, this means
     communication is with the desired LDAP server, rather than some bogus
     service set up by an attacker.
     
    </p></section><section class="sect3" id="sec-security-kerberos-admin-ldap-acl" data-id-title="Kerberos Authentication and LDAP Access Control"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">6.5.11.2 </span><span class="title-name">Kerberos Authentication and LDAP Access Control</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-admin-ldap-acl">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     There is one minor piece of the puzzle missing—how the LDAP
     server can find out that the Kerberos user
     <code class="literal">tux@EXAMPLE.COM</code> corresponds to the LDAP
     distinguished name
     <code class="literal">uid=tux,ou=people,dc=example,dc=com</code>.
     This sort of mapping must be configured manually using the
     <code class="literal">saslExpr</code> directive. In this example, the
     "authz-regexp" change in LDIF would look as follows:
    </p><div class="verbatim-wrap"><pre class="screen">dn: cn=config
add: olcAuthzRegexp
olcAuthzRegexp: uid=(.*),cn=GSSAPI,cn=auth uid=$1,ou=people,dc=example,dc=com</pre></div><p>
     All these changes can be applied via <code class="command">ldapmodify</code> on
     the command line.
    </p><p>
     When SASL authenticates a user, OpenLDAP forms a distinguished name
     from the name given to it by SASL (such as <code class="systemitem">tux</code>) and the
     name of the SASL flavor (<code class="literal">GSSAPI</code>). The result
     would be
     <code class="literal">uid=tux,cn=GSSAPI,cn=auth</code>.
    </p><p>
     If a <code class="literal">authz-regexp</code> has been configured, it checks the
     DN formed from the SASL information using the first argument as a
     regular expression. If this regular expression matches, the name is
     replaced with the second argument of the
     <code class="literal">authz-regexp</code> statement. The placeholder
     <code class="literal">$1</code> is replaced with the substring matched by the
     <code class="literal">(.*)</code> expression.
    </p><p>
     More complicated match expressions are possible. If you have a more
     complicated directory structure or a schema in which the user name is
     not part of the DN, you can even use search expressions to map the SASL
     DN to the user DN.
    </p><p>
     For more information, see the <code class="literal">slapd-config</code> man page.
    </p></section></section></section><section class="sect1" id="sec-security-kerberos-yast-client" data-id-title="Setting up Kerberos using LDAP and Kerberos Client"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.6 </span><span class="title-name">Setting up Kerberos using <span class="guimenu">LDAP and Kerberos Client</span></span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-yast-client">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   YaST includes the module <span class="guimenu">LDAP and Kerberos Client</span>
   that helps define authentication scenarios involving either LDAP or Kerberos.
  </p><p>
   It can also be used to join Kerberos and LDAP separately. However, in
   many such cases, using this module may not be the first choice, such as
   for joining Active Directory (which uses a combination of LDAP and Kerberos). For
   more information, see <a class="xref" href="cha-security-auth.html#sec-security-auth-yast-client" title="4.2. Configuring an Authentication Client with YaST">Section 4.2, “Configuring an Authentication Client with YaST”</a>.
  </p><p>
   Start the module by selecting
   <span class="guimenu">Network Services</span> › <span class="guimenu">LDAP and
   Kerberos Client</span>.
  </p><div class="figure" id="fig-yast2-ldapkerberos-kerberos"><div class="figure-contents"><div class="mediaobject"><a href="images/yast2_auth_client_config.png"><img src="images/yast2_auth_client_config.png" width="65%" alt="LDAP and Kerberos Client Window" title="LDAP and Kerberos Client Window"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 6.2: </span><span class="title-name"><span class="guimenu">LDAP and Kerberos Client</span> Window </span></span><a title="Permalink" class="permalink" href="cha-security-kerberos.html#fig-yast2-ldapkerberos-kerberos">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div><p>
   To configure a Kerberos client, follow the procedure below:
  </p><div class="procedure" id="pro-security-auth-kerberos"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     In the window <span class="guimenu">LDAP and Kerberos Client</span>, click
     <span class="guimenu">Change Settings</span>.
    </p><p>
     Choose the tab <span class="guimenu">Authentication via Kerberos</span>.
    </p><div class="informalfigure"><div class="mediaobject"><a href="images/yast2_auth_client_krb5.png"><img src="images/yast2_auth_client_krb5.png" width="65%" alt="Tab Authentication via Kerberos" title="Tab Authentication via Kerberos"/></a></div></div></li><li class="step" id="st-kerberos-realm-add"><p>
     Click <span class="guimenu">Add Realm</span>.
    </p></li><li class="step" id="st-kerberos-realm-configure"><p>
     In the appearing dialog, specify the correct
     <span class="guimenu">Realm name</span>. Usually, the realm name is an uppercase
     version of the domain name. Additionally, you can specify the following:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       To apply mappings from the realm name to the domain name, activate
       <span class="guimenu">Map Domain Name to the Realm</span> and/or
       <span class="guimenu">Map Wildcard Domain Name to the Realm</span>.
      </p></li><li class="listitem"><p>
       You can specify the <span class="guimenu">Host Name of Administration
       Server</span>, the <span class="guimenu">Host Name of Master Key Distribution
       Server</span> and additional <span class="guimenu">Key Distribution Centers</span>.
      </p><p>
       All of these items are optional if they can be automatically
       discovered via the <code class="literal">SRV</code> and
       <code class="literal">TXT</code> records in DNS.
      </p></li><li class="listitem"><p>
       To manually map Principals to local user names, use
       <span class="guimenu">Custom Mappings of Principal Names to User Names</span>.
      </p><p>
       You can also use <code class="literal">auth_to_local</code> rules to supply such
       mappings using <span class="guimenu">Custom Rules for Mapping Principal Names to
       User Names</span>. For more information about using such rules, see
       the official documentation at
       <a class="link" href="https://web.mit.edu/kerberos/krb5-current/doc/admin/conf_files/krb5_conf.html#realms" target="_blank">https://web.mit.edu/kerberos/krb5-current/doc/admin/conf_files/krb5_conf.html#realms</a>.
      </p></li></ul></div><p>
     Continue with <span class="guimenu">OK</span>.
    </p></li><li class="step"><p>
     To add more realms, repeat from <a class="xref" href="cha-security-kerberos.html#st-kerberos-realm-add" title="Step 2">Step 2</a>.
    </p></li><li class="step"><p>
     Enable Kerberos users logging in and creation of home directories by
     activating
     <span class="guimenu">Allow Kerberos Users to Authenticate</span> and
     <span class="guimenu">Automatically Create Home Directory</span>.
    </p></li><li class="step"><p>
     If you left empty the optional text boxes in
     <a class="xref" href="cha-security-kerberos.html#st-kerberos-realm-configure" title="Step 3">Step 3</a>, make sure to enable
     automatic discovery of realms and key distribution centers by activating
     <span class="guimenu">Use DNS TXT Record to Discover Realms</span> and
     <span class="guimenu">Use DNS SRV Record to Discover KDC Servers</span>.
    </p></li><li class="step"><p>
     You can additionally activate the following:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <span class="guimenu">Allow Insecure Encryption (for Windows NT)</span> allows
       the encryption types listed as weak at
       <a class="link" href="https://web.mit.edu/kerberos/krb5-current/doc/admin/conf_files/kdc_conf.html#encryption-types" target="_blank">https://web.mit.edu/kerberos/krb5-current/doc/admin/conf_files/kdc_conf.html#encryption-types</a>.
      </p></li><li class="listitem"><p>
       <span class="guimenu">Allow KDC on Other Networks to Issue Authentication
       Tickets</span> allows forwarding of tickets.
      </p></li><li class="listitem"><p>
       <span class="guimenu">Allow Kerberos-Enabled Services to Take on The Identity Of a
       User</span> allows the use of proxies between the computer of the
       user and the key distribution center.
      </p></li><li class="listitem"><p>
       <span class="guimenu">Issue Address-Less Tickets for Computers Behind
       NAT</span> allows granting tickets to users behind networks using
       network address translation.
      </p></li></ul></div></li><li class="step"><p>
     To set up allowed encryption types and define the name of the keytab
     file which lists the names of principals and their encrypted keys, use
     the <span class="guimenu">Extended Options</span>.
    </p></li><li class="step"><p>
     Finish with <span class="guimenu">OK</span> and <span class="guimenu">Finish</span>.
    </p><p>
     YaST may now install extra packages.
    </p></li></ol></div></div></section><section class="sect1" id="sec-security-kerberos-nfs" data-id-title="Kerberos and NFS"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.7 </span><span class="title-name">Kerberos and NFS</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-nfs">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Most NFS servers can export file systems using any combination of
   the default "trust the network" form of security, known as
   <code class="option">sec=sys</code>, and three different levels of Kerberos-based
   security, <code class="option">sec=krb5</code>, <code class="option">sec=krb5i</code> and
   <code class="option">sec=krb5p</code>. The <code class="option">sec</code> option is set
   as a mount option on the client. It is often the case that the NFS
   service will first be configured and used with
   <code class="option">sec=sys</code>, and then Kerberos can be imposed afterwards.
   In this case it is likely that the server will be configured to
   support both <code class="option">sec=sys</code> and one of the Kerberos levels,
   and then after all clients have transitioned, the
   <code class="option">sec=sys</code> support will be removed, thus achieving
   true security. The transition to Kerberos should be fairly transparent
   if done in an orderly manner. However there is one subtle detail of
   NFS behavior that works differently when Kerberos is used, and the
   implications of this need to be understood and possibly addressed.
   See <a class="xref" href="cha-security-kerberos.html#sec-security-kerberos-overview-group" title="6.7.1. Group Membership">Section 6.7.1, “Group Membership”</a>.
  </p><p>
   The three Kerberos levels indicate different levels of security. With
   more security comes a need for more processor power to encrypt and
   decrypt messages. Choosing the right balance is an important
   consideration that should go in to planning a roll-out of Kerberos for
   NFS.
  </p><p>
   <code class="literal">krb5</code> provides only authentication. The server
   can know who sent a request, and the client can know that the
   server did send a reply. No security is provided for the content of
   the request or reply so an attacker with physical network access
   could transform the request or reply, or both, in arbitrary ways to
   deceive either server or client. They cannot directly read or
   change any file that the authenticated user could not read or
   change, but almost anything is theoretically
  possible.
  </p><p>
   <code class="literal">krb5i</code> adds integrity checks to all messages.
   With <code class="literal">krb5i</code>, an attacker cannot modify any
   request or reply, but they can view all the data exchanged, and so
   could discover the content of any file that is read.
  </p><p>
   <code class="literal">krb5p</code> adds privacy to the protocol. As well as
   reliable authentication and integrity checking, messages are fully
   encrypted so an attacker can only know that messages were exchanged
   between client and server, and cannot extract other information
   directly from the message. Whether information can be extracted
   from message timing is a separate question that Kerberos does not
   address.
  </p><section class="sect2" id="sec-security-kerberos-overview-group" data-id-title="Group Membership"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.7.1 </span><span class="title-name">Group Membership</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-overview-group">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The one behavioral difference between <code class="option">sec=sys</code> and
    the various Kerberos security levels that might be visible is related
    to group membership. In Unix and Linux, each file system access
    comes from a process that is owned by a particular user and has a
    particular group owner and a number of supplemental groups. Access
    rights to files can vary based on the owner and the various groups.
   </p><p>
    With <code class="option">sec=sys</code>, the user-id, group-id, and a list of
    up to 16 supplemental groups are sent to the server in each
    request.
   </p><p>
    If a user is a member of more than 16 supplemental groups, the
    extra groups are lost and some files may not be accessible over NFS
    that the user would normally expect to have access to. For this
    reason, most sites that use NFS find a way to limit all users to at
    most 16 supplemental groups.
   </p><p>
    If the user runs the <code class="command">newgrp</code> command or runs a
    set-group-id program, either of which can change the list of groups
    they are a member of, these changes take effect immediately and
    provide different accesses over NFS.
   </p><p>
    With Kerberos, group information is not sent in requests at all. Only
    the user is identified (using a Kerberos "Principal"), and the server
    performs a lookup to determine the user ID and group list for that
    principal. This means that if the user is a member of more than 16
    groups, all of these group memberships will be used in determining
    file access permissions. However it also means that if the user
    changes a group-id on the client in some way, the server will not
    notice the change and will not take that into account in
    determining access rights.
   </p><p>
    Is most cases, the improvement of having access to more groups
    brings a real benefit, and the loss of not being able to change
    groups is not noticed as it is not widely used. A site
    administrator considering the use of Kerberos should be aware of the
    difference though and ensure that it will not actually cause
    problems.
   </p></section><section class="sect2" id="sec-security-kerberos-overview-performance" data-id-title="Performance and Scalability"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.7.2 </span><span class="title-name">Performance and Scalability</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-overview-performance">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Using Kerberos for security requires extra CPU power for encrypting
    and decrypting messages. How much extra CPU power is required and
    whether the difference is noticeable will vary with different
    hardware and different applications. If the server or client are
    already saturating the available CPU power, it is likely that a
    performance drop will be measurable when switching from sec=sys to
    Kerberos. If there is spare CPU capacity available, it is quite
    possible that the transition will not result in any throughput
    change. The only way to be sure how much impact the use of Kerberos
    will have is to test your load on your hardware.
   </p><p>
    The only configuration options that might reduce the load will also
    reduce the quality of the protection offered.
    <code class="option">sec=krb5</code> should produce noticeably less load than
    <code class="option">sec=krb5p</code> but, as discussed above, it doesn't
    produce very strong security. Similarly it is possible to adjust
    the list of cyphers that Kerberos can choose from, and this might
    change the CPU requirement. However the defaults are carefully
    chosen and should not be changed without similar careful
    consideration.
   </p><p>
    The other possible performance issue when configuring NFS to use
    Kerberos involves availability of the Kerberos authentication servers,
    known as the KDC or Key Distribution Center.
   </p><p>
    The use of NFS adds load to such servers to the same degree that
    adding the use of Kerberos for any other services adds some load.
    Every time a given user (Kerberos principal) establishes a
    session with a service, for example by accessing files
    exported by a particular NFS server, the client needs to negotiate
    with the KDC. Once a session key has been negotiated, the client
    server can communicate without further help for many hours,
    depending on details of the Kerberos configuration, particularly the
    <code class="option">ticket_lifetime</code> setting.
   </p><p>
    The concerns most likely to affect the provisioning of Kerberos KDC
    servers are availability and peak usage.
   </p><p>
    As with other core services such as DNS, LDAP or similar
    name-lookup services, having two servers that are reasonably
    "close" to every client provides good availability for modest
    resources. Kerberos allows for multiple KDC servers with flexible
    models for database propagation, so distributing servers as needed
    around campuses, buildings, and even cabinets is fairly straight
    forward. The best mechanism to ensure each client finds a nearby
    Kerberos server is to use split-horizon DNS with each building (or
    similar) getting different details from the DNS server. If this is
    not possible, then managing the <code class="filename">/etc/krb5.conf</code>
    file to be different at different locations is a suitable
    alternative.
   </p><p>
    As access to the Kerberos KDC is infrequent, load is only likely to be
    a problem at peak times. If thousands of people all log in between
    9:00 and 9:05, then the servers will receive many more
    requests-per-minute than they might in the middle of the night. The
    load on the Kerberos server is likely to be more than that on an LDAP
    server, but not orders of magnitude more. A sensible guideline is
    to provision Kerberos replicas in the same manner that you provision
    LDAP replicas, and then monitor performance to determine if demand
    ever exceeds capacity.
   </p></section><section class="sect2" id="sec-security-kerberos-overview-kdc" data-id-title="Master KDC, Multiple Domains, and Trust Relationships"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">6.7.3 </span><span class="title-name">Master KDC, Multiple Domains, and Trust Relationships</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-overview-kdc">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    One service of the Kerberos KDC that is not easily distributed is
    the handling of updates, such as password changes and new user
    creation. These must happen at a single master KDC.
   </p><p>
    These updates are not likely to happen with such frequency that any
    significant load will be generated, but availability could be an
    issue. It can be annoying if you want to create a new user or change
    a password, and the master KDC on the other side of the world is
    temporarily unavailable.
   </p><p>
    When an organization is geographically distributed and has a policy
    of handling administration tasks locally at each site, it can be
    beneficial to create multiple Kerberos domains, one for each
    administrative center. Each domain would then have its own master
    KDC which would be geographically local. Users in one domain can
    still get access to resources in another domain by setting up trust
    relationships between domains.
   </p><p>
    The easiest arrangement for multiple domains is to have a global
    domain (such as <code class="systemitem">EXAMPLE.COM</code>
    and various local domains (such as <code class="systemitem">ASIA.EXAMPLE.COM</code>, <code class="systemitem">EUROPE.EXAMPLE.COM</code>, etc). If the global
    domain is configured to trust each local domain, and each local domain is
    configured to trust the global domain, then fully transitive trust
    is available between any pair of domains, and any principal can
    establish a secure connection with any service. Ensuring
    appropriate access rights to resources, for example files, provided
    by that service will be dependent on the user name lookup service
    used, and the functionality of the NFS file server, and is beyond
    the scope of this document.
   </p></section></section><section class="sect1" id="sec-security-kerberos-info" data-id-title="For More Information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">6.8 </span><span class="title-name">For More Information</span></span> <a title="Permalink" class="permalink" href="cha-security-kerberos.html#sec-security-kerberos-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/maintenance/SLE12SP5/xml/security_kerberos.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The official site of MIT Kerberos is
   <a class="link" href="https://web.mit.edu/kerberos" target="_blank">https://web.mit.edu/kerberos</a>. There, find links to
   any other relevant resource concerning Kerberos, including Kerberos
   installation, user, and administration guides.
  </p><p>
   The book <span class="emphasis"><em>Kerberos—A Network Authentication
   System</em></span> by Brian Tung (ISBN 0-201-37924-4) offers extensive
   information.
  </p></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-security-ldap.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 5 </span>LDAP—A Directory Service</span></a> </div><div><a class="pagination-link next" href="cha-security-ad.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 7 </span>Active Directory Support</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-security-kerberos.html#sec-security-kerberos-overview"><span class="title-number">6.1 </span><span class="title-name">Conceptual Overview</span></a></span></li><li><span class="sect1"><a href="cha-security-kerberos.html#sec-security-kerberos-terms"><span class="title-number">6.2 </span><span class="title-name">Kerberos Terminology</span></a></span></li><li><span class="sect1"><a href="cha-security-kerberos.html#sec-security-kerberos-how"><span class="title-number">6.3 </span><span class="title-name">How Kerberos Works</span></a></span></li><li><span class="sect1"><a href="cha-security-kerberos.html#sec-security-kerberos-users"><span class="title-number">6.4 </span><span class="title-name">User View of Kerberos</span></a></span></li><li><span class="sect1"><a href="cha-security-kerberos.html#sec-security-kerberos-admin"><span class="title-number">6.5 </span><span class="title-name">Installing and Administering Kerberos</span></a></span></li><li><span class="sect1"><a href="cha-security-kerberos.html#sec-security-kerberos-yast-client"><span class="title-number">6.6 </span><span class="title-name">Setting up Kerberos using <span class="guimenu">LDAP and Kerberos Client</span></span></a></span></li><li><span class="sect1"><a href="cha-security-kerberos.html#sec-security-kerberos-nfs"><span class="title-number">6.7 </span><span class="title-name">Kerberos and NFS</span></a></span></li><li><span class="sect1"><a href="cha-security-kerberos.html#sec-security-kerberos-info"><span class="title-number">6.8 </span><span class="title-name">For More Information</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>