<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Combining ERB templates and scripts | AutoYaST Guide | openSUSE Leap 15.7</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" />
<meta name="title" content="Combining ERB templates and scripts | openSUSE Leap 15…" />
<meta name="description" content="Section 4.31.1, “Pre-scripts” already describes how to use a pre-script to modify the current profile. In a nutshell, if the script creates a /tmp/profile/modi…" />
<meta name="product-name" content="openSUSE Leap" />
<meta name="product-number" content="15.7" />
<meta name="book-title" content="AutoYaST Guide" />
<meta name="chapter-title" content="Chapter 8. Combining ERB templates and scripts" />
<meta name="tracker-url" content="https://bugzilla.opensuse.org/enter_bug.cgi" />
<meta name="tracker-type" content="bsc" />
<meta name="tracker-bsc-assignee" content="fs@suse.com" />
<meta name="tracker-bsc-component" content="Documentation" />
<meta name="tracker-bsc-product" content="openSUSE Distribution" />
<meta name="tracker-bsc-version" content="Leap 15.4" />
<meta property="og:title" content="Combining ERB templates and scripts | openSUSE Leap 15…" />
<meta property="og:description" content="Section 4.31.1, “Pre-scripts” already describes how to use a pre-script to modify the current profile. In a nutshell, if the script creates a /tmp/profile/modi…" />
<meta property="og:type" content="article" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Combining ERB templates and scripts | openSUSE Leap 15…" />
<meta name="twitter:description" content="Section 4.31.1, “Pre-scripts” already describes how to use a pre-script to modify the current profile. In a nutshell, if the script creates a /tmp/profile/modi…" />
<link rel="home" href="index.html" title="openSUSE Leap Documentation" /><link rel="up" href="part-dynamic-profiles.html" title="Part III. Managing mass installations with dynamic profiles" /><link rel="prev" href="erb-templates.html" title="Chapter 7. ERB templates" /><link rel="next" href="bk07pt04.html" title="Part IV. Understanding the auto-installation process" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" /></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #E11;"><div id="_header"><div id="_logo"><img src="static/images/logo.svg" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="AutoYaST Guide"><span class="book-icon">AutoYaST Guide</span></a><span> › </span><a class="crumb" href="part-dynamic-profiles.html">Managing mass installations with dynamic profiles</a><span> › </span><a class="crumb" href="pre-scripts.html">Combining ERB templates and scripts</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>AutoYaST Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="ay-preface.html"><span class="number"> </span><span class="name">Preface</span></a></li><li class="inactive"><a href="cha-intro-to-autoyast.html"><span class="number">1 </span><span class="name">Introduction to AutoYaST</span></a></li><li class="inactive"><a href="part-control.html"><span class="number">I </span><span class="name">Understanding and creating the AutoYaST control file</span></a><ol><li class="inactive"><a href="cha-autoyast-control-file.html"><span class="number">2 </span><span class="name">The AutoYaST control file</span></a></li><li class="inactive"><a href="cha-autoyast-create-control-file.html"><span class="number">3 </span><span class="name">Creating an AutoYaST control file</span></a></li></ol></li><li class="inactive"><a href="part-configuration.html"><span class="number">II </span><span class="name">AutoYaST configuration examples</span></a><ol><li class="inactive"><a href="cha-configuration-installation-options.html"><span class="number">4 </span><span class="name">Configuration and installation options</span></a></li></ol></li><li class="inactive"><a href="part-dynamic-profiles.html"><span class="number">III </span><span class="name">Managing mass installations with dynamic profiles</span></a><ol><li class="inactive"><a href="dynamic-profiles.html"><span class="number">5 </span><span class="name">Supported approaches to dynamic profiles</span></a></li><li class="inactive"><a href="rulesandclass.html"><span class="number">6 </span><span class="name">Rules and classes</span></a></li><li class="inactive"><a href="erb-templates.html"><span class="number">7 </span><span class="name">ERB templates</span></a></li><li class="inactive"><a href="pre-scripts.html"><span class="number">8 </span><span class="name">Combining ERB templates and scripts</span></a></li></ol></li><li class="inactive"><a href="bk07pt04.html"><span class="number">IV </span><span class="name">Understanding the auto-installation process</span></a><ol><li class="inactive"><a href="Invoking.html"><span class="number">9 </span><span class="name">The auto-installation process</span></a></li></ol></li><li class="inactive"><a href="bk07pt05.html"><span class="number">V </span><span class="name">Uses for AutoYaST on installed systems</span></a><ol><li class="inactive"><a href="InstalledSystem.html"><span class="number">10 </span><span class="name">Running AutoYaST in an installed system</span></a></li></ol></li><li class="inactive"><a href="bk07pt06.html"><span class="number">VI </span><span class="name">Appendixes</span></a><ol><li class="inactive"><a href="handlingrules.html"><span class="number">A </span><span class="name">Handling rules</span></a></li><li class="inactive"><a href="app-ay-faq.html"><span class="number">B </span><span class="name">AutoYaST FAQ—frequently asked questions</span></a></li><li class="inactive"><a href="appendix-linuxrc.html"><span class="number">C </span><span class="name">Advanced <code class="command">linuxrc</code> options</span></a></li><li class="inactive"><a href="bk07pt06apd.html"><span class="number">D </span><span class="name">GNU licenses</span></a></li></ol></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 7. ERB templates" href="erb-templates.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Part IV. Understanding the auto-installation process" href="bk07pt04.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #E11;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="AutoYaST Guide"><span class="book-icon">AutoYaST Guide</span></a><span> › </span><a class="crumb" href="part-dynamic-profiles.html">Managing mass installations with dynamic profiles</a><span> › </span><a class="crumb" href="pre-scripts.html">Combining ERB templates and scripts</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 7. ERB templates" href="erb-templates.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Part IV. Understanding the auto-installation process" href="bk07pt04.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="pre-scripts"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname "><span class="productname"><span class="phrase">openSUSE Leap</span></span></span> <span class="productnumber "><span class="productnumber"><span class="phrase">15.7</span></span></span></div><div><h2 class="title"><span class="number">8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Combining ERB templates and scripts</span> <a title="Permalink" class="permalink" href="pre-scripts.html#">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/ay_pre_scripts.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>ay_pre_scripts.xml</li><li><span class="ds-label">ID: </span>pre-scripts</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="pre-scripts.html#erb-and-scripts"><span class="number">8.1 </span><span class="name">Embedding ERB in your scripts</span></a></span></dt><dt><span class="sect1"><a href="pre-scripts.html#erb-helpers-in-scripts"><span class="number">8.2 </span><span class="name">Accessing ERB helpers from Ruby scripts</span></a></span></dt></dl></div></div><p>
  <a class="xref" href="cha-configuration-installation-options.html#pre-install-scripts" title="4.31.1. Pre-scripts">Section 4.31.1, “Pre-scripts”</a> already describes how to use a
  pre-script to modify the current profile. In a nutshell, if the script
  creates a <code class="filename">/tmp/profile/modified.xml</code> file, AutoYaST imports
  that profile and forgets about the initial one.
 </p><p>
  This is a pretty flexible approach and the only limitation is that you need
  to rely on the languages and libraries that are available in the installation
  media.
 </p><div class="sect1 " id="erb-and-scripts"><div class="titlepage"><div><div><h2 class="title"><span class="number">8.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Embedding ERB in your scripts</span> <a title="Permalink" class="permalink" href="pre-scripts.html#erb-and-scripts">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/ay_pre_scripts.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>ay_pre_scripts.xml</li><li><span class="ds-label">ID: </span>erb-and-scripts</li></ul></div></div></div></div><p>
   Unlike with <span class="emphasis"><em>rules</em></span>, it is possible to combine ERB
   templates with scripts. AutoYaST will evaluate any ERB tag that you include in
   your script before running it. This behavior only applies to the scripts
   defined inside the profile and not to the external ones.
  </p><p>
   The script in the example below downloads a profile whose name is based on
   the MAC address. Saving the file as
   <code class="filename">/tmp/profile/modified.xml</code> will cause AutoYaST to load and
   use the downloaded profile.
  </p><div class="example" id="combining-erb-and-scripts"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 8.1: </span><span class="name">Using the MAC address to get the profile </span><a title="Permalink" class="permalink" href="pre-scripts.html#combining-erb-and-scripts">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">&lt;scripts&gt;
  &lt;pre-scripts config:type="list"&gt;
    &lt;script&gt;
      &lt;interpreter&gt;shell&lt;/interpreter&gt;
      &lt;filename&gt;load_profile.sh&lt;/filename&gt;
      &lt;% mac = network_cards.first &gt;
      &lt;source&gt;&lt;![CDATA[#!/bin/bash
wget -O /tmp/profile/modified.xml http://myserver/&lt;%= network_cards.first[:mac] %&gt;.xml
]]&gt;&lt;/source&gt;
    &lt;/script&gt;
  &lt;/pre-scripts&gt;
&lt;/scripts&gt;</pre></div></div></div></div><div class="sect1 " id="erb-helpers-in-scripts"><div class="titlepage"><div><div><h2 class="title"><span class="number">8.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Accessing ERB helpers from Ruby scripts</span> <a title="Permalink" class="permalink" href="pre-scripts.html#erb-helpers-in-scripts">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/ay_pre_scripts.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>ay_pre_scripts.xml</li><li><span class="ds-label">ID: </span>erb-helpers-in-scripts</li></ul></div></div></div></div><p>
   It is possible to use the ERB helpers in Ruby scripts. To use those helpers,
   you need to <span class="emphasis"><em>require</em></span> the <code class="filename">yast</code> and
   <code class="filename">autoinstall/y2erb</code> libraries and use the
   <code class="literal">Y2Autoinstall::Y2ERB::TemplateEnvironment</code> class to access
   them.
  </p><div class="example" id="ruby-script-erb-helpers"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 8.2: </span><span class="name">Accessing ERB helpers from a Ruby script </span><a title="Permalink" class="permalink" href="pre-scripts.html#ruby-script-erb-helpers">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">&lt;scripts&gt;
  &lt;pre-scripts config:type="list"&gt;
    &lt;script&gt;
      &lt;interpreter&gt;/usr/bin/ruby&lt;/interpreter&gt;
      &lt;filename&gt;load_profile.rb&lt;/filename&gt;
      &lt;source&gt;&lt;![CDATA[#!/usr/bin/env ruby
require "yast"
require "autoinstall/y2erb"
helpers = Y2Autoinstallation::Y2ERB::TemplateEnvironment.new
# Now you can use the TemplateEnvironment instance to call the helpers
disk_devices = helpers.disks.map { |d| d[:device] }
File.write("/root/disks.txt", disk_devices.join("\n"))
]]&gt;&lt;/source&gt;
    &lt;/script&gt;
  &lt;/pre-scripts&gt;
&lt;/scripts&gt;</pre></div></div></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="bk07pt04.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Part IV </span>Understanding the auto-installation process</span></a><a class="nav-link" href="erb-templates.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 7 </span>ERB templates</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2024 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>