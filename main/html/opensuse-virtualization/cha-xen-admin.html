<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Administrative tasks | Virtualization Guide | openSUSE Leap 15.6</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" />
<meta name="title" content="Administrative tasks | openSUSE Leap 15.6" />
<meta name="description" content="" />
<meta name="product-name" content="openSUSE Leap" />
<meta name="product-number" content="15.6" />
<meta name="book-title" content="Virtualization Guide" />
<meta name="chapter-title" content="Chapter 28. Administrative tasks" />
<meta name="tracker-url" content="https://bugzilla.opensuse.org/enter_bug.cgi" />
<meta name="tracker-type" content="bsc" />
<meta name="tracker-bsc-assignee" content="fs@suse.com" />
<meta name="tracker-bsc-component" content="Documentation" />
<meta name="tracker-bsc-product" content="openSUSE Distribution" />
<meta name="tracker-bsc-version" content="Leap 15.4" />
<meta property="og:title" content="Administrative tasks | openSUSE Leap 15.6" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Administrative tasks | openSUSE Leap 15.6" />
<meta name="twitter:description" content="" />
<link rel="home" href="index.html" title="openSUSE Leap Documentation" /><link rel="up" href="part-virt-xen.html" title="Part IV. Managing virtual machines with Xen" /><link rel="prev" href="cha-xen-config.html" title="Chapter 27. Virtualization: configuration options and settings" /><link rel="next" href="cha-xen-xenstore.html" title="Chapter 29. XenStore: configuration database shared between domains" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" /></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #E11;"><div id="_header"><div id="_logo"><img src="static/images/logo.svg" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Virtualization Guide"><span class="book-icon">Virtualization Guide</span></a><span> › </span><a class="crumb" href="part-virt-xen.html">Managing virtual machines with Xen</a><span> › </span><a class="crumb" href="cha-xen-admin.html">Administrative tasks</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Virtualization Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="cha-kvm.html"><span class="number"> </span><span class="name">Preface</span></a></li><li class="inactive"><a href="part-virt-intro.html"><span class="number">I </span><span class="name">Introduction</span></a><ol><li class="inactive"><a href="chap-virtualization-introduction.html"><span class="number">1 </span><span class="name">Virtualization technology</span></a></li><li class="inactive"><a href="cha-virtualization-scenarios.html"><span class="number">2 </span><span class="name">Virtualization scenarios</span></a></li><li class="inactive"><a href="cha-xen-basics.html"><span class="number">3 </span><span class="name">Introduction to Xen virtualization</span></a></li><li class="inactive"><a href="cha-kvm-intro.html"><span class="number">4 </span><span class="name">Introduction to KVM virtualization</span></a></li><li class="inactive"><a href="cha-tools-intro.html"><span class="number">5 </span><span class="name">Virtualization tools</span></a></li><li class="inactive"><a href="cha-vt-installation.html"><span class="number">6 </span><span class="name">Installation of virtualization components</span></a></li></ol></li><li class="inactive"><a href="part-virt-libvirt.html"><span class="number">II </span><span class="name">Managing virtual machines with <code class="systemitem">libvirt</code></span></a><ol><li class="inactive"><a href="cha-libvirt-overview.html"><span class="number">7 </span><span class="name"><code class="systemitem">libvirt</code> daemons</span></a></li><li class="inactive"><a href="cha-libvirt-host.html"><span class="number">8 </span><span class="name">Preparing the VM Host Server</span></a></li><li class="inactive"><a href="cha-kvm-inst.html"><span class="number">9 </span><span class="name">Guest installation</span></a></li><li class="inactive"><a href="cha-libvirt-managing.html"><span class="number">10 </span><span class="name">Basic VM Guest management</span></a></li><li class="inactive"><a href="cha-libvirt-connect.html"><span class="number">11 </span><span class="name">Connecting and authorizing</span></a></li><li class="inactive"><a href="cha-libvirt-storage.html"><span class="number">12 </span><span class="name">Advanced storage topics</span></a></li><li class="inactive"><a href="cha-libvirt-config-gui.html"><span class="number">13 </span><span class="name">Configuring virtual machines with Virtual Machine Manager</span></a></li><li class="inactive"><a href="cha-libvirt-config-virsh.html"><span class="number">14 </span><span class="name">Configuring virtual machines with <code class="command">virsh</code></span></a></li><li class="inactive"><a href="sec-libvirt-admin-migrate.html"><span class="number">15 </span><span class="name">Migrating VM Guests</span></a></li><li class="inactive"><a href="xen2kvm-migration.html"><span class="number">16 </span><span class="name">Xen to KVM migration guide</span></a></li></ol></li><li class="inactive"><a href="part-virt-common.html"><span class="number">III </span><span class="name">Hypervisor-independent features</span></a><ol><li class="inactive"><a href="cha-cachemodes.html"><span class="number">17 </span><span class="name">Disk cache modes</span></a></li><li class="inactive"><a href="sec-kvm-managing-clock.html"><span class="number">18 </span><span class="name">VM Guest clock settings</span></a></li><li class="inactive"><a href="chap-guestfs.html"><span class="number">19 </span><span class="name">libguestfs</span></a></li><li class="inactive"><a href="cha-qemu-ga.html"><span class="number">20 </span><span class="name">QEMU guest agent</span></a></li><li class="inactive"><a href="tpm.html"><span class="number">21 </span><span class="name">Software TPM emulator</span></a></li><li class="inactive"><a href="virt-crash-dump.html"><span class="number">22 </span><span class="name">Creating crash dumps of a VM Guest</span></a></li></ol></li><li class="inactive"><a href="part-virt-xen.html"><span class="number">IV </span><span class="name">Managing virtual machines with Xen</span></a><ol><li class="inactive"><a href="cha-xen-vhost.html"><span class="number">23 </span><span class="name">Setting up a virtual machine host</span></a></li><li class="inactive"><a href="cha-xen-network.html"><span class="number">24 </span><span class="name">Virtual networking</span></a></li><li class="inactive"><a href="cha-xen-manage.html"><span class="number">25 </span><span class="name">Managing a virtualization environment</span></a></li><li class="inactive"><a href="cha-xen-vbd.html"><span class="number">26 </span><span class="name">Block devices in Xen</span></a></li><li class="inactive"><a href="cha-xen-config.html"><span class="number">27 </span><span class="name">Virtualization: configuration options and settings</span></a></li><li class="inactive"><a href="cha-xen-admin.html"><span class="number">28 </span><span class="name">Administrative tasks</span></a></li><li class="inactive"><a href="cha-xen-xenstore.html"><span class="number">29 </span><span class="name">XenStore: configuration database shared between domains</span></a></li><li class="inactive"><a href="cha-xen-ha.html"><span class="number">30 </span><span class="name">Xen as a high-availability virtualization host</span></a></li><li class="inactive"><a href="pv-to-fv.html"><span class="number">31 </span><span class="name">Xen: converting a paravirtual (PV) guest into a fully virtual (FV/HVM) guest</span></a></li></ol></li><li class="inactive"><a href="part-virt-qemu.html"><span class="number">V </span><span class="name">Managing virtual machines with QEMU</span></a><ol><li class="inactive"><a href="cha-qemu-overview.html"><span class="number">32 </span><span class="name">QEMU overview</span></a></li><li class="inactive"><a href="cha-qemu-host.html"><span class="number">33 </span><span class="name">Setting up a KVM VM Host Server</span></a></li><li class="inactive"><a href="cha-qemu-guest-inst.html"><span class="number">34 </span><span class="name">Guest installation</span></a></li><li class="inactive"><a href="cha-qemu-running.html"><span class="number">35 </span><span class="name">Running virtual machines with qemu-system-ARCH</span></a></li><li class="inactive"><a href="cha-qemu-monitor.html"><span class="number">36 </span><span class="name">Virtual machine administration using QEMU monitor</span></a></li></ol></li><li class="inactive"><a href="part-virt-troubleshoot.html"><span class="number">VI </span><span class="name">Troubleshooting</span></a><ol><li class="inactive"><a href="cha-virt-help.html"><span class="number">37 </span><span class="name">Integrated help and package documentation</span></a></li><li class="inactive"><a href="cha-virt-logs.html"><span class="number">38 </span><span class="name">Gathering system information and logs</span></a></li></ol></li><li class="inactive"><a href="gloss-vt-glossary.html"><span class="number"> </span><span class="name">Glossary</span></a></li><li class="inactive"><a href="app-gpu-passthru.html"><span class="number">A </span><span class="name">Configuring GPU Pass-Through for NVIDIA cards</span></a></li><li class="inactive"><a href="bk06apb.html"><span class="number">B </span><span class="name">GNU licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 27. Virtualization: configuration options and settings" href="cha-xen-config.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 29. XenStore: configuration database shared between domains" href="cha-xen-xenstore.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #E11;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Virtualization Guide"><span class="book-icon">Virtualization Guide</span></a><span> › </span><a class="crumb" href="part-virt-xen.html">Managing virtual machines with Xen</a><span> › </span><a class="crumb" href="cha-xen-admin.html">Administrative tasks</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 27. Virtualization: configuration options and settings" href="cha-xen-config.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 29. XenStore: configuration database shared between domains" href="cha-xen-xenstore.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha-xen-admin"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname "><span class="productname"><span class="phrase">openSUSE Leap</span></span></span> <span class="productnumber "><span class="productnumber"><span class="phrase">15.6</span></span></span></div><div><h2 class="title"><span class="number">28 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Administrative tasks</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>cha-xen-admin</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha-xen-admin.html#sec-xen-config-bootloader"><span class="number">28.1 </span><span class="name">The boot loader program</span></a></span></dt><dt><span class="sect1"><a href="cha-xen-admin.html#sec-xen-config-sparse"><span class="number">28.2 </span><span class="name">Sparse image files and disk space</span></a></span></dt><dt><span class="sect1"><a href="cha-xen-admin.html#sec-xen-manage-migrate"><span class="number">28.3 </span><span class="name">Migrating Xen VM Guest systems</span></a></span></dt><dt><span class="sect1"><a href="cha-xen-admin.html#sec-xen-monitor"><span class="number">28.4 </span><span class="name">Monitoring Xen</span></a></span></dt><dt><span class="sect1"><a href="cha-xen-admin.html#sec-xen-admin-vhostmd"><span class="number">28.5 </span><span class="name">Providing host information for VM Guest systems</span></a></span></dt></dl></div></div><div class="sect1 " id="sec-xen-config-bootloader"><div class="titlepage"><div><div><h2 class="title"><span class="number">28.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">The boot loader program</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-config-bootloader">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-config-bootloader</li></ul></div></div></div></div><p>
      The boot loader controls how the virtualization software boots and runs.
      You can modify the boot loader properties by using YaST, or by directly
      editing the boot loader configuration file.
    </p><p>
      The YaST boot loader program is located at <span class="guimenu ">YaST</span> › <span class="guimenu ">System</span> › <span class="guimenu ">Boot
      Loader</span>. Click the <span class="guimenu ">Bootloader
      Options</span> tab and select the line containing the Xen kernel as
      the <span class="guimenu ">Default Boot Section</span>.
    </p><div class="figure" id="id-1.8.6.7.4.4"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/xen_bootloader.png" target="_blank"><img src="images/xen_bootloader.png" width="" alt="Boot loader settings" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 28.1: </span><span class="name">Boot loader settings </span><a title="Permalink" class="permalink" href="cha-xen-admin.html#id-1.8.6.7.4.4">#</a></h6></div></div><p>
      Confirm with <span class="guimenu ">OK</span>. Next time you boot the host, it can
      provide the Xen virtualization environment.
    </p><p>
      You can use the Boot Loader program to specify functionality, such as:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
          Pass kernel command-line parameters.
        </p></li><li class="listitem "><p>
          Specify the kernel image and initial RAM disk.
        </p></li><li class="listitem "><p>
          Select a specific hypervisor.
        </p></li><li class="listitem "><p>
          Pass additional parameters to the hypervisor. See
          <a class="link" href="https://xenbits.xen.org/docs/unstable/misc/xen-command-line.html" target="_blank">https://xenbits.xen.org/docs/unstable/misc/xen-command-line.html</a>
          for their complete list.
        </p></li></ul></div><p>
      You can customize your virtualization environment by editing the
      <code class="filename">/etc/default/grub</code> file. Add the following line to
      this file: <code class="literal">GRUB_CMDLINE_XEN="&lt;boot_parameters&gt;"</code>.
      Do not forget to run <code class="command">grub2-mkconfig -o
      /boot/grub2/grub.cfg</code> after editing the file.
    </p></div><div class="sect1 " id="sec-xen-config-sparse"><div class="titlepage"><div><div><h2 class="title"><span class="number">28.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Sparse image files and disk space</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-config-sparse">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-config-sparse</li></ul></div></div></div></div><p>
      If the host’s physical disk reaches a state where it has no available
      space, a virtual machine using a virtual disk based on a sparse image
      file cannot write to its disk. Consequently, it reports I/O errors.
    </p><p>
      If this situation occurs, you should free up available space on the
      physical disk, remount the virtual machine’s file system, and set the
      file system back to read-write.
    </p><p>
      To check the actual disk requirements of a sparse image file, use the
      command <code class="command">du -h &lt;image file&gt;</code>.
    </p><p>
      To increase the available space of a sparse image file, first increase
      the file size and then the file system.
    </p><div id="id-1.8.6.7.5.6" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg" /><h6>Warning: Back up before resizing</h6><p>
        Touching the sizes of partitions or sparse files always bears the risk
        of data failure. Do not work without a backup.
      </p></div><p>
      The resizing of the image file can be done online, while the VM Guest is
      running. Increase the size of a sparse image file with:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/zero of=&lt;image file&gt; count=0 bs=1M seek=&lt;new size in MB&gt;</pre></div><p>
      For example, to increase the file
      <code class="filename">/var/lib/xen/images/sles/disk0</code> to a size of 16GB,
      use the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/zero of=/var/lib/xen/images/sles/disk0 count=0 bs=1M seek=16000</pre></div><div id="id-1.8.6.7.5.11" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note: Increasing non-sparse images</h6><p>
        It is also possible to increase the image files of devices that are not
        sparse files. However, you must know exactly where the previous image
        ends. Use the seek parameter to point to the end of the image file and
        use a command similar to the following:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> dd if=/dev/zero of=/var/lib/xen/images/sles/disk0 seek=8000 bs=1M count=2000</pre></div></div><p>
      Be sure to use the right seek, else data loss may happen.
    </p><p>
      If the VM Guest is running during the resize operation, also resize the
      loop device that provides the image file to the VM Guest. First detect
      the correct loop device with the command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> losetup -j /var/lib/xen/images/sles/disk0</pre></div><p>
      Then resize the loop device, for example, <code class="filename">/dev/loop0</code>,
      with the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> losetup -c /dev/loop0</pre></div><p>
      Finally check the size of the block device inside the guest system with
      the command <code class="command">fdisk -l /dev/xvdb</code>. Replace the device
      name with your increased disk.
    </p><p>
      The resizing of the file system inside the sparse file involves tools
      that are depending on the actual file system. 
    </p></div><div class="sect1 " id="sec-xen-manage-migrate"><div class="titlepage"><div><div><h2 class="title"><span class="number">28.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Migrating Xen VM Guest systems</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-manage-migrate">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-manage-migrate</li></ul></div></div></div></div><p>
      With Xen it is possible to migrate a VM Guest system from one VM Host Server
      to another with almost no service interruption. This could be used, for
      example, to move a busy VM Guest to a VM Host Server that has stronger hardware
      or is not yet loaded. Or, if a service of a VM Host Server is required, all
      VM Guest systems running on this machine can be migrated to other
      machines to avoid interruption of service. These are only two
      examples—many more reasons may apply to your personal situation.
    </p><p>
      Before starting, certain preliminary considerations regarding the
      VM Host Server should be taken into account:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
          All VM Host Server systems should use a similar CPU. The frequency is not
          so important, but they should be using the same CPU family. To get
          more information about the used CPU, use <code class="command">cat
          /proc/cpuinfo</code>. Find more details about comparing host CPU
          features in <a class="xref" href="cha-xen-admin.html#sec-xen-manage-migrate-cpu" title="28.3.1. Detecting CPU features">Section 28.3.1, “Detecting CPU features”</a>.
        </p></li><li class="listitem "><p>
          All resources that are used by a specific guest system must be
          available on all involved VM Host Server systems—for example, all used
          block devices must exist on both VM Host Server systems.
        </p></li><li class="listitem "><p>
          If the hosts included in the migration process run in different
          subnets, make sure that either DHCP relay is available to the guests,
          or for guests with static network configuration, set up the network
          manually.
        </p></li><li class="listitem "><p>
          Using special features like <code class="literal">PCI Pass-Through</code> may be
          problematic. Do not implement these when deploying for an environment
          that should migrate VM Guest systems between different VM Host Server
          systems.
        </p></li><li class="listitem "><p>
          For fast migrations, a fast network is mandatory. If possible, use GB
          Ethernet and fast switches. Deploying VLAN may also help avoid
          collisions.
        </p></li></ul></div><div class="sect2 " id="sec-xen-manage-migrate-cpu"><div class="titlepage"><div><div><h3 class="title"><span class="number">28.3.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Detecting CPU features</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-manage-migrate-cpu">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-manage-migrate-cpu</li></ul></div></div></div></div><p>
        By using the <code class="systemitem">cpuid</code> and
        <code class="systemitem">xen_maskcalc.py</code> tools, you can compare
        features of a CPU on the host from where you are migrating the source
        VM Guest with the features of CPUs on the target hosts. This way you
        can better predict if the guest migrations will be successful.
      </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
            Run the <code class="command">cpuid -1r</code> command on each Dom0 that is
            supposed to run or receive the migrated VM Guest and capture the
            output in text files, for example:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux@vm_host1 &gt; </code>sudo cpuid -1r &gt; vm_host1.txt
<code class="prompt user">tux@vm_host2 &gt; </code>sudo cpuid -1r &gt; vm_host2.txt
<code class="prompt user">tux@vm_host3 &gt; </code>sudo cpuid -1r &gt; vm_host3.txt</pre></div></li><li class="step "><p>
            Copy all the output text files on a host with the
            <code class="command">xen_maskcalc.py</code> script installed.
          </p></li><li class="step "><p>
            Run the <code class="command">xen_maskcalc.py</code> script on all output
            text files:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xen_maskcalc.py vm_host1.txt vm_host2.txt vm_host3.txt
cpuid = [
    "0x00000001:ecx=x00xxxxxx0xxxxxxxxx00xxxxxxxxxxx",
    "0x00000007,0x00:ebx=xxxxxxxxxxxxxxxxxx00x0000x0x0x00"
]</pre></div></li><li class="step "><p>
            Copy the output <code class="literal">cpuid=[...]</code> configuration
            snipped into the <code class="command">xl</code> configuration of the
            migrated guest<code class="filename">domU.cfg</code> or alternatively to its
            <code class="systemitem">libvirt</code>'s XML configuration.
          </p></li><li class="step "><p>
            Start the source guest with the <span class="emphasis"><em>trimmed</em></span> CPU
            configuration. The guest can now only use CPU features which are
            present on each of the hosts.
          </p></li></ol></div></div><div class="sect3 " id="sec-xen-manage-migrate-cpu-info"><div class="titlepage"><div><div><h4 class="title"><span class="number">28.3.1.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">More information</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-manage-migrate-cpu-info">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-manage-migrate-cpu-info</li></ul></div></div></div></div><p>
          You can find more details about <code class="systemitem">cpuid</code> at
          <a class="link" href="https://etallen.com/cpuid.html" target="_blank">https://etallen.com/cpuid.html</a>.
        </p><p>
          You can download the latest version of the CPU mask calculator from
          <a class="link" href="https://github.com/twizted/xen_maskcalc" target="_blank">https://github.com/twizted/xen_maskcalc</a>.
        </p></div></div><div class="sect2 " id="sec-xen-manage-migrate-block"><div class="titlepage"><div><div><h3 class="title"><span class="number">28.3.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Preparing block devices for migrations</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-manage-migrate-block">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-manage-migrate-block</li></ul></div></div></div></div><p>
        The block devices needed by the VM Guest system must be available on
        all involved VM Host Server systems. This is done by implementing a specific
        kind of shared storage that serves as a container for the root file
        system of the migrated VM Guest system. Common possibilities include:
      </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
            <code class="literal">iSCSI</code> can be set up to give access to the same
            block devices from different systems at the same time.
            
          </p></li><li class="listitem "><p>
            <code class="literal">NFS</code> is a widely used root file system that can
            easily be accessed from different locations. For more information,
            see <span class="intraxref">Book “Reference”, Chapter 22 “Sharing file systems with NFS”</span>.
          </p></li><li class="listitem "><p>
            <code class="literal">DRBD</code> can be used if only two VM Host Server systems
            are involved. This adds certain extra data security, because the
            used data is mirrored over the network. .
          </p></li><li class="listitem "><p>
            <code class="literal">SCSI</code> can also be used if the available hardware
            permits shared access to the same disks.
          </p></li><li class="listitem "><p>
            <code class="literal">NPIV</code> is a special mode to use Fibre channel
            disks. However, in this case, all migration hosts must be attached
            to the same Fibre channel switch. For more information about NPIV,
            see <a class="xref" href="cha-xen-vbd.html#sec-xen-config-disk" title="26.1. Mapping physical storage to virtual disks">Section 26.1, “Mapping physical storage to virtual disks”</a>. Commonly, this works if
            the Fibre channel environment supports 4 Gbps or faster
            connections.
          </p></li></ul></div></div><div class="sect2 " id="sec-xen-manage-migrate-xl"><div class="titlepage"><div><div><h3 class="title"><span class="number">28.3.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Migrating VM Guest systems</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-manage-migrate-xl">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-manage-migrate-xl</li></ul></div></div></div></div><p>
        The actual migration of the VM Guest system is done with the command:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> xl migrate &lt;domain_name&gt; &lt;host&gt;</pre></div><p>
        The speed of the migration depends on how fast the memory print can be
        saved to disk, sent to the new VM Host Server and loaded there. This means
        that small VM Guest systems can be migrated faster than big systems
        with a lot of memory.
      </p></div></div><div class="sect1 " id="sec-xen-monitor"><div class="titlepage"><div><div><h2 class="title"><span class="number">28.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Monitoring Xen</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-monitor">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-monitor</li></ul></div></div></div></div><p>
      For a regular operation of many virtual guests, having a possibility to
      check the sanity of all the different VM Guest systems is indispensable.
      Xen offers several tools besides the system tools to gather information
      about the system.
    </p><div id="id-1.8.6.7.7.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg" /><h6>Tip: Monitoring the VM Host Server</h6><p>
        Basic monitoring of the VM Host Server (I/O and CPU) is available via the
        Virtual Machine Manager. Refer to
        <a class="xref" href="cha-libvirt-managing.html#cha-libvirt-admin-monitor-virt-manager" title="10.7.1. Monitoring with Virtual Machine Manager">Section 10.7.1, “Monitoring with Virtual Machine Manager”</a> for details.
      </p></div><div class="sect2 " id="sec-xen-monitor-xentop"><div class="titlepage"><div><div><h3 class="title"><span class="number">28.4.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Monitor Xen with <code class="command">xentop</code></span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-monitor-xentop">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-monitor-xentop</li></ul></div></div></div></div><p>
        The preferred terminal application to gather information about Xen
        virtual environment is <code class="command">xentop</code>. Be aware that this
        tool needs a rather broad terminal, else it inserts line breaks into
        the display.
      </p><p>
        <code class="command">xentop</code> has several command keys that can give you
        more information about the system that is monitored. For example:
      </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.8.6.7.7.4.4.1"><span class="term ">D</span></dt><dd><p>
              Change the delay between the refreshes of the screen.
            </p></dd><dt id="id-1.8.6.7.7.4.4.2"><span class="term ">N</span></dt><dd><p>
              Also display network statistics. Note, that only standard
              configurations are displayed. If you use a special configuration
              like a routed network, no network is displayed.
            </p></dd><dt id="id-1.8.6.7.7.4.4.3"><span class="term ">B</span></dt><dd><p>
              Display the respective block devices and their cumulated usage
              count.
            </p></dd></dl></div><p>
        For more information about <code class="command">xentop</code>, see the manual
        page <code class="command">man 1 xentop</code>.
      </p><div id="id-1.8.6.7.7.4.6" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg" /><h6>Tip: <code class="command">virt-top</code></h6><p>
          libvirt offers the hypervisor-agnostic tool
          <code class="command">virt-top</code>, which is recommended for monitoring
          VM Guests. See
          <a class="xref" href="cha-libvirt-managing.html#cha-libvirt-admin-monitor-virt-top" title="10.7.2. Monitoring with virt-top">Section 10.7.2, “Monitoring with <code class="command">virt-top</code>”</a> for
          details.
        </p></div></div><div class="sect2 " id="sec-xen-monitor-tools"><div class="titlepage"><div><div><h3 class="title"><span class="number">28.4.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Additional tools</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-monitor-tools">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-monitor-tools</li></ul></div></div></div></div><p>
        There are many system tools that also help monitoring or debugging a
        running
        <span class="phrase">openSUSE</span>
        system. Many of these are covered in <span class="intraxref">Book “System Analysis and Tuning Guide”, Chapter 2 “System monitoring utilities”</span>.
        Especially useful for monitoring a virtualization environment are the
        following tools:
      </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.8.6.7.7.5.3.1"><span class="term ">ip</span></dt><dd><p>
              The command-line utility <code class="command">ip</code> may be used to
              monitor arbitrary network interfaces. This is especially useful
              if you have set up a network that is routed or applied a
              masqueraded network. To monitor a network interface with the name
              <code class="literal">alice.0</code>, run the following command:
            </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>watch ip -s link show alice.0</pre></div></dd><dt id="id-1.8.6.7.7.5.3.2"><span class="term ">bridge</span></dt><dd><p>
              In a standard setup, all the Xen VM Guest systems are attached
              to a virtual network bridge. <code class="command">bridge</code> allows you
              to determine the connection between the bridge and the virtual
              network adapter in the VM Guest system. For example, the output
              of <code class="command">bridge link</code> may look like the following:
            </p><div class="verbatim-wrap"><pre class="screen">2: eth0 state DOWN : &lt;NO-CARRIER, ...,UP&gt; mtu 1500 master br0
8: vnet0 state UNKNOWN : &lt;BROADCAST, ...,LOWER_UP&gt; mtu 1500 master virbr0 \
  state forwarding priority 32 cost 100</pre></div><p>
              This shows that there are two virtual bridges defined on the
              system. One is connected to the physical Ethernet device
              <code class="literal">eth0</code>, the other one is connected to a VLAN
              interface <code class="literal">vnet0</code>.
            </p></dd><dt id="id-1.8.6.7.7.5.3.3"><span class="term ">iptables-save</span></dt><dd><p>
              Especially when using masquerade networks, or if several Ethernet
              interfaces are set up together with a firewall setup, it may be
              helpful to check the current firewall rules.
            </p><p>
              The command <code class="command">iptables</code> may be used to check all
              the different firewall settings. To list all the rules of a
              chain, or even of the complete setup, you may use the commands
              <code class="command">iptables-save</code> or <code class="command">iptables
              -S</code>.
            </p></dd></dl></div></div></div><div class="sect1 " id="sec-xen-admin-vhostmd"><div class="titlepage"><div><div><h2 class="title"><span class="number">28.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Providing host information for VM Guest systems</span> <a title="Permalink" class="permalink" href="cha-xen-admin.html#sec-xen-admin-vhostmd">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/xen_administrating.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>sec-xen-admin-vhostmd</li></ul></div></div></div></div><p>
      In a standard Xen environment, the VM Guest systems have only limited
      information about the VM Host Server system they are running on. If a guest
      should know more about the VM Host Server it runs on,
      <code class="systemitem">vhostmd</code> can provide more information to selected
      guests. To set up your system to run <code class="systemitem">vhostmd</code>,
      proceed as follows:
    </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
          Install the package vhostmd on the VM Host Server.
        </p></li><li class="step "><p>
          To add or remove <code class="literal">metric</code> sections from the
          configuration, edit the file
          <code class="filename">/etc/vhostmd/vhostmd.conf</code>. However, the default
          works well.
        </p></li><li class="step "><p>
          Check the validity of the <code class="filename">vhostmd.conf</code>
          configuration file with the command:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cd /etc/vhostmd
<code class="prompt user">&gt; </code>xmllint --postvalid --noout vhostmd.conf</pre></div></li><li class="step "><p>
          Start the vhostmd daemon with the command <code class="command">sudo systemctl
          start vhostmd</code>.
        </p><p>
          If vhostmd should be started automatically during start-up of the
          system, run the command:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable vhostmd</pre></div></li><li class="step "><p>
          Attach the image file <code class="filename">/dev/shm/vhostmd0</code> to the
          VM Guest system named alice with the command:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>xl block-attach opensuse /dev/shm/vhostmd0,,xvdb,ro</pre></div></li><li class="step "><p>
          Log on the VM Guest system.
        </p></li><li class="step "><p>
          Install the client package <code class="systemitem">vm-dump-metrics</code>.
        </p></li><li class="step "><p>
          Run the command <code class="command">vm-dump-metrics</code>. To save the
          result to a file, use the option <code class="systemitem">-d
          &lt;filename&gt;</code>.
        </p></li></ol></div></div><p>
      The result of the <code class="systemitem">vm-dump-metrics</code> is an XML
      output. The respective metric entries follow the DTD
      <code class="filename">/etc/vhostmd/metric.dtd</code>.
    </p><p>
      For more information, see the manual pages <code class="command">man 8
      vhostmd</code> and <code class="filename">/usr/share/doc/vhostmd/README</code>
      on the VM Host Server system. On the guest, see the man page <code class="command">man 1
      vm-dump-metrics</code>.
    </p></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha-xen-xenstore.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 29 </span>XenStore: configuration database shared between domains</span></a><a class="nav-link" href="cha-xen-config.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 27 </span>Virtualization: configuration options and settings</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2024 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>