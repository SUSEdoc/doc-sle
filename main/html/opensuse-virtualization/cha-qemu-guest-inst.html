<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Guest installation | Virtualization Guide | openSUSE Leap 15.6</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" />
<meta name="title" content="Guest installation | openSUSE Leap 15.6" />
<meta name="description" content="The libvirt-based tools such as virt-manager and virt-install offer convenient interfaces to set up and manage virtual machines. They act as a kind of wrapper …" />
<meta name="product-name" content="openSUSE Leap" />
<meta name="product-number" content="15.6" />
<meta name="book-title" content="Virtualization Guide" />
<meta name="chapter-title" content="Chapter 34. Guest installation" />
<meta name="tracker-url" content="https://bugzilla.opensuse.org/enter_bug.cgi" />
<meta name="tracker-type" content="bsc" />
<meta name="tracker-bsc-assignee" content="fs@suse.com" />
<meta name="tracker-bsc-component" content="Documentation" />
<meta name="tracker-bsc-product" content="openSUSE Distribution" />
<meta name="tracker-bsc-version" content="Leap 15.4" />
<meta property="og:title" content="Guest installation | openSUSE Leap 15.6" />
<meta property="og:description" content="The libvirt-based tools such as virt-manager and virt-install offer convenient interfaces to set up and manage virtual machines. They act as a kind of wrapper …" />
<meta property="og:type" content="article" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Guest installation | openSUSE Leap 15.6" />
<meta name="twitter:description" content="The libvirt-based tools such as virt-manager and virt-install offer convenient interfaces to set up and manage virtual machines. They act as a kind of wrapper …" />
<link rel="home" href="index.html" title="openSUSE Leap Documentation" /><link rel="up" href="part-virt-qemu.html" title="Part V. Managing virtual machines with QEMU" /><link rel="prev" href="cha-qemu-host.html" title="Chapter 33. Setting up a KVM VM Host Server" /><link rel="next" href="cha-qemu-running.html" title="Chapter 35. Running virtual machines with qemu-system-ARCH" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" /></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #E11;"><div id="_header"><div id="_logo"><img src="static/images/logo.svg" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Virtualization Guide"><span class="book-icon">Virtualization Guide</span></a><span> › </span><a class="crumb" href="part-virt-qemu.html">Managing virtual machines with QEMU</a><span> › </span><a class="crumb" href="cha-qemu-guest-inst.html">Guest installation</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Virtualization Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="cha-kvm.html"><span class="number"> </span><span class="name">Preface</span></a></li><li class="inactive"><a href="part-virt-intro.html"><span class="number">I </span><span class="name">Introduction</span></a><ol><li class="inactive"><a href="chap-virtualization-introduction.html"><span class="number">1 </span><span class="name">Virtualization technology</span></a></li><li class="inactive"><a href="cha-virtualization-scenarios.html"><span class="number">2 </span><span class="name">Virtualization scenarios</span></a></li><li class="inactive"><a href="cha-xen-basics.html"><span class="number">3 </span><span class="name">Introduction to Xen virtualization</span></a></li><li class="inactive"><a href="cha-kvm-intro.html"><span class="number">4 </span><span class="name">Introduction to KVM virtualization</span></a></li><li class="inactive"><a href="cha-tools-intro.html"><span class="number">5 </span><span class="name">Virtualization tools</span></a></li><li class="inactive"><a href="cha-vt-installation.html"><span class="number">6 </span><span class="name">Installation of virtualization components</span></a></li></ol></li><li class="inactive"><a href="part-virt-libvirt.html"><span class="number">II </span><span class="name">Managing virtual machines with <code class="systemitem">libvirt</code></span></a><ol><li class="inactive"><a href="cha-libvirt-overview.html"><span class="number">7 </span><span class="name"><code class="systemitem">libvirt</code> daemons</span></a></li><li class="inactive"><a href="cha-libvirt-host.html"><span class="number">8 </span><span class="name">Preparing the VM Host Server</span></a></li><li class="inactive"><a href="cha-kvm-inst.html"><span class="number">9 </span><span class="name">Guest installation</span></a></li><li class="inactive"><a href="cha-libvirt-managing.html"><span class="number">10 </span><span class="name">Basic VM Guest management</span></a></li><li class="inactive"><a href="cha-libvirt-connect.html"><span class="number">11 </span><span class="name">Connecting and authorizing</span></a></li><li class="inactive"><a href="cha-libvirt-storage.html"><span class="number">12 </span><span class="name">Advanced storage topics</span></a></li><li class="inactive"><a href="cha-libvirt-config-gui.html"><span class="number">13 </span><span class="name">Configuring virtual machines with Virtual Machine Manager</span></a></li><li class="inactive"><a href="cha-libvirt-config-virsh.html"><span class="number">14 </span><span class="name">Configuring virtual machines with <code class="command">virsh</code></span></a></li><li class="inactive"><a href="sec-libvirt-admin-migrate.html"><span class="number">15 </span><span class="name">Migrating VM Guests</span></a></li><li class="inactive"><a href="xen2kvm-migration.html"><span class="number">16 </span><span class="name">Xen to KVM migration guide</span></a></li></ol></li><li class="inactive"><a href="part-virt-common.html"><span class="number">III </span><span class="name">Hypervisor-independent features</span></a><ol><li class="inactive"><a href="cha-cachemodes.html"><span class="number">17 </span><span class="name">Disk cache modes</span></a></li><li class="inactive"><a href="sec-kvm-managing-clock.html"><span class="number">18 </span><span class="name">VM Guest clock settings</span></a></li><li class="inactive"><a href="chap-guestfs.html"><span class="number">19 </span><span class="name">libguestfs</span></a></li><li class="inactive"><a href="cha-qemu-ga.html"><span class="number">20 </span><span class="name">QEMU guest agent</span></a></li><li class="inactive"><a href="tpm.html"><span class="number">21 </span><span class="name">Software TPM emulator</span></a></li><li class="inactive"><a href="virt-crash-dump.html"><span class="number">22 </span><span class="name">Creating crash dumps of a VM Guest</span></a></li></ol></li><li class="inactive"><a href="part-virt-xen.html"><span class="number">IV </span><span class="name">Managing virtual machines with Xen</span></a><ol><li class="inactive"><a href="cha-xen-vhost.html"><span class="number">23 </span><span class="name">Setting up a virtual machine host</span></a></li><li class="inactive"><a href="cha-xen-network.html"><span class="number">24 </span><span class="name">Virtual networking</span></a></li><li class="inactive"><a href="cha-xen-manage.html"><span class="number">25 </span><span class="name">Managing a virtualization environment</span></a></li><li class="inactive"><a href="cha-xen-vbd.html"><span class="number">26 </span><span class="name">Block devices in Xen</span></a></li><li class="inactive"><a href="cha-xen-config.html"><span class="number">27 </span><span class="name">Virtualization: configuration options and settings</span></a></li><li class="inactive"><a href="cha-xen-admin.html"><span class="number">28 </span><span class="name">Administrative tasks</span></a></li><li class="inactive"><a href="cha-xen-xenstore.html"><span class="number">29 </span><span class="name">XenStore: configuration database shared between domains</span></a></li><li class="inactive"><a href="cha-xen-ha.html"><span class="number">30 </span><span class="name">Xen as a high-availability virtualization host</span></a></li><li class="inactive"><a href="pv-to-fv.html"><span class="number">31 </span><span class="name">Xen: converting a paravirtual (PV) guest into a fully virtual (FV/HVM) guest</span></a></li></ol></li><li class="inactive"><a href="part-virt-qemu.html"><span class="number">V </span><span class="name">Managing virtual machines with QEMU</span></a><ol><li class="inactive"><a href="cha-qemu-overview.html"><span class="number">32 </span><span class="name">QEMU overview</span></a></li><li class="inactive"><a href="cha-qemu-host.html"><span class="number">33 </span><span class="name">Setting up a KVM VM Host Server</span></a></li><li class="inactive"><a href="cha-qemu-guest-inst.html"><span class="number">34 </span><span class="name">Guest installation</span></a></li><li class="inactive"><a href="cha-qemu-running.html"><span class="number">35 </span><span class="name">Running virtual machines with qemu-system-ARCH</span></a></li><li class="inactive"><a href="cha-qemu-monitor.html"><span class="number">36 </span><span class="name">Virtual machine administration using QEMU monitor</span></a></li></ol></li><li class="inactive"><a href="part-virt-troubleshoot.html"><span class="number">VI </span><span class="name">Troubleshooting</span></a><ol><li class="inactive"><a href="cha-virt-help.html"><span class="number">37 </span><span class="name">Integrated help and package documentation</span></a></li><li class="inactive"><a href="cha-virt-logs.html"><span class="number">38 </span><span class="name">Gathering system information and logs</span></a></li></ol></li><li class="inactive"><a href="gloss-vt-glossary.html"><span class="number"> </span><span class="name">Glossary</span></a></li><li class="inactive"><a href="app-gpu-passthru.html"><span class="number">A </span><span class="name">Configuring GPU Pass-Through for NVIDIA cards</span></a></li><li class="inactive"><a href="bk06apb.html"><span class="number">B </span><span class="name">GNU licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 33. Setting up a KVM VM Host Server" href="cha-qemu-host.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 35. Running virtual machines with qemu-system-ARCH" href="cha-qemu-running.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #E11;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Virtualization Guide"><span class="book-icon">Virtualization Guide</span></a><span> › </span><a class="crumb" href="part-virt-qemu.html">Managing virtual machines with QEMU</a><span> › </span><a class="crumb" href="cha-qemu-guest-inst.html">Guest installation</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 33. Setting up a KVM VM Host Server" href="cha-qemu-host.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 35. Running virtual machines with qemu-system-ARCH" href="cha-qemu-running.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha-qemu-guest-inst"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname "><span class="productname"><span class="phrase">openSUSE Leap</span></span></span> <span class="productnumber "><span class="productnumber"><span class="phrase">15.6</span></span></span></div><div><h2 class="title"><span class="number">34 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Guest installation</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-kvm"><span class="number">34.1 </span><span class="name">Basic installation with <code class="command">qemu-system-ARCH</code></span></a></span></dt><dt><span class="sect1"><a href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img"><span class="number">34.2 </span><span class="name">Managing disk images with <code class="command">qemu-img</code></span></a></span></dt></dl></div></div><p>
    The <code class="systemitem">libvirt</code>-based tools such as
    <code class="command">virt-manager</code> and <code class="command">virt-install</code> offer
    convenient interfaces to set up and manage virtual machines. They act as a
    kind of wrapper for the <code class="command">qemu-system-ARCH</code>command.
    However, it is also possible to use <code class="command">qemu-system-ARCH</code>
    directly without using
    <code class="systemitem">libvirt</code>-based tools.
  </p><div id="id-1.8.7.4.4" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg" /><h6>Warning: <code class="command">qemu-system-ARCH</code> and libvirt</h6><p>
      <a class="xref" href="gloss-vt-glossary.html#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a>s created with
      <code class="command">qemu-system-ARCH</code> are not visible for the
      <code class="systemitem">libvirt</code>-based tools.
    </p></div><div class="sect1 " id="cha-qemu-guest-inst-qemu-kvm"><div class="titlepage"><div><div><h2 class="title"><span class="number">34.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Basic installation with <code class="command">qemu-system-ARCH</code></span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-kvm">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-kvm</li></ul></div></div></div></div><p>
      In the following example, a virtual machine for a SUSE Linux Enterprise Server 11 installation
      is created. For detailed information on the commands, refer to the
      respective man pages.
    </p><p>
      If you do not already have an image of a system that you want to run in a
      virtualized environment, you need to create one from the installation
      media. In such case, you need to prepare a hard disk image, and obtain an
      image of the installation media or the media itself.
    </p><p>
      Create a hard disk with <code class="command">qemu-img</code>.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create<span id="co-qemu-img-create"></span><span class="callout">1</span> -f raw<span id="co-qemu-img-format"></span><span class="callout">2</span> /images/sles/hda<span id="co-qemu-img-path"></span><span class="callout">3</span> 8G<span id="co-qemu-img-size"></span><span class="callout">4</span></pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-create"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
          The subcommand <code class="option">create</code> tells
          <code class="command">qemu-img</code> to create a new image.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-format"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
          Specify the disk's format with the <code class="option">-f</code> parameter.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-path"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
          The full path to the image file.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-size"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>
          The size of the image, 8 GB in this case. The image is created
          as a <a class="xref" href="gloss-vt-glossary.html#gloss-vt-storage-sparse" title="Sparse image file">Sparse image file</a> that grows when
          the disk is filled with data. The specified size defines the maximum
          size to which the image file can grow.
        </p></td></tr></table></div><p>
      After at least one hard disk image is created, you can set up a virtual
      machine with <code class="command">qemu-system-ARCH</code> that boots into the
      installation system:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>qemu-system-x86_64 -name "sles"<span id="co-qemu-kvn-name"></span><span class="callout">1</span>-machine accel=kvm -M pc<span id="co-qemu-kvm-type"></span><span class="callout">2</span> -m 768<span id="co-qemu-kvm-memory"></span><span class="callout">3</span> \
-smp 2<span id="co-qemu-kvm-cpu"></span><span class="callout">4</span> -boot d<span id="co-qemu-kvm-boot"></span><span class="callout">5</span> \
-drive file=/images/sles/hda,if=virtio,index=0,media=disk,format=raw<span id="co-qemu-kvm-hdd"></span><span class="callout">6</span> \
-drive file=/isos/SLE-15-SP6-Online-<em class="replaceable ">ARCH</em>-GM-media1.iso,index=1,media=cdrom<span id="co-qemu-kvm-cdrom"></span><span class="callout">7</span> \
-net nic,model=virtio,macaddr=52:54:00:05:11:11<span id="co-qemu-kvm-nic"></span><span class="callout">8</span> -net user \
-vga cirrus<span id="co-qemu-kvm-gfx"></span><span class="callout">9</span> -balloon virtio<span id="co-qemu-kvm-balloon"></span><span class="callout">10</span></pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-kvn-name"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
          Name of the virtual machine that is displayed in the window caption
          and be used for the VNC server. This name must be unique.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-kvm-type"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
          Specifies the machine type. Use <code class="command">qemu-system-ARCH</code>
          <code class="option">-M ?</code> to display a list of valid parameters.
          <code class="literal">pc</code> is the default <span class="guimenu ">Standard PC</span>.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-kvm-memory"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
          Maximum amount of memory for the virtual machine.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-kvm-cpu"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>
          Defines an SMP system with two processors.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-kvm-boot"><span class="callout">5</span></a> </p></td><td valign="top" align="left"><p>
          Specifies the boot order. Valid values are <code class="literal">a</code>,
          <code class="literal">b</code> (floppy 1 and 2), <code class="literal">c</code> (first
          hard disk), <code class="literal">d</code> (first CD-ROM), or <code class="literal">n</code> to
          <code class="literal">p</code> (Ether-boot from network adapter 1-3). Defaults
          to <code class="literal">c</code>.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-kvm-hdd"><span class="callout">6</span></a> </p></td><td valign="top" align="left"><p>
          Defines the first (<code class="literal">index=0</code>) hard disk. It is
          accessed as a paravirtualized (<code class="literal">if=virtio</code>) drive in
          <code class="literal">raw</code> format.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-kvm-cdrom"><span class="callout">7</span></a> </p></td><td valign="top" align="left"><p>
          The second (<code class="literal">index=1</code>) image drive acts as a CD-ROM.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-kvm-nic"><span class="callout">8</span></a> </p></td><td valign="top" align="left"><p>
          Defines a paravirtualized (<code class="literal">model=virtio</code>) network
          adapter with the MAC address <code class="literal">52:54:00:05:11:11</code>. Be
          sure to specify a unique MAC address, otherwise a network conflict
          may occur.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-kvm-gfx"><span class="callout">9</span></a> </p></td><td valign="top" align="left"><p>
          Specifies the graphic card. If you specify <code class="literal">none</code>,
          the graphic card is disabled.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-kvm-balloon"><span class="callout">10</span></a> </p></td><td valign="top" align="left"><p>
          Defines the paravirtualized balloon device that allows to dynamically
          change the amount of memory (up to the maximum value specified with
          the parameter <code class="option">-m</code>).
        </p></td></tr></table></div><p>
      After the installation of the guest operating system finishes, you can
      start the related virtual machine without the need to specify the CD-ROM
      device:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>qemu-system-x86_64 -name "sles" -machine type=pc,accel=kvm -m 768 \
-smp 2 -boot c \
-drive file=/images/sles/hda,if=virtio,index=0,media=disk,format=raw \
-net nic,model=virtio,macaddr=52:54:00:05:11:11 \
-vga cirrus -balloon virtio</pre></div></div><div class="sect1 " id="cha-qemu-guest-inst-qemu-img"><div class="titlepage"><div><div><h2 class="title"><span class="number">34.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Managing disk images with <code class="command">qemu-img</code></span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img</li></ul></div></div></div></div><p>
      In the previous section (see
      <a class="xref" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-kvm" title="34.1. Basic installation with qemu-system-ARCH">Section 34.1, “Basic installation with <code class="command">qemu-system-ARCH</code>”</a>), we used the
      <code class="command">qemu-img</code> command to create an image of a hard disk.
      You can, however, use <code class="command">qemu-img</code> for general disk image
      manipulation. This section introduces <code class="command">qemu-img</code>
      subcommands to help manage the disk images flexibly.
    </p><div class="sect2 " id="cha-qemu-guest-inst-qemu-img-general-invocation"><div class="titlepage"><div><div><h3 class="title"><span class="number">34.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">General information on qemu-img invocation</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-general-invocation">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-general-invocation</li></ul></div></div></div></div><p>
        <code class="command">qemu-img</code> uses subcommands (like
        <code class="command">zypper</code> does) to do specific tasks. Each subcommand
        understands a different set of options. Certain options are general and
        used by more of these subcommands, while others are unique to the
        related subcommand. See the qemu-img man page (<code class="command">man 1
        qemu-img</code>) for a list of all supported options.
        <code class="command">qemu-img</code> uses the following general syntax:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img subcommand [options]</pre></div><p>
        and supports the following subcommands:
      </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.8.7.4.6.3.5.1"><span class="term "><code class="literal">create</code></span></dt><dd><p>
              Creates a new disk image on the file system.
            </p></dd><dt id="id-1.8.7.4.6.3.5.2"><span class="term "><code class="literal">check</code></span></dt><dd><p>
              Checks an existing disk image for errors.
            </p></dd><dt id="id-1.8.7.4.6.3.5.3"><span class="term "><code class="literal">compare</code></span></dt><dd><p>
              Check if two images have the same content.
            </p></dd><dt id="id-1.8.7.4.6.3.5.4"><span class="term "><code class="literal">map</code></span></dt><dd><p>
              Dumps the metadata of the image file name and its backing file
              chain.
            </p></dd><dt id="id-1.8.7.4.6.3.5.5"><span class="term "><code class="literal">amend</code></span></dt><dd><p>
              Amends the image format specific options for the image file name.
            </p></dd><dt id="id-1.8.7.4.6.3.5.6"><span class="term "><code class="literal">convert</code></span></dt><dd><p>
              Converts an existing disk image to a new one in a different
              format.
            </p></dd><dt id="id-1.8.7.4.6.3.5.7"><span class="term "><code class="literal">info</code></span></dt><dd><p>
              Displays information about the relevant disk image.
            </p></dd><dt id="id-1.8.7.4.6.3.5.8"><span class="term "><code class="literal">snapshot</code></span></dt><dd><p>
              Manages snapshots of existing disk images.
            </p></dd><dt id="id-1.8.7.4.6.3.5.9"><span class="term "><code class="literal">commit</code></span></dt><dd><p>
              Applies changes made to an existing disk image.
            </p></dd><dt id="id-1.8.7.4.6.3.5.10"><span class="term "><code class="literal">rebase</code></span></dt><dd><p>
              Creates a new base image based on an existing image.
            </p></dd><dt id="id-1.8.7.4.6.3.5.11"><span class="term "><code class="literal">resize</code></span></dt><dd><p>
              Increases or decreases the size of an existing image.
            </p></dd></dl></div></div><div class="sect2 " id="cha-qemu-guest-inst-qemu-img-create"><div class="titlepage"><div><div><h3 class="title"><span class="number">34.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Creating, converting, and checking disk images</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-create">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-create</li></ul></div></div></div></div><p>
        This section describes how to create disk images, check their
        condition, convert a disk image from one format to another, and get
        detailed information about a particular disk image.
      </p><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-create-create"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">qemu-img create</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-create-create">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-create-create</li></ul></div></div></div></div><p>
          Use <code class="command">qemu-img create</code> to create a new disk image for
          your VM Guest operating system. The command uses the following
          syntax:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create -f fmt<span id="co-qemu-img-create-f"></span><span class="callout">1</span> -o options<span id="co-qemu-img-create-o"></span><span class="callout">2</span> fname<span id="co-qemu-img-create-filename"></span><span class="callout">3</span> size<span id="co-qemu-img-create-size"></span><span class="callout">4</span></pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-create-f"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
              The format of the target image. Supported formats are
              <code class="literal">raw</code> and <code class="literal">qcow2</code>.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-create-o"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
              Certain image formats support additional options to be passed on the
              command line. You can specify them here with the
              <code class="literal">-o</code> option. The <code class="literal">raw</code> image
              format supports only the <code class="literal">size</code> option, so it is
              possible to insert <code class="literal">-o size=8G</code> instead of
              adding the size option at the end of the command.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-create-filename"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
              Path to the target disk image to be created.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-create-size"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>
              Size of the target disk image (if not already specified with the
              <code class="literal">-o size=&lt;image_size&gt;</code> option. Optional
              suffixes for the image size are <code class="literal">K</code> (kilobyte),
              <code class="literal">M</code> (megabyte), <code class="literal">G</code> (gigabyte),
              or <code class="literal">T</code> (terabyte).
            </p></td></tr></table></div><p>
          To create a new disk image <code class="filename">sles.raw</code> in the
          directory <code class="filename">/images</code> growing up to a maximum size
          of 4 GB, run the following command:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create -f raw -o size=4G /images/sles.raw
Formatting '/images/sles.raw', fmt=raw size=4294967296

<code class="prompt user">&gt; </code>ls -l /images/sles.raw
-rw-r--r-- 1 tux users 4294967296 Nov 15 15:56 /images/sles.raw

<code class="prompt user">&gt; </code>qemu-img info /images/sles.raw
image: /images/sles11.raw
file format: raw
virtual size: 4.0G (4294967296 bytes)
disk size: 0</pre></div><p>
          As you can see, the <span class="emphasis"><em>virtual</em></span> size of the newly
          created image is 4 GB, but the actual reported disk size is 0 as no
          data has been written to the image yet.
        </p><div id="id-1.8.7.4.6.4.3.8" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg" /><h6>Tip: VM Guest images on the Btrfs file system</h6><p>
            If you need to create a disk image on the Btrfs file system, you
            can use <code class="option">nocow=on</code> to reduce the performance
            overhead created by the copy-on-write feature of Btrfs:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create -o nocow=on test.img 8G</pre></div><p>
            If you, however, want to use copy-on-write, for example, for
            creating snapshots or sharing them across virtual machines, then
            leave the command line without the <code class="option">nocow</code> option.
          </p></div></div><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-create-convert"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">qemu-img convert</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-create-convert">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-create-convert</li></ul></div></div></div></div><p>
          Use <code class="command">qemu-img convert</code> to convert disk images to
          another format. To get a complete list of image formats supported by
          QEMU, run <code class="command">qemu-img</code> <code class="option">-h</code> and look
          at the last line of the output. The command uses the following
          syntax:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img convert -c<span id="co-qemu-img-convert-c"></span><span class="callout">1</span> -f fmt<span id="co-qemu-img-convert-fmt"></span><span class="callout">2</span> -O out_fmt<span id="co-qemu-img-convert-ofmt"></span><span class="callout">3</span> -o options<span id="co-qemu-img-convert-o"></span><span class="callout">4</span> fname<span id="co-qemu-img-convert-fname"></span><span class="callout">5</span> out_fname<span id="co-qemu-img-convert-ofname"></span><span class="callout">6</span></pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-convert-c"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
              Applies compression on the target disk image. Only
              <code class="literal">qcow</code> and <code class="literal">qcow2</code> formats
              support compression.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-convert-fmt"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
              The format of the source disk image. It is normally autodetected
              and can therefore be omitted.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-convert-ofmt"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
              The format of the target disk image.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-convert-o"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>
              Specify additional options relevant for the target image format.
              Use <code class="literal">-o ?</code> to view the list of options supported
              by the target image format.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-convert-fname"><span class="callout">5</span></a> </p></td><td valign="top" align="left"><p>
              Path to the source disk image to be converted.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-convert-ofname"><span class="callout">6</span></a> </p></td><td valign="top" align="left"><p>
              Path to the converted target disk image.
            </p></td></tr></table></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img convert -O vmdk /images/sles.raw \
/images/sles.vmdk

<code class="prompt user">&gt; </code>ls -l /images/
-rw-r--r-- 1 tux users 4294967296 16. lis 10.50 sles.raw
-rw-r--r-- 1 tux users 2574450688 16. lis 14.18 sles.vmdk</pre></div><p>
          To see a list of options relevant for the selected target image
          format, run the following command (replace <code class="literal">vmdk</code>
          with your image format):
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img convert -O vmdk /images/sles.raw \
/images/sles.vmdk -o ?
Supported options:
size             Virtual disk size
backing_file     File name of a base image
compat6          VMDK version 6 image
subformat        VMDK flat extent format, can be one of {monolithicSparse \
    (default) | monolithicFlat | twoGbMaxExtentSparse | twoGbMaxExtentFlat}
scsi             SCSI image</pre></div></div><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-create-check"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">qemu-img check</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-create-check">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-create-check</li></ul></div></div></div></div><p>
          Use <code class="command">qemu-img check</code> to check the existing disk
          image for errors. Not all disk image formats support this feature.
          The command uses the following syntax:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img check -f fmt<span id="co-qemu-img-check-fmt"></span><span class="callout">1</span> fname<span id="co-qemu-img-check-fname"></span><span class="callout">2</span></pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-check-fmt"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
              The format of the source disk image. It is normally autodetected
              and can therefore be omitted.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-check-fname"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
              Path to the source disk image to be checked.
            </p></td></tr></table></div><p>
          If no error is found, the command returns no output. Otherwise, the
          type and number of errors found is shown.
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img check -f qcow2 /images/sles.qcow2
ERROR: invalid cluster offset=0x2af0000
[...]
ERROR: invalid cluster offset=0x34ab0000
378 errors were found on the image.</pre></div></div><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-create-incr"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.2.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Increasing the size of an existing disk image</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-create-incr">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-create-incr</li></ul></div></div></div></div><p>
          When creating a new image, you must specify its maximum size before
          the image is created (see
          <a class="xref" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-create-create" title="34.2.2.1. qemu-img create">Section 34.2.2.1, “qemu-img create”</a>). After
          you have installed the VM Guest and have been using it for certain
          time, the initial size of the image may no longer be sufficient. In
          that case, add more space to it.
        </p><p>
          To increase the size of an existing disk image by 2 gigabytes, use:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img resize /images/sles.raw +2GB</pre></div><div id="id-1.8.7.4.6.4.6.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
            You can resize the disk image using the formats
            <code class="literal">raw</code> and <code class="literal">qcow2</code>. To resize an
            image in another format, convert it to a supported format with
            <code class="command">qemu-img convert</code> first.
          </p></div><p>
          The image now contains an empty space of 2 GB after the final
          partition. You can resize the existing partitions or add new ones.
        </p></div><div class="sect3 " id="qemu-qcow2-advanced-options"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.2.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Advanced options for the qcow2 file format</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#qemu-qcow2-advanced-options">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>qemu-qcow2-advanced-options</li></ul></div></div></div></div><p>
          <span class="emphasis"><em>qcow2</em></span> is the main disk image format used by
          QEMU. Its size grows on demand, and the disk space is only
          allocated when it is needed by the virtual machine.
        </p><p>
          A qcow2 formatted file is organized in units of constant size. These
          units are called <span class="emphasis"><em>clusters</em></span>. Viewed from the guest
          side, the virtual disk is also divided into clusters of the same
          size. QEMU defaults to 64 kB clusters, but you can specify a
          different value when creating a new image:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create -f qcow2 -o cluster_size=128K virt_disk.qcow2 4G</pre></div><p>
          A qcow2 image contains a set of tables organized in two levels that
          are called the L1 and L2 tables. There is just one L1 table per disk
          image, while there can be many L2 tables depending on how big the
          image is.
        </p><p>
          To read or write data to the virtual disk, QEMU needs to read its
          corresponding L2 table to find out the relevant data location.
          Because reading the table for each I/O operation consumes system
          resources, QEMU keeps a cache of L2 tables in memory to speed up
          disk access.
        </p><div class="sect4 " id="id-1.8.7.4.6.4.7.7"><div class="titlepage"><div><div><h5 class="title"><span class="number">34.2.2.5.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Choosing the right cache size</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#id-1.8.7.4.6.4.7.7">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h5><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
            The cache size relates to the amount of allocated space. L2 cache
            can map the following amount of virtual disk:
          </p><div class="verbatim-wrap"><pre class="screen">disk_size = l2_cache_size * cluster_size / 8</pre></div><p>
            With the default 64 kB of cluster size, that is
          </p><div class="verbatim-wrap"><pre class="screen">disk_size = l2_cache_size * 8192</pre></div><p>
            Therefore, to have a cache that maps <code class="literal">n</code> gigabytes
            of disk space with the default cluster size, you need
          </p><div class="verbatim-wrap"><pre class="screen">l2_cache_size = disk_size_GB * 131072</pre></div><p>
            QEMU uses 1 MB (1048576 bytes) of L2 cache by default.
            Following the above formulas, 1 MB of L2 cache covers
            8 GB (1048576 / 131072) of virtual disk. This means that the
            performance is fine with the default L2 cache size if your virtual
            disk size is up to 8 GB. For larger disks, you can speed up
            the disk access by increasing the L2 cache size.
          </p></div><div class="sect4 " id="id-1.8.7.4.6.4.7.8"><div class="titlepage"><div><div><h5 class="title"><span class="number">34.2.2.5.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Configuring the cache size</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#id-1.8.7.4.6.4.7.8">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h5><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
            You can use the <code class="option">-drive</code> option on the QEMU
            command line to specify the cache sizes. Alternatively when
            communicating via QMP, use the <code class="command">blockdev-add</code>
            command. For more information on QMP, see
            <a class="xref" href="cha-qemu-monitor.html#qemu-monitor-qmp" title="36.11. QMP - QEMU machine protocol">Section 36.11, “QMP - QEMU machine protocol”</a>.
          </p><p>
            The following options configure the cache size for the virtual
            guest:
          </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.8.7.4.6.4.7.8.4.1"><span class="term ">l2-cache-size</span></dt><dd><p>
                  The maximum size of the L2 table cache.
                </p></dd><dt id="id-1.8.7.4.6.4.7.8.4.2"><span class="term ">refcount-cache-size</span></dt><dd><p>
                  The maximum size of the <span class="emphasis"><em>refcount</em></span> block
                  cache. For more information on <span class="emphasis"><em>refcount</em></span>,
                  see
                  <a class="link" href="https://raw.githubusercontent.com/qemu/qemu/master/docs/qcow2-cache.txt" target="_blank">https://raw.githubusercontent.com/qemu/qemu/master/docs/qcow2-cache.txt</a>.
                </p></dd><dt id="id-1.8.7.4.6.4.7.8.4.3"><span class="term ">cache-size</span></dt><dd><p>
                  The maximum size of both caches combined.
                </p></dd></dl></div><p>
            When specifying values for the options above, be aware of the
            following:
          </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
                The size of both the L2 and refcount block caches needs to be a
                multiple of the cluster size.
              </p></li><li class="listitem "><p>
                If you only set one of the options, QEMU automatically
                adjusts the other options so that the L2 cache is 4 times
                bigger than the refcount cache.
              </p></li></ul></div><p>
            The refcount cache is used much less often than the L2 cache,
            therefore you can keep it small:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>qemu-system-ARCH [...] \
 -drive file=disk_image.qcow2,l2-cache-size=4194304,refcount-cache-size=262144</pre></div></div><div class="sect4 " id="id-1.8.7.4.6.4.7.9"><div class="titlepage"><div><div><h5 class="title"><span class="number">34.2.2.5.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Reducing the memory usage</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#id-1.8.7.4.6.4.7.9">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h5><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
            The larger the cache, the more memory it consumes. There is a
            separate L2 cache for each qcow2 file. When using a lot of big disk
            images, you may need a considerably large amount of memory. Memory
            consumption is even worse if you add backing files
            (<a class="xref" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-effect" title="34.2.4. Manipulate disk images effectively">Section 34.2.4, “Manipulate disk images effectively”</a>) and
            snapshots (see
            <a class="xref" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-snapshots" title="34.2.3. Managing snapshots of virtual machines with qemu-img">Section 34.2.3, “Managing snapshots of virtual machines with qemu-img”</a>) to the
            guest's setup chain.
          </p><p>
            This is why QEMU introduced the
            <code class="option">cache-clean-interval</code> setting. It defines an
            interval in seconds after which all cache entries that have not
            been accessed are removed from memory.
          </p><p>
            The following example removes all unused cache entries every 10
            minutes:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>qemu-system-ARCH [...] -drive file=hd.qcow2,cache-clean-interval=600</pre></div><p>
            If this option is not set, the default value is 0 and it disables
            this feature.
          </p></div></div></div><div class="sect2 " id="cha-qemu-guest-inst-qemu-img-snapshots"><div class="titlepage"><div><div><h3 class="title"><span class="number">34.2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Managing snapshots of virtual machines with qemu-img</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-snapshots">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-snapshots</li></ul></div></div></div></div><p>
        <a class="xref" href="gloss-vt-glossary.html#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a> snapshots are snapshots of the complete
        environment in which a VM Guest is running. The snapshot includes the
        state of the processor (CPU), memory (RAM), devices, and all writable
        disks.
      </p><p>
        Snapshots are helpful when you need to save your virtual machine in a
        particular state. For example, after you configured network services on
        a virtualized server and want to quickly start the virtual machine in
        the same state you last saved it. Or you can create a snapshot after
        the virtual machine has been powered off to create a backup state
        before you try something experimental and make VM Guest unstable. This
        section introduces the latter case, while the former is described in
        <a class="xref" href="cha-qemu-monitor.html" title="Chapter 36. Virtual machine administration using QEMU monitor">Chapter 36, <em>Virtual machine administration using QEMU monitor</em></a>.
      </p><p>
        To use snapshots, your VM Guest must contain at least one writable
        hard disk image in <code class="literal">qcow2</code> format. This device is
        normally the first virtual hard disk.
      </p><p>
        <a class="xref" href="gloss-vt-glossary.html#gloss-vt-vm" title="Virtual Machine">Virtual Machine</a> snapshots are created with the
        <code class="literal">savevm</code> command in the interactive QEMU monitor. To
        make identifying a particular snapshot easier, you can assign it a
        <span class="emphasis"><em>tag</em></span>. For more information on QEMU monitor, see
        <a class="xref" href="cha-qemu-monitor.html" title="Chapter 36. Virtual machine administration using QEMU monitor">Chapter 36, <em>Virtual machine administration using QEMU monitor</em></a>.
      </p><p>
        Once your <code class="literal">qcow2</code> disk image contains saved snapshots,
        you can inspect them with the <code class="command">qemu-img snapshot</code>
        command.
      </p><div id="id-1.8.7.4.6.5.7" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg" /><h6>Warning: Shut down the VM Guest</h6><p>
          Do not create or delete virtual machine snapshots with the
          <code class="command">qemu-img snapshot</code> command while the virtual
          machine is running. Otherwise, you may damage the disk image with the
          state of the virtual machine saved.
        </p></div><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-snapshots-l"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.3.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Listing existing snapshots</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-snapshots-l">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-snapshots-l</li></ul></div></div></div></div><p>
          Use <code class="command">qemu-img snapshot -l</code>
          <em class="replaceable ">DISK_IMAGE</em> to view a list of all existing
          snapshots saved in the <code class="literal">disk_image</code> image. You can
          get the list even while the VM Guest is running.
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img snapshot -l /images/sles.qcow2
Snapshot list:
ID<span id="co-qemu-img-snapshot-l-id"></span><span class="callout">1</span>       TAG<span id="co-qemu-img-snapshot-l-tag"></span><span class="callout">2</span>               VM SIZE<span id="co-qemu-img-snapshot-l-size"></span><span class="callout">3</span>        DATE<span id="co-qemu-img-snapshot-l-date"></span><span class="callout">4</span>          VM CLOCK<span id="co-qemu-img-snapshot-l-clock"></span><span class="callout">5</span>
1         booting                4.4M 2013-11-22 10:51:10   00:00:20.476
2         booted                 184M 2013-11-22 10:53:03   00:02:05.394
3         logged_in              273M 2013-11-22 11:00:25   00:04:34.843
4         ff_and_term_running    372M 2013-11-22 11:12:27   00:08:44.965</pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-snapshot-l-id"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
              Unique auto-incremented identification number of the snapshot.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-snapshot-l-tag"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
              Unique description string of the snapshot. It is meant as a
              human-readable version of the ID.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-snapshot-l-size"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
              The disk space occupied by the snapshot. The more
              memory is consumed by running applications, the bigger the
              snapshot is.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-snapshot-l-date"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>
              Time and date the snapshot was created.
            </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-snapshot-l-clock"><span class="callout">5</span></a> </p></td><td valign="top" align="left"><p>
              The current state of the virtual machine's clock.
            </p></td></tr></table></div></div><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-snapshots-c"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.3.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Creating snapshots of a powered-off virtual machine</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-snapshots-c">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-snapshots-c</li></ul></div></div></div></div><p>
          Use <code class="command">qemu-img snapshot -c</code>
          <em class="replaceable ">SNAPSHOT_TITLE</em>
          <em class="replaceable ">DISK_IMAGE</em> to create a snapshot of the
          current state of a virtual machine that was previously powered off.
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img snapshot -c backup_snapshot /images/sles.qcow2</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img snapshot -l /images/sles.qcow2
Snapshot list:
ID        TAG                 VM SIZE                DATE       VM CLOCK
1         booting                4.4M 2013-11-22 10:51:10   00:00:20.476
2         booted                 184M 2013-11-22 10:53:03   00:02:05.394
3         logged_in              273M 2013-11-22 11:00:25   00:04:34.843
4         ff_and_term_running    372M 2013-11-22 11:12:27   00:08:44.965
5         backup_snapshot           0 2013-11-22 14:14:00   00:00:00.000</pre></div><p>
          If something breaks in your VM Guest and you need to restore the
          state of the saved snapshot (ID 5 in our example), power off your
          VM Guest and execute the following command:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img snapshot -a 5 /images/sles.qcow2</pre></div><p>
          The next time you run the virtual machine with
          <code class="command">qemu-system-ARCH</code>, it will be in the state of
          snapshot number 5.
        </p><div id="id-1.8.7.4.6.5.9.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
            The <code class="command">qemu-img snapshot -c</code> command is not related
            to the <code class="literal">savevm</code> command of QEMU monitor (see
            <a class="xref" href="cha-qemu-monitor.html" title="Chapter 36. Virtual machine administration using QEMU monitor">Chapter 36, <em>Virtual machine administration using QEMU monitor</em></a>). For example, you cannot apply
            a snapshot with <code class="command">qemu-img snapshot -a</code> on a
            snapshot created with <code class="literal">savevm</code> in QEMU's
            monitor.
          </p></div></div><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-snapshots-d"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.3.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Deleting snapshots</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-snapshots-d">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-snapshots-d</li></ul></div></div></div></div><p>
          Use <code class="command">qemu-img snapshot -d</code>
          <em class="replaceable ">SNAPSHOT_ID</em>
          <em class="replaceable ">DISK_IMAGE</em> to delete old or unneeded
          snapshots of a virtual machine. This saves disk space inside the
          <code class="literal">qcow2</code> disk image as the space occupied by the
          snapshot data is restored:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img snapshot -d 2 /images/sles.qcow2</pre></div></div></div><div class="sect2 " id="cha-qemu-guest-inst-qemu-img-effect"><div class="titlepage"><div><div><h3 class="title"><span class="number">34.2.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Manipulate disk images effectively</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-effect">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-effect</li></ul></div></div></div></div><p>
        Imagine the following real-life situation: you are a server
        administrator who runs and manages several virtualized operating
        systems. One group of these systems is based on one specific
        distribution, while another group (or groups) is based on different
        versions of the distribution or even on a different (and maybe
        non-Unix) platform. To make the case even more complex, individual
        virtual guest systems based on the same distribution differ according
        to the department and deployment. A file server typically uses a
        different setup and services than a Web server does, while both may
        still be based on
        <span class="phrase">openSUSE</span>.
      </p><p>
        With QEMU it is possible to create <span class="quote">“<span class="quote ">base</span>”</span> disk images.
        You can use them as template virtual machines. These base images save
        you plenty of time because you do not need to install the same
        operating system more than once.
      </p><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-effect-base-and-derived"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.4.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Base and derived images</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-effect-base-and-derived">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-effect-base-and-derived</li></ul></div></div></div></div><p>
          First, build a disk image as usual and install the target system on
          it. For more information, see
          <a class="xref" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-kvm" title="34.1. Basic installation with qemu-system-ARCH">Section 34.1, “Basic installation with <code class="command">qemu-system-ARCH</code>”</a> and
          <a class="xref" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-create" title="34.2.2. Creating, converting, and checking disk images">Section 34.2.2, “Creating, converting, and checking disk images”</a>. Then build a
          new image while using the first one as a base image. The base image
          is also called a <span class="emphasis"><em>backing</em></span> file. After your new
          <span class="emphasis"><em>derived</em></span> image is built, never boot the base
          image again, but boot the derived image instead. Several derived
          images may depend on one base image at the same time. Therefore,
          changing the base image can damage the dependencies. While using your
          derived image, QEMU writes changes to it and uses the base image
          only for reading.
        </p><p>
          It is a good practice to create a base image from a freshly installed
          (and, if needed, registered) operating system with no patches applied
          and no additional applications installed or removed. Later on, you
          can create another base image with the latest patches applied and
          based on the original base image.
        </p></div><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-effect-create-derived"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.4.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Creating derived images</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-effect-create-derived">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-effect-create-derived</li></ul></div></div></div></div><div id="id-1.8.7.4.6.6.5.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
            While you can use the <code class="literal">raw</code> format for base
            images, you cannot use it for derived images because the
            <code class="literal">raw</code> format does not support the
            <code class="literal">backing_file</code> option. Use, for example, the
            <code class="literal">qcow2</code> format for the derived images.
          </p></div><p>
          For example, <code class="filename">/images/sles_base.raw</code> is the base
          image holding a freshly installed system.
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img info /images/sles_base.raw
image: /images/sles_base.raw
file format: raw
virtual size: 4.0G (4294967296 bytes)
disk size: 2.4G</pre></div><p>
          The image's reserved size is 4 GB, the actual size is 2.4 GB, and its
          format is <code class="literal">raw</code>. Create an image derived from the
          <code class="filename">/images/sles_base.raw</code> base image with:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img create -f qcow2 /images/sles_derived.qcow2 \
-o backing_file=/images/sles_base.raw
Formatting '/images/sles_derived.qcow2', fmt=qcow2 size=4294967296 \
backing_file='/images/sles_base.raw' encryption=off cluster_size=0</pre></div><p>
          Look at the derived image details:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img info /images/sles_derived.qcow2
image: /images/sles_derived.qcow2
file format: qcow2
virtual size: 4.0G (4294967296 bytes)
disk size: 140K
cluster_size: 65536
backing file: /images/sles_base.raw \
(actual path: /images/sles_base.raw)</pre></div><p>
          Although the reserved size of the derived image is the same as the
          size of the base image (4 GB), the actual size is 140 KB only. The
          reason is that only changes made to the system inside the derived
          image are saved. Run the derived virtual machine, register it, if
          needed, and apply the latest patches. Do any other changes in the
          system such as removing unneeded or installing new software packages.
          Then shut the VM Guest down and examine its details once more:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img info /images/sles_derived.qcow2
image: /images/sles_derived.qcow2
file format: qcow2
virtual size: 4.0G (4294967296 bytes)
disk size: 1.1G
cluster_size: 65536
backing file: /images/sles_base.raw \
(actual path: /images/sles_base.raw)</pre></div><p>
          The <code class="literal">disk size</code> value has grown to 1.1 GB, which is
          the disk space occupied by the changes on the file system compared to
          the base image.
        </p></div><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-effect-rebase"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.4.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Rebasing derived images</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-effect-rebase">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-effect-rebase</li></ul></div></div></div></div><p>
          After you have modified the derived image (applied patches, installed
          specific applications, changed environment settings, etc.), it
          reaches the desired state. At that point, you can merge the original
          base image and the derived image to create a new base image.
        </p><p>
          Your original base image (<code class="filename">/images/sles_base.raw</code>)
          holds a freshly installed system. It can be a template for new
          modified base images, while the new one can contain the same system
          as the first one plus all security and update patches applied, for
          example. After you have created this new base image, you can use it
          as a template for more specialized derived images as well. The new
          base image becomes independent of the original one. The process of
          creating base images from derived ones is called
          <span class="emphasis"><em>rebasing</em></span>:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img convert /images/sles_derived.qcow2 \
-O raw /images/sles_base2.raw</pre></div><p>
          This command created the new base image
          <code class="filename">/images/sles_base2.raw</code> using the
          <code class="literal">raw</code> format.
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>qemu-img info /images/sles_base2.raw
image: /images/sles11_base2.raw
file format: raw
virtual size: 4.0G (4294967296 bytes)
disk size: 2.8G</pre></div><p>
          The new image is 0.4 gigabytes bigger than the original base image.
          It uses no backing file, and you can easily create new derived images
          based upon it. This lets you create a sophisticated hierarchy of
          virtual disk images for your organization, saving a lot of time and
          work.
        </p></div><div class="sect3 " id="cha-qemu-guest-inst-qemu-img-effect-mount"><div class="titlepage"><div><div><h4 class="title"><span class="number">34.2.4.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Mounting an image on a VM Host Server</span> <a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#cha-qemu-guest-inst-qemu-img-effect-mount">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/qemu_guest_installation.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>qemu_guest_installation.xml</li><li><span class="ds-label">ID: </span>cha-qemu-guest-inst-qemu-img-effect-mount</li></ul></div></div></div></div><p>
          It can be useful to mount a virtual disk image under the host system.
          It is strongly recommended to read <a class="xref" href="chap-guestfs.html" title="Chapter 19. libguestfs">Chapter 19, <em>libguestfs</em></a> and
          use dedicated tools to access a virtual machine image. However, if
          you need to do this manually, follow this guide.
        </p><p>
          Linux systems can mount an internal partition of a
          <code class="literal">raw</code> disk image using a loopback device. The first
          example procedure is more complex but more illustrative, while the
          second one is straightforward:
        </p><div class="procedure " id="id-1.8.7.4.6.6.7.4"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 34.1: </span><span class="name">Mounting disk image by calculating partition offset </span><a title="Permalink" class="permalink" href="cha-qemu-guest-inst.html#id-1.8.7.4.6.6.7.4">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
              Set a <span class="emphasis"><em>loop</em></span> device on the disk image whose
              partition you want to mount.
            </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>losetup /dev/loop0 /images/sles_base.raw</pre></div></li><li class="step "><p>
              Find the <span class="emphasis"><em>sector size</em></span> and the starting
              <span class="emphasis"><em>sector number</em></span> of the partition you want to
              mount.
            </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>fdisk -lu /dev/loop0

Disk /dev/loop0: 4294 MB, 4294967296 bytes
255 heads, 63 sectors/track, 522 cylinders, total 8388608 sectors
Units = sectors of 1 * 512 = 512<span id="co-qemu-img-loopback-sector-size"></span><span class="callout">1</span> bytes
Disk identifier: 0x000ceca8

       Device Boot      Start         End      Blocks   Id  System
/dev/loop0p1              63     1542239      771088+  82  Linux swap
/dev/loop0p2   *     1542240<span id="co-qemu-img-loopback-sector-start"></span><span class="callout">2</span>    8385929     3421845   83  Linux</pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-loopback-sector-size"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
                  The disk sector size.
                </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-qemu-img-loopback-sector-start"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
                  The starting sector of the partition.
                </p></td></tr></table></div></li><li class="step "><p>
              Calculate the partition start offset:
            </p><p>
              <code class="literal">sector_size * sector_start = 512 * 1542240 = 789626880
              </code>
            </p></li><li class="step "><p>
              Delete the loop and mount the partition inside the disk image
              with the calculated offset on a prepared directory.
            </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>losetup -d /dev/loop0
<code class="prompt user">&gt; </code>mount -o loop,offset=789626880 \
/images/sles_base.raw /mnt/sles/
<code class="prompt user">&gt; </code>ls -l /mnt/sles/
total 112
drwxr-xr-x   2 root root  4096 Nov 16 10:02 bin
drwxr-xr-x   3 root root  4096 Nov 16 10:27 boot
drwxr-xr-x   5 root root  4096 Nov 16 09:11 dev
[...]
drwxrwxrwt  14 root root  4096 Nov 24 09:50 tmp
drwxr-xr-x  12 root root  4096 Nov 16 09:16 usr
drwxr-xr-x  15 root root  4096 Nov 16 09:22 var</pre></div></li><li class="step "><p>
              Copy one or more files onto the mounted partition and unmount it
              when finished.
            </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>cp /etc/X11/xorg.conf /mnt/sles/root/tmp
<code class="prompt user">&gt; </code>ls -l /mnt/sles/root/tmp
<code class="prompt user">&gt; </code>umount /mnt/sles/</pre></div></li></ol></div></div><div id="id-1.8.7.4.6.6.7.5" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg" /><h6>Warning: Do not write to images currently in use</h6><p>
            Never mount a partition of an image of a running virtual machine in
            a <code class="literal">read-write</code> mode. This could corrupt the
            partition and break the whole VM Guest.
          </p></div></div></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha-qemu-running.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 35 </span>Running virtual machines with qemu-system-ARCH</span></a><a class="nav-link" href="cha-qemu-host.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 33 </span>Setting up a KVM VM Host Server</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2024 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>