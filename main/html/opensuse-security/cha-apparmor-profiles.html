<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Profile components and syntax | Security and Hardening Guide | openSUSE Leap 15.7</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" />
<meta name="title" content="Profile components and syntax | openSUSE Leap 15.7" />
<meta name="description" content="Building AppArmor profiles to confine an application is straightforward and intuitive. AppArmor ships with several tools that assist in profile creation. It do…" />
<meta name="product-name" content="openSUSE Leap" />
<meta name="product-number" content="15.7" />
<meta name="book-title" content="Security and Hardening Guide" />
<meta name="chapter-title" content="Chapter 30. Profile components and syntax" />
<meta name="tracker-url" content="https://bugzilla.opensuse.org/enter_bug.cgi" />
<meta name="tracker-type" content="bsc" />
<meta name="tracker-bsc-assignee" content="fs@suse.com" />
<meta name="tracker-bsc-component" content="Documentation" />
<meta name="tracker-bsc-product" content="openSUSE Distribution" />
<meta name="tracker-bsc-version" content="Leap 15.4" />
<meta property="og:title" content="Profile components and syntax | openSUSE Leap 15.7" />
<meta property="og:description" content="Building AppArmor profiles to confine an application is straightforward and intuitive. AppArmor ships with several tools that assist in profile creation. It do…" />
<meta property="og:type" content="article" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Profile components and syntax | openSUSE Leap 15.7" />
<meta name="twitter:description" content="Building AppArmor profiles to confine an application is straightforward and intuitive. AppArmor ships with several tools that assist in profile creation. It do…" />
<link rel="home" href="index.html" title="openSUSE Leap Documentation" /><link rel="up" href="part-apparmor.html" title="Part IV. Confining privileges with AppArmor" /><link rel="prev" href="cha-apparmor-concept.html" title="Chapter 29. Immunizing programs" /><link rel="next" href="cha-apparmor-repos.html" title="Chapter 31. AppArmor profile repositories" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" /></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #E11;"><div id="_header"><div id="_logo"><img src="static/images/logo.svg" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Security and Hardening Guide"><span class="book-icon">Security and Hardening Guide</span></a><span> › </span><a class="crumb" href="part-apparmor.html">Confining privileges with AppArmor</a><span> › </span><a class="crumb" href="cha-apparmor-profiles.html">Profile components and syntax</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Security and Hardening Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface-security.html"><span class="number"> </span><span class="name">Preface</span></a></li><li class="inactive"><a href="cha-security.html"><span class="number">1 </span><span class="name">Security and confidentiality</span></a></li><li class="inactive"><a href="part-auth.html"><span class="number">I </span><span class="name">Authentication</span></a><ol><li class="inactive"><a href="cha-pam.html"><span class="number">2 </span><span class="name">Authentication with PAM</span></a></li><li class="inactive"><a href="cha-nis.html"><span class="number">3 </span><span class="name">Using NIS</span></a></li><li class="inactive"><a href="cha-security-auth.html"><span class="number">4 </span><span class="name">Setting up authentication clients using YaST</span></a></li><li class="inactive"><a href="cha-security-ldap.html"><span class="number">5 </span><span class="name">LDAP with 389 Directory Server</span></a></li><li class="inactive"><a href="cha-security-kerberos.html"><span class="number">6 </span><span class="name">Network authentication with Kerberos</span></a></li><li class="inactive"><a href="cha-security-ad.html"><span class="number">7 </span><span class="name">Active Directory support</span></a></li><li class="inactive"><a href="cha-security-freeradius.html"><span class="number">8 </span><span class="name">Setting up a freeRADIUS server</span></a></li></ol></li><li class="inactive"><a href="part-local-security.html"><span class="number">II </span><span class="name">Local security</span></a><ol><li class="inactive"><a href="cha-physical-security.html"><span class="number">9 </span><span class="name">Physical security</span></a></li><li class="inactive"><a href="sec-sec-software-management.html"><span class="number">10 </span><span class="name">Software management</span></a></li><li class="inactive"><a href="sec-sec-file-management.html"><span class="number">11 </span><span class="name">File management</span></a></li><li class="inactive"><a href="cha-security-cryptofs.html"><span class="number">12 </span><span class="name">Encrypting partitions and files</span></a></li><li class="inactive"><a href="cha-configure-cryptctl.html"><span class="number">13 </span><span class="name">Storage encryption for hosted applications with cryptctl</span></a></li><li class="inactive"><a href="sec-sec-user-management.html"><span class="number">14 </span><span class="name">User management</span></a></li><li class="inactive"><a href="cha-sec-cron-at.html"><span class="number">15 </span><span class="name">Restricting <code class="systemitem">cron</code> and <code class="systemitem">at</code></span></a></li><li class="inactive"><a href="cha-spectre.html"><span class="number">16 </span><span class="name">Spectre/Meltdown checker</span></a></li><li class="inactive"><a href="cha-security-yast-security.html"><span class="number">17 </span><span class="name">Configuring security settings with YaST</span></a></li><li class="inactive"><a href="cha-security-polkit.html"><span class="number">18 </span><span class="name">The Polkit authentication framework</span></a></li><li class="inactive"><a href="cha-security-acls.html"><span class="number">19 </span><span class="name">Access control lists in Linux</span></a></li><li class="inactive"><a href="cha-aide.html"><span class="number">20 </span><span class="name">Intrusion detection with AIDE</span></a></li></ol></li><li class="inactive"><a href="part-network-security.html"><span class="number">III </span><span class="name">Network security</span></a><ol><li class="inactive"><a href="cha-xauth.html"><span class="number">21 </span><span class="name">X Window System and X authentication</span></a></li><li class="inactive"><a href="cha-ssh.html"><span class="number">22 </span><span class="name">Securing network operations with OpenSSH</span></a></li><li class="inactive"><a href="cha-security-firewall.html"><span class="number">23 </span><span class="name">Masquerading and firewalls</span></a></li><li class="inactive"><a href="cha-security-vpnserver.html"><span class="number">24 </span><span class="name">Configuring a VPN server</span></a></li><li class="inactive"><a href="cha-security-xca.html"><span class="number">25 </span><span class="name">Managing a PKI with XCA, X certificate and key manager</span></a></li><li class="inactive"><a href="cha-sec-sysctl.html"><span class="number">26 </span><span class="name">Improving network security with <code class="command">sysctl</code> variables</span></a></li></ol></li><li class="inactive"><a href="part-apparmor.html"><span class="number">IV </span><span class="name">Confining privileges with <span class="phrase">AppArmor</span></span></a><ol><li class="inactive"><a href="cha-apparmor-intro.html"><span class="number">27 </span><span class="name">Introducing <span class="phrase">AppArmor</span></span></a></li><li class="inactive"><a href="cha-apparmor-start.html"><span class="number">28 </span><span class="name">Getting started</span></a></li><li class="inactive"><a href="cha-apparmor-concept.html"><span class="number">29 </span><span class="name">Immunizing programs</span></a></li><li class="inactive"><a href="cha-apparmor-profiles.html"><span class="number">30 </span><span class="name">Profile components and syntax</span></a></li><li class="inactive"><a href="cha-apparmor-repos.html"><span class="number">31 </span><span class="name"><span class="phrase">AppArmor</span> profile repositories</span></a></li><li class="inactive"><a href="cha-apparmor-yast.html"><span class="number">32 </span><span class="name">Building and managing profiles with YaST</span></a></li><li class="inactive"><a href="cha-apparmor-commandline.html"><span class="number">33 </span><span class="name">Building profiles from the command line</span></a></li><li class="inactive"><a href="cha-apparmor-hat.html"><span class="number">34 </span><span class="name">Profiling your Web applications using ChangeHat</span></a></li><li class="inactive"><a href="cha-apparmor-pam.html"><span class="number">35 </span><span class="name">Confining users with <code class="systemitem">pam_apparmor</code></span></a></li><li class="inactive"><a href="cha-apparmor-managing.html"><span class="number">36 </span><span class="name">Managing profiled applications</span></a></li><li class="inactive"><a href="cha-apparmor-support.html"><span class="number">37 </span><span class="name">Support</span></a></li><li class="inactive"><a href="cha-apparmor-glossary.html"><span class="number">38 </span><span class="name"><span class="phrase">AppArmor</span> glossary</span></a></li></ol></li><li class="inactive"><a href="part-selinux.html"><span class="number">V </span><span class="name">SELinux</span></a><ol><li class="inactive"><a href="cha-selinux.html"><span class="number">39 </span><span class="name">Configuring SELinux</span></a></li></ol></li><li class="inactive"><a href="part-audit.html"><span class="number">VI </span><span class="name">The Linux Audit Framework</span></a><ol><li class="inactive"><a href="cha-audit-comp.html"><span class="number">40 </span><span class="name">Understanding Linux audit</span></a></li><li class="inactive"><a href="cha-audit-setup.html"><span class="number">41 </span><span class="name">Setting up the Linux audit framework</span></a></li><li class="inactive"><a href="cha-audit-scenarios.html"><span class="number">42 </span><span class="name">Introducing an audit rule set</span></a></li><li class="inactive"><a href="cha-audit-moreinfo.html"><span class="number">43 </span><span class="name">Useful resources</span></a></li></ol></li><li class="inactive"><a href="bk04apa.html"><span class="number">A </span><span class="name">GNU licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 29. Immunizing programs" href="cha-apparmor-concept.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 31. AppArmor profile repositories" href="cha-apparmor-repos.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #E11;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Security and Hardening Guide"><span class="book-icon">Security and Hardening Guide</span></a><span> › </span><a class="crumb" href="part-apparmor.html">Confining privileges with AppArmor</a><span> › </span><a class="crumb" href="cha-apparmor-profiles.html">Profile components and syntax</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 29. Immunizing programs" href="cha-apparmor-concept.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 31. AppArmor profile repositories" href="cha-apparmor-repos.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha-apparmor-profiles"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname "><span class="productname"><span class="phrase">openSUSE Leap</span></span></span> <span class="productnumber "><span class="productnumber"><span class="phrase">15.7</span></span></span></div><div><h2 class="title"><span class="number">30 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Profile components and syntax</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>cha-apparmor-profiles</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-parts"><span class="number">30.1 </span><span class="name">Breaking an <span class="phrase">AppArmor</span> profile into its parts</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-types"><span class="number">30.2 </span><span class="name">Profile types</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-includes"><span class="number">30.3 </span><span class="name">Include statements</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-capabilities"><span class="number">30.4 </span><span class="name">Capability entries (POSIX.1e)</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-nac"><span class="number">30.5 </span><span class="name">Network access control</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-glob"><span class="number">30.6 </span><span class="name">Profile names, flags, paths, and globbing</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm"><span class="number">30.7 </span><span class="name">File permission access modes</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-mount"><span class="number">30.8 </span><span class="name">Mount rules</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-pivot-root"><span class="number">30.9 </span><span class="name">Pivot root rules</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-ptrace"><span class="number">30.10 </span><span class="name">PTrace rules</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-signal"><span class="number">30.11 </span><span class="name">Signal rules</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec"><span class="number">30.12 </span><span class="name">Execute modes</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-rlimit"><span class="number">30.13 </span><span class="name">Resource limit control</span></a></span></dt><dt><span class="sect1"><a href="cha-apparmor-profiles.html#sec-apparmor-profiles-audit"><span class="number">30.14 </span><span class="name">Auditing rules</span></a></span></dt></dl></div></div><p>
  Building <span class="phrase">AppArmor</span> profiles to confine an application is
  straightforward and intuitive. <span class="phrase">AppArmor</span> ships with several tools that
  assist in profile creation. It does not require you to do any programming
  or script handling. The only task that is required of the administrator is
  to determine a policy of strictest access and execute permissions for each
  application that needs to be hardened.
 </p><p>
  Updates or modifications to the application profiles are only required if
  the software configuration or the desired range of activities changes.
  <span class="phrase">AppArmor</span> offers intuitive tools to handle profile updates and
  modifications.
 </p><p>
  You are ready to build <span class="phrase">AppArmor</span> profiles after you select the programs to
  profile. To do so, it is important to understand the components and syntax
  of profiles. <span class="phrase">AppArmor</span> profiles contain several building blocks that help
  build simple and reusable profile code:
 </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.6.7.5.6.1"><span class="term ">Include files</span></dt><dd><p>
     Include statements are used to pull in parts of other <span class="phrase">AppArmor</span> profiles
     to simplify the structure of new profiles.
    </p></dd><dt id="id-1.6.7.5.6.2"><span class="term ">Abstractions</span></dt><dd><p>
     Abstractions are include statements grouped by common application
     tasks.
    </p></dd><dt id="id-1.6.7.5.6.3"><span class="term ">Program chunks</span></dt><dd><p>
     Program chunks are include statements that contain chunks of profiles
     that are specific to program suites.
    </p></dd><dt id="id-1.6.7.5.6.4"><span class="term ">Capability entries</span></dt><dd><p>
     Capability entries are profile entries for any of the POSIX.1e
     (<a class="link" href="https://en.wikipedia.org/wiki/POSIX#POSIX.1" target="_blank">https://en.wikipedia.org/wiki/POSIX#POSIX.1</a>) Linux
     capabilities allowing a fine-grained control over what a confined
     process is allowed to do through system calls that require privileges.
    </p></dd><dt id="id-1.6.7.5.6.5"><span class="term ">Network access control entries</span></dt><dd><p>
     Network Access Control Entries mediate network access based on the
     address type and family.
    </p></dd><dt id="id-1.6.7.5.6.6"><span class="term ">Local variable definitions</span></dt><dd><p>
     Local variables define shortcuts for paths.
    </p></dd><dt id="id-1.6.7.5.6.7"><span class="term ">File access control entries</span></dt><dd><p>
     File Access Control Entries specify the set of files an application can
     access.
    </p></dd><dt id="id-1.6.7.5.6.8"><span class="term ">rlimit entries</span></dt><dd><p>
     rlimit entries set and control an application's resource limits.
    </p></dd></dl></div><p>
  For help determining the programs to profile, refer to
  <a class="xref" href="cha-apparmor-concept.html#sec-apparmor-concept-determine" title="29.2. Determining programs to immunize">Section 29.2, “Determining programs to immunize”</a>.
  To start building <span class="phrase">AppArmor</span> profiles with YaST, proceed to
  <a class="xref" href="cha-apparmor-yast.html" title="Chapter 32. Building and managing profiles with YaST">Chapter 32, <em>Building and managing profiles with YaST</em></a>. To build profiles using the <span class="phrase">AppArmor</span>
  command line interface, proceed to
  <a class="xref" href="cha-apparmor-commandline.html" title="Chapter 33. Building profiles from the command line">Chapter 33, <em>Building profiles from the command line</em></a>.
 </p><p>
  For more details about creating <span class="phrase">AppArmor</span> profiles, see
  <code class="command">man 5 apparmor</code>.
 </p><div class="sect1 " id="sec-apparmor-profiles-parts"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Breaking an <span class="phrase">AppArmor</span> profile into its parts</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-parts">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-parts</li></ul></div></div></div></div><p>
   The easiest way of explaining what a profile consists of and how to
   create one is to show the details of a sample profile, in this case for a
   hypothetical application called <code class="command">/usr/bin/foo</code>:
  </p><div class="verbatim-wrap"><pre class="screen">#include &lt;tunables/global&gt;<span id="co-apparmor-profiles-vardef"></span><span class="callout">1</span>

# a comment naming the application to confine
/usr/bin/foo<span id="co-apparmor-profiles-path"></span><span class="callout">2</span> {<span id="co-apparmor-profiles-brack"></span><span class="callout">3</span>
   #include &lt;abstractions/base&gt;<span id="co-apparmor-profiles-incl"></span><span class="callout">4</span>

   capability setgid<span id="co-apparmor-profiles-capent"></span><span class="callout">5</span>,
   network inet tcp<span id="co-apparmor-profiles-netd"></span><span class="callout">6</span>,

   link /etc/sysconfig/foo -&gt; /etc/foo.conf,<span id="co-apparmor-profiles-lp"></span><span class="callout">7</span>
   /bin/mount            ux,
   /dev/{,u}<span id="co-apparmor-profiles-ext"></span><span class="callout">8</span>random     r,
   /etc/ld.so.cache      r,
   /etc/foo/*            r,
   /lib/ld-*.so*         mr,
   /lib/lib*.so*         mr,
   /proc/[0-9]**         r,
   /usr/lib/**           mr,
   /tmp/                 r,<span id="co-apparmor-profiles-pathent"></span><span class="callout">9</span>
   /tmp/foo.pid          wr,
   /tmp/foo.*            lrw,
   /@{HOME}<span id="co-apparmor-profiles-variable"></span><span class="callout">10</span>/.foo_file   rw,
   /@{HOME}/.foo_lock    kw,
   owner<span id="co-apparmor-profiles-owner"></span><span class="callout">11</span> /shared/foo/** rw,
   /usr/bin/foobar       Cx,<span id="co-apparmor-profiles-cx"></span><span class="callout">12</span>
   /bin/**               Px -&gt; bin_generic,<span id="co-apparmor-profiles-named"></span><span class="callout">13</span>

   # a comment about foo's local (children) profile for /usr/bin/foobar.

   profile /usr/bin/foobar<span id="co-apparmor-profiles-local"></span><span class="callout">14</span> {
      /bin/bash          rmix,
      /bin/cat           rmix,
      /bin/more          rmix,
      /var/log/foobar*   rwl,
      /etc/foobar        r,
   }

  # foo's hat, bar.
   ^bar<span id="co-apparmor-profiles-hat"></span><span class="callout">15</span> {
    /lib/ld-*.so*         mr,
    /usr/bin/bar          px,
    /var/spool/*          rwl,
   }
}</pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-vardef"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
     This loads a file containing variable definitions.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-path"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
     The normalized path to the program that is confined.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-brack"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
     The curly braces (<code class="literal">{}</code>) serve as a container for
     include statements, subprofiles, path entries, capability entries, and
     network entries.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-incl"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>
     This directive pulls in components of <span class="phrase">AppArmor</span> profiles to simplify
     profiles.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-capent"><span class="callout">5</span></a> </p></td><td valign="top" align="left"><p>
     Capability entry statements enable each of the 29 POSIX.1e draft
     capabilities.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-netd"><span class="callout">6</span></a> </p></td><td valign="top" align="left"><p>
     A directive determining the kind of network access allowed to the
     application. For details, refer to
     <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-nac" title="30.5. Network access control">Section 30.5, “Network access control”</a>.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-lp"><span class="callout">7</span></a> </p></td><td valign="top" align="left"><p>
     A link pair rule specifying the source and the target of a link. See
     <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-link-pair" title="30.7.6. Link pair">Section 30.7.6, “Link pair”</a> for more
     information.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-ext"><span class="callout">8</span></a> </p></td><td valign="top" align="left"><p>
     The curly braces (<code class="literal">{}</code>) here allow for each of the
     listed possibilities, one of which is the empty string.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-pathent"><span class="callout">9</span></a> </p></td><td valign="top" align="left"><p>
     A path entry specifying what areas of the file system the program can
     access. The first part of a path entry specifies the absolute path of a
     file (including regular expression globbing) and the second part
     indicates permissible access modes (for example <code class="literal">r</code>
     for read, <code class="literal">w</code> for write, and <code class="literal">x</code> for
     execute). A whitespace of any kind (spaces or tabs) can precede the
     path, but must separate the path and the mode specifier.
     Spaces between the access mode and the trailing comma are optional.
     Find a comprehensive overview of the available access modes in
     <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm" title="30.7. File permission access modes">Section 30.7, “File permission access modes”</a>.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-variable"><span class="callout">10</span></a> </p></td><td valign="top" align="left"><p>
     This variable expands to a value that can be changed without changing
     the entire profile.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-owner"><span class="callout">11</span></a> </p></td><td valign="top" align="left"><p>
     An owner conditional rule, granting read and write permission on files
     owned by the user. Refer to
     <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-owner" title="30.7.8. Owner conditional rules">Section 30.7.8, “Owner conditional rules”</a> for more
     information.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-cx"><span class="callout">12</span></a> </p></td><td valign="top" align="left"><p>
     This entry defines a transition to the local profile
     <code class="literal">/usr/bin/foobar</code>. Find a comprehensive overview of
     the available execute modes in
     <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec" title="30.12. Execute modes">Section 30.12, “Execute modes”</a>.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-named"><span class="callout">13</span></a> </p></td><td valign="top" align="left"><p>
     A named profile transition to the profile bin_generic located in the
     global scope. See <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-named" title="30.12.7. Named profile transitions">Section 30.12.7, “Named profile transitions”</a>
     for details.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-local"><span class="callout">14</span></a> </p></td><td valign="top" align="left"><p>
     The local profile <code class="literal">/usr/bin/foobar</code> is defined in this
     section.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-hat"><span class="callout">15</span></a> </p></td><td valign="top" align="left"><p>
     This section references a <span class="quote">“<span class="quote ">hat</span>”</span> subprofile of the
     application. For more details on <span class="phrase">AppArmor</span>'s ChangeHat feature, refer to
     <a class="xref" href="cha-apparmor-hat.html" title="Chapter 34. Profiling your Web applications using ChangeHat">Chapter 34, <em>Profiling your Web applications using ChangeHat</em></a>.
    </p></td></tr></table></div><p>
   When a profile is created for a program, the program can access only the
   files, modes and POSIX capabilities specified in the profile. These
   restrictions are in addition to the Linux access controls.
  </p><p><span class="formalpara-title">Example: </span>
    To gain the capability <code class="systemitem">CAP_CHOWN</code>, the
    program must have both access to <code class="systemitem">CAP_CHOWN</code>
    under conventional Linux access controls (typically, be a
    <code class="systemitem">root</code>-owned process) and have the capability
    <code class="systemitem">chown</code> in its profile. Similarly, to be able
    to write to the file <code class="filename">/foo/bar</code> the program must
    have both the correct user ID and mode bits set in the files
    attributes and have <code class="literal">/foo/bar w</code> in its profile.
   </p><p>
   Attempts to violate <span class="phrase">AppArmor</span> rules are recorded in
   <code class="filename">/var/log/audit/audit.log</code> if the
   <code class="systemitem">audit</code> package is installed, or
   in <code class="filename">/var/log/messages</code>, or only in
   <code class="systemitem">journalctl</code> if no traditional syslog is
   installed. Often <span class="phrase">AppArmor</span> rules prevent an attack from working
   because necessary files are not accessible and, in all cases, <span class="phrase">AppArmor</span>
   confinement restricts the damage that the attacker can do to the set of
   files permitted by <span class="phrase">AppArmor</span>.
  </p></div><div class="sect1 " id="sec-apparmor-profiles-types"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Profile types</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-types">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-types</li></ul></div></div></div></div><p>
   <span class="phrase">AppArmor</span> knows four different types of profiles: standard profiles,
   unattached profiles, local profiles and hats. Standard and unattached
   profiles are stand-alone profiles, each stored in a file under
   <code class="filename">/etc/apparmor.d/</code>. Local profiles and hats are
   children profiles embedded inside of a parent profile used to provide
   tighter or alternate confinement for a subtask of an application.
  </p><div class="sect2 " id="sec-apparmor-profiles-types-attached"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Standard profiles</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-types-attached">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-types-attached</li></ul></div></div></div></div><p>
    The default <span class="phrase">AppArmor</span> profile is attached to a program by its name, so a
    profile name must match the path to the application it is to confine.
   </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/foo {
...
}</pre></div><p>
    This profile is automatically used whenever an unconfined process
    executes <code class="filename">/usr/bin/foo</code>.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-types-unattached"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Unattached profiles</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-types-unattached">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-types-unattached</li></ul></div></div></div></div><p>
    Unattached profiles do not reside in the file system namespace and
    therefore are not automatically attached to an application. The name of
    an unattached profile is preceded by the keyword
    <code class="literal">profile</code>. You can freely choose a profile name, except
    for the following limitations: the name must not begin with a
    <code class="literal">:</code> or <code class="literal">.</code> character. If it contains a
    whitespace, it must be quoted. If the name begins with a
    <code class="literal">/</code>, the profile is considered to be a standard
    profile, so the following two profiles are identical:
   </p><div class="verbatim-wrap"><pre class="screen">profile /usr/bin/foo {
...
}
/usr/bin/foo {
...
}</pre></div><p>
    Unattached profiles are never used automatically, nor can they be
    transitioned to through a <code class="literal">Px</code> rule. They need to be
    attached to a program by either using a named profile transition (see
    <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-named" title="30.12.7. Named profile transitions">Section 30.12.7, “Named profile transitions”</a>) or with the
    <code class="literal">change_profile</code> rule (see
    <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-types-change" title="30.2.5. Change rules">Section 30.2.5, “Change rules”</a>).
   </p><p>
    Unattached profiles are useful for specialized profiles for system
    utilities that generally should not be confined by a system-wide profile
    (for example, <code class="literal">/bin/bash</code>). They can also be used to
    set up roles or to confine a user.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-types-local"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Local profiles</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-types-local">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-types-local</li></ul></div></div></div></div><p>
    Local profiles provide a convenient way to provide specialized
    confinement for utility programs launched by a confined application.
    They are specified like standard profiles, except that they are embedded
    in a parent profile and begin with the <code class="literal">profile</code>
    keyword:
   </p><div class="verbatim-wrap"><pre class="screen">/parent/profile {
   ...
   profile /local/profile {
      ...
   }
}</pre></div><p>
    To transition to a local profile, either use a <code class="literal">cx</code>
    rule (see <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-cx" title="30.12.2. Discrete local profile execute mode (cx)">Section 30.12.2, “Discrete local profile execute mode (cx)”</a>) or a named
    profile transition (see
    <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-named" title="30.12.7. Named profile transitions">Section 30.12.7, “Named profile transitions”</a>).
   </p></div><div class="sect2 " id="sec-apparmor-profiles-types-hat"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.2.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Hats</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-types-hat">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-types-hat</li></ul></div></div></div></div><p>
    <span class="phrase">AppArmor</span> "hats" are a local profiles with certain additional restrictions
    and an implicit rule allowing for <code class="literal">change_hat</code> to be
    used to transition to them. Refer to <a class="xref" href="cha-apparmor-hat.html" title="Chapter 34. Profiling your Web applications using ChangeHat">Chapter 34, <em>Profiling your Web applications using ChangeHat</em></a>
    for a detailed description.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-types-change"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.2.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Change rules</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-types-change">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-types-change</li></ul></div></div></div></div><p>
    <span class="phrase">AppArmor</span> provides <code class="literal">change_hat</code> and
    <code class="literal">change_profile</code> rules that control domain
    transitioning. <code class="literal">change_hat</code> are specified by defining
    hats in a profile, while <code class="literal">change_profile</code> rules refer
    to another profile and start with the keyword
    <code class="literal">change_profile</code>:
   </p><div class="verbatim-wrap"><pre class="screen">change_profile -&gt; /usr/bin/foobar,</pre></div><p>
    Both <code class="literal">change_hat</code> and <code class="literal">change_profile</code>
    provide for an application directed profile transition, without having
    to launch a separate application. <code class="literal">change_profile</code>
    provides a generic one way transition between any of the loaded
    profiles. <code class="literal">change_hat</code> provides for a returnable parent
    child transition where an application can switch from the parent profile
    to the hat profile and if it provides the correct secret key return to
    the parent profile at a later time.
   </p><p>
    <code class="literal">change_profile</code> is best used in situations where an
    application goes through a trusted setup phase and then can lower its
    privilege level. Any resources mapped or opened during the start-up
    phase may still be accessible after the profile change, but the new
    profile restricts the opening of new resources, and limits
    certain resources opened before the switch. Specifically, memory
    resources are still  available while capability and file resources
    (if they are not memory mapped) can be limited.
   </p><p>
    <code class="literal">change_hat</code> is best used in situations where an
    application runs a virtual machine or an interpreter that does not
    provide direct access to the applications resources (for example
    Apache's <code class="literal">mod_php</code>). Since
    <code class="literal">change_hat</code> stores the return secret key in the
    application's memory the phase of reduced privilege should not have
    direct access to memory. It is also important that file access is
    properly separated, since the hat can restrict accesses to a file handle
    but does not close it. If an application does buffering and provides
    access to the open files with buffering, the accesses to these files
    might not be seen by the kernel and hence not restricted by the new
    profile.
   </p><div id="id-1.6.7.5.10.7.7" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg" /><h6>Warning: Safety of domain transitions</h6><p>
     The <code class="literal">change_hat</code> and <code class="literal">change_profile</code>
     domain transitions are less secure than a domain transition done
     through an exec because they do not affect a process's memory mappings,
     nor do they close resources that have already been opened.
    </p></div></div></div><div class="sect1 " id="sec-apparmor-profiles-includes"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Include statements</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-includes">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-includes</li></ul></div></div></div></div><p>
   Include statements are directives that pull in components of other
   <span class="phrase">AppArmor</span> profiles to simplify profiles. Include files retrieve access
   permissions for programs. By using an include, you can give the program
   access to directory paths or files that are also required by other
   programs. Using includes can reduce the size of a profile.
  </p><p>
   Include statements normally begin with a hash (<code class="literal">#</code>)
   sign. This is confusing because the same hash sign is used for comments
   inside profile files. Because of this, <code class="literal">#include</code> is
   treated as an include only if there is no preceding #
   (<code class="literal">##include</code> is a comment) and there is no whitespace
   between <code class="literal">#</code> and <code class="literal">include</code> (<code class="literal">#
   include</code> is a comment).
  </p><p>
   You can also use <code class="literal">include</code> without the leading
   <code class="literal">#</code>.
  </p><div class="verbatim-wrap"><pre class="screen">include "/etc/apparmor.d/abstractions/foo"</pre></div><p>
   is the same as using
  </p><div class="verbatim-wrap"><pre class="screen">#include "/etc/apparmor.d/abstractions/foo"</pre></div><div id="id-1.6.7.5.11.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note: No trailing ','</h6><p>
    Because includes follow the C pre-processor syntax, they do
    not have a trailing ',' like most <span class="phrase">AppArmor</span> rules.
   </p></div><p>
   By slight changes in syntax, you can modify the behavior of
   <code class="literal">include</code>. If you use <code class="literal">""</code> around the
   including path, you instruct the parser to do an absolute or relative
   path lookup.
  </p><div class="verbatim-wrap"><pre class="screen">include "/etc/apparmor.d/abstractions/foo"   # absolute path
include "abstractions/foo"   # relative path to the directory of current file</pre></div><p>
   When using relative path includes, when the file is included,
   it is considered the new current file for its includes. For example,
   suppose you are in the <code class="filename">/etc/apparmor.d/bar</code> file,
   then
  </p><div class="verbatim-wrap"><pre class="screen">include "abstractions/foo"</pre></div><p>
   includes the file <code class="filename">/etc/apparmor.d/abstractions/foo</code>.
   If then there is
  </p><div class="verbatim-wrap"><pre class="screen">include "example"</pre></div><p>
   inside the <code class="filename">/etc/apparmor.d/abstractions/foo</code> file, it
   includes <code class="filename">/etc/apparmor.d/abstractions/example</code>.
  </p><p>
   The use of <code class="literal">&lt;&gt;</code> specifies to try the include
   path (specified by <code class="option">-I</code>, defaults to the
   <code class="filename">/etc/apparmor.d</code> directory) in an ordered way. So
   assuming the include path is
  </p><div class="verbatim-wrap"><pre class="screen">-I /etc/apparmor.d/ -I /usr/share/apparmor/</pre></div><p>
   then the include statement
  </p><div class="verbatim-wrap"><pre class="screen">include &lt;abstractions/foo&gt;</pre></div><p>
   tries <code class="filename">/etc/apparmor.d/abstractions/foo</code>, and if
   that file does not exist, the next try is
   <code class="filename">/usr/share/apparmor/abstractions/foo</code>.
  </p><div id="id-1.6.7.5.11.21" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg" /><h6>Tip</h6><p>
    The default include path can be overridden manually by passing
    <code class="option">-I</code> to the <code class="command">apparmor_parser</code>, or by
    setting the include paths in
    <code class="filename">/etc/apparmor/parser.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">Include /usr/share/apparmor/
Include /etc/apparmor.d/</pre></div><p>
    Multiple entries are allowed, and they are taken in the same order as
    when they are when using <code class="option">-I</code> or
    <code class="option">--Include</code> from the <code class="command">apparmor_parser</code>
    command line.
   </p></div><p>
   If an include ends with '/', this is considered a directory include, and
   all files within the directory are included.
  </p><p>
   To assist you in profiling your applications, <span class="phrase">AppArmor</span> provides three
   classes of includes: abstractions, program chunks and tunables.
  </p><div class="sect2 " id="sec-apparmor-profiles-includes-abstractions"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.3.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Abstractions</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-includes-abstractions">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-includes-abstractions</li></ul></div></div></div></div><p>
    Abstractions are includes that are grouped by common application tasks.
    These tasks include access to authentication mechanisms, access to name
    service routines, common graphics requirements, and system accounting.
    Files listed in these abstractions are specific to the named task.
    Programs that require one of these files also requires
    other files listed in the abstraction file (depending on the local
    configuration and the specific requirements of the program). Find
    abstractions in <code class="filename">/etc/apparmor.d/abstractions</code>.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-includes-chunks"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.3.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Program chunks</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-includes-chunks">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-includes-chunks</li></ul></div></div></div></div><p>
    The program-chunks directory
    (<code class="filename">/etc/apparmor.d/program-chunks</code>) contains certain
    chunks of profiles that are specific to program suites and not generally
    useful outside of the suite, thus are never suggested for use in
    profiles by the profile wizards (<code class="command">aa-logprof</code> and
    <code class="command">aa-genprof</code>). Currently, program chunks are only
    available for the postfix program suite.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-includes-tunables"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.3.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Tunables</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-includes-tunables">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-includes-tunables</li></ul></div></div></div></div><p>
    The tunables directory (<code class="filename">/etc/apparmor.d/tunables</code>)
    contains global variable definitions. When used in a profile, these
    variables expand to a value that can be changed without changing the
    entire profile. Add all the tunables definitions that should be
    available to every profile to
    <code class="filename">/etc/apparmor.d/tunables/global</code>.
   </p></div></div><div class="sect1 " id="sec-apparmor-profiles-capabilities"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Capability entries (POSIX.1e)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-capabilities">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-capabilities</li></ul></div></div></div></div><p>
   Capability rules are simply the word <code class="literal">capability</code>
   followed by the name of the POSIX.1e capability as defined in the
   <code class="systemitem">capabilities(7)</code> man page. You can list multiple
   capabilities in a single rule, or grant all implemented capabilities with
   the bare keyword <code class="literal">capability</code>.
  </p><div class="verbatim-wrap"><pre class="screen">capability dac_override sys_admin,   # multiple capabilities
capability,                          # grant all capabilities</pre></div></div><div class="sect1 " id="sec-apparmor-profiles-nac"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Network access control</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-nac">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-nac</li></ul></div></div></div></div><p>
   <span class="phrase">AppArmor</span> allows mediation of network access based on the address type and
   family. The following illustrates the network access rule syntax:
  </p><div class="verbatim-wrap"><pre class="screen">network [[&lt;domain&gt;<span id="co-apparmor-profiles-nac-dom"></span><span class="callout">1</span>][&lt;type<span id="co-apparmor-profiles-nac-type"></span><span class="callout">2</span>&gt;][&lt;protocol<span id="co-apparmor-profiles-nac-proto"></span><span class="callout">3</span>&gt;]]</pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-nac-dom"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
     Supported domains: <code class="literal">inet</code>, <code class="literal">ax25</code>,
     <code class="literal">ipx</code>, <code class="literal">appletalk</code>,
     <code class="literal">netrom</code>, <code class="literal">bridge</code>,
     <code class="literal">x25</code>, <code class="literal">inet6</code>,
     <code class="literal">rose</code>, <code class="literal">netbeui</code>,
     <code class="literal">security</code>, <code class="literal">key</code>,
     <code class="literal">packet</code>, <code class="literal">ash</code>,
     <code class="literal">econet</code>, <code class="literal">atmsvc</code>,
     <code class="literal">sna</code>,
     <code class="literal">pppox</code>, <code class="literal">wanpipe</code>,
     <code class="literal">bluetooth</code>, <code class="literal">unix</code>,
     <code class="literal">atmpvc</code>,<code class="literal">netlink</code>,
     <code class="literal">llc</code>, <code class="literal">can</code>,
     <code class="literal">tipc</code>, <code class="literal">iucv</code>,
     <code class="literal">rxrpc</code>, <code class="literal">isdn</code>,
     <code class="literal">phonet</code>, <code class="literal">ieee802154</code>,
     <code class="literal">caif</code>, <code class="literal">alg</code>,
     <code class="literal">nfc</code>, <code class="literal">vsock</code>
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-nac-type"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
     Supported types: <code class="literal">stream</code>, <code class="literal">dgram</code>,
     <code class="literal">seqpacket</code>, <code class="literal">rdm</code>,
     <code class="literal">raw</code>, <code class="literal">packet</code>
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-nac-proto"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
     Supported protocols: <code class="literal">tcp</code>, <code class="literal">udp</code>,
     <code class="literal">icmp</code>
    </p></td></tr></table></div><p>
   The <span class="phrase">AppArmor</span> tools support only family and type specification. The <span class="phrase">AppArmor</span>
   module emits only <code class="literal">network <em class="replaceable ">DOMAIN</em>
   <em class="replaceable ">TYPE</em></code> in <span class="quote">“<span class="quote ">ACCESS DENIED</span>”</span>
   messages. And only these are output by the profile generation tools, both
   YaST and command line.
  </p><p>
   The following examples illustrate possible network-related rules to be
   used in <span class="phrase">AppArmor</span> profiles. The syntax of the last two are not
   currently supported by the <span class="phrase">AppArmor</span> tools.
  </p><div class="verbatim-wrap"><pre class="screen">network<span id="co-apparmor-profiles-nac-nw"></span><span class="callout">1</span>,
network inet<span id="co-apparmor-profiles-nac-inet"></span><span class="callout">2</span>,
network inet6<span id="co-apparmor-profiles-nac-inet6"></span><span class="callout">3</span>,
network inet stream<span id="co-apparmor-profiles-nac-istream"></span><span class="callout">4</span>,
network inet tcp<span id="co-apparmor-profiles-nac-itcp"></span><span class="callout">5</span>,
network tcp<span id="co-apparmor-profiles-nac-tcp"></span><span class="callout">6</span>,</pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-nac-nw"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
     Allow all networking. No restrictions applied with regard to domain,
     type, or protocol.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-nac-inet"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
     Allow general use of IPv4 networking.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-nac-inet6"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
     Allow general use of IPv6 networking.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-nac-istream"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>
     Allow the use of IPv4 TCP networking.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-nac-itcp"><span class="callout">5</span></a> </p></td><td valign="top" align="left"><p>
     Allow the use of IPv4 TCP networking, paraphrasing the rule above.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-apparmor-profiles-nac-tcp"><span class="callout">6</span></a> </p></td><td valign="top" align="left"><p>
     Allow the use of both IPv4 and IPv6 TCP networking.
    </p></td></tr></table></div></div><div class="sect1 " id="sec-apparmor-profiles-glob"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Profile names, flags, paths, and globbing</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-glob">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-glob</li></ul></div></div></div></div><p>
   A profile is attached to a program by specifying a full path to
   the program's executable. For example, a standard profile
   (see <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-types-attached" title="30.2.1. Standard profiles">Section 30.2.1, “Standard profiles”</a>), the profile
   is defined by
  </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/foo { ... }</pre></div><p>
   The following sections describe several useful techniques that can be
   applied when naming a profile or putting a profile in the context of
   other existing ones, or specifying file paths.
  </p><p>
   <span class="phrase">AppArmor</span> explicitly distinguishes directory path names from path
   names. Use a trailing <code class="literal">/</code> for any directory path that
   needs to be explicitly distinguished:
  </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.6.7.5.14.6.1"><span class="term "><code class="filename">/some/random/example/* r</code>
    </span></dt><dd><p>
      Allow read access to files in the
      <code class="filename">/some/random/example</code> directory.
     </p></dd><dt id="id-1.6.7.5.14.6.2"><span class="term "><code class="filename">/some/random/example/ r</code>
    </span></dt><dd><p>
      Allow read access to the directory only.
     </p></dd><dt id="id-1.6.7.5.14.6.3"><span class="term "><code class="filename">/some/**/ r</code>
    </span></dt><dd><p>
      Give read access to any directories below <code class="filename">/some</code>
      (but not /some/ itself).
     </p></dd><dt id="id-1.6.7.5.14.6.4"><span class="term "><code class="filename">/some/random/example/** r</code>
    </span></dt><dd><p>
      Give read access to files and directories under
      <code class="filename">/some/random/example</code> (but not
      /some/random/example/ itself).
     </p></dd><dt id="id-1.6.7.5.14.6.5"><span class="term "><code class="filename">/some/random/example/**[^/] r</code>
    </span></dt><dd><p>
      Give read access to files under
      <code class="filename">/some/random/example</code>. Explicitly exclude
      directories (<code class="literal">[^/]</code>).
     </p></dd></dl></div><p>
   Globbing (or regular expression matching) is when you modify the
   directory path using wild cards to include a group of files or
   subdirectories. File resources can be specified with a globbing syntax
   similar to that used by popular shells, such as csh, Bash and zsh.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /></colgroup><tbody><tr><td>
       <p>
        <code class="literal">*</code>
       </p>
      </td><td>
       <p>
        Substitutes for any number of any characters, except
        <code class="literal">/</code>.
       </p>
       <p>
        Example: An arbitrary number of path elements.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">**</code>
       </p>
      </td><td>
       <p>
        Substitutes for any number of characters, including
        <code class="literal">/</code>.
       </p>
       <p>
        Example: An arbitrary number of path elements, including entire
        directories.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">?</code>
       </p>
      </td><td>
       <p>
        Substitutes for any single character, except <code class="literal">/</code>.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">[abc]</code>
       </p>
      </td><td>
       <p>
        Substitutes for the single character <code class="literal">a</code>,
        <code class="literal">b</code>, or <code class="literal">c</code>.
       </p>
       <p>
        Example: a rule that matches <code class="literal">/home[01]/*/.plan</code>
        allows a program to access <code class="filename">.plan</code> files for
        users in both <code class="filename">/home0</code> and
        <code class="filename">/home1</code>.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">[a-c]</code>
       </p>
      </td><td>
       <p>
        Substitutes for the single character <code class="literal">a</code>,
        <code class="literal">b</code>, or <code class="literal">c</code>.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">{ab,cd}</code>
       </p>
      </td><td>
       <p>
        Expands to one rule to match <code class="literal">ab</code> and one rule to
        match <code class="literal">cd</code>.
       </p>
       <p>
        Example: a rule that matches <code class="literal">/{usr,www}/pages/**</code>
        grants access to Web pages in both <code class="filename">/usr/pages</code>
        and <code class="filename">/www/pages</code>.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">[^a]</code>
       </p>
      </td><td>
       <p>
        Substitutes for any character except <code class="literal">a</code>.
       </p>
      </td></tr></tbody></table></div><div class="sect2 " id="sec-apparmor-profiles-flags"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.6.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Profile flags</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-flags">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-flags</li></ul></div></div></div></div><p>
    Profile flags control the behavior of the related profile. You can add
    profile flags to the profile definition by editing it manually, see the
    following syntax:
   </p><div class="verbatim-wrap"><pre class="screen">/path/to/profiled/binary flags=(list_of_flags) {
  [...]
}</pre></div><p>
    You can use multiple flags separated by a comma ',' or space ' '. There
    are three basic types of profile flags: mode, relative, and attach
    flags.
   </p><p>
    <span class="emphasis"><em>Mode</em></span> flag is <code class="literal">complain</code> (illegal
    accesses are allowed and logged). If it is omitted, the profile is in
    <code class="literal">enforce</code> mode (enforces the policy).
   </p><div id="id-1.6.7.5.14.9.6" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg" /><h6>Tip</h6><p>
     A more flexible way of setting the whole profile into complain mode is
     to create a symbolic link from the profile file inside the
     <code class="filename">/etc/apparmor.d/force-complain/</code> directory.
    </p><div class="verbatim-wrap"><pre class="screen">ln -s /etc/apparmor.d/bin.ping /etc/apparmor.d/force-complain/bin.ping</pre></div></div><p>
    <span class="emphasis"><em>Relative</em></span> flags are
    <code class="literal">chroot_relative</code> (states that the profile is relative
    to the chroot instead of namespace) or
    <code class="literal">namespace_relative</code> (the default, with the path being
    relative to outside the chroot). They are mutually exclusive.
   </p><p>
    <span class="emphasis"><em>Attach</em></span> flags consist of two pairs of mutually
    exclusive flags: <code class="literal">attach_disconnected</code> or
    <code class="literal">no_attach_disconnected</code> (determine if path names
    resolved to be outside of the namespace are attached to the root, which
    means they have the '/' character at the beginning), and
    <code class="literal">chroot_attach</code> or <code class="literal">chroot_no_attach</code>
    (control path name generation when in a chroot environment while a file
    is accessed that is external to the chroot but within the namespace).
   </p></div><div class="sect2 " id="sec-apparmor-profiles-glob-variables"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.6.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Using variables in profiles</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-glob-variables">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-glob-variables</li></ul></div></div></div></div><p>
    <span class="phrase">AppArmor</span> allows to use variables holding paths in profiles. Use global
    variables to make your profiles portable and local variables to create
    shortcuts for paths.
   </p><p>
    A typical example of when global variables come in handy are network
    scenarios in which user home directories are mounted in different
    locations. Instead of rewriting paths to home directories in all
    affected profiles, you only need to change the value of a variable.
    Global variables are defined under
    <code class="filename">/etc/apparmor.d/tunables</code> and need to be made
    available via an include statement. Find the variable definitions for
    this use case (<code class="envar">@{HOME}</code> and <code class="envar">@{HOMEDIRS}</code>) in
    the <code class="filename">/etc/apparmor.d/tunables/home</code> file.
   </p><p>
    Local variables are defined at the head of a profile. This is useful to
    provide the base of for a chrooted path, for example:
   </p><div class="verbatim-wrap"><pre class="screen">@{CHROOT_BASE}=/tmp/foo
/sbin/rsyslogd {
...
# chrooted applications
@{CHROOT_BASE}/var/lib/*/dev/log w,
@{CHROOT_BASE}/var/log/** w,
...
}</pre></div><p>
    In the following example, while @{HOMEDIRS} lists where all the user
    home directories are stored, @{HOME} is a space-separated list of home
    directories. Later on, @{HOMEDIRS} is expanded by two new specific
    places where user home directories are stored.
   </p><div class="verbatim-wrap"><pre class="screen">@{HOMEDIRS}=/home/
@{HOME}=@{HOMEDIRS}/*/ /root/
[...]
@{HOMEDIRS}+=/srv/nfs/home/ /mnt/home/</pre></div><div id="id-1.6.7.5.14.10.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
     With the current <span class="phrase">AppArmor</span> tools, variables can only be used when
     manually editing and maintaining a profile.
    </p></div></div><div class="sect2 " id="sec-apparmor-profiles-pattern-matching"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.6.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Pattern matching</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-pattern-matching">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-pattern-matching</li></ul></div></div></div></div><p>
    Profile names can contain globbing expressions allowing the profile to
    match against multiple binaries.
   </p><p>
    The following example is valid for systems where the
    <code class="command">foo</code> binary resides either in
    <code class="filename">/usr/bin</code> or <code class="filename">/bin</code>.
   </p><div class="verbatim-wrap"><pre class="screen">/{usr/,}bin/foo { ... }</pre></div><p>
    In the following example, when matching against the executable
    <code class="filename">/bin/foo</code>, the <code class="literal">/bin/foo</code> profile
    is an exact match so it is chosen. For the executable
    <code class="filename">/bin/fat</code>, the profile <code class="literal">/bin/foo</code>
    does not match, and because the <code class="literal">/bin/f*</code> profile is
    more specific (less general) than <code class="literal">/bin/**</code>, the
    <code class="literal">/bin/f*</code> profile is chosen.
   </p><div class="verbatim-wrap"><pre class="screen">/bin/foo { ... }

/bin/f*  { ... }

/bin/**  { ... }</pre></div><p>
    For more information on profile name globbing examples, see the man page
    of <span class="phrase">AppArmor</span>, <code class="command">man 5 apparmor.d,</code>, section
    <code class="literal">Globbing</code>.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-namespaces"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.6.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Namespaces</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-namespaces">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-namespaces</li></ul></div></div></div></div><p>
    Namespaces are used to provide different profiles sets. Say one for the
    system, another for a chroot environment or container. Namespaces are
    hierarchical—a namespace can see its children but a child
    cannot see its parent. Namespace names start with a colon
    <code class="literal">:</code> followed by an alphanumeric string, a trailing
    colon <code class="literal">:</code> and an optional double slash
    <code class="literal">//</code>, such as
   </p><div class="verbatim-wrap"><pre class="screen">:childNameSpace://</pre></div><p>
    Profiles loaded to a child namespace are prefixed with their
    namespace name (viewed from a parent's perspective):
   </p><div class="verbatim-wrap"><pre class="screen">:childNameSpace://apache</pre></div><p>
    Namespaces can be entered via the <code class="literal">change_profile</code> API,
    or named profile transitions:
   </p><div class="verbatim-wrap"><pre class="screen">/path/to/executable px -&gt; :childNameSpace://apache</pre></div></div><div class="sect2 " id="sec-apparmor-profiles-naming-attachment"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.6.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Profile naming and attachment specification</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-naming-attachment">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-naming-attachment</li></ul></div></div></div></div><p>
    Profiles can have a name, and an attachment specification. This allows
    for profiles with a logical name that can be more meaningful to
    users/administrators than a profile name that contains pattern matching
    (see <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-pattern-matching" title="30.6.3. Pattern matching">Section 30.6.3, “Pattern matching”</a>). For example,
    the default profile
   </p><div class="verbatim-wrap"><pre class="screen">/** { ... }</pre></div><p>
    can be named
   </p><div class="verbatim-wrap"><pre class="screen">profile default /** { ... }</pre></div><p>
    Also, a profile with pattern matching can be named. For example:
   </p><div class="verbatim-wrap"><pre class="screen">/usr/lib64/firefox*/firefox-*bin { ... }</pre></div><p>
    can be named
   </p><div class="verbatim-wrap"><pre class="screen">profile firefox /usr/lib64/firefox*/firefox-*bin { ... }</pre></div></div><div class="sect2 " id="sec-apparmor-profiles-glob-alias"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.6.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Alias rules</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-glob-alias">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-glob-alias</li></ul></div></div></div></div><p>
    Alias rules provide an alternative way to manipulate profile path
    mappings to site specific layouts. They are an alternative form of path
    rewriting to using variables, and are done post variable resolution. The
    alias rule says to treat rules that have the same source prefix as if
    the rules are at target prefix.
   </p><div class="verbatim-wrap"><pre class="screen">alias /home/ -&gt; /usr/home/</pre></div><p>
    All the rules that have a prefix match to <code class="filename">/home/</code>
    provide access to <code class="filename">/usr/home/</code>. For example:
   </p><div class="verbatim-wrap"><pre class="screen">/home/username/** r,</pre></div><p>
    allows as well access to
   </p><div class="verbatim-wrap"><pre class="screen">/usr/home/username/** r,</pre></div><p>
    Aliases provide a quick way of remapping rules without the need to
    rewrite them. They keep the source path still accessible—in our
    example, the alias rule keeps the paths under
    <code class="filename">/home/</code> still accessible.
   </p><p>
    With the <code class="literal">alias</code> rule, you can point to multiple
    targets at the same time.
   </p><div class="verbatim-wrap"><pre class="screen">alias /home/ -&gt; /usr/home/
alias /home/ -&gt; /mnt/home/</pre></div><div id="id-1.6.7.5.14.14.11" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
     With the current <span class="phrase">AppArmor</span> tools, alias rules can only be used when
     manually editing and maintaining a profile.
    </p></div><div id="id-1.6.7.5.14.14.12" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg" /><h6>Tip</h6><p>
     Insert global alias definitions in the file
     <code class="filename">/etc/apparmor.d/tunables/alias</code>.
    </p></div></div></div><div class="sect1 " id="sec-apparmor-profiles-perm"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">File permission access modes</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-perm</li></ul></div></div></div></div><p>
   File permission access modes consist of combinations of the following
   modes:
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /></colgroup><tbody><tr><td>
       <p>
        <code class="literal">r</code>
       </p>
      </td><td>
       <p>
        Read mode
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">w</code>
       </p>
      </td><td>
       <p>
        Write mode (mutually exclusive to <code class="literal">a</code>)
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">a</code>
       </p>
      </td><td>
       <p>
        Append mode (mutually exclusive to <code class="literal">w</code>)
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">k</code>
       </p>
      </td><td>
       <p>
        File locking mode
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">l</code>
       </p>
      </td><td>
       <p>
        Link mode
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">link <em class="replaceable ">FILE</em> -&gt;
        <em class="replaceable ">TARGET</em></code>
       </p>
      </td><td>
       <p>
        Link pair rule (cannot be combined with other access modes)
       </p>
      </td></tr></tbody></table></div><div class="sect2 " id="sec-apparmor-profiles-perm-r"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.7.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Read mode (r)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-r">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-perm-r</li></ul></div></div></div></div><p>
    Allows the program to have read access to the resource. Read access is
    required for shell scripts and other interpreted content and determines
    if an executing process can core dump.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-perm-w"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.7.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Write mode (w)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-w">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-perm-w</li></ul></div></div></div></div><p>
    Allows the program to have write access to the resource. Files must have
    this permission if they are to be unlinked (removed).
   </p></div><div class="sect2 " id="sec-apparmor-profiles-perm-a"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.7.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Append mode (a)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-a">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-perm-a</li></ul></div></div></div></div><p>
    Allows a program to write to the end of a file. In contrast to the
    <code class="literal">w</code> mode, the append mode does not include the ability
    to overwrite data, to rename, or to remove a file. The append permission
    is typically used with applications who need to be able to write to log
    files, but which should not be able to manipulate any existing data in
    the log files. As the append permission is a subset of the permissions
    associated with the write mode, the <code class="literal">w</code> and
    <code class="literal">a</code> permission flags cannot be used together and are
    mutually exclusive.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-perm-k"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.7.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">File locking mode (k)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-k">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-perm-k</li></ul></div></div></div></div><p>
    The application can take file locks. Former versions of <span class="phrase">AppArmor</span> allowed
    files to be locked if an application had access to them. By using a
    separate file locking mode, <span class="phrase">AppArmor</span> makes sure locking is restricted
    only to those files which need file locking and tightens security as
    locking can be used in several denial-of-service attack scenarios.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-perm-link"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.7.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Link mode (l)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-link">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-perm-link</li></ul></div></div></div></div><p>
    The link mode mediates access to hard links. When a link is created, the
    target file must have the same access permissions as the link created
    (but the destination does not need link access).
   </p></div><div class="sect2 " id="sec-apparmor-profiles-perm-link-pair"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.7.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Link pair</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-link-pair">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-perm-link-pair</li></ul></div></div></div></div><p>
    The link mode grants permission to link to arbitrary files, provided the
    link has a subset of the permissions granted by the target (subset
    permission test).
   </p><div class="verbatim-wrap"><pre class="screen">/srv/www/htdocs/index.html rl,</pre></div><p>
    By specifying origin and destination, the link pair rule provides
    greater control over how hard links are created. Link pair rules by
    default do not enforce the link subset permission test that the standard
    rules link permission requires.
   </p><div class="verbatim-wrap"><pre class="screen">link /srv/www/htdocs/index.html -&gt; /var/www/index.html</pre></div><p>
    To force the rule to require the test, the <code class="literal">subset</code>
    keyword is used. The following rules are equivalent:
   </p><div class="verbatim-wrap"><pre class="screen">/var/www/index.html l,
link subset /var/www/index.html -&gt; /**,</pre></div><div id="id-1.6.7.5.15.9.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
     Currently link pair rules are not supported by YaST and the
     command-line tools. Manually edit your profiles to use them. Updating
     such profiles using the tools is safe, because the link pair entries
     are not touched.
    </p></div></div><div class="sect2 " id="sec-apparmor-profiles-perm-file-allow"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.7.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Optional <code class="literal">allow</code> and <code class="literal">file</code> rules</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-file-allow">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-perm-file-allow</li></ul></div></div></div></div><p>
    The <code class="literal">allow</code> prefix is optional, and it is idiomatically
    implied if not specified and the <code class="literal">deny</code> (see
    <a class="xref" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-deny" title="30.7.9. Deny rules">Section 30.7.9, “Deny rules”</a>) keyword is not used.
   </p><div class="verbatim-wrap"><pre class="screen">allow file /example r,
allow /example r,
allow network,</pre></div><p>
    You can also use the optional <code class="literal">file</code> keyword. If you
    omit it and there are no other rule types that start with a keyword,
    such as <code class="literal">network</code> or <code class="literal">mount</code>, it is
    automatically implied.
   </p><div class="verbatim-wrap"><pre class="screen">file /example/rule r,</pre></div><p>
    is equivalent to
   </p><div class="verbatim-wrap"><pre class="screen">/example/rule r,</pre></div><p>
    The following rule grants access to all files:
   </p><div class="verbatim-wrap"><pre class="screen">file,</pre></div><p>
    which is equal to
   </p><div class="verbatim-wrap"><pre class="screen">/** rwmlk,</pre></div><p>
    File rules can use leading or trailing permissions. The permissions
    should not be specified as a trailing permission, but rather used at the
    start of the rule. This is important in that it makes file rules behave
    like any other rule types.
   </p><div class="verbatim-wrap"><pre class="screen">/path rw,            # old style
rw /path,            # leading permission
file rw /path,       # with explicit 'file' keyword
allow file rw /path, # optional 'allow' keyword added</pre></div></div><div class="sect2 " id="sec-apparmor-profiles-perm-owner"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.7.8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Owner conditional rules</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-owner">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-perm-owner</li></ul></div></div></div></div><p>
    The file rules can be extended so that they can be conditional upon
    the user being the owner of the file (the fsuid needs to match the
    file's uid). For this purpose the <code class="literal">owner</code> keyword
    is put in front of the rule. Owner conditional rules accumulate like
    regular file rules do.
   </p><div class="verbatim-wrap"><pre class="screen">owner /home/*/** rw</pre></div><p>
    When using file ownership conditions with link rules the ownership test
    is done against the target file so the user must own the file to be able
    to link to it.
   </p><div id="id-1.6.7.5.15.11.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note: Precedence of regular file rules</h6><p>
     Owner conditional rules are considered a subset of regular file rules.
     If a regular file rule overlaps with an owner conditional file rule,
     the rules are merged. Consider the following example.
    </p><div class="verbatim-wrap"><pre class="screen">/foo r,
owner /foo rw,  # or w,</pre></div><p>
     The rules are merged—it results in <code class="literal">r</code> for
     everybody, and <code class="literal">w</code> for the owner only.
    </p></div><div id="id-1.6.7.5.15.11.6" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg" /><h6>Tip</h6><p>
     To address everybody <span class="emphasis"><em>but</em></span> the owner of the file,
     use the keyword <code class="literal">other</code>.
    </p><div class="verbatim-wrap"><pre class="screen">owner /foo rw,
other /foo r,</pre></div></div></div><div class="sect2 " id="sec-apparmor-profiles-perm-deny"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.7.9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Deny rules</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-perm-deny">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-perm-deny</li></ul></div></div></div></div><p>
    Deny rules can be used to annotate or quiet known rejects. The
    profile generating tools do not ask about a known reject treated
    with a deny rule. Such a reject does not show up in the audit
    logs when denied, keeping the log files lean. If this is not
    desired, put the keyword <code class="literal">audit</code> in front of the
    deny entry.
   </p><p>
    It is also possible to use deny rules in combination with allow rules.
    This allows you to specify a broad allow rule, and then subtract a few
    known files that should not be allowed. Deny rules can also be combined
    with owner rules, to deny files owned by the user. The following example
    allows read/write access to everything in a users directory except write
    access to the <code class="filename">.ssh/</code> files:
   </p><div class="verbatim-wrap"><pre class="screen">deny /home/*/.ssh/** w,
owner /home/*/** rw,</pre></div><p>
    The extensive use of deny rules is generally not encouraged, because it
    makes it much harder to understand what a profile does. However a
    judicious use of deny rules can simplify profiles. Therefore the tools
    only generate profiles denying specific files and do not use
    globbing in deny rules. Manually edit your profiles to add deny rules
    using globbing. Updating such profiles using the tools is safe, because
    the deny entries are not touched.
   </p></div></div><div class="sect1 " id="sec-apparmor-profiles-mount"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Mount rules</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-mount">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-mount</li></ul></div></div></div></div><p>
   <span class="phrase">AppArmor</span> can limit mount and unmount operations, including file system
   types and mount flags. The rule syntax is based on the
   <code class="command">mount</code> command syntax and starts with one of the
   keywords <code class="literal">mount</code>, <code class="literal">remount</code>, or
   <code class="literal">umount</code>. Conditions are optional and unspecified
   conditionals are assumed to match all entries. For example, not
   specifying a file system means that all file systems are matched.
  </p><p>
   Conditionals can be specified by specifying conditionals with
   <code class="literal">options=</code> or <code class="literal">options in</code>.
  </p><p>
    <code class="literal">options=</code> specifies conditionals that have to be met
    exactly. The rule
  </p><div class="verbatim-wrap"><pre class="screen">mount options=ro /dev/foo -E /mnt/,</pre></div><p>
    matches
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro /dev/foo /mnt</code></pre></div><p>
    but does not match
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro,atime /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o rw /dev/foo /mnt</code></pre></div><p>
   <code class="literal">options in</code> requires that at least one of the
   listed mount options is used. The rule
  </p><div class="verbatim-wrap"><pre class="screen">mount options in (ro,atime) /dev/foo -&gt; /mnt/,</pre></div><p>
   matches
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o ro,atime /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o atime /dev/foo /mnt</code></pre></div><p>
   but does not match
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro,sync /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o ro,atime,sync /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o rw /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o rw,noatime /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount /dev/foo /mnt</code></pre></div><p>
   With multiple conditionals, the rule grants permission for each set
   of options. The rule
  </p><div class="verbatim-wrap"><pre class="screen">mount options=ro options=atime</pre></div><p>
   matches
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o atime /dev/foo /mnt</code></pre></div><p>
   but does not match
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro,atime /dev/foo /mnt</code></pre></div><p>
   Separate mount rules are distinct and the options do not accumulate.
   The rules
  </p><div class="verbatim-wrap"><pre class="screen">mount options=ro,
mount options=atime,</pre></div><p>
   are not equivalent to
  </p><div class="verbatim-wrap"><pre class="screen">mount options=(ro,atime),
mount options in (ro,atime),</pre></div><p>
   The following rule allows mounting <code class="filename">/dev/foo</code> on
   <code class="filename">/mnt/</code> read only and using inode access times or
   allows mounting <code class="filename">/dev/foo</code> on
   <code class="filename">/mnt/</code> with some combination of 'nodev' and
   'user'.
  </p><div class="verbatim-wrap"><pre class="screen">mount options=(ro, atime) options in (nodev, user) /dev/foo -&gt; /mnt/,</pre></div><p>
   allows
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">mount -o ro,atime /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o nodev /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o user /dev/foo /mnt</code>
<code class="prompt root"># </code><code class="command">mount -o nodev,user /dev/foo /mnt</code></pre></div></div><div class="sect1 " id="sec-apparmor-profiles-pivot-root"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Pivot root rules</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-pivot-root">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-pivot-root</li></ul></div></div></div></div><p>
   <span class="phrase">AppArmor</span> can limit changing the root file system. The syntax is
  </p><div class="verbatim-wrap"><pre class="screen">pivot_root [oldroot=<em class="replaceable ">OLD_ROOT</em>] <em class="replaceable ">NEW_ROOT</em></pre></div><p>
   The paths specified in 'pivot_root' rules must end with '/' since they
   are directories.
  </p><div class="verbatim-wrap"><pre class="screen"># Allow any pivot
pivot_root,

# Allow pivoting to any new root directory and putting the old root
# directory at /mnt/root/old/
pivot_root oldroot=/mnt/root/old/,

# Allow pivoting the root directory to /mnt/root/
pivot_root /mnt/root/,

# Allow pivoting to /mnt/root/ and putting the old root directory at
# /mnt/root/old/
pivot_root oldroot=/mnt/root/old/ /mnt/root/,

# Allow pivoting to /mnt/root/, putting the old root directory at
# /mnt/root/old/ and transition to the /mnt/root/sbin/init profile
pivot_root oldroot=/mnt/root/old/ /mnt/root/ -&gt; /mnt/root/sbin/init,</pre></div></div><div class="sect1 " id="sec-apparmor-profiles-ptrace"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.10 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">PTrace rules</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-ptrace">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-ptrace</li></ul></div></div></div></div><p>
   <span class="phrase">AppArmor</span> supports limiting ptrace system calls. ptrace rules are
   accumulated so that the granted ptrace permissions are the union of
   all the listed ptrace rule permissions. If a rule does not specify
   an access list, permissions are implicitly granted.
  </p><p>
   The <code class="literal">trace</code> and <code class="literal">tracedby</code>
   permissions control ptrace(2); <code class="literal">read</code> and
   <code class="literal">readby</code> control proc(5) file system access,
   kcmp(2), futexes (get_robust_list(2)) and perf trace events.
  </p><p>
   For a ptrace operation to be allowed, the tracing and traced
   processes need the correct permissions. This means that the tracing
   process needs the <code class="literal">trace</code> permission and the traced
   process needs the <code class="literal">tracedby</code> permission.
  </p><p>
   Example AppArmor PTrace rules:
  </p><div class="verbatim-wrap"><pre class="screen"># Allow all PTrace access
ptrace,

# Explicitly allow all PTrace access,
ptrace (read, readby, trace, tracedby),

# Explicitly deny use of ptrace(2)
deny ptrace (trace),

# Allow unconfined processes (eg, a debugger) to ptrace us
ptrace (readby, tracedby) peer=unconfined,

# Allow ptrace of a process running under the /usr/bin/foo profile
ptrace (trace) peer=/usr/bin/foo,</pre></div></div><div class="sect1 " id="sec-apparmor-profiles-signal"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.11 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Signal rules</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-signal">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-signal</li></ul></div></div></div></div><p>
   <span class="phrase">AppArmor</span> supports limiting inter-process signals. AppArmor signal rules
   are accumulated so that the granted signal permissions are the union
   of all the listed signal rule permissions. <span class="phrase">AppArmor</span> signal permissions
   are implied when a rule does not explicitly state an access list.
  </p><p>
   The sending and receiving process must both have the correct
   permissions.
  </p><p>
   Example signal rules:
  </p><div class="verbatim-wrap"><pre class="screen"># Allow all signal access
signal,

# Explicitly deny sending the HUP and INT signals
deny signal (send) set=(hup, int),

# Allow unconfined processes to send us signals
signal (receive) peer=unconfined,

# Allow sending of signals to a process running under the /usr/bin/foo
# profile
signal (send) peer=/usr/bin/foo,

# Allow checking for PID existence
signal (receive, send) set=("exists"),

# Allow us to signal ourselves using the built-in @{profile_name} variable
signal peer=@{profile_name},

# Allow two real-time signals
signal set=(rtmin+0 rtmin+32),</pre></div></div><div class="sect1 " id="sec-apparmor-profiles-exec"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.12 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Execute modes</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec</li></ul></div></div></div></div><p>
   Execute modes, also named profile transitions, consist of the following
   modes:
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /></colgroup><tbody><tr><td>
       <p>
        <code class="literal">Px</code>
       </p>
      </td><td>
       <p>
        Discrete profile execute mode
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">Cx</code>
       </p>
      </td><td>
       <p>
        Discrete local profile execute mode
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">Ux</code>
       </p>
      </td><td>
       <p>
        Unconfined execute mode
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">ix</code>
       </p>
      </td><td>
       <p>
        Inherit execute mode
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">m</code>
       </p>
      </td><td>
       <p>
        Allow <code class="literal">PROT_EXEC</code> with <code class="command">mmap(2)</code>
        calls
       </p>
      </td></tr></tbody></table></div><div class="sect2 " id="sec-apparmor-profiles-exec-px"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.12.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Discrete profile execute mode (px)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-px">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec-px</li></ul></div></div></div></div><p>
    This mode requires that a discrete security profile is defined for a
    resource executed at an <span class="phrase">AppArmor</span> domain transition. If there is no
    profile defined, the access is denied.
   </p><p>
    Incompatible with <code class="literal">Ux</code>, <code class="literal">ux</code>,
    <code class="literal">px</code>, and <code class="literal">ix</code>.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-exec-cx"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.12.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Discrete local profile execute mode (cx)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-cx">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec-cx</li></ul></div></div></div></div><p>
    As <code class="literal">Px</code>, but instead of searching the global profile
    set, <code class="literal">Cx</code> only searches the local profiles of the
    current profile. This profile transition provides a way for an
    application to have alternate profiles for helper applications.
   </p><div id="id-1.6.7.5.20.5.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note: Limitations of the discrete local profile execute mode (cx)</h6><p>
     Currently, Cx transitions are limited to top level profiles and cannot
     be used in hats and children profiles. This restriction will be removed
     in the future.
    </p></div><p>
    Incompatible with <code class="literal">Ux</code>, <code class="literal">ux</code>,
    <code class="literal">Px</code>, <code class="literal">px</code>, <code class="literal">cx</code>, and
    <code class="literal">ix</code>.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-exec-ux"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.12.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Unconfined execute mode (ux)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-ux">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec-ux</li></ul></div></div></div></div><p>
    Allows the program to execute the resource without any <span class="phrase">AppArmor</span> profile
    applied to the executed resource. This mode is useful when a confined
    program needs to be able to perform a privileged operation, such as
    rebooting the machine. By placing the privileged section in another
    executable and granting unconfined execution rights, it is possible to
    bypass the mandatory constraints imposed on all confined processes.
    Allowing a root process to go unconfined means it can change <span class="phrase">AppArmor</span>
    policy itself. For more information about what is constrained, see the
    <code class="systemitem">apparmor(7)</code> man page.
   </p><p>
    This mode is incompatible with <code class="literal">ux</code>,
    <code class="literal">px</code>, <code class="literal">Px</code>, and <code class="literal">ix</code>.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-exec-clean"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.12.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Unsafe exec modes</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-clean">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec-clean</li></ul></div></div></div></div><p>
    Use the lowercase versions of exec modes—<code class="literal">px</code>,
    <code class="literal">cx</code>, <code class="literal">ux</code>—only in
    special cases. They do not scrub the environment of variables such as
    <code class="envar">LD_PRELOAD</code>. As a result, the calling domain may have an
    undue amount of influence over the called resource. Use these modes only
    if the child absolutely <span class="emphasis"><em>must</em></span> be run unconfined and
    <code class="envar">LD_PRELOAD</code> must be used. Any profile using such modes
    provides negligible security. Use at your own risk.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-exec-ix"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.12.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Inherit execute mode (ix)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-ix">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec-ix</li></ul></div></div></div></div><p>
    <code class="literal">ix</code> prevents the normal <span class="phrase">AppArmor</span> domain transition on
    <code class="command">execve(2)</code> when the profiled program executes the
    named program. Instead, the executed resource inherits the current
    profile.
   </p><p>
    This mode is useful when a confined program needs to call another
    confined program without gaining the permissions of the target's profile
    or losing the permissions of the current profile. There is no version to
    scrub the environment because <code class="literal">ix</code> executions do not
    change privileges.
   </p><p>
    Incompatible with <code class="literal">cx</code>, <code class="literal">ux</code>, and
    <code class="literal">px</code>. Implies <code class="literal">m</code>.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-exec-m"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.12.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Allow executable mapping (m)</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-m">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec-m</li></ul></div></div></div></div><p>
    This mode allows a file to be mapped into memory using
    <code class="command">mmap(2)</code>'s <code class="envar">PROT_EXEC</code> flag. This flag
    marks the pages executable. It is used on certain architectures to provide
    non executable data pages, which can complicate exploit attempts.
    <span class="phrase">AppArmor</span> uses this mode to limit which files a well-behaved program (or
    all programs on architectures that enforce non executable memory access
    controls) may use as libraries, to limit the effect of invalid
    <code class="option">-L</code> flags given to <code class="command">ld(1)</code> and
    <code class="envar">LD_PRELOAD</code>, <code class="envar">LD_LIBRARY_PATH</code>, given to
    <code class="command">ld.so(8)</code>.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-exec-named"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.12.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Named profile transitions</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-named">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec-named</li></ul></div></div></div></div><p>
    By default, the <code class="literal">px</code> and <code class="literal">cx</code> (and
    their clean exec variants, too) transition to a profile whose name
    matches the executable name. With named profile transitions, you can
    specify a profile to be transitioned to. This is useful if multiple
    binaries need to share a single profile, or if they need to use a
    different profile than their name would specify. Named profile
    transitions can be used with <code class="literal">cx</code>,
    <code class="literal">Cx</code>, <code class="literal">px</code> and <code class="literal">Px</code>.
    Currently there is a limit of twelve named profile transitions per
    profile.
   </p><p>
    Named profile transitions use <code class="literal">-&gt;</code> to indicate the
    name of the profile that needs to be transitioned to:
   </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/foo
{
  /bin/** px -&gt; shared_profile,
  ...
  /usr/*bash cx -&gt; local_profile,
  ...
  profile local_profile
  {
    ...
  }
}</pre></div><div id="id-1.6.7.5.20.10.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note: Difference between normal and named transitions</h6><p>
     When used with globbing, normal transitions provide a <span class="quote">“<span class="quote ">one to
     many</span>”</span> relationship—<code class="literal">/bin/** px</code> transitions
     to <code class="filename">/bin/ping</code>,
     <code class="filename">/bin/cat</code>, etc, depending on the program being run.
    </p><p>
     Named transitions provide a <span class="quote">“<span class="quote ">many to one</span>”</span>
     relationship—all programs that match the rule regardless of
     their name transition to the specified profile.
    </p><p>
     Named profile transitions show up in the log as having the mode
     <code class="literal">Nx</code>. The name of the profile to be changed to is
     listed in the <code class="literal">name2</code> field.
    </p></div></div><div class="sect2 " id="sec-apparmor-profiles-exec-fallback"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.12.8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Fallback modes for profile transitions</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-fallback">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec-fallback</li></ul></div></div></div></div><p>
    The <code class="literal">px</code> and <code class="literal">cx</code> transitions specify
    a hard dependency—if the specified profile does not exist, the
    exec fails. With the inheritance fallback, the execution
    succeeds but inherits the current profile. To specify inheritance
    fallback, <code class="literal">ix</code> is combined with <code class="literal">cx</code>,
    <code class="literal">Cx</code>, <code class="literal">px</code> and <code class="literal">Px</code>
    into the modes <code class="literal">cix</code>, <code class="literal">Cix</code>,
    <code class="literal">pix</code> and <code class="literal">Pix</code>.
   </p><div class="verbatim-wrap"><pre class="screen">/path Cix -&gt; profile_name,</pre></div><p>
    or
   </p><div class="verbatim-wrap"><pre class="screen">Cix /path -&gt; profile_name,</pre></div><p>
    where <code class="literal">-&gt; profile_name</code> is optional.
   </p><p>
    The same applies if you add the unconfined <code class="literal">ux</code> mode,
    where the resulting modes are <code class="literal">cux</code>,
    <code class="literal">CUx</code>, <code class="literal">pux</code> and
    <code class="literal">PUx</code>. These modes allow falling back to
    <span class="quote">“<span class="quote ">unconfined</span>”</span> when the specified profile is not found.
   </p><div class="verbatim-wrap"><pre class="screen">/path PUx -&gt; profile_name,</pre></div><p>
    or
   </p><div class="verbatim-wrap"><pre class="screen">PUx /path -&gt; profile_name,</pre></div><p>
    where <code class="literal">-&gt; profile_name</code> is optional.
   </p><p>
    The fallback modes can be used with named profile transitions, too.
   </p></div><div class="sect2 " id="sec-apparmor-profiles-exec-variables"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.12.9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Variable settings in execution modes</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-variables">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec-variables</li></ul></div></div></div></div><p>
    When choosing one of the Px, Cx or Ux execution modes, take into account
    that the following environment variables are removed from the
    environment before the child process inherits it. As a consequence,
    applications or processes relying on any of these variables do not work
    anymore if the profile applied to them carries Px, Cx or Ux flags:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      <code class="envar">GCONV_PATH</code>
     </p></li><li class="listitem "><p>
      <code class="envar">GETCONF_DIR</code>
     </p></li><li class="listitem "><p>
      <code class="envar">HOSTALIASES</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LD_AUDIT</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LD_DEBUG</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LD_DEBUG_OUTPUT</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LD_DYNAMIC_WEAK</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LD_LIBRARY_PATH</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LD_ORIGIN_PATH</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LD_PRELOAD</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LD_PROFILE</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LD_SHOW_AUXV</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LD_USE_LOAD_BIAS</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LOCALDOMAIN</code>
     </p></li><li class="listitem "><p>
      <code class="envar">LOCPATH</code>
     </p></li><li class="listitem "><p>
      <code class="envar">MALLOC_TRACE</code>
     </p></li><li class="listitem "><p>
      <code class="envar">NLSPATH</code>
     </p></li><li class="listitem "><p>
      <code class="envar">RESOLV_HOST_CONF</code>
     </p></li><li class="listitem "><p>
      <code class="envar">RES_OPTIONS</code>
     </p></li><li class="listitem "><p>
      <code class="envar">TMPDIR</code>
     </p></li><li class="listitem "><p>
      <code class="envar">TZDIR</code>
     </p></li></ul></div></div><div class="sect2 " id="sec-apparmor-profiles-exec-clean-keywords"><div class="titlepage"><div><div><h3 class="title"><span class="number">30.12.10 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name"><code class="literal">safe</code> and <code class="literal">unsafe</code> keywords</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-exec-clean-keywords">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-exec-clean-keywords</li></ul></div></div></div></div><p>
    You can use the <code class="literal">safe</code> and <code class="literal">unsafe</code>
    keywords for rules instead of using the case modifier of execution
    modes. For example
   </p><div class="verbatim-wrap"><pre class="screen">/example_rule Px,</pre></div><p>
    is the same as any of the following
   </p><div class="verbatim-wrap"><pre class="screen">safe /example_rule px,
safe /example_rule Px,
safe px /example_rule,
safe Px /example_rule,</pre></div><p>
    and the rule
   </p><div class="verbatim-wrap"><pre class="screen">/example_rule px,</pre></div><p>
    is the same as any of
   </p><div class="verbatim-wrap"><pre class="screen">unsafe /example_rule px,
unsafe /example_rule Px,
unsafe px /example_rule,
unsafe Px /example_rule,</pre></div><p>
    The <code class="literal">safe</code>/<code class="literal">unsafe</code> keywords are
    mutually exclusive and can be used in a file rule after the
    <code class="literal">owner</code> keyword, so the order of rule keywords is
   </p><div class="verbatim-wrap"><pre class="screen">[audit] [deny] [owner] [safe|unsafe] file_rule</pre></div></div></div><div class="sect1 " id="sec-apparmor-profiles-rlimit"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.13 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Resource limit control</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-rlimit">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-rlimit</li></ul></div></div></div></div><p>
   <span class="phrase">AppArmor</span> can set and control an application's resource
   limits (rlimits, also known as ulimits). By default, <span class="phrase">AppArmor</span> does not
   control an application's rlimits, and it controls those limits
   specified in the confining profile. For more information about resource
   limits, refer to the <code class="systemitem">setrlimit(2)</code>,
   <code class="systemitem">ulimit(1)</code>, or <code class="systemitem">ulimit(3)</code>
   man pages.
  </p><p>
   <span class="phrase">AppArmor</span> leverages the system's rlimits and as such does not provide an
   additional auditing that would normally occur. It also cannot raise
   rlimits set by the system, <span class="phrase">AppArmor</span> rlimits can only reduce an
   application's current resource limits.
  </p><p>
   The values are inherited by the children of a process and remain
   even if a new profile is transitioned to or the application becomes
   unconfined. So when an application transitions to a new profile, that
   profile can further reduce the application's rlimits.
  </p><p>
   <span class="phrase">AppArmor</span>'s rlimit rules provide mediation of setting an
   application's hard limits, should it try to raise them. The application
   cannot raise its hard limits any further than specified in
   the profile. The mediation of raising hard limits is not inherited as the
   set value is, so that when the application transitions to a new profile
   it is free to raise its limits as specified in the profile.
  </p><p>
   <span class="phrase">AppArmor</span>'s rlimit control does not affect an application's soft limits
   beyond ensuring that they are less than or equal to the application's
   hard limits.
  </p><p>
   <span class="phrase">AppArmor</span>'s hard limit rules have the general form of:
  </p><div class="verbatim-wrap"><pre class="screen">set rlimit <em class="replaceable ">RESOURCE</em> &lt;= <em class="replaceable ">value</em>,</pre></div><p>
   where <em class="replaceable ">RESOURCE</em> and
   <em class="replaceable ">VALUE</em> are to be replaced with the following
   values:
  </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.6.7.5.21.10.1"><span class="term "><code class="literal">cpu</code>
    </span></dt><dd><p>
      CPU time limit in seconds.
     </p></dd><dt id="id-1.6.7.5.21.10.2"><span class="term "><code class="literal">fsize</code>, <code class="literal">data</code>, <code class="literal">stack</code>,
      <code class="literal">core</code>, <code class="literal">rss</code>, <code class="literal">as</code>,
      <code class="literal">memlock</code>, <code class="literal">msgqueue</code>
    </span></dt><dd><p>
      a number in bytes, or a number with a suffix where the suffix can be
      K/KB (kilobytes), M/MB (megabytes), G/GB (gigabytes), for example
     </p><div class="verbatim-wrap"><pre class="screen">rlimit data &lt;= 100M,</pre></div></dd><dt id="id-1.6.7.5.21.10.3"><span class="term "><code class="literal">fsize</code>, <code class="literal">nofile</code>, <code class="literal">locks</code>,
      <code class="literal">sigpending</code>, <code class="literal">nproc</code>,
      <code class="literal">rtprio</code>
    </span></dt><dd><p>
      a number greater or equal to 0
     </p></dd><dt id="id-1.6.7.5.21.10.4"><span class="term "><code class="literal">nice</code>
    </span></dt><dd><p>
      a value between -20 and 19
     </p></dd></dl></div><div id="id-1.6.7.5.21.11" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
   The nproc rlimit is handled different than all the other rlimits.
   Instead of indicating the standard process rlimit,
   it controls the maximum number of processes that can be running under the
   profile at any time. When the limit is exceeded, the creation of new
   processes under the profile fails until the number of currently
   running processes is reduced.
  </p></div><div id="id-1.6.7.5.21.12" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
    Currently the tools cannot be used to add rlimit rules to profiles. The
    only way to add rlimit controls to a profile is to manually edit the
    profile with a text editor. The tools still work with profiles
    containing rlimit rules and will not remove them, so it is safe to use
    the tools to update profiles containing them.
   </p></div></div><div class="sect1 " id="sec-apparmor-profiles-audit"><div class="titlepage"><div><div><h2 class="title"><span class="number">30.14 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Auditing rules</span> <a title="Permalink" class="permalink" href="cha-apparmor-profiles.html#sec-apparmor-profiles-audit">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/apparmor_profiles.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>apparmor_profiles.xml</li><li><span class="ds-label">ID: </span>sec-apparmor-profiles-audit</li></ul></div></div></div></div><p>
   <span class="phrase">AppArmor</span> provides the ability to audit given rules so that when they are
   matched, an audit message appears in the audit log. To enable audit
   messages for a given rule, the <code class="literal">audit</code> keyword is
   put in front of the rule:
  </p><div class="verbatim-wrap"><pre class="screen">audit /etc/foo/*        rw,</pre></div><p>
   If it is desirable to audit only a given permission, the rule can be split
   into two rules. The following example results in audit messages when
   files are opened for writing, but not when they are opened for reading:
  </p><div class="verbatim-wrap"><pre class="screen">audit /etc/foo/*  w,
/etc/foo/*        r,</pre></div><div id="id-1.6.7.5.22.6" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
    Audit messages are not generated for every read or write of a file but
    only when a file is opened for reading or writing.
   </p></div><p>
   Audit control can be combined with
   <code class="literal">owner</code>/<code class="literal">other</code> conditional file rules
   to provide auditing when users access files they own/do not own:
  </p><div class="verbatim-wrap"><pre class="screen">audit owner /home/*/.ssh/**       rw,
audit other /home/*/.ssh/**       r,</pre></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha-apparmor-repos.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 31 </span><span class="phrase">AppArmor</span> profile repositories</span></a><a class="nav-link" href="cha-apparmor-concept.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 29 </span>Immunizing programs</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2024 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>