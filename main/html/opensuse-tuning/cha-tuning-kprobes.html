<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Kernel probes | System Analysis and Tuning Guide | openSUSE Leap 15.6</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" />
<meta name="title" content="Kernel probes | openSUSE Leap 15.6" />
<meta name="description" content="Kernel probes are a set of tools to collect Linux kernel debugging and performance information. Developers and system administrators use them either to debug t…" />
<meta name="product-name" content="openSUSE Leap" />
<meta name="product-number" content="15.6" />
<meta name="book-title" content="System Analysis and Tuning Guide" />
<meta name="chapter-title" content="Chapter 5. Kernel probes" />
<meta name="tracker-url" content="https://bugzilla.opensuse.org/enter_bug.cgi" />
<meta name="tracker-type" content="bsc" />
<meta name="tracker-bsc-assignee" content="fs@suse.com" />
<meta name="tracker-bsc-component" content="Documentation" />
<meta name="tracker-bsc-product" content="openSUSE Distribution" />
<meta name="tracker-bsc-version" content="Leap 15.4" />
<meta property="og:title" content="Kernel probes | openSUSE Leap 15.6" />
<meta property="og:description" content="Kernel probes are a set of tools to collect Linux kernel debugging and performance information. Developers and system administrators use them either to debug t…" />
<meta property="og:type" content="article" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Kernel probes | openSUSE Leap 15.6" />
<meta name="twitter:description" content="Kernel probes are a set of tools to collect Linux kernel debugging and performance information. Developers and system administrators use them either to debug t…" />
<link rel="home" href="index.html" title="openSUSE Leap Documentation" /><link rel="up" href="part-tuning-kerneltrace.html" title="Part III. Kernel monitoring" /><link rel="prev" href="cha-tuning-systemtap.html" title="Chapter 4. SystemTap—filtering and analyzing system data" /><link rel="next" href="cha-perf.html" title="Chapter 6. Hardware-based performance monitoring with Perf" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" /></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #E11;"><div id="_header"><div id="_logo"><img src="static/images/logo.svg" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="System Analysis and Tuning Guide"><span class="book-icon">System Analysis and Tuning Guide</span></a><span> › </span><a class="crumb" href="part-tuning-kerneltrace.html">Kernel monitoring</a><span> › </span><a class="crumb" href="cha-tuning-kprobes.html">Kernel probes</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>System Analysis and Tuning Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface-tuning.html"><span class="number"> </span><span class="name">Preface</span></a></li><li class="inactive"><a href="part-tuning-basics.html"><span class="number">I </span><span class="name">Basics</span></a><ol><li class="inactive"><a href="cha-tuning-basics.html"><span class="number">1 </span><span class="name">General notes on system tuning</span></a></li></ol></li><li class="inactive"><a href="part-tuning-monitoring.html"><span class="number">II </span><span class="name">System monitoring</span></a><ol><li class="inactive"><a href="cha-util.html"><span class="number">2 </span><span class="name">System monitoring utilities</span></a></li><li class="inactive"><a href="cha-tuning-syslog.html"><span class="number">3 </span><span class="name">System log files</span></a></li></ol></li><li class="inactive"><a href="part-tuning-kerneltrace.html"><span class="number">III </span><span class="name">Kernel monitoring</span></a><ol><li class="inactive"><a href="cha-tuning-systemtap.html"><span class="number">4 </span><span class="name">SystemTap—filtering and analyzing system data</span></a></li><li class="inactive"><a href="cha-tuning-kprobes.html"><span class="number">5 </span><span class="name">Kernel probes</span></a></li><li class="inactive"><a href="cha-perf.html"><span class="number">6 </span><span class="name">Hardware-based performance monitoring with Perf</span></a></li><li class="inactive"><a href="cha-tuning-oprofile.html"><span class="number">7 </span><span class="name">OProfile—system-wide profiler</span></a></li><li class="inactive"><a href="cha-tuning-dynamic-debug.html"><span class="number">8 </span><span class="name">Dynamic debug—kernel debugging messages</span></a></li></ol></li><li class="inactive"><a href="part-tuning-resources.html"><span class="number">IV </span><span class="name">Resource management</span></a><ol><li class="inactive"><a href="cha-tuning-resources.html"><span class="number">9 </span><span class="name">General system resource management</span></a></li><li class="inactive"><a href="cha-tuning-cgroups.html"><span class="number">10 </span><span class="name">Kernel control groups</span></a></li><li class="inactive"><a href="cha-tuning-numactl.html"><span class="number">11 </span><span class="name">Automatic Non-Uniform Memory Access (NUMA) balancing</span></a></li><li class="inactive"><a href="cha-tuning-power.html"><span class="number">12 </span><span class="name">Power management</span></a></li></ol></li><li class="inactive"><a href="part-tuning-kernel.html"><span class="number">V </span><span class="name">Kernel tuning</span></a><ol><li class="inactive"><a href="cha-tuning-io.html"><span class="number">13 </span><span class="name">Tuning I/O performance</span></a></li><li class="inactive"><a href="cha-tuning-taskscheduler.html"><span class="number">14 </span><span class="name">Tuning the task scheduler</span></a></li><li class="inactive"><a href="cha-tuning-memory.html"><span class="number">15 </span><span class="name">Tuning the memory management subsystem</span></a></li><li class="inactive"><a href="cha-tuning-network.html"><span class="number">16 </span><span class="name">Tuning the network</span></a></li></ol></li><li class="inactive"><a href="part-tuning-dumps.html"><span class="number">VI </span><span class="name">Handling system dumps</span></a><ol><li class="inactive"><a href="cha-tuning-tracing.html"><span class="number">17 </span><span class="name">Tracing tools</span></a></li><li class="inactive"><a href="cha-tuning-kexec.html"><span class="number">18 </span><span class="name">Kexec and Kdump</span></a></li><li class="inactive"><a href="cha-tuning-systemd-coredump.html"><span class="number">19 </span><span class="name">Using <code class="systemitem">systemd-coredump</code> to debug application crashes</span></a></li></ol></li><li class="inactive"><a href="part-tuning-ptp.html"><span class="number">VII </span><span class="name">Synchronized clocks with Precision Time Protocol</span></a><ol><li class="inactive"><a href="cha-tuning-ptp.html"><span class="number">20 </span><span class="name">Precision Time Protocol</span></a></li></ol></li><li class="inactive"><a href="bk05apa.html"><span class="number">A </span><span class="name">GNU licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 4. SystemTap—filtering and analyzing system data" href="cha-tuning-systemtap.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 6. Hardware-based performance monitoring with Perf" href="cha-perf.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #E11;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="System Analysis and Tuning Guide"><span class="book-icon">System Analysis and Tuning Guide</span></a><span> › </span><a class="crumb" href="part-tuning-kerneltrace.html">Kernel monitoring</a><span> › </span><a class="crumb" href="cha-tuning-kprobes.html">Kernel probes</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 4. SystemTap—filtering and analyzing system data" href="cha-tuning-systemtap.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 6. Hardware-based performance monitoring with Perf" href="cha-perf.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha-tuning-kprobes"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname "><span class="productname"><span class="phrase">openSUSE Leap</span></span></span> <span class="productnumber "><span class="productnumber"><span class="phrase">15.6</span></span></span></div><div><h2 class="title"><span class="number">5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Kernel probes</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha-tuning-kprobes.html#cha-tuning-kprobes-supparch"><span class="number">5.1 </span><span class="name">Supported architectures</span></a></span></dt><dt><span class="sect1"><a href="cha-tuning-kprobes.html#cha-tuning-kprobes-types"><span class="number">5.2 </span><span class="name">Types of kernel probes</span></a></span></dt><dt><span class="sect1"><a href="cha-tuning-kprobes.html#cha-tuning-kprobes-api"><span class="number">5.3 </span><span class="name">Kprobes API</span></a></span></dt><dt><span class="sect1"><a href="cha-tuning-kprobes.html#cha-tuning-kprobes-debugfs"><span class="number">5.4 </span><span class="name"><code class="systemitem">debugfs</code> Interface</span></a></span></dt><dt><span class="sect1"><a href="cha-tuning-kprobes.html#cha-tuning-kprobes-moreinfo"><span class="number">5.5 </span><span class="name">More information</span></a></span></dt></dl></div></div><p>
  Kernel probes are a set of tools to collect Linux kernel debugging and
  performance information. Developers and system administrators use
  them either to debug the kernel, or to find system performance
  bottlenecks. The reported data can then be used to tune the system for
  better performance.
 </p><p>
  You can insert these probes into any kernel routine, and specify a handler
  to be invoked after a particular break-point is hit. The main advantage of
  kernel probes is that you no longer need to rebuild the kernel and reboot
  the system after you make changes in a probe.
 </p><p>
  To use kernel probes, you typically need to write or obtain a specific
  kernel module. Such modules include both the <span class="emphasis"><em>init</em></span> and
  the <span class="emphasis"><em>exit</em></span> function. The init function (such as
  <code class="systemitem">register_kprobe()</code>) registers one or more probes,
  while the exit function unregisters them. The registration function
  defines <span class="emphasis"><em>where</em></span> the probe is inserted and
  <span class="emphasis"><em>which handler</em></span> is called after the probe is hit.
  To register or unregister a group of probes at one time, you can use
  relevant
  <code class="literal">register_&lt;<em class="replaceable ">PROBE_TYPE</em>&gt;probes()</code>
  or
  <code class="literal">unregister_&lt;<em class="replaceable ">PROBE_TYPE</em>&gt;probes()</code>
  functions.
 </p><p>
  Debugging and status messages are typically reported with the
  <code class="systemitem">printk</code> kernel routine.
  <code class="systemitem">printk</code> is a kernel space equivalent of a
  user space <code class="systemitem">printf</code> routine. For more information
  on <code class="systemitem">printk</code>, see
  <a class="link" href="https://www.win.tue.nl/~aeb/linux/lk/lk-2.html#ss2.8" target="_blank">Logging
  kernel messages</a>. Normally, you can view these messages by
  inspecting the output of the <code class="systemitem">systemd</code> journal (see
  <span class="intraxref">Book “Reference”, Chapter 11 “<code class="command">journalctl</code>: query the <code class="systemitem">systemd</code> journal”</span>). For more information on log files, see
  <a class="xref" href="cha-tuning-syslog.html" title="Chapter 3. System log files">Chapter 3, <em>System log files</em></a>.
 </p><div class="sect1 " id="cha-tuning-kprobes-supparch"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Supported architectures</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#cha-tuning-kprobes-supparch">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes-supparch</li></ul></div></div></div></div><p>
   Kernel probes are <span class="emphasis"><em>fully</em></span> implemented on the following
   architectures:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     x86
    </p></li><li class="listitem "><p>
     AMD64/Intel 64
    </p></li><li class="listitem "><p>
     Arm
    </p></li><li class="listitem "><p>
     POWER
    </p></li></ul></div><p>
   Kernel probes are <span class="emphasis"><em>partially</em></span> implemented on the
   following architectures:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     IA64 (does not support probes on instruction
     <code class="systemitem">slot1</code>)
    </p></li><li class="listitem "><p>
     sparc64 (return probes not yet implemented)
    </p></li></ul></div></div><div class="sect1 " id="cha-tuning-kprobes-types"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Types of kernel probes</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#cha-tuning-kprobes-types">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes-types</li></ul></div></div></div></div><p>
   There are three types of kernel probes: <span class="emphasis"><em>Kprobes</em></span>,
   <span class="emphasis"><em>Jprobes</em></span>, and <span class="emphasis"><em>Kretprobes</em></span>.
   Kretprobes are sometimes called <span class="emphasis"><em>return
   probes</em></span>. You can find source code examples of all three type of
   probes in the Linux kernel. See the directory
   <code class="filename">/usr/src/linux/samples/kprobes/</code> (package
   <code class="systemitem">kernel-source</code>).
   
  </p><div class="sect2 " id="cha-tuning-kprobes-types-kprobe"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Kprobes</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#cha-tuning-kprobes-types-kprobe">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes-types-kprobe</li></ul></div></div></div></div><p>
    Kprobes can be attached to any instruction in the Linux kernel.
    When Kprobes is registered, it inserts a break-point at the first
    byte of the probed instruction. When the processor hits this
    break-point, the processor registers are saved, and the processing
    passes to Kprobes. First, a <span class="emphasis"><em>pre-handler</em></span> is
    executed, then the probed instruction is stepped, and, finally a
    <span class="emphasis"><em>post-handler</em></span> is executed. The control is then passed
    to the instruction following the probe point.
   </p></div><div class="sect2 " id="cha-tuning-kprobes-types-jprobe"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Jprobes</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#cha-tuning-kprobes-types-jprobe">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes-types-jprobe</li></ul></div></div></div></div><p>
    Jprobes is implemented through the Kprobes mechanism. It is
    inserted on a function's entry point and allows direct access to the
    arguments of the function which is being probed. Its handler routine
    must have the same argument list and return value as the probed
    function. To end it, call the <code class="systemitem">jprobe_return()</code>
    function.
   </p><p>
    When a jprobe is hit, the processor registers are saved, and the
    instruction pointer is directed to the jprobe handler routine. The
    control then passes to the handler with the same register contents as the
    function being probed. Finally, the handler calls the
    <code class="systemitem">jprobe_return()</code> function, and switches the
    control back to the control function.
   </p><p>
    Generally, you can insert multiple probes on one function. Jprobe is,
    however, limited to only one instance per function.
   </p></div><div class="sect2 " id="cha-tuning-kprobes-types-kretprobe"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Return probe</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#cha-tuning-kprobes-types-kretprobe">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes-types-kretprobe</li></ul></div></div></div></div><p>
    Return probes are also implemented through Kprobes. When the
    <code class="systemitem">register_kretprobe()</code> function is called, a
    kprobe is attached to the entry of the probed function.
    After hitting the probe, the kernel probes mechanism saves the probed
    function return address and calls a user-defined return handler. The
    control is then passed back to the probed function.
   </p><p>
    Before you call <code class="systemitem">register_kretprobe()</code>, you need
    to set a <code class="systemitem">maxactive</code> argument, which specifies
    how many instances of the function can be probed at the same time. If
    set too low, a certain number of probes is missed.
   </p></div></div><div class="sect1 " id="cha-tuning-kprobes-api"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Kprobes API</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#cha-tuning-kprobes-api">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes-api</li></ul></div></div></div></div><p>
   The programming interface of Kprobes consists of functions which are
   used to register and unregister all used kernel probes, and associated
   probe handlers. For a more detailed description of these functions and
   their arguments, see the information sources in
   <a class="xref" href="cha-tuning-kprobes.html#cha-tuning-kprobes-moreinfo" title="5.5. More information">Section 5.5, “More information”</a>.
  </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.7.5.3.9.3.1"><span class="term "><code class="systemitem">register_kprobe()</code>
    </span></dt><dd><p>
      Inserts a break-point on a specified address. When the break-point is
      hit, the <code class="systemitem">pre_handler</code> and
      <code class="systemitem">post_handler</code> are called.
     </p></dd><dt id="id-1.7.5.3.9.3.2"><span class="term "><code class="systemitem">register_jprobe()</code>
    </span></dt><dd><p>
      Inserts a break-point in the specified address. The address needs to
      be the address of the first instruction of the probed function. When
      the break-point is hit, the specified handler is run. The handler
      should have the same argument list and return type as the probed.
     </p></dd><dt id="id-1.7.5.3.9.3.3"><span class="term "><code class="systemitem">register_kretprobe()</code>
    </span></dt><dd><p>
      Inserts a return probe for the specified function. When the probed
      function returns, a specified handler is run. This function returns 0
      on success, or a negative error number on failure.
     </p></dd><dt id="id-1.7.5.3.9.3.4"><span class="term "><code class="systemitem">unregister_kprobe()</code>, <code class="systemitem">unregister_jprobe()</code>, <code class="systemitem">unregister_kretprobe()</code>
    </span></dt><dd><p>
      Removes the specified probe. You can use it any time after the probe
      has been registered.
     </p></dd><dt id="id-1.7.5.3.9.3.5"><span class="term "><code class="systemitem">register_kprobes()</code>, <code class="systemitem">register_jprobes()</code>, <code class="systemitem">register_kretprobes()</code>
    </span></dt><dd><p>
      Inserts each of the probes in the specified array.
     </p></dd><dt id="id-1.7.5.3.9.3.6"><span class="term "><code class="systemitem">unregister_kprobes()</code>, <code class="systemitem">unregister_jprobes()</code>, <code class="systemitem">unregister_kretprobes()</code>
    </span></dt><dd><p>
      Removes each of the probes in the specified array.
     </p></dd><dt id="id-1.7.5.3.9.3.7"><span class="term "><code class="systemitem">disable_kprobe()</code>, <code class="systemitem">disable_jprobe()</code>, <code class="systemitem">disable_kretprobe()</code>
    </span></dt><dd><p>
      Disables the specified probe temporarily.
     </p></dd><dt id="id-1.7.5.3.9.3.8"><span class="term "><code class="systemitem">enable_kprobe()</code>, <code class="systemitem">enable_jprobe()</code>, <code class="systemitem">enable_kretprobe()</code>
    </span></dt><dd><p>
      Temporarily enables disabled probes.
     </p></dd></dl></div></div><div class="sect1 " id="cha-tuning-kprobes-debugfs"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name"><code class="systemitem">debugfs</code> Interface</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#cha-tuning-kprobes-debugfs">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes-debugfs</li></ul></div></div></div></div><p>
   In recent Linux kernels, the Kprobes instrumentation uses the
   kernel's <code class="systemitem">debugfs</code> interface. It can list all
   registered probes and globally switch all probes on or off.
  </p><div class="sect2 " id="cha-tuning-kprobes-debugfs-list"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.4.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Listing registered kernel probes</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#cha-tuning-kprobes-debugfs-list">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes-debugfs-list</li></ul></div></div></div></div><p>
    The list of all currently registered probes is in the
    <code class="filename">/sys/kernel/debug/kprobes/list</code> file.
   </p><div class="verbatim-wrap"><pre class="screen">saturn.example.com:~ # cat /sys/kernel/debug/kprobes/list
c015d71a  k  vfs_read+0x0   [DISABLED]
c011a316  j  do_fork+0x0
c03dedc5  r  tcp_v4_rcv+0x0</pre></div><p>
    The first column lists the address in the kernel where the probe is
    inserted. The second column prints the type of the probe:
    <code class="literal">k</code> for kprobe, <code class="literal">j</code> for jprobe, and
    <code class="literal">r</code> for return probe. The third column specifies the
    symbol, offset and optional module name of the probe. The following
    optional columns include the status information of the probe. If the
    probe is inserted on a virtual address which is not valid anymore, it is
    marked with <code class="literal">[GONE]</code>. If the probe is temporarily
    disabled, it is marked with <code class="literal">[DISABLED]</code>.
   </p></div><div class="sect2 " id="cha-tuning-kprobes-debugfs-switch"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.4.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Globally enabling/disabling kernel probes</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#cha-tuning-kprobes-debugfs-switch">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes-debugfs-switch</li></ul></div></div></div></div><p>
    The <code class="filename">/sys/kernel/debug/kprobes/enabled</code> file
    represents a switch with which you can globally and forcibly turn on or
    off all the registered kernel probes. To turn them off, simply enter
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>echo "0" &gt; /sys/kernel/debug/kprobes/enabled</pre></div><p>
    on the command line as <code class="systemitem">root</code>. To turn them on again, enter
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>echo "1" &gt; /sys/kernel/debug/kprobes/enabled</pre></div><p>
    With such operations, you do not change the status of the probes. If a
    probe is temporarily disabled, it is not enabled automatically but remains in the <code class="literal">[DISABLED]</code> state after entering
    the latter command.
   </p></div></div><div class="sect1 " id="cha-tuning-kprobes-moreinfo"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">More information</span> <a title="Permalink" class="permalink" href="cha-tuning-kprobes.html#cha-tuning-kprobes-moreinfo">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE/doc-sle/edit/main/xml/tuning_kprobes.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>tuning_kprobes.xml</li><li><span class="ds-label">ID: </span>cha-tuning-kprobes-moreinfo</li></ul></div></div></div></div><p>
   To learn more about kernel probes, look at the following sources of
   information:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Thorough but more technically oriented information about kernel probes
     is in <code class="filename">/usr/src/linux/Documentation/trace/kprobes.txt</code>
     (package <code class="systemitem">kernel-source</code>).
    </p></li><li class="listitem "><p>
     Examples of all three types of probes (together with related
     <code class="filename">Makefile</code>) are in the
     <code class="filename">/usr/src/linux/samples/kprobes/</code> directory (package
     <code class="systemitem">kernel-source</code>).
    </p></li><li class="listitem "><p>
     In-depth information about Linux kernel modules and
     <code class="systemitem">printk</code> kernel routine can be found at
     <a class="link" href="https://tldp.org/LDP/lkmpg/2.6/html/lkmpg.html" target="_blank">The
     Linux Kernel Module Programming Guide</a>
    </p></li></ul></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha-perf.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 6 </span>Hardware-based performance monitoring with Perf</span></a><a class="nav-link" href="cha-tuning-systemtap.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 4 </span>SystemTap—filtering and analyzing system data</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2024 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>