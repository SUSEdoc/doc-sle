<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLES 15 SP7 | Storage Administration Guide | Multi-tier caching for block device operations</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Multi-tier caching for block device operations | SLES …"/>
<meta name="description" content="A multi-tier cache is a replicated/distributed cache that consists of at least two tiers: one is represented by slower but cheaper rotational block d…"/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="15 SP7"/>
<meta name="book-title" content="Storage Administration Guide"/>
<meta name="chapter-title" content="Chapter 4. Multi-tier caching for block device operations"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Server 15 SP7"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Storage Administration Guide"/>
<meta property="og:description" content="Administer storage devices on SLES"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Storage Administration Guide"/>
<meta name="twitter:description" content="Administer storage devices on SLES"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Multi-tier caching for block device operations",
  
    "description": "Multi-tier caching for block device operations",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-06-26T00:00+02:00",
      
    "datePublished": "2024-06-26T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-uuid.html" title="Chapter 3. Mounting storage devices"/><link rel="next" href="part-lvm.html" title="Part II. Logical volumes (LVM)"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Storage Administration Guide</a><span> / </span><a class="crumb" href="part-filesystems.html">File systems and mounting</a><span> / </span><a class="crumb" href="cha-multitiercache.html">Multi-tier caching for block device operations</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Storage Administration Guide</div><ol><li><a href="storage-preface.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li class="active"><a href="part-filesystems.html" class="has-children you-are-here"><span class="title-number">I </span><span class="title-name">File systems and mounting</span></a><ol><li><a href="cha-filesystems.html" class=" "><span class="title-number">1 </span><span class="title-name">Overview of file systems in Linux</span></a></li><li><a href="cha-resize-fs.html" class=" "><span class="title-number">2 </span><span class="title-name">Resizing file systems</span></a></li><li><a href="cha-uuid.html" class=" "><span class="title-number">3 </span><span class="title-name">Mounting storage devices</span></a></li><li><a href="cha-multitiercache.html" class=" you-are-here"><span class="title-number">4 </span><span class="title-name">Multi-tier caching for block device operations</span></a></li></ol></li><li><a href="part-lvm.html" class="has-children "><span class="title-number">II </span><span class="title-name">Logical volumes (LVM)</span></a><ol><li><a href="cha-lvm.html" class=" "><span class="title-number">5 </span><span class="title-name">LVM configuration</span></a></li><li><a href="cha-lvm-snapshots.html" class=" "><span class="title-number">6 </span><span class="title-name">LVM volume snapshots</span></a></li></ol></li><li><a href="part-software-raid.html" class="has-children "><span class="title-number">III </span><span class="title-name">Software RAID</span></a><ol><li><a href="cha-raid.html" class=" "><span class="title-number">7 </span><span class="title-name">Software RAID configuration</span></a></li><li><a href="cha-raidroot.html" class=" "><span class="title-number">8 </span><span class="title-name">Configuring software RAID for the root partition</span></a></li><li><a href="cha-raid10.html" class=" "><span class="title-number">9 </span><span class="title-name">Creating software RAID 10 devices</span></a></li><li><a href="cha-raid-degraded.html" class=" "><span class="title-number">10 </span><span class="title-name">Creating a degraded RAID array</span></a></li><li><a href="cha-raid-resize.html" class=" "><span class="title-number">11 </span><span class="title-name">Resizing software RAID arrays with mdadm</span></a></li><li><a href="cha-raid-leds.html" class=" "><span class="title-number">12 </span><span class="title-name">Storage enclosure LED utilities for MD software RAIDs</span></a></li><li><a href="cha-raidtroubleshooting.html" class=" "><span class="title-number">13 </span><span class="title-name">Troubleshooting software RAIDs</span></a></li></ol></li><li><a href="part-net-storage.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Network storage</span></a><ol><li><a href="cha-isns.html" class=" "><span class="title-number">14 </span><span class="title-name">iSNS for Linux</span></a></li><li><a href="cha-iscsi.html" class=" "><span class="title-number">15 </span><span class="title-name">Mass storage over IP networks: iSCSI</span></a></li><li><a href="cha-fcoe.html" class=" "><span class="title-number">16 </span><span class="title-name">Fibre Channel storage over Ethernet networks: FCoE</span></a></li><li><a href="cha-nvmeof.html" class=" "><span class="title-number">17 </span><span class="title-name">NVMe-oF</span></a></li><li><a href="cha-multipath.html" class=" "><span class="title-number">18 </span><span class="title-name">Managing multipath I/O for devices</span></a></li><li><a href="cha-nfs.html" class=" "><span class="title-number">19 </span><span class="title-name">Sharing file systems with NFS</span></a></li><li><a href="cha-samba.html" class=" "><span class="title-number">20 </span><span class="title-name">Samba</span></a></li><li><a href="cha-autofs.html" class=" "><span class="title-number">21 </span><span class="title-name">On-demand mounting with autofs</span></a></li></ol></li><li><a href="bk09apa.html" class=" "><span class="title-number">A </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section xml:lang="en" class="chapter" id="cha-multitiercache" data-id-title="Multi-tier caching for block device operations"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP7</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">4 </span><span class="title-name">Multi-tier caching for block device operations</span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  A multi-tier cache is a replicated/distributed cache that consists of at
  least two tiers: one is represented by slower but cheaper rotational block
  devices (hard disks), while the other is more expensive but performs faster
  data operations (for example SSD flash disks).
 </p><p>
  SUSE Linux Enterprise Server implements two different solutions for caching between flash and
  rotational devices: <code class="systemitem">bcache</code> and <code class="systemitem">lvmcache</code>.
 </p><section class="sect1" id="sec-multitiercache-terminology" data-id-title="General terminology"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.1 </span><span class="title-name">General terminology</span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-terminology">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section explains several terms often used when describing cache related
   features:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.3.5.5.3.1"><span class="term">Migration</span></dt><dd><p>
      Movement of the primary copy of a logical block from one device to the
      other.
     </p></dd><dt id="id-1.11.3.5.5.3.2"><span class="term">Promotion</span></dt><dd><p>
      Migration from the slow device to the fast device.
     </p></dd><dt id="id-1.11.3.5.5.3.3"><span class="term">Demotion</span></dt><dd><p>
      Migration from the fast device to the slow device.
     </p></dd><dt id="id-1.11.3.5.5.3.4"><span class="term">Origin device</span></dt><dd><p>
      The big and slower block device. It always contains a copy of the logical
      block, which may be out of date or kept in synchronization with the copy
      on the cache device (depending on policy).
     </p></dd><dt id="id-1.11.3.5.5.3.5"><span class="term">Cache device</span></dt><dd><p>
      The small and faster block device.
     </p></dd><dt id="id-1.11.3.5.5.3.6"><span class="term">Metadata device</span></dt><dd><p>
      A small device that records which blocks are in the cache, which are
      dirty, and extra hints for use by the policy object. This information
      could be put on the cache device as well, but having it separate allows
      the volume manager to configure it differently, for example as a mirror
      for extra robustness. The metadata device may only be used by a single
      cache device.
     </p></dd><dt id="id-1.11.3.5.5.3.7"><span class="term">Dirty block</span></dt><dd><p>
      If some process writes to a block of data which is placed in the cache,
      the cached block is marked as <span class="emphasis"><em>dirty</em></span> because it was
      overwritten in the cache and needs to be written back to the original
      device.
     </p></dd><dt id="id-1.11.3.5.5.3.8"><span class="term">Cache miss</span></dt><dd><p>
      A request for I/O operations is pointed to the cached device's cache
      first. If it cannot find the requested values, it looks in the device
      itself, which is slow. This is called a <span class="emphasis"><em>cache miss</em></span>.
     </p></dd><dt id="id-1.11.3.5.5.3.9"><span class="term">Cache hit</span></dt><dd><p>
      When a requested value is found in the cached device's cache, it is
      served fast. This is called a <span class="emphasis"><em>cache hit</em></span>.
     </p></dd><dt id="id-1.11.3.5.5.3.10"><span class="term">Cold cache</span></dt><dd><p>
      Cache that holds no values (is empty) and causes <span class="emphasis"><em>cache
      misses</em></span>. As the cached block device operations progress, it
      gets filled with data and becomes <span class="emphasis"><em>warm</em></span>.
     </p></dd><dt id="id-1.11.3.5.5.3.11"><span class="term">Warm cache</span></dt><dd><p>
      Cache that already holds some values and is likely to result in
      <span class="emphasis"><em>cache hits</em></span>.
     </p></dd></dl></div></section><section class="sect1" id="sec-multitiercache-caching-modes" data-id-title="Caching modes"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.2 </span><span class="title-name">Caching modes</span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-caching-modes">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Following are the basic caching modes that multi-tier caches use:
   <span class="emphasis"><em>write-back</em></span>, <span class="emphasis"><em>write-through</em></span>,
   <span class="emphasis"><em>write-around</em></span> and <span class="emphasis"><em>pass-through</em></span>.
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.3.5.6.3.1"><span class="term">write-back</span></dt><dd><p>
      Data written to a block that is cached go to the cache only, and the
      block is marked dirty. This is the default caching mode.
     </p></dd><dt id="id-1.11.3.5.6.3.2"><span class="term">write-through</span></dt><dd><p>
      Writing to a cached block will not complete until it has hit both the
      origin and cache devices. Clean blocks remain clean with
      <span class="emphasis"><em>write-through</em></span> cache.
     </p></dd><dt id="id-1.11.3.5.6.3.3"><span class="term">write-around</span></dt><dd><p>
      A similar technique to write-through cache, but write I/O is written
      directly to a permanent storage, bypassing the cache. This can prevent
      the cache being flooded with write I/O that will not subsequently be
      re-read, but the disadvantage is that a read request for recently written
      data will create a 'cache miss' and needs to be read from slower bulk
      storage and experience higher latency.
     </p></dd><dt id="id-1.11.3.5.6.3.4"><span class="term">pass-through</span></dt><dd><p>
      To enable the <span class="emphasis"><em>pass-through</em></span> mode, the cache needs to
      be clean. Reading is served from the origin device bypassing the cache.
      Writing is forwarded to the origin device and 'invalidates' the cache
      block. <span class="emphasis"><em>Pass-through</em></span> allows a cache device activation
      without having to care about data coherency, which is maintained. The
      cache will gradually become cold as writing takes place. If you can
      verify the coherency of the cache later, or establish it by using the
      <code class="literal">invalidate_cblocks</code> message, you can switch the cache
      device to <span class="emphasis"><em>write-through</em></span> or
      <span class="emphasis"><em>write-back</em></span> mode while it is still warm. Otherwise,
      you can discard the cache contents before switching to the desired
      caching mode.
     </p></dd></dl></div></section><section class="sect1" id="sec-multitiercache-bcache" data-id-title="bcache"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.3 </span><span class="title-name"><code class="systemitem">bcache</code></span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-bcache">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="systemitem">bcache</code> is a Linux kernel block layer cache. It allows one or more fast
   disk drives (such as SSDs) to act as a cache for one or more slower hard
   disks. <code class="systemitem">bcache</code> supports write-through and write-back, and is independent of
   the file system used. By default it caches random reads and writes only,
   which SSDs excel at. It is suitable for desktops, servers, and high end
   storage arrays as well.
  </p><section class="sect2" id="sec-multitiercache-bcache-features" data-id-title="Main features"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.3.1 </span><span class="title-name">Main features</span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-bcache-features">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      A single cache device can be used to cache an arbitrary number of backing
      devices. Backing devices can be attached and detached at runtime, while
      mounted and in use.
     </p></li><li class="listitem"><p>
      Recovers from unclean shutdowns—writes are not completed until the
      cache is consistent with regard to the backing device.
     </p></li><li class="listitem"><p>
      Throttles traffic to the SSD if it becomes congested.
     </p></li><li class="listitem"><p>
      Highly efficient write-back implementation. Dirty data is always written
      out in sorted order.
     </p></li><li class="listitem"><p>
      Stable and reliable—in production use.
     </p></li></ul></div></section><section class="sect2" id="sec-multitiercache-bcache-setting-bcache-device" data-id-title="Setting up a bcache device"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.3.2 </span><span class="title-name">Setting up a <code class="systemitem">bcache</code> device</span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-bcache-setting-bcache-device">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This section describes steps to set up and manage a <code class="systemitem">bcache</code> device.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Install the <code class="systemitem">bcache-tools</code> package:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper in bcache-tools</pre></div></li><li class="step"><p>
      Create a backing device (typically a mechanical drive). The backing
      device can be a whole device, a partition, or any other standard block
      device.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> make-bcache -B /dev/sdb</pre></div></li><li class="step"><p>
      Create a cache device (typically an SSD disk).
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> make-bcache -C /dev/sdc</pre></div><p>
      In this example, the default block and bucket sizes of 512 B and 128 KB
      are used. The block size should match the backing device's sector size
      which will usually be either 512 or 4k. The bucket size should match the
      erase block size of the caching device with the intention of reducing
      write amplification. For example, using a hard disk with 4k sectors and
      an SSD with an erase block size of 2 MB this command would look as
      follows:
     </p><div class="verbatim-wrap"><pre class="screen">sudo make-bcache --block 4k --bucket 2M -C /dev/sdc</pre></div><div id="id-1.11.3.5.7.4.3.3.5" data-id-title="Multi-device support" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Multi-device support</div><p>
       <code class="command">make-bcache</code> can prepare and register multiple backing
       devices and a cache device at the same time. In this case you do not
       need to manually attach the cache device to the backing device
       afterward:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> make-bcache -B /dev/sda /dev/sdb -C /dev/sdc</pre></div></div></li><li class="step"><p>
      <code class="systemitem">bcache</code> devices show up as
     </p><div class="verbatim-wrap"><pre class="screen">/dev/bcache<em class="replaceable">N</em></pre></div><p>
      and as
     </p><div class="verbatim-wrap"><pre class="screen">/dev/bcache/by-uuid/<em class="replaceable">UUID</em>
/dev/bcache/by-label/<em class="replaceable">LABEL</em></pre></div><p>
      You can normally format and mount <code class="systemitem">bcache</code> devices as usual:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mkfs.ext4 /dev/bcache0
<code class="prompt user">&gt; </code><code class="command">sudo</code> mount /dev/bcache0 /mnt</pre></div><p>
      You can control <code class="systemitem">bcache</code> devices through <code class="systemitem">sysfs</code>
      at
      <code class="filename">/sys/block/bcache<em class="replaceable">N</em>/bcache</code>.
     </p></li><li class="step"><p>
      After both the cache and backing devices are registered, you need to
      attach the backing device to the related cache set to enable caching:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>echo <em class="replaceable">CACHE_SET_UUID</em> &gt; /sys/block/bcache0/bcache/attach</pre></div><p>
      where <em class="replaceable">CACHE_SET_UUID</em> is found in
      <code class="filename">/sys/fs/bcache</code>.
     </p></li><li class="step"><p>
      By default <code class="systemitem">bcache</code> uses a pass-through caching mode. To change it to for
      example write-back, run
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>echo writeback &gt; /sys/block/bcache0/bcache/cache_mode</pre></div></li></ol></div></div></section><section class="sect2" id="sec-multitiercache-bcache-sysfs" data-id-title="bcache configuration using sysfs"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.3.3 </span><span class="title-name"><code class="systemitem">bcache</code> configuration using <code class="systemitem">sysfs</code></span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-bcache-sysfs">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    <code class="systemitem">bcache</code> devices use the <code class="systemitem">sysfs</code> interface to store
    their runtime configuration values. This way you can change <code class="systemitem">bcache</code>
    backing and cache disks' behavior or see their usage statistics.
   </p><p>
    For the complete list of <code class="systemitem">bcache</code> <code class="systemitem">sysfs</code>
    parameters, see the contents of the
    <code class="filename">/usr/src/linux/Documentation/bcache.txt</code> file, mainly
    the <code class="literal">SYSFS - BACKING DEVICE</code>, <code class="literal">SYSFS - BACKING
    DEVICE STATS</code>, and <code class="literal">SYSFS - CACHE DEVICE</code>
    sections.
   </p></section></section><section class="sect1" id="sec-multitiercache-lvmcache" data-id-title="lvmcache"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">4.4 </span><span class="title-name"><code class="systemitem">lvmcache</code></span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-lvmcache">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="systemitem">lvmcache</code> is a caching mechanism consisting of logical volumes (LVs). It
   uses the <code class="literal">dm-cache</code> kernel driver and supports
   write-through (default) and write-back caching modes. <code class="systemitem">lvmcache</code> improves
   performance of a large and slow LV by dynamically migrating some of its data
   to a faster and smaller LV. For more information on LVM, see
   <a class="xref" href="part-lvm.html" title="Part II. Logical volumes (LVM)">Part II, “Logical volumes (LVM)”</a>.
  </p><p>
   LVM refers to the small, fast LV as a <span class="emphasis"><em>cache pool LV</em></span>.
   The large, slow LV is called the <span class="emphasis"><em>origin LV</em></span>. Because of
   requirements from dm-cache, LVM further splits the cache pool LV into two
   devices: the <span class="emphasis"><em>cache data LV</em></span> and <span class="emphasis"><em>cache
   metadata LV</em></span>. The cache data LV is where copies of data blocks
   are kept from the origin LV to increase speed. The cache metadata LV holds
   the accounting information that specifies where data blocks are stored.
  </p><section class="sect2" id="sec-multitiercache-lvmcache-configure" data-id-title="Configuring lvmcache"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.1 </span><span class="title-name">Configuring <code class="systemitem">lvmcache</code></span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-lvmcache-configure">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This section describes steps to create and configure LVM based caching.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      <span class="emphasis"><em>Create the origin LV.</em></span> Create a new LV or use an
      existing LV to become the origin LV:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvcreate -n <em class="replaceable">ORIGIN_LV</em> -L 100G vg <em class="replaceable">/dev/SLOW_DEV</em></pre></div></li><li class="step"><p>
      <span class="emphasis"><em>Create the cache data LV.</em></span> This LV will hold data
      blocks from the origin LV. The size of this LV is the size of the cache
      and will be reported as the size of the cache pool LV.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvcreate -n <em class="replaceable">CACHE_DATA_LV</em> -L 10G vg <em class="replaceable">/dev/FAST</em></pre></div></li><li class="step"><p>
      <span class="emphasis"><em>Create the cache metadata LV.</em></span> This LV will hold
      cache pool metadata. The size of this LV should be approximately 1000
      times smaller than the cache data LV, with a minimum size of 8MB.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvcreate -n <em class="replaceable">CACHE_METADATA_LV</em> -L 12M vg <em class="replaceable">/dev/FAST</em></pre></div><p>
      List the volumes you have created so far:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvs -a vg
LV                VG   Attr        LSize   Pool Origin
cache_data_lv     vg   -wi-a-----  10.00g
cache_metadata_lv vg   -wi-a-----  12.00m
origin_lv         vg   -wi-a----- 100.00g</pre></div></li><li class="step"><p>
      <span class="emphasis"><em>Create a cache pool LV.</em></span> Combine the data and
      metadata LVs into a cache pool LV. You can set the cache pool LV's
      behavior at the same time.
     </p><p>
      <em class="replaceable">CACHE_POOL_LV</em> takes the name of
      <em class="replaceable">CACHE_DATA_LV</em>.
     </p><p>
      <em class="replaceable">CACHE_DATA_LV</em> is renamed to
      <em class="replaceable">CACHE_DATA_LV</em>_cdata and becomes hidden.
     </p><p>
      <em class="replaceable">CACHE_META_LV</em> is renamed to
      <em class="replaceable">CACHE_DATA_LV</em>_cmeta and becomes hidden.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvconvert --type cache-pool \
 --poolmetadata vg/cache_metadata_lv vg/cache_data_lv</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvs -a vg
LV                     VG   Attr       LSize   Pool Origin
cache_data_lv          vg   Cwi---C---  10.00g
[cache_data_lv_cdata]  vg   Cwi-------  10.00g
[cache_data_lv_cmeta]  vg   ewi-------  12.00m
origin_lv              vg   -wi-a----- 100.00g</pre></div></li><li class="step"><p>
      <span class="emphasis"><em>Create a cache LV.</em></span> Create a cache LV by linking the
      cache pool LV to the origin LV.
     </p><p>
      The user accessible cache LV takes the name of the origin LV, while the
      origin LV becomes a hidden LV renamed to
      <em class="replaceable">ORIGIN_LV</em>_corig.
     </p><p>
      CacheLV takes the name of <em class="replaceable">ORIGIN_LV</em>.
     </p><p>
      <em class="replaceable">ORIGIN_LV</em> is renamed to
      <em class="replaceable">ORIGIN_LV</em>_corig and becomes hidden.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvconvert --type cache --cachepool vg/cache_data_lv vg/origin_lv</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvs -a vg
LV              VG   Attr       LSize   Pool   Origin
cache_data_lv          vg   Cwi---C---  10.00g
[cache_data_lv_cdata]  vg   Cwi-ao----  10.00g
[cache_data_lv_cmeta]  vg   ewi-ao----  12.00m
origin_lv              vg   Cwi-a-C--- 100.00g cache_data_lv [origin_lv_corig]
[origin_lv_corig]      vg   -wi-ao---- 100.00g</pre></div></li></ol></div></div></section><section class="sect2" id="sec-multitiercache-lvmcache-remove" data-id-title="Removing a cache pool"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">4.4.2 </span><span class="title-name">Removing a cache pool</span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-lvmcache-remove">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There are several ways to turn off the LV cache.
   </p><section class="sect3" id="sec-multitiercache-lvmcache-remove-detach" data-id-title="Detach a cache pool LV from a cache LV"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">4.4.2.1 </span><span class="title-name">Detach a cache pool LV from a cache LV</span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-lvmcache-remove-detach">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can disconnect a cache pool LV from a cache LV, leaving an unused
     cache pool LV and an uncached origin LV. Data are written back from the
     cache pool to the origin LV when necessary.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvconvert --splitcache vg/origin_lv</pre></div></section><section class="sect3" id="sec-multitiercache-lvmcache-remove-wo-origin" data-id-title="Removing a cache pool LV without removing its origin LV"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">4.4.2.2 </span><span class="title-name">Removing a cache pool LV without removing its origin LV</span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-lvmcache-remove-wo-origin">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     This writes back data from the cache pool to the origin LV when necessary,
     then removes the cache pool LV, leaving the uncached origin LV.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvremove vg/cache_data_lv</pre></div><p>
     An alternative command that also disconnects the cache pool from the cache
     LV, and deletes the cache pool:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvconvert --uncache vg/origin_lv</pre></div></section><section class="sect3" id="sec-multitiercache-lvmcache-remove-both" data-id-title="Removing both the origin LV and the cache pool LV"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">4.4.2.3 </span><span class="title-name">Removing both the origin LV and the cache pool LV</span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-lvmcache-remove-both">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Removing a cache LV removes both the origin LV and the linked cache pool
     LV.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lvremove vg/origin_lv</pre></div></section><section class="sect3" id="sec-multitiercache-lvmcache-remove-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">4.4.2.4 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="cha-multitiercache.html#sec-multitiercache-lvmcache-remove-info">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_multitier-caching.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can find more <code class="systemitem">lvmcache</code> related topics, such as supported cache
     modes, redundant sub-logical volumes, cache policy, or converting existing
     LVs to cache types, in the <code class="systemitem">lvmcache</code> manual page (<code class="command">man 7
     lvmcache</code>).
    </p></section></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-uuid.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 3 </span>Mounting storage devices</span></a> </div><div><a class="pagination-link next" href="part-lvm.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Part II </span>Logical volumes (LVM)</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-multitiercache.html#sec-multitiercache-terminology"><span class="title-number">4.1 </span><span class="title-name">General terminology</span></a></span></li><li><span class="sect1"><a href="cha-multitiercache.html#sec-multitiercache-caching-modes"><span class="title-number">4.2 </span><span class="title-name">Caching modes</span></a></span></li><li><span class="sect1"><a href="cha-multitiercache.html#sec-multitiercache-bcache"><span class="title-number">4.3 </span><span class="title-name"><code class="systemitem">bcache</code></span></a></span></li><li><span class="sect1"><a href="cha-multitiercache.html#sec-multitiercache-lvmcache"><span class="title-number">4.4 </span><span class="title-name"><code class="systemitem">lvmcache</code></span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>