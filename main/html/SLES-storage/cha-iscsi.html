<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLES 15 SP7 | Storage Administration Guide | Mass storage over IP networks: iSCSI</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Mass storage over IP networks: iSCSI | SLES 15 SP7"/>
<meta name="description" content="One of the primary tasks of a computer center, or any site that supports servers, is to provide adequate disk capacity. Fibre Channel is often used f…"/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="15 SP7"/>
<meta name="book-title" content="Storage Administration Guide"/>
<meta name="chapter-title" content="Chapter 15. Mass storage over IP networks: iSCSI"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Server 15 SP7"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Storage Administration Guide"/>
<meta property="og:description" content="Administer storage devices on SLES"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Storage Administration Guide"/>
<meta name="twitter:description" content="Administer storage devices on SLES"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Mass storage over IP networks: iSCSI",
  
    "description": "Mass storage over IP networks: iSCSI",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-06-26T00:00+02:00",
      
    "datePublished": "2024-06-26T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-isns.html" title="Chapter 14. iSNS for Linux"/><link rel="next" href="cha-fcoe.html" title="Chapter 16. Fibre Channel storage over Ethernet networks: FCoE"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Storage Administration Guide</a><span> / </span><a class="crumb" href="part-net-storage.html">Network storage</a><span> / </span><a class="crumb" href="cha-iscsi.html">Mass storage over IP networks: iSCSI</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Storage Administration Guide</div><ol><li><a href="storage-preface.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="part-filesystems.html" class="has-children "><span class="title-number">I </span><span class="title-name">File systems and mounting</span></a><ol><li><a href="cha-filesystems.html" class=" "><span class="title-number">1 </span><span class="title-name">Overview of file systems in Linux</span></a></li><li><a href="cha-resize-fs.html" class=" "><span class="title-number">2 </span><span class="title-name">Resizing file systems</span></a></li><li><a href="cha-uuid.html" class=" "><span class="title-number">3 </span><span class="title-name">Mounting storage devices</span></a></li><li><a href="cha-multitiercache.html" class=" "><span class="title-number">4 </span><span class="title-name">Multi-tier caching for block device operations</span></a></li></ol></li><li><a href="part-lvm.html" class="has-children "><span class="title-number">II </span><span class="title-name">Logical volumes (LVM)</span></a><ol><li><a href="cha-lvm.html" class=" "><span class="title-number">5 </span><span class="title-name">LVM configuration</span></a></li><li><a href="cha-lvm-snapshots.html" class=" "><span class="title-number">6 </span><span class="title-name">LVM volume snapshots</span></a></li></ol></li><li><a href="part-software-raid.html" class="has-children "><span class="title-number">III </span><span class="title-name">Software RAID</span></a><ol><li><a href="cha-raid.html" class=" "><span class="title-number">7 </span><span class="title-name">Software RAID configuration</span></a></li><li><a href="cha-raidroot.html" class=" "><span class="title-number">8 </span><span class="title-name">Configuring software RAID for the root partition</span></a></li><li><a href="cha-raid10.html" class=" "><span class="title-number">9 </span><span class="title-name">Creating software RAID 10 devices</span></a></li><li><a href="cha-raid-degraded.html" class=" "><span class="title-number">10 </span><span class="title-name">Creating a degraded RAID array</span></a></li><li><a href="cha-raid-resize.html" class=" "><span class="title-number">11 </span><span class="title-name">Resizing software RAID arrays with mdadm</span></a></li><li><a href="cha-raid-leds.html" class=" "><span class="title-number">12 </span><span class="title-name">Storage enclosure LED utilities for MD software RAIDs</span></a></li><li><a href="cha-raidtroubleshooting.html" class=" "><span class="title-number">13 </span><span class="title-name">Troubleshooting software RAIDs</span></a></li></ol></li><li class="active"><a href="part-net-storage.html" class="has-children you-are-here"><span class="title-number">IV </span><span class="title-name">Network storage</span></a><ol><li><a href="cha-isns.html" class=" "><span class="title-number">14 </span><span class="title-name">iSNS for Linux</span></a></li><li><a href="cha-iscsi.html" class=" you-are-here"><span class="title-number">15 </span><span class="title-name">Mass storage over IP networks: iSCSI</span></a></li><li><a href="cha-fcoe.html" class=" "><span class="title-number">16 </span><span class="title-name">Fibre Channel storage over Ethernet networks: FCoE</span></a></li><li><a href="cha-nvmeof.html" class=" "><span class="title-number">17 </span><span class="title-name">NVMe-oF</span></a></li><li><a href="cha-multipath.html" class=" "><span class="title-number">18 </span><span class="title-name">Managing multipath I/O for devices</span></a></li><li><a href="cha-nfs.html" class=" "><span class="title-number">19 </span><span class="title-name">Sharing file systems with NFS</span></a></li><li><a href="cha-samba.html" class=" "><span class="title-number">20 </span><span class="title-name">Samba</span></a></li><li><a href="cha-autofs.html" class=" "><span class="title-number">21 </span><span class="title-name">On-demand mounting with autofs</span></a></li></ol></li><li><a href="bk09apa.html" class=" "><span class="title-number">A </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section xml:lang="en" class="chapter" id="cha-iscsi" data-id-title="Mass storage over IP networks: iSCSI"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP7</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">15 </span><span class="title-name">Mass storage over IP networks: iSCSI</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  One of the primary tasks of a computer center, or any site that supports
  servers, is to provide adequate disk capacity. Fibre Channel is often used
  for this purpose. iSCSI (Internet SCSI) solutions provide a lower-cost
  alternative to Fibre Channel that can leverage commodity servers and Ethernet
  networking equipment. Linux iSCSI provides iSCSI initiator and iSCSI LIO
  target software for connecting Linux servers to central storage systems.
 </p><div class="figure" id="id-1.11.6.3.4"><div class="figure-contents"><div class="mediaobject"><a href="images/iscsi_san_a.png"><img src="images/iscsi_san_a.png" width="100%" alt="iSCSI SAN with an iSNS server" title="iSCSI SAN with an iSNS server"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 15.1: </span><span class="title-name">iSCSI SAN with an iSNS server </span></span><a title="Permalink" class="permalink" href="cha-iscsi.html#id-1.11.6.3.4">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div><div id="id-1.11.6.3.5" data-id-title="LIO" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: LIO</div><p>
   LIO is the standard open
   source multiprotocol SCSI target for Linux. LIO replaced the STGT (SCSI
   Target) framework as the standard unified storage target in Linux with Linux
   kernel version 2.6.38 and later. In <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 12 the iSCSI LIO Target
   Server replaces the iSCSI Target Server from previous versions.
  </p></div><p>
  iSCSI is a storage networking protocol that simplifies data transfers of SCSI
  packets over TCP/IP networks between block storage devices and servers. iSCSI
  target software runs on the target server and defines the logical units as
  iSCSI target devices. iSCSI initiator software runs on different servers and
  connects to the target devices to make the storage devices available on that
  server.
 </p><p>
  The iSCSI LIO target server and iSCSI initiator servers communicate by
  sending SCSI packets at the IP level in your LAN. When an application running
  on the initiator server starts an inquiry for an iSCSI LIO target device, the
  operating system produces the necessary SCSI commands. The SCSI commands are
  then embedded in IP packets and encrypted as necessary by software that is
  commonly known as the <span class="emphasis"><em>iSCSI initiator</em></span>. The packets are
  transferred across the internal IP network to the corresponding iSCSI remote
  station, called the <span class="emphasis"><em>iSCSI LIO target server</em></span>, or simply
  the <span class="emphasis"><em>iSCSI target</em></span>.
 </p><p>
  Many storage solutions provide access over iSCSI, but it is also possible to
  run a Linux server that provides an iSCSI target. In this case, it is
  important to set up a Linux server that is optimized for file system
  services. For more information about RAID, also see
  <a class="xref" href="cha-raid.html" title="Chapter 7. Software RAID configuration">Chapter 7, <em>Software RAID configuration</em></a>.
 </p><section class="sect1" id="sec-iscsi-install" data-id-title="Installing the iSCSI LIO target server and iSCSI initiator"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.1 </span><span class="title-name">Installing the iSCSI LIO target server and iSCSI initiator</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-install">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   While the iSCSI initiator is installed by default (packages
   <code class="systemitem">open-iscsi</code> and
   <code class="systemitem">yast2-iscsi-client</code>), the iSCSI LIO
   target packages need to be installed manually.
  </p><div id="id-1.11.6.3.9.3" data-id-title="Initiator and target on the same server" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Initiator and target on the same server</div><p>
    While it is possible to run initiator and target in the same system, this
    setup is not recommended.
   </p></div><p>
   To install the iSCSI LIO Target Server, run the following command in a
   terminal:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper in yast2-iscsi-lio-server</pre></div><p>
   In case you need to install the iSCSI initiator or any of its dependencies,
   run the command <code class="command">sudo zypper in yast2-iscsi-client</code>.
  </p><p>
   Alternatively, use the YaST Software Management module for installation.
  </p><p>
   Any packages required in addition to the ones mentioned above will either be
   automatically pulled in by the installer, or be installed when you first run
   the respective YaST module.
  </p></section><section class="sect1" id="sec-iscsi-target" data-id-title="Setting up an iSCSI LIO target server"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.2 </span><span class="title-name">Setting up an iSCSI LIO target server</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-target">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes how to use YaST to configure an iSCSI LIO Target
   Server and set up iSCSI LIO target devices. You can use any iSCSI initiator
   software to access the target devices.
  </p><section class="sect2" id="sec-iscsi-target-start" data-id-title="iSCSI LIO target service start-up and firewall settings"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.2.1 </span><span class="title-name">iSCSI LIO target service start-up and firewall settings</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-target-start">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The iSCSI LIO Target service is by default configured to be started
    manually. You can configure the service to start automatically at boot
    time. If you use a firewall on the server and you want the iSCSI LIO
    targets to be available to other computers, you must open a port in the
    firewall for each adapter that you want to use for target access. TCP port
    3260 is the port number for the iSCSI protocol, as defined by IANA
    (Internet Assigned Numbers Authority).
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI LIO Target</span>.
     </p></li><li class="step"><p>
      Switch to the <span class="guimenu">Service</span> tab.
     </p><div class="informalfigure"><div class="mediaobject"><a href="images/lio_service_a.png"><img src="images/lio_service_a.png" width="100%" alt="Image" title="Image"/></a></div></div></li><li class="step"><p>
      Under <span class="guimenu">Service Start</span>, specify how you want the iSCSI
      LIO target service to be started:
     </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title">When booting:</span>
         The service starts automatically on server restart.
        </p></li><li class="listitem"><p><span class="formalpara-title">Manually:</span>
         (Default) You must start the service manually after a server restart
         by running <code class="command">sudo systemctl start targetcli</code>. The
         target devices are not available until you start the service.
        </p></li></ul></div></li><li class="step"><p>
      If you use a firewall on the server and you want the iSCSI LIO targets to
      be available to other computers, open port 3260 in the firewall for each
      adapter interface that you want to use for target access. If the port is
      closed for all of the network interfaces, the iSCSI LIO targets are not
      available to other computers.
     </p><p>
      If you do not use a firewall on the server, the firewall settings are
      disabled. In this case skip the following steps and leave the
      configuration dialog with <span class="guimenu">Finish</span> or switch to another
      tab to continue with the configuration.
     </p><ol type="a" class="substeps"><li class="step"><p>
        On the <span class="guimenu">Services</span> tab, select the <span class="guimenu">Open Port
        in Firewall</span> check box to enable the firewall settings.
       </p></li><li class="step"><p>
        Click <span class="guimenu">Firewall Details</span> to view or configure the
        network interfaces to use. All available network interfaces are listed,
        and all are selected by default. Deselect all interfaces on which the
        port should <span class="emphasis"><em>not</em></span> be opened. Save your settings with
        <span class="guimenu">OK</span>.
       </p></li></ol></li><li class="step"><p>
      Click <span class="guimenu">Finish</span> to save and apply the iSCSI LIO Target
      service settings.
     </p></li></ol></div></div></section><section class="sect2" id="sec-iscsi-target-authenticate" data-id-title="Configuring authentication for discovery of iSCSI LIO targets and initiators"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.2.2 </span><span class="title-name">Configuring authentication for discovery of iSCSI LIO targets and initiators</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-target-authenticate">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The iSCSI LIO Target Server software supports the PPP-CHAP (Point-to-Point
    Protocol Challenge Handshake Authentication Protocol), a three-way
    authentication method defined in the <em class="citetitle">Internet Engineering Task
    Force (IETF) RFC 1994</em>
    (<a class="link" href="https://datatracker.ietf.org/doc/html/rfc1994" target="_blank">https://datatracker.ietf.org/doc/html/rfc1994</a>). The
    server uses this authentication method for the discovery of iSCSI LIO
    targets and initiators, not for accessing files on the targets. If you do
    not want to restrict the access to the discovery, use <span class="guimenu">No
    Authentication</span>. The <span class="guimenu">No Discovery
    Authentication</span> option is enabled by default. Without requiring
    authentication all iSCSI LIO targets on this server can be discovered by
    any iSCSI initiator on the same network.
   </p><p>
    If authentication is needed for a more secure configuration, you can use
    incoming authentication, outgoing authentication, or both.
    <span class="guimenu">Authentication by Initiators</span> requires an iSCSI initiator
    to prove that it has the permissions to run a discovery on the iSCSI LIO
    target. The initiator must provide the incoming user name and password.
    <span class="guimenu">Authentication by Targets</span> requires the iSCSI LIO target
    to prove to the initiator that it is the expected target. The iSCSI LIO
    target must provide the outgoing user name and password to the iSCSI
    initiator. The password needs to be different for incoming and outgoing
    discovery. If authentication for discovery is enabled, its settings apply
    to all iSCSI LIO target groups.
   </p><div id="id-1.11.6.3.10.4.4" data-id-title="Security" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Security</div><p>
     We recommend that you use authentication for target and initiator
     discovery in production environments for security reasons.
    </p></div><p>
    To configure authentication preferences for iSCSI LIO targets:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI LIO Target</span>.
     </p></li><li class="step"><p>
      Switch to the <span class="guimenu">Global</span> tab.
     </p><div class="informalfigure"><div class="mediaobject"><a href="images/lio_global_noauth_a.png"><img src="images/lio_global_noauth_a.png" width="100%" alt="Image" title="Image"/></a></div></div></li><li class="step"><p>
      By default, authentication is disabled (<span class="guimenu">No Discovery
      Authentication</span>). To enable Authentication, select
      <span class="guimenu">Authentication by Initiators</span>, <span class="guimenu">Outgoing
      Authentication</span> or both.
     </p></li><li class="step"><p>
      Provide credentials for the selected authentication method(s). The user
      name and password pair must be different for incoming and outgoing
      discovery.
     </p></li><li class="step"><p>
      Click <span class="guimenu">Finish</span> to save and apply the settings.
     </p></li></ol></div></div></section><section class="sect2" id="sec-iscsi-target-storage" data-id-title="Preparing the storage space"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.2.3 </span><span class="title-name">Preparing the storage space</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-target-storage">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Before you configure LUNs for your iSCSI Target servers, you must prepare
    the storage you want to use. You can use the entire unformatted block
    device as a single LUN, or you can subdivide a device into unformatted
    partitions and use each partition as a separate LUN. The iSCSI target
    configuration exports the LUNs to iSCSI initiators.
   </p><p>
    You can use the Partitioner in YaST or the command line to set up the
    partitions. Refer to <span class="intraxref">Book “Deployment Guide”, Chapter 11 “<span class="guimenu">Expert Partitioner</span>”, Section 11.1 “Using the <span class="guimenu">Expert Partitioner</span>”</span> for details.
    iSCSI LIO targets can use unformatted partitions with Linux, Linux LVM, or
    Linux RAID file system IDs.
   </p><div id="id-1.11.6.3.10.5.4" data-id-title="Do not mount iSCSI target devices" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Do not mount iSCSI target devices</div><p>
     After you set up a device or partition for use as an iSCSI target, you
     never access it directly via its local path. Do not mount the partitions
     on the target server.
    </p></div><section class="sect3" id="sec-iscsi-target-storage-vm" data-id-title="Partitioning devices in a virtual environment"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.2.3.1 </span><span class="title-name">Partitioning devices in a virtual environment</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-target-storage-vm">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can use a virtual machine guest server as an iSCSI LIO Target Server.
     This section describes how to assign partitions to a Xen virtual
     machine. You can also use other virtual environments that are supported by
     <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>.
    </p><p>
     In a Xen virtual environment, you must assign the storage space you want
     to use for the iSCSI LIO target devices to the guest virtual machine, then
     access the space as virtual disks within the guest environment. Each
     virtual disk can be a physical block device, such as an entire disk,
     partition, or volume, or it can be a file-backed disk image where the
     virtual disk is a single image file on a larger physical disk on the Xen
     host server. For the best performance, create each virtual disk from a
     physical disk or a partition. After you set up the virtual disks for the
     guest virtual machine, start the guest server, then configure the new
     blank virtual disks as iSCSI target devices by following the same process
     as for a physical server.
    </p><p>
     File-backed disk images are created on the Xen host server, then
     assigned to the Xen guest server. By default, Xen stores file-backed
     disk images in the
     <code class="filename">/var/lib/xen/images/<em class="replaceable">VM_NAME</em></code>
     directory, where <code class="filename"><em class="replaceable">VM_NAME</em></code>
     is the name of the virtual machine.
    </p></section></section><section class="sect2" id="sec-iscsi-target-target-group" data-id-title="Setting up an iSCSI LIO target group"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.2.4 </span><span class="title-name">Setting up an iSCSI LIO target group</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-target-target-group">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can use YaST to configure iSCSI LIO target devices. YaST uses the
    <code class="command">targetcli</code> software. iSCSI LIO targets can use partitions
    with Linux, Linux LVM, or Linux RAID file system IDs.
   </p><div id="id-1.11.6.3.10.6.3" data-id-title="Partitions" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Partitions</div><p>
     Before you begin, choose the partitions you wish to use for back-end
     storage. The partitions do not have to be formatted—the iSCSI client
     can format them when connected, overwriting all existing formatting.
    </p></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI LIO Target</span>.
     </p></li><li class="step"><p>
      Switch to the <span class="guimenu">Targets</span> tab.
     </p><div class="informalfigure"><div class="mediaobject"><a href="images/lio_targets_a.png"><img src="images/lio_targets_a.png" width="100%" alt="Image" title="Image"/></a></div></div></li><li class="step"><p>
      Click <span class="guimenu">Add</span>, then define a new iSCSI LIO target group
      and devices:
     </p><p>
      The iSCSI LIO Target software automatically completes the
      <span class="guimenu">Target</span>, <span class="guimenu">Identifier</span>, <span class="guimenu">Portal
      Group</span>, <span class="guimenu">IP Address</span>, and <span class="guimenu">Port
      Number</span> fields. <span class="guimenu">Use Authentication</span> is
      selected by default.
     </p><ol type="a" class="substeps"><li class="step"><p>
        If you have multiple network interfaces, use the IP address drop-down
        box to select the IP address of the network interface to use for this
        target group. To make the server accessible under all addresses, choose
        <span class="guimenu">Bind All IP Addresses</span>.
       </p></li><li class="step"><p>
        Deselect <span class="guimenu">Use Authentication</span> if you do not want to
        require initiator authentication for this target group (not
        recommended).
       </p></li><li class="step"><p>
        Click <span class="guimenu">Add</span>. Enter the path of the device or partition
        or <span class="guimenu">Browse</span> to add it. Optionally specify a name, then
        click <span class="guimenu">OK</span>. The LUN number is automatically generated,
        beginning with 0. A name is automatically generated if you leave the
        field empty.
       </p></li><li class="step"><p>
        (Optional) Repeat the previous steps to add targets to this target
        group.
       </p></li><li class="step"><p>
        After all desired targets have been added to the group, click
        <span class="guimenu">Next</span>.
       </p></li></ol></li><li class="step"><p>
      On the <span class="guimenu">Modify iSCSI Target Initiator Setup</span> page,
      configure information for the initiators that are permitted to access
      LUNs in the target group:
     </p><div class="informalfigure"><div class="mediaobject"><a href="images/lio_target_client_a.png"><img src="images/lio_target_client_a.png" width="100%" alt="Image" title="Image"/></a></div></div><p>
      After you specify at least one initiator for the target group, the
      <span class="guimenu">Edit LUN</span>, <span class="guimenu">Edit Auth</span>,
      <span class="guimenu">Delete</span>, and <span class="guimenu">Copy</span> buttons are
      enabled. You can use <span class="guimenu">Add</span> or <span class="guimenu">Copy</span> to
      add initiators for the target group:
     </p><div class="itemizedlist" id="il-iscsi-target-target-group-options" data-id-title="Modify iSCSI target: options"><div class="title-container"><div class="itemizedlist-title-wrap"><div class="itemizedlist-title"><span class="title-number-name"><span class="title-name">Modify iSCSI target: options </span></span><a title="Permalink" class="permalink" href="cha-iscsi.html#il-iscsi-target-target-group-options">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title">Add:</span>
         Add a new initiator entry for the selected iSCSI LIO target group.
        </p></li><li class="listitem"><p><span class="formalpara-title">Edit LUN:</span>
         Configure which LUNs in the iSCSI LIO target group to map to a
         selected initiator. You can map each of the allocated targets to a
         preferred initiator.
        </p></li><li class="listitem"><p><span class="formalpara-title">Edit auth:</span>
         Configure the preferred authentication method for a selected
         initiator. You can specify no authentication, or you can configure
         incoming authentication, outgoing authentication, or both.
        </p></li><li class="listitem"><p><span class="formalpara-title">Delete:</span>
         Remove a selected initiator entry from the list of initiators
         allocated to the target group.
        </p></li><li class="listitem"><p><span class="formalpara-title">Copy:</span>
         Add a new initiator entry with the same LUN mappings and
         authentication settings as a selected initiator entry. This allows you
         to easily allocate the same shared LUNs, in turn, to each node in a
         cluster.
        </p></li></ul></div><ol type="a" class="substeps"><li class="step"><p>
        Click <span class="guimenu">Add</span>, specify the initiator name, select or
        deselect the <span class="guimenu">Import LUNs from TPG</span> check box, then
        click <span class="guimenu">OK</span> to save the settings.
       </p></li><li class="step"><p>
        Select an initiator entry, click <span class="guimenu">Edit LUN</span>, modify
        the LUN mappings to specify which LUNs in the iSCSI LIO target group to
        allocate to the selected initiator, then click <span class="guimenu">OK</span> to
        save the changes.
       </p><p>
        If the iSCSI LIO target group consists of multiple LUNs, you can
        allocate one or multiple LUNs to the selected initiator. By default,
        each of the available LUNs in the group are assigned to an initiator
        LUN.
       </p><p>
        To modify the LUN allocation, perform one or more of the following
        actions:
       </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title">Add:</span>
           Click <span class="guimenu">Add</span> to create a new <span class="guimenu">Initiator
           LUN</span> entry, then use the <span class="guimenu">Change</span>
           drop-down box to map a target LUN to it.
          </p></li><li class="listitem"><p><span class="formalpara-title">Delete:</span>
           Select the <span class="guimenu">Initiator LUN</span> entry, then click
           <span class="guimenu">Delete</span> to remove a target LUN mapping.
          </p></li><li class="listitem"><p><span class="formalpara-title">Change:</span>
           Select the <span class="guimenu">Initiator LUN</span> entry, then use the
           <span class="guimenu">Change</span> drop-down box to select which Target LUN
           to map to it.
          </p></li></ul></div><p>
        Typical allocation plans include the following:
       </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          A single server is listed as an initiator. All of the LUNs in the
          target group are allocated to it.
         </p><p>
          You can use this grouping strategy to logically group the iSCSI SAN
          storage for a given server.
         </p></li><li class="listitem"><p>
          Multiple independent servers are listed as initiators. One or
          multiple target LUNs are allocated to each server. Each LUN is
          allocated to only one server.
         </p><p>
          You can use this grouping strategy to logically group the iSCSI SAN
          storage for a given department or service category in the data
          center.
         </p></li><li class="listitem"><p>
          Each node of a cluster is listed as an initiator. All of the shared
          target LUNs are allocated to each node. All nodes are attached to the
          devices, but for most file systems, the cluster software locks a
          device for access and mounts it on only one node at a time. Shared
          file systems (such as OCFS2) make it possible for multiple nodes to
          concurrently mount the same file structure and to open the same files
          with read and write access.
         </p><p>
          You can use this grouping strategy to logically group the iSCSI SAN
          storage for a given server cluster.
         </p></li></ul></div></li><li class="step"><p>
        Select an initiator entry, click <span class="guimenu">Edit Auth</span>, specify
        the authentication settings for the initiator, then click
        <span class="guimenu">OK</span> to save the settings.
       </p><p>
        You can require <span class="guimenu">No Discovery Authentication</span>, or you
        can configure <span class="guimenu">Authentication by Initiators</span>,
        <span class="guimenu">Outgoing Authentication</span>, or both. You can specify
        only one user name and password pair for each initiator. The
        credentials can be different for incoming and outgoing authentication
        for an initiator. The credentials can be different for each initiator.
       </p></li><li class="step"><p>
        Repeat the previous steps for each iSCSI initiator that can access this
        target group.
       </p></li><li class="step"><p>
        After the initiator assignments are configured, click
        <span class="guimenu">Next</span>.
       </p></li></ol></li><li class="step"><p>
      Click <span class="guimenu">Finish</span> to save and apply the settings.
     </p></li></ol></div></div></section><section class="sect2" id="sec-iscsi-target-tg-modify" data-id-title="Modifying an iSCSI LIO target group"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.2.5 </span><span class="title-name">Modifying an iSCSI LIO target group</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-target-tg-modify">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    You can modify an existing iSCSI LIO target group as follows:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Add or remove target LUN devices from a target group
     </p></li><li class="listitem"><p>
      Add or remove initiators for a target group
     </p></li><li class="listitem"><p>
      Modify the initiator LUN-to-target LUN mappings for an initiator of a
      target group
     </p></li><li class="listitem"><p>
      Modify the user name and password credentials for an initiator
      authentication (incoming, outgoing, or both)
     </p></li></ul></div><p>
    To view or modify the settings for an iSCSI LIO target group:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI LIO Target</span>.
     </p></li><li class="step"><p>
      Switch to the <span class="guimenu">Targets</span> tab.
     </p></li><li class="step"><p>
      Select the iSCSI LIO target group to be modified, then click
      <span class="guimenu">Edit</span>.
     </p></li><li class="step"><p>
      On the Modify iSCSI Target LUN Setup page, add LUNs to the target group,
      edit the LUN assignments, or remove target LUNs from the group. After all
      desired changes have been made to the group, click
      <span class="guimenu">Next</span>.
     </p><p>
      For option information, see
      <a class="xref" href="cha-iscsi.html#il-iscsi-target-target-group-options" title="Modify iSCSI target: options">Modify iSCSI target: options</a>.
     </p></li><li class="step"><p>
      On the Modify iSCSI Target Initiator Setup page, configure information
      for the initiators that are permitted to access LUNs in the target group.
      After all desired changes have been made to the group, click
      <span class="guimenu">Next</span>.
     </p></li><li class="step"><p>
      Click <span class="guimenu">Finish</span> to save and apply the settings.
     </p></li></ol></div></div></section><section class="sect2" id="sec-iscsi-target-tg-delete" data-id-title="Deleting an iSCSI LIO target group"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.2.6 </span><span class="title-name">Deleting an iSCSI LIO target group</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-target-tg-delete">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Deleting an iSCSI LIO target group removes the definition of the group, and
    the related setup for initiators, including LUN mappings and authentication
    credentials. It does not destroy the data on the partitions. To give
    initiators access again, you can allocate the target LUNs to a different or
    new target group, and configure the initiator access for them.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI LIO Target</span>.
     </p></li><li class="step"><p>
      Switch to the <span class="guimenu">Targets</span> tab.
     </p></li><li class="step"><p>
      Select the iSCSI LIO target group to be deleted, then click
      <span class="guimenu">Delete</span>.
     </p></li><li class="step"><p>
      When you are prompted, click <span class="guimenu">Continue</span> to confirm the
      deletion, or click <span class="guimenu">Cancel</span> to cancel it.
     </p></li><li class="step"><p>
      Click <span class="guimenu">Finish</span> to save and apply the settings.
     </p></li></ol></div></div></section></section><section class="sect1" id="sec-iscsi-initiator" data-id-title="Configuring iSCSI initiator"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.3 </span><span class="title-name">Configuring iSCSI initiator</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-initiator">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The iSCSI initiator can be used to connect to any iSCSI target. This is not
   restricted to the iSCSI target solution explained in
   <a class="xref" href="cha-iscsi.html#sec-iscsi-target" title="15.2. Setting up an iSCSI LIO target server">Section 15.2, “Setting up an iSCSI LIO target server”</a>. The
   configuration of iSCSI initiator involves two major steps: the discovery of
   available iSCSI targets and the setup of an iSCSI session. Both can be done
   with YaST.
  </p><section class="sect2" id="sec-iscsi-initiator-yast" data-id-title="Using YaST for the iSCSI initiator configuration"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.3.1 </span><span class="title-name">Using YaST for the iSCSI initiator configuration</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-initiator-yast">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The iSCSI Initiator Overview in YaST is divided into three tabs:
   </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.3.11.3.3.1"><span class="term">Service:</span></dt><dd><p>
       The <span class="guimenu">Service</span> tab can be used to enable the iSCSI
       initiator at boot time. It also offers to set a unique
       <span class="guimenu">Initiator Name</span> and an iSNS server to use for the
       discovery.
      </p></dd><dt id="id-1.11.6.3.11.3.3.2"><span class="term">Connected targets:</span></dt><dd><p>
       The <span class="guimenu">Connected Targets</span> tab gives an overview of the
       currently connected iSCSI targets. Like the <span class="guimenu">Discovered
       Targets</span> tab, it also gives the option to add new targets to
       the system.
      </p></dd><dt id="id-1.11.6.3.11.3.3.3"><span class="term">Discovered targets:</span></dt><dd><p>
       The <span class="guimenu">Discovered Targets</span> tab provides the possibility
       of manually discovering iSCSI targets in the network.
      </p></dd></dl></div><section class="sect3" id="sec-iscsi-initiator-yast-configuration" data-id-title="Configuring the iSCSI initiator"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.3.1.1 </span><span class="title-name">Configuring the iSCSI initiator</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-initiator-yast-configuration">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI Initiator</span>.
      </p></li><li class="step"><p>
       Switch to the <span class="guimenu">Service</span> tab.
      </p><div class="informalfigure"><div class="mediaobject"><a href="images/iscsi_init_service_a.png"><img src="images/iscsi_init_service_a.png" width="100%" alt="Image" title="Image"/></a></div></div></li><li class="step"><p>
       Under <span class="guimenu">After writing configuration</span>, define what to do
       if there is a configuration change. Bear in mind that available options
       depend on the service current status.
      </p><p>
       The <span class="guimenu">Keep current state</span> option keeps the service in
       the same status.
      </p></li><li class="step"><p>
       In the <span class="guimenu">After reboot</span> menu specify action that will
       take place after reboot:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         <span class="guimenu">Start on boot</span> - to start the service automatically
         on boot.
        </p></li><li class="listitem"><p>
         <span class="guimenu">Start on demand</span> - the associated socket will be
         running and if needed, the service will be started.
        </p></li><li class="listitem"><p>
         <span class="guimenu">Do not start</span> - the service is not started
         automatically.
        </p></li><li class="listitem"><p>
         <span class="guimenu">Keep current settings</span> - the service configuration
         is not changed.
        </p></li></ul></div></li><li class="step"><p>
       Specify or verify the <span class="guimenu">Initiator Name</span>.
      </p><p>
       Specify a well-formed iSCSI qualified name (IQN) for the iSCSI initiator
       on this server. The initiator name must be globally unique on your
       network. The IQN uses the following general format:
      </p><div class="verbatim-wrap"><pre class="screen">iqn.yyyy-mm.com.mycompany:n1:n2</pre></div><p>
       where n1 and n2 are alphanumeric characters. For example:
      </p><div class="verbatim-wrap"><pre class="screen">iqn.1996-04.de.suse:01:a5dfcea717a</pre></div><p>
       The <span class="guimenu">Initiator Name</span> is automatically completed with
       the corresponding value from the
       <code class="filename">/etc/iscsi/initiatorname.iscsi</code> file on the server.
      </p><p>
       If the server has iBFT (iSCSI Boot Firmware Table) support, the
       <span class="guimenu">Initiator Name</span> is completed with the corresponding
       value in the IBFT, and you are not able to change the initiator name in
       this interface. Use the BIOS Setup to modify it instead. The iBFT is a
       block of information containing various parameters useful to the iSCSI
       boot process, including iSCSI target and initiator descriptions for the
       server.
      </p></li><li class="step"><p>
       Use either of the following methods to discover iSCSI targets on the
       network.
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="formalpara-title">iSNS:</span>
          To use iSNS (Internet Storage Name Service) for discovering iSCSI
          targets, continue with
          <a class="xref" href="cha-iscsi.html#sec-iscsi-initiator-yast-isn" title="15.3.1.2. Discovering iSCSI targets by using iSNS">Section 15.3.1.2, “Discovering iSCSI targets by using iSNS”</a>.
         </p></li><li class="listitem"><p><span class="formalpara-title">Discovered targets:</span>
          To discover iSCSI target devices manually, continue with
          <a class="xref" href="cha-iscsi.html#sec-iscsi-initiator-yast-discovered" title="15.3.1.3. Discovering iSCSI targets manually">Section 15.3.1.3, “Discovering iSCSI targets manually”</a>.
         </p></li></ul></div></li></ol></div></div></section><section class="sect3" id="sec-iscsi-initiator-yast-isn" data-id-title="Discovering iSCSI targets by using iSNS"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.3.1.2 </span><span class="title-name">Discovering iSCSI targets by using iSNS</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-initiator-yast-isn">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Before you can use this option, you must have already installed and
     configured an iSNS server in your environment. For information, see
     <a class="xref" href="cha-isns.html" title="Chapter 14. iSNS for Linux">Chapter 14, <em>iSNS for Linux</em></a>.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       In YaST, select<span class="guimenu"> iSCSI Initiator</span>, then select the
       <span class="guimenu">Service</span> tab.
      </p></li><li class="step"><p>
       Specify the IP address of the iSNS server and port. The default port is
       3205.
      </p></li><li class="step"><p>
       Click <span class="guimenu">OK</span> to save and apply your changes.
      </p></li></ol></div></div></section><section class="sect3" id="sec-iscsi-initiator-yast-discovered" data-id-title="Discovering iSCSI targets manually"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.3.1.3 </span><span class="title-name">Discovering iSCSI targets manually</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-initiator-yast-discovered">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Repeat the following process for each of the iSCSI target servers that you
     want to access from the server where you are setting up the iSCSI
     initiator.
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       In YaST, select <span class="guimenu">iSCSI Initiator</span>, then select the
       <span class="guimenu">Discovered Targets</span> tab.
      </p></li><li class="step"><p>
       Click <span class="guimenu">Discovery</span> to open the iSCSI Initiator Discovery
       dialog.
      </p></li><li class="step"><p>
       Enter the IP address and change the port if needed. The default port is
       3260.
      </p></li><li class="step"><p>
       If authentication is required, deselect <span class="guimenu">No Discovery
       Authentication</span>, then specify the credentials for
       <span class="guimenu">Authentication by Initiator</span> or
       <span class="guimenu">Authentication by Targets</span>.
      </p></li><li class="step"><p>
       Click <span class="guimenu">Next</span> to start the discovery and connect to the
       iSCSI target server.
      </p></li><li class="step"><p>
       If credentials are required, after a successful discovery, use
       <span class="guimenu">Connect</span> to activate the target.
      </p><p>
       You are prompted for authentication credentials to use the selected
       iSCSI target.
      </p></li><li class="step"><p>
       Click <span class="guimenu">Next</span> to finish the configuration.
      </p><p>
       The target now appears in <span class="guimenu">Connected Targets</span> and the
       virtual iSCSI device is now available.
      </p></li><li class="step"><p>
       Click <span class="guimenu">OK</span> to save and apply your changes.
      </p></li><li class="step"><p>
       You can find the local device path for the iSCSI target device by using
       the <code class="command">lsscsi</code> command.
      </p></li></ol></div></div></section><section class="sect3" id="sec-iscsi-initiator-yast-startup" data-id-title="Setting the start-up preference for iSCSI target devices"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.3.1.4 </span><span class="title-name">Setting the start-up preference for iSCSI target devices</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-initiator-yast-startup">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
       In YaST, select<span class="guimenu"> iSCSI Initiator</span>, then select the
       <span class="guimenu">Connected Targets</span> tab to view a list of the iSCSI
       target devices that are currently connected to the server.
      </p></li><li class="step"><p>
       Select the iSCSI target device that you want to manage.
      </p></li><li class="step"><p>
       Click <span class="guimenu">Toggle Start-Up</span> to modify the setting:
      </p><p><span class="formalpara-title">Automatic:</span>
        This option is used for iSCSI targets that are to be connected when the
        iSCSI service itself starts up. This is the typical configuration.
       </p><p><span class="formalpara-title">Onboot:</span>
        This option is used for iSCSI targets that are to be connected during
        boot; that is, when root (<code class="filename">/</code>) is on iSCSI. As such,
        the iSCSI target device will be evaluated from the initrd on server
        boots. This option is ignored on platforms that cannot boot from iSCSI,
        such as IBM Z. Therefore it should not be used on these platforms;
        use <span class="guimenu">Automatic</span> instead.
       </p></li><li class="step"><p>
       Click <span class="guimenu">OK</span> to save and apply your changes.
      </p></li></ol></div></div></section></section><section class="sect2" id="sec-iscsi-initiator-manually" data-id-title="Setting up the iSCSI initiator manually"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.3.2 </span><span class="title-name">Setting up the iSCSI initiator manually</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-initiator-manually">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Both the discovery and the configuration of iSCSI connections require a
    running iscsid. When running the discovery the first time, the internal
    database of the iSCSI initiator is created in the directory
    <code class="filename">/etc/iscsi/</code>.
   </p><p>
    If your discovery is password protected, provide the authentication
    information to iscsid. Because the internal database does not exist when
    doing the first discovery, it cannot be used now. Instead, the
    configuration file <code class="filename">/etc/iscsid.conf</code> must be edited to
    provide the information. To add your password information for the
    discovery, add the following lines to the end of
    <code class="filename">/etc/iscsid.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">discovery.sendtargets.auth.authmethod = CHAP
discovery.sendtargets.auth.username = <em class="replaceable">USERNAME</em>
discovery.sendtargets.auth.password = <em class="replaceable">PASSWORD</em></pre></div><p>
    The discovery stores all received values in an internal persistent
    database. In addition, it displays all detected targets. Run this discovery
    with the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> iscsiadm <code class="option">-m discovery --type=st --portal=<em class="replaceable">TARGET_IP</em></code></pre></div><p>
    The output should look like the following:
   </p><div class="verbatim-wrap"><pre class="screen">10.44.171.99:3260,1 iqn.2006-02.com.example.iserv:systems</pre></div><p>
    To discover the available targets on an <code class="literal">iSNS</code> server, use
    the following command:
   </p><div class="verbatim-wrap"><pre class="screen">sudo iscsiadm --mode discovery --type isns --portal <em class="replaceable">TARGET_IP</em></pre></div><p>
    For each target defined on the iSCSI target, one line appears. For more
    information about the stored data, see
    <a class="xref" href="cha-iscsi.html#sec-iscsi-initiator-database" title="15.3.3. The iSCSI initiator databases">Section 15.3.3, “The iSCSI initiator databases”</a>.
   </p><p>
    The special <code class="option">--login</code> option of <code class="command">iscsiadm</code>
    creates all needed devices:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems --login</pre></div><p>
    The newly generated devices show up in the output of
    <code class="command">lsscsi</code> and can now be mounted.
   </p></section><section class="sect2" id="sec-iscsi-initiator-database" data-id-title="The iSCSI initiator databases"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.3.3 </span><span class="title-name">The iSCSI initiator databases</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-initiator-database">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    All information that was discovered by the iSCSI initiator is stored in two
    database files that reside in <code class="filename">/etc/iscsi</code>. There is one
    database for the discovery of targets and one for the discovered nodes.
    When accessing a database, you first must select if you want to get your
    data from the discovery or from the node database. Do this with the
    <code class="option">-m discovery</code> and <code class="option">-m node</code> parameters of
    <code class="command">iscsiadm</code>. Using <code class="command">iscsiadm</code> with one of
    these parameters gives an overview of the stored records:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> iscsiadm -m discovery
10.44.171.99:3260,1 iqn.2006-02.com.example.iserv:systems</pre></div><p>
    The target name in this example is
    <code class="literal">iqn.2006-02.com.example.iserv:systems</code>. This name is
    needed for all actions that relate to this special data set. To examine the
    content of the data record with the ID
    <code class="literal">iqn.2006-02.com.example.iserv:systems</code>, use the following
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> iscsiadm -m node --targetname iqn.2006-02.com.example.iserv:systems
node.name = iqn.2006-02.com.example.iserv:systems
node.transport_name = tcp
node.tpgt = 1
node.active_conn = 1
node.startup = manual
node.session.initial_cmdsn = 0
node.session.reopen_max = 32
node.session.auth.authmethod = CHAP
node.session.auth.username = joe
node.session.auth.password = ********
node.session.auth.username_in = <em class="replaceable">EMPTY</em>
node.session.auth.password_in = <em class="replaceable">EMPTY</em>
node.session.timeo.replacement_timeout = 0
node.session.err_timeo.abort_timeout = 10
node.session.err_timeo.reset_timeout = 30
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
....</pre></div><p>
    To edit the value of one of these variables, use the command
    <code class="command">iscsiadm</code> with the <code class="option">update</code> operation. For
    example, if you want iscsid to log in to the iSCSI target when it
    initializes, set the variable <code class="option">node.startup</code> to the value
    <code class="option">automatic</code>:
   </p><div class="verbatim-wrap"><pre class="screen">sudo iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems \
-p ip:port --op=update --name=node.startup --value=automatic</pre></div><p>
    Remove obsolete data sets with the <code class="literal">delete</code> operation. If
    the target <code class="literal">iqn.2006-02.com.example.iserv:systems</code> is no
    longer a valid record, delete this record with the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems \
-p ip:port --op=delete</pre></div><div id="id-1.11.6.3.11.5.10" data-id-title="No confirmation" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: No confirmation</div><p>
     Use this option with caution because it deletes the record without any
     additional confirmation prompt.
    </p></div><p>
    To get a list of all discovered targets, run the <code class="command">sudo iscsiadm -m
    node</code> command.
   </p></section></section><section class="sect1" id="sec-iscsi-targetcli" data-id-title="Setting up software targets using targetcli-fb"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.4 </span><span class="title-name">Setting up software targets using targetcli-fb</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-targetcli">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <code class="systemitem">targetcli</code> is a shell for managing the configuration
   of the LinuxIO (LIO) target subsystem. The shell can be called
   interactively, or you can execute one command at a time, much like a
   conventional shell. Similar to a conventional shell, you can traverse the
   targetcli functional hierarchy using the <code class="command">cd</code> command and
   list contents with the <code class="command">ls</code> command.
  </p><p>
   The available commands depend on the current directory. While each directory
   has its own set of commands, there are also commands that are available in
   all directories (for example, the <code class="command">cd</code> and
   <code class="command">ls</code> commands).
  </p><p>
   <code class="systemitem">targetcli</code> commands have the following format:
  </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">[DIRECTORY]</em> <code class="command">command</code> <em class="replaceable">[ARGUMENTS]</em></pre></div><p>
   You can use the <code class="command">help</code> command in any directory to view a
   list of available commands or information about any command in particular.
  </p><p>
   The <code class="systemitem">targetcli</code> tool is part of the
   <span class="package">targetcli-fb</span> package. This package is available in the
   official <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> software repository, and it can be installed using
   the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> zypper install targetcli-fb</pre></div><p>
   After the <span class="package">targetcli-fb</span> package has been installed, enable
   the <code class="literal">targetcli</code> service:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable targetcli
<code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start targetcli</pre></div><p>
   To switch to the targetcli shell, run the <code class="command">targetcli</code> as
   root:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> targetcli</pre></div><p>
   You can then run the <code class="command">ls</code> command to see the default
   configuration.
  </p><div class="verbatim-wrap"><pre class="screen">/&gt; ls
o- / ............................ [...]
  o- backstores ................. [...]
  | o- block ..... [Storage Objects: 0]
  | o- fileio .... [Storage Objects: 0]
  | o- pscsi ..... [Storage Objects: 0]
  | o- ramdisk ... [Storage Objects: 0]
  | o- rbd ....... [Storage Objects: 0]
  o- iscsi ............... [Targets: 0]
  o- loopback ............ [Targets: 0]
  o- vhost ............... [Targets: 0]
  o- xen-pvscsi .......... [Targets: 0]
/&gt;</pre></div><p>
   As the output of the <code class="command">ls</code> command indicates, there are no
   configured back-ends. So the first step is to configure one of the supported
   software targets.
  </p><p>
   targetcli supports the following back-ends:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <code class="literal">fileio</code>, local image file
    </p></li><li class="listitem"><p>
     <code class="literal">block</code>, block storage on a dedicated disk or partition
    </p></li><li class="listitem"><p>
     <code class="literal">pscsi</code>, SCSI pass-through devices
    </p></li><li class="listitem"><p>
     <code class="literal">ramdisk</code>, memory-based back-end
    </p></li><li class="listitem"><p>
     <code class="literal">rbd</code>, Ceph RADOS block devices
    </p></li></ul></div><p>
   To familiarize yourself with the functionality of targetcli, set up a local
   image file as a software target using the <code class="command">create</code> command:
  </p><div class="verbatim-wrap"><pre class="screen">/backstores/fileio create test-disc <em class="replaceable">/alt</em>/test.img 1G</pre></div><p>
   This creates a 1 GB <code class="filename">test.img</code> image in the
   specified location (in this case <code class="filename">/alt</code>). Run
   <code class="command">ls</code>, and you should see the following result:
  </p><div class="verbatim-wrap"><pre class="screen">/&gt; ls
o- / ........................................................... [...]
  o- backstores ................................................ [...]
  | o- block .................................... [Storage Objects: 0]
  | o- fileio ................................... [Storage Objects: 1]
  | | o- test-disc ... [/alt/test.img (1.0GiB) write-back deactivated]
  | |   o- alua ......     .......................... [ALUA Groups: 1]
  | |     o- default_tg_pt_gp      .... [ALUA state: Active/optimized]
  | o- pscsi .................................... [Storage Objects: 0]
  | o- ramdisk .................................. [Storage Objects: 0]
  | o- rbd ...................................... [Storage Objects: 0]
  o- iscsi .............................................. [Targets: 0]
  o- loopback ........................................... [Targets: 0]
  o- vhost .............................................. [Targets: 0]
  o- xen-pvscsi ......................................... [Targets: 0]
/&gt;</pre></div><p>
   The output indicates that there is now a file-based backstore, under the
   <code class="filename">/backstores/fileio</code> directory, called
   <code class="literal">test-disc</code>, which is linked to the created file
   <code class="filename">/alt/test.img</code>. Note that the new backstore is not yet
   activated.
  </p><p>
   The next step is to connect an iSCSI target front-end to the back-end
   storage. Each target must have an <code class="literal">IQN</code> (iSCSI Qualified
   Name). The most commonly used IQN format is as follows:
  </p><div class="verbatim-wrap"><pre class="screen">iqn.<em class="replaceable">YYYY-MM.NAMING-AUTHORITY:UNIQUE-NAME</em></pre></div><p>
   The following parts of an IQN are required:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <em class="replaceable">YYYY-MM</em>, the year and month when the naming
     authority was established
    </p></li><li class="listitem"><p>
     <em class="replaceable">NAMING-AUTHORITY</em>, reverse-syntax of the
     Internet Domain Name of the naming authority
    </p></li><li class="listitem"><p>
     <em class="replaceable">UNIQUE-NAME</em>, a domain-unique name chosen by the
     naming authority
    </p></li></ul></div><p>
   For example, for the domain <code class="literal">open-iscsi.com</code>, the IQN can
   be as follows:
  </p><div class="verbatim-wrap"><pre class="screen">iqn.2005-03.com.open-iscsi:<em class="replaceable">UNIQUE-NAME</em></pre></div><p>
   When creating an iSCSI target, the <code class="command">targetcli</code> command
   allows you to assign your own IQN, as long as it follows the specified
   format. You can also let the command create an IQN for you by omitting a
   name when creating the target, for example:
  </p><div class="verbatim-wrap"><pre class="screen">/&gt; iscsi/ create</pre></div><p>
   Run the <code class="command">ls</code> command again:
  </p><div class="verbatim-wrap"><pre class="screen">/&gt; ls
o- / ............................................................... [...]
  o- backstores .................................................... [...]
  | o- block ........................................ [Storage Objects: 0]
  | o- fileio ....................................... [Storage Objects: 1]
  | | o- test-disc ....... [/alt/test.img (1.0GiB) write-back deactivated]
  | |   o- alua ......................................... [ALUA Groups: 1]
  | |     o- default_tg_pt_gp ............. [ALUA state: Active/optimized]
  | o- pscsi ........................................ [Storage Objects: 0]
  | o- ramdisk ...................................... [Storage Objects: 0]
  | o- rbd .......................................... [Storage Objects: 0]
  o- iscsi .................................................. [Targets: 1]
  | o- iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456 ... [TPGs: 1]
  |   o- tpg1 ..................................... [no-gen-acls, no-auth]
  |     o- acls ................................................ [ACLs: 0]
  |     o- luns ................................................ [LUNs: 0]
  |     o- portals .......................................... [Portals: 1]
  |       o- 0.0.0.0:3260 ........................................... [OK]
  o- loopback ............................................... [Targets: 0]
  o- vhost .................................................. [Targets: 0]
  o- xen-pvscsi ............................................. [Targets: 0]
/&gt;</pre></div><p>
   The output shows the created iSCSI target node with its automatically
   generated IQN
   <code class="literal">iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456</code>
  </p><p>
   Note that <code class="command">targetcli</code> has also created and enabled the
   default target portal group <code class="literal">tpg1</code>. This is done because
   the variables <code class="literal">auto_add_default_portal</code> and
   <code class="literal">auto_enable_tpgt</code> at the root level are set to
   <code class="literal">true</code> by default.
  </p><p>
   The command also created the default portal with the
   <code class="literal">0.0.0.0</code> IPv4 wildcard. This means that any IPv4 address
   can access the configured target.
  </p><p>
   The next step is to create a LUN (Logical Unit Number) for the iSCSI target.
   The best way to do this is to let <code class="command">targetcli</code> assign its
   name and number automatically. Switch to the directory of the iSCSI target,
   and then use the <code class="command">create</code> command in the
   <code class="filename">lun</code> directory to assign a LUN to the backstore.
  </p><div class="verbatim-wrap"><pre class="screen">/&gt; cd /iscsi/iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456/
/iscsi/iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456&gt; cd tpg1
/iscsi/iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456/tpg1&gt; luns/
create /backstores/fileio/test-disc</pre></div><p>
   Run the <code class="command">ls</code> command to see the changes:
  </p><div class="verbatim-wrap"><pre class="screen">/iscsi/iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456/tpg1&gt; ls
o- tpg1 .............................................. [no-gen-acls, no-auth]
      o- acls ..................................................... [ACLs: 0]
      o- luns ..................................................... [LUNs: 1]
      | o- lun0 ....... [fileio/test-disc (/alt/test.img) (default_tg_pt_gp)]
      o- portals ............................................... [Portals: 1]
        o- 0.0.0.0:3260 ................................................ [OK]</pre></div><p>
   There is now an iSCSI target that has a 1 GB file-based backstore. The
   target has the
   <code class="literal">iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456</code>
   name, and it can be accessed from any network port of the system.
  </p><p>
   Finally, you need to ensure that initiators have access to the configured
   target. One way to do this is to create an ACL rule for each initiator that
   allows them to connect to the target. In this case, you must list each
   desired initiator using its IQN. The IQNs of the existing initiators can be
   found in the <code class="filename">/etc/iscsi/initiatorname.iscsi</code> file. Use
   the following command to add the desired initiator (in this case, it's
   <code class="literal">iqn.1996-04.de.suse:01:54cab487975b</code>):
  </p><div class="verbatim-wrap"><pre class="screen">/iscsi/iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456/tpg1&gt; acls/ create iqn.1996-04.de.suse:01:54cab487975b
Created Node ACL for iqn.1996-04.de.suse:01:54cab487975b
Created mapped LUN 0.
/iscsi/iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456/tpg1&gt;</pre></div><p>
   Alternatively, you can run the target in a demo mode with no access
   restrictions. This method is less secure, but it can be useful for
   demonstration purposes and running on closed networks. To enable the demo
   mode, use the following commands:
  </p><div class="verbatim-wrap"><pre class="screen">/iscsi/iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456/tpg1&gt; set attribute generate_node_acls=1
/iscsi/iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456/tpg1&gt; set attribute demo_mode_write_protect=0</pre></div><p>
   The last step is to save the created configuration using the
   <code class="command">saveconfig</code> command available in the root directory:
  </p><div class="verbatim-wrap"><pre class="screen">/&gt; saveconfig /etc/target/example.json</pre></div><p>
   If at some point you need to restore configuration from the saved file, you
   need to clear the current configuration first. Keep in mind that clearing
   the current configuration results in data loss unless you save your
   configuration first. Use the following command to clear and reload the
   configuration:
  </p><div class="verbatim-wrap"><pre class="screen">/&gt; clearconfig
As a precaution, confirm=True needs to be set
/&gt; clearconfig confirm=true
All configuration cleared
/&gt; restoreconfig /etc/target/example.json
Configuration restored from /etc/target/example.json
/&gt;</pre></div><p>
   To test whether the configured target is working, connect to it using the
   <span class="package">open-iscsi</span> iSCSI initiator installed on the same system
   (replace <em class="replaceable">HOSTNAME</em> with the host name of the local
   machine):
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>iscsiadm -m discovery -t st -p <em class="replaceable">HOSTNAME</em></pre></div><p>
   This command returns a list of found targets, for example:
  </p><div class="verbatim-wrap"><pre class="screen">192.168.20.3:3260,1 iqn.2003-01.org.linux-iscsi.e83.x8664:sn.8b35d04dd456</pre></div><p>
   You can then connect to the listed target using the <code class="command">login</code>
   iSCSI command. This makes the target available as a local disk.
  </p></section><section class="sect1" id="sec-iscsi-installation" data-id-title="Using iSCSI disks when installing"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.5 </span><span class="title-name">Using iSCSI disks when installing</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-installation">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Booting from an iSCSI disk on AMD64/Intel 64 and IBM POWER architectures
   is supported when iSCSI-enabled firmware is used.
  </p><p>
   To use iSCSI disks during installation, it is necessary to add the following
   parameter to the boot parameter line:
  </p><div class="verbatim-wrap"><pre class="screen">withiscsi=1</pre></div><p>
   During installation, an additional screen appears that provides the option
   to attach iSCSI disks to the system and use them in the installation
   process.
  </p><div id="id-1.11.6.3.13.6" data-id-title="Mount point support" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Mount point support</div><p>
    iSCSI devices will appear asynchronously during the boot process. While the
    initrd guarantees that those devices are set up correctly for the root file
    system, there are no such guarantees for any other file systems or mount
    points like <code class="filename">/usr</code>. Hence any system mount points like
    <code class="filename">/usr</code> or <code class="filename">/var</code> are not supported.
    To use those devices, ensure correct synchronization of the respective
    services and devices.
   </p></div></section><section class="sect1" id="sec-iscsi-trouble" data-id-title="Troubleshooting iSCSI"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.6 </span><span class="title-name">Troubleshooting iSCSI</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-trouble">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes some known issues and possible solutions for iSCSI
   target and iSCSI initiator issues.
  </p><section class="sect2" id="sec-iscsi-trouble-no-service" data-id-title="Portal error when setting up target LUNs on an iSCSI LIO target server"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.6.1 </span><span class="title-name">Portal error when setting up target LUNs on an iSCSI LIO target server</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-trouble-no-service">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When adding or editing an iSCSI LIO target group, you get an error:
   </p><div class="verbatim-wrap"><pre class="screen">Problem setting network portal <em class="replaceable">IP_ADDRESS</em>:3260</pre></div><p>
    The <code class="filename">/var/log/YasT2/y2log</code> log file contains the
    following error:
   </p><div class="verbatim-wrap"><pre class="screen">find: `/sys/kernel/config/target/iscsi': No such file or directory</pre></div><p>
    This problem occurs if the iSCSI LIO Target Server software is not
    currently running. To resolve this issue, exit YaST, manually start iSCSI
    LIO at the command line with <code class="command">systemctl start targetcli</code>,
    then try again.
   </p><p>
    You can also enter the following to check if <code class="command">configfs</code>,
    <code class="command">iscsi_target_mod</code>, and <code class="command">target_core_mod</code>
    are loaded. A sample response is shown.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> lsmod | grep iscsi
iscsi_target_mod      295015  0
target_core_mod       346745  4
iscsi_target_mod,target_core_pscsi,target_core_iblock,target_core_file
configfs               35817  3 iscsi_target_mod,target_core_mod
scsi_mod              231620  16
iscsi_target_mod,target_core_pscsi,target_core_mod,sg,sr_mod,mptctl,sd_mod,
scsi_dh_rdac,scsi_dh_emc,scsi_dh_alua,scsi_dh_hp_sw,scsi_dh,libata,mptspi,
mptscsih,scsi_transport_spi</pre></div></section><section class="sect2" id="sec-iscsi-trouble-not-visible" data-id-title="iSCSI LIO targets are not visible from other computers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.6.2 </span><span class="title-name">iSCSI LIO targets are not visible from other computers</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-trouble-not-visible">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    If you use a firewall on the target server, you must open the iSCSI port
    that you are using to allow other computers to see the iSCSI LIO targets.
    For information, see <a class="xref" href="cha-iscsi.html#sec-iscsi-target-start" title="15.2.1. iSCSI LIO target service start-up and firewall settings">Section 15.2.1, “iSCSI LIO target service start-up and firewall settings”</a>.
   </p></section><section class="sect2" id="sec-iscsi-trouble-package-loss" data-id-title="Data packets dropped for iSCSI traffic"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.6.3 </span><span class="title-name">Data packets dropped for iSCSI traffic</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-trouble-package-loss">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    A firewall might drop packets if it gets too busy. The default for the SUSE
    Firewall is to drop packets after three minutes. If you find that iSCSI
    traffic packets are being dropped, consider configuring the SUSE Firewall
    to queue packets instead of dropping them when it gets too busy.
   </p></section><section class="sect2" id="sec-iscsi-trouble-lvm" data-id-title="Using iSCSI volumes with LVM"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.6.4 </span><span class="title-name">Using iSCSI volumes with LVM</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-trouble-lvm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Use the troubleshooting tips in this section when using LVM on iSCSI
    targets.
   </p><section class="sect3" id="sec-iscsi-trouble-lvm-boot-initiator" data-id-title="Check if the iSCSI initiator discovery occurs at boot"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.6.4.1 </span><span class="title-name">Check if the iSCSI initiator discovery occurs at boot</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-trouble-lvm-boot-initiator">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     When you set up the iSCSI Initiator, ensure that you enable discovery at
     boot time so that udev can discover the iSCSI devices at boot time and set
     up the devices to be used by LVM.
    </p></section><section class="sect3" id="sec-iscsi-trouble-lvm-boot-target" data-id-title="Check that iSCSI target discovery occurs at boot"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">15.6.4.2 </span><span class="title-name">Check that iSCSI target discovery occurs at boot</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-trouble-lvm-boot-target">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     Remember that <code class="filename">udev</code> provides the default setup for
     devices. Ensure that all of the applications that create devices are
     started at boot time so that <code class="command">udev</code> can recognize and
     assign devices for them at system start-up. If the application or service
     is not started until later, <code class="command">udev</code> does not create the
     device automatically as it would at boot time.
    </p></section></section><section class="sect2" id="sec-iscsi-trouble-mount" data-id-title="iSCSI targets are mounted when the configuration file is set to manual"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">15.6.5 </span><span class="title-name">iSCSI targets are mounted when the configuration file is set to manual</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-trouble-mount">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When Open-iSCSI starts, it can mount the targets even if the
    <code class="literal">node.startup</code> option is set to manual in the
    <code class="filename">/etc/iscsi/iscsid.conf</code> file if you manually modified
    the configuration file.
   </p><p>
    Check the
    <code class="filename">/etc/iscsi/nodes/<em class="replaceable">TARGET_NAME</em>/<em class="replaceable">IP_ADDRESS</em>,<em class="replaceable">PORT</em>/default</code>
    file. It contains a <code class="literal">node.startup</code> setting that overrides
    the <code class="filename">/etc/iscsi/iscsid.conf</code> file. Setting the mount
    option to manual by using the YaST interface also sets
    <code class="literal">node.startup = manual</code> in the
    <code class="filename">/etc/iscsi/nodes/<em class="replaceable">TARGET_NAME</em>/<em class="replaceable">IP_ADDRESS</em>,<em class="replaceable">PORT</em>/default
    </code>files.
   </p></section></section><section class="sect1" id="sec-iscsi-terminology" data-id-title="iSCSI LIO target terminology"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.7 </span><span class="title-name">iSCSI LIO target terminology</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-terminology">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="id-1.11.6.3.15.2.1"><span class="term">backstore</span></dt><dd><p>
      A physical storage object that provides the actual storage underlying an
      iSCSI endpoint.
     </p></dd><dt id="id-1.11.6.3.15.2.2"><span class="term">CDB (command descriptor block)</span></dt><dd><p>
      The standard format for SCSI commands. CDBs are commonly 6, 10, or 12
      bytes long, though they can be 16 bytes or of variable length.
     </p></dd><dt id="id-1.11.6.3.15.2.3"><span class="term">CHAP (challenge handshake authentication protocol)</span></dt><dd><p>
      A point-to-point protocol (PPP) authentication method used to confirm the
      identity of one computer to another. After the Link Control Protocol
      (LCP) connects the two computers, and the CHAP method is negotiated, the
      authenticator sends a random Challenge to the peer. The peer issues a
      cryptographically hashed Response that depends upon the Challenge and a
      secret key. The authenticator verifies the hashed Response against its
      own calculation of the expected hash value, and either acknowledges the
      authentication or terminates the connection. CHAP is defined in the RFC
      1994.
     </p></dd><dt id="id-1.11.6.3.15.2.4"><span class="term">CID (connection identifier)</span></dt><dd><p>
      A 16‐bit number, generated by the initiator, that uniquely identifies a
      connection between two iSCSI devices. This number is presented during the
      login phase.
     </p></dd><dt id="id-1.11.6.3.15.2.5"><span class="term">endpoint</span></dt><dd><p>
      The combination of an iSCSI Target Name with an iSCSI TPG (IQN + Tag).
     </p></dd><dt id="id-1.11.6.3.15.2.6"><span class="term">EUI (extended unique identifier)</span></dt><dd><p>
      A 64‐bit number that uniquely identifies every device in the world. The
      format consists of 24 bits that are unique to a given company, and 40
      bits assigned by the company to each device it builds.
     </p></dd><dt id="id-1.11.6.3.15.2.7"><span class="term">initiator</span></dt><dd><p>
      The originating end of an SCSI session. Typically a controlling device
      such as a computer.
     </p></dd><dt id="id-1.11.6.3.15.2.8"><span class="term">IPS (Internet protocol storage)</span></dt><dd><p>
      The class of protocols or devices that use the IP protocol to move data
      in a storage network. FCIP (Fibre Channel over Internet Protocol), iFCP
      (Internet Fibre Channel Protocol), and iSCSI (Internet SCSI) are all
      examples of IPS protocols.
     </p></dd><dt id="id-1.11.6.3.15.2.9"><span class="term">IQN (iSCSI qualified name)</span></dt><dd><p>
      A name format for iSCSI that uniquely identifies every device in the
      world (for example:
      <code class="filename">iqn.5886.com.acme.tapedrive.sn‐a12345678</code>).
     </p></dd><dt id="id-1.11.6.3.15.2.10"><span class="term">ISID (initiator session identifier)</span></dt><dd><p>
      A 48‐bit number, generated by the initiator, that uniquely identifies a
      session between the initiator and the target. This value is created
      during the login process, and is sent to the target with a Login PDU.
     </p></dd><dt id="id-1.11.6.3.15.2.11"><span class="term">MCS (multiple connections per session)</span></dt><dd><p>
      A part of the iSCSI specification that allows multiple TCP/IP connections
      between an initiator and a target.
     </p></dd><dt id="id-1.11.6.3.15.2.12"><span class="term">MPIO (multipath I/O)</span></dt><dd><p>
      A method by which data can take multiple redundant paths between a server
      and storage.
     </p></dd><dt id="id-1.11.6.3.15.2.13"><span class="term">network portal</span></dt><dd><p>
      The combination of an iSCSI endpoint with an IP address plus a TCP
      (Transmission Control Protocol) port. TCP port 3260 is the port number
      for the iSCSI protocol, as defined by IANA (Internet Assigned Numbers
      Authority).
     </p></dd><dt id="id-1.11.6.3.15.2.14"><span class="term">SAM (SCSI architectural model)</span></dt><dd><p>
      A document that describes the behavior of SCSI in general terms, allowing
      for different types of devices communicating over various media.
     </p></dd><dt id="id-1.11.6.3.15.2.15"><span class="term">target</span></dt><dd><p>
      The receiving end of an SCSI session, typically a device such as a disk
      drive, tape drive, or scanner.
     </p></dd><dt id="id-1.11.6.3.15.2.16"><span class="term">target group (TG)</span></dt><dd><p>
      A list of SCSI target ports that are all treated the same when creating
      views. Creating a view can help simplify LUN (logical unit number)
      mapping. Each view entry specifies a target group, host group, and a LUN.
     </p></dd><dt id="id-1.11.6.3.15.2.17"><span class="term">target port</span></dt><dd><p>
      The combination of an iSCSI endpoint with one or more LUNs.
     </p></dd><dt id="id-1.11.6.3.15.2.18"><span class="term">target port group (TPG)</span></dt><dd><p>
      A list of IP addresses and TCP port numbers that determines which
      interfaces a specific iSCSI target will listen to.
     </p></dd><dt id="id-1.11.6.3.15.2.19"><span class="term">target session identifier (TSID)</span></dt><dd><p>
      A 16‐bit number, generated by the target, that uniquely identifies a
      session between the initiator and the target. This value is created
      during the login process, and is sent to the initiator with a Login
      Response PDU (protocol data units).
     </p></dd></dl></div></section><section class="sect1" id="sec-iscsi-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">15.8 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="cha-iscsi.html#sec-iscsi-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/storage_iscsi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The iSCSI protocol has been available for several years. There are many
   reviews comparing iSCSI with SAN solutions, benchmarking performance, and
   there also is documentation describing hardware solutions. For more
   information, see the Open-iSCSI project home page at
   <a class="link" href="https://www.open-iscsi.com/" target="_blank">https://www.open-iscsi.com/</a>.
  </p><p>
   Additionally, see the man pages for <code class="command">iscsiadm</code>,
   <code class="command">iscsid</code>, and the example configuration file
   <code class="filename">/etc/iscsid.conf</code>.
  </p></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-isns.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 14 </span>iSNS for Linux</span></a> </div><div><a class="pagination-link next" href="cha-fcoe.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 16 </span>Fibre Channel storage over Ethernet networks: FCoE</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-iscsi.html#sec-iscsi-install"><span class="title-number">15.1 </span><span class="title-name">Installing the iSCSI LIO target server and iSCSI initiator</span></a></span></li><li><span class="sect1"><a href="cha-iscsi.html#sec-iscsi-target"><span class="title-number">15.2 </span><span class="title-name">Setting up an iSCSI LIO target server</span></a></span></li><li><span class="sect1"><a href="cha-iscsi.html#sec-iscsi-initiator"><span class="title-number">15.3 </span><span class="title-name">Configuring iSCSI initiator</span></a></span></li><li><span class="sect1"><a href="cha-iscsi.html#sec-iscsi-targetcli"><span class="title-number">15.4 </span><span class="title-name">Setting up software targets using targetcli-fb</span></a></span></li><li><span class="sect1"><a href="cha-iscsi.html#sec-iscsi-installation"><span class="title-number">15.5 </span><span class="title-name">Using iSCSI disks when installing</span></a></span></li><li><span class="sect1"><a href="cha-iscsi.html#sec-iscsi-trouble"><span class="title-number">15.6 </span><span class="title-name">Troubleshooting iSCSI</span></a></span></li><li><span class="sect1"><a href="cha-iscsi.html#sec-iscsi-terminology"><span class="title-number">15.7 </span><span class="title-name">iSCSI LIO target terminology</span></a></span></li><li><span class="sect1"><a href="cha-iscsi.html#sec-iscsi-info"><span class="title-number">15.8 </span><span class="title-name">More information</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>