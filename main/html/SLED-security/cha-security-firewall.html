<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLED 15 SP7 | Security and Hardening Guide | Masquerading and firewalls</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Masquerading and firewalls | SLED 15 SP7"/>
<meta name="description" content="Whenever Linux is used in a network environment, you can use the kernel functions that allow the manipulation of network packets to maintain a separa…"/>
<meta name="product-name" content="SUSE Linux Enterprise Desktop"/>
<meta name="product-number" content="15 SP7"/>
<meta name="book-title" content="Security and Hardening Guide"/>
<meta name="chapter-title" content="Chapter 23. Masquerading and firewalls"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Desktop 15 SP7"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Security and Hardening Guide"/>
<meta property="og:description" content="Implement system security and hardening for SLED"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Security and Hardening Guide"/>
<meta name="twitter:description" content="Implement system security and hardening for SLED"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Masquerading and firewalls",
  
    "description": "Masquerading and firewalls",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-06-26T00:00+02:00",
      
    "datePublished": "2024-06-26T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-ssh.html" title="Chapter 22. Securing network operations with OpenSSH"/><link rel="next" href="cha-security-vpnserver.html" title="Chapter 24. Configuring a VPN server"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Security and Hardening Guide</a><span> / </span><a class="crumb" href="part-network-security.html">Network security</a><span> / </span><a class="crumb" href="cha-security-firewall.html">Masquerading and firewalls</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Security and Hardening Guide</div><ol><li><a href="preface-security.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="cha-security.html" class=" "><span class="title-number">1 </span><span class="title-name">Security and confidentiality</span></a></li><li><a href="part-auth.html" class="has-children "><span class="title-number">I </span><span class="title-name">Authentication</span></a><ol><li><a href="cha-pam.html" class=" "><span class="title-number">2 </span><span class="title-name">Authentication with PAM</span></a></li><li><a href="cha-nis.html" class=" "><span class="title-number">3 </span><span class="title-name">Using NIS</span></a></li><li><a href="cha-security-auth.html" class=" "><span class="title-number">4 </span><span class="title-name">Setting up authentication clients using YaST</span></a></li><li><a href="cha-security-ldap.html" class=" "><span class="title-number">5 </span><span class="title-name">LDAP with 389 Directory Server</span></a></li><li><a href="cha-security-kerberos.html" class=" "><span class="title-number">6 </span><span class="title-name">Network authentication with Kerberos</span></a></li><li><a href="cha-security-ad.html" class=" "><span class="title-number">7 </span><span class="title-name">Active Directory support</span></a></li><li><a href="cha-security-freeradius.html" class=" "><span class="title-number">8 </span><span class="title-name">Setting up a freeRADIUS server</span></a></li></ol></li><li><a href="part-local-security.html" class="has-children "><span class="title-number">II </span><span class="title-name">Local security</span></a><ol><li><a href="cha-physical-security.html" class=" "><span class="title-number">9 </span><span class="title-name">Physical security</span></a></li><li><a href="sec-sec-software-management.html" class=" "><span class="title-number">10 </span><span class="title-name">Software management</span></a></li><li><a href="sec-sec-file-management.html" class=" "><span class="title-number">11 </span><span class="title-name">File management</span></a></li><li><a href="cha-security-cryptofs.html" class=" "><span class="title-number">12 </span><span class="title-name">Encrypting partitions and files</span></a></li><li><a href="cha-configure-cryptctl.html" class=" "><span class="title-number">13 </span><span class="title-name">Storage encryption for hosted applications with cryptctl</span></a></li><li><a href="sec-sec-user-management.html" class=" "><span class="title-number">14 </span><span class="title-name">User management</span></a></li><li><a href="cha-sec-cron-at.html" class=" "><span class="title-number">15 </span><span class="title-name">Restricting <code class="systemitem">cron</code> and <code class="systemitem">at</code></span></a></li><li><a href="cha-spectre.html" class=" "><span class="title-number">16 </span><span class="title-name">Spectre/Meltdown checker</span></a></li><li><a href="cha-security-yast-security.html" class=" "><span class="title-number">17 </span><span class="title-name">Configuring security settings with YaST</span></a></li><li><a href="cha-security-polkit.html" class=" "><span class="title-number">18 </span><span class="title-name">The Polkit authentication framework</span></a></li><li><a href="cha-security-acls.html" class=" "><span class="title-number">19 </span><span class="title-name">Access control lists in Linux</span></a></li><li><a href="cha-aide.html" class=" "><span class="title-number">20 </span><span class="title-name">Intrusion detection with AIDE</span></a></li></ol></li><li class="active"><a href="part-network-security.html" class="has-children you-are-here"><span class="title-number">III </span><span class="title-name">Network security</span></a><ol><li><a href="cha-xauth.html" class=" "><span class="title-number">21 </span><span class="title-name">X Window System and X authentication</span></a></li><li><a href="cha-ssh.html" class=" "><span class="title-number">22 </span><span class="title-name">Securing network operations with OpenSSH</span></a></li><li><a href="cha-security-firewall.html" class=" you-are-here"><span class="title-number">23 </span><span class="title-name">Masquerading and firewalls</span></a></li><li><a href="cha-security-vpnserver.html" class=" "><span class="title-number">24 </span><span class="title-name">Configuring a VPN server</span></a></li><li><a href="cha-security-xca.html" class=" "><span class="title-number">25 </span><span class="title-name">Managing a PKI with XCA, X certificate and key manager</span></a></li><li><a href="cha-sec-sysctl.html" class=" "><span class="title-number">26 </span><span class="title-name">Improving network security with <code class="command">sysctl</code> variables</span></a></li></ol></li><li><a href="part-compliance.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Regulations and compliance</span></a><ol><li><a href="cha-common-criteria.html" class=" "><span class="title-number">27 </span><span class="title-name">Common Criteria</span></a></li><li><a href="cha-security-fips.html" class=" "><span class="title-number">28 </span><span class="title-name">Enabling compliance with FIPS 140-3</span></a></li></ol></li><li><a href="part-apparmor.html" class="has-children "><span class="title-number">V </span><span class="title-name">Confining privileges with <span class="phrase">AppArmor</span></span></a><ol><li><a href="cha-apparmor-intro.html" class=" "><span class="title-number">29 </span><span class="title-name">Introducing <span class="phrase">AppArmor</span></span></a></li><li><a href="cha-apparmor-start.html" class=" "><span class="title-number">30 </span><span class="title-name">Getting started</span></a></li><li><a href="cha-apparmor-concept.html" class=" "><span class="title-number">31 </span><span class="title-name">Immunizing programs</span></a></li><li><a href="cha-apparmor-profiles.html" class=" "><span class="title-number">32 </span><span class="title-name">Profile components and syntax</span></a></li><li><a href="cha-apparmor-repos.html" class=" "><span class="title-number">33 </span><span class="title-name"><span class="phrase">AppArmor</span> profile repositories</span></a></li><li><a href="cha-apparmor-yast.html" class=" "><span class="title-number">34 </span><span class="title-name">Building and managing profiles with YaST</span></a></li><li><a href="cha-apparmor-commandline.html" class=" "><span class="title-number">35 </span><span class="title-name">Building profiles from the command line</span></a></li><li><a href="cha-apparmor-hat.html" class=" "><span class="title-number">36 </span><span class="title-name">Profiling your Web applications using ChangeHat</span></a></li><li><a href="cha-apparmor-pam.html" class=" "><span class="title-number">37 </span><span class="title-name">Confining users with <code class="systemitem">pam_apparmor</code></span></a></li><li><a href="cha-apparmor-managing.html" class=" "><span class="title-number">38 </span><span class="title-name">Managing profiled applications</span></a></li><li><a href="cha-apparmor-support.html" class=" "><span class="title-number">39 </span><span class="title-name">Support</span></a></li><li><a href="cha-apparmor-glossary.html" class=" "><span class="title-number">40 </span><span class="title-name"><span class="phrase">AppArmor</span> glossary</span></a></li></ol></li><li><a href="part-audit.html" class="has-children "><span class="title-number">VI </span><span class="title-name">The Linux Audit Framework</span></a><ol><li><a href="cha-audit-comp.html" class=" "><span class="title-number">41 </span><span class="title-name">Understanding Linux audit</span></a></li><li><a href="cha-audit-setup.html" class=" "><span class="title-number">42 </span><span class="title-name">Setting up the Linux audit framework</span></a></li><li><a href="cha-audit-scenarios.html" class=" "><span class="title-number">43 </span><span class="title-name">Introducing an audit rule set</span></a></li><li><a href="cha-audit-moreinfo.html" class=" "><span class="title-number">44 </span><span class="title-name">Useful resources</span></a></li></ol></li><li><a href="bk05apa.html" class=" "><span class="title-number">A </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-security-firewall" data-id-title="Masquerading and firewalls"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP7</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">23 </span><span class="title-name">Masquerading and firewalls</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Whenever Linux is used in a network environment, you can use the
  kernel functions that allow the manipulation of network packets to
  maintain a separation between internal and external network areas. The
  Linux <code class="systemitem">netfilter</code> framework provides the means
  to establish an effective firewall that keeps different networks
  apart. Using iptables—a generic table structure for the
  definition of rule sets—precisely controls the packets allowed to
  pass a network interface. Such a packet filter can be set up using
  <code class="systemitem">firewalld</code> and its graphical interface <code class="command">firewall-config</code>.
 </p><p>
  <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="phrase">15 GA</span>
  introduces <code class="systemitem">firewalld</code> as the new default software firewall, replacing
  SuSEfirewall2.
  This chapter provides guidance for configuring <code class="systemitem">firewalld</code>, and migrating
  from SuSEfirewall2 for users who have upgraded from older <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>
  releases.
 </p><section class="sect1" id="sec-security-firewall-iptables" data-id-title="Packet filtering with iptables"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.1 </span><span class="title-name">Packet filtering with iptables</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-iptables">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section discusses the low-level details of packet filtering. The
   components <code class="systemitem">netfilter</code> and
   <code class="systemitem">iptables</code> are responsible for the filtering and
   manipulation of network packets and for network address translation (NAT).
   The filtering criteria and any actions associated with them are stored in
   chains, which must be matched one after another by individual network
   packets as they arrive. The chains to match are stored in tables. The
   <code class="command">iptables</code> command allows you to alter these tables and
   rule sets.
  </p><p>
   The Linux kernel maintains three tables, each for a particular category
   of functions of the packet filter:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.5.5.4.1"><span class="term">filter</span></dt><dd><p>
      This table holds the bulk of the filter rules, because it implements
      the <span class="emphasis"><em>packet filtering</em></span> mechanism in the stricter
      sense, which determines whether packets are let through
      (<code class="literal">ACCEPT</code>) or discarded (<code class="literal">DROP</code>),
      for example.
     </p></dd><dt id="id-1.7.6.5.5.4.2"><span class="term">nat</span></dt><dd><p>
      This table defines any changes to the source and target addresses of
      packets. Using these functions also allows you to implement
      <span class="emphasis"><em>masquerading</em></span>, which is a special case of NAT used
      to link a private network with the Internet.
     </p></dd><dt id="id-1.7.6.5.5.4.3"><span class="term">mangle</span></dt><dd><p>
      The rules held in this table make it possible to manipulate values
      stored in IP headers (such as the type of service).
     </p></dd></dl></div><p>
   These tables contain several predefined chains to match packets:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.5.5.6.1"><span class="term">PREROUTING</span></dt><dd><p>
      This chain is applied to all incoming packets.
     </p></dd><dt id="id-1.7.6.5.5.6.2"><span class="term">INPUT</span></dt><dd><p>
      This chain is applied to packets destined for the system's internal
      processes.
     </p></dd><dt id="id-1.7.6.5.5.6.3"><span class="term">FORWARD</span></dt><dd><p>
      This chain is applied to packets that are routed through the
      system.
     </p></dd><dt id="id-1.7.6.5.5.6.4"><span class="term">OUTPUT</span></dt><dd><p>
      This chain is applied to packets originating from the system itself.
     </p></dd><dt id="id-1.7.6.5.5.6.5"><span class="term">POSTROUTING</span></dt><dd><p>
      This chain is applied to all outgoing packets.
     </p></dd></dl></div><p>
   <a class="xref" href="cha-security-firewall.html#fig-fire-table" title="iptables: a packet's possible paths">Figure 23.1, “iptables: a packet's possible paths”</a> illustrates the paths along which a
   network packet may travel on a given system. For the sake of simplicity,
   the figure lists tables as parts of chains, but in reality these chains
   are held within the tables themselves.
  </p><p>
   In the simplest case, an incoming packet destined for the system itself
   arrives at the <code class="literal">eth0</code> interface. The packet is first
   referred to the <code class="literal">PREROUTING</code> chain of the
   <code class="literal">mangle</code> table then to the <code class="literal">PREROUTING</code>
   chain of the <code class="literal">nat</code> table. The following step, concerning
   the routing of the packet, determines that the actual target of the
   packet is a process of the system itself. After passing the
   <code class="literal">INPUT</code> chains of the <code class="literal">mangle</code> and the
   <code class="literal">filter</code> table, the packet finally reaches its target,
   provided that the rules of the <code class="literal">filter</code> table allow this.
  </p><div class="figure" id="fig-fire-table"><div class="figure-contents"><div class="mediaobject"><a href="images/fire_tables.png"><img src="images/fire_tables.png" width="100%" alt="iptables: a packet's possible paths" title="iptables: a packet's possible paths"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 23.1: </span><span class="title-name">iptables: a packet's possible paths </span></span><a title="Permalink" class="permalink" href="cha-security-firewall.html#fig-fire-table">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></section><section class="sect1" id="sec-security-firewall-masq" data-id-title="Masquerading basics"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.2 </span><span class="title-name">Masquerading basics</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-masq">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Masquerading is the Linux-specific form of NAT (network address
   translation) and can be used to connect a small LAN with the
   Internet.  LAN hosts use IP
   addresses from the private range (see
   <span class="intraxref">Book “Administration Guide”, Chapter 23 “Basic networking”, Section 23.1.2 “Netmasks and routing”</span>) and on the Internet
   official IP addresses are used. To be able to connect
   to the Internet, a LAN host's private address is translated to an official
   one. This is done on the router, which acts as the gateway between the
   LAN and the Internet. The underlying principle is a simple one: The
   router has more than one network interface, typically a network card and
   a separate interface connecting with the Internet. While the latter links
   the router with the outside world, one or several others link it with the
   LAN hosts. With these hosts in the local network connected to the network
   card (such as <code class="literal">eth0</code>) of the router, they can send any
   packets not destined for the local network to their default gateway or
   router.
  </p><div id="id-1.7.6.5.6.3" data-id-title="Using the correct network mask" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Using the correct network mask</div><p>
    When configuring your network, make sure both the broadcast address and
    the netmask are the same for all local hosts. Failing to do so prevents
    packets from being routed properly.
   </p></div><p>
   As mentioned, whenever one of the LAN hosts sends a packet destined for
   an Internet address, it goes to the default router. However, the router
   must be configured before it can forward such packets. For security
   reasons, this is not enabled in a default installation. To enable it, add
   the line <code class="literal">net.ipv4.ip_forward = 1</code> in the file
   <code class="filename">/etc/sysctl.conf</code>. Alternatively do this via YaST,
   for example by calling <code class="command">yast routing ip-forwarding on</code>.
  </p><p>
   The target host of the connection can see your router, but knows nothing
   about the host in your internal network where the packets originated.
   This is why the technique is called masquerading. Because of the address
   translation, the router is the first destination of any reply packets.
   The router must identify these incoming packets and translate their
   target addresses, so packets can be forwarded to the correct host in the
   local network.
  </p><p>
   With the routing of inbound traffic depending on the masquerading table,
   there is no way to open a connection to an internal host from the
   outside. For such a connection, there would be no entry in the table. In
   addition, any connection already established has a status entry assigned
   to it in the table, so the entry cannot be used by another connection.
  </p><p>
   As a consequence of all this, you might experience some problems with
   several application protocols, such as ICQ, cucme, IRC (DCC, CTCP), and
   FTP (in PORT mode). Web browsers, the standard FTP program, and many
   other programs use the PASV mode. This passive mode is much less
   problematic as far as packet filtering and masquerading are concerned.
  </p></section><section class="sect1" id="sec-security-firewall-fw" data-id-title="Firewalling basics"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.3 </span><span class="title-name">Firewalling basics</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-fw">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   <span class="emphasis"><em>Firewall</em></span> is probably the term most widely used to
   describe a mechanism that controls the data flow between networks.
   Strictly speaking, the mechanism described in this section is called a
   <span class="emphasis"><em>packet filter</em></span>. A packet filter regulates the data flow
   according to certain criteria, such as protocols, ports, and IP addresses.
   This allows you to block packets that, according to their addresses, are
   not supposed to reach your network. To allow public access to your Web
   server, for example, explicitly open the corresponding port. However, a
   packet filter does not scan the contents of packets with legitimate
   addresses, such as those directed to your Web server. For example, if
   incoming packets were intended to compromise a CGI program on your Web
   server, the packet filter would still let them through.
  </p><p>
   A more effective but more complex mechanism is the combination of several
   types of systems, such as a packet filter interacting with an application
   gateway or proxy. In this case, the packet filter rejects any packets
   destined for disabled ports. Packets that are directed to the application
   gateway are accepted. This gateway or proxy pretends to be the actual
   client of the server. In a sense, such a proxy could be considered a
   masquerading host on the protocol level used by the application. One
   example for such a proxy is Squid, an HTTP and FTP proxy server. To use
   Squid, the browser must be configured to communicate via the proxy. Any
   HTTP pages or FTP files requested are served from the proxy cache and
   objects not found in the cache are fetched from the Internet by the
   proxy.
  </p><p>
   The following section focuses on the packet filter that comes with
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>. For further information about packet filtering and
   firewalling, read the <a class="link" href="https://tldp.org/HOWTO/Firewall-HOWTO.html" target="_blank">Firewall
   HOWTO</a>.
  </p></section><section class="sect1" id="sec-security-firewall-firewalld" data-id-title="firewalld"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.4 </span><span class="title-name"><code class="systemitem">firewalld</code></span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-firewalld">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.6.5.8.2" data-id-title="firewalld replaces SuSEfirewall2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: <code class="systemitem">firewalld</code> replaces SuSEfirewall2</div><p>

    <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="phrase">15 GA</span>
    introduces <code class="systemitem">firewalld</code> as the new default software firewall, replacing
    SuSEfirewall2. If you are upgrading from a release older than <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>
    <span class="phrase">15 GA</span>,
    SuSEfirewall2 will be unchanged and you must manually upgrade to
    <code class="systemitem">firewalld</code> (see <a class="xref" href="cha-security-firewall.html#sec-security-firewall-upgrade" title="23.5. Migrating from SuSEfirewall2">Section 23.5, “Migrating from SuSEfirewall2”</a>).
   </p></div><p>
   <code class="systemitem">firewalld</code> is a daemon that maintains the system's
   <code class="command">iptables</code> rules and offers a D-Bus interface for
   operating on them. It comes with a command line utility
   <code class="command">firewall-cmd</code> and a graphical user interface
   <code class="command">firewall-config</code> for interacting with it. Since
   <code class="systemitem">firewalld</code> is running in the background and provides a well defined
   interface it allows other applications to request changes to the iptables
   rules, for example to set up virtual machine networking.
  </p><p>
   <code class="systemitem">firewalld</code> implements different security zones. Several predefined
   zones like <code class="literal">internal</code> and <code class="literal">public</code> exist.
   The administrator can define additional custom zones if desired. Each
   zone contains its own set of iptables rules. Each network interface is a
   member of exactly one zone. Individual connections can also be assigned to
   a zone based on the source addresses.
  </p><p>
   Each zone represents a certain level of trust. For example the
   <code class="literal">public</code> zone is not trusted, because other computers in
   this network are not under your control (suitable for Internet or wireless
   hotspot connections). On the other hand the <code class="literal">internal</code> zone
   is used for networks that <span class="emphasis"><em>are</em></span> under your control, like a
   home or company network. By utilizing zones this way, a host can offer
   different kinds of services to trusted networks and untrusted networks in a
   defined way.
  </p><p>
   For more information about the predefined zones and their meaning in
   <code class="systemitem">firewalld</code>, refer to its manual at
   <a class="link" href="https://www.firewalld.org/documentation/zone/predefined-zones.html" target="_blank">https://www.firewalld.org/documentation/zone/predefined-zones.html</a>.
  </p><div id="id-1.7.6.5.8.7" data-id-title="No zone assigned behavior" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: No zone assigned behavior</div><p>
     The initial state for network interfaces is to be assigned to no zone at
     all. In this case the network interface will be implicitly handled in the
     default zone, which can be determined by calling <code class="command">firewall-cmd
      --get-default-zone</code>. If not configured otherwise, the default
     zone is the <code class="literal">public</code> zone.
    </p></div><p>
   The <code class="systemitem">firewalld</code> packet filtering model allows any outgoing connections to
   pass. Outgoing connections are connections that are actively established by
   the local host. Incoming connections that are established by remote hosts are
   blocked if the respective service is not allowed in the zone in
   question. Therefore, each of the interfaces with incoming traffic must be
   placed in a suitable zone to allow for the desired services to be
   accessible. For each of the zones, define the services or protocols you
   need.
  </p><p>
   An important concept of <code class="systemitem">firewalld</code> is the distinction between two separate
   configurations: the <span class="emphasis"><em>runtime</em></span> and the
   <span class="emphasis"><em>permanent</em></span> configuration. The runtime configuration
   represents the currently active rules, while the permanent configuration
   represents the saved rules that will be applied when restarting
   <code class="systemitem">firewalld</code>. This allows to add temporary rules that will be discarded after
   restarting <code class="systemitem">firewalld</code>, or to experiment with new rules while being able to
   revert back to the original state. When you are changing the configuration,
   you need to be aware of which configuration you are editing. How this is done
   is discussed in <a class="xref" href="cha-security-firewall.html#sec-security-firewall-firewalld-configurations" title="23.4.3.2. Runtime versus permanent configuration">Section 23.4.3.2, “Runtime versus permanent configuration”</a>.
  </p><p>
   To perform the <code class="systemitem">firewalld</code> configuration using the graphical
   user interface <code class="command">firewall-config</code> refer to its <a class="link" href="https://www.firewalld.org/documentation/utilities/firewall-config.html" target="_blank">documentation</a>.
   In the following section we will be looking at how to perform typical
   <code class="systemitem">firewalld</code> configuration tasks using <code class="command">firewall-cmd</code> on the
   command line.
  </p><section class="sect2" id="sec-security-firewall-firewalld-nm" data-id-title="Configuring the firewall with NetworkManager"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.4.1 </span><span class="title-name">Configuring the firewall with NetworkManager</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-firewalld-nm">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The NetworkManager supports a basic configuration of <code class="systemitem">firewalld</code>
    by selecting zones.
   </p><p>
    When editing a wired or wireless connection, go to the
    <span class="emphasis"><em>Identity</em></span> tab in the configuration window and
    use the <code class="literal">Firewall Zone</code> drop-down box.
   </p></section><section class="sect2" id="sec-security-firewall-firewalld-yast" data-id-title="Configuring the firewall with YaST"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.4.2 </span><span class="title-name">Configuring the firewall with YaST</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-firewalld-yast">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The <code class="command">yast firewall</code> module supports a basic
     configuration of <code class="systemitem">firewalld</code>. It provides a zone
     selector, services selector, and ports selector. It does not support
     creating custom iptables rules, and limits zone creation and
     customization to selecting services and ports.
   </p><div id="id-1.7.6.5.8.12.3" data-id-title="Changing settings in running mode" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Changing settings in running mode</div><p>
     YaST respects the settings in <code class="filename">/etc/firewalld/firewalld.conf</code>,
     where the default value for <code class="option">FlushAllOnReload</code> is set to
     <code class="literal">no</code>. Therefore, YaST does not change settings in running mode.
     For example, if you have assigned an interface to a different zone with YaST,
     restart the firewalld daemon for the change to take effect.
    </p></div></section><section class="sect2" id="sec-security-firewall-firewalld-cmd" data-id-title="Configuring the firewall on the command line"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.4.3 </span><span class="title-name">Configuring the firewall on the command line</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-firewalld-cmd">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect3" id="id-1.7.6.5.8.13.2" data-id-title="Firewall start-up"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.1 </span><span class="title-name">Firewall start-up</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#id-1.7.6.5.8.13.2">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">firewalld</code> will be installed and enabled by default. It is a regular
     <code class="systemitem">systemd</code> service that can be configured via <code class="command">systemctl</code>
     or the YaST Services Manager.
    </p><div id="id-1.7.6.5.8.13.2.3" data-id-title="Automatic firewall configuration" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important: Automatic firewall configuration</div><p> After the installation, YaST automatically starts <code class="systemitem">firewalld</code> and
     leaves all interfaces in the default <code class="literal">public</code> zone. If a
     server application is configured and activated on the system, YaST can
     adjust the firewall rules via the options <span class="guimenu">Open Ports on Selected
     Interface in Firewall</span> or <span class="guimenu">Open Ports on
     Firewall</span> in the server configuration modules. Some server module
     dialogs include a <span class="guimenu">Firewall Details</span> button for
     activating additional services and ports.
     </p></div></section><section class="sect3" id="sec-security-firewall-firewalld-configurations" data-id-title="Runtime versus permanent configuration"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.2 </span><span class="title-name">Runtime versus permanent configuration</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-firewalld-configurations">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     By default, all <code class="command">firewall-cmd</code> commands operate on the
     runtime configuration. You can apply most operations to the permanent
     configuration <span class="emphasis"><em>only</em></span> by adding the
     <code class="literal">--permanent</code> parameter. When doing so, the change affects
     the permanent configuration and will not be effective
     immediately in the runtime configuration. There is currently no way to add
     a rule to both runtime and permanent configurations in a single invocation.
     To achieve this you can apply all necessary changes to the runtime
     configuration and when all is working as expected issue the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --runtime-to-permanent</code></pre></div><p>
     This writes all current runtime rules into the permanent configuration.
     Any temporary modifications you or other programs may have made to the
     firewall in other contexts are made permanent this way. If you are unsure
     about this, you can also take the opposite approach to be on the safe side:
     Add new rules to the permanent configuration and reload <code class="systemitem">firewalld</code> to
     make them active.
    </p><div id="id-1.7.6.5.8.13.3.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      Some configuration items, like the default zone, are shared by both the
      runtime and permanent configurations. Changing them reflects in both
      configurations at once.
     </p></div><p>
     To revert the runtime configuration to the permanent configuration and
     thereby discard any temporary changes, two possibilities exist, either via
     the <code class="systemitem">firewalld</code> command line interface or via <code class="systemitem">systemd</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --reload</code></pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">systemctl reload firewalld</code></pre></div><p>
     For brevity the examples in the following sections will always operate on
     the runtime configuration, if applicable. Adjust them accordingly to make
     them permanent.
    </p></section><section class="sect3" id="id-1.7.6.5.8.13.4" data-id-title="Assignment of interfaces to zones"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.3 </span><span class="title-name">Assignment of interfaces to zones</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#id-1.7.6.5.8.13.4">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     You can list all network interfaces currently assigned to a zone like this:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --zone=public --list-interfaces</code>
eth0</pre></div><p>
     Similarly you can query which zone a specific interface is assigned to:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --get-zone-of-interface=eth0</code>
public</pre></div><p>
     The following command lines assign an interface to a zone. The variant
     using <code class="literal">--add-interface</code> works if
     <code class="literal">eth0</code> is not already assigned to another zone. The
     variant using <code class="literal">--change-interface</code> always works,
     removing <code class="literal">eth0</code> from its current zone if necessary:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --zone=internal --add-interface=eth0</code>
<code class="prompt root"># </code><code class="command">firewall-cmd --zone=internal --change-interface=eth0</code></pre></div><p>
      Any operations without an explicit <code class="literal">--zone</code> argument will
      implicitly operate on the default zone. This pair of commands can be used
      for getting and setting the default zone assignment:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --get-default-zone</code>
dmz
<code class="prompt root"># </code><code class="command">firewall-cmd --set-default-zone=public</code></pre></div><div id="id-1.7.6.5.8.13.4.10" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
      Any network interfaces not explicitly assigned to a zone are
      automatically part of the default zone. Changing the default zone
      reassigns all those network interfaces immediately for the permanent and
      runtime configurations. You should never use a trusted zone like
      <code class="literal">internal</code> as the default zone, to avoid unexpected
      exposure to threats. For example, hotplugged network interfaces like USB
      Ethernet interfaces would automatically become part of the trusted zone in
      such cases.
     </p><p>
      Interfaces that are not explicitly part of any zone do
      not appear in the zone interface list. There is currently no command to
      list unassigned interfaces. Due to this it is best to avoid unassigned
      network interfaces during regular operation.
     </p></div></section><section class="sect3" id="sec-security-firewall-firewalld-cmd-ports" data-id-title="Making network services accessible"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.4 </span><span class="title-name">Making network services accessible</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-firewalld-cmd-ports">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">firewalld</code> has a concept of <span class="emphasis"><em>services</em></span>. A service
     consists of definitions of ports and protocols. These definitions
     logically belong together in the context of a given network service like
     a Web or mail server protocol. The following commands can be used to get
     information about predefined services and their details:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --get-services</code>
[...] dhcp dhcpv6 dhcpv6-client dns docker-registry [...]
<code class="prompt root"># </code><code class="command">firewall-cmd --info-service dhcp</code>
dhcp
  ports: 67/udp
  protocols:
  source-ports:
  modules:
  destination:</pre></div><p>
     These service definitions can be used for easily making the associated
     network functionality accessible in a zone. This command line opens the
     HTTP Web server port in the internal zone, for example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --add-service=http --zone=internal</code></pre></div><p>
     The removal of a service from a zone is performed using the counterpart
     command <code class="literal">--remove-service</code>. You can also define custom
     services using the <code class="literal">--new-service</code> subcommand. Refer to
     <a class="link" href="https://www.firewalld.org/documentation/howto/add-a-service.html" target="_blank">https://www.firewalld.org/documentation/howto/add-a-service.html</a>
     for more details on how to do this.
    </p><p>
     If you just want to open a single port by number, you can use the following
     approach. This will open TCP port 8000 in the internal zone:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --add-port=8000/tcp --zone=internal</code></pre></div><p>
     For removal use the counterpart command <code class="literal">--remove-port</code>.
    </p><div id="id-1.7.6.5.8.13.5.10" data-id-title="Temporarily opening a service or port" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip: Temporarily opening a service or port</div><p>
      <code class="systemitem">firewalld</code> supports a <code class="literal">--timeout</code> parameter that allows
      to open a service or port for a limited time duration. This can be helpful
      for quick testing and making sure that closing the service or port is not
      forgotten. To allow the <code class="literal">imap</code> service in the
      <code class="literal">internal</code> zone for 5 minutes, you would call
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --add-service=imap --zone=internal --timeout=5m</code></pre></div></div></section><section class="sect3" id="id-1.7.6.5.8.13.6" data-id-title="Lockdown mode"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.5 </span><span class="title-name">Lockdown mode</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#id-1.7.6.5.8.13.6">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">firewalld</code> offers a <span class="emphasis"><em>lockdown mode</em></span> that prevents
     changes to the firewall rules while it is active. Since applications can
     automatically change the firewall rules via the D-Bus interface, and
     depending on the PolicyKit rules regular users may be able to do the same,
     it can be helpful to prevent changes in some situations. You can find more
     information about this at
     <a class="link" href="https://fedoraproject.org/wiki/Features/FirewalldLockdown" target="_blank">https://fedoraproject.org/wiki/Features/FirewalldLockdown</a>.
    </p><p>
     It is important to understand that the lockdown mode feature
     provides no real security, but merely protection against accidental or
     benign attempts to change the firewall. The way the lockdown mode is
     currently implemented in <code class="systemitem">firewalld</code> provides no security against malicious
     intent, as is pointed out at
     <a class="link" href="https://seclists.org/oss-sec/2017/q3/139" target="_blank">https://seclists.org/oss-sec/2017/q3/139</a>.
    </p></section><section class="sect3" id="id-1.7.6.5.8.13.7" data-id-title="Adding custom iptables rules"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.6 </span><span class="title-name">Adding custom <code class="command">iptables</code> rules</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#id-1.7.6.5.8.13.7">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">firewalld</code> claims exclusive control over the host's
     <code class="systemitem">netfilter</code> rules. You should never modify
     firewall rules using other tools like <code class="command">iptables</code>. Doing
     so could confuse <code class="systemitem">firewalld</code> and break security or functionality.
    </p><p>
     If you need to add custom firewall rules that aren't covered by
     <code class="systemitem">firewalld</code> features then there are two ways to do so. To directly pass
     raw <code class="command">iptables</code> syntax you can use the
     <code class="literal">--direct</code> option. It expects the table, chain, and
     priority as initial arguments and the rest of the command line is passed
     as is to <code class="command">iptables</code>. The following example adds a
     connection tracking rule for the forwarding filter table:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd  --direct --add-rule ipv4 filter FORWARD 0 -i eth0 -o eth1 \
    -p tcp --dport 80 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT</code></pre></div><p>
     Additionally, <code class="systemitem">firewalld</code> implements so called <span class="emphasis"><em>rich
     rules</em></span>, an extended syntax for specifying
     <code class="command">iptables</code> rules in an easier way. You can find the
     syntax specification at
     <a class="link" href="https://www.firewalld.org/documentation/man-pages/firewalld.richlanguage.html" target="_blank">https://www.firewalld.org/documentation/man-pages/firewalld.richlanguage.html</a>.
     The following example drops all IPv4 packets originating from a certain
     source address:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --zone=public --add-rich-rule='rule family="ipv4" \
    source address="192.168.2.4" drop'</code></pre></div></section><section class="sect3" id="id-1.7.6.5.8.13.8" data-id-title="Routing, forwarding, and masquerading"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.3.7 </span><span class="title-name">Routing, forwarding, and masquerading</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#id-1.7.6.5.8.13.8">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     <code class="systemitem">firewalld</code> is not designed to run as a fully fledged router. The
     basic functionality for typical home router setups is available. For a
     corporate production router you should not use <code class="systemitem">firewalld</code>, however, but
     use dedicated router and firewall devices instead. The following provides
     just a few pointers on what to look for to utilize routing in <code class="systemitem">firewalld</code>:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       First of all IP forwarding needs to be enabled as outlined in
       <a class="xref" href="cha-security-firewall.html#sec-security-firewall-masq" title="23.2. Masquerading basics">Section 23.2, “Masquerading basics”</a>.
      </p></li><li class="listitem"><p>
       To enable IPv4 masquerading, for example in the
       <code class="literal">internal</code> zone, issue the following command.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --zone=internal --add-masquerade</code></pre></div></li><li class="listitem"><p>
       <code class="systemitem">firewalld</code> can also enable port forwarding. The following command
       forwards local TCP connections on port 80 to another host:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --zone=public \
    --add-forward-port=port=80:proto=tcp:toport=80:toaddr=192.168.1.10</code></pre></div></li></ul></div></section></section><section class="sect2" id="sec-security-firewall-firewalld-rpcports" data-id-title="Accessing services listening on dynamic ports"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">23.4.4 </span><span class="title-name">Accessing services listening on dynamic ports</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-firewalld-rpcports">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Some network services do not listen on predefined port numbers. Instead
    they operate based on the <code class="literal">portmapper</code> or
    <code class="literal">rpcbind</code> protocol. We will use the term
    <code class="literal">rpcbind</code> from here on. When one of these services
    starts, it chooses a random local port and talks to
    <code class="literal">rpcbind</code> to make the port number known.
    <code class="literal">rpcbind</code> itself is listening on a well known port.
    Remote systems can then query <code class="literal">rpcbind</code> about the network
    services it knows about and on which ports they are listening. Not many
    programs use this approach anymore today. Popular examples are
    Network Information Services (NIS; <code class="command">ypserv</code> and
    <code class="command">ypbind</code>) and the Network File System (NFS) version 3.
   </p><div id="id-1.7.6.5.8.14.3" data-id-title="About NFSv4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: About NFSv4</div><p>
     The newer NFSv4 requires the single well-known
     TCP port 2049. For protocol version 4.0, the kernel parameter
     <code class="literal">fs.nfs.nfs_callback_tcpport</code> may need to be set
     to a static port (see <a class="xref" href="cha-security-firewall.html#ex-security-firewall-nfscallback" title="Callback port configuration for the nfs kernel module in /etc/modprobe.d/60-nfs.conf">Example 23.1, “Callback port configuration for the <code class="literal">nfs</code> kernel module in <code class="filename">/etc/modprobe.d/60-nfs.conf</code>”</a>).
     Starting with protocol version 4.1 this setting has also become
     unnecessary.
    </p></div><p>
    The dynamic nature of the <code class="literal">rpcbind</code> protocol makes
    it difficult to make the affected services behind the firewall accessible.
    <code class="systemitem">firewalld</code> does not support these services by itself. For manual configuration,
    see <a class="xref" href="cha-security-firewall.html#sec-security-firewall-firewalld-rpcports-static" title="23.4.4.1. Configuring static ports">Section 23.4.4.1, “Configuring static ports”</a>.
    Alternatively, <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> provides a helper script. For details, see
    <a class="xref" href="cha-security-firewall.html#sec-security-firewall-firewalld-rpcports-helper" title="23.4.4.2. Using firewall-rpcbind-helper for configuring static ports">Section 23.4.4.2, “Using <span class="package">firewall-rpcbind-helper</span> for configuring static ports”</a>.
   </p><section class="sect3" id="sec-security-firewall-firewalld-rpcports-static" data-id-title="Configuring static ports"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.4.1 </span><span class="title-name">Configuring static ports</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-firewalld-rpcports-static">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     One possibility is to configure all involved network services to use
     fixed port numbers. Once this is done, the fixed ports can be opened in
     <code class="systemitem">firewalld</code> and everything should work. The actual port numbers used are
     at your discretion but should not clash with any well-known port numbers
     assigned to other services. See <a class="xref" href="cha-security-firewall.html#tab-security-firewall-sysconfigports" title="Important sysconfig variables for static port configuration">Table 23.1, “Important sysconfig variables for static port configuration”</a>
     for a list of the available configuration items for NIS and NFSv3
     services. Depending on your actual NIS or NFS configuration,
     not all of these ports may be required for your setup.
    </p><div class="table" id="tab-security-firewall-sysconfigports" data-id-title="Important sysconfig variables for static port configuration"><div class="title-container"><div class="table-title-wrap"><div class="table-title"><span class="title-number-name"><span class="title-number">Table 23.1: </span><span class="title-name">Important sysconfig variables for static port configuration </span></span><a title="Permalink" class="permalink" href="cha-security-firewall.html#tab-security-firewall-sysconfigports">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="1"/><col class="2"/><col class="3"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         <p>
          File Path
         </p>
        </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         <p>
          Variable Name
         </p>
        </th><th style="border-bottom: 1px solid ; ">
         <p>
          Example Value
         </p>
        </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " rowspan="5">
         <code class="filename">
          /etc/sysconfig/nfs
         </code>
        </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         MOUNTD_PORT
        </td><td style="border-bottom: 1px solid ; ">
         21001
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         STATD_PORT
        </td><td style="border-bottom: 1px solid ; ">
         21002
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         LOCKD_TCPPORT
        </td><td style="border-bottom: 1px solid ; ">
         21003
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         LOCKD_UDPPORT
        </td><td style="border-bottom: 1px solid ; ">
         21003
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         RQUOTAD_PORT
        </td><td style="border-bottom: 1px solid ; ">
         21004
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         <code class="filename">
          /etc/sysconfig/ypbind
         </code>
        </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         YPBIND_OPTIONS
        </td><td style="border-bottom: 1px solid ; ">
         -p 24500
        </td></tr><tr><td style="border-right: 1px solid ; " rowspan="3">
         <code class="filename">
          /etc/sysconfig/ypserv
         </code>
        </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         YPXFRD_ARGS
        </td><td style="border-bottom: 1px solid ; ">
         -p 24501
        </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
         YPSERV_ARGS
        </td><td style="border-bottom: 1px solid ; ">
         -p 24502
        </td></tr><tr><td style="border-right: 1px solid ; ">
         YPPASSWDD_ARGS
        </td><td>
         --port 24503
        </td></tr></tbody></table></div></div><p>
     You need to restart any related services that are affected by these
     static port configurations for the changes to take effect. You can see
     the currently assigned rpcbind ports by using the command
     <code class="command">rpcinfo -p</code>. On success, the statically configured
     ports should show up there.
    </p><p>
     Apart from the port configuration for network services running in
     userspace there are also ports that are used by the Linux kernel directly
     when it comes to NFS. One of these ports is
     <code class="literal">nfs_callback_tcpport</code>. It is only required for NFS
     protocol versions older than 4.1. There is a sysctl named
     <code class="literal">fs.nfs.nfs_callback_tcpport</code> to configure this port.
     This sysctl node only appears dynamically when NFS mounts are active.
     Therefore it is best to configure the port via kernel module
     parameters. This can be achieved by creating a file as shown in
     <a class="xref" href="cha-security-firewall.html#ex-security-firewall-nfscallback" title="Callback port configuration for the nfs kernel module in /etc/modprobe.d/60-nfs.conf">Example 23.1, “Callback port configuration for the <code class="literal">nfs</code> kernel module in <code class="filename">/etc/modprobe.d/60-nfs.conf</code>”</a>.
    </p><div class="example" id="ex-security-firewall-nfscallback" data-id-title="Callback port configuration for the nfs kernel module in /etc/modprobe.d/60-nfs.conf"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 23.1: </span><span class="title-name">Callback port configuration for the <code class="literal">nfs</code> kernel module in <code class="filename">/etc/modprobe.d/60-nfs.conf</code> </span></span><a title="Permalink" class="permalink" href="cha-security-firewall.html#ex-security-firewall-nfscallback">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">options nfs callback_tcpport=21005</pre></div></div></div><p>
     To make this change effective it is easiest to reboot the machine.
     Otherwise all NFS services need to be stopped and the
     <code class="literal">nfs</code> kernel module needs to be reloaded. To verify the
     active NFS callback port, check the output of
     <code class="command">cat /sys/module/nfs/parameters/callback_tcpport</code>.
    </p><p>
     For easy handling of the now statically configured RPC ports, it is useful
     to create a new <code class="systemitem">firewalld</code> service definition. This service definition
     groups all related ports and, for example, makes it easy to make them
     accessible in a specific zone. In
     <a class="xref" href="cha-security-firewall.html#ex-security-firewall-newrpcservice" title="Commands to define a new firewalld RPC service for NFS">Example 23.2, “Commands to define a new <code class="systemitem">firewalld</code> RPC service for NFS”</a> this is done for the
     NFS ports as they have been configured in the accompanying examples.
    </p><div class="example" id="ex-security-firewall-newrpcservice" data-id-title="Commands to define a new firewalld RPC service for NFS"><div class="title-container"><div class="example-title-wrap"><div class="example-title"><span class="title-number-name"><span class="title-number">Example 23.2: </span><span class="title-name">Commands to define a new <code class="systemitem">firewalld</code> RPC service for NFS </span></span><a title="Permalink" class="permalink" href="cha-security-firewall.html#ex-security-firewall-newrpcservice">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code><code class="command">firewall-cmd --permanent --new-service=nfs-rpc</code>
<code class="prompt root"># </code><code class="command">firewall-cmd --permanent --service=nfs-rpc --set-description="NFS related, statically configured RPC ports"</code>
# add UDP and TCP ports for the given sequence
<code class="prompt root"># </code><code class="command">for port in 21001 21002 21003 21004; do
    firewall-cmd --permanent --service=nfs-rpc --add-port ${port}/udp --add-port ${port}/tcp
done</code>
# the callback port is TCP only
<code class="prompt root"># </code><code class="command">firewall-cmd --permanent --service=nfs-rpc --add-port 21005/tcp</code>

# show the complete definition of the new custom service
<code class="prompt root"># </code><code class="command">firewall-cmd --info-service=nfs-rpc --permanent -v</code>
nfs-rpc
  summary:
  description: NFS and related, statically configured RPC ports
  ports: 4711/tcp 21001/udp 21001/tcp 21002/udp 21002/tcp 21003/udp 21003/tcp 21004/udp 21004/tcp
  protocols:
  source-ports:
  modules:
  destination:

# reload firewalld to make the new service definition available
<code class="prompt root"># </code><code class="command">firewall-cmd --reload</code>

# the new service definition can now be used to open the ports for example in the internal zone
<code class="prompt root"># </code><code class="command">firewall-cmd --add-service=nfs-rpc --zone=internal</code></pre></div></div></div></section><section class="sect3" id="sec-security-firewall-firewalld-rpcports-helper" data-id-title="Using firewall-rpcbind-helper for configuring static ports"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.4.2 </span><span class="title-name">Using <span class="package">firewall-rpcbind-helper</span> for configuring static ports</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-firewalld-rpcports-helper">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
     The steps to configure static ports as shown in the previous section can
     be simplified by using the SUSE helper tool
     <code class="command">firewall-rpc-helper.py</code>. Install it with
     <code class="command">zypper in firewalld-rpcbind-helper</code>.
    </p><p>
     The tool allows interactive configuration of the service patterns
     discussed in the previous section. It can also display current port
     assignments and can be used for scripting. For details, see
     <code class="command">firewall-rpc-helper.py --help</code>.
    </p></section><section class="sect3" id="sec-security-firewall-firewalld-nftables" data-id-title="nftables as the default back-end"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">23.4.4.3 </span><span class="title-name">nftables as the default back-end </span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-firewalld-nftables">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The default back-end for <code class="systemitem">firewalld</code> is nftables. nftables is a framework by the Linux <code class="systemitem">netfilter</code> project
  that provides packet filtering, network address translation (NAT) and other similar functionalities. nftables reuses the existing Netfilter
  subsystems such as the connection tracking system, user space queueing, logging and the hook infrastructure.
  nftables is a replacement for iptables, ip6tables, arptables, ebtables, and ipset.
</p><p>
  The advantages of using nftables include:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
        One framework for both the IPv4 and IPv6 protocols.
       </p></li><li class="listitem"><p>
        Rules are applied atomically instead of fetching, updating and storing a complete rule set.
        </p></li><li class="listitem"><p>
        Monitor trace events in the <span class="emphasis"><em>nft</em></span> tool, debug and trace the ruleset via <span class="emphasis"><em>nftrace</em></span>.
        </p></li><li class="listitem"><p>
      The <code class="command">nft</code> command line tool compiles into VM bytecode in netlink format.
      During the rule set retrieval, the VM bytecode in netlink format is translated back into the original ruleset representation.
      </p></li></ul></div><p><span class="bold"><strong>A basic nftables configuration file:</strong></span></p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code> cat /etc/nftables.conf
    #!/usr/sbin/nft -f

    flush ruleset

    # This matches IPv4 and IPv6
    table inet filter {
        # chain names are up to you.
        # what part of the traffic they cover,
        # depends on the type table.
        chain input {
            type filter hook input priority 0; policy accept;
        }
        chain forward {
            type filter hook forward priority 0; policy accept;
        }
        chain output {
            type filter hook output priority 0; policy accept;
        }
    }</pre></div><p>In the above example, all traffic is allowed because all chains have the policy <span class="emphasis"><em>accept</em></span>.
  Note that, in reality, this is a bad practice, as firewalls should deny traffic by default.</p><p><span class="bold"><strong>A basic nftables configuration file with masquerade:</strong></span></p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code> cat /etc/nftables.conf
    #!/sbin/nft -f

    flush ruleset

    table ip nat {
      chain prerouting {
        type nat hook prerouting priority 0; policy accept;
      }

      # for all packets to WAN, after routing, replace source address with primary IP of WAN interface
      chain postrouting {
        type nat hook postrouting priority 100; policy accept;
        oifname "wan0" masquerade
      }
    }</pre></div><p>If you have a static IP, it would be slightly faster to use source nat (SNAT) instead of masquerade.
    The router replaces the source with a predefined IP instead of looking up the outgoing IP for every packet.</p><p><span class="bold"><strong>An nftables configuration file with some rules applied:</strong></span></p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code> cat /etc/nftables.conf
    #!/usr/sbin/nft -f

flush ruleset

table inet filter {
    chain base_checks {
        ## another set, this time for connection tracking states.
        # allow established/related connections
        ct state {established, related} accept;

        # early drop of invalid connections
        ct state invalid drop;
    }

    chain input {
        type filter hook input priority 0; policy drop;

        # allow from loopback
        iif "lo" accept;

        jump base_checks;

        # allow icmp and igmp
        ip6 nexthdr icmpv6 icmpv6 type { echo-request, echo-reply, packet-too-big, time-exceeded, parameter-problem, destination-unreachable, packet-too-big, mld-listener-query, mld-listener-report, mld-listener-reduction, nd-router-solicit, nd-router-advert, nd-neighbor-solicit, nd-neighbor-advert, ind-neighbor-solicit, ind-neighbor-advert, mld2-listener-report } accept;
        ip protocol icmp icmp type { echo-request, echo-reply, destination-unreachable, router-solicitation, router-advertisement, time-exceeded, parameter-problem } accept;
        ip protocol igmp accept;

        # for testing reject with logging
        counter log prefix "[nftables] input reject " reject;
    }
    chain forward {
        type filter hook forward priority 0; policy accept;
    }
    chain output {
        type filter hook output priority 0; policy accept;
    }
}</pre></div><p>In the above example: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
   The chain policy is to drop and add a reject rule at the end, which means all incoming traffic is blocked.
    </p></li><li class="listitem"><p>
    All traffic on the <code class="literal">localhost</code> interface is allowed.
    </p></li><li class="listitem"><p>
   The <code class="literal">base_checks</code> chain handles all packets that are related to established connections.
   This ensures that incoming packets for outgoing connections are not blocked.
    </p></li><li class="listitem"><p>
    ICMP and IGMP packets are allowed by utilizing a set and specific type names.
   </p></li><li class="listitem"><p>
    A counter keeps a count of both the total number of packets and bytes it has seen since it was last reset.
    With nftables, you must specify a counter for each rule you want to count.
    </p></li></ul></div><section class="sect4" id="sec-security-nftables-more-information" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h5 class="title"><span class="title-number-name"><span class="title-number">23.4.4.3.1 </span><span class="title-name">More information </span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-nftables-more-information">#</a></h5><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>For more information about nftables, see:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Upstream documentation <a class="link" href="https://www.netfilter.org/projects/nftables/index.html" target="_blank"> </a>
    </p></li><li class="listitem"><p>
    nftables man page <a class="link" href="https://www.netfilter.org/projects/nftables/manpage.html" target="_blank"> </a>
    </p></li></ul></div></section></section></section></section><section class="sect1" id="sec-security-firewall-upgrade" data-id-title="Migrating from SuSEfirewall2"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.5 </span><span class="title-name">Migrating from SuSEfirewall2</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-upgrade">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><div id="id-1.7.6.5.9.2" data-id-title="Creating a firewalld configuration for AutoYaST" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Creating a <code class="systemitem">firewalld</code> configuration for AutoYaST</div><p>
    See the <em class="citetitle">Firewall Configuration</em> section of the
    AutoYaST Guide to learn how to create a <code class="systemitem">firewalld</code> configuration for AutoYaST.
   </p></div><p>
   When upgrading from
   <span class="phrase">any service pack of <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> 12</span>
   
   to <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> <span class="productnumber"><span class="phrase">15 SP7</span></span>, SuSEfirewall2
   is not changed and remains active. There is no automatic migration, so you must
   migrate to <code class="systemitem">firewalld</code> manually. <code class="systemitem">firewalld</code> includes a helper migration
   script, <code class="command">susefirewall2-to-firewalld</code>. Depending on the
   complexity of your SuSEfirewall2 configuration, the script may perform a
   perfect migration, or it may fail. Most likely it will partially succeed and you
   have to review your new <code class="systemitem">firewalld</code> configuration and make adjustments.
  </p><p>
   The resulting configuration makes <code class="systemitem">firewalld</code> behave somewhat like
   SuSEfirewall2. To take full advantage of <code class="systemitem">firewalld</code>'s features, you may elect to
   create a new configuration, rather than trying to migrate your old configuration.
   It is safe to run the <code class="command">susefirewall2-to-firewalld</code> script
   with no options, as it makes no permanent changes to your system. However, if
   you are administering the system remotely you could get locked out.
  </p><p>
   Install and run <code class="command">susefirewall2-to-firewalld</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>zypper in susefirewall2-to-firewalld
<code class="prompt root"># </code>susefirewall2-to-firewalld
INFO: Reading the /etc/sysconfig/SuSEfirewall2 file
INFO: Ensuring all firewall services are in a well-known state.
INFO: This will start/stop/restart firewall services and it's likely
INFO: to cause network disruption.
INFO: If you do not wish for this to happen, please stop the script now!
5...4...3...2...1...Lets do it!
INFO: Stopping firewalld
INFO: Restarting SuSEfirewall2_init
INFO: Restarting SuSEfirewall2
INFO: DIRECT: Adding direct rule="ipv4 -t filter -A INPUT -p udp -m udp --dport 5353 -m pkttype
  --pkt-type multicast -j ACCEPT"
[...]
INFO: Enabling direct rule=ipv6 -t filter -A INPUT -p udp -m udp --dport 546 -j ACCEPT
INFO: Enabling direct rule=ipv6 -t filter -A INPUT -p udp -m udp --dport 5353 -m pkttype
  --pkt-type multicast -j ACCEPT
INFO: Enable logging for denied packets
INFO: ##########################################################
INFO:
INFO: The dry-run has been completed. Please check the above output to ensure
INFO: that everything looks good.
INFO:
INFO: ###########################################################
INFO: Stopping firewalld
INFO: Restarting SuSEfirewall2_init
INFO: Restarting SuSEfirewall2</pre></div><p>
   This results in a lot of output, which you may wish to direct to a file for easier review:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>susefirewall2-to-firewalld | tee newfirewallrules.txt</pre></div><p>
   The script supports these options:
  </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.7.6.5.9.11.1"><span class="term"><code class="command">-c</code></span></dt><dd><p>
      Commit changes. The script makes changes to the system, so make sure you only use
      this option if you are really happy with the proposed changes. This <span class="emphasis"><em>will</em></span>
      reset your current <code class="systemitem">firewalld</code> configuration, so make sure you make backups!
     </p></dd><dt id="id-1.7.6.5.9.11.2"><span class="term"><code class="command">-d</code></span></dt><dd><p>
      Super noisy. Use it to file bug reports but be careful to mask sensitive information.
     </p></dd><dt id="id-1.7.6.5.9.11.3"><span class="term"><code class="command">-h</code></span></dt><dd><p>
      This message.
     </p></dd><dt id="id-1.7.6.5.9.11.4"><span class="term"><code class="command">-q</code></span></dt><dd><p>
      No output. Errors will not be printed either!
     </p></dd><dt id="id-1.7.6.5.9.11.5"><span class="term"><code class="command">-v</code></span></dt><dd><p>
       Verbose mode. It will print warnings and other informative messages.
      </p></dd></dl></div></section><section class="sect1" id="sec-security-firewall-info" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">23.6 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="cha-security-firewall.html#sec-security-firewall-info">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/security_firewall.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The most up-to-date information and other documentation about the <code class="systemitem">firewalld</code>
   package is found in <code class="filename">/usr/share/doc/packages/firewalld</code>.
   The home page of the netfilter and iptables project, <a class="link" href="https://www.netfilter.org" target="_blank">https://www.netfilter.org</a>, provides a large collection of
   documents about iptables in general in many languages.
  </p></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-ssh.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 22 </span>Securing network operations with OpenSSH</span></a> </div><div><a class="pagination-link next" href="cha-security-vpnserver.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 24 </span>Configuring a VPN server</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-security-firewall.html#sec-security-firewall-iptables"><span class="title-number">23.1 </span><span class="title-name">Packet filtering with iptables</span></a></span></li><li><span class="sect1"><a href="cha-security-firewall.html#sec-security-firewall-masq"><span class="title-number">23.2 </span><span class="title-name">Masquerading basics</span></a></span></li><li><span class="sect1"><a href="cha-security-firewall.html#sec-security-firewall-fw"><span class="title-number">23.3 </span><span class="title-name">Firewalling basics</span></a></span></li><li><span class="sect1"><a href="cha-security-firewall.html#sec-security-firewall-firewalld"><span class="title-number">23.4 </span><span class="title-name"><code class="systemitem">firewalld</code></span></a></span></li><li><span class="sect1"><a href="cha-security-firewall.html#sec-security-firewall-upgrade"><span class="title-number">23.5 </span><span class="title-name">Migrating from SuSEfirewall2</span></a></span></li><li><span class="sect1"><a href="cha-security-firewall.html#sec-security-firewall-info"><span class="title-number">23.6 </span><span class="title-name">More information</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>