<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLES 15 SP7 | Virtualization Guide | Advanced storage topics</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Advanced storage topics | SLES 15 SP7"/>
<meta name="description" content="This chapter introduces advanced topics about manipulating storage from the perspective of the VM Host Server."/>
<meta name="product-name" content="SUSE Linux Enterprise Server"/>
<meta name="product-number" content="15 SP7"/>
<meta name="book-title" content="Virtualization Guide"/>
<meta name="chapter-title" content="Chapter 13. Advanced storage topics"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Server 15 SP7"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Virtualization Guide"/>
<meta property="og:description" content="Learn all about virtualization and VM management"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Virtualization Guide"/>
<meta name="twitter:description" content="Learn all about virtualization and VM management"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Advanced storage topics",
  
    "description": "Advanced storage topics",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-06-26T00:00+02:00",
      
    "datePublished": "2024-06-26T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-libvirt-connect.html" title="Chapter 12. Connecting and authorizing"/><link rel="next" href="cha-libvirt-config-gui.html" title="Chapter 14. Configuring virtual machines with Virtual Machine Manager"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Virtualization Guide</a><span> / </span><a class="crumb" href="part-virt-libvirt.html">Managing virtual machines with libvirt</a><span> / </span><a class="crumb" href="cha-libvirt-storage.html">Advanced storage topics</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Virtualization Guide</div><ol><li><a href="cha-kvm.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="part-virt-intro.html" class="has-children "><span class="title-number">I </span><span class="title-name">Introduction</span></a><ol><li><a href="chap-virtualization-introduction.html" class=" "><span class="title-number">1 </span><span class="title-name">Virtualization technology</span></a></li><li><a href="cha-virtualization-scenarios.html" class=" "><span class="title-number">2 </span><span class="title-name">Virtualization scenarios</span></a></li><li><a href="cha-xen-basics.html" class=" "><span class="title-number">3 </span><span class="title-name">Introduction to Xen virtualization</span></a></li><li><a href="cha-kvm-intro.html" class=" "><span class="title-number">4 </span><span class="title-name">Introduction to KVM virtualization</span></a></li><li><a href="cha-tools-intro.html" class=" "><span class="title-number">5 </span><span class="title-name">Virtualization tools</span></a></li><li><a href="cha-vt-installation.html" class=" "><span class="title-number">6 </span><span class="title-name">Installation of virtualization components</span></a></li><li><a href="cha-virt-support.html" class=" "><span class="title-number">7 </span><span class="title-name">Virtualization limits and support</span></a></li></ol></li><li class="active"><a href="part-virt-libvirt.html" class="has-children you-are-here"><span class="title-number">II </span><span class="title-name">Managing virtual machines with <code class="systemitem">libvirt</code></span></a><ol><li><a href="cha-libvirt-overview.html" class=" "><span class="title-number">8 </span><span class="title-name"><code class="systemitem">libvirt</code> daemons</span></a></li><li><a href="cha-libvirt-host.html" class=" "><span class="title-number">9 </span><span class="title-name">Preparing the VM Host Server</span></a></li><li><a href="cha-kvm-inst.html" class=" "><span class="title-number">10 </span><span class="title-name">Guest installation</span></a></li><li><a href="cha-libvirt-managing.html" class=" "><span class="title-number">11 </span><span class="title-name">Basic VM Guest management</span></a></li><li><a href="cha-libvirt-connect.html" class=" "><span class="title-number">12 </span><span class="title-name">Connecting and authorizing</span></a></li><li><a href="cha-libvirt-storage.html" class=" you-are-here"><span class="title-number">13 </span><span class="title-name">Advanced storage topics</span></a></li><li><a href="cha-libvirt-config-gui.html" class=" "><span class="title-number">14 </span><span class="title-name">Configuring virtual machines with Virtual Machine Manager</span></a></li><li><a href="cha-libvirt-config-virsh.html" class=" "><span class="title-number">15 </span><span class="title-name">Configuring virtual machines with <code class="command">virsh</code></span></a></li><li><a href="cha-vm-security.html" class=" "><span class="title-number">16 </span><span class="title-name">Enhancing virtual machine security with AMD SEV-SNP</span></a></li><li><a href="sec-libvirt-admin-migrate.html" class=" "><span class="title-number">17 </span><span class="title-name">Migrating VM Guests</span></a></li><li><a href="xen2kvm-migration.html" class=" "><span class="title-number">18 </span><span class="title-name">Xen to KVM migration guide</span></a></li></ol></li><li><a href="part-virt-common.html" class="has-children "><span class="title-number">III </span><span class="title-name">Hypervisor-independent features</span></a><ol><li><a href="cha-cachemodes.html" class=" "><span class="title-number">19 </span><span class="title-name">Disk cache modes</span></a></li><li><a href="sec-kvm-managing-clock.html" class=" "><span class="title-number">20 </span><span class="title-name">VM Guest clock settings</span></a></li><li><a href="chap-guestfs.html" class=" "><span class="title-number">21 </span><span class="title-name">libguestfs</span></a></li><li><a href="cha-qemu-ga.html" class=" "><span class="title-number">22 </span><span class="title-name">QEMU guest agent</span></a></li><li><a href="tpm.html" class=" "><span class="title-number">23 </span><span class="title-name">Software TPM emulator</span></a></li><li><a href="virt-crash-dump.html" class=" "><span class="title-number">24 </span><span class="title-name">Creating crash dumps of a VM Guest</span></a></li></ol></li><li><a href="part-virt-xen.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Managing virtual machines with Xen</span></a><ol><li><a href="cha-xen-vhost.html" class=" "><span class="title-number">25 </span><span class="title-name">Setting up a virtual machine host</span></a></li><li><a href="cha-xen-network.html" class=" "><span class="title-number">26 </span><span class="title-name">Virtual networking</span></a></li><li><a href="cha-xen-manage.html" class=" "><span class="title-number">27 </span><span class="title-name">Managing a virtualization environment</span></a></li><li><a href="cha-xen-vbd.html" class=" "><span class="title-number">28 </span><span class="title-name">Block devices in Xen</span></a></li><li><a href="cha-xen-config.html" class=" "><span class="title-number">29 </span><span class="title-name">Virtualization: configuration options and settings</span></a></li><li><a href="cha-xen-admin.html" class=" "><span class="title-number">30 </span><span class="title-name">Administrative tasks</span></a></li><li><a href="cha-xen-xenstore.html" class=" "><span class="title-number">31 </span><span class="title-name">XenStore: configuration database shared between domains</span></a></li><li><a href="cha-xen-ha.html" class=" "><span class="title-number">32 </span><span class="title-name">Xen as a high-availability virtualization host</span></a></li><li><a href="pv-to-fv.html" class=" "><span class="title-number">33 </span><span class="title-name">Xen: converting a paravirtual (PV) guest into a fully virtual (FV/HVM) guest</span></a></li></ol></li><li><a href="part-virt-qemu.html" class="has-children "><span class="title-number">V </span><span class="title-name">Managing virtual machines with QEMU</span></a><ol><li><a href="cha-qemu-overview.html" class=" "><span class="title-number">34 </span><span class="title-name">QEMU overview</span></a></li><li><a href="cha-qemu-host.html" class=" "><span class="title-number">35 </span><span class="title-name">Setting up a KVM VM Host Server</span></a></li><li><a href="cha-qemu-guest-inst.html" class=" "><span class="title-number">36 </span><span class="title-name">Guest installation</span></a></li><li><a href="cha-qemu-running.html" class=" "><span class="title-number">37 </span><span class="title-name">Running virtual machines with qemu-system-ARCH</span></a></li><li><a href="cha-qemu-monitor.html" class=" "><span class="title-number">38 </span><span class="title-name">Virtual machine administration using QEMU monitor</span></a></li></ol></li><li><a href="part-virt-troubleshoot.html" class="has-children "><span class="title-number">VI </span><span class="title-name">Troubleshooting</span></a><ol><li><a href="cha-virt-help.html" class=" "><span class="title-number">39 </span><span class="title-name">Integrated help and package documentation</span></a></li><li><a href="cha-virt-logs.html" class=" "><span class="title-number">40 </span><span class="title-name">Gathering system information and logs</span></a></li></ol></li><li><a href="gloss-vt-glossary.html" class=" "><span class="title-number"> </span><span class="title-name">Glossary</span></a></li><li><a href="app-vmdp-driver.html" class=" "><span class="title-number">A </span><span class="title-name">Virtual machine drivers</span></a></li><li><a href="app-gpu-passthru.html" class=" "><span class="title-number">B </span><span class="title-name">Configuring GPU Pass-Through for NVIDIA cards</span></a></li><li><a href="cha-xmtoxl.html" class=" "><span class="title-number">C </span><span class="title-name">XM, XL toolstacks, and the <code class="systemitem">libvirt</code> framework</span></a></li><li><a href="bk10apd.html" class=" "><span class="title-number">D </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-libvirt-storage" data-id-title="Advanced storage topics"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP7</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">13 </span><span class="title-name">Advanced storage topics</span></span> <a title="Permalink" class="permalink" href="cha-libvirt-storage.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    This chapter introduces advanced topics about manipulating storage from the
    perspective of the VM Host Server.
  </p><section class="sect1" id="sec-libvirt-storage-locking" data-id-title="Locking disk files and block devices with virtlockd"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.1 </span><span class="title-name">Locking disk files and block devices with <code class="systemitem">virtlockd</code></span></span> <a title="Permalink" class="permalink" href="cha-libvirt-storage.html#sec-libvirt-storage-locking">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Locking block devices and disk files prevents concurrent writes to these
      resources from different VM Guests. It provides protection against
      starting the same VM Guest twice, or adding the same disk to two
      different virtual machines. This reduces the risk of a virtual machine's
      disk image becoming corrupted because of a wrong configuration.
    </p><p>
      The locking is controlled by a daemon called
      <code class="systemitem">virtlockd</code>. Since it operates
      independently from the <code class="systemitem">libvirtd</code> daemon, locks endure a crash or a
      restart of <code class="systemitem">libvirtd</code>. Locks even persist during an update of the
      <code class="systemitem">virtlockd</code> itself, since it can
      re-execute itself. This ensures that VM Guests do
      <span class="emphasis"><em>not</em></span> need to be restarted upon a
      <code class="systemitem">virtlockd</code> update.
      <code class="systemitem">virtlockd</code> is supported for
      KVM, QEMU, and Xen.
    </p><section class="sect2" id="sec-libvirt-storage-locking-enable" data-id-title="Enable locking"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.1.1 </span><span class="title-name">Enable locking</span></span> <a title="Permalink" class="permalink" href="cha-libvirt-storage.html#sec-libvirt-storage-locking-enable">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        Locking virtual disks is not enabled by default on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. To
        enable and automatically start it upon rebooting, perform the following
        steps:
      </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
            Edit <code class="filename">/etc/libvirt/qemu.conf</code> and set
          </p><div class="verbatim-wrap"><pre class="screen">lock_manager = "lockd"</pre></div></li><li class="step"><p>
            Start the <code class="systemitem">virtlockd</code> daemon
            with the following command:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl start virtlockd</pre></div></li><li class="step"><p>
            Restart the <code class="systemitem">libvirtd</code> daemon with:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl restart libvirtd</pre></div></li><li class="step"><p>
            Make sure <code class="systemitem">virtlockd</code> is
            automatically started when booting the system:
          </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl enable virtlockd</pre></div></li></ol></div></div></section><section class="sect2" id="sec-libvirt-storage-locking-configure" data-id-title="Configure locking"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">13.1.2 </span><span class="title-name">Configure locking</span></span> <a title="Permalink" class="permalink" href="cha-libvirt-storage.html#sec-libvirt-storage-locking-configure">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
        By default <code class="systemitem">virtlockd</code> is
        configured to automatically lock all disks configured for your
        VM Guests. The default setting uses a <span class="quote">“<span class="quote">direct</span>”</span> lockspace,
        where the locks are acquired against the actual file paths associated
        with the VM Guest &lt;disk&gt; devices. For example,
        <code class="literal">flock(2)</code> is called directly on
        <code class="filename">/var/lib/libvirt/images/my-server/disk0.raw</code> when
        the VM Guest contains the following &lt;disk&gt; device:
      </p><div class="verbatim-wrap"><pre class="screen">&lt;disk type='file' device='disk'&gt;
 &lt;driver name='qemu' type='raw'/&gt;
 &lt;source file='/var/lib/libvirt/images/my-server/disk0.raw'/&gt;
 &lt;target dev='vda' bus='virtio'/&gt;
&lt;/disk&gt;</pre></div><p>
        The <code class="systemitem">virtlockd</code> configuration can
        be changed by editing the file
        <code class="filename">/etc/libvirt/qemu-lockd.conf</code>. It also contains
        detailed comments with further information. Make sure to activate
        configuration changes by reloading
        <code class="systemitem">virtlockd</code>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> systemctl reload virtlockd</pre></div><section class="sect3" id="sec-libvirt-storage-locking-configure-shared-fs" data-id-title="Enabling an indirect lockspace"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">13.1.2.1 </span><span class="title-name">Enabling an indirect lockspace</span></span> <a title="Permalink" class="permalink" href="cha-libvirt-storage.html#sec-libvirt-storage-locking-configure-shared-fs">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          The default configuration of
          <code class="systemitem">virtlockd</code> uses a
          <span class="quote">“<span class="quote">direct</span>”</span> lockspace. This means that the locks are
          acquired against the actual file paths associated with the
          &lt;disk&gt; devices.
        </p><p>
          If the disk file paths are not accessible to all hosts,
          <code class="systemitem">virtlockd</code> can be configured
          to allow an <span class="quote">“<span class="quote">indirect</span>”</span> lockspace. This means that a hash
          of the disk image path is used to create a file in the indirect
          lockspace directory. The locks are then held on these hash files
          instead of the actual disk file paths. Indirect lockspace is also
          useful if the file system containing the disk files does not support
          <code class="literal">fcntl()</code> locks. An indirect lockspace is specified
          with the <code class="option">file_lockspace_dir</code> setting:
        </p><div class="verbatim-wrap"><pre class="screen">file_lockspace_dir = "<em class="replaceable">/MY_LOCKSPACE_DIRECTORY</em>"</pre></div></section><section class="sect3" id="sec-libvirt-storage-locking-configure-lvm-iscsi" data-id-title="Enable locking on LVM or iSCSI volumes"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">13.1.2.2 </span><span class="title-name">Enable locking on LVM or iSCSI volumes</span></span> <a title="Permalink" class="permalink" href="cha-libvirt-storage.html#sec-libvirt-storage-locking-configure-lvm-iscsi">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
          When wanting to lock virtual disks placed on LVM or iSCSI volumes
          shared by several hosts, locking needs to be done by UUID rather than
          by path (which is used by default). Furthermore, the lockspace
          directory needs to be placed on a shared file system accessible by
          all hosts sharing the volume. Set the following options for LVM
          and/or iSCSI:
        </p><div class="verbatim-wrap"><pre class="screen">lvm_lockspace_dir = "<em class="replaceable">/MY_LOCKSPACE_DIRECTORY</em>"
iscsi_lockspace_dir = "<em class="replaceable">/MY_LOCKSPACE_DIRECTORY</em>"</pre></div></section></section></section><section class="sect1" id="sec-libvirt-storage-resize" data-id-title="Online resizing of guest block devices"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.2 </span><span class="title-name">Online resizing of guest block devices</span></span> <a title="Permalink" class="permalink" href="cha-libvirt-storage.html#sec-libvirt-storage-resize">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      Sometimes you need to change—extend or shrink—the size of the
      block device used by your guest system. For example, when the disk space
      originally allocated is no longer enough, it is time to increase its
      size. If the guest disk resides on a <span class="emphasis"><em>logical volume</em></span>,
      you can resize it while the guest system is running. This is a big
      advantage over an offline disk resizing (see the
      <code class="command">virt-resize</code> command from the
      <a class="xref" href="chap-guestfs.html#sec-guestfs-tools" title="21.3. Guestfs tools">Section 21.3, “Guestfs tools”</a> package) as the service provided by
      the guest is not interrupted by the resizing process. To resize a
      VM Guest disk, follow these steps:
    </p><div class="procedure" id="id-1.12.4.7.5.3" data-id-title="Online resizing of guest disk"><div class="title-container"><div class="procedure-title-wrap"><div class="procedure-title"><span class="title-number-name"><span class="title-number">Procedure 13.1: </span><span class="title-name">Online resizing of guest disk </span></span><a title="Permalink" class="permalink" href="cha-libvirt-storage.html#id-1.12.4.7.5.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
          Inside the guest system, check the current size of the disk (for
          example <code class="filename">/dev/vda</code>).
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>fdisk -l /dev/vda
Disk /dev/sda: 160.0 GB, 160041885696 bytes, 312581808 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes</pre></div></li><li class="step"><p>
          On the host, resize the logical volume holding the
          <code class="filename">/dev/vda</code> disk of the guest to the required size,
          for example, 200 GB.
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>lvresize -L 200G /dev/mapper/vg00-home
Extending logical volume home to 200 GiB
Logical volume home successfully resized</pre></div></li><li class="step"><p>
          On the host, resize the block device related to the disk
          <code class="filename">/dev/mapper/vg00-home</code> of the guest. You can find
          the <em class="replaceable">DOMAIN_ID</em> with <code class="command">virsh
          list</code>.
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>virsh blockresize  --path /dev/vg00/home --size 200G <em class="replaceable">DOMAIN_ID</em>
Block device '/dev/vg00/home' is resized</pre></div></li><li class="step"><p>
          Check that the new disk size is accepted by the guest.
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root"># </code>fdisk -l /dev/vda
Disk /dev/sda: 200.0 GB, 200052357120 bytes, 390727260 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes</pre></div></li></ol></div></div></section><section class="sect1" id="sec-libvirt-storage-share" data-id-title="Sharing directories between host and guests (file system pass-through)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.3 </span><span class="title-name">Sharing directories between host and guests (file system pass-through)</span></span> <a title="Permalink" class="permalink" href="cha-libvirt-storage.html#sec-libvirt-storage-share">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      libvirt allows to share directories between host and guests using
      QEMU's file system pass-through (also called VirtFS) feature. Such a
      directory can be also be accessed by several VM Guests at once and
      therefore be used to exchange files between VM Guests.
    </p><div id="id-1.12.4.7.6.3" data-id-title="Windows guests and file system pass-through" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: Windows guests and file system pass-through</div><p>
        Sharing directories between VM Host Server and Windows guests via File System
        Pass-Through does not work, because Windows lacks the drivers required
        to mount the shared directory.
      </p></div><p>
      To make a shared directory available on a VM Guest, proceed as follows:
    </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
          Open the guest's console in Virtual Machine Manager and either choose
          <span class="guimenu">View</span> › <span class="guimenu">Details</span> from the menu or click
          <span class="guimenu">Show virtual hardware details</span> in the toolbar.
          Choose <span class="guimenu">Add Hardware</span> › <span class="guimenu">Filesystem</span> to open the
          <span class="guimenu">Filesystem Passthrough</span> dialog.
        </p></li><li class="step"><p>
          <span class="guimenu">Driver</span> allows you to choose between a
          <span class="guimenu">Handle</span> or <span class="guimenu">Path</span> base driver. The
          default setting is <span class="guimenu">Path</span>. <span class="guimenu">Mode</span>
          lets you choose the security model, which influences the way file
          permissions are set on the host. Three options are available:
        </p><div class="variablelist"><dl class="variablelist"><dt id="id-1.12.4.7.6.5.2.2.1"><span class="term"><span class="guimenu">Passthrough</span> (default)</span></dt><dd><p>
                Files on the file system are directly created with the
                client-user's credentials. This is similar to what NFSv3 is
                using.
              </p></dd><dt id="id-1.12.4.7.6.5.2.2.2"><span class="term"><span class="guimenu">Squash</span></span></dt><dd><p>
                Same as <span class="guimenu">Passthrough</span>, but failure of
                privileged operations like <code class="command">chown</code> are
                ignored. This is required when KVM is not run with
                <code class="systemitem">root</code>
                privileges.
              </p></dd><dt id="id-1.12.4.7.6.5.2.2.3"><span class="term"><span class="guimenu">Mapped</span></span></dt><dd><p>
                Files are created with the file server's credentials
                (<code class="literal">qemu.qemu</code>). The user credentials and the
                client-user's credentials are saved in extended attributes.
                This model is recommended when host and guest domains should be
                kept isolated.
              </p></dd></dl></div></li><li class="step"><p>
          Specify the path to the directory on the VM Host Server with
          <span class="guimenu">Source Path</span>. Enter a string at <span class="guimenu">Target
          Path</span> to be used as a tag to mount the shared directory. The
          string of this field is a tag only, not a path on the VM Guest.
        </p></li><li class="step"><p>
          <span class="guimenu">Apply</span> the setting. If the VM Guest is currently
          running, you need to shut it down to apply the new setting (rebooting
          the guest is not sufficient).
        </p></li><li class="step"><p>
          Boot the VM Guest. To mount the shared directory, enter the
          following command:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> mount -t 9p -o trans=virtio,version=9p2000.L,rw <em class="replaceable">TAG</em> /<em class="replaceable">MOUNT_POINT</em></pre></div><p>
          To make the shared directory permanently available, add the following
          line to the <code class="filename">/etc/fstab</code> file:
        </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable">TAG</em>   /<em class="replaceable">MOUNT_POINT</em>    9p  trans=virtio,version=9p2000.L,rw    0   0</pre></div></li></ol></div></div></section><section class="sect1" id="libvirt-storage-rbd" data-id-title="Using RADOS block devices with libvirt"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">13.4 </span><span class="title-name">Using RADOS block devices with <code class="systemitem">libvirt</code></span></span> <a title="Permalink" class="permalink" href="cha-libvirt-storage.html#libvirt-storage-rbd">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/libvirt_storage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
      RADOS Block Devices (RBD) store data in a Ceph cluster. They allow
      snapshotting, replication and data consistency. You can use an RBD from
      your <code class="systemitem">libvirt</code>-managed VM Guests similarly to how you use other block
      devices.
    </p><p>
      For more details, refer to the SUSE Enterprise Storage <em class="citetitle">Administration Guide</em>,
      chapter <em class="citetitle">Using libvirt with Ceph</em>. The SUSE Enterprise Storage
      documentation is available from
      <a class="link" href="https://documentation.suse.com/ses/" target="_blank">https://documentation.suse.com/ses/</a>.
    </p></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-libvirt-connect.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 12 </span>Connecting and authorizing</span></a> </div><div><a class="pagination-link next" href="cha-libvirt-config-gui.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 14 </span>Configuring virtual machines with Virtual Machine Manager</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-libvirt-storage.html#sec-libvirt-storage-locking"><span class="title-number">13.1 </span><span class="title-name">Locking disk files and block devices with <code class="systemitem">virtlockd</code></span></a></span></li><li><span class="sect1"><a href="cha-libvirt-storage.html#sec-libvirt-storage-resize"><span class="title-number">13.2 </span><span class="title-name">Online resizing of guest block devices</span></a></span></li><li><span class="sect1"><a href="cha-libvirt-storage.html#sec-libvirt-storage-share"><span class="title-number">13.3 </span><span class="title-name">Sharing directories between host and guests (file system pass-through)</span></a></span></li><li><span class="sect1"><a href="cha-libvirt-storage.html#libvirt-storage-rbd"><span class="title-number">13.4 </span><span class="title-name">Using RADOS block devices with <code class="systemitem">libvirt</code></span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>