<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SLED 15 SP7 | Administration Guide | UEFI (Unified Extensible Firmware Interface)</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="UEFI (Unified Extensible Firmware Interface) | SLED 15…"/>
<meta name="description" content="UEFI (Unified Extensible Firmware Interface) is the interface between the firmware that comes with the system hardware, all the hardware components o…"/>
<meta name="product-name" content="SUSE Linux Enterprise Desktop"/>
<meta name="product-number" content="15 SP7"/>
<meta name="book-title" content="Administration Guide"/>
<meta name="chapter-title" content="Chapter 17. UEFI (Unified Extensible Firmware Interface)"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-assignee" content="fs@suse.com"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="PUBLIC SUSE Linux Enterprise Desktop 15 SP7"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Administration Guide"/>
<meta property="og:description" content="Maintain, monitor and customize SLED"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Administration Guide"/>
<meta name="twitter:description" content="Maintain, monitor and customize SLED"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Products &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "UEFI (Unified Extensible Firmware Interface)",
  
    "description": "UEFI (Unified Extensible Firmware Interface)",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      
    "dateModified": "2024-06-26T00:00+02:00",
      
    "datePublished": "2024-06-26T00:00+02:00",
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="cha-boot.html" title="Chapter 16. Introduction to the boot process"/><link rel="next" href="cha-grub2.html" title="Chapter 18. The boot loader GRUB 2"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Administration Guide</a><span> / </span><a class="crumb" href="part-boot.html">Booting a Linux system</a><span> / </span><a class="crumb" href="cha-uefi.html">UEFI (Unified Extensible Firmware Interface)</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Administration Guide</div><ol><li><a href="preface-administration.html" class=" "><span class="title-number"> </span><span class="title-name">Preface</span></a></li><li><a href="part-administration.html" class="has-children "><span class="title-number">I </span><span class="title-name">Common tasks</span></a><ol><li><a href="cha-adm-shell.html" class=" "><span class="title-number">1 </span><span class="title-name">Bash and Bash scripts</span></a></li><li><a href="cha-adm-sudo.html" class=" "><span class="title-number">2 </span><span class="title-name"><code class="command">sudo</code> basics</span></a></li><li><a href="cha-yast-gui.html" class=" "><span class="title-number">3 </span><span class="title-name">Using YaST</span></a></li><li><a href="cha-yast-text.html" class=" "><span class="title-number">4 </span><span class="title-name">YaST in text mode</span></a></li><li><a href="cha-yast-lang.html" class=" "><span class="title-number">5 </span><span class="title-name">Changing language and country settings with YaST</span></a></li><li><a href="cha-yast-userman.html" class=" "><span class="title-number">6 </span><span class="title-name">Managing users with YaST</span></a></li><li><a href="cha-onlineupdate-you.html" class=" "><span class="title-number">7 </span><span class="title-name">YaST online update</span></a></li><li><a href="cha-yast-software.html" class=" "><span class="title-number">8 </span><span class="title-name">Installing or removing software</span></a></li><li><a href="cha-sw-cl.html" class=" "><span class="title-number">9 </span><span class="title-name">Managing software with command line tools</span></a></li><li><a href="cha-snapper.html" class=" "><span class="title-number">10 </span><span class="title-name">System recovery and snapshot management with Snapper</span></a></li><li><a href="cha-klp.html" class=" "><span class="title-number">11 </span><span class="title-name">Live kernel patching with KLP</span></a></li><li><a href="cha-ulp.html" class=" "><span class="title-number">12 </span><span class="title-name">User space live patching</span></a></li><li><a href="cha-transactional-updates.html" class=" "><span class="title-number">13 </span><span class="title-name">Transactional updates</span></a></li><li><a href="cha-vnc.html" class=" "><span class="title-number">14 </span><span class="title-name">Remote graphical sessions with VNC</span></a></li><li><a href="cha-net-rsync.html" class=" "><span class="title-number">15 </span><span class="title-name">File copying with RSync</span></a></li></ol></li><li class="active"><a href="part-boot.html" class="has-children you-are-here"><span class="title-number">II </span><span class="title-name">Booting a Linux system</span></a><ol><li><a href="cha-boot.html" class=" "><span class="title-number">16 </span><span class="title-name">Introduction to the boot process</span></a></li><li><a href="cha-uefi.html" class=" you-are-here"><span class="title-number">17 </span><span class="title-name">UEFI (Unified Extensible Firmware Interface)</span></a></li><li><a href="cha-grub2.html" class=" "><span class="title-number">18 </span><span class="title-name">The boot loader GRUB 2</span></a></li><li><a href="cha-systemd.html" class=" "><span class="title-number">19 </span><span class="title-name">The <code class="systemitem">systemd</code> daemon</span></a></li></ol></li><li><a href="part-system.html" class="has-children "><span class="title-number">III </span><span class="title-name">System</span></a><ol><li><a href="cha-64bit.html" class=" "><span class="title-number">20 </span><span class="title-name">32-bit and 64-bit applications in a 64-bit system environment</span></a></li><li><a href="cha-journalctl.html" class=" "><span class="title-number">21 </span><span class="title-name"><code class="command">journalctl</code>: query the <code class="systemitem">systemd</code> journal</span></a></li><li><a href="cha-update-alternative.html" class=" "><span class="title-number">22 </span><span class="title-name"><code class="command">update-alternatives</code>: managing multiple versions of commands and files</span></a></li><li><a href="cha-network.html" class=" "><span class="title-number">23 </span><span class="title-name">Basic networking</span></a></li><li><a href="cha-print.html" class=" "><span class="title-number">24 </span><span class="title-name">Printer operation</span></a></li><li><a href="cha-gui-desktop.html" class=" "><span class="title-number">25 </span><span class="title-name">Graphical user interface</span></a></li><li><a href="cha-fuse.html" class=" "><span class="title-number">26 </span><span class="title-name">Accessing file systems with FUSE</span></a></li><li><a href="cha-tuning-multikernel.html" class=" "><span class="title-number">27 </span><span class="title-name">Installing multiple kernel versions</span></a></li><li><a href="cha-mod.html" class=" "><span class="title-number">28 </span><span class="title-name">Managing kernel modules</span></a></li><li><a href="cha-udev.html" class=" "><span class="title-number">29 </span><span class="title-name">Dynamic kernel device management with <code class="systemitem">udev</code></span></a></li><li><a href="cha-suse.html" class=" "><span class="title-number">30 </span><span class="title-name">Special system features</span></a></li><li><a href="cha-nm.html" class=" "><span class="title-number">31 </span><span class="title-name">Using NetworkManager</span></a></li></ol></li><li><a href="part-hardware.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Hardware configuration</span></a><ol><li><a href="sec-yast-hw-keym.html" class=" "><span class="title-number">32 </span><span class="title-name">Setting up your system keyboard layout</span></a></li><li><a href="sec-yast-hw-sound.html" class=" "><span class="title-number">33 </span><span class="title-name">Setting up sound cards</span></a></li><li><a href="sec-yast-hw-print.html" class=" "><span class="title-number">34 </span><span class="title-name">Setting up a printer</span></a></li><li><a href="sec-yast-hw-scan.html" class=" "><span class="title-number">35 </span><span class="title-name">Setting up a scanner</span></a></li><li><a href="cha-power-mgmt.html" class=" "><span class="title-number">36 </span><span class="title-name">Power management</span></a></li><li><a href="cha-nvdimm.html" class=" "><span class="title-number">37 </span><span class="title-name">Persistent memory</span></a></li></ol></li><li><a href="part-services.html" class="has-children "><span class="title-number">V </span><span class="title-name">Services</span></a><ol><li><a href="cha-yast-serviceman.html" class=" "><span class="title-number">38 </span><span class="title-name">Service management with YaST</span></a></li><li><a href="cha-ntp.html" class=" "><span class="title-number">39 </span><span class="title-name">Time synchronization with NTP</span></a></li></ol></li><li><a href="part-trouble.html" class="has-children "><span class="title-number">VI </span><span class="title-name">Troubleshooting</span></a><ol><li><a href="cha-adminhelp.html" class=" "><span class="title-number">40 </span><span class="title-name">Help and documentation</span></a></li><li><a href="cha-adm-support.html" class=" "><span class="title-number">41 </span><span class="title-name">Gathering system information for support</span></a></li><li><a href="cha-trouble.html" class=" "><span class="title-number">42 </span><span class="title-name">Common problems and their solutions</span></a></li></ol></li><li><a href="app-nwscheme.html" class=" "><span class="title-number">A </span><span class="title-name">An example network</span></a></li><li><a href="bk01apb.html" class=" "><span class="title-number">B </span><span class="title-name">GNU licenses</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="cha-uefi" data-id-title="UEFI (Unified Extensible Firmware Interface)"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15 SP7</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">17 </span><span class="title-name">UEFI (Unified Extensible Firmware Interface)</span></span> <a title="Permalink" class="permalink" href="cha-uefi.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  UEFI (Unified Extensible Firmware Interface) is the interface between the
  firmware that comes with the system hardware, all the hardware components of
  the system, and the operating system.
 </p><p>
  UEFI is becoming more and more available on PC systems and thus is replacing
  the traditional PC-BIOS. UEFI, for example, properly supports 64-bit systems
  and offers secure booting (<span class="quote">“<span class="quote">Secure Boot</span>”</span>, firmware version
  2.3.1c or better required), which is one of its most important features.
  Lastly, with UEFI a standard firmware will become available on all x86
  platforms.
 </p><p>
  UEFI additionally offers the following advantages:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Booting from large disks (over 2 TiB) with a GUID Partition Table (GPT).
   </p></li><li class="listitem"><p>
    CPU-independent architecture and drivers.
   </p></li><li class="listitem"><p>
    Flexible pre-OS environment with network capabilities.
   </p></li><li class="listitem"><p>
    CSM (Compatibility Support Module) to support booting legacy operating
    systems via a PC-BIOS-like emulation.
   </p></li></ul></div><p>
  For more information, see
  <a class="link" href="https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface" target="_blank">https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface</a>.
  The following sections are not meant as a general UEFI overview; these are
  only hints about how certain features are implemented in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>.
 </p><section class="sect1" id="sec-uefi-secboot" data-id-title="Secure boot"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.1 </span><span class="title-name">Secure boot</span></span> <a title="Permalink" class="permalink" href="cha-uefi.html#sec-uefi-secboot">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In the world of UEFI, securing the bootstrapping process means establishing
   a chain of trust. The <span class="quote">“<span class="quote">platform</span>”</span> is the root of this chain of
   trust; in the context of <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, the mainboard and the on-board firmware
   could be considered the <span class="quote">“<span class="quote">platform</span>”</span>. In other words, it is the hardware vendor, and the chain of trust flows from
   that hardware vendor to the component manufacturers, the OS vendors, etc.
  </p><p>
   The trust is expressed via public key cryptography. The hardware vendor puts
   a so-called Platform Key (PK) into the firmware, representing the root of
   trust. The trust relationship with operating system vendors and others is
   documented by signing their keys with the Platform Key.
  </p><p>
   Finally, security is established by requiring that no code will be executed
   by the firmware unless it has been signed by one of these
   <span class="quote">“<span class="quote">trusted</span>”</span> keys—be it an OS boot loader, a driver located
   in the flash memory of certain PCI Express card or on disk, or be it an
   update of the firmware itself.
  </p><p>
   To use Secure Boot, you need to have your OS loader signed with
   a key trusted by the firmware, and you need the OS loader to verify that the
   kernel it loads can be trusted.
  </p><p>

   Key Exchange Keys (KEK) can be added to the UEFI key database. This way, you
   can use other certificates, if they are signed with the private part
   of the PK.

  </p><section class="sect2" id="sec-uefi-secboot-sle" data-id-title="Implementation on SUSE Linux Enterprise Desktop"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.1.1 </span><span class="title-name">Implementation on <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span></span> <a title="Permalink" class="permalink" href="cha-uefi.html#sec-uefi-secboot-sle">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    Microsoft’s Key Exchange Key (KEK) is installed by default.
   </p><div id="id-1.3.4.3.8.7.3" data-id-title="GUID partitioning table (GPT) required" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note: GUID partitioning table (GPT) required</div><p>
     The Secure Boot feature is enabled by default on UEFI/x86_64
     installations. You can find the <span class="guimenu">Enable Secure Boot
     Support</span> option in the <span class="guimenu">Boot Code Options</span> tab
     of the <span class="guimenu">Boot Loader Settings</span> dialog. It supports booting
     when the secure boot is activated in the firmware, while making it
     possible to boot when it is deactivated.
    </p><div class="figure" id="id-1.3.4.3.8.7.3.3"><div class="figure-contents"><div class="mediaobject"><a href="images/yast2_bootloader_boot_code_efi.png"><img src="images/yast2_bootloader_boot_code_efi.png" width="70%" alt="Secure boot support" title="Secure boot support"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 17.1: </span><span class="title-name">Secure boot support </span></span><a title="Permalink" class="permalink" href="cha-uefi.html#id-1.3.4.3.8.7.3.3">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml" title="Edit source document"> </a></div></div></div><p>
     The Secure Boot feature requires that a GUID Partitioning Table (GPT)
     replaces the old partitioning with a Master Boot Record (MBR). If YaST
     detects EFI mode during the installation, it will try to create a GPT
     partition. UEFI expects to find the EFI programs on a FAT-formatted EFI
     System Partition (ESP).
    </p></div><p>
    Supporting UEFI Secure Boot requires having a boot loader with
    a digital signature that the firmware recognizes as a trusted key. That key
    is trusted by the firmware a priori, without requiring any manual
    intervention.
   </p><p>
    There are two ways of getting there. One is to work with hardware vendors
    to have them endorse a SUSE key, which SUSE then signs the boot loader
    with. The other way is to go through Microsoft’s Windows Logo
    Certification program to have the boot loader certified and have Microsoft
    recognize the SUSE signing key (that is, have it signed with their KEK). By
    now, SUSE got the loader signed by UEFI Signing Service (that is Microsoft
    in this case).
   </p><div class="figure" id="fig-uefi-secure-boot-mok2"><div class="figure-contents"><div class="mediaobject"><a href="images/uefi-secure-boot-mok2.png"><img src="images/uefi-secure-boot-mok2.png" width="80%" alt="UEFI: secure boot process" title="UEFI: secure boot process"/></a></div></div><div class="title-container"><div class="figure-title-wrap"><div class="figure-title"><span class="title-number-name"><span class="title-number">Figure 17.2: </span><span class="title-name">UEFI: secure boot process </span></span><a title="Permalink" class="permalink" href="cha-uefi.html#fig-uefi-secure-boot-mok2">#</a></div></div><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml" title="Edit source document"> </a></div></div></div><p>
    At the implementation layer, SUSE uses the <code class="systemitem">shim</code>
    loader which is installed by default. It is a smart solution that avoids
    legal issues, and simplifies the certification and signing step
    considerably. The <code class="systemitem">shim</code> loader’s job is to load a
    boot loader such as GRUB 2 and verify it; this boot loader in
    turn will load kernels signed by a SUSE key only.
   </p><p>
    There are two types of trusted users:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      First, those who hold the keys. The Platform Key (PK) allows almost
      everything. The Key Exchange Key (KEK) allows all a PK can except
      changing the PK.
     </p></li><li class="listitem"><p>
      Second, anyone with physical access to the machine. A user with physical
      access can reboot the machine, and configure UEFI.
     </p></li></ul></div><p>
    UEFI offers two types of variables to fulfill the needs of those users:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      The first is the so-called <span class="quote">“<span class="quote">Authenticated Variables</span>”</span>, which
      can be updated from both within the boot process (the so-called Boot
      Services Environment) and the running OS. This can be done only when the new value of
      the variable is signed with the same key that the old value of the
      variable was signed with. And they can only be appended to or changed to
      a value with a higher serial number.
     </p></li><li class="listitem"><p>
      The second is the so-called <span class="quote">“<span class="quote">Boot Services Only Variables</span>”</span>.
      These variables are accessible to any code that runs during the boot
      process. After the boot process ends and before the OS starts, the boot
      loader must call the <code class="literal">ExitBootServices</code> call. After
      that, these variables are no longer accessible, and the OS cannot touch
      them.
     </p></li></ul></div><p>
    UEFI key lists are of the first type, as this allows online updating, adding
    and blacklisting of keys, drivers and firmware fingerprints. It is the
    second type of variable, the <span class="quote">“<span class="quote">Boot Services Only Variable</span>”</span>,
    that helps to implement Secure Boot in a secure and open source-friendly
    manner, and thus compatible with GPLv3.
   </p><p>
    SUSE starts with <code class="systemitem">shim</code>—a small and simple EFI
    boot loader signed by SUSE and Microsoft.
   </p><p>
    This allows <code class="systemitem">shim</code> to load and execute.
   </p><p>
    <code class="systemitem">shim</code> then goes on to verify that the boot loader
    it wants to load is trusted.

    In a default situation <code class="systemitem">shim</code> will use an
    independent SUSE certificate embedded in its body. In addition,
    <code class="systemitem">shim</code> will allow to <span class="quote">“<span class="quote">enroll</span>”</span>
    additional keys, overriding the default SUSE key. In the following, we call
    them <span class="quote">“<span class="quote">Machine Owner Keys</span>”</span> or MOKs for short.
   </p><p>
    Next the boot loader will verify and then boot the kernel, and the kernel
    will do the same on the modules.
   </p></section><section class="sect2" id="sec-uefi-secboot-mok" data-id-title="MOK (Machine Owner Key)"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.1.2 </span><span class="title-name">MOK (Machine Owner Key)</span></span> <a title="Permalink" class="permalink" href="cha-uefi.html#sec-uefi-secboot-mok">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To replace specific kernels, drivers or other components that are part of
   the boot process, you need to use Machine Owner Keys (MOKs). The
   <code class="systemitem">mokutil</code> tool can help you to manage MOKs.
   </p><p>
   You can create a MOK enrollment request with
   <code class="systemitem">mokutil</code>. The request is stored in a UEFI runtime
   (RT) variable called <code class="systemitem">MokNew</code>. During the next boot,
   the <code class="systemitem">shim</code> boot loader detects
   <code class="systemitem">MokNew</code> and loads
   <code class="systemitem">MokManager</code>, which presents you with several options.
   You can use the <span class="guimenu">Enroll key from disk</span> and
   <span class="guimenu">Enroll hash from disk</span> options to add the key to the
   MokList. Use the <span class="guimenu">Enroll MOK</span> option to copy the key from
   the <code class="systemitem">MokNew</code> variable.
   </p><p>
   Enrolling a key from disk is normally done when the shim fails to
   load <code class="systemitem">grub2</code> and falls back to loading
   MokManager. As <code class="systemitem">MokNew</code> does not exist yet,
   you have the option of locating the key on the UEFI partition.
   </p></section><section class="sect2" id="sec-uefi-secboot-custom" data-id-title="Booting a custom kernel"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.1.3 </span><span class="title-name">Booting a custom kernel</span></span> <a title="Permalink" class="permalink" href="cha-uefi.html#sec-uefi-secboot-custom">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    The following is based on
    <a class="link" href="https://en.opensuse.org/openSUSE:UEFI#Booting_a_custom_kernel" target="_blank">https://en.opensuse.org/openSUSE:UEFI#Booting_a_custom_kernel</a>.
   </p><p>
    Secure Boot does not prevent you from using a self-compiled kernel. You
    must sign it with your own certificate and make that certificate known to
    the firmware or MOK.
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Create a custom X.509 key and certificate used for signing:
     </p><div class="verbatim-wrap"><pre class="screen">openssl req -new -x509 -newkey rsa:2048 -keyout key.asc \
  -out cert.pem -nodes -days 666 -subj "/CN=$USER/"</pre></div><p>

      For more information about creating certificates, see
      <a class="link" href="https://en.opensuse.org/openSUSE:UEFI_Image_File_Sign_Tools#Create_Your_Own_Certificate" target="_blank">https://en.opensuse.org/openSUSE:UEFI_Image_File_Sign_Tools#Create_Your_Own_Certificate</a>.
     </p></li><li class="step"><p>
      Package the key and the certificate as a PKCS#12 structure:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>openssl pkcs12 -export -inkey key.asc -in cert.pem \
  -name kernel_cert -out cert.p12</pre></div></li><li class="step"><p>
      Generate an NSS database for use with <code class="command">pesign</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>certutil -d . -N</pre></div></li><li class="step"><p>
      Import the key and the certificate contained in PKCS#12 into the NSS
      database:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>pk12util -d . -i cert.p12</pre></div></li><li class="step"><p>
      <span class="quote">“<span class="quote">Bless</span>”</span> the kernel with the new signature using
      <code class="command">pesign</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>pesign -n . -c kernel_cert -i arch/x86/boot/bzImage \
  -o vmlinuz.signed -s</pre></div></li><li class="step"><p>
      List the signatures on the kernel image:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>pesign -n . -S -i vmlinuz.signed</pre></div><p>
      At that point, you can install the kernel in <code class="filename">/boot</code>
      as usual. Because the kernel now has a custom signature the certificate
      used for signing needs to be imported into the UEFI firmware or MOK.
     </p></li><li class="step"><p>
      Convert the certificate to the DER format for import into the firmware or
      MOK:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>openssl x509 -in cert.pem -outform der -out cert.der</pre></div></li><li class="step"><p>
      Copy the certificate to the ESP for easier access:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code><code class="command">sudo</code> cp cert.der /boot/efi/</pre></div></li><li class="step"><p>
      Use <code class="command">mokutil</code> to launch the MOK list automatically.
     </p><ul class="stepalternatives">
      <li class="step"><ol type="a" class="substeps"><li class="step"><p>
          Import the certificate to MOK:
         </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>mokutil --root-pw --import cert.der</pre></div><p>
          The <code class="option">--root-pw</code> option enables usage of the <code class="systemitem">root</code>
          user directly.
         </p></li><li class="step"><p>
          Check the list of certificates that are prepared to be enrolled:
         </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>mokutil --list-new</pre></div></li><li class="step"><p>
          Reboot the system; <code class="systemitem">shim</code> should launch
          MokManager. You need to enter the <code class="systemitem">root</code> password to confirm the
          import of the certificate to the MOK list.
         </p></li><li class="step"><p>
          Check if the newly imported key was enrolled:
         </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">&gt; </code>mokutil --list-enrolled</pre></div></li></ol></li>
      <li class="step"><ol type="a" class="substeps"><li class="step"><p>
          Alternatively, this is the procedure to launch MOK manually:
         </p><p>
          Reboot
         </p></li><li class="step"><p>
          In the GRUB 2 menu press the '<code class="literal">c</code>' key.
         </p></li><li class="step"><p>
          Type:
         </p><div class="verbatim-wrap"><pre class="screen">chainloader $efibootdir/MokManager.efi
boot</pre></div></li><li class="step"><p>
          Select <span class="guimenu">Enroll key from disk</span>.
         </p></li><li class="step"><p>
          Navigate to the <code class="filename">cert.der</code> file and press
          <span class="keycap">Enter</span>.
         </p></li><li class="step"><p>
          Follow the instructions to enroll the key. Normally this should be
          pressing <span class="quote">“<span class="quote">0</span>”</span> and then <span class="quote">“<span class="quote">y</span>”</span> to
          confirm.
         </p><p>
          Alternatively, the firmware menu may provide ways to add a new key to
          the Signature Database.
         </p></li></ol></li>
     </ul></li></ol></div></div></section><section class="sect2" id="sec-uefi-secboot-non-inbox" data-id-title="Using non-inbox drivers"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.1.4 </span><span class="title-name">Using non-inbox drivers</span></span> <a title="Permalink" class="permalink" href="cha-uefi.html#sec-uefi-secboot-non-inbox">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    There is no support for adding non-inbox drivers (that is, drivers that do
    not come with <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>) during installation with Secure Boot enabled. The
    signing key used for SolidDriver/PLDP is not trusted by default.
   </p><p>
    It is possible to install third party drivers during installation with
    Secure Boot enabled in two different ways. In both cases:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Add the needed keys to the firmware database via firmware/system
      management tools before the installation. This option depends on the
      specific hardware you are using. Consult your hardware vendor for more
      information.
     </p></li><li class="listitem"><p>
      Use a bootable driver ISO from
      <a class="link" href="https://drivers.suse.com/" target="_blank">https://drivers.suse.com/</a> or your hardware vendor to
      enroll the needed keys in the MOK list at first boot.
     </p></li></ul></div><p>
    To use the bootable driver ISO to enroll the driver keys to the MOK list,
    follow these steps:
   </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Burn the ISO image above to an empty CD/DVD medium.
     </p></li><li class="step"><p>
      Start the installation using the new CD/DVD medium, having the standard
      installation media at hand or a URL to a network installation
      server.
     </p><p>
      If doing a network installation, enter the URL of the network
      installation source on the boot command line using the
      <code class="option">install=</code> option.
     </p><p>
      If doing installation from optical media, the installer will first boot
      from the driver kit and then ask to insert the first installation disk of
      the product.
     </p></li><li class="step"><p>
      An initrd containing updated drivers will be used for installation.
     </p></li></ol></div></div><p>
    For more information, see
    <a class="link" href="https://drivers.suse.com/doc/Usage/Secure_Boot_Certificate.html" target="_blank">https://drivers.suse.com/doc/Usage/Secure_Boot_Certificate.html</a>.
   </p></section><section class="sect2" id="sec-uefi-secboot-feats" data-id-title="Features and limitations"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">17.1.5 </span><span class="title-name">Features and limitations</span></span> <a title="Permalink" class="permalink" href="cha-uefi.html#sec-uefi-secboot-feats">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml" title="Edit source document"> </a></div></div></div></div></div><p>
    When booting in Secure Boot mode, the following features apply:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Installation to UEFI default boot loader location, a mechanism to keep or
      restore the EFI boot entry.
     </p></li><li class="listitem"><p>
      Reboot via UEFI.
     </p></li><li class="listitem"><p>
      Xen hypervisor will boot with UEFI when there is no legacy BIOS to fall
      back to.
     </p></li><li class="listitem"><p>
      UEFI IPv6 PXE boot support.
     </p></li><li class="listitem"><p>
      UEFI video mode support, the kernel can retrieve video mode from UEFI
      to configure KMS mode with the same parameters.
     </p></li><li class="listitem"><p>
      UEFI booting from USB devices is supported.
     </p></li><li class="listitem"><p>
      Since <span class="phrase">SUSE Linux Enterprise Server 15 SP3</span>, Kexec and Kdump are supported in
      Secure Boot mode.
     </p></li></ul></div><p>
    When booting in Secure Boot mode, the following limitations apply:
   </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      To ensure that Secure Boot cannot be easily circumvented, certain kernel
      features are disabled when running under Secure Boot.
     </p></li><li class="listitem"><p>
      Boot loader, kernel, and kernel modules must be signed.
     </p></li><li class="listitem"><p>
      Hibernation (suspend on disk) is disabled.
     </p></li><li class="listitem"><p>
      Access to <code class="filename">/dev/kmem</code> and
      <code class="filename">/dev/mem</code> is not possible, not even as root user.
     </p></li><li class="listitem"><p>
      Access to the I/O port is not possible, not even as root user. All X11
      graphical drivers must use a kernel driver.
     </p></li><li class="listitem"><p>
      PCI BAR access through sysfs is not possible.
     </p></li><li class="listitem"><p>
      <code class="literal">custom_method</code> in ACPI is not available.
     </p></li><li class="listitem"><p>
      debugfs for asus-wmi module is not available.
     </p></li><li class="listitem"><p>
      the <code class="literal">acpi_rsdp</code> parameter does not have any effect on
      the kernel.
     </p></li></ul></div></section></section><section class="sect1" id="sec-uefi-moreinfo" data-id-title="More information"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">17.2 </span><span class="title-name">More information</span></span> <a title="Permalink" class="permalink" href="cha-uefi.html#sec-uefi-moreinfo">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE/doc-sle/edit/main/xml/uefi.xml" title="Edit source document"> </a></div></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     <a class="link" href="https://uefi.org" target="_blank">https://uefi.org</a> — UEFI home page where you
     can find the current UEFI specifications.
    </p></li><li class="listitem"><p>
     Blog posts by Olaf Kirch and Vojtěch Pavlík (the chapter above is
     heavily based on these posts):
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       <a class="link" href="https://www.suse.com/c/uefi-secure-boot-plan/" target="_blank">https://www.suse.com/c/uefi-secure-boot-plan/</a>
      </p></li><li class="listitem"><p>
       <a class="link" href="https://www.suse.com/c/uefi-secure-boot-overview/" target="_blank">https://www.suse.com/c/uefi-secure-boot-overview/</a>
      </p></li><li class="listitem"><p>
       <a class="link" href="https://www.suse.com/c/uefi-secure-boot-details/" target="_blank">https://www.suse.com/c/uefi-secure-boot-details/</a>
      </p></li></ul></div></li><li class="listitem"><p>
     <a class="link" href="https://en.opensuse.org/openSUSE:UEFI" target="_blank">https://en.opensuse.org/openSUSE:UEFI</a> —UEFI with
     openSUSE.
    </p></li></ul></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="cha-boot.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 16 </span>Introduction to the boot process</span></a> </div><div><a class="pagination-link next" href="cha-grub2.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 18 </span>The boot loader GRUB 2</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="sect1"><a href="cha-uefi.html#sec-uefi-secboot"><span class="title-number">17.1 </span><span class="title-name">Secure boot</span></a></span></li><li><span class="sect1"><a href="cha-uefi.html#sec-uefi-moreinfo"><span class="title-number">17.2 </span><span class="title-name">More information</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>